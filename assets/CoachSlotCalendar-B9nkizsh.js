import{r as u,u as q,c as Q,d as V,j as e}from"./vendor-query-DyA9aSKS.js";import{b as J,L as U,l as ue,P as Z,B as k,I as xe,f as S,W as pe,u as fe}from"./index-CTB42aTr.js";import{B as R}from"./badge-oi8tha4_.js";import{c as he,d as ge,e as be,u as je,f as Ne,h as ye,i as ve}from"./api-D19OweGj.js";import{S as X,a as ee,b as se,c as te,d as ae}from"./sheet-CXbUZX5D.js";import{C as we}from"./checkbox-xPb7TbV8.js";import{S as re}from"./separator-C313LD9M.js";import{A as Ce,a as ke,b as Se,c as De,d as _e,e as $e,f as Me,g as Fe}from"./alert-dialog-CR6Fcaa5.js";import{C as ne}from"./clock-BolkdK0m.js";import{M as le}from"./map-pin-BS59sVhy.js";import{L as oe}from"./loader-circle-C2lkvFSh.js";import{P as Ae}from"./pencil-COiKPTUr.js";import{C as Te}from"./copy-Y5NEJFdY.js";import{E as Le}from"./eye-off-CgYUXkRp.js";import{E as Pe}from"./eye-CnDzGLvK.js";import{T as qe}from"./trash-2-DoEFh6CU.js";import{w as Be}from"./swim-DU17Lcvz.js";import{c as Ie}from"./swimSessionUtils-DN7EW4yB.js";import{S as Oe}from"./search-CJsy8zMo.js";import{C as W}from"./chevron-left-BJ3gwIeu.js";import{C as ze}from"./chevron-right-C4BHguz3.js";import{C as Ve}from"./calendar-DXIWzUJ_.js";import"./vendor-react-BzrpNAyj.js";import"./vendor-charts-BrQ8X25f.js";import"./vendor-supabase-DFPLkPj_.js";import"./vendor-motion-lao-Njgm.js";import"./index-BaSzvEE-.js";import"./index-BwDm5i3p.js";import"./index-DCX2sNhR.js";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ee=[["path",{d:"M12 7v14",key:"1akyts"}],["path",{d:"M3 18a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4 4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3 3 3 0 0 0-3-3z",key:"ruj8y"}]],ie=J("book-open",Ee);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Re=[["path",{d:"M11 17a4 4 0 0 1-8 0V5a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2Z",key:"1ldrpk"}],["path",{d:"M16.7 13H19a2 2 0 0 1 2 2v4a2 2 0 0 1-2 2H7",key:"11i5po"}],["path",{d:"M 7 17h.01",key:"1euzgo"}],["path",{d:"m11 8 2.3-2.3a2.4 2.4 0 0 1 3.404.004L18.6 7.6a2.4 2.4 0 0 1 .026 3.434L9.9 19.8",key:"o2gii7"}]],We=J("swatch-book",Re);function G(s){return String(s).padStart(2,"0")}function M(s){return`${s.getFullYear()}-${G(s.getMonth()+1)}-${G(s.getDate())}`}function Ge(s){const t=new Date,a=t.getDay(),r=a===0?-6:1-a,n=new Date(t);return n.setHours(0,0,0,0),n.setDate(t.getDate()+r+s*7),M(n)}function Ke(s,t){return s?s.visible_from===null||s.visible_from===void 0||s.visible_from<=t?"published":"draft":"empty"}function He(s,t){const[a,r,n]=t.split("-").map(Number),i=new Date(a,r-1,n),l=new Date(i);return l.setDate(i.getDate()+s),M(l)}function Ye(s,t,a,r){const n=M(new Date),i=new Map;for(const d of a)i.set(`${d.slot_id}:${d.override_date}`,d);const l=new Map;for(const d of t){if(!d.training_slot_id)continue;const o=`${d.training_slot_id}:${d.scheduled_date}`;l.has(o)||l.set(o,d)}const m=[];for(const d of s){const o=He(d.day_of_week,r),c=`${d.id}:${o}`,x=i.get(c),b=`${d.id}:${o}`,j=l.get(b);let g;x?.status==="cancelled"?g="cancelled":g=Ke(j,n),m.push({date:o,slot:d,groups:d.assignments,state:g,assignment:j,override:x})}return m.sort((d,o)=>{const c=d.date.localeCompare(o.date);return c!==0?c:d.slot.start_time.localeCompare(o.slot.start_time)}),m}function Qe(s){const[t,a,r]=s.split("-").map(Number),n=new Date(t,a-1,r);return n.setDate(n.getDate()+6),M(n)}function Je(s){const[t,a,r]=s.split("-").map(Number),n=new Date(t,a-1,r),i=[];for(let l=0;l<7;l++){const m=new Date(n);m.setDate(n.getDate()+l),i.push(M(m))}return i}function Ue(){const[s,t]=u.useState(0),a=u.useMemo(()=>Ge(s),[s]),r=u.useMemo(()=>Qe(a),[a]),n=u.useMemo(()=>Je(a),[a]),{data:i=[],isLoading:l}=q({queryKey:["training-slots"],queryFn:()=>he(),staleTime:300*1e3}),{data:m=[],isLoading:d}=q({queryKey:["slot-assignments",a,r],queryFn:()=>ge({from:a,to:r}),staleTime:120*1e3}),{data:o=[],isLoading:c}=q({queryKey:["slot-overrides",a],queryFn:()=>be({fromDate:a}),staleTime:300*1e3}),x=l||d||c,b=u.useMemo(()=>Ye(i,m,o,a),[i,m,o,a]),j=u.useMemo(()=>{const f=new Map;for(const N of b){const v=f.get(N.date)??[];v.push(N),f.set(N.date,v)}return f},[b]),g=u.useCallback(()=>t(0),[]),D=u.useCallback(()=>t(f=>f-1),[]),y=u.useCallback(()=>t(f=>f+1),[]);return{weekOffset:s,mondayIso:a,sundayIso:r,weekDates:n,instances:b,instancesByDate:j,isLoading:x,navigateToday:g,prevWeek:D,nextWeek:y}}const Ze=["Lundi","Mardi","Mercredi","Jeudi","Vendredi","Samedi","Dimanche"];function K(s){return s.slice(0,5)}function H(s){const[t,a,r]=s.split("-").map(Number),n=new Date(t,a-1,r),i=(n.getDay()+6)%7,l=Ze[i],m=n.toLocaleDateString("fr-FR",{month:"long"});return`${l} ${r} ${m}`}const E={empty:{label:"",badgeClass:""},draft:{label:"Brouillon",badgeClass:"bg-amber-500/15 text-amber-600 dark:text-amber-400 border-amber-500/25"},published:{label:"Publié",badgeClass:"bg-emerald-500/15 text-emerald-600 dark:text-emerald-400 border-emerald-500/25"},cancelled:{label:"Annulé",badgeClass:"bg-muted text-muted-foreground border-border/50"}};function Xe({instance:s,open:t,onOpenChange:a,onCreateNew:r,onEditSession:n,onPickTemplate:i}){const l=Q(),[m,d]=u.useState([]),[o,c]=u.useState(""),[x,b]=u.useState(!1),[j,g]=u.useState(!1);u.useEffect(()=>{s&&(d(s.groups.map(h=>h.group_id)),c(s.assignment?.visible_from??s.date),b(!1),g(!1))},[s]);const D=u.useCallback(()=>{l.invalidateQueries({queryKey:["slot-assignments"]})},[l]),y=V({mutationFn:h=>je(h),onSuccess:()=>{D(),b(!1)}}),f=V({mutationFn:h=>Ne(h),onSuccess:()=>{D(),g(!1),a(!1)}}),N=h=>{d($=>$.includes(h)?$.filter(p=>p!==h):[...$,h])},v=()=>{s&&y.mutate({trainingSlotId:s.slot.id,scheduledDate:s.date,visibleFrom:o||null})},F=()=>{s&&f.mutate({trainingSlotId:s.slot.id,scheduledDate:s.date})};if(!s)return null;const{state:w,slot:_,assignment:B,override:I,groups:A}=s,T=E[w];return e.jsxs(e.Fragment,{children:[e.jsx(X,{open:t,onOpenChange:a,children:e.jsxs(ee,{side:"bottom",className:"rounded-t-3xl max-h-[85vh] overflow-y-auto px-5 pb-8 pt-4",children:[e.jsx("div",{className:"mx-auto mb-4 h-1 w-10 rounded-full bg-border/60"}),e.jsxs(se,{className:"text-left space-y-1.5 mb-5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(te,{className:"text-base font-bold leading-tight",children:H(s.date)}),w!=="empty"&&e.jsx(R,{variant:"outline",className:`text-[10px] px-2 py-0.5 font-medium leading-none ${T.badgeClass}`,children:T.label})]}),e.jsxs(ae,{className:"flex items-center gap-3 text-xs text-muted-foreground",children:[e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx(ne,{className:"h-3 w-3 opacity-60"}),K(_.start_time)," – ",K(_.end_time)]}),e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx(le,{className:"h-3 w-3 opacity-60"}),_.location]})]})]}),w==="cancelled"&&e.jsx(es,{override:I}),w==="empty"&&e.jsx(ss,{instance:s,groups:A,selectedGroups:m,visibleFrom:o,onToggleGroup:N,onVisibleFromChange:c,onCreateNew:r,onPickTemplate:i,onClose:()=>a(!1)}),(w==="draft"||w==="published")&&e.jsx(ts,{instance:s,assignment:B,showVisibilityPicker:x,visibleFrom:o,visibilityLoading:y.isPending,deleteLoading:f.isPending,onToggleVisibilityPicker:()=>b(h=>!h),onVisibleFromChange:c,onSaveVisibility:v,onEditSession:n,onRequestDelete:()=>g(!0)})]})}),e.jsx(Ce,{open:j,onOpenChange:g,children:e.jsxs(ke,{children:[e.jsxs(Se,{children:[e.jsx(De,{children:"Supprimer la séance ?"}),e.jsxs(_e,{children:["Cette action supprimera définitivement la séance assignée pour ce créneau le ",H(s.date),". Les nageurs ne verront plus cette séance."]})]}),e.jsxs($e,{children:[e.jsx(Me,{disabled:f.isPending,children:"Annuler"}),e.jsx(Fe,{onClick:F,disabled:f.isPending,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:f.isPending?e.jsxs(e.Fragment,{children:[e.jsx(oe,{className:"mr-2 h-4 w-4 animate-spin"}),"Suppression..."]}):"Supprimer"})]})]})})]})}function es({override:s}){return e.jsx("div",{className:"space-y-3",children:e.jsxs("div",{className:"rounded-xl bg-muted/40 border border-border/50 p-4 text-center",children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Ce créneau a été annulé"}),s?.reason&&e.jsx("p",{className:"mt-1.5 text-xs text-muted-foreground/70 italic",children:s.reason})]})})}function ss({instance:s,groups:t,selectedGroups:a,visibleFrom:r,onToggleGroup:n,onVisibleFromChange:i,onCreateNew:l,onPickTemplate:m,onClose:d}){const o=()=>{d(),l(s)},c=()=>{d(),m(s)};return e.jsxs("div",{className:"space-y-5",children:[t.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-xs font-semibold uppercase tracking-wider text-muted-foreground",children:"Groupes"}),e.jsx("div",{className:"space-y-2.5",children:t.map(x=>e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[e.jsx(we,{checked:a.includes(x.group_id),onCheckedChange:()=>n(x.group_id),className:"h-5 w-5"}),e.jsx("span",{className:"text-sm font-medium text-foreground",children:x.group_name})]},x.id))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(U,{htmlFor:"visible-from-empty",className:"text-xs font-semibold uppercase tracking-wider text-muted-foreground",children:[e.jsx(ue,{className:"inline h-3 w-3 mr-1 opacity-60"}),"Visible à partir du"]}),e.jsx("input",{id:"visible-from-empty",type:"date",value:r,onChange:x=>i(x.target.value),className:"w-full rounded-xl border border-border bg-muted/30 px-3 py-2.5 text-sm text-foreground focus:outline-none focus:ring-2 focus:ring-ring"})]}),e.jsx(re,{className:"my-1"}),e.jsxs("div",{className:"space-y-2.5",children:[e.jsxs("button",{type:"button",onClick:o,className:"flex w-full items-center gap-3 rounded-xl bg-primary/10 px-4 py-3.5 text-left transition-colors active:bg-primary/20 hover:bg-primary/15",children:[e.jsx("div",{className:"flex h-9 w-9 shrink-0 items-center justify-center rounded-lg bg-primary/15",children:e.jsx(Z,{className:"h-4.5 w-4.5 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-foreground",children:"Nouvelle séance"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-0.5",children:"Créer une séance de zéro"})]})]}),e.jsxs("button",{type:"button",onClick:c,className:"flex w-full items-center gap-3 rounded-xl bg-muted/50 border border-border/50 px-4 py-3.5 text-left transition-colors active:bg-muted/80 hover:bg-muted/70",children:[e.jsx("div",{className:"flex h-9 w-9 shrink-0 items-center justify-center rounded-lg bg-muted",children:e.jsx(ie,{className:"h-4.5 w-4.5 text-muted-foreground"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-foreground",children:"Depuis la bibliothèque"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-0.5",children:"Utiliser une séance existante"})]})]})]})]})}function ts({instance:s,assignment:t,showVisibilityPicker:a,visibleFrom:r,visibilityLoading:n,deleteLoading:i,onToggleVisibilityPicker:l,onVisibleFromChange:m,onSaveVisibility:d,onEditSession:o,onRequestDelete:c}){return e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{className:"rounded-xl bg-muted/30 border border-border/50 p-4",children:[e.jsx("p",{className:"text-sm font-semibold text-foreground leading-snug",children:t.session_name??"Séance sans nom"}),t.session_distance!=null&&t.session_distance>0&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[t.session_distance," m"]}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx(R,{variant:"outline",className:`text-[10px] px-2 py-0.5 font-medium leading-none ${E[s.state].badgeClass}`,children:E[s.state].label}),t.visible_from&&e.jsxs("span",{className:"text-[10px] text-muted-foreground",children:["Visible le"," ",new Date(t.visible_from).toLocaleDateString("fr-FR",{day:"numeric",month:"short"})]})]})]}),s.groups.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1.5",children:s.groups.map(x=>e.jsx("span",{className:"inline-flex items-center gap-1 rounded-full px-2.5 py-1 text-xs font-medium border border-border/50 bg-muted/60 text-muted-foreground",children:x.group_name},x.id))}),e.jsx(re,{className:"my-1"}),e.jsxs("div",{className:"space-y-2.5",children:[t.swim_catalog_id!=null&&e.jsx(P,{icon:e.jsx(Ae,{className:"h-4 w-4"}),label:"Modifier",description:"Ouvrir dans l'éditeur",onClick:()=>o(t.swim_catalog_id)}),e.jsx(P,{icon:e.jsx(Te,{className:"h-4 w-4"}),label:"Dupliquer vers...",description:"Bientôt disponible",disabled:!0,onClick:()=>{}}),e.jsx(P,{icon:a?e.jsx(Le,{className:"h-4 w-4"}):e.jsx(Pe,{className:"h-4 w-4"}),label:"Visibilité",description:"Date de publication pour les nageurs",onClick:l}),a&&e.jsxs("div",{className:"ml-12 space-y-2.5 rounded-xl border border-border/50 bg-muted/20 p-3",children:[e.jsx(U,{htmlFor:"visible-from-edit",className:"text-xs text-muted-foreground",children:"Visible à partir du"}),e.jsx("input",{id:"visible-from-edit",type:"date",value:r,onChange:x=>m(x.target.value),className:"w-full rounded-lg border border-border bg-background px-3 py-2 text-sm text-foreground focus:outline-none focus:ring-2 focus:ring-ring"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(k,{size:"sm",className:"flex-1 rounded-lg",disabled:n,onClick:d,children:[n?e.jsx(oe,{className:"mr-1.5 h-3.5 w-3.5 animate-spin"}):null,"Enregistrer"]}),e.jsx(k,{size:"sm",variant:"ghost",className:"rounded-lg",disabled:n,onClick:l,children:"Annuler"})]})]}),e.jsx(P,{icon:e.jsx(qe,{className:"h-4 w-4"}),label:"Supprimer",description:"Retirer cette séance du créneau",variant:"destructive",disabled:i,onClick:c})]})]})}function P({icon:s,label:t,description:a,variant:r="default",disabled:n=!1,onClick:i}){const l=r==="destructive";return e.jsxs("button",{type:"button",onClick:i,disabled:n,className:`
        flex w-full items-center gap-3 rounded-xl px-4 py-3.5 text-left transition-colors
        ${n?"opacity-40 cursor-not-allowed":"active:scale-[0.98]"}
        ${l?"bg-destructive/5 hover:bg-destructive/10 active:bg-destructive/15":"bg-muted/40 hover:bg-muted/60 active:bg-muted/80"}
      `,children:[e.jsx("div",{className:`flex h-9 w-9 shrink-0 items-center justify-center rounded-lg ${l?"bg-destructive/10 text-destructive":"bg-muted text-muted-foreground"}`,children:s}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:`text-sm font-semibold ${l?"text-destructive":"text-foreground"}`,children:t}),a&&e.jsx("p",{className:"text-xs text-muted-foreground mt-0.5",children:a})]})]})}function as({open:s,onOpenChange:t,onSelect:a}){const[r,n]=u.useState(""),{data:i,isLoading:l}=q({queryKey:["swim_catalog"],queryFn:()=>Be(),enabled:s}),m=u.useMemo(()=>{if(!i)return[];const o=r.trim().toLowerCase();return i.filter(c=>!c.is_archived).filter(c=>!o||c.name.toLowerCase().includes(o)||(c.folder??"").toLowerCase().includes(o)).sort((c,x)=>c.name.localeCompare(x.name,"fr"))},[i,r]),d=o=>{a(o.id,o.name),t(!1)};return e.jsx(X,{open:s,onOpenChange:t,children:e.jsxs(ee,{side:"bottom",className:"flex h-[80vh] flex-col rounded-t-2xl px-4 pb-4 pt-5",children:[e.jsxs(se,{className:"shrink-0 space-y-1",children:[e.jsx(te,{className:"text-base font-semibold",children:"Choisir une séance"}),e.jsx(ae,{className:"sr-only",children:"Parcourez et recherchez dans la bibliothèque de séances natation"})]}),e.jsxs("div",{className:"relative mt-3 shrink-0",children:[e.jsx(Oe,{className:"pointer-events-none absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(xe,{placeholder:"Rechercher une séance...",value:r,onChange:o=>n(o.target.value),className:"pl-9"})]}),e.jsx("div",{className:"mt-3 flex-1 overflow-y-auto overscroll-contain",children:l?e.jsx("div",{className:"space-y-3",children:Array.from({length:6}).map((o,c)=>e.jsx(S,{className:"h-[72px] w-full rounded-xl"},c))}):m.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center gap-2 py-16 text-muted-foreground",children:[e.jsx(pe,{className:"h-10 w-10 opacity-40"}),e.jsx("p",{className:"text-sm",children:"Aucune séance dans la bibliothèque"})]}):e.jsx("div",{className:"space-y-2",children:m.map(o=>{const c=Ie(o.items??[]);return e.jsxs("button",{type:"button",onClick:()=>d(o),className:"flex w-full items-center gap-3 rounded-xl border border-border bg-card p-3 text-left shadow-sm transition-transform active:scale-[0.98]",children:[e.jsx("div",{className:"flex h-10 w-10 shrink-0 items-center justify-center rounded-lg bg-blue-500/10 text-blue-400",children:e.jsx(We,{className:"h-5 w-5"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"truncate text-sm font-medium text-foreground",children:o.name}),e.jsxs("div",{className:"mt-0.5 flex items-center gap-2 text-xs text-muted-foreground",children:[c>0&&e.jsxs("span",{children:[c.toLocaleString("fr-FR")," m"]}),c>0&&o.folder&&e.jsx("span",{"aria-hidden":"true",children:"·"}),o.folder&&e.jsx("span",{className:"truncate",children:o.folder})]})]})]},o.id)})})})]})})}const rs=["Lun.","Mar.","Mer.","Jeu.","Ven.","Sam.","Dim."];function ns(s,t){const[,a,r]=s.split("-").map(Number),[,n,i]=t.split("-").map(Number),l=new Date(Number(s.split("-")[0]),a-1,r),m=new Date(Number(t.split("-")[0]),n-1,i),d=l.toLocaleDateString("fr-FR",{month:"long"}),o=m.toLocaleDateString("fr-FR",{month:"long"}),c=m.getFullYear();return d===o?`${r} – ${i} ${d} ${c}`:`${r} ${d} – ${i} ${o} ${c}`}function ls(s){const[t,a,r]=s.split("-").map(Number),n=new Date(t,a-1,r),i=(n.getDay()+6)%7,l=rs[i],m=n.toLocaleDateString("fr-FR",{month:"long"});return{abbrev:l,label:`${r} ${m}`}}function de(s,t){return`${s.slice(0,5)} – ${t.slice(0,5)}`}function os(){const s=new Date,t=a=>String(a).padStart(2,"0");return`${s.getFullYear()}-${t(s.getMonth()+1)}-${t(s.getDate())}`}const is={empty:{label:"Aucune séance",badgeClass:"",cardClass:"border-dashed border-border/60 bg-card/40"},draft:{label:"Brouillon",badgeClass:"bg-amber-500/15 text-amber-600 dark:text-amber-400 border-amber-500/25",cardClass:"border-amber-500/30 bg-card"},published:{label:"Publié",badgeClass:"bg-emerald-500/15 text-emerald-600 dark:text-emerald-400 border-emerald-500/25",cardClass:"border-emerald-500/30 bg-card"},cancelled:{label:"Annulé",badgeClass:"bg-muted text-muted-foreground border-border/50",cardClass:"border-border/40 bg-muted/30"}};function Y(){return e.jsxs("div",{className:"rounded-2xl border border-border/50 bg-card p-4 space-y-3 animate-pulse motion-reduce:animate-none",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(S,{className:"h-4 w-20 rounded-md"}),e.jsx(S,{className:"h-5 w-16 rounded-full"})]}),e.jsx(S,{className:"h-4 w-3/4 rounded-md"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(S,{className:"h-3 w-24 rounded-md"}),e.jsx(S,{className:"h-5 w-14 rounded-full"})]})]})}function z(){return e.jsxs("div",{className:"space-y-2.5",children:[e.jsx(S,{className:"h-5 w-32 rounded-md"}),e.jsx(Y,{}),e.jsx(Y,{})]})}function ce({name:s,color:t}){return e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full px-2 py-0.5 text-[10px] font-medium border border-border/50 bg-muted/60 text-muted-foreground",children:[t&&e.jsx("span",{className:"h-1.5 w-1.5 rounded-full shrink-0",style:{backgroundColor:t}}),s]})}function ds({instance:s,onTap:t}){return e.jsxs("button",{type:"button",onClick:t,className:"w-full rounded-2xl border-2 border-dashed border-border/50 bg-card/30 p-4 transition-all duration-150 active:scale-[0.98] active:bg-muted/40 hover:border-border",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex h-10 w-10 shrink-0 items-center justify-center rounded-xl bg-muted/50",children:e.jsx(Z,{className:"h-5 w-5 text-muted-foreground/60"})}),e.jsxs("div",{className:"min-w-0 flex-1 text-left",children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground/80",children:"Aucune séance"}),e.jsxs("p",{className:"text-xs text-muted-foreground/50 mt-0.5",children:[de(s.slot.start_time,s.slot.end_time)," · ",s.slot.location]})]})]}),s.groups.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1 mt-2.5",children:s.groups.map(a=>e.jsx(ce,{name:a.group_name},a.id))})]})}function cs({instance:s,onTap:t}){const a=is[s.state],r=s.state==="cancelled";return e.jsxs("button",{type:"button",onClick:t,className:`
        w-full rounded-2xl border p-4 text-left transition-all duration-150
        active:scale-[0.98] hover:shadow-md
        ${a.cardClass}
        ${r?"opacity-60":"shadow-sm"}
      `,children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-xs text-muted-foreground",children:[e.jsx(ne,{className:"h-3 w-3 opacity-60"}),e.jsx("span",{className:r?"line-through":"",children:de(s.slot.start_time,s.slot.end_time)})]}),e.jsx(R,{variant:"outline",className:`text-[10px] px-2 py-0.5 font-medium leading-none ${a.badgeClass}`,children:a.label})]}),s.assignment?.session_name&&e.jsxs("p",{className:`text-sm font-semibold mt-2 leading-snug ${r?"line-through text-muted-foreground":"text-foreground"}`,children:[s.assignment.session_name,s.assignment.session_distance!=null&&s.assignment.session_distance>0&&e.jsxs("span",{className:"font-normal text-xs text-muted-foreground ml-1.5",children:[s.assignment.session_distance,"m"]})]}),e.jsxs("div",{className:"flex items-center gap-1.5 mt-1.5 text-xs text-muted-foreground",children:[e.jsx(le,{className:"h-3 w-3 opacity-50"}),e.jsx("span",{className:r?"line-through":"",children:s.slot.location})]}),s.groups.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1 mt-2.5",children:s.groups.map(n=>e.jsx(ce,{name:n.group_name},n.id))}),s.state==="draft"&&s.assignment?.visible_from&&e.jsxs("p",{className:"text-[10px] text-amber-600 dark:text-amber-400 mt-2 italic",children:["Visible le ",new Date(s.assignment.visible_from).toLocaleDateString("fr-FR",{day:"numeric",month:"short"})]}),r&&s.override?.reason&&e.jsx("p",{className:"text-[10px] text-muted-foreground mt-2 italic",children:s.override.reason})]})}function Vs({onBack:s,onOpenLibrary:t}){const{weekOffset:a,mondayIso:r,sundayIso:n,weekDates:i,instancesByDate:l,isLoading:m,navigateToday:d,prevWeek:o,nextWeek:c}=Ue(),{userId:x}=fe(),b=Q(),[j,g]=u.useState(null),[D,y]=u.useState(!1),[f,N]=u.useState(!1),[v,F]=u.useState(null),w=u.useCallback(p=>{g(p),y(!0)},[]),_=u.useCallback(p=>{t()},[t]),B=u.useCallback(p=>{t()},[t]),I=u.useCallback(p=>{F(p),y(!1),N(!0)},[]),A=V({mutationFn:async({catalogId:p,inst:C})=>{const L=C.groups.map(O=>O.group_id);L.length===0||!x||await ye({swimCatalogId:p,trainingSlotId:C.slot.id,scheduledDate:C.date,groupIds:L,scheduledSlot:ve(C.slot.start_time),visibleFrom:C.date,assignedBy:x})},onSuccess:()=>{b.invalidateQueries({queryKey:["slot-assignments"]}),N(!1),F(null)}}),T=u.useCallback((p,C)=>{v&&A.mutate({catalogId:p,inst:v})},[v,A]),h=u.useMemo(()=>os(),[]),$=u.useMemo(()=>ns(r,n),[r,n]);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-0 pb-24",children:[e.jsxs("div",{className:"sticky top-0 z-20 -mx-4 bg-background/95 backdrop-blur border-b px-4 pb-3 pt-3 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(k,{variant:"ghost",size:"sm",className:"-ml-2",onClick:s,children:[e.jsx(W,{className:"mr-1 h-4 w-4"}),"Retour"]}),e.jsx("h1",{className:"text-lg font-bold tracking-tight",style:{fontFamily:"var(--font-display, 'Oswald', sans-serif)"},children:"Séances"}),e.jsxs(k,{variant:"ghost",size:"sm",className:"-mr-2 text-primary",onClick:t,children:[e.jsx(ie,{className:"mr-1.5 h-3.5 w-3.5"}),"Bibliothèque"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(k,{variant:"ghost",size:"icon",className:"h-9 w-9 shrink-0",onClick:o,children:e.jsx(W,{className:"h-4 w-4"})}),e.jsx("p",{className:"flex-1 text-center text-sm font-semibold capitalize tabular-nums",children:$}),e.jsx(k,{variant:"ghost",size:"icon",className:"h-9 w-9 shrink-0",onClick:c,children:e.jsx(ze,{className:"h-4 w-4"})}),a!==0&&e.jsx(k,{variant:"outline",size:"sm",className:"rounded-full text-xs px-3",onClick:d,children:"Aujourd'hui"})]})]}),e.jsx("div",{className:"space-y-5 pt-4",children:m?e.jsxs(e.Fragment,{children:[e.jsx(z,{}),e.jsx(z,{}),e.jsx(z,{})]}):i.map(p=>{const C=l.get(p)??[],L=p===h,{abbrev:O,label:me}=ls(p);return e.jsx(ms,{dateIso:p,abbrev:O,label:me,isToday:L,slots:C,onOpenSlot:w},p)})}),!m&&Array.from(l.values()).every(p=>p.length===0)&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-16 text-center",children:[e.jsx("div",{className:"flex h-14 w-14 items-center justify-center rounded-2xl bg-muted/50 mb-4",children:e.jsx(Ve,{className:"h-7 w-7 text-muted-foreground/40"})}),e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Aucun créneau cette semaine"}),e.jsx("p",{className:"text-xs text-muted-foreground/60 mt-1 max-w-[260px]",children:"Configurez vos créneaux récurrents dans les paramètres pour les voir apparaître ici"})]})]}),j&&e.jsx(Xe,{instance:j,open:D,onOpenChange:y,onCreateNew:_,onEditSession:B,onPickTemplate:I}),e.jsx(as,{open:f,onOpenChange:N,onSelect:T})]})}function ms({dateIso:s,abbrev:t,label:a,isToday:r,slots:n,onOpenSlot:i}){return n.length===0?null:e.jsxs("div",{className:`
        relative rounded-2xl transition-colors
        ${r?"bg-primary/[0.03]":""}
      `,children:[r&&e.jsx("div",{className:"absolute left-0 top-2 bottom-2 w-[3px] rounded-full bg-primary"}),e.jsxs("div",{className:r?"pl-3":"",children:[e.jsxs("div",{className:"flex items-center gap-2 pb-2",children:[e.jsx("span",{className:`text-xs font-bold uppercase tracking-wider ${r?"text-primary":"text-muted-foreground"}`,children:t}),e.jsx("span",{className:`text-sm font-semibold capitalize ${r?"text-foreground":"text-foreground/80"}`,children:a}),r&&e.jsx("span",{className:"text-[9px] font-bold uppercase tracking-widest text-primary bg-primary/10 px-2 py-0.5 rounded-full",children:"Aujourd'hui"})]}),e.jsx("div",{className:"space-y-2",children:n.map(l=>l.state==="empty"?e.jsx(ds,{instance:l,onTap:()=>i(l)},`${l.slot.id}-${l.date}`):e.jsx(cs,{instance:l,onTap:()=>i(l)},`${l.slot.id}-${l.date}`))})]})]})}export{Vs as default};
