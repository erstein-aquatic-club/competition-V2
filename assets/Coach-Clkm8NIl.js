const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/StrengthCatalog-C0yNR84x.js","assets/vendor-query-BiSH4r2z.js","assets/vendor-react-BzrpNAyj.js","assets/api-D-dvo79r.js","assets/index-Dtc5GkHC.js","assets/vendor-supabase-DFPLkPj_.js","assets/index-XwWstBqI.css","assets/swim-wngNPflQ.js","assets/index-DuBh0tmZ.js","assets/index-BI2dde8t.js","assets/index-Br1ykskp.js","assets/select-DAgEihZp.js","assets/index-CDwbZz2W.js","assets/chevron-down-C4A_Pw7z.js","assets/chevron-up-Wa-DHI8z.js","assets/CalendarGrid-fB8DuNtJ.js","assets/chevron-left-BE5x_riA.js","assets/chevron-right-ebLyEzBC.js","assets/objectiveHelpers-DA4TnA64.js","assets/dialog-B7ef7YVj.js","assets/index-CTlgPrMw.js","assets/checkbox-BNoDXjyj.js","assets/alert-dialog-d4akTfBX.js","assets/tabs-CUzuJKTy.js","assets/SessionListView-ccFx7IUQ.js","assets/play-Ca7pxwc0.js","assets/save-DG_91USl.js","assets/circle-alert-f-waRjRC.js","assets/pencil-D82iFT2v.js","assets/share-2-BIfluWrO.js","assets/trash-2-7mfnS6f1.js","assets/drawer-rbzRzIUy.js","assets/plus-BQThUrT6.js","assets/loader-circle-Dz_5WqWM.js","assets/search-Cokl3IG_.js","assets/pen-CNkj28xm.js","assets/toggle-group-C2e7jcnt.js","assets/badge-B7eT1ac-.js","assets/copy-MvcoxzVM.js","assets/separator-DzB6rJJz.js","assets/collapsible-De8qXzLt.js","assets/index-DsAllH67.js","assets/user-plus-DfDCcHvA.js","assets/switch-CBC6zG_1.js","assets/map-pin-Cg5FOIc3.js","assets/SwimCatalog--ygV3UTO.js","assets/SwimSessionTimeline-CFxhg7Pg.js","assets/swimConsultationUtils-hz4c53F9.js","assets/timer-DR7_Xfn2.js","assets/eye-D2yqRLPI.js","assets/clock-D0aADgkn.js","assets/date-CwaJqo97.js","assets/format-B9mPVj_w.js"])))=>i.map(i=>d[i]);
import{c as we,B as K,d as se,C as ke,i as _e,k as Ae,l as Me,g as De,L as Q,I as je,m as be,n as hs,o as At,R as xs,p as gs,q as Mt,P as ne,A as Dt,r as Et,t as fs,v as vs,w as js,x as bs,a as le,X as gt,s as ct,W as Pt,D as Rt,y as ys,U as ye,z as Ns,E as ws,T as st,u as ft,b as Cs,G as vt,_ as Ft}from"./index-Dtc5GkHC.js";import{j as e,r,u as U,R as Ss,c as qe,d as X}from"./vendor-query-BiSH4r2z.js";import{a as O}from"./api-D-dvo79r.js";import{T as dt,a as de}from"./toggle-group-C2e7jcnt.js";import{A as Qe,T as ut,M as mt,a as nt,e as Tt,f as $t,F as ks,p as jt}from"./objectiveHelpers-DA4TnA64.js";import{B as te}from"./badge-B7eT1ac-.js";import{S as re,a as ae,b as oe,c as ie,d as J}from"./select-DAgEihZp.js";import{h as _s,R as As,u as Ms,F as Ds,C as bt}from"./index-CDwbZz2W.js";import{u as pe}from"./index-Br1ykskp.js";import{R as Es,P as Ps,O as Rs,C as Fs}from"./index-CTlgPrMw.js";import"./dialog-B7ef7YVj.js";import{S as Ts}from"./search-Cokl3IG_.js";import{C as $s}from"./copy-MvcoxzVM.js";import{a as Os,b as Is,P as qs}from"./CalendarGrid-fB8DuNtJ.js";import{S as ze,a as Le,b as Ke,c as Ge,d as pt,A as Ee,e as Pe,f as Re,g as Fe,h as Te,i as $e,j as Oe,k as Ie}from"./alert-dialog-d4akTfBX.js";import{T as Ot}from"./trash-2-7mfnS6f1.js";import{C as It}from"./checkbox-BNoDXjyj.js";import{S as zs}from"./separator-DzB6rJJz.js";import{C as Ls,a as Ks,b as Gs}from"./collapsible-De8qXzLt.js";import{P as he}from"./plus-BQThUrT6.js";import{U as Vs,a as Bs}from"./user-plus-DfDCcHvA.js";import{C as Us}from"./chevron-down-C4A_Pw7z.js";import{S as Qs}from"./switch-CBC6zG_1.js";import{M as Hs}from"./map-pin-Cg5FOIc3.js";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ws=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 18h.01",key:"lrp35t"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M16 18h.01",key:"kzsmim"}]],rt=we("calendar-days",Ws);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ys=[["path",{d:"m7 15 5 5 5-5",key:"1hf1tw"}],["path",{d:"m7 9 5-5 5 5",key:"sgt6xg"}]],Js=we("chevrons-up-down",Ys);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xs=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]],qt=we("external-link",Xs);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zs=[["path",{d:"M2 9.5a5.5 5.5 0 0 1 9.591-3.676.56.56 0 0 0 .818 0A5.49 5.49 0 0 1 22 9.5c0 2.29-1.5 4-3 5.5l-5.492 5.313a2 2 0 0 1-3 .019L5 15c-1.5-1.5-3-3.2-3-5.5",key:"mvr1a0"}],["path",{d:"M3.22 13H9.5l.5-1 2 4.5 2-7 1.5 3.5h5.27",key:"auskq0"}]],en=we("heart-pulse",Zs);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tn=[["path",{d:"m22 7-8.991 5.727a2 2 0 0 1-2.009 0L2 7",key:"132q7q"}],["rect",{x:"2",y:"4",width:"20",height:"16",rx:"2",key:"izxlao"}]],zt=we("mail",tn);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sn=[["path",{d:"M18 21a8 8 0 0 0-16 0",key:"3ypg7q"}],["circle",{cx:"10",cy:"8",r:"5",key:"o932ke"}],["path",{d:"M22 20c0-3.37-2-6.5-4-8a5 5 0 0 0-.45-8.3",key:"10s06x"}]],Lt=we("users-round",sn),ce=({title:t,description:n,onBack:s,actions:o})=>e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs(K,{variant:"ghost",size:"sm",className:"-ml-2",onClick:s,children:[e.jsx(Qe,{className:"mr-2 h-4 w-4"}),"Retour"]}),e.jsx("h2",{className:"text-2xl font-display font-semibold uppercase italic text-primary",children:t}),n?e.jsx("p",{className:"text-sm text-muted-foreground",children:n}):null]}),o?e.jsx("div",{className:"flex items-center gap-2",children:o}):null]});function nn(t){if(t.length===0)return null;const n=t[0],s=n.effort,o=n.fatigue,a=n.performance,c=n.engagement,d=[];return s!=null&&d.push((11-s)/2),o!=null&&d.push((11-o)/2),a!=null&&d.push(a/2),c!=null&&d.push(c/2),d.length===0?null:Math.round(d.reduce((l,h)=>l+h,0)/d.length*10)/10}function rn(t){return t==null?{label:"—",className:"bg-muted text-muted-foreground"}:t>=3.5?{label:`${t.toFixed(1)}`,className:"bg-emerald-100 text-emerald-800 dark:bg-emerald-900/30 dark:text-emerald-400"}:t>=2.5?{label:`${t.toFixed(1)}`,className:"bg-amber-100 text-amber-800 dark:bg-amber-900/30 dark:text-amber-400"}:{label:`${t.toFixed(1)}`,className:"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400"}}function an({athletes:t,athletesLoading:n,onBack:s,onOpenAthlete:o}){const[a,c]=r.useState(null),[d,l]=r.useState("name"),{data:h=[]}=U({queryKey:["recent-sessions-all",30],queryFn:()=>O.getRecentSessionsAllAthletes(30),enabled:t.length>0,staleTime:300*1e3}),{data:u=[]}=U({queryKey:["objectives-all"],queryFn:()=>O.getObjectives(),enabled:t.length>0,staleTime:300*1e3}),x=r.useMemo(()=>{const p=new Map;return t.forEach(i=>{i.group_id&&i.group_label&&p.set(i.group_id,i.group_label)}),Array.from(p.entries()).map(([i,f])=>({id:i,name:f})).sort((i,f)=>i.name.localeCompare(f.name,"fr"))},[t]),m=r.useMemo(()=>{const p=new Map,i=new Map;for(const w of h){if(w.athlete_id==null)continue;const j=i.get(w.athlete_id)??[];j.push(w),i.set(w.athlete_id,j)}const f=new Map;for(const w of u){const j=w.athlete_name?.toLowerCase()??"";if(!j)continue;const b=f.get(j)??[];b.push(w),f.set(j,b)}for(const w of t){if(w.id==null)continue;const j=i.get(w.id)??[],b=f.get(w.display_name.toLowerCase())??[],L=nn(j),I=j.length>0?j[0].session_date:null;p.set(w.id,{forme:L,lastSessionDate:I,sessionsCount30d:j.length,assiduity:null,objectivesTotal:b.length,objectivesAchieved:0})}return p},[t,h,u]),v=r.useMemo(()=>{let p=[...t];switch(a!=null&&(p=p.filter(i=>i.group_id===a)),d){case"forme":p.sort((i,f)=>{const w=i.id!=null?m.get(i.id)?.forme??99:99,j=f.id!=null?m.get(f.id)?.forme??99:99;return w-j});break;case"assiduity":p.sort((i,f)=>{const w=i.id!=null?m.get(i.id)?.sessionsCount30d??99:99,j=f.id!=null?m.get(f.id)?.sessionsCount30d??99:99;return w-j});break;default:p.sort((i,f)=>i.display_name.localeCompare(f.display_name,"fr"))}return p},[t,a,d,m]);return e.jsxs("div",{className:"space-y-4",children:[e.jsx(ce,{title:"Nageurs",description:n?"Chargement…":`${t.length} nageur${t.length!==1?"s":""}`,onBack:s}),x.length>1&&e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{type:"button",onClick:()=>c(null),className:`rounded-full px-3 py-1 text-xs font-medium border transition ${a==null?"bg-foreground text-background border-foreground":"bg-card text-foreground border-border hover:bg-muted"}`,children:"Tous"}),x.map(p=>e.jsx("button",{type:"button",onClick:()=>c(a===p.id?null:p.id),className:`rounded-full px-3 py-1 text-xs font-medium border transition ${a===p.id?"bg-foreground text-background border-foreground":"bg-card text-foreground border-border hover:bg-muted"}`,children:p.name},p.id))]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"Trier :"}),[{key:"name",label:"Nom"},{key:"forme",label:"Forme"},{key:"assiduity",label:"Activité"}].map(p=>e.jsx("button",{type:"button",onClick:()=>l(p.key),className:`rounded-full px-2.5 py-0.5 text-xs font-medium border transition ${d===p.key?"bg-primary/10 text-primary border-primary/30":"bg-card text-muted-foreground border-border hover:bg-muted"}`,children:p.label},p.key))]}),n?e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3",children:[1,2,3,4,5,6].map(p=>e.jsxs("div",{className:"rounded-2xl border bg-card p-4 animate-pulse motion-reduce:animate-none",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-muted"}),e.jsxs("div",{className:"space-y-1.5 flex-1",children:[e.jsx("div",{className:"h-4 w-24 rounded bg-muted"}),e.jsx("div",{className:"h-3 w-16 rounded bg-muted"})]})]}),e.jsxs("div",{className:"mt-3 space-y-2",children:[e.jsx("div",{className:"h-3 w-full rounded bg-muted"}),e.jsx("div",{className:"h-3 w-2/3 rounded bg-muted"})]})]},p))}):v.length===0?e.jsx("p",{className:"text-sm text-muted-foreground text-center py-8",children:a!=null?"Aucun nageur dans ce groupe.":"Aucun nageur disponible."}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3",children:v.map(p=>{const i=p.id!=null?m.get(p.id):null,f=rn(i?.forme??null);return e.jsxs("button",{type:"button",onClick:()=>o(p),className:"rounded-2xl border bg-card p-4 text-left hover:shadow-md hover:border-primary/20 transition-all",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[p.avatar_url?e.jsx("img",{src:p.avatar_url,alt:"",className:"h-10 w-10 rounded-full object-cover border border-border"}):e.jsx("div",{className:"h-10 w-10 rounded-full bg-primary/10 flex items-center justify-center text-sm font-bold text-primary",children:p.display_name.charAt(0).toUpperCase()}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-sm font-semibold truncate",children:p.display_name}),p.group_label&&e.jsx(te,{variant:"secondary",className:"text-[10px] px-1.5 py-0 mt-0.5",children:p.group_label})]})]}),e.jsxs("div",{className:"mt-3 grid grid-cols-3 gap-2",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-[10px] font-medium text-muted-foreground mb-1",children:"Forme"}),e.jsx("span",{className:`inline-block rounded-full px-2 py-0.5 text-xs font-semibold ${f.className}`,children:f.label})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-[10px] font-medium text-muted-foreground mb-1",children:"30j"}),e.jsx("span",{className:"text-sm font-bold text-foreground",children:i?.sessionsCount30d??0}),e.jsx("span",{className:"text-[10px] text-muted-foreground ml-0.5",children:"séances"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-[10px] font-medium text-muted-foreground mb-1",children:"Objectifs"}),e.jsx("span",{className:"text-sm font-bold text-foreground",children:i?.objectivesTotal??0})]})]}),i?.lastSessionDate&&e.jsxs("div",{className:"mt-2 text-[10px] text-muted-foreground",children:["Dernier ressenti : ",new Date(i.lastSessionDate).toLocaleDateString("fr-FR",{day:"numeric",month:"short"})]})]},p.id??p.display_name)})})]})}const on=({onBack:t,athletes:n,groups:s,athletesLoading:o})=>{const{toast:a}=se(),[c,d]=r.useState(""),[l,h]=r.useState(""),u=r.useMemo(()=>n.filter(i=>i.id&&i.email).map(i=>({value:`user:${i.id}`,label:i.group_label?`${i.display_name} · ${i.group_label}`:i.display_name,email:i.email})),[n]),x=r.useMemo(()=>s.map(i=>({value:`group:${i.id}`,label:i.name,id:i.id})),[s]),m=()=>{if(!l)return[];if(l.startsWith("user:")){const i=u.find(f=>f.value===l);return i?[i.email]:[]}if(l.startsWith("group:")){const i=Number(l.split(":")[1]);return n.filter(f=>f.group_id===i&&f.email).map(f=>f.email)}return[]},v=()=>{const i=m();if(!i.length){a({title:"Aucune adresse email",description:"Aucun nageur avec une adresse email dans cette sélection."});return}const f=new URLSearchParams;f.set("bcc",i.join(",")),c.trim()&&f.set("subject",c.trim()),window.location.href=`mailto:?${f.toString()}`},p=m();return e.jsxs("div",{className:"space-y-6 pb-24",children:[e.jsx(ce,{title:"Contacter par email",description:"Ouvre votre application mail avec les destinataires en CCI.",onBack:t}),e.jsxs(ke,{className:"border-l-4 border-l-primary",children:[e.jsxs(_e,{children:[e.jsx(Ae,{children:"Destinataire"}),e.jsx(Me,{children:"Sélectionnez un nageur ou un groupe."})]}),e.jsxs(De,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(Q,{children:"Destinataire"}),e.jsxs(re,{value:l,onValueChange:h,children:[e.jsx(ae,{children:e.jsx(oe,{placeholder:o?"Chargement...":"Choisir un nageur ou un groupe"})}),e.jsxs(ie,{children:[x.length?e.jsxs(e.Fragment,{children:[e.jsx(J,{value:"section-group",disabled:!0,children:"Groupes"}),x.map(i=>e.jsx(J,{value:i.value,children:i.label},i.value))]}):null,u.length?e.jsxs(e.Fragment,{children:[e.jsx(J,{value:"section-athlete",disabled:!0,children:"Nageurs"}),u.map(i=>e.jsx(J,{value:i.value,children:i.label},i.value))]}):null]})]})]}),l&&p.length>0?e.jsxs("p",{className:"text-xs text-muted-foreground",children:[p.length," adresse",p.length>1?"s":""," email",p.length>1?" (envoi en CCI)":""]}):null,l&&p.length===0?e.jsx("p",{className:"text-xs text-destructive",children:"Aucune adresse email disponible pour cette sélection."}):null]})]}),e.jsxs(ke,{children:[e.jsxs(_e,{children:[e.jsx(Ae,{children:"Objet"}),e.jsx(Me,{children:"Optionnel — pré-rempli dans votre application mail."})]}),e.jsx(De,{children:e.jsx(je,{value:c,onChange:i=>d(i.target.value),placeholder:"Objet du mail…"})})]}),e.jsx("div",{className:"sticky bottom-0 z-10 -mx-4 border-t bg-background/95 p-4 backdrop-blur sm:static sm:mx-0 sm:border-0 sm:p-0",children:e.jsxs(K,{className:"w-full sm:w-auto",onClick:v,disabled:!l||p.length===0,children:[e.jsx(zt,{className:"mr-2 h-4 w-4"}),"Ouvrir dans l'app mail",e.jsx(qt,{className:"ml-2 h-3 w-3"})]})})]})};function Se(t,n,{checkForDefaultPrevented:s=!0}={}){return function(a){if(t?.(a),s===!1||!a.defaultPrevented)return n?.(a)}}function ln(t){const n=cn(t),s=r.forwardRef((o,a)=>{const{children:c,...d}=o,l=r.Children.toArray(c),h=l.find(un);if(h){const u=h.props.children,x=l.map(m=>m===h?r.Children.count(u)>1?r.Children.only(null):r.isValidElement(u)?u.props.children:null:m);return e.jsx(n,{...d,ref:a,children:r.isValidElement(u)?r.cloneElement(u,void 0,x):null})}return e.jsx(n,{...d,ref:a,children:c})});return s.displayName=`${t}.Slot`,s}function cn(t){const n=r.forwardRef((s,o)=>{const{children:a,...c}=s;if(r.isValidElement(a)){const d=pn(a),l=mn(c,a.props);return a.type!==r.Fragment&&(l.ref=o?be(o,d):d),r.cloneElement(a,l)}return r.Children.count(a)>1?r.Children.only(null):null});return n.displayName=`${t}.SlotClone`,n}var dn=Symbol("radix.slottable");function un(t){return r.isValidElement(t)&&typeof t.type=="function"&&"__radixId"in t.type&&t.type.__radixId===dn}function mn(t,n){const s={...n};for(const o in n){const a=t[o],c=n[o];/^on[A-Z]/.test(o)?a&&c?s[o]=(...l)=>{const h=c(...l);return a(...l),h}:a&&(s[o]=a):o==="style"?s[o]={...a,...c}:o==="className"&&(s[o]=[a,c].filter(Boolean).join(" "))}return{...t,...s}}function pn(t){let n=Object.getOwnPropertyDescriptor(t.props,"ref")?.get,s=n&&"isReactWarning"in n&&n.isReactWarning;return s?t.ref:(n=Object.getOwnPropertyDescriptor(t,"ref")?.get,s=n&&"isReactWarning"in n&&n.isReactWarning,s?t.props.ref:t.props.ref||t.ref)}var hn=Ss[" useInsertionEffect ".trim().toString()]||hs;function xn({prop:t,defaultProp:n,onChange:s=()=>{},caller:o}){const[a,c,d]=gn({defaultProp:n,onChange:s}),l=t!==void 0,h=l?t:a;{const x=r.useRef(t!==void 0);r.useEffect(()=>{const m=x.current;m!==l&&console.warn(`${o} is changing from ${m?"controlled":"uncontrolled"} to ${l?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),x.current=l},[l,o])}const u=r.useCallback(x=>{if(l){const m=fn(x)?x(t):x;m!==t&&d.current?.(m)}else c(x)},[l,t,c,d]);return[h,u]}function gn({defaultProp:t,onChange:n}){const[s,o]=r.useState(t),a=r.useRef(s),c=r.useRef(n);return hn(()=>{c.current=n},[n]),r.useEffect(()=>{a.current!==s&&(c.current?.(s),a.current=s)},[s,a]),[s,o,c]}function fn(t){return typeof t=="function"}var He="Popover",[Kt]=gs(He,[At]),Ve=At(),[vn,me]=Kt(He),Gt=t=>{const{__scopePopover:n,children:s,open:o,defaultOpen:a,onOpenChange:c,modal:d=!1}=t,l=Ve(n),h=r.useRef(null),[u,x]=r.useState(!1),[m,v]=xn({prop:o,defaultProp:a??!1,onChange:c,caller:He});return e.jsx(xs,{...l,children:e.jsx(vn,{scope:n,contentId:pe(),triggerRef:h,open:m,onOpenChange:v,onOpenToggle:r.useCallback(()=>v(p=>!p),[v]),hasCustomAnchor:u,onCustomAnchorAdd:r.useCallback(()=>x(!0),[]),onCustomAnchorRemove:r.useCallback(()=>x(!1),[]),modal:d,children:s})})};Gt.displayName=He;var Vt="PopoverAnchor",jn=r.forwardRef((t,n)=>{const{__scopePopover:s,...o}=t,a=me(Vt,s),c=Ve(s),{onCustomAnchorAdd:d,onCustomAnchorRemove:l}=a;return r.useEffect(()=>(d(),()=>l()),[d,l]),e.jsx(Dt,{...c,...o,ref:n})});jn.displayName=Vt;var Bt="PopoverTrigger",Ut=r.forwardRef((t,n)=>{const{__scopePopover:s,...o}=t,a=me(Bt,s),c=Ve(s),d=Mt(n,a.triggerRef),l=e.jsx(ne.button,{type:"button","aria-haspopup":"dialog","aria-expanded":a.open,"aria-controls":a.contentId,"data-state":Jt(a.open),...o,ref:d,onClick:Se(t.onClick,a.onOpenToggle)});return a.hasCustomAnchor?l:e.jsx(Dt,{asChild:!0,...c,children:l})});Ut.displayName=Bt;var ht="PopoverPortal",[bn,yn]=Kt(ht,{forceMount:void 0}),Qt=t=>{const{__scopePopover:n,forceMount:s,children:o,container:a}=t,c=me(ht,n);return e.jsx(bn,{scope:n,forceMount:s,children:e.jsx(Et,{present:s||c.open,children:e.jsx(fs,{asChild:!0,container:a,children:o})})})};Qt.displayName=ht;var Ne="PopoverContent",Ht=r.forwardRef((t,n)=>{const s=yn(Ne,t.__scopePopover),{forceMount:o=s.forceMount,...a}=t,c=me(Ne,t.__scopePopover);return e.jsx(Et,{present:o||c.open,children:c.modal?e.jsx(wn,{...a,ref:n}):e.jsx(Cn,{...a,ref:n})})});Ht.displayName=Ne;var Nn=ln("PopoverContent.RemoveScroll"),wn=r.forwardRef((t,n)=>{const s=me(Ne,t.__scopePopover),o=r.useRef(null),a=Mt(n,o),c=r.useRef(!1);return r.useEffect(()=>{const d=o.current;if(d)return _s(d)},[]),e.jsx(As,{as:Nn,allowPinchZoom:!0,children:e.jsx(Wt,{...t,ref:a,trapFocus:s.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:Se(t.onCloseAutoFocus,d=>{d.preventDefault(),c.current||s.triggerRef.current?.focus()}),onPointerDownOutside:Se(t.onPointerDownOutside,d=>{const l=d.detail.originalEvent,h=l.button===0&&l.ctrlKey===!0,u=l.button===2||h;c.current=u},{checkForDefaultPrevented:!1}),onFocusOutside:Se(t.onFocusOutside,d=>d.preventDefault(),{checkForDefaultPrevented:!1})})})}),Cn=r.forwardRef((t,n)=>{const s=me(Ne,t.__scopePopover),o=r.useRef(!1),a=r.useRef(!1);return e.jsx(Wt,{...t,ref:n,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:c=>{t.onCloseAutoFocus?.(c),c.defaultPrevented||(o.current||s.triggerRef.current?.focus(),c.preventDefault()),o.current=!1,a.current=!1},onInteractOutside:c=>{t.onInteractOutside?.(c),c.defaultPrevented||(o.current=!0,c.detail.originalEvent.type==="pointerdown"&&(a.current=!0));const d=c.target;s.triggerRef.current?.contains(d)&&c.preventDefault(),c.detail.originalEvent.type==="focusin"&&a.current&&c.preventDefault()}})}),Wt=r.forwardRef((t,n)=>{const{__scopePopover:s,trapFocus:o,onOpenAutoFocus:a,onCloseAutoFocus:c,disableOutsidePointerEvents:d,onEscapeKeyDown:l,onPointerDownOutside:h,onFocusOutside:u,onInteractOutside:x,...m}=t,v=me(Ne,s),p=Ve(s);return Ms(),e.jsx(Ds,{asChild:!0,loop:!0,trapped:o,onMountAutoFocus:a,onUnmountAutoFocus:c,children:e.jsx(vs,{asChild:!0,disableOutsidePointerEvents:d,onInteractOutside:x,onEscapeKeyDown:l,onPointerDownOutside:h,onFocusOutside:u,onDismiss:()=>v.onOpenChange(!1),children:e.jsx(js,{"data-state":Jt(v.open),role:"dialog",id:v.contentId,...p,...m,ref:n,style:{...m.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}})})})}),Yt="PopoverClose",Sn=r.forwardRef((t,n)=>{const{__scopePopover:s,...o}=t,a=me(Yt,s);return e.jsx(ne.button,{type:"button",...o,ref:n,onClick:Se(t.onClick,()=>a.onOpenChange(!1))})});Sn.displayName=Yt;var kn="PopoverArrow",_n=r.forwardRef((t,n)=>{const{__scopePopover:s,...o}=t,a=Ve(s);return e.jsx(bs,{...a,...o,ref:n})});_n.displayName=kn;function Jt(t){return t?"open":"closed"}var An=Gt,Mn=Ut,Dn=Qt,Xt=Ht;const En=An,Pn=Mn,Zt=r.forwardRef(({className:t,align:n="center",sideOffset:s=4,...o},a)=>e.jsx(Dn,{children:e.jsx(Xt,{ref:a,align:n,sideOffset:s,className:le("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-popover-content-transform-origin]",t),...o})}));Zt.displayName=Xt.displayName;var yt=1,Rn=.9,Fn=.8,Tn=.17,Ye=.1,Je=.999,$n=.9999,On=.99,In=/[\\\/_+.#"@\[\(\{&]/,qn=/[\\\/_+.#"@\[\(\{&]/g,zn=/[\s-]/,es=/[\s-]/g;function at(t,n,s,o,a,c,d){if(c===n.length)return a===t.length?yt:On;var l=`${a},${c}`;if(d[l]!==void 0)return d[l];for(var h=o.charAt(c),u=s.indexOf(h,a),x=0,m,v,p,i;u>=0;)m=at(t,n,s,o,u+1,c+1,d),m>x&&(u===a?m*=yt:In.test(t.charAt(u-1))?(m*=Fn,p=t.slice(a,u-1).match(qn),p&&a>0&&(m*=Math.pow(Je,p.length))):zn.test(t.charAt(u-1))?(m*=Rn,i=t.slice(a,u-1).match(es),i&&a>0&&(m*=Math.pow(Je,i.length))):(m*=Tn,a>0&&(m*=Math.pow(Je,u-a))),t.charAt(u)!==n.charAt(c)&&(m*=$n)),(m<Ye&&s.charAt(u-1)===o.charAt(c+1)||o.charAt(c+1)===o.charAt(c)&&s.charAt(u-1)!==o.charAt(c))&&(v=at(t,n,s,o,u+1,c+2,d),v*Ye>m&&(m=v*Ye)),m>x&&(x=m),u=s.indexOf(h,u+1);return d[l]=x,x}function Nt(t){return t.toLowerCase().replace(es," ")}function Ln(t,n,s){return t=s&&s.length>0?`${t+" "+s.join(" ")}`:t,at(t,n,Nt(t),Nt(n),0,0,{})}var Ce='[cmdk-group=""]',Xe='[cmdk-group-items=""]',Kn='[cmdk-group-heading=""]',ts='[cmdk-item=""]',wt=`${ts}:not([aria-disabled="true"])`,ot="cmdk-item-select",fe="data-value",Gn=(t,n,s)=>Ln(t,n,s),ss=r.createContext(void 0),Be=()=>r.useContext(ss),ns=r.createContext(void 0),xt=()=>r.useContext(ns),rs=r.createContext(void 0),as=r.forwardRef((t,n)=>{let s=ve(()=>{var g,A;return{search:"",value:(A=(g=t.value)!=null?g:t.defaultValue)!=null?A:"",selectedItemId:void 0,filtered:{count:0,items:new Map,groups:new Set}}}),o=ve(()=>new Set),a=ve(()=>new Map),c=ve(()=>new Map),d=ve(()=>new Set),l=os(t),{label:h,children:u,value:x,onValueChange:m,filter:v,shouldFilter:p,loop:i,disablePointerSelection:f=!1,vimBindings:w=!0,...j}=t,b=pe(),L=pe(),I=pe(),P=r.useRef(null),_=er();xe(()=>{if(x!==void 0){let g=x.trim();s.current.value=g,E.emit()}},[x]),xe(()=>{_(6,F)},[]);let E=r.useMemo(()=>({subscribe:g=>(d.current.add(g),()=>d.current.delete(g)),snapshot:()=>s.current,setState:(g,A,C)=>{var S,z,V,W;if(!Object.is(s.current[g],A)){if(s.current[g]=A,g==="search")B(),R(),_(1,$);else if(g==="value"){if(document.activeElement.hasAttribute("cmdk-input")||document.activeElement.hasAttribute("cmdk-root")){let Y=document.getElementById(I);Y?Y.focus():(S=document.getElementById(b))==null||S.focus()}if(_(7,()=>{var Y;s.current.selectedItemId=(Y=k())==null?void 0:Y.id,E.emit()}),C||_(5,F),((z=l.current)==null?void 0:z.value)!==void 0){let Y=A??"";(W=(V=l.current).onValueChange)==null||W.call(V,Y);return}}E.emit()}},emit:()=>{d.current.forEach(g=>g())}}),[]),D=r.useMemo(()=>({value:(g,A,C)=>{var S;A!==((S=c.current.get(g))==null?void 0:S.value)&&(c.current.set(g,{value:A,keywords:C}),s.current.filtered.items.set(g,N(A,C)),_(2,()=>{R(),E.emit()}))},item:(g,A)=>(o.current.add(g),A&&(a.current.has(A)?a.current.get(A).add(g):a.current.set(A,new Set([g]))),_(3,()=>{B(),R(),s.current.value||$(),E.emit()}),()=>{c.current.delete(g),o.current.delete(g),s.current.filtered.items.delete(g);let C=k();_(4,()=>{B(),C?.getAttribute("id")===g&&$(),E.emit()})}),group:g=>(a.current.has(g)||a.current.set(g,new Set),()=>{c.current.delete(g),a.current.delete(g)}),filter:()=>l.current.shouldFilter,label:h||t["aria-label"],getDisablePointerSelection:()=>l.current.disablePointerSelection,listId:b,inputId:I,labelId:L,listInnerRef:P}),[]);function N(g,A){var C,S;let z=(S=(C=l.current)==null?void 0:C.filter)!=null?S:Gn;return g?z(g,s.current.search,A):0}function R(){if(!s.current.search||l.current.shouldFilter===!1)return;let g=s.current.filtered.items,A=[];s.current.filtered.groups.forEach(S=>{let z=a.current.get(S),V=0;z.forEach(W=>{let Y=g.get(W);V=Math.max(Y,V)}),A.push([S,V])});let C=P.current;y().sort((S,z)=>{var V,W;let Y=S.getAttribute("id"),Ue=z.getAttribute("id");return((V=g.get(Ue))!=null?V:0)-((W=g.get(Y))!=null?W:0)}).forEach(S=>{let z=S.closest(Xe);z?z.appendChild(S.parentElement===z?S:S.closest(`${Xe} > *`)):C.appendChild(S.parentElement===C?S:S.closest(`${Xe} > *`))}),A.sort((S,z)=>z[1]-S[1]).forEach(S=>{var z;let V=(z=P.current)==null?void 0:z.querySelector(`${Ce}[${fe}="${encodeURIComponent(S[0])}"]`);V?.parentElement.appendChild(V)})}function $(){let g=y().find(C=>C.getAttribute("aria-disabled")!=="true"),A=g?.getAttribute(fe);E.setState("value",A||void 0)}function B(){var g,A,C,S;if(!s.current.search||l.current.shouldFilter===!1){s.current.filtered.count=o.current.size;return}s.current.filtered.groups=new Set;let z=0;for(let V of o.current){let W=(A=(g=c.current.get(V))==null?void 0:g.value)!=null?A:"",Y=(S=(C=c.current.get(V))==null?void 0:C.keywords)!=null?S:[],Ue=N(W,Y);s.current.filtered.items.set(V,Ue),Ue>0&&z++}for(let[V,W]of a.current)for(let Y of W)if(s.current.filtered.items.get(Y)>0){s.current.filtered.groups.add(V);break}s.current.filtered.count=z}function F(){var g,A,C;let S=k();S&&(((g=S.parentElement)==null?void 0:g.firstChild)===S&&((C=(A=S.closest(Ce))==null?void 0:A.querySelector(Kn))==null||C.scrollIntoView({block:"nearest"})),S.scrollIntoView({block:"nearest"}))}function k(){var g;return(g=P.current)==null?void 0:g.querySelector(`${ts}[aria-selected="true"]`)}function y(){var g;return Array.from(((g=P.current)==null?void 0:g.querySelectorAll(wt))||[])}function T(g){let A=y()[g];A&&E.setState("value",A.getAttribute(fe))}function q(g){var A;let C=k(),S=y(),z=S.findIndex(W=>W===C),V=S[z+g];(A=l.current)!=null&&A.loop&&(V=z+g<0?S[S.length-1]:z+g===S.length?S[0]:S[z+g]),V&&E.setState("value",V.getAttribute(fe))}function G(g){let A=k(),C=A?.closest(Ce),S;for(;C&&!S;)C=g>0?Xn(C,Ce):Zn(C,Ce),S=C?.querySelector(wt);S?E.setState("value",S.getAttribute(fe)):q(g)}let ee=()=>T(y().length-1),M=g=>{g.preventDefault(),g.metaKey?ee():g.altKey?G(1):q(1)},H=g=>{g.preventDefault(),g.metaKey?T(0):g.altKey?G(-1):q(-1)};return r.createElement(ne.div,{ref:n,tabIndex:-1,...j,"cmdk-root":"",onKeyDown:g=>{var A;(A=j.onKeyDown)==null||A.call(j,g);let C=g.nativeEvent.isComposing||g.keyCode===229;if(!(g.defaultPrevented||C))switch(g.key){case"n":case"j":{w&&g.ctrlKey&&M(g);break}case"ArrowDown":{M(g);break}case"p":case"k":{w&&g.ctrlKey&&H(g);break}case"ArrowUp":{H(g);break}case"Home":{g.preventDefault(),T(0);break}case"End":{g.preventDefault(),ee();break}case"Enter":{g.preventDefault();let S=k();if(S){let z=new Event(ot);S.dispatchEvent(z)}}}}},r.createElement("label",{"cmdk-label":"",htmlFor:D.inputId,id:D.labelId,style:sr},h),We(t,g=>r.createElement(ns.Provider,{value:E},r.createElement(ss.Provider,{value:D},g))))}),Vn=r.forwardRef((t,n)=>{var s,o;let a=pe(),c=r.useRef(null),d=r.useContext(rs),l=Be(),h=os(t),u=(o=(s=h.current)==null?void 0:s.forceMount)!=null?o:d?.forceMount;xe(()=>{if(!u)return l.item(a,d?.id)},[u]);let x=is(a,c,[t.value,t.children,c],t.keywords),m=xt(),v=ue(_=>_.value&&_.value===x.current),p=ue(_=>u||l.filter()===!1?!0:_.search?_.filtered.items.get(a)>0:!0);r.useEffect(()=>{let _=c.current;if(!(!_||t.disabled))return _.addEventListener(ot,i),()=>_.removeEventListener(ot,i)},[p,t.onSelect,t.disabled]);function i(){var _,E;f(),(E=(_=h.current).onSelect)==null||E.call(_,x.current)}function f(){m.setState("value",x.current,!0)}if(!p)return null;let{disabled:w,value:j,onSelect:b,forceMount:L,keywords:I,...P}=t;return r.createElement(ne.div,{ref:be(c,n),...P,id:a,"cmdk-item":"",role:"option","aria-disabled":!!w,"aria-selected":!!v,"data-disabled":!!w,"data-selected":!!v,onPointerMove:w||l.getDisablePointerSelection()?void 0:f,onClick:w?void 0:i},t.children)}),Bn=r.forwardRef((t,n)=>{let{heading:s,children:o,forceMount:a,...c}=t,d=pe(),l=r.useRef(null),h=r.useRef(null),u=pe(),x=Be(),m=ue(p=>a||x.filter()===!1?!0:p.search?p.filtered.groups.has(d):!0);xe(()=>x.group(d),[]),is(d,l,[t.value,t.heading,h]);let v=r.useMemo(()=>({id:d,forceMount:a}),[a]);return r.createElement(ne.div,{ref:be(l,n),...c,"cmdk-group":"",role:"presentation",hidden:m?void 0:!0},s&&r.createElement("div",{ref:h,"cmdk-group-heading":"","aria-hidden":!0,id:u},s),We(t,p=>r.createElement("div",{"cmdk-group-items":"",role:"group","aria-labelledby":s?u:void 0},r.createElement(rs.Provider,{value:v},p))))}),Un=r.forwardRef((t,n)=>{let{alwaysRender:s,...o}=t,a=r.useRef(null),c=ue(d=>!d.search);return!s&&!c?null:r.createElement(ne.div,{ref:be(a,n),...o,"cmdk-separator":"",role:"separator"})}),Qn=r.forwardRef((t,n)=>{let{onValueChange:s,...o}=t,a=t.value!=null,c=xt(),d=ue(u=>u.search),l=ue(u=>u.selectedItemId),h=Be();return r.useEffect(()=>{t.value!=null&&c.setState("search",t.value)},[t.value]),r.createElement(ne.input,{ref:n,...o,"cmdk-input":"",autoComplete:"off",autoCorrect:"off",spellCheck:!1,"aria-autocomplete":"list",role:"combobox","aria-expanded":!0,"aria-controls":h.listId,"aria-labelledby":h.labelId,"aria-activedescendant":l,id:h.inputId,type:"text",value:a?t.value:d,onChange:u=>{a||c.setState("search",u.target.value),s?.(u.target.value)}})}),Hn=r.forwardRef((t,n)=>{let{children:s,label:o="Suggestions",...a}=t,c=r.useRef(null),d=r.useRef(null),l=ue(u=>u.selectedItemId),h=Be();return r.useEffect(()=>{if(d.current&&c.current){let u=d.current,x=c.current,m,v=new ResizeObserver(()=>{m=requestAnimationFrame(()=>{let p=u.offsetHeight;x.style.setProperty("--cmdk-list-height",p.toFixed(1)+"px")})});return v.observe(u),()=>{cancelAnimationFrame(m),v.unobserve(u)}}},[]),r.createElement(ne.div,{ref:be(c,n),...a,"cmdk-list":"",role:"listbox",tabIndex:-1,"aria-activedescendant":l,"aria-label":o,id:h.listId},We(t,u=>r.createElement("div",{ref:be(d,h.listInnerRef),"cmdk-list-sizer":""},u)))}),Wn=r.forwardRef((t,n)=>{let{open:s,onOpenChange:o,overlayClassName:a,contentClassName:c,container:d,...l}=t;return r.createElement(Es,{open:s,onOpenChange:o},r.createElement(Ps,{container:d},r.createElement(Rs,{"cmdk-overlay":"",className:a}),r.createElement(Fs,{"aria-label":t.label,"cmdk-dialog":"",className:c},r.createElement(as,{ref:n,...l}))))}),Yn=r.forwardRef((t,n)=>ue(s=>s.filtered.count===0)?r.createElement(ne.div,{ref:n,...t,"cmdk-empty":"",role:"presentation"}):null),Jn=r.forwardRef((t,n)=>{let{progress:s,children:o,label:a="Loading...",...c}=t;return r.createElement(ne.div,{ref:n,...c,"cmdk-loading":"",role:"progressbar","aria-valuenow":s,"aria-valuemin":0,"aria-valuemax":100,"aria-label":a},We(t,d=>r.createElement("div",{"aria-hidden":!0},d)))}),Z=Object.assign(as,{List:Hn,Item:Vn,Input:Qn,Group:Bn,Separator:Un,Dialog:Wn,Empty:Yn,Loading:Jn});function Xn(t,n){let s=t.nextElementSibling;for(;s;){if(s.matches(n))return s;s=s.nextElementSibling}}function Zn(t,n){let s=t.previousElementSibling;for(;s;){if(s.matches(n))return s;s=s.previousElementSibling}}function os(t){let n=r.useRef(t);return xe(()=>{n.current=t}),n}var xe=typeof window>"u"?r.useEffect:r.useLayoutEffect;function ve(t){let n=r.useRef();return n.current===void 0&&(n.current=t()),n}function ue(t){let n=xt(),s=()=>t(n.snapshot());return r.useSyncExternalStore(n.subscribe,s,s)}function is(t,n,s,o=[]){let a=r.useRef(),c=Be();return xe(()=>{var d;let l=(()=>{var u;for(let x of s){if(typeof x=="string")return x.trim();if(typeof x=="object"&&"current"in x)return x.current?(u=x.current.textContent)==null?void 0:u.trim():a.current}})(),h=o.map(u=>u.trim());c.value(t,l,h),(d=n.current)==null||d.setAttribute(fe,l),a.current=l}),a}var er=()=>{let[t,n]=r.useState(),s=ve(()=>new Map);return xe(()=>{s.current.forEach(o=>o()),s.current=new Map},[t]),(o,a)=>{s.current.set(o,a),n({})}};function tr(t){let n=t.type;return typeof n=="function"?n(t.props):"render"in n?n.render(t.props):t}function We({asChild:t,children:n},s){return t&&r.isValidElement(n)?r.cloneElement(tr(n),{ref:n.ref},s(n.props.children)):s(n)}var sr={position:"absolute",width:"1px",height:"1px",padding:"0",margin:"-1px",overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",borderWidth:"0"};const ls=r.forwardRef(({className:t,...n},s)=>e.jsx(Z,{ref:s,className:le("flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground",t),...n}));ls.displayName=Z.displayName;const cs=r.forwardRef(({className:t,...n},s)=>e.jsxs("div",{className:"flex items-center border-b px-3","cmdk-input-wrapper":"",children:[e.jsx(Ts,{className:"mr-2 h-4 w-4 shrink-0 opacity-50"}),e.jsx(Z.Input,{ref:s,className:le("flex h-10 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50",t),...n})]}));cs.displayName=Z.Input.displayName;const ds=r.forwardRef(({className:t,...n},s)=>e.jsx(Z.List,{ref:s,className:le("max-h-[300px] overflow-y-auto overflow-x-hidden",t),...n}));ds.displayName=Z.List.displayName;const us=r.forwardRef((t,n)=>e.jsx(Z.Empty,{ref:n,className:"py-6 text-center text-sm",...t}));us.displayName=Z.Empty.displayName;const it=r.forwardRef(({className:t,...n},s)=>e.jsx(Z.Group,{ref:s,className:le("overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground",t),...n}));it.displayName=Z.Group.displayName;const nr=r.forwardRef(({className:t,...n},s)=>e.jsx(Z.Separator,{ref:s,className:le("-mx-1 h-px bg-border",t),...n}));nr.displayName=Z.Separator.displayName;const lt=r.forwardRef(({className:t,...n},s)=>e.jsx(Z.Item,{ref:s,className:le("relative flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected=true]:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",t),...n}));lt.displayName=Z.Item.displayName;const rr=({onBack:t,athletes:n,groups:s,athletesLoading:o})=>{const{toast:a}=se(),[c,d]=r.useState(""),[l,h]=r.useState(new Set),[u,x]=r.useState(new Set),[m,v]=r.useState(!1),{data:p}=U({queryKey:["athlete-phones"],queryFn:async()=>{const{data:N}=await ct.from("user_profiles").select("user_id, phone").not("phone","is",null);return new Map((N??[]).map(R=>[R.user_id,R.phone]))}}),i=r.useMemo(()=>n.filter(N=>N.id!=null).map(N=>({id:N.id,display_name:N.display_name,group_id:N.group_id??null,group_label:N.group_label??null})),[n]),f=N=>{h(R=>{const $=new Set(R);return $.has(N)?$.delete(N):$.add(N),$})},w=N=>{x(R=>{const $=new Set(R);return $.has(N)?$.delete(N):$.add(N),$})},j=()=>{h(new Set),x(new Set)},{selectedPhones:b,selectedTotal:L,missingCount:I}=r.useMemo(()=>{if(!p)return{selectedPhones:[],selectedTotal:0,missingCount:0};const N=new Set;for(const B of l)for(const F of i)F.group_id===B&&N.add(F.id);for(const B of u)N.add(B);const R=N.size,$=[];for(const B of N){const F=p.get(B);F&&F.trim().length>0&&$.push(F)}return{selectedPhones:$,selectedTotal:R,missingCount:R-$.length}},[l,u,i,p]),P=l.size+u.size,_=r.useMemo(()=>{const N=[];return l.size>0&&N.push(`${l.size} groupe${l.size>1?"s":""}`),u.size>0&&N.push(`${u.size} nageur${u.size>1?"s":""}`),N.join(", ")},[l.size,u.size]),E=()=>{if(b.length===0){a({title:"Aucun numéro",description:"Aucun nageur avec un numéro de téléphone dans cette sélection.",variant:"destructive"});return}if(/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)){const R=c.trim()?encodeURIComponent(c.trim()):"",$=/iPhone|iPad|iPod/i.test(navigator.userAgent);let B;if($){const F=b.join(",");B=R?`sms:/open?addresses=${F}&body=${R}`:`sms:/open?addresses=${F}`}else B=R?`sms:${b.join(",")}?body=${R}`:`sms:${b.join(",")}`;window.location.href=B}else navigator.clipboard.writeText(b.join(", ")).then(()=>{a({title:"Numéros copiés",description:`${b.length} numéro${b.length>1?"s":""} copié${b.length>1?"s":""} dans le presse-papiers.`})}).catch(()=>{a({title:"Erreur",description:"Impossible de copier les numéros.",variant:"destructive"})})},D=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent);return e.jsxs("div",{className:"space-y-6 pb-24",children:[e.jsx(ce,{title:"Envoyer un SMS",description:"Ouvre votre application SMS ou copie les numéros.",onBack:t}),e.jsxs(ke,{className:"border-l-4 border-l-primary",children:[e.jsxs(_e,{children:[e.jsx(Ae,{children:"Destinataires"}),e.jsx(Me,{children:"Sélectionnez des groupes et/ou des nageurs."})]}),e.jsxs(De,{className:"space-y-3",children:[e.jsx(Q,{children:"Destinataires"}),e.jsxs(En,{open:m,onOpenChange:v,children:[e.jsx(Pn,{asChild:!0,children:e.jsxs(K,{variant:"outline",role:"combobox","aria-expanded":m,className:"w-full justify-between font-normal",children:[e.jsx("span",{className:"truncate",children:P>0?_:o?"Chargement...":"Choisir des destinataires"}),e.jsx(Js,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),e.jsx(Zt,{className:"w-[var(--radix-popover-trigger-width)] p-0",align:"start",children:e.jsxs(ls,{children:[e.jsx(cs,{placeholder:"Rechercher..."}),e.jsxs(ds,{children:[e.jsx(us,{children:"Aucun résultat."}),s.length>0&&e.jsx(it,{heading:"Groupes",children:s.map(N=>e.jsxs(lt,{value:`groupe ${N.name}`,onSelect:()=>f(N.id),children:[e.jsx(bt,{className:le("mr-2 h-4 w-4",l.has(N.id)?"opacity-100":"opacity-0")}),N.name]},`group:${N.id}`))}),i.length>0&&e.jsx(it,{heading:"Nageurs",children:i.map(N=>e.jsxs(lt,{value:`nageur ${N.display_name} ${N.group_label??""}`,onSelect:()=>w(N.id),children:[e.jsx(bt,{className:le("mr-2 h-4 w-4",u.has(N.id)?"opacity-100":"opacity-0")}),e.jsx("span",{className:"truncate",children:N.display_name}),N.group_label&&e.jsx("span",{className:"ml-auto text-xs text-muted-foreground",children:N.group_label})]},`user:${N.id}`))})]})]})})]}),P>0&&e.jsxs("div",{className:"flex flex-wrap items-center gap-1.5",children:[[...l].map(N=>{const R=s.find($=>$.id===N);return R?e.jsxs(te,{variant:"secondary",className:"gap-1 pr-1",children:[R.name,e.jsx("button",{type:"button",onClick:()=>f(N),className:"ml-0.5 rounded-full p-0.5 hover:bg-muted",children:e.jsx(gt,{className:"h-3 w-3"})})]},`g:${N}`):null}),[...u].map(N=>{const R=i.find($=>$.id===N);return R?e.jsxs(te,{variant:"outline",className:"gap-1 pr-1",children:[R.display_name,e.jsx("button",{type:"button",onClick:()=>w(N),className:"ml-0.5 rounded-full p-0.5 hover:bg-muted",children:e.jsx(gt,{className:"h-3 w-3"})})]},`u:${N}`):null}),P>1&&e.jsx("button",{type:"button",onClick:j,className:"text-xs text-muted-foreground underline hover:text-foreground",children:"Tout effacer"})]}),P>0&&b.length>0&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:[b.length," numéro",b.length>1?"s":""," trouvé",b.length>1?"s":"",I>0&&e.jsxs("span",{className:"text-destructive",children:[" · ",I," sans téléphone"]})]}),P>0&&b.length===0&&e.jsx("p",{className:"text-xs text-destructive",children:"Aucun numéro de téléphone disponible pour cette sélection."})]})]}),e.jsxs(ke,{children:[e.jsxs(_e,{children:[e.jsx(Ae,{children:"Message"}),e.jsx(Me,{children:"Optionnel — pré-rempli dans votre application SMS."})]}),e.jsx(De,{children:e.jsx(ut,{value:c,onChange:N=>d(N.target.value),placeholder:"Contenu du SMS…",rows:3})})]}),e.jsx("div",{className:"sticky bottom-0 z-10 -mx-4 border-t bg-background/95 p-4 backdrop-blur sm:static sm:mx-0 sm:border-0 sm:p-0",children:e.jsx(K,{className:"w-full sm:w-auto",onClick:E,disabled:P===0||b.length===0,children:D?e.jsxs(e.Fragment,{children:[e.jsx(mt,{className:"mr-2 h-4 w-4"}),"Ouvrir dans l'app SMS",e.jsx(qt,{className:"ml-2 h-3 w-3"})]}):e.jsxs(e.Fragment,{children:[e.jsx($s,{className:"mr-2 h-4 w-4"}),"Copier les numéros"]})})})]})};function Ct(t){return String(t).padStart(2,"0")}function ge(t){return`${t.getFullYear()}-${Ct(t.getMonth()+1)}-${Ct(t.getDate())}`}function Ze(t){return new Date(t.getFullYear(),t.getMonth(),1)}function St(t,n){const s=new Date(t);return s.setDate(s.getDate()+n),s}function ar(t){return(t.getDay()+6)%7}function et(t){if(!t)return"AM";const n=t.toLowerCase();return n==="evening"||n.includes("soir")||n==="pm"?"PM":"AM"}const or=[{key:"swim-morning",label:"Nage — Matin",type:"swim",scheduledSlot:"morning"},{key:"swim-evening",label:"Nage — Soir",type:"swim",scheduledSlot:"evening"},{key:"strength",label:"Musculation",type:"strength",scheduledSlot:null}];function ir({groupId:t,userId:n,enabled:s}){const o=r.useMemo(()=>new Date,[]),[a,c]=r.useState(()=>Ze(new Date)),[d,l]=r.useState(()=>ge(new Date)),[h,u]=r.useState(null),[x,m]=r.useState(!1),v=r.useMemo(()=>Ze(a),[a]),p=r.useMemo(()=>{const y=ar(v),T=St(v,-y),q=[];for(let G=0;G<42;G++)q.push(St(T,G));return q},[v]),i=r.useMemo(()=>{const y=ge(p[0]),T=ge(p[p.length-1]);return{from:y,to:T}},[p]),f=!!(t||n),{data:w=[],isLoading:j}=U({queryKey:["coach-calendar-assignments",t,n,i.from,i.to],queryFn:()=>O.getCoachAssignments({groupId:t??null,userId:n??null,from:i.from,to:i.to}),enabled:f}),b=r.useMemo(()=>{const y=new Map;for(const T of w){const q=T.scheduledDate?.slice(0,10);q&&(y.has(q)||y.set(q,[]),y.get(q).push(T))}return y},[w]),L=r.useMemo(()=>{const y={};for(const T of p){const q=ge(T),G=b.get(q)??[],ee=G.some(A=>et(A.scheduledSlot)==="AM"),M=G.some(A=>et(A.scheduledSlot)==="PM"),H=(ee?1:0)+(M?1:0),g=[{slotKey:"AM",expected:ee,completed:ee,absent:!1},{slotKey:"PM",expected:M,completed:M,absent:!1}];y[q]={completed:H,total:H,slots:g}}return y},[p,b]),I=r.useMemo(()=>{const[y,T,q]=d.split("-").map(Number);return new Date(y,T-1,q)},[d]),P=r.useMemo(()=>b.get(d)??[],[b,d]),_=r.useMemo(()=>{const y=P;return or.map(T=>{const q=y.filter(M=>T.type!==M.type?!1:T.type==="swim"?et(M.scheduledSlot)===(T.scheduledSlot==="morning"?"AM":"PM"):!0),G=q.find(M=>M.targetType==="user"),ee=q.find(M=>M.targetType==="group");return{...T,assignment:G??ee??null}})},[P]),{data:E=[]}=U({queryKey:["planned-absences-coach",n,i.from,i.to],queryFn:()=>O.getPlannedAbsences({userId:n,from:i.from,to:i.to}),enabled:!!n}),D=r.useMemo(()=>new Set(E.map(y=>y.date)),[E]),N=r.useMemo(()=>{const y={};for(const T of p){const q=ge(T),G=b.get(q)??[];y[q]=G.some(ee=>ee.type==="strength")}return y},[p,b]),R=L[d]??{completed:0,total:0,slots:[{slotKey:"AM",expected:!1,completed:!1,absent:!1},{slotKey:"PM",expected:!1,completed:!1,absent:!1}]},$=r.useCallback(()=>{c(y=>new Date(y.getFullYear(),y.getMonth()-1,1))},[]),B=r.useCallback(()=>{c(y=>new Date(y.getFullYear(),y.getMonth()+1,1))},[]),F=r.useCallback(()=>{c(Ze(new Date)),l(ge(new Date))},[]),k=r.useCallback(y=>{l(y),m(!0)},[]);return{today:o,monthCursor:a,selectedISO:d,selectedDayIndex:h,drawerOpen:x,gridDates:p,completionByISO:L,selectedDate:I,selectedDayStatus:R,assignmentsForSelectedDay:P,slotsForSelectedDay:_,hasStrengthByISO:N,absenceDates:D,isLoading:j,hasFilter:f,setSelectedISO:l,setSelectedDayIndex:u,setDrawerOpen:m,prevMonth:$,nextMonth:B,jumpToday:F,openDay:k}}function lr(t){const[n,s,o]=t.split("-").map(Number);return new Date(n,s-1,o).toLocaleDateString("fr-FR",{weekday:"long",day:"numeric",month:"long"})}function cr({onBack:t,athletes:n,groups:s,swimSessions:o,strengthSessions:a}){const[c,d]=r.useState("group"),[l,h]=r.useState(""),[u,x]=r.useState(""),m=c==="group"&&l?Number(l):null,v=c==="user"&&u?Number(u):null,{today:p,monthCursor:i,selectedISO:f,selectedDayIndex:w,drawerOpen:j,gridDates:b,completionByISO:L,selectedDayStatus:I,slotsForSelectedDay:P,hasStrengthByISO:_,absenceDates:E,hasFilter:D,setSelectedISO:N,setSelectedDayIndex:R,setDrawerOpen:$,prevMonth:B,nextMonth:F,jumpToday:k,openDay:y}=ir({groupId:m,userId:v,enabled:!0}),T=qe(),q=X({mutationFn:M=>O.assignments_create(M),onSuccess:()=>{T.invalidateQueries({queryKey:["coach-calendar-assignments"]})}}),G=X({mutationFn:M=>O.assignments_delete(M),onSuccess:()=>{T.invalidateQueries({queryKey:["coach-calendar-assignments"]})}}),ee=(M,H)=>{let g=H;if(M.key==="ArrowLeft"&&(g=Math.max(0,H-1)),M.key==="ArrowRight"&&(g=Math.min(b.length-1,H+1)),M.key==="ArrowUp"&&(g=Math.max(0,H-7)),M.key==="ArrowDown"&&(g=Math.min(b.length-1,H+7)),g!==H){M.preventDefault(),R(g);const A=z=>String(z).padStart(2,"0"),C=b[g],S=`${C.getFullYear()}-${A(C.getMonth()+1)}-${A(C.getDate())}`;N(S)}if(M.key==="Enter"||M.key===" "){M.preventDefault();const A=z=>String(z).padStart(2,"0"),C=b[H],S=`${C.getFullYear()}-${A(C.getMonth()+1)}-${A(C.getDate())}`;y(S)}};return e.jsxs("div",{className:"space-y-4",children:[e.jsx(ce,{title:"Calendrier",description:"Vue mensuelle des assignations",onBack:t}),e.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center",children:[e.jsxs(dt,{type:"single",value:c,onValueChange:M=>{(M==="group"||M==="user")&&d(M)},className:"shrink-0",children:[e.jsx(de,{value:"group",className:"text-xs px-3",children:"Groupe"}),e.jsx(de,{value:"user",className:"text-xs px-3",children:"Nageur"})]}),c==="group"?e.jsxs(re,{value:l,onValueChange:h,children:[e.jsx(ae,{className:"w-full sm:w-56",children:e.jsx(oe,{placeholder:"Choisir un groupe"})}),e.jsx(ie,{children:s.map(M=>e.jsx(J,{value:String(M.id),children:M.name},String(M.id)))})]}):e.jsxs(re,{value:u,onValueChange:x,children:[e.jsx(ae,{className:"w-full sm:w-56",children:e.jsx(oe,{placeholder:"Choisir un nageur"})}),e.jsx(ie,{children:n.filter(M=>M.id!=null).map(M=>e.jsxs(J,{value:String(M.id),children:[M.display_name,M.group_label?` · ${M.group_label}`:""]},String(M.id)))})]})]}),D?e.jsxs("div",{className:"rounded-2xl border bg-card shadow-sm",children:[e.jsx(Os,{monthCursor:i,selectedDayStatus:I,onPrevMonth:B,onNextMonth:F,onJumpToday:k}),e.jsx(Is,{monthCursor:i,gridDates:b,completionByISO:L,strengthByISO:_,absenceDates:E,selectedISO:f,selectedDayIndex:w,today:p,onDayClick:y,onKeyDown:ee})]}):e.jsx("div",{className:"py-12 text-center text-sm text-muted-foreground",children:"Sélectionnez un groupe ou un nageur pour afficher le calendrier."}),e.jsx(ze,{open:j,onOpenChange:$,children:e.jsxs(Le,{side:"bottom",className:"max-h-[70vh] overflow-y-auto rounded-t-2xl",children:[e.jsxs(Ke,{className:"pb-3",children:[e.jsx(Ge,{className:"capitalize text-left",children:lr(f)}),e.jsx(pt,{className:"sr-only",children:"Gérer les assignations pour cette journée"})]}),e.jsxs("div",{className:"space-y-3",children:[E.has(f)&&e.jsx("div",{className:"rounded-xl border border-red-200 bg-red-50 dark:bg-red-950/20 dark:border-red-900/40 px-3 py-2 flex items-center gap-2",children:e.jsx("span",{className:"text-[10px] font-bold text-red-500 uppercase tracking-wide",children:"Absence prévue"})}),P.map(M=>{const H=M.assignment?.targetType==="group",g=c==="user";return e.jsx(dr,{slot:M,swimSessions:o,strengthSessions:a,isGroupAssignment:H&&g,onAssign:A=>{q.mutate({assignment_type:M.type,session_id:A,scheduled_date:f,scheduled_slot:M.scheduledSlot??void 0,target_group_id:m,target_user_id:v})},onDelete:A=>{G.mutate(A)},onReplace:(A,C)=>{H&&g?q.mutate({assignment_type:M.type,session_id:C,scheduled_date:f,scheduled_slot:M.scheduledSlot??void 0,target_user_id:v}):G.mutate(A,{onSuccess:()=>{q.mutate({assignment_type:M.type,session_id:C,scheduled_date:f,scheduled_slot:M.scheduledSlot??void 0,target_group_id:m,target_user_id:v})}})},isPending:q.isPending||G.isPending},M.key)})]})]})})]})}function dr({slot:t,swimSessions:n,strengthSessions:s,isGroupAssignment:o,onAssign:a,onDelete:c,onReplace:d,isPending:l}){const[h,u]=r.useState(!1),x=t.type==="swim",m=x?(n??[]).map(i=>({id:i.id,label:i.name})):(s??[]).map(i=>({id:i.id,label:i.title})),v=t.assignment!==null,p=i=>{const f=Number(i);f&&(v&&h?(d(t.assignment.id,f),u(!1)):a(f))};return e.jsxs("div",{className:"rounded-xl border p-3 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[x?e.jsx(Pt,{className:"h-4 w-4 text-blue-500 shrink-0"}):e.jsx(Rt,{className:"h-4 w-4 text-orange-500 shrink-0"}),e.jsx("span",{className:"text-xs font-semibold text-muted-foreground uppercase tracking-wide",children:t.label})]}),v&&!h?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("p",{className:"text-sm font-semibold truncate flex-1",children:[t.assignment.title,o&&e.jsx("span",{className:"ml-1.5 text-[10px] font-medium text-muted-foreground bg-muted px-1.5 py-0.5 rounded-full align-middle",children:"Groupe"})]}),e.jsx(K,{type:"button",size:"icon",variant:"ghost",className:"h-7 w-7 shrink-0",disabled:l,onClick:()=>u(!0),title:o?"Personnaliser":"Changer",children:e.jsx(ys,{className:"h-3.5 w-3.5"})}),!o&&e.jsx(K,{type:"button",size:"icon",variant:"ghost",className:"h-7 w-7 shrink-0 text-destructive hover:text-destructive",disabled:l,onClick:()=>c(t.assignment.id),title:"Supprimer",children:e.jsx(Ot,{className:"h-3.5 w-3.5"})})]}):e.jsxs(re,{value:"",onValueChange:p,disabled:l||m.length===0,children:[e.jsx(ae,{className:"h-9 text-xs",children:e.jsx(oe,{placeholder:h?o?"Personnaliser pour ce nageur":"Choisir le remplacement":"Choisir une séance"})}),e.jsx(ie,{children:m.map(i=>e.jsx(J,{value:String(i.id),children:i.label},i.id))})]}),h?e.jsx("button",{type:"button",className:"text-xs text-muted-foreground hover:text-foreground",onClick:()=>u(!1),children:"Annuler"}):null]})}const ms=({athletes:t,selected:n,onToggle:s,filterToUserIds:o})=>{const[a,c]=r.useState(""),d=r.useMemo(()=>{let h=t.filter(u=>u.id!=null);if(o&&(h=h.filter(u=>o.has(u.id))),a.trim()){const u=a.toLowerCase();h=h.filter(x=>x.display_name.toLowerCase().includes(u))}return h},[t,o,a]),l=r.useMemo(()=>{const h=new Map;for(const u of d){const x=u.group_label||"Sans groupe";h.has(x)||h.set(x,[]),h.get(x).push(u)}return[...h.entries()].sort(([u],[x])=>u.localeCompare(x,"fr"))},[d]);return e.jsxs("div",{className:"space-y-3",children:[e.jsx(je,{placeholder:"Rechercher un nageur...",value:a,onChange:h=>c(h.target.value)}),e.jsxs("div",{className:"max-h-[50vh] overflow-y-auto space-y-3",children:[l.map(([h,u])=>e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-semibold uppercase tracking-wider text-muted-foreground mb-1.5",children:h}),e.jsx("div",{className:"space-y-1",children:u.map(x=>e.jsxs("label",{className:"flex items-center gap-2.5 rounded-lg border px-3 py-2 cursor-pointer hover:bg-muted/50 transition-colors",children:[e.jsx(It,{checked:n.has(x.id),onCheckedChange:()=>s(x.id)}),e.jsx("span",{className:"text-sm",children:x.display_name})]},x.id))})]},h)),l.length===0&&e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"Aucun nageur trouvé."})]}),n.size>0&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:[n.size," nageur",n.size>1?"s":""," ","sélectionné",n.size>1?"s":""]})]})},ps=({open:t,onOpenChange:n,athletes:s,parentGroupId:o,parentMembers:a,onCreated:c})=>{const{toast:d}=se(),[l,h]=r.useState(""),[u,x]=r.useState(new Set),m=i=>{x(f=>{const w=new Set(f);return w.has(i)?w.delete(i):w.add(i),w})},v=X({mutationFn:()=>O.createTemporaryGroup({name:l.trim(),member_user_ids:[...u],parent_group_id:o??void 0}),onSuccess:()=>{d({title:"Groupe créé",description:`Le groupe "${l.trim()}" a été créé avec ${u.size} nageur${u.size>1?"s":""}.`}),h(""),x(new Set),n(!1),c()},onError:i=>{d({title:"Erreur",description:i.message,variant:"destructive"})}}),p=()=>{if(!l.trim()){d({title:"Nom requis",description:"Veuillez saisir un nom pour le groupe.",variant:"destructive"});return}v.mutate()};return e.jsx(ze,{open:t,onOpenChange:n,children:e.jsxs(Le,{side:"right",className:"w-full sm:max-w-md overflow-y-auto",children:[e.jsxs(Ke,{children:[e.jsx(Ge,{children:o?"Créer un sous-groupe":"Créer un groupe"}),e.jsx(pt,{children:o?"Sélectionnez des nageurs du groupe parent pour ce sous-groupe.":"Créez un groupe temporaire (stage, compétition) avec des nageurs de différents groupes."})]}),e.jsxs("div",{className:"mt-6 space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(Q,{htmlFor:"group-name",children:"Nom du groupe"}),e.jsx(je,{id:"group-name",placeholder:"Ex : Stage Pâques 2026",value:l,onChange:i=>h(i.target.value)})]}),e.jsx(zs,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Q,{children:"Nageurs"}),e.jsx(ms,{athletes:s,selected:u,onToggle:m,filterToUserIds:a??null})]}),e.jsx(K,{className:"w-full",onClick:p,disabled:v.isPending||!l.trim(),children:v.isPending?"Création...":"Créer le groupe"})]})]})})},ur=({open:t,onOpenChange:n,groupId:s,athletes:o,existingMemberIds:a,onAdded:c})=>{const{toast:d}=se(),[l,h]=r.useState(new Set),u=r.useMemo(()=>o.filter(v=>v.id!=null&&!a.has(v.id)),[o,a]),x=v=>{h(p=>{const i=new Set(p);return i.has(v)?i.delete(v):i.add(v),i})},m=X({mutationFn:()=>O.addTemporaryGroupMembers(s,[...l]),onSuccess:()=>{d({title:"Nageurs ajoutés",description:`${l.size} nageur${l.size>1?"s":""} ajouté${l.size>1?"s":""}.`}),h(new Set),n(!1),c()},onError:v=>{d({title:"Erreur",description:v.message,variant:"destructive"})}});return e.jsx(ze,{open:t,onOpenChange:n,children:e.jsxs(Le,{side:"right",className:"w-full sm:max-w-md overflow-y-auto",children:[e.jsxs(Ke,{children:[e.jsx(Ge,{children:"Ajouter des nageurs"}),e.jsx(pt,{children:"Sélectionnez les nageurs à ajouter au groupe."})]}),e.jsxs("div",{className:"mt-6 space-y-4",children:[e.jsx(ms,{athletes:u,selected:l,onToggle:x}),e.jsx(K,{className:"w-full",onClick:()=>m.mutate(),disabled:m.isPending||l.size===0,children:m.isPending?"Ajout...":`Ajouter ${l.size} nageur${l.size>1?"s":""}`})]})]})})},mr=({groupId:t,athletes:n,onBack:s})=>{const{toast:o}=se(),a=qe(),[c,d]=r.useState(!1),[l,h]=r.useState(!1),[u,x]=r.useState(null),{data:m,isLoading:v}=U({queryKey:["temp-group-detail",t],queryFn:()=>O.getTemporaryGroupDetail(t)}),p=X({mutationFn:j=>O.removeTemporaryGroupMember(t,j),onSuccess:()=>{o({title:"Nageur retiré"}),a.invalidateQueries({queryKey:["temp-group-detail",t]}),a.invalidateQueries({queryKey:["temp-groups"]})},onError:j=>{o({title:"Erreur",description:j.message,variant:"destructive"})}}),i=()=>{a.invalidateQueries({queryKey:["temp-group-detail",t]}),a.invalidateQueries({queryKey:["temp-groups"]})},f=r.useMemo(()=>new Set((m?.members??[]).map(j=>j.user_id)),[m]),w=r.useMemo(()=>new Set((m?.members??[]).map(j=>j.user_id)),[m]);return v?e.jsxs("div",{className:"space-y-4",children:[e.jsxs(K,{variant:"ghost",size:"sm",className:"-ml-2",onClick:s,children:[e.jsx(Qe,{className:"mr-2 h-4 w-4"}),"Retour aux groupes"]}),e.jsx("div",{className:"space-y-2",children:[1,2,3].map(j=>e.jsx("div",{className:"rounded-xl border p-3 animate-pulse motion-reduce:animate-none",children:e.jsx("div",{className:"h-4 w-32 rounded bg-muted"})},j))})]}):m?e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs(K,{variant:"ghost",size:"sm",className:"-ml-2",onClick:s,children:[e.jsx(Qe,{className:"mr-2 h-4 w-4"}),"Retour aux groupes"]}),e.jsx("h2",{className:"text-2xl font-display font-semibold uppercase italic text-primary",children:m.name}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(te,{variant:m.is_active?"default":"secondary",children:m.is_active?"Actif":"Terminé"}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:[m.members.length," membre",m.members.length!==1?"s":""]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-xs font-semibold uppercase tracking-[0.15em] text-muted-foreground",children:"Membres"}),m.is_active&&e.jsxs(K,{size:"sm",variant:"outline",onClick:()=>d(!0),children:[e.jsx(Vs,{className:"mr-1.5 h-3.5 w-3.5"}),"Ajouter"]})]}),m.members.length===0?e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"Aucun membre dans ce groupe."}):e.jsx("div",{className:"space-y-1.5",children:m.members.map(j=>e.jsxs("div",{className:"flex items-center gap-3 rounded-xl border bg-card p-3",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-sm font-semibold truncate",children:j.display_name}),j.permanent_group_label&&e.jsx(te,{variant:"secondary",className:"text-[10px] px-1.5 py-0 mt-0.5",children:j.permanent_group_label})]}),m.is_active&&e.jsx(K,{size:"icon",variant:"ghost",className:"h-8 w-8 text-muted-foreground hover:text-destructive",onClick:()=>x({userId:j.user_id,name:j.display_name}),title:"Retirer du groupe",children:e.jsx(Bs,{className:"h-4 w-4"})})]},j.user_id))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-xs font-semibold uppercase tracking-[0.15em] text-muted-foreground",children:"Sous-groupes"}),m.is_active&&e.jsxs(K,{size:"sm",variant:"outline",onClick:()=>h(!0),children:[e.jsx(he,{className:"mr-1.5 h-3.5 w-3.5"}),"Sous-groupe"]})]}),m.subgroups.length===0?e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"Aucun sous-groupe."}):e.jsx("div",{className:"space-y-2",children:m.subgroups.map(j=>e.jsxs(Ls,{children:[e.jsxs(Ks,{className:"flex w-full items-center justify-between rounded-xl border bg-card p-3 text-left hover:bg-muted/50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Lt,{className:"h-4 w-4 text-primary"}),e.jsx("span",{className:"text-sm font-semibold",children:j.name}),e.jsx(te,{variant:"secondary",className:"text-[10px] px-1.5 py-0",children:j.members.length})]}),e.jsx(Us,{className:"h-4 w-4 text-muted-foreground transition-transform [[data-state=open]_&]:rotate-180"})]}),e.jsx(Gs,{children:e.jsxs("div",{className:"ml-4 mt-1 space-y-1",children:[j.members.map(b=>e.jsx("div",{className:"flex items-center gap-2 rounded-lg border px-3 py-2",children:e.jsx("span",{className:"text-sm",children:b.display_name})},b.user_id)),j.members.length===0&&e.jsx("p",{className:"text-xs text-muted-foreground py-2",children:"Aucun membre."})]})})]},j.id))})]}),e.jsx(ur,{open:c,onOpenChange:d,groupId:t,athletes:n,existingMemberIds:f,onAdded:i}),e.jsx(ps,{open:l,onOpenChange:h,athletes:n,parentGroupId:t,parentMembers:w,onCreated:i}),e.jsx(Ee,{open:!!u,onOpenChange:j=>{j||x(null)},children:e.jsxs(Pe,{children:[e.jsxs(Re,{children:[e.jsx(Fe,{children:"Retirer du groupe"}),e.jsxs(Te,{children:["Voulez-vous retirer ",u?.name," de ce groupe ?",m.subgroups.length>0?" Le nageur sera aussi retiré des sous-groupes.":""]})]}),e.jsxs($e,{children:[e.jsx(Oe,{children:"Annuler"}),e.jsx(Ie,{onClick:()=>{u&&(p.mutate(u.userId),x(null))},className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Retirer"})]})]})})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs(K,{variant:"ghost",size:"sm",className:"-ml-2",onClick:s,children:[e.jsx(Qe,{className:"mr-2 h-4 w-4"}),"Retour aux groupes"]}),e.jsx("p",{className:"text-sm text-muted-foreground text-center py-8",children:"Groupe introuvable."})]})},kt=({group:t,onManage:n,onDeactivate:s,onReactivate:o,onDelete:a})=>{const c=new Date(t.created_at).toLocaleDateString("fr-FR",{day:"numeric",month:"short",year:"numeric"});return e.jsxs("div",{className:"rounded-xl border bg-card p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-sm font-bold truncate",children:t.name}),e.jsxs("div",{className:"flex items-center gap-2 mt-1 flex-wrap",children:[e.jsxs("span",{className:"text-xs text-muted-foreground",children:[t.member_count," membre",t.member_count!==1?"s":""]}),t.subgroup_count>0&&e.jsxs("span",{className:"text-xs text-muted-foreground",children:[t.subgroup_count," sous-groupe",t.subgroup_count!==1?"s":""]}),e.jsx("span",{className:"text-xs text-muted-foreground",children:c})]})]}),e.jsx(te,{variant:t.is_active?"default":"secondary",children:t.is_active?"Actif":"Terminé"})]}),e.jsx("div",{className:"flex items-center gap-2 flex-wrap",children:t.is_active?e.jsxs(e.Fragment,{children:[e.jsxs(K,{size:"sm",variant:"outline",onClick:()=>n(t.id),children:[e.jsx(Ns,{className:"mr-1.5 h-3.5 w-3.5"}),"Gérer"]}),e.jsxs(K,{size:"sm",variant:"outline",onClick:()=>s(t.id),children:[e.jsx(qs,{className:"mr-1.5 h-3.5 w-3.5"}),"Terminer"]})]}):e.jsxs(e.Fragment,{children:[e.jsxs(K,{size:"sm",variant:"outline",onClick:()=>o(t.id),children:[e.jsx(ws,{className:"mr-1.5 h-3.5 w-3.5"}),"Réactiver"]}),e.jsxs(K,{size:"sm",variant:"outline",className:"text-destructive hover:text-destructive",onClick:()=>a(t.id),children:[e.jsx(Ot,{className:"mr-1.5 h-3.5 w-3.5"}),"Supprimer"]})]})})]})},pr=({onBack:t,athletes:n,athletesLoading:s})=>{const{toast:o}=se(),a=qe(),[c,d]=r.useState("list"),[l,h]=r.useState(null),[u,x]=r.useState(!1),[m,v]=r.useState(null),[p,i]=r.useState(null),{data:f=[],isLoading:w}=U({queryKey:["temp-groups"],queryFn:()=>O.getTemporaryGroups()}),j=r.useMemo(()=>f.filter(D=>D.is_active),[f]),b=r.useMemo(()=>f.filter(D=>!D.is_active),[f]),L=X({mutationFn:D=>O.deactivateTemporaryGroup(D),onSuccess:()=>{o({title:"Groupe terminé"}),a.invalidateQueries({queryKey:["temp-groups"]})},onError:D=>{o({title:"Erreur",description:D.message,variant:"destructive"})}}),I=X({mutationFn:D=>O.reactivateTemporaryGroup(D),onSuccess:()=>{o({title:"Groupe réactivé"}),a.invalidateQueries({queryKey:["temp-groups"]})},onError:D=>{o({title:"Erreur",description:D.message,variant:"destructive"})}}),P=X({mutationFn:D=>O.deleteTemporaryGroup(D),onSuccess:()=>{o({title:"Groupe supprimé"}),a.invalidateQueries({queryKey:["temp-groups"]})},onError:D=>{o({title:"Erreur",description:D.message,variant:"destructive"})}}),_=D=>{h(D),d("detail")},E=()=>{h(null),d("list"),a.invalidateQueries({queryKey:["temp-groups"]})};return c==="detail"&&l!=null?e.jsx(mr,{groupId:l,athletes:n,onBack:E}):e.jsxs("div",{className:"space-y-6 pb-24",children:[e.jsx(ce,{title:"Groupes temporaires",description:"Créez et gérez des groupes pour les stages, compétitions ou événements.",onBack:t,actions:e.jsxs(K,{size:"sm",onClick:()=>x(!0),children:[e.jsx(he,{className:"mr-1.5 h-3.5 w-3.5"}),"Créer un groupe"]})}),w||s?e.jsx("div",{className:"space-y-2",children:[1,2,3].map(D=>e.jsx("div",{className:"rounded-xl border p-4 animate-pulse motion-reduce:animate-none",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-4 w-40 rounded bg-muted"}),e.jsx("div",{className:"ml-auto h-6 w-16 rounded bg-muted"})]})},D))}):f.length===0?e.jsxs("div",{className:"text-center py-12 space-y-3",children:[e.jsx(ye,{className:"h-10 w-10 text-muted-foreground mx-auto"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Aucun groupe temporaire pour le moment."}),e.jsxs(K,{variant:"outline",size:"sm",onClick:()=>x(!0),children:[e.jsx(he,{className:"mr-1.5 h-3.5 w-3.5"}),"Créer le premier groupe"]})]}):e.jsxs(e.Fragment,{children:[j.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h3",{className:"text-xs font-semibold uppercase tracking-[0.15em] text-muted-foreground",children:["Actifs (",j.length,")"]}),j.map(D=>e.jsx(kt,{group:D,onManage:_,onDeactivate:N=>v(N),onReactivate:N=>I.mutate(N),onDelete:N=>i(N)},D.id))]}),b.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h3",{className:"text-xs font-semibold uppercase tracking-[0.15em] text-muted-foreground",children:["Terminés (",b.length,")"]}),b.map(D=>e.jsx(kt,{group:D,onManage:_,onDeactivate:N=>v(N),onReactivate:N=>I.mutate(N),onDelete:N=>i(N)},D.id))]})]}),e.jsx(ps,{open:u,onOpenChange:x,athletes:n,onCreated:()=>{a.invalidateQueries({queryKey:["temp-groups"]})}}),e.jsx(Ee,{open:m!=null,onOpenChange:D=>{D||v(null)},children:e.jsxs(Pe,{children:[e.jsxs(Re,{children:[e.jsx(Fe,{children:"Terminer le groupe"}),e.jsx(Te,{children:"Voulez-vous marquer ce groupe comme terminé ? Les sous-groupes seront aussi désactivés. Vous pourrez le réactiver plus tard si nécessaire."})]}),e.jsxs($e,{children:[e.jsx(Oe,{children:"Annuler"}),e.jsx(Ie,{onClick:()=>{m!=null&&(L.mutate(m),v(null))},children:"Terminer"})]})]})}),e.jsx(Ee,{open:p!=null,onOpenChange:D=>{D||i(null)},children:e.jsxs(Pe,{children:[e.jsxs(Re,{children:[e.jsx(Fe,{children:"Supprimer le groupe"}),e.jsx(Te,{children:"Cette action est irréversible. Le groupe et tous ses sous-groupes seront supprimés définitivement."})]}),e.jsxs($e,{children:[e.jsx(Oe,{children:"Annuler"}),e.jsx(Ie,{onClick:()=>{p!=null&&(P.mutate(p),i(null))},className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Supprimer"})]})]})})]})};function tt(t){return new Date(t+"T00:00:00").toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric"})}function hr(t){const n=new Date;n.setHours(0,0,0,0);const s=new Date(t+"T00:00:00");return Math.ceil((s.getTime()-n.getTime())/(1e3*60*60*24))}const xr=({open:t,onOpenChange:n,competition:s})=>{const{toast:o}=se(),a=qe(),c=!!s,[d,l]=r.useState(""),[h,u]=r.useState(""),[x,m]=r.useState(""),[v,p]=r.useState(!0),[i,f]=r.useState(""),[w,j]=r.useState(""),[b,L]=r.useState(!1),[I,P]=r.useState(new Set),{data:_=[]}=U({queryKey:["athletes"],queryFn:()=>O.getAthletes()}),{data:E=[]}=U({queryKey:["groups"],queryFn:()=>O.getGroups()}),{data:D}=U({queryKey:["competition-assignments",s?.id],queryFn:()=>O.getCompetitionAssignments(s.id),enabled:!!s?.id});r.useEffect(()=>{t&&(s?(l(s.name),u(s.date),m(s.end_date??""),p(!!s.end_date),f(s.location??""),j(s.description??""),D&&P(new Set(D.map(k=>k.athlete_id)))):(l(""),u(""),m(""),p(!0),f(""),j(""),P(new Set)))},[t,s,D]);const N=X({mutationFn:k=>O.createCompetition(k),onSuccess:async k=>{if(I.size>0)try{await O.setCompetitionAssignments(k.id,Array.from(I))}catch(y){console.warn("[EAC] Failed to save competition assignments:",y)}o({title:"Competition creee"}),a.invalidateQueries({queryKey:["competitions"]}),a.invalidateQueries({queryKey:["competition-assignments"]}),n(!1)},onError:k=>{o({title:"Erreur",description:k.message,variant:"destructive"})}}),R=X({mutationFn:k=>O.updateCompetition(s.id,k),onSuccess:async()=>{try{await O.setCompetitionAssignments(s.id,Array.from(I))}catch(k){console.warn("[EAC] Failed to save competition assignments:",k)}o({title:"Competition mise a jour"}),a.invalidateQueries({queryKey:["competitions"]}),a.invalidateQueries({queryKey:["competition-assignments"]}),n(!1)},onError:k=>{o({title:"Erreur",description:k.message,variant:"destructive"})}}),$=X({mutationFn:()=>O.deleteCompetition(s.id),onSuccess:()=>{o({title:"Competition supprimee"}),a.invalidateQueries({queryKey:["competitions"]}),n(!1)},onError:k=>{o({title:"Erreur",description:k.message,variant:"destructive"})}}),B=()=>{if(!d.trim()){o({title:"Nom requis",description:"Veuillez saisir un nom pour la competition.",variant:"destructive"});return}if(!h){o({title:"Date requise",description:"Veuillez saisir une date.",variant:"destructive"});return}const k={name:d.trim(),date:h,end_date:v&&x?x:null,location:i.trim()||null,description:w.trim()||null};c?R.mutate(k):N.mutate(k)},F=N.isPending||R.isPending||$.isPending;return e.jsxs(e.Fragment,{children:[e.jsx(ze,{open:t,onOpenChange:n,children:e.jsxs(Le,{side:"right",className:"w-full sm:max-w-md overflow-y-auto",children:[e.jsx(Ke,{children:e.jsx(Ge,{children:c?"Modifier la competition":"Nouvelle competition"})}),e.jsxs("div",{className:"mt-6 space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(Q,{htmlFor:"comp-name",children:"Nom *"}),e.jsx(je,{id:"comp-name",placeholder:"Ex : Championnats Regionaux",value:d,onChange:k=>l(k.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Q,{htmlFor:"comp-date",children:"Date *"}),e.jsx("input",{id:"comp-date",type:"date",value:h,onChange:k=>u(k.target.value),className:"flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(Q,{htmlFor:"comp-multiday",children:"Multi-jours"}),e.jsx(Qs,{id:"comp-multiday",checked:v,onCheckedChange:p})]}),v&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(Q,{htmlFor:"comp-end-date",children:"Date de fin"}),e.jsx("input",{id:"comp-end-date",type:"date",value:x,onChange:k=>m(k.target.value),min:h||void 0,className:"flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Q,{htmlFor:"comp-location",children:"Lieu"}),e.jsx(je,{id:"comp-location",placeholder:"Ex : Piscine de Strasbourg",value:i,onChange:k=>f(k.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Q,{htmlFor:"comp-description",children:"Description"}),e.jsx(ut,{id:"comp-description",placeholder:"Notes, informations complementaires...",value:w,onChange:k=>j(k.target.value),rows:3})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ye,{className:"h-4 w-4 text-muted-foreground"}),e.jsx(Q,{children:"Nageurs assignes"})]}),e.jsxs(re,{value:"",onValueChange:k=>{const y=_.filter(T=>T.group_id===Number(k));P(T=>{const q=new Set(T);return y.forEach(G=>{G.id!=null&&q.add(G.id)}),q})},children:[e.jsx(ae,{children:e.jsx(oe,{placeholder:"Ajouter un groupe..."})}),e.jsx(ie,{children:E.filter(k=>!k.is_temporary).map(k=>e.jsx(J,{value:String(k.id),children:k.name},k.id))})]}),e.jsx("div",{className:"max-h-48 overflow-y-auto rounded-md border p-2 space-y-1",children:_.map(k=>{if(k.id==null)return null;const y=I.has(k.id);return e.jsxs("label",{className:"flex items-center gap-2 py-1 px-1 rounded hover:bg-muted/50 cursor-pointer",children:[e.jsx(It,{checked:y,onCheckedChange:T=>{P(q=>{const G=new Set(q);return T?G.add(k.id):G.delete(k.id),G})}}),e.jsx("span",{className:"text-sm",children:k.display_name}),k.group_label&&e.jsx("span",{className:"text-xs text-muted-foreground ml-auto",children:k.group_label})]},k.id)})}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[I.size," nageur",I.size>1?"s":""," assigne",I.size>1?"s":""]})]}),e.jsxs("div",{className:"space-y-2 pt-2",children:[e.jsx(K,{className:"w-full",onClick:B,disabled:F||!d.trim()||!h,children:F?"Enregistrement...":c?"Enregistrer":"Creer"}),c&&e.jsx(K,{variant:"outline",className:"w-full text-destructive hover:text-destructive",onClick:()=>L(!0),disabled:F,children:"Supprimer cette competition"})]})]})]})}),e.jsx(Ee,{open:b,onOpenChange:L,children:e.jsxs(Pe,{children:[e.jsxs(Re,{children:[e.jsx(Fe,{children:"Supprimer la competition"}),e.jsxs(Te,{children:["Cette action est irreversible. La competition «"," ",s?.name," » sera supprimee definitivement."]})]}),e.jsxs($e,{children:[e.jsx(Oe,{children:"Annuler"}),e.jsx(Ie,{onClick:()=>{$.mutate(),L(!1)},className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Supprimer"})]})]})})]})},gr=({competition:t,onEdit:n,onSendSms:s})=>{const{data:o=[]}=U({queryKey:["competition-assignments",t.id],queryFn:()=>O.getCompetitionAssignments(t.id)}),a=hr(t.date),c=a<0,d=a>=0,l=t.end_date?`du ${tt(t.date)} au ${tt(t.end_date)}`:tt(t.date);return e.jsxs("button",{type:"button",className:`w-full text-left rounded-xl border bg-card p-3 space-y-1 transition-colors hover:bg-muted/50 ${c?"opacity-60":""}`,onClick:()=>n(t),children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-sm font-semibold truncate",children:t.name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:l})]}),e.jsxs("div",{className:"flex items-center gap-1.5 shrink-0",children:[d&&e.jsxs(te,{variant:"outline",className:"border-orange-300 text-orange-600 dark:text-orange-400 text-[10px] px-1.5 py-0",children:["J-",a]}),c&&e.jsx(te,{variant:"secondary",className:"text-[10px] px-1.5 py-0",children:"Passee"})]})]}),t.location&&e.jsxs("div",{className:"flex items-center gap-1 text-xs text-muted-foreground",children:[e.jsx(Hs,{className:"h-3 w-3 shrink-0"}),e.jsx("span",{className:"truncate",children:t.location})]}),o.length>0&&e.jsxs("div",{className:"flex items-center gap-1 text-xs text-muted-foreground",children:[e.jsx(ye,{className:"h-3 w-3 shrink-0"}),e.jsxs("span",{children:[o.length," nageur",o.length>1?"s":""]})]}),o.length>0&&s&&e.jsxs("button",{type:"button",className:"flex items-center gap-1 text-xs text-primary hover:underline",onClick:h=>{h.stopPropagation(),s(t,o)},children:[e.jsx(mt,{className:"h-3 w-3"}),"SMS"]})]})},fr=({onBack:t})=>{const{toast:n}=se(),[s,o]=r.useState(!1),[a,c]=r.useState(null),{data:d=[],isLoading:l}=U({queryKey:["competitions"],queryFn:()=>O.getCompetitions()}),{data:h}=U({queryKey:["athlete-phones"],queryFn:async()=>{const{data:i}=await ct.from("user_profiles").select("user_id, phone").not("phone","is",null);return new Map((i??[]).map(f=>[f.user_id,f.phone]))}}),u=r.useMemo(()=>{const i=new Date;i.setHours(0,0,0,0);const f=i.getTime(),w=[],j=[];for(const b of d)new Date(b.date+"T00:00:00").getTime()>=f?w.push(b):j.push(b);return w.sort((b,L)=>new Date(b.date+"T00:00:00").getTime()-new Date(L.date+"T00:00:00").getTime()),j.sort((b,L)=>new Date(L.date+"T00:00:00").getTime()-new Date(b.date+"T00:00:00").getTime()),[...w,...j]},[d]),x=()=>{c(null),o(!0)},m=i=>{c(i),o(!0)},v=(i,f)=>{if(!h)return;const w=f.map(b=>h.get(b.athlete_id)).filter(b=>!!b&&b.trim().length>0);if(w.length===0){n({title:"Aucun numero",description:"Aucun nageur assigne n'a renseigne de numero de telephone.",variant:"destructive"});return}if(/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)){const b=encodeURIComponent(`[${i.name}] `);/iPhone|iPad|iPod/i.test(navigator.userAgent)?window.location.href=`sms:/open?addresses=${w.join(",")}&body=${b}`:window.location.href=`sms:${w.join(",")}?body=${b}`}else navigator.clipboard.writeText(w.join(", ")).then(()=>{n({title:"Numeros copies",description:`${w.length} numero${w.length>1?"s":""} copie${w.length>1?"s":""} dans le presse-papiers. Utilisez votre telephone pour envoyer le SMS.`})}).catch(()=>{n({title:"Erreur",description:"Impossible de copier les numéros.",variant:"destructive"})})},p=d.length===0?"Gerez les competitions du club.":`${d.length} competition${d.length>1?"s":""}`;return e.jsxs("div",{className:"space-y-6 pb-24",children:[e.jsx(ce,{title:"Competitions",description:p,onBack:t,actions:e.jsxs(K,{variant:"outline",size:"sm",onClick:x,children:[e.jsx(he,{className:"mr-1.5 h-3.5 w-3.5"}),"Ajouter"]})}),l?e.jsx("div",{className:"space-y-2",children:[1,2,3].map(i=>e.jsx("div",{className:"rounded-xl border p-3 animate-pulse motion-reduce:animate-none",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-4 w-40 rounded bg-muted"}),e.jsx("div",{className:"ml-auto h-5 w-12 rounded bg-muted"})]})},i))}):u.length===0?e.jsxs("div",{className:"text-center py-12 space-y-3",children:[e.jsx(st,{className:"h-10 w-10 text-muted-foreground mx-auto"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Aucune competition creee."}),e.jsxs(K,{variant:"outline",size:"sm",onClick:x,children:[e.jsx(he,{className:"mr-1.5 h-3.5 w-3.5"}),"Creer la premiere competition"]})]}):e.jsx("div",{className:"space-y-2",children:u.map(i=>e.jsx(gr,{competition:i,onEdit:m,onSendSms:v},i.id))}),e.jsx(xr,{open:s,onOpenChange:o,competition:a})]})};async function vr(t){const{data:n,error:s}=await ct.rpc("get_auth_uid_for_user",{p_user_id:t});return s?(console.error("[objectives] Failed to resolve auth UUID:",s.message),null):n}const jr=({open:t,onOpenChange:n,objective:s,athleteName:o,athleteAuthId:a,competitions:c})=>{const{toast:d}=se(),l=qe(),h=!!s,[u,x]=r.useState("chrono"),[m,v]=r.useState(""),[p,i]=r.useState("25"),[f,w]=r.useState(""),[j,b]=r.useState(""),[L,I]=r.useState(""),[P,_]=r.useState(!1);r.useEffect(()=>{if(t)if(s){const y=!!s.event_code,T=!!s.text;x(y&&T?"both":T?"texte":"chrono"),v(s.event_code??""),i(String(s.pool_length??25)),w(s.target_time_seconds!=null?$t(s.target_time_seconds):""),b(s.text??""),I(s.competition_id??"")}else x("chrono"),v(""),i("25"),w(""),b(""),I("")},[t,s]);const E=X({mutationFn:y=>O.createObjective(y),onSuccess:()=>{d({title:"Objectif cree"}),l.invalidateQueries({queryKey:["objectives"]}),n(!1)},onError:y=>{d({title:"Erreur",description:y.message,variant:"destructive"})}}),D=X({mutationFn:y=>O.updateObjective(s.id,y),onSuccess:()=>{d({title:"Objectif mis a jour"}),l.invalidateQueries({queryKey:["objectives"]}),n(!1)},onError:y=>{d({title:"Erreur",description:y.message,variant:"destructive"})}}),N=X({mutationFn:()=>O.deleteObjective(s.id),onSuccess:()=>{d({title:"Objectif supprime"}),l.invalidateQueries({queryKey:["objectives"]}),n(!1)},onError:y=>{d({title:"Erreur",description:y.message,variant:"destructive"})}}),R=u==="chrono"||u==="both",$=u==="texte"||u==="both",B=()=>{if(R&&!m){d({title:"Epreuve requise",description:"Veuillez selectionner une epreuve.",variant:"destructive"});return}if(R&&f&&jt(f)===null){d({title:"Format invalide",description:"Le temps doit être au format m:ss:cc (ex: 1:05:30)",variant:"destructive"});return}if($&&!j.trim()){d({title:"Texte requis",description:"Veuillez saisir un objectif texte.",variant:"destructive"});return}const y={athlete_id:a,competition_id:L&&L!=="none"?L:null,event_code:R?m:null,pool_length:R?Number(p):null,target_time_seconds:R&&f?jt(f):null,text:$?j.trim():null};h?D.mutate(y):E.mutate(y)},F=E.isPending||D.isPending||N.isPending,k=r.useMemo(()=>{const y=new Date;return y.setHours(0,0,0,0),c.filter(T=>new Date(T.date+"T00:00:00").getTime()>=y.getTime())},[c]);return e.jsxs(e.Fragment,{children:[e.jsx(ze,{open:t,onOpenChange:n,children:e.jsxs(Le,{side:"right",className:"w-full sm:max-w-md overflow-y-auto",children:[e.jsx(Ke,{children:e.jsx(Ge,{children:h?"Modifier l'objectif":"Nouvel objectif"})}),e.jsxs("div",{className:"mt-6 space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(Q,{children:"Nageur"}),e.jsx("p",{className:"text-sm font-medium",children:o})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Q,{children:"Type d'objectif"}),e.jsxs(dt,{type:"single",variant:"outline",value:u,onValueChange:y=>{y&&x(y)},className:"justify-start",children:[e.jsx(de,{value:"chrono",className:"text-xs",children:"Chrono"}),e.jsx(de,{value:"texte",className:"text-xs",children:"Texte"}),e.jsx(de,{value:"both",className:"text-xs",children:"Les deux"})]})]}),R&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(Q,{children:"Epreuve *"}),e.jsxs(re,{value:m,onValueChange:v,children:[e.jsx(ae,{children:e.jsx(oe,{placeholder:"Choisir une epreuve"})}),e.jsx(ie,{children:ks.map(y=>e.jsx(J,{value:y,children:Tt(y)},y))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Q,{children:"Bassin"}),e.jsxs(re,{value:p,onValueChange:i,children:[e.jsx(ae,{children:e.jsx(oe,{})}),e.jsxs(ie,{children:[e.jsx(J,{value:"25",children:"25m"}),e.jsx(J,{value:"50",children:"50m"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Q,{children:"Temps cible (min:sec:centièmes)"}),e.jsx(je,{placeholder:"Ex : 1:05:30",value:f,onChange:y=>w(y.target.value)})]})]}),$&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(Q,{children:"Objectif texte *"}),e.jsx(ut,{placeholder:"Ex : Ameliorer la coulée de dos",value:j,onChange:y=>b(y.target.value),rows:3})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Q,{children:"Lier a une competition"}),e.jsxs(re,{value:L,onValueChange:I,children:[e.jsx(ae,{children:e.jsx(oe,{placeholder:"Aucune"})}),e.jsxs(ie,{children:[e.jsx(J,{value:"none",children:"Aucune"}),k.map(y=>e.jsxs(J,{value:y.id,children:[y.name," (",y.date,")"]},y.id))]})]})]}),e.jsxs("div",{className:"space-y-2 pt-2",children:[e.jsx(K,{className:"w-full",onClick:B,disabled:F,children:F?"Enregistrement...":h?"Enregistrer":"Creer"}),h&&e.jsx(K,{variant:"outline",className:"w-full text-destructive hover:text-destructive",onClick:()=>_(!0),disabled:F,children:"Supprimer cet objectif"})]})]})]})}),e.jsx(Ee,{open:P,onOpenChange:_,children:e.jsxs(Pe,{children:[e.jsxs(Re,{children:[e.jsx(Fe,{children:"Supprimer l'objectif"}),e.jsx(Te,{children:"Cette action est irreversible. L'objectif sera supprime definitivement."})]}),e.jsxs($e,{children:[e.jsx(Oe,{children:"Annuler"}),e.jsx(Ie,{onClick:()=>{N.mutate(),_(!1)},className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Supprimer"})]})]})})]})},br=({objective:t,onEdit:n})=>{const s=!!t.event_code,o=!!t.text;return e.jsxs("button",{type:"button",className:"w-full text-left rounded-xl border bg-card p-3 space-y-1.5 transition-colors hover:bg-muted/50",onClick:()=>n(t),children:[s&&e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"text-sm font-semibold",children:Tt(t.event_code)}),t.pool_length&&e.jsxs(te,{variant:"secondary",className:"text-[10px] px-1.5 py-0",children:[t.pool_length,"m"]}),t.target_time_seconds!=null&&e.jsx(te,{variant:"outline",className:"text-[10px] px-1.5 py-0 font-mono",children:$t(t.target_time_seconds)})]}),o&&e.jsx("p",{className:"text-sm text-muted-foreground line-clamp-2",children:t.text}),t.competition_name&&e.jsx(te,{variant:"outline",className:"border-orange-300 text-orange-600 dark:text-orange-400 text-[10px] px-1.5 py-0",children:t.competition_name})]})},yr=({onBack:t,athletes:n,athletesLoading:s})=>{const{toast:o}=se(),[a,c]=r.useState(""),[d,l]=r.useState(!1),[h,u]=r.useState(null),x=r.useMemo(()=>a?n.find(P=>P.id!=null&&String(P.id)===a)??null:null,[n,a]),{data:m,isLoading:v}=U({queryKey:["auth-uid",a],queryFn:()=>vr(Number(a)),enabled:!!a}),{data:p=[]}=U({queryKey:["competitions"],queryFn:()=>O.getCompetitions()}),{data:i=[],isLoading:f}=U({queryKey:["objectives",m],queryFn:()=>O.getObjectives(m),enabled:!!m}),w=r.useMemo(()=>{const P=n.filter(E=>E.id!=null),_=new Map;for(const E of P){const D=E.group_label||"Sans groupe";_.has(D)||_.set(D,[]),_.get(D).push(E)}return[..._.entries()].sort(([E],[D])=>E.localeCompare(D,"fr"))},[n]),j=()=>{if(!m){o({title:"Nageur requis",description:"Veuillez selectionner un nageur.",variant:"destructive"});return}u(null),l(!0)},b=P=>{u(P),l(!0)},L=s||!!a&&v,I=!!m&&!v;return e.jsxs("div",{className:"space-y-6 pb-24",children:[e.jsx(ce,{title:"Objectifs",description:"Definissez des objectifs chrono ou texte pour chaque nageur.",onBack:t,actions:e.jsxs(K,{variant:"outline",size:"sm",onClick:j,disabled:!m,children:[e.jsx(he,{className:"mr-1.5 h-3.5 w-3.5"}),"Ajouter"]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Q,{children:"Nageur"}),e.jsxs(re,{value:a,onValueChange:c,children:[e.jsx(ae,{children:e.jsx(oe,{placeholder:"Selectionner un nageur"})}),e.jsx(ie,{children:w.map(([P,_])=>e.jsxs("div",{children:[e.jsx("div",{className:"px-2 py-1.5 text-xs font-semibold uppercase tracking-wider text-muted-foreground",children:P}),_.map(E=>e.jsx(J,{value:String(E.id),children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:E.display_name}),E.group_label&&e.jsx(te,{variant:"secondary",className:"text-[10px] px-1.5 py-0",children:E.group_label})]})},E.id))]},P))})]})]}),!a&&e.jsxs("div",{className:"text-center py-12 space-y-3",children:[e.jsx(nt,{className:"h-10 w-10 text-muted-foreground mx-auto"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Selectionnez un nageur pour voir et gerer ses objectifs."})]}),L&&a&&e.jsx("div",{className:"space-y-2",children:[1,2,3].map(P=>e.jsx("div",{className:"rounded-xl border p-3 animate-pulse motion-reduce:animate-none",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-4 w-40 rounded bg-muted"}),e.jsx("div",{className:"ml-auto h-5 w-12 rounded bg-muted"})]})},P))}),I&&f&&e.jsx("div",{className:"space-y-2",children:[1,2].map(P=>e.jsx("div",{className:"rounded-xl border p-3 animate-pulse motion-reduce:animate-none",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-4 w-32 rounded bg-muted"}),e.jsx("div",{className:"ml-auto h-5 w-16 rounded bg-muted"})]})},P))}),I&&!f&&i.length===0&&e.jsxs("div",{className:"text-center py-12 space-y-3",children:[e.jsx(nt,{className:"h-10 w-10 text-muted-foreground mx-auto"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Aucun objectif defini pour ",x?.display_name,"."]}),e.jsxs(K,{variant:"outline",size:"sm",onClick:j,children:[e.jsx(he,{className:"mr-1.5 h-3.5 w-3.5"}),"Creer le premier objectif"]})]}),I&&!f&&i.length>0&&e.jsx("div",{className:"space-y-2",children:i.map(P=>e.jsx(br,{objective:P,onEdit:b},P.id))}),m&&x&&e.jsx(jr,{open:d,onOpenChange:l,objective:h,athleteName:x.display_name,athleteAuthId:m,competitions:p})]})},Nr=r.lazy(()=>Ft(()=>import("./StrengthCatalog-C0yNR84x.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44]))),wr=r.lazy(()=>Ft(()=>import("./SwimCatalog--ygV3UTO.js"),__vite__mapDeps([45,1,2,3,4,5,6,7,19,20,10,12,22,17,46,47,14,48,49,13,50,24,16,25,26,9,8,15,27,28,29,30,18,11,38,32,51,52,34]))),Cr=({onNavigate:t,onOpenRecordsAdmin:n,onOpenRecordsClub:s,athletes:o,athletesLoading:a,upcomingBirthdays:c,birthdaysLoading:d,kpiLoading:l,kpiPeriod:h,onKpiPeriodChange:u,fatigueAlerts:x,mostLoadedAthlete:m,swimSessionCount:v,strengthSessionCount:p})=>{const i=new Date().getHours(),f=i<12?"Bonjour":i<18?"Bon après-midi":"Bonsoir",w=new Date().toLocaleDateString("fr-FR",{weekday:"long",day:"numeric",month:"long"}),j=x.length>0;return e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-display font-bold uppercase italic",children:[f,", ",e.jsx("span",{className:"text-primary",children:"Coach"})]}),e.jsx("p",{className:"text-sm text-muted-foreground capitalize",children:w})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h2",{className:"text-xs font-semibold uppercase tracking-[0.15em] text-muted-foreground",children:["Signaux · ",h,"j"]}),e.jsxs(dt,{type:"single",size:"sm",variant:"outline",value:String(h),onValueChange:b=>{b&&u(Number(b))},children:[e.jsx(de,{value:"7",className:"h-7 px-2 text-xs","aria-label":"7 jours",children:"7j"}),e.jsx(de,{value:"30",className:"h-7 px-2 text-xs","aria-label":"30 jours",children:"30j"}),e.jsx(de,{value:"365",className:"h-7 px-2 text-xs","aria-label":"1 an",children:"1an"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:`rounded-xl border p-3 ${j?"border-destructive/30 bg-destructive/5":"bg-muted/30"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-[11px] text-muted-foreground",children:"Fatigue 5/5"}),e.jsx(en,{className:`h-3.5 w-3.5 ${j?"text-destructive":"text-muted-foreground"}`})]}),e.jsx("p",{className:"text-xl font-bold tabular-nums",children:l?"–":x.length}),e.jsx("p",{className:"text-[11px] text-muted-foreground truncate",children:l?"Chargement…":j?x.slice(0,2).map(b=>b.athleteName.split(" ")[0]).join(", "):"Aucune alerte"})]}),e.jsxs("div",{className:"rounded-xl border bg-muted/30 p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-[11px] text-muted-foreground",children:"Plus chargé"}),e.jsx(ye,{className:"h-3.5 w-3.5 text-muted-foreground"})]}),e.jsx("p",{className:"text-xl font-bold truncate",children:l?"–":m?.athleteName?.split(" ")[0]??"–"}),e.jsx("p",{className:"text-[11px] text-muted-foreground",children:l?"Calcul…":m?`Charge ${Math.round(m.loadScore)}`:"Pas de données"})]})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs("button",{type:"button",onClick:()=>t("calendar"),className:"flex items-center gap-1.5 rounded-full bg-primary text-primary-foreground px-3.5 py-2 text-sm font-semibold active:opacity-80 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",children:[e.jsx(rt,{className:"h-3.5 w-3.5"}),"Assigner"]}),e.jsxs("button",{type:"button",onClick:()=>t("messaging"),className:"flex items-center gap-1.5 rounded-full border px-3.5 py-2 text-sm font-semibold active:bg-muted focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",children:[e.jsx(zt,{className:"h-3.5 w-3.5"}),"Email"]}),e.jsxs("button",{type:"button",onClick:()=>t("sms"),className:"flex items-center gap-1.5 rounded-full border px-3.5 py-2 text-sm font-semibold active:bg-muted focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",children:[e.jsx(mt,{className:"h-3.5 w-3.5"}),"SMS"]}),e.jsxs("button",{type:"button",onClick:()=>t("groups"),className:"flex items-center gap-1.5 rounded-full border px-3.5 py-2 text-sm font-semibold active:bg-muted focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",children:[e.jsx(Lt,{className:"h-3.5 w-3.5"}),"Groupes"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("button",{type:"button",onClick:()=>t("swim"),className:"rounded-xl border bg-card p-4 text-left shadow-sm active:bg-muted/50 transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",children:[e.jsx(Pt,{className:"h-5 w-5 text-primary mb-2"}),e.jsx("p",{className:"text-sm font-bold",children:"Natation"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:v!=null?`${v} séance${v!==1?"s":""}`:"Bibliothèque"})]}),e.jsxs("button",{type:"button",onClick:()=>t("strength"),className:"rounded-xl border bg-card p-4 text-left shadow-sm active:bg-muted/50 transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",children:[e.jsx(Rt,{className:"h-5 w-5 text-primary mb-2"}),e.jsx("p",{className:"text-sm font-bold",children:"Musculation"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:p!=null?`${p} séance${p!==1?"s":""}`:"Bibliothèque"})]}),e.jsxs("button",{type:"button",onClick:()=>t("swimmers"),className:"rounded-xl border bg-card p-4 text-left shadow-sm active:bg-muted/50 transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",children:[e.jsx(ye,{className:"h-5 w-5 text-primary mb-2"}),e.jsx("p",{className:"text-sm font-bold",children:"Nageurs"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:a?"Chargement…":`${o.length} nageur${o.length!==1?"s":""}`})]}),e.jsxs("button",{type:"button",onClick:n,className:"rounded-xl border bg-card p-4 text-left shadow-sm active:bg-muted/50 transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",children:[e.jsx(st,{className:"h-5 w-5 text-primary mb-2"}),e.jsx("p",{className:"text-sm font-bold",children:"Records club"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Import & administration"})]}),e.jsxs("button",{type:"button",onClick:()=>t("competitions"),className:"rounded-xl border bg-card p-4 text-left shadow-sm active:bg-muted/50 transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",children:[e.jsx(st,{className:"h-5 w-5 text-amber-500 mb-2"}),e.jsx("p",{className:"text-sm font-bold",children:"Compétitions"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Échéances & calendrier"})]}),e.jsxs("button",{type:"button",onClick:()=>t("objectives"),className:"rounded-xl border bg-card p-4 text-left shadow-sm active:bg-muted/50 transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",children:[e.jsx(nt,{className:"h-5 w-5 text-primary mb-2"}),e.jsx("p",{className:"text-sm font-bold",children:"Objectifs"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Temps cibles & objectifs"})]})]}),e.jsx("button",{type:"button",onClick:s,className:"w-full text-center text-sm text-primary font-semibold py-1 active:opacity-70 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring rounded",children:"Voir les records du club"}),!d&&c&&c.length>0?e.jsxs("div",{className:"space-y-2",children:[e.jsx("h2",{className:"text-xs font-semibold uppercase tracking-[0.15em] text-muted-foreground",children:"Anniversaires"}),e.jsx("div",{className:"space-y-1.5",children:c.slice(0,3).map(b=>e.jsxs("div",{className:"flex items-center justify-between gap-2 rounded-lg border px-3 py-2",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("span",{className:"text-sm font-medium truncate block",children:b.display_name}),e.jsx("span",{className:"text-[11px] text-muted-foreground",children:Sr(b.next_birthday)})]}),e.jsxs("span",{className:"text-xs font-bold text-primary shrink-0",children:["J-",b.days_until]})]},b.id))})]}):null]})},Sr=t=>{if(!t)return"-";const n=new Date(t);return Number.isNaN(n.getTime())?t:n.toLocaleDateString("fr-FR")},_t=t=>t.toISOString().split("T")[0],kr=t=>new Date(t.completed_at||t.started_at||t.date||t.created_at||0).getTime(),_r=t=>{if(!t.length)return null;const n=t.reduce((o,a)=>o+a,0)/t.length,s=Math.min(5,Math.max(1,Math.round(n/10*5)));return{average:n,rating:s}};function Ar(){const t=ft(_=>_.role),n=ft(_=>_.setSelectedAthlete),[,s]=Cs(),[o,a]=r.useState(()=>window.location.hash.match(/[?&]section=([^&]+)/)?.[1]||"home"),[c,d]=r.useState(7);r.useEffect(()=>{const _=()=>a("home");return window.addEventListener("nav:reset",_),()=>window.removeEventListener("nav:reset",_)},[]);const l=t==="coach"||t==="admin",h=o==="home"||o==="calendar",u=o==="home"||o==="messaging"||o==="sms"||o==="swimmers"||o==="calendar"||o==="groups"||o==="objectives",x=o==="messaging"||o==="sms"||o==="calendar"||o==="groups",m=o==="home"||o==="swimmers",{data:v}=U({queryKey:["swim_catalog"],queryFn:()=>O.getSwimCatalog(),enabled:l&&h}),{data:p}=U({queryKey:["strength_catalog"],queryFn:()=>O.getStrengthSessions(),enabled:l&&h}),{data:i=[],isLoading:f}=U({queryKey:["athletes"],queryFn:()=>O.getAthletes(),enabled:l&&u}),w=r.useMemo(()=>i.slice(0,5),[i]),{data:j=[]}=U({queryKey:["groups"],queryFn:()=>O.getGroups(),enabled:l&&x}),b=U({queryKey:["upcoming-birthdays"],queryFn:()=>O.getUpcomingBirthdays({days:30}),enabled:l&&m}),L=b.data,I=U({queryKey:["coach-kpis",c,w.map(_=>_.id??_.display_name)],enabled:l&&o==="home"&&w.length>0,queryFn:async()=>{const _=c,E=new Date;E.setDate(E.getDate()-_);const D=_t(E),N=_t(new Date),R=await Promise.all(w.map(async F=>{const[k,y]=await Promise.all([O.getSessions(F.display_name,F.id),O.getStrengthHistory(F.display_name,{athleteId:F.id,limit:50,from:D,to:N})]),T=k.filter(C=>new Date(C.date).getTime()>=E.getTime()),q=T.map(C=>C.fatigue??C.feeling).filter(C=>Number.isFinite(C)),G=T.reduce((C,S)=>C+(Number(S.duration)||0)*(Number(S.effort)||0),0),M=(y?.runs??[]).filter(C=>kr(C)>=E.getTime()),H=M.map(C=>C.fatigue??C.feeling??C.rpe).filter(C=>Number.isFinite(Number(C))).map(C=>Number(C)),g=M.reduce((C,S)=>{const z=Number(S.feeling??S.rpe??0),V=Number(S.duration??0);if(V>0&&z>0)return C+V*z;const W=Array.isArray(S.logs)?S.logs.length:0;return C+W*5},0),A=_r([...q,...H]);return{athleteName:F.display_name,loadScore:G+g,fatigueRating:A}})),$=R.filter(F=>F.fatigueRating?.rating===5).map(F=>({athleteName:F.athleteName,rating:F.fatigueRating?.rating??0})),B=R.filter(F=>F.loadScore>0).sort((F,k)=>k.loadScore-F.loadScore)[0];return{fatigueAlerts:$,mostLoadedAthlete:B??null}}}),P=_=>{n({id:_.id??null,name:_.display_name}),s(_.id!=null?`/coach/swimmer/${_.id}`:"/progress")};return se(),l?e.jsxs("div",{className:"space-y-6",children:[o==="home"?e.jsx(Cr,{onNavigate:a,onOpenRecordsAdmin:()=>s("/records-admin"),onOpenRecordsClub:()=>s("/records-club"),athletes:i,athletesLoading:f,upcomingBirthdays:L,birthdaysLoading:b.isLoading,kpiLoading:I.isLoading,kpiPeriod:c,onKpiPeriodChange:d,fatigueAlerts:I.data?.fatigueAlerts??[],mostLoadedAthlete:I.data?.mostLoadedAthlete??null,swimSessionCount:v?.length,strengthSessionCount:p?.length}):null,o==="swim"?e.jsxs("div",{className:"space-y-6",children:[e.jsx(ce,{title:"Bibliothèque natation",description:"Accédez aux séances et aux templates natation.",onBack:()=>a("home"),actions:e.jsxs(K,{variant:"outline",size:"sm",onClick:()=>a("calendar"),children:[e.jsx(rt,{className:"mr-1.5 h-3.5 w-3.5"}),"Assigner"]})}),e.jsx(r.Suspense,{fallback:e.jsx(vt,{}),children:e.jsx(wr,{})})]}):null,o==="strength"?e.jsxs("div",{className:"space-y-6",children:[e.jsx(ce,{title:"Bibliothèque musculation",description:"Consultez et créez des séances musculation.",onBack:()=>a("home"),actions:e.jsxs(K,{variant:"outline",size:"sm",onClick:()=>a("calendar"),children:[e.jsx(rt,{className:"mr-1.5 h-3.5 w-3.5"}),"Assigner"]})}),e.jsx(r.Suspense,{fallback:e.jsx(vt,{}),children:e.jsx(Nr,{})})]}):null,o==="swimmers"?e.jsx(an,{athletes:i,athletesLoading:f,onBack:()=>a("home"),onOpenAthlete:P}):null,o==="messaging"?e.jsx(on,{onBack:()=>a("home"),athletes:i,groups:j,athletesLoading:f}):null,o==="sms"?e.jsx(rr,{onBack:()=>a("home"),athletes:i,groups:j,athletesLoading:f}):null,o==="calendar"?e.jsx(cr,{onBack:()=>a("home"),athletes:i,groups:j,swimSessions:v,strengthSessions:p}):null,o==="groups"?e.jsx(pr,{onBack:()=>a("home"),athletes:i,groups:j,athletesLoading:f}):null,o==="competitions"?e.jsx(fr,{onBack:()=>a("home")}):null,o==="objectives"?e.jsx(yr,{onBack:()=>a("home"),athletes:i,athletesLoading:f}):null]}):e.jsx("div",{className:"flex items-center justify-center min-h-[60vh] animate-in fade-in motion-reduce:animate-none",children:e.jsxs(ke,{className:"w-full max-w-sm shadow-xl border-t-4 border-t-primary",children:[e.jsxs(_e,{children:[e.jsxs(Ae,{className:"flex items-center gap-2 uppercase italic",children:[e.jsx(ye,{className:"h-5 w-5 text-primary"}),"Accès Coach"]}),e.jsx(Me,{children:"Cette section est réservée aux coachs et administrateurs."})]}),e.jsx(De,{children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"Connectez-vous avec un compte autorisé pour accéder aux outils de gestion."})})]})})}const Zr=Object.freeze(Object.defineProperty({__proto__:null,default:Ar},Symbol.toStringTag,{value:"Module"}));export{ls as C,En as P,cs as a,ds as b,us as c,it as d,lt as e,Pn as f,Zt as g,Zr as h};
