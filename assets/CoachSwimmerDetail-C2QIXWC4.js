import{r as u,u as C,j as e,c as ae,d as I}from"./vendor-query-BiSH4r2z.js";import{c as re,B as E,d as ne,L as b,I as ie,s as le,Y as oe,b as de,u as ce}from"./index-CIFItJgD.js";import{a as v}from"./api-Ci-nc8V6.js";import{T as me,a as ue,b as T,c as k}from"./tabs-vFYMXJN1.js";import{B as _}from"./badge-EFxSRbCY.js";import{C as xe}from"./chevron-down-DkSkQREE.js";import{a as W,e as X,f as Z,F as he,T as pe,p as H,A as je}from"./objectiveHelpers-DZWLizP9.js";import{S as P,a as V,b as B,c as K,d as w}from"./select-Coxb5SZH.js";import{T as fe,a as R}from"./toggle-group-CqD0cnjw.js";import{S as ge,a as be,b as ve,c as Ne,A as ye,e as we,f as Ce,g as Se,h as Te,i as ke,j as _e,k as Ee}from"./alert-dialog-Cdhkzzxp.js";import{P as $}from"./plus-R9BA0RCT.js";import{C as Ae}from"./clock-C0Bnt9Ky.js";import{M as G}from"./message-square-CKs4A385.js";import"./vendor-react-BzrpNAyj.js";import"./vendor-supabase-DFPLkPj_.js";import"./swim-BS9jlGyZ.js";import"./index-NNWUu9Pw.js";import"./index-Co24W4qZ.js";import"./index-DBnLq7oP.js";import"./index-_kyMtMrg.js";import"./chevron-up-C8nTujyk.js";import"./index-CylKusvR.js";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fe=[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M16 2v4",key:"4m81vk"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M17 14h-6",key:"bkmgh3"}],["path",{d:"M13 18H7",key:"bb0bb7"}],["path",{d:"M7 14h.01",key:"1qa3f1"}],["path",{d:"M17 18h.01",key:"1bdyru"}]],Y=re("calendar-range",Fe);function J(...a){return a.filter(Boolean).join(" ")}const Le=[{key:"effort",label:"Diff.",mode:"hard"},{key:"feeling",label:"Fat.",mode:"hard"},{key:"performance",label:"Perf",mode:"good"},{key:"engagement",label:"Eng.",mode:"good"}];function De(a,i){const s=Number(i);if(!Number.isFinite(s)||s<1||s>5)return"bg-muted text-muted-foreground";const o=a==="hard"?6-s:s;return o>=4?"bg-emerald-100 text-emerald-800 dark:bg-emerald-900/30 dark:text-emerald-400":o>=3?"bg-amber-100 text-amber-800 dark:bg-amber-900/30 dark:text-amber-400":"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400"}function qe({athleteId:a,athleteName:i}){const[s,o]=u.useState(20),[l,j]=u.useState(null),{data:r=[],isLoading:m}=C({queryKey:["sessions",a],queryFn:()=>v.getSessions(i,a)}),h=r.slice(0,s),d=r.length>s;return m?e.jsx("div",{className:"space-y-3",children:[1,2,3,4,5].map(n=>e.jsxs("div",{className:"rounded-2xl border bg-card p-3 animate-pulse motion-reduce:animate-none",children:[e.jsx("div",{className:"h-4 w-32 rounded bg-muted mb-2"}),e.jsx("div",{className:"h-3 w-full rounded bg-muted"})]},n))}):r.length===0?e.jsx("p",{className:"text-sm text-muted-foreground text-center py-8",children:"Aucun ressenti enregistre."}):e.jsxs("div",{className:"space-y-2",children:[h.map(n=>{const x=l===n.id;return e.jsxs("button",{type:"button",onClick:()=>j(x?null:n.id),className:"w-full rounded-2xl border bg-card p-3 text-left hover:border-primary/20 transition-all",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("span",{className:"text-sm font-semibold text-foreground",children:new Date(n.date).toLocaleDateString("fr-FR",{weekday:"short",day:"numeric",month:"short"})}),e.jsx("span",{className:"text-xs text-muted-foreground ml-1.5",children:n.slot})]}),e.jsx("div",{className:"flex items-center gap-1",children:Le.map(p=>{const f=n[p.key];return e.jsx("span",{title:`${p.label}: ${f??"—"}`,className:J("inline-flex items-center justify-center h-6 w-6 rounded-lg text-[10px] font-bold",De(p.mode,f)),children:f??"—"},p.key)})})]}),e.jsxs("div",{className:"flex items-center justify-between mt-1.5",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:n.distance>0?`${n.distance}m`:"—"}),n.comments&&e.jsx(xe,{className:J("h-3.5 w-3.5 text-muted-foreground transition-transform",x&&"rotate-180")})]}),x&&n.comments&&e.jsx("div",{className:"mt-2 pt-2 border-t border-border",children:e.jsx("p",{className:"text-xs text-foreground whitespace-pre-wrap",children:n.comments})})]},n.id)}),d&&e.jsxs("button",{type:"button",onClick:n=>{n.stopPropagation(),o(x=>x+20)},className:"w-full rounded-2xl border border-dashed border-border py-2 text-xs font-medium text-muted-foreground hover:bg-muted transition",children:["Charger plus (",r.length-s," restants)"]})]})}async function Me(a){const{data:i,error:s}=await le.rpc("get_auth_uid_for_user",{p_user_id:a});return s?(console.error("[objectives-tab] Failed to resolve auth UUID:",s.message),null):i}const Oe=({open:a,onOpenChange:i,objective:s,athleteName:o,athleteAuthId:l,competitions:j})=>{const{toast:r}=ne(),m=ae(),h=!!s,[d,n]=u.useState("chrono"),[x,p]=u.useState(""),[f,g]=u.useState("25"),[c,A]=u.useState(""),[F,L]=u.useState(""),[S,D]=u.useState(""),[ee,q]=u.useState(!1);u.useEffect(()=>{if(a)if(s){const t=!!s.event_code,y=!!s.text;n(t&&y?"both":y?"texte":"chrono"),p(s.event_code??""),g(String(s.pool_length??25)),A(s.target_time_seconds!=null?Z(s.target_time_seconds):""),L(s.text??""),D(s.competition_id??"")}else n("chrono"),p(""),g("25"),A(""),L(""),D("")},[a,s]);const U=I({mutationFn:t=>v.createObjective(t),onSuccess:()=>{r({title:"Objectif cree"}),m.invalidateQueries({queryKey:["objectives",l]}),i(!1)},onError:t=>{r({title:"Erreur",description:t.message,variant:"destructive"})}}),Q=I({mutationFn:t=>v.updateObjective(s.id,t),onSuccess:()=>{r({title:"Objectif mis a jour"}),m.invalidateQueries({queryKey:["objectives",l]}),i(!1)},onError:t=>{r({title:"Erreur",description:t.message,variant:"destructive"})}}),z=I({mutationFn:()=>v.deleteObjective(s.id),onSuccess:()=>{r({title:"Objectif supprime"}),m.invalidateQueries({queryKey:["objectives",l]}),i(!1)},onError:t=>{r({title:"Erreur",description:t.message,variant:"destructive"})}}),N=d==="chrono"||d==="both",M=d==="texte"||d==="both",te=()=>{if(N&&!x){r({title:"Epreuve requise",description:"Veuillez selectionner une epreuve.",variant:"destructive"});return}if(N&&c&&H(c)===null){r({title:"Format invalide",description:"Le temps doit etre au format m:ss:cc (ex: 1:05:30)",variant:"destructive"});return}if(M&&!F.trim()){r({title:"Texte requis",description:"Veuillez saisir un objectif texte.",variant:"destructive"});return}const t={athlete_id:l,competition_id:S&&S!=="none"?S:null,event_code:N?x:null,pool_length:N?Number(f):null,target_time_seconds:N&&c?H(c):null,text:M?F.trim():null};h?Q.mutate(t):U.mutate(t)},O=U.isPending||Q.isPending||z.isPending,se=u.useMemo(()=>{const t=new Date;return t.setHours(0,0,0,0),j.filter(y=>new Date(y.date+"T00:00:00").getTime()>=t.getTime())},[j]);return e.jsxs(e.Fragment,{children:[e.jsx(ge,{open:a,onOpenChange:i,children:e.jsxs(be,{side:"right",className:"w-full sm:max-w-md overflow-y-auto",children:[e.jsx(ve,{children:e.jsx(Ne,{children:h?"Modifier l'objectif":"Nouvel objectif"})}),e.jsxs("div",{className:"mt-6 space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{children:"Nageur"}),e.jsx("p",{className:"text-sm font-medium",children:o})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{children:"Type d'objectif"}),e.jsxs(fe,{type:"single",variant:"outline",value:d,onValueChange:t=>{t&&n(t)},className:"justify-start",children:[e.jsx(R,{value:"chrono",className:"text-xs",children:"Chrono"}),e.jsx(R,{value:"texte",className:"text-xs",children:"Texte"}),e.jsx(R,{value:"both",className:"text-xs",children:"Les deux"})]})]}),N&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{children:"Epreuve *"}),e.jsxs(P,{value:x,onValueChange:p,children:[e.jsx(V,{children:e.jsx(B,{placeholder:"Choisir une epreuve"})}),e.jsx(K,{children:he.map(t=>e.jsx(w,{value:t,children:X(t)},t))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{children:"Bassin"}),e.jsxs(P,{value:f,onValueChange:g,children:[e.jsx(V,{children:e.jsx(B,{})}),e.jsxs(K,{children:[e.jsx(w,{value:"25",children:"25m"}),e.jsx(w,{value:"50",children:"50m"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{children:"Temps cible (min:sec:centiemes)"}),e.jsx(ie,{placeholder:"Ex : 1:05:30",value:c,onChange:t=>A(t.target.value)})]})]}),M&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{children:"Objectif texte *"}),e.jsx(pe,{placeholder:"Ex : Ameliorer la coulee de dos",value:F,onChange:t=>L(t.target.value),rows:3})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{children:"Lier a une competition"}),e.jsxs(P,{value:S,onValueChange:D,children:[e.jsx(V,{children:e.jsx(B,{placeholder:"Aucune"})}),e.jsxs(K,{children:[e.jsx(w,{value:"none",children:"Aucune"}),se.map(t=>e.jsxs(w,{value:t.id,children:[t.name," (",t.date,")"]},t.id))]})]})]}),e.jsxs("div",{className:"space-y-2 pt-2",children:[e.jsx(E,{className:"w-full",onClick:te,disabled:O,children:O?"Enregistrement...":h?"Enregistrer":"Creer"}),h&&e.jsx(E,{variant:"outline",className:"w-full text-destructive hover:text-destructive",onClick:()=>q(!0),disabled:O,children:"Supprimer cet objectif"})]})]})]})}),e.jsx(ye,{open:ee,onOpenChange:q,children:e.jsxs(we,{children:[e.jsxs(Ce,{children:[e.jsx(Se,{children:"Supprimer l'objectif"}),e.jsx(Te,{children:"Cette action est irreversible. L'objectif sera supprime definitivement."})]}),e.jsxs(ke,{children:[e.jsx(_e,{children:"Annuler"}),e.jsx(Ee,{onClick:()=>{z.mutate(),q(!1)},className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Supprimer"})]})]})})]})},Ie=({objective:a,onEdit:i})=>{const s=!!a.event_code,o=!!a.text;return e.jsxs("button",{type:"button",className:"w-full text-left rounded-xl border bg-card p-3 space-y-1.5 transition-colors hover:bg-muted/50",onClick:()=>i(a),children:[s&&e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"text-sm font-semibold",children:X(a.event_code)}),a.pool_length&&e.jsxs(_,{variant:"secondary",className:"text-[10px] px-1.5 py-0",children:[a.pool_length,"m"]}),a.target_time_seconds!=null&&e.jsx(_,{variant:"outline",className:"text-[10px] px-1.5 py-0 font-mono",children:Z(a.target_time_seconds)})]}),o&&e.jsx("p",{className:"text-sm text-muted-foreground line-clamp-2",children:a.text}),a.competition_name&&e.jsx(_,{variant:"outline",className:"border-orange-300 text-orange-600 dark:text-orange-400 text-[10px] px-1.5 py-0",children:a.competition_name})]})},Pe=({athleteId:a,athleteName:i})=>{const[s,o]=u.useState(!1),[l,j]=u.useState(null),{data:r,isLoading:m}=C({queryKey:["auth-uid",a],queryFn:()=>Me(a),enabled:!!a}),{data:h=[]}=C({queryKey:["competitions"],queryFn:()=>v.getCompetitions()}),{data:d=[],isLoading:n}=C({queryKey:["objectives",r],queryFn:()=>v.getObjectives(r),enabled:!!r}),x=()=>{j(null),o(!0)},p=c=>{j(c),o(!0)},f=m,g=!!r&&!m;return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex justify-end",children:e.jsxs(E,{variant:"outline",size:"sm",onClick:x,disabled:!r,children:[e.jsx($,{className:"mr-1.5 h-3.5 w-3.5"}),"Ajouter un objectif"]})}),f&&e.jsx("div",{className:"space-y-2",children:[1,2,3].map(c=>e.jsx("div",{className:"rounded-xl border p-3 animate-pulse motion-reduce:animate-none",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-4 w-40 rounded bg-muted"}),e.jsx("div",{className:"ml-auto h-5 w-12 rounded bg-muted"})]})},c))}),g&&n&&e.jsx("div",{className:"space-y-2",children:[1,2].map(c=>e.jsx("div",{className:"rounded-xl border p-3 animate-pulse motion-reduce:animate-none",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-4 w-32 rounded bg-muted"}),e.jsx("div",{className:"ml-auto h-5 w-16 rounded bg-muted"})]})},c))}),g&&!n&&d.length===0&&e.jsxs("div",{className:"text-center py-12 space-y-3",children:[e.jsx(W,{className:"h-10 w-10 text-muted-foreground mx-auto"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Aucun objectif defini pour ",i,"."]}),e.jsxs(E,{variant:"outline",size:"sm",onClick:x,children:[e.jsx($,{className:"mr-1.5 h-3.5 w-3.5"}),"Creer le premier objectif"]})]}),g&&!n&&d.length>0&&e.jsx("div",{className:"space-y-2",children:d.map(c=>e.jsx(Ie,{objective:c,onEdit:p},c.id))}),r&&e.jsx(Oe,{open:s,onOpenChange:o,objective:l,athleteName:i,athleteAuthId:r,competitions:h})]})};function lt(){const[,a]=oe("/coach/swimmer/:id"),[,i]=de(),{selectedAthleteId:s,selectedAthleteName:o}=ce(),l=a?.id?Number(a.id):s,j=o,{data:r}=C({queryKey:["profile",l],queryFn:()=>v.getProfile({userId:l}),enabled:l!=null}),m=r?.display_name??j??"Nageur",h=r?.avatar_url??null,d=r?.group_label??null;return l?e.jsxs("div",{className:"mx-auto max-w-3xl px-4 py-4 space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{type:"button",onClick:()=>i("/coach?section=swimmers"),className:"h-9 w-9 rounded-xl border border-border bg-card flex items-center justify-center hover:bg-muted transition","aria-label":"Retour",children:e.jsx(je,{className:"h-4 w-4"})}),h?e.jsx("img",{src:h,alt:"",className:"h-10 w-10 rounded-full object-cover border border-border"}):e.jsx("div",{className:"h-10 w-10 rounded-full bg-primary/10 flex items-center justify-center text-sm font-bold text-primary",children:m.charAt(0).toUpperCase()}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h1",{className:"text-lg font-bold truncate",children:m}),d&&e.jsx(_,{variant:"secondary",className:"text-[10px] px-1.5 py-0",children:d})]})]}),e.jsxs(me,{defaultValue:"ressentis",children:[e.jsxs(ue,{className:"w-full grid grid-cols-4",children:[e.jsxs(T,{value:"ressentis",className:"text-xs gap-1",children:[e.jsx(Ae,{className:"h-3.5 w-3.5"}),e.jsx("span",{className:"hidden sm:inline",children:"Ressentis"})]}),e.jsxs(T,{value:"objectifs",className:"text-xs gap-1",children:[e.jsx(W,{className:"h-3.5 w-3.5"}),e.jsx("span",{className:"hidden sm:inline",children:"Objectifs"})]}),e.jsxs(T,{value:"planification",className:"text-xs gap-1",children:[e.jsx(Y,{className:"h-3.5 w-3.5"}),e.jsx("span",{className:"hidden sm:inline",children:"Planif."})]}),e.jsxs(T,{value:"entretiens",className:"text-xs gap-1",children:[e.jsx(G,{className:"h-3.5 w-3.5"}),e.jsx("span",{className:"hidden sm:inline",children:"Entretiens"})]})]}),e.jsx(k,{value:"ressentis",className:"mt-4",children:e.jsx(qe,{athleteId:l,athleteName:m})}),e.jsx(k,{value:"objectifs",className:"mt-4",children:e.jsx(Pe,{athleteId:l,athleteName:m})}),e.jsx(k,{value:"planification",className:"mt-4",children:e.jsxs("div",{className:"rounded-2xl border border-dashed border-border p-6 text-center",children:[e.jsx(Y,{className:"h-8 w-8 mx-auto text-muted-foreground/50 mb-2"}),e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Bientôt disponible"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Macro-cycles (blocs entre compétitions) et micro-cycles (semaines typées)."})]})}),e.jsx(k,{value:"entretiens",className:"mt-4",children:e.jsxs("div",{className:"rounded-2xl border border-dashed border-border p-6 text-center",children:[e.jsx(G,{className:"h-8 w-8 mx-auto text-muted-foreground/50 mb-2"}),e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Bientôt disponible"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Comptes-rendus structurés d'entretiens individuels avec liens vers objectifs et planification."})]})})]})]}):e.jsxs("div",{className:"p-4 text-center text-muted-foreground",children:[e.jsx("p",{children:"Aucun nageur sélectionné."}),e.jsx("button",{type:"button",onClick:()=>i("/coach?section=swimmers"),className:"mt-2 text-primary underline",children:"Retour au dashboard"})]})}export{lt as default};
