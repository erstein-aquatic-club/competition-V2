const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-Cvs_YkOn.js","assets/vendor-query-DyA9aSKS.js","assets/vendor-react-BzrpNAyj.js","assets/vendor-charts-BrQ8X25f.js","assets/vendor-supabase-DFPLkPj_.js","assets/vendor-motion-lao-Njgm.js","assets/index-ekCDsyyI.css"])))=>i.map(i=>d[i]);
import{c as qe,u as T,r as p,d as V,j as e,f as $e}from"./vendor-query-DyA9aSKS.js";import{d as Oe,B as P,L as E,v as X,w as Ze,_ as es,u as J,P as se,I as ss,s as ts,f as te}from"./index-Cvs_YkOn.js";import{a as N}from"./api-Dpep1juq.js";import{B as k}from"./badge-DG9anhct.js";import{C as Ee,a as Ae,b as Pe}from"./collapsible-B3091RTa.js";import{T as as,a as rs,b as Q,c as G}from"./tabs-BSnX1CC-.js";import{S as ns,w as Be,a as Re,G as ls,C as Ie,b as is}from"./weekTypeColor-Cevb2xlL.js";import{T as L}from"./textarea-DkfNrsuI.js";import{s as Ke,f as Le,c as Ve,S as ze,e as U,a as I,F as cs,p as ue,d as ds,b as xe}from"./objectiveHelpers-D7Sv8PWO.js";import{A as ie}from"./arrow-left-4Zg_LZ_s.js";import{M as We}from"./message-square-D5fOhHVl.js";import{C as os}from"./chevron-up-DPBN8lYM.js";import{C as ms}from"./chevron-down-B6KR9Abc.js";import{C as H}from"./clock-BL74SOaI.js";import{C as pe}from"./circle-check-C17vOP-w.js";import{C as Qe}from"./chevron-right-D36gWb3N.js";import{T as Ge}from"./trophy-BMRRSNzl.js";import{T as us,a as ae}from"./toggle-group-CrHB5t3Q.js";import{S as he,a as ge,b as fe,c as je,d as re}from"./select-kb5BZ1-r.js";import{S as xs,a as ps,b as hs,c as gs,d as fs}from"./sheet-DOa8qZSD.js";import{A as js,a as bs,b as ys,c as Ns,d as vs,e as _s,f as ws,g as Cs}from"./alert-dialog-R5dHQpJt.js";import{T as be}from"./trash-2-DxZav9e8.js";import{S as ks}from"./sparkles-BSmGOzIv.js";import"./vendor-react-BzrpNAyj.js";import"./vendor-charts-BrQ8X25f.js";import"./vendor-supabase-DFPLkPj_.js";import"./vendor-motion-lao-Njgm.js";import"./swim-CyGKNKIP.js";import"./index-COzKfXYf.js";import"./index-DjBT01J4.js";import"./chart-column-x6hxOQmO.js";import"./index-DhaHR-2q.js";import"./index-BH1YY2v2.js";function z(s){return new Date(s+"T12:00:00").toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric"})}function ye(s){return new Date(s+"T00:00:00").toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit"})}function Ss(s){const t=new Date(s+"T00:00:00");return t.setDate(t.getDate()+6),t.toISOString().split("T")[0]}function Ts(s){const t=new Date;t.setHours(0,0,0,0);const n=new Date(s+"T00:00:00"),i=new Date(s+"T00:00:00");return i.setDate(i.getDate()+6),t>=n&&t<=i}function Ne(s,t){const n=[],i=new Date(s+"T00:00:00"),c=new Date(t+"T00:00:00"),d=new Date(i),m=d.getDay(),g=m===0?1:m===1?0:8-m;for(d.setDate(d.getDate()+g);d<=c;)n.push(d.toISOString().split("T")[0]),d.setDate(d.getDate()+7);return n}function ve(s,t){const n=new Date(s+"T00:00:00"),i=new Date(t+"T00:00:00");return Math.round((i.getTime()-n.getTime())/(1e3*60*60*24))}function Ds({onBack:s,embedded:t=!1}){const{toast:n}=Oe(),i=qe(),{data:c}=T({queryKey:["auth-user"],queryFn:async()=>{const{data:x}=await(await es(async()=>{const{supabase:_}=await import("./index-Cvs_YkOn.js").then(D=>D.ah);return{supabase:_}},__vite__mapDeps([0,1,2,3,4,5,6]))).supabase.auth.getUser();return x.user}}),d=c?.app_metadata?.app_user_id,{data:m=[],isLoading:g}=T({queryKey:["my-interviews"],queryFn:()=>N.getMyInterviews()}),{data:f=[]}=T({queryKey:["athlete-objectives"],queryFn:()=>N.getAthleteObjectives()}),{data:j}=T({queryKey:["my-profile-iuf"],queryFn:()=>N.getProfile({userId:d}),enabled:!!d}),b=j?.ffn_iuf??null,v=p.useMemo(()=>{const x=new Date;return x.setDate(x.getDate()-360),x.toISOString().slice(0,10)},[]),{data:y=[]}=T({queryKey:["swimmer-performances-recent",b],queryFn:()=>N.getSwimmerPerformances({iuf:b,fromDate:v}),enabled:!!b}),o=p.useCallback(()=>i.invalidateQueries({queryKey:["my-interviews"]}),[i]),a=V({mutationFn:({id:x,input:_})=>N.updateInterviewAthleteSections(x,_),onSuccess:()=>{n({title:"Sauvegardé"}),o()},onError:x=>n({title:"Erreur",description:x.message,variant:"destructive"})}),l=V({mutationFn:x=>N.submitInterviewToCoach(x),onSuccess:()=>{n({title:"Envoyé au coach"}),o()},onError:x=>n({title:"Erreur",description:x.message,variant:"destructive"})}),h=V({mutationFn:x=>N.signInterview(x),onSuccess:()=>{n({title:"Entretien signé"}),o()},onError:x=>n({title:"Erreur",description:x.message,variant:"destructive"})});return e.jsxs("div",{className:"space-y-6 pb-24",children:[!t&&e.jsxs("div",{className:"space-y-1",children:[e.jsxs(P,{variant:"ghost",size:"sm",className:"-ml-2",onClick:s,children:[e.jsx(ie,{className:"mr-1.5 h-4 w-4"}),"Retour"]}),e.jsx("h2",{className:"text-2xl font-display font-semibold uppercase italic text-primary",children:"Mes entretiens"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Entretiens individuels avec le coach"})]}),g&&e.jsx("div",{className:"space-y-3",children:[1,2,3].map(x=>e.jsx("div",{className:"rounded-xl border p-4 animate-pulse motion-reduce:animate-none",children:e.jsx("div",{className:"h-4 w-40 rounded bg-muted"})},x))}),!g&&m.length===0&&e.jsxs("div",{className:"text-center py-12 space-y-3",children:[e.jsx(We,{className:"h-10 w-10 text-muted-foreground mx-auto"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Aucun entretien en cours. Votre coach initiera les entretiens."})]}),!g&&m.map(x=>e.jsx(Ms,{interview:x,objectives:f,performances:y,appUserId:d??null,onSave:(_,D)=>a.mutate({id:_,input:D}),onSubmit:_=>{window.confirm("Envoyer votre préparation au coach ? Vous ne pourrez plus la modifier.")&&l.mutate(_)},onSign:_=>{window.confirm("Confirmer la signature de cet entretien ?")&&h.mutate(_)},isSaving:a.isPending,isSubmitting:l.isPending,isSigning:h.isPending},x.id))]})}function Ms({interview:s,objectives:t,performances:n,appUserId:i,onSave:c,onSubmit:d,onSign:m,isSaving:g,isSubmitting:f,isSigning:j}){const b=s.status==="draft_athlete",v=s.status==="draft_coach",y=s.status==="sent",o=s.status==="signed",[a,l]=p.useState(!1),[h,x]=p.useState(s.athlete_successes??""),[_,D]=p.useState(s.athlete_difficulties??""),[M,$]=p.useState(s.athlete_goals??""),[F,A]=p.useState(s.athlete_commitments??""),[S,O]=p.useState(s.athlete_commitment_review??""),{data:u}=T({queryKey:["my-previous-interview",s.date,s.id],queryFn:()=>i?N.getPreviousInterview(i,s.date,s.id):null,enabled:(b||y||o||v)&&!!i}),q=p.useRef(!1),w=p.useCallback(()=>{q.current||!b||(q.current=!0,c(s.id,{athlete_successes:h||null,athlete_difficulties:_||null,athlete_goals:M||null,athlete_commitments:F||null,athlete_commitment_review:S||null}),setTimeout(()=>{q.current=!1},500))},[s.id,h,_,M,F,S,c,b]),B=b?e.jsxs(k,{className:"bg-amber-100 text-amber-800 dark:bg-amber-900/30 dark:text-amber-400 border-amber-300 dark:border-amber-700",children:[e.jsx(H,{className:"h-3 w-3 mr-1"}),"À préparer"]}):v?e.jsxs(k,{className:"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400 border-blue-300 dark:border-blue-700",children:[e.jsx(H,{className:"h-3 w-3 mr-1"}),"En préparation"]}):y?e.jsxs(k,{className:"bg-emerald-100 text-emerald-800 dark:bg-emerald-900/30 dark:text-emerald-400 border-emerald-300 dark:border-emerald-700",children:[e.jsx(pe,{className:"h-3 w-3 mr-1"}),"À signer"]}):e.jsx(k,{variant:"secondary",children:"Signé"}),R=b?"border-amber-300 dark:border-amber-700 border-l-4":v?"border-blue-300 dark:border-blue-700 border-l-4":y?"border-emerald-300 dark:border-emerald-700 border-l-4":"";return e.jsxs("div",{className:`rounded-xl border bg-card shadow-sm ${R}`,children:[e.jsxs("button",{type:"button",className:"w-full flex items-center justify-between p-4 text-left",onClick:()=>l(C=>!C),children:[e.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[e.jsx("span",{className:"text-sm font-semibold",children:z(s.date)}),B,o&&s.signed_at&&e.jsxs("span",{className:"text-xs text-muted-foreground",children:["le ",z(s.signed_at.slice(0,10))]})]}),a?e.jsx(os,{className:"h-4 w-4 text-muted-foreground shrink-0"}):e.jsx(ms,{className:"h-4 w-4 text-muted-foreground shrink-0"})]}),a&&e.jsxs("div",{className:"px-4 pb-4 space-y-4",children:[b&&e.jsxs(e.Fragment,{children:[u&&(u.athlete_commitments||u.coach_actions)&&e.jsxs("div",{className:"rounded-xl border bg-muted/30 p-3 space-y-2",children:[e.jsx("p",{className:"text-xs font-bold uppercase tracking-widest text-muted-foreground",children:"Bilan des engagements précédents"}),u.athlete_commitments&&e.jsxs("div",{className:"border-l-4 border-blue-400 rounded-r-lg bg-blue-50/50 dark:bg-blue-950/20 p-2 space-y-0.5",children:[e.jsx("p",{className:"text-[10px] font-semibold text-muted-foreground",children:"Mes engagements"}),e.jsx("p",{className:"text-xs whitespace-pre-wrap",children:u.athlete_commitments})]}),u.coach_actions&&e.jsxs("div",{className:"border-l-4 border-amber-400 rounded-r-lg bg-amber-50/50 dark:bg-amber-950/20 p-2 space-y-0.5",children:[e.jsx("p",{className:"text-[10px] font-semibold text-muted-foreground",children:"Actions du coach"}),e.jsx("p",{className:"text-xs whitespace-pre-wrap",children:u.coach_actions})]}),e.jsxs("div",{className:"space-y-1 pt-1",children:[e.jsx(E,{htmlFor:`commitment-review-${s.id}`,className:"text-xs",children:"Comment avez-vous tenu vos engagements ?"}),e.jsx(L,{id:`commitment-review-${s.id}`,placeholder:"Mon bilan sur les engagements pris...",value:S,onChange:C=>O(C.target.value),onBlur:w,rows:3})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:`successes-${s.id}`,children:"Mes réussites"}),e.jsx(L,{id:`successes-${s.id}`,placeholder:"Ce dont je suis fier/fière cette saison...",value:h,onChange:C=>x(C.target.value),onBlur:w,rows:3})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:`difficulties-${s.id}`,children:"Mes difficultés"}),e.jsx(L,{id:`difficulties-${s.id}`,placeholder:"Les points que je souhaite améliorer...",value:_,onChange:C=>D(C.target.value),onBlur:w,rows:3})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{children:"Mes objectifs"}),t.length>0&&e.jsx("div",{className:"space-y-1.5",children:t.map(C=>e.jsx(ke,{objective:C,performances:n},C.id))}),e.jsx(L,{id:`goals-${s.id}`,placeholder:"Objectifs supplémentaires ou commentaires...",value:M,onChange:C=>$(C.target.value),onBlur:w,rows:3})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:`commitments-${s.id}`,children:"Mes engagements"}),e.jsx(L,{id:`commitments-${s.id}`,placeholder:"Ce que je m'engage à faire...",value:F,onChange:C=>A(C.target.value),onBlur:w,rows:3})]}),g&&e.jsx("p",{className:"text-xs text-muted-foreground animate-pulse",children:"Sauvegarde..."}),e.jsxs(P,{className:"w-full gap-2",onClick:()=>d(s.id),disabled:f,children:[e.jsx(ns,{className:"h-4 w-4"}),f?"Envoi...":"Envoyer au coach"]})]}),v&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"rounded-xl border border-dashed border-blue-300 dark:border-blue-700 bg-blue-50/50 dark:bg-blue-950/20 p-6 text-center space-y-2",children:[e.jsx(H,{className:"h-8 w-8 mx-auto text-blue-500"}),e.jsx("p",{className:"text-sm font-medium",children:"Entretien envoyé au coach"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Votre coach prépare l'entretien. Vous recevrez le compte-rendu complet après l'entretien en présentiel."}),s.submitted_at&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Envoyé le ",z(s.submitted_at.slice(0,10))]})]}),u&&(u.athlete_commitments||u.coach_actions)&&e.jsx(_e,{prevInterview:u,commitmentReview:s.athlete_commitment_review}),i&&e.jsxs(e.Fragment,{children:[e.jsx(W,{label:"Planification"}),e.jsx(we,{athleteId:i,interviewDate:s.date})]})]}),(y||o)&&e.jsxs(e.Fragment,{children:[u&&(u.athlete_commitments||u.coach_actions)&&e.jsx(_e,{prevInterview:u,commitmentReview:s.athlete_commitment_review}),e.jsx(Ce,{label:"Réussites",athleteText:s.athlete_successes,coachText:s.coach_comment_successes||s.coach_review}),e.jsx(Ce,{label:"Difficultés",athleteText:s.athlete_difficulties,coachText:s.coach_comment_difficulties}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(W,{label:"Objectifs"}),t.length>0&&e.jsx("div",{className:"space-y-1.5",children:t.map(C=>e.jsx(ke,{objective:C,performances:n},C.id))}),e.jsx(ne,{text:s.athlete_goals}),e.jsx(le,{text:s.coach_comment_goals||s.coach_objectives})]}),i&&e.jsxs(e.Fragment,{children:[e.jsx(W,{label:"Planification"}),e.jsx(we,{athleteId:i,interviewDate:s.date})]}),e.jsxs("div",{className:"rounded-xl bg-card border shadow-sm p-3 space-y-2",children:[e.jsx(W,{label:"Engagements & Actions"}),e.jsx(ne,{text:s.athlete_commitments,label:"Mes engagements"}),e.jsx(le,{text:s.coach_actions,label:"Actions du coach"})]}),y&&e.jsxs(P,{className:"w-full gap-2",onClick:()=>m(s.id),disabled:j,children:[e.jsx(pe,{className:"h-4 w-4"}),j?"Signature...":"Signer l'entretien"]})]})]})]})}function _e({prevInterview:s,commitmentReview:t}){const[n,i]=p.useState(!1);return e.jsxs(Ee,{open:n,onOpenChange:i,children:[e.jsx(Ae,{asChild:!0,children:e.jsxs("button",{type:"button",className:"w-full flex items-center gap-2 rounded-xl border bg-muted/30 px-3 py-2.5 text-left transition-colors hover:bg-muted/50",children:[e.jsx(Qe,{className:`h-3.5 w-3.5 text-muted-foreground shrink-0 transition-transform ${n?"rotate-90":""}`}),e.jsx("span",{className:"text-xs font-bold uppercase tracking-widest text-muted-foreground",children:"Rappel engagements précédents"}),e.jsx(k,{variant:"secondary",className:"text-[10px] px-1.5 py-0 ml-auto",children:z(s.date)})]})}),e.jsx(Pe,{children:e.jsxs("div",{className:"rounded-b-xl border border-t-0 bg-muted/30 px-3 pb-3 space-y-2",children:[s.athlete_commitments&&e.jsxs("div",{className:"border-l-4 border-blue-400 rounded-r-lg bg-blue-50/50 dark:bg-blue-950/20 p-2",children:[e.jsx("p",{className:"text-[10px] font-semibold text-muted-foreground",children:"Mes engagements"}),e.jsx("p",{className:"text-xs whitespace-pre-wrap",children:s.athlete_commitments})]}),s.coach_actions&&e.jsxs("div",{className:"border-l-4 border-amber-400 rounded-r-lg bg-amber-50/50 dark:bg-amber-950/20 p-2",children:[e.jsx("p",{className:"text-[10px] font-semibold text-muted-foreground",children:"Actions du coach"}),e.jsx("p",{className:"text-xs whitespace-pre-wrap",children:s.coach_actions})]}),t&&e.jsxs("div",{className:"border-l-4 border-blue-400 rounded-r-lg bg-blue-50/80 dark:bg-blue-950/30 p-2",children:[e.jsx("p",{className:"text-[10px] font-semibold text-muted-foreground",children:"Mon bilan"}),e.jsx("p",{className:"text-xs whitespace-pre-wrap",children:t})]})]})})]})}function we({athleteId:s,interviewDate:t}){const{data:n=[]}=T({queryKey:["competitions"],queryFn:()=>N.getCompetitions()}),{data:i=[]}=T({queryKey:["my-competition-ids",s],queryFn:()=>N.getMyCompetitionIds(s)}),c=p.useMemo(()=>{const o=new Set(i);return n.filter(l=>o.has(l.id)&&l.date>=t).sort((l,h)=>l.date.localeCompare(h.date))[0]??null},[n,i,t]),{data:d=[]}=T({queryKey:["training-cycles","athlete",s],queryFn:()=>N.getTrainingCycles({athleteId:s})}),m=p.useMemo(()=>{const o=new Set(i);return n.filter(a=>o.has(a.id)&&a.date>=t).sort((a,l)=>a.date.localeCompare(l.date))},[n,i,t]),g=p.useMemo(()=>{const o=new Map;return d.slice().sort((a,l)=>(a.end_competition_date??"").localeCompare(l.end_competition_date??"")).forEach(a=>{a.end_competition_id&&!o.has(a.end_competition_id)&&o.set(a.end_competition_id,a)}),o},[d]),f=p.useMemo(()=>{const o=new Set;return m.map(a=>g.get(a.id)??null).filter(a=>!a||o.has(a.id)?!1:(o.add(a.id),!0))},[m,g]),j=$e({queries:f.map(o=>({queryKey:["training-weeks",o.id],queryFn:()=>N.getTrainingWeeks(o.id),enabled:!!o.id}))}),b=p.useMemo(()=>{const o=new Map;return f.forEach((a,l)=>{o.set(a.id,j[l]?.data??[])}),o},[f,j]),v=p.useMemo(()=>new Date().toISOString().split("T")[0],[]),y=c?ve(v,c.date):null;return c?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"rounded-xl border bg-muted/20 p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm flex-wrap",children:[e.jsx(Ge,{className:"h-4 w-4 text-amber-500 shrink-0"}),e.jsxs("span",{className:"font-medium",children:[m.length," échéance",m.length>1?"s":""," visible",m.length>1?"s":""]}),e.jsxs(k,{variant:"secondary",className:"text-[10px]",children:["prochaine J-",y]})]}),e.jsx("p",{className:"mt-1 text-xs text-muted-foreground",children:"Vision multi-macrocycles depuis l'entretien, jusqu'aux prochaines compétitions assignées."})]}),e.jsx("div",{className:"space-y-3",children:m.map((o,a)=>{const l=g.get(o.id)??null,h=l?.start_date??l?.start_competition_date??t,x=h>t?h:t,_=l?Ne(x,o.date):[],D=l?Ne(h,o.date):[],M=Math.max(D.length-_.length,0),$=ve(v,o.date),F=l?b.get(l.id)??[]:[],A=new Map(F.map(S=>[S.week_start,S]));return e.jsxs("div",{className:"rounded-xl border bg-card shadow-sm overflow-hidden",children:[e.jsxs("div",{className:"border-b border-border bg-muted/20 px-3 py-2.5",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"text-sm font-semibold",children:o.name}),a===0&&e.jsx(k,{className:"text-[10px] bg-primary/10 text-primary border-primary/20",children:"Prochaine"}),e.jsx(k,{variant:"secondary",className:"text-[10px]",children:z(o.date)}),e.jsxs(k,{variant:"outline",className:"text-[10px]",children:["J-",$]})]}),l?e.jsxs("div",{className:"mt-1 flex items-center gap-2 flex-wrap text-xs text-muted-foreground",children:[e.jsx("span",{className:"font-medium text-foreground",children:l.name}),l.start_competition_name&&e.jsxs("span",{children:["depuis ",l.start_competition_name]}),e.jsxs("span",{children:[D.length," sem."]}),M>0&&e.jsxs("span",{children:[M," déjà écoulée",M>1?"s":""]})]}):e.jsx("p",{className:"mt-1 text-xs text-muted-foreground",children:"Aucun macrocycle créé pour cette échéance."})]}),l?_.length===0?e.jsx("div",{className:"px-3 py-3 text-xs text-muted-foreground italic",children:"Aucune semaine future à afficher sur ce macrocycle."}):e.jsx("div",{className:"px-3 py-3",children:e.jsx("div",{className:"relative ml-2 border-l-2 border-border pl-3 space-y-1.5",children:_.map((S,O)=>{const u=A.get(S),q=Ts(S),w=Ss(S);return e.jsxs("div",{className:`rounded-lg border bg-card px-2.5 py-2 text-xs ${q?"ring-2 ring-primary bg-primary/5":""}`,children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:`h-2 w-2 rounded-full shrink-0 ${q?"bg-primary":u?.week_type?"bg-muted-foreground/40":"bg-muted-foreground/20"}`}),e.jsxs("span",{className:"text-muted-foreground whitespace-nowrap",children:["Sem. ",M+O+1]}),e.jsxs("span",{className:"text-muted-foreground/70 whitespace-nowrap",children:[ye(S)," - ",ye(w)]}),u?.week_type&&e.jsx(k,{className:"text-[10px] px-1.5 py-0 border-0 ml-auto",style:{backgroundColor:Re(u.week_type),color:Be(u.week_type)},children:u.week_type})]}),u?.notes&&e.jsx("p",{className:"mt-1 pl-4 text-[11px] text-muted-foreground line-clamp-2",children:u.notes})]},S)})})}):e.jsx("div",{className:"px-3 py-3 text-xs text-muted-foreground italic",children:"La compétition reste visible pour garder la projection long terme, même sans planification détaillée."})]},o.id)})})]}):e.jsx("p",{className:"text-xs text-muted-foreground italic text-center py-2",children:"Aucune compétition assignée à venir."})}function Ce({label:s,athleteText:t,coachText:n}){return e.jsxs("div",{className:"space-y-2",children:[e.jsx(W,{label:s}),e.jsx(ne,{text:t}),e.jsx(le,{text:n})]})}function W({label:s}){return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-px flex-1 bg-border"}),e.jsx("span",{className:"text-xs font-bold uppercase tracking-widest text-muted-foreground",children:s}),e.jsx("div",{className:"h-px flex-1 bg-border"})]})}function ne({text:s,label:t}){return e.jsxs("div",{className:"border-l-4 border-blue-400 rounded-r-lg bg-blue-50/50 dark:bg-blue-950/20 p-2.5 space-y-0.5",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(Ze,{className:"h-3 w-3 text-blue-500"}),e.jsx("p",{className:"text-[10px] font-bold uppercase tracking-widest text-muted-foreground",children:t??"Nageur"})]}),e.jsx("p",{className:"text-sm whitespace-pre-wrap",children:s?.trim()||e.jsx("span",{className:"italic text-muted-foreground",children:"Non renseigné"})})]})}function le({text:s,label:t}){return s?.trim()?e.jsxs("div",{className:"border-l-4 border-amber-400 rounded-r-lg bg-amber-50/50 dark:bg-amber-950/20 p-2.5 space-y-0.5",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(ls,{className:"h-3 w-3 text-amber-500"}),e.jsx("p",{className:"text-[10px] font-bold uppercase tracking-widest text-muted-foreground",children:t??"Coach"})]}),e.jsx("p",{className:"text-sm whitespace-pre-wrap",children:s})]}):null}function ke({objective:s,performances:t}){const n=s.event_code?Ke(s.event_code):null,i=n?ze[n]??"":"",c=s.event_code?Le(t,s.event_code,s.pool_length):null;let d=null;return c&&s.target_time_seconds!=null&&s.event_code&&(d=c.time-s.target_time_seconds,Ve(c.time,s.target_time_seconds,s.event_code)),e.jsxs("div",{className:`rounded-lg border bg-card p-2 text-sm space-y-1 ${i?`border-l-4 ${i}`:""}`,children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx(X,{className:"h-3.5 w-3.5 text-muted-foreground shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0 flex items-center gap-1 flex-wrap",children:[s.event_code&&e.jsx("span",{className:"font-medium",children:U(s.event_code)}),s.event_code&&s.pool_length&&e.jsxs("span",{className:"text-muted-foreground",children:["(",s.pool_length,"m)"]}),s.target_time_seconds!=null&&e.jsx("span",{className:"font-mono text-xs text-primary",children:I(s.target_time_seconds)})]}),s.competition_name&&e.jsx(k,{variant:"secondary",className:"text-[10px] shrink-0",children:s.competition_name})]}),s.text&&e.jsx("p",{className:"text-muted-foreground text-xs pl-5",children:s.text}),c&&e.jsxs("div",{className:"flex items-center gap-2 pl-5 text-xs text-muted-foreground flex-wrap",children:[e.jsxs("span",{children:["Actuel : ",e.jsx("span",{className:"font-mono",children:I(c.time)})]}),c.date&&e.jsxs("span",{className:"text-muted-foreground/60",children:["(",z(c.date),")"]}),d!=null&&e.jsx("span",{className:d<=0?"text-emerald-600 font-medium":"text-amber-600",children:d<=0?"Objectif atteint !":`+${d.toFixed(2)}s`})]}),!c&&s.event_code&&s.target_time_seconds!=null&&e.jsx("p",{className:"text-[10px] text-muted-foreground italic pl-5",children:"Pas encore de temps enregistré"})]})}function Se({onBack:s,embedded:t=!1}){const{toast:n}=Oe(),i=qe(),[c,d]=p.useState(!1),[m,g]=p.useState(null),[f,j]=p.useState(null),{data:b}=T({queryKey:["auth-user"],queryFn:async()=>{const{data:r}=await ts.auth.getUser();return r.user}}),v=b?.id??null,{data:y=[],isLoading:o}=T({queryKey:["athlete-objectives"],queryFn:()=>N.getAthleteObjectives(),enabled:!!v,refetchInterval:3e4}),a=J(r=>r.userId),l=J(r=>r.user),{data:h}=T({queryKey:["my-profile"],queryFn:()=>N.getProfile({displayName:l,userId:a}),enabled:!!a}),x=h?.ffn_iuf??null,_=p.useMemo(()=>{const r=new Date;return r.setDate(r.getDate()-360),r.toISOString().slice(0,10)},[]),{data:D=[]}=T({queryKey:["swimmer-performances-recent",x],queryFn:()=>N.getSwimmerPerformances({iuf:x,fromDate:_}),enabled:!!x}),M=p.useMemo(()=>y.filter(r=>r.created_by!==v),[y,v]),$=p.useMemo(()=>y.filter(r=>r.created_by===v),[y,v]),[F,A]=p.useState("chrono"),[S,O]=p.useState(""),[u,q]=p.useState("25"),[w,B]=p.useState(""),[R,C]=p.useState(""),He=()=>{A("chrono"),O(""),q("25"),B(""),C("")},Y=()=>{g(null),He(),d(!0)},Je=r=>{g(r);const Ye=!!r.event_code,me=!!r.text;A(Ye&&me?"both":me?"texte":"chrono"),O(r.event_code??""),q(String(r.pool_length??25)),B(r.target_time_seconds!=null?I(r.target_time_seconds):""),C(r.text??""),d(!0)},Z=()=>i.invalidateQueries({queryKey:["athlete-objectives"]}),ce=V({mutationFn:r=>N.createObjective(r),onSuccess:()=>{n({title:"Objectif créé"}),Z(),d(!1)},onError:r=>n({title:"Erreur",description:r.message,variant:"destructive"})}),de=V({mutationFn:r=>N.updateObjective(m.id,r),onSuccess:()=>{n({title:"Objectif mis à jour"}),Z(),d(!1)},onError:r=>n({title:"Erreur",description:r.message,variant:"destructive"})}),Ue=V({mutationFn:r=>N.deleteObjective(r),onSuccess:()=>{n({title:"Objectif supprimé"}),Z(),j(null)},onError:r=>n({title:"Erreur",description:r.message,variant:"destructive"})}),K=F==="chrono"||F==="both",ee=F==="texte"||F==="both",oe=ce.isPending||de.isPending,Xe=()=>{if(K&&!S){n({title:"Épreuve requise",variant:"destructive"});return}if(K&&w&&ue(w)===null){n({title:"Format invalide",description:"Format : m:ss:cc (ex: 1:05:30)",variant:"destructive"});return}if(ee&&!R.trim()){n({title:"Texte requis",variant:"destructive"});return}if(!v)return;const r={athlete_id:v,event_code:K?S:null,pool_length:K?Number(u):null,target_time_seconds:K&&w?ue(w):null,text:ee?R.trim():null};m?de.mutate(r):ce.mutate(r)};return e.jsxs("div",{className:t?"space-y-3":"space-y-6 pb-24",children:[t?e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-[10px] font-black uppercase tracking-[0.2em] text-muted-foreground/70",children:"Objectifs"}),e.jsxs(P,{variant:"ghost",size:"sm",className:"h-7 px-2 text-xs",onClick:Y,children:[e.jsx(se,{className:"mr-1 h-3 w-3"}),"Ajouter"]})]}):e.jsxs("div",{className:"space-y-1",children:[e.jsxs(P,{variant:"ghost",size:"sm",className:"-ml-2",onClick:s,children:[e.jsx(ie,{className:"mr-1.5 h-4 w-4"}),"Retour"]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-display font-semibold uppercase italic text-primary",children:"Mon plan"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Mes objectifs d'entraînement"})]}),e.jsxs(P,{variant:"outline",size:"sm",onClick:Y,children:[e.jsx(se,{className:"mr-1.5 h-3.5 w-3.5"}),"Ajouter"]})]})]}),o&&e.jsx("div",{className:"space-y-1.5",children:[1,2].map(r=>e.jsx("div",{className:"rounded-lg border p-2.5 animate-pulse motion-reduce:animate-none",children:e.jsx("div",{className:"h-3.5 w-36 rounded bg-muted"})},r))}),!o&&y.length===0&&e.jsxs("div",{className:"text-center py-8 space-y-2",children:[e.jsx(X,{className:"h-8 w-8 text-muted-foreground/40 mx-auto"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Aucun objectif pour le moment."}),e.jsxs(P,{variant:"ghost",size:"sm",className:"text-xs h-7",onClick:Y,children:[e.jsx(se,{className:"mr-1 h-3 w-3"}),"Ajouter"]})]}),M.length>0&&e.jsxs("div",{className:"space-y-1.5",children:[!t&&e.jsx("h3",{className:"text-[10px] font-semibold uppercase tracking-[0.15em] text-muted-foreground",children:"Objectifs du coach"}),M.map(r=>e.jsx(Te,{objective:r,isPersonal:!1,performances:D,compact:t},r.id))]}),$.length>0&&e.jsxs("div",{className:"space-y-1.5",children:[!t&&e.jsx("h3",{className:"text-[10px] font-semibold uppercase tracking-[0.15em] text-muted-foreground",children:"Mes objectifs personnels"}),$.map(r=>e.jsx(Te,{objective:r,isPersonal:!0,performances:D,onEdit:Je,onDelete:j,compact:t},r.id))]}),e.jsx(xs,{open:c,onOpenChange:d,children:e.jsxs(ps,{side:"bottom",className:"max-h-[85vh] overflow-y-auto",children:[e.jsxs(hs,{children:[e.jsx(gs,{children:m?"Modifier l'objectif":"Nouvel objectif"}),e.jsx(fs,{children:m?"Modifiez votre objectif personnel.":"Ajoutez un objectif personnel."})]}),e.jsxs("div",{className:"mt-4 space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{children:"Type d'objectif"}),e.jsxs(us,{type:"single",variant:"outline",value:F,onValueChange:r=>{r&&A(r)},className:"justify-start",children:[e.jsx(ae,{value:"chrono",className:"text-xs",children:"Chrono"}),e.jsx(ae,{value:"texte",className:"text-xs",children:"Texte"}),e.jsx(ae,{value:"both",className:"text-xs",children:"Les deux"})]})]}),K&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{children:"Épreuve *"}),e.jsxs(he,{value:S,onValueChange:O,children:[e.jsx(ge,{children:e.jsx(fe,{placeholder:"Choisir une épreuve"})}),e.jsx(je,{children:cs.map(r=>e.jsx(re,{value:r,children:U(r)},r))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{children:"Bassin"}),e.jsxs(he,{value:u,onValueChange:q,children:[e.jsx(ge,{children:e.jsx(fe,{})}),e.jsxs(je,{children:[e.jsx(re,{value:"25",children:"25m"}),e.jsx(re,{value:"50",children:"50m"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{children:"Temps cible (min:sec:centièmes)"}),e.jsx(ss,{placeholder:"Ex : 1:05:30",value:w,onChange:r=>B(r.target.value)})]})]}),ee&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{children:"Objectif texte *"}),e.jsx(L,{placeholder:"Ex : Améliorer la coulée de dos",value:R,onChange:r=>C(r.target.value),rows:3})]}),e.jsx(P,{className:"w-full",onClick:Xe,disabled:oe,children:oe?"Enregistrement...":m?"Enregistrer":"Créer"})]})]})}),e.jsx(js,{open:!!f,onOpenChange:r=>{r||j(null)},children:e.jsxs(bs,{children:[e.jsxs(ys,{children:[e.jsx(Ns,{children:"Supprimer l'objectif"}),e.jsx(vs,{children:"Cette action est irréversible. L'objectif sera supprimé définitivement."})]}),e.jsxs(_s,{children:[e.jsx(ws,{children:"Annuler"}),e.jsx(Cs,{onClick:()=>{f&&Ue.mutate(f.id)},className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Supprimer"})]})]})})]})}function Fs(s){const t=s.split("-");return t.length===3?`${t[2]}/${t[1]}/${t[0]}`:s}function Te({objective:s,isPersonal:t,performances:n,onEdit:i,onDelete:c,compact:d=!1}){const m=s.event_code?Ke(s.event_code):null,g=m?ze[m]??"":"",f=s.event_code?Le(n,s.event_code,s.pool_length):null;let j=null,b=null;f&&s.target_time_seconds!=null&&s.event_code&&(j=f.time-s.target_time_seconds,b=Ve(f.time,s.target_time_seconds,s.event_code));const v=!!s.competition_name,y=s.competition_date?ds(s.competition_date):null;return d?e.jsxs("div",{className:`rounded-lg border bg-card px-3 py-2 text-xs ${g?`border-l-3 ${g}`:""}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"min-w-0 flex-1 flex items-center gap-1.5",children:[s.event_code&&e.jsx("span",{className:"font-semibold truncate",children:U(s.event_code)}),s.pool_length&&e.jsxs("span",{className:"text-muted-foreground/60 shrink-0",children:[s.pool_length,"m"]}),s.target_time_seconds!=null&&e.jsx("span",{className:"font-mono text-primary shrink-0",children:I(s.target_time_seconds)}),!t&&e.jsx(k,{variant:"secondary",className:"text-[9px] px-1 py-0 leading-none shrink-0",children:"Coach"})]}),f&&e.jsxs("div",{className:"flex items-center gap-1.5 shrink-0 tabular-nums",children:[e.jsx("span",{className:"font-mono text-muted-foreground",children:I(f.time)}),j!=null&&e.jsx("span",{className:`font-semibold ${j<=0?"text-emerald-500":"text-amber-500"}`,children:j<=0?"✓":`+${j.toFixed(1)}s`})]}),t&&i&&c&&e.jsxs("div",{className:"flex gap-0.5 shrink-0 ml-1",children:[e.jsx("button",{type:"button",onClick:()=>i(s),className:"text-primary hover:underline text-[10px]",children:"Mod."}),e.jsx("button",{type:"button",onClick:()=>c(s),className:"text-muted-foreground hover:text-destructive p-0.5",children:e.jsx(be,{className:"h-3 w-3"})})]})]}),s.text&&!s.event_code&&e.jsx("p",{className:"text-muted-foreground truncate mt-0.5",children:s.text}),b!=null&&e.jsx("div",{className:"mt-1.5",children:e.jsx("div",{className:"h-1 w-full rounded-full bg-muted overflow-hidden",children:e.jsx("div",{className:`h-full rounded-full transition-all duration-500 ${xe(b)}`,style:{width:`${Math.min(b,100)}%`}})})}),v&&y!=null&&y>0&&e.jsxs("span",{className:"text-[10px] text-orange-500 mt-0.5 inline-block",children:[s.competition_name," · J-",y]})]}):e.jsxs("div",{className:`rounded-lg border bg-card p-3 text-sm space-y-1.5 ${g?`border-l-4 ${g}`:""}`,children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx(X,{className:"h-3.5 w-3.5 text-muted-foreground shrink-0"}),!t&&e.jsx(k,{variant:"secondary",className:"text-[10px] px-1.5 py-0",children:"Coach"}),e.jsxs("div",{className:"flex-1 min-w-0 flex items-center gap-1.5 flex-wrap",children:[s.event_code&&e.jsx("span",{className:"font-medium",children:U(s.event_code)}),s.event_code&&s.pool_length&&e.jsxs("span",{className:"text-muted-foreground",children:["(",s.pool_length,"m)"]}),s.target_time_seconds!=null&&e.jsx("span",{className:"font-mono text-xs text-primary",children:I(s.target_time_seconds)})]}),t&&i&&c&&e.jsxs("div",{className:"ml-auto flex gap-1 shrink-0",children:[e.jsx("button",{type:"button",onClick:()=>i(s),className:"text-xs text-primary hover:underline",children:"Modifier"}),e.jsx("button",{type:"button",onClick:()=>c(s),className:"text-muted-foreground hover:text-destructive p-0.5",children:e.jsx(be,{className:"h-3.5 w-3.5"})})]})]}),s.text&&e.jsx("p",{className:"text-muted-foreground text-xs pl-5",children:s.text}),s.event_code&&f&&e.jsxs("div",{className:"flex items-center gap-2 pl-5 text-xs text-muted-foreground flex-wrap",children:[e.jsxs("span",{children:["Actuel : ",e.jsx("span",{className:"font-mono",children:I(f.time)})]}),f.date&&e.jsxs("span",{className:"text-muted-foreground/60",children:["(",Fs(f.date),")"]}),j!=null&&e.jsx("span",{className:j<=0?"text-emerald-600 font-medium":"text-amber-600",children:j<=0?"Objectif atteint !":`+${j.toFixed(2)}s`})]}),s.event_code&&!f&&e.jsx("p",{className:"text-[10px] text-muted-foreground italic pl-5",children:"Pas encore de temps enregistré"}),b!=null&&e.jsx("div",{className:"pl-5 pr-1",children:e.jsx("div",{className:"h-1.5 w-full rounded-full bg-muted overflow-hidden",children:e.jsx("div",{className:`h-full rounded-full transition-all duration-500 ${xe(b)}`,style:{width:`${Math.min(b,100)}%`}})})}),v&&e.jsx("div",{className:"pl-5",children:e.jsxs(k,{variant:"outline",className:"border-orange-300 text-orange-600 dark:text-orange-400 text-[10px] px-1.5 py-0",children:[s.competition_name,y!=null&&y>0&&e.jsxs("span",{className:"ml-1 font-bold",children:["J-",y]})]})})]})}function qs(s){return new Date(s+"T12:00:00").toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric"})}function De(s){return new Date(s+"T00:00:00").toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit"})}function $s(s){const t=new Date(s+"T00:00:00");return t.setDate(t.getDate()+6),t.toISOString().split("T")[0]}function Os(s){const t=new Date;t.setHours(0,0,0,0);const n=new Date(s+"T00:00:00"),i=new Date(s+"T00:00:00");return i.setDate(i.getDate()+6),t>=n&&t<=i}function Me(s,t){const n=[],i=new Date(s+"T00:00:00"),c=new Date(t+"T00:00:00"),d=new Date(i),m=d.getDay(),g=m===0?1:m===1?0:8-m;for(d.setDate(d.getDate()+g);d<=c;)n.push(d.toISOString().split("T")[0]),d.setDate(d.getDate()+7);return n}function Fe(s,t){const n=new Date(s+"T00:00:00"),i=new Date(t+"T00:00:00");return Math.round((i.getTime()-n.getTime())/(1e3*60*60*24))}function Es({athleteId:s}){const t=p.useMemo(()=>new Date().toISOString().split("T")[0],[]),[n,i]=p.useState([]),{data:c=[]}=T({queryKey:["competitions"],queryFn:()=>N.getCompetitions()}),{data:d=[]}=T({queryKey:["my-competition-ids",s],queryFn:()=>N.getMyCompetitionIds(s)}),{data:m=[]}=T({queryKey:["training-cycles","athlete",s],queryFn:()=>N.getTrainingCycles({athleteId:s})}),g=p.useMemo(()=>{const a=new Set(d);return c.filter(l=>a.has(l.id)&&l.date>=t).sort((l,h)=>l.date.localeCompare(h.date))},[d,c,t]),f=p.useMemo(()=>{const a=new Map;return m.slice().sort((l,h)=>(l.end_competition_date??"").localeCompare(h.end_competition_date??"")).forEach(l=>{l.end_competition_id&&!a.has(l.end_competition_id)&&a.set(l.end_competition_id,l)}),a},[m]),j=p.useMemo(()=>{const a=new Set;return g.map(l=>f.get(l.id)??null).filter(l=>!l||a.has(l.id)?!1:(a.add(l.id),!0))},[f,g]),b=$e({queries:j.map(a=>({queryKey:["training-weeks",a.id],queryFn:()=>N.getTrainingWeeks(a.id),enabled:!!a.id}))}),v=p.useMemo(()=>{const a=new Map;return j.forEach((l,h)=>{a.set(l.id,b[h]?.data??[])}),a},[j,b]),y=g[0]??null,o=a=>{i(l=>l.includes(a)?l.filter(h=>h!==a):[...l,a])};return g.length===0?e.jsxs("div",{className:"rounded-3xl border border-dashed bg-card/70 px-4 py-8 text-center",children:[e.jsx(Ie,{className:"mx-auto h-10 w-10 text-muted-foreground/60"}),e.jsx("p",{className:"mt-3 text-sm font-medium",children:"Aucune échéance à venir."}),e.jsx("p",{className:"mt-1 text-xs text-muted-foreground",children:"Ton plan apparaîtra ici."})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"rounded-3xl border bg-gradient-to-br from-primary/[0.08] via-background to-amber-500/[0.08] p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx(ks,{className:"h-4 w-4 text-primary"}),e.jsxs("span",{className:"text-sm font-semibold",children:[g.length," échéance",g.length>1?"s":""]}),y&&e.jsxs(k,{variant:"secondary",className:"text-[10px] px-2 py-0.5",children:["cap J-",Fe(t,y.date)]})]}),e.jsx("p",{className:"mt-2 text-xs text-muted-foreground",children:"Vue de tes prochains cycles."})]}),e.jsx("div",{className:"space-y-3",children:g.map((a,l)=>{const h=f.get(a.id)??null,x=h?.start_date??h?.start_competition_date??t,_=x>t?x:t,D=h?Me(_,a.date):[],M=h?Me(x,a.date):[],$=Math.max(M.length-D.length,0),F=h?v.get(h.id)??[]:[],A=new Map(F.map(u=>[u.week_start,u])),S=Fe(t,a.date),O=n.includes(a.id);return e.jsx(Ee,{open:O,onOpenChange:()=>o(a.id),children:e.jsxs("section",{className:"overflow-hidden rounded-3xl border bg-card shadow-sm",children:[e.jsx(Ae,{asChild:!0,children:e.jsx("button",{type:"button",className:"w-full border-b border-border bg-muted/20 px-4 py-3 text-left transition-colors hover:bg-muted/30",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Qe,{className:`mt-0.5 h-4 w-4 shrink-0 text-muted-foreground transition-transform ${O?"rotate-90":""}`}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"text-sm font-semibold",children:a.name}),l===0&&e.jsx(k,{className:"border-primary/20 bg-primary/10 text-[10px] text-primary",children:"Priorité"}),e.jsx(k,{variant:"secondary",className:"text-[10px]",children:qs(a.date)}),e.jsxs(k,{variant:"outline",className:"text-[10px]",children:["J-",S]})]}),h?e.jsxs("div",{className:"mt-1 flex items-center gap-2 flex-wrap text-xs text-muted-foreground",children:[e.jsx("span",{className:"font-medium text-foreground",children:h.name}),e.jsxs("span",{children:[M.length," sem."]}),$>0&&e.jsxs("span",{children:[$," sem. passée",$>1?"s":""]})]}):e.jsx("p",{className:"mt-1 text-xs text-muted-foreground",children:"Pas de cycle détaillé."})]})]})})}),e.jsx(Pe,{children:h?D.length===0?e.jsx("div",{className:"px-4 py-4 text-xs text-muted-foreground italic",children:"Pas de semaine à venir."}):e.jsx("div",{className:"px-4 py-4",children:e.jsx("div",{className:"relative ml-2 space-y-2 border-l-2 border-border pl-4",children:D.map((u,q)=>{const w=A.get(u),B=Os(u),R=$s(u);return e.jsxs("div",{className:`rounded-2xl border bg-card px-3 py-2 text-xs ${B?"ring-2 ring-primary/40 bg-primary/[0.04]":""}`,children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:`h-2 w-2 rounded-full shrink-0 ${B?"bg-primary":w?.week_type?"bg-muted-foreground/40":"bg-muted-foreground/20"}`}),e.jsxs("span",{className:"whitespace-nowrap text-muted-foreground",children:["Sem. ",$+q+1]}),e.jsxs("span",{className:"whitespace-nowrap text-muted-foreground/70",children:[De(u)," - ",De(R)]}),w?.week_type&&e.jsx(k,{className:"ml-auto border-0 px-1.5 py-0 text-[10px]",style:{backgroundColor:Re(w.week_type),color:Be(w.week_type)},children:w.week_type})]}),w?.notes&&e.jsx("p",{className:"mt-1 pl-4 text-[11px] text-muted-foreground line-clamp-2",children:w.notes})]},u)})})}):e.jsx("div",{className:"px-4 py-4 text-xs text-muted-foreground italic",children:"L'échéance reste affichée."})})]})},a.id)})})]})}function As({athleteId:s,athleteName:t,groupLabel:n,onBack:i,standalone:c,defaultTab:d}){return e.jsxs("div",{className:`mx-auto max-w-4xl pb-24 ${c?"space-y-3":"space-y-4"}`,children:[e.jsxs("div",{className:`rounded-[1.75rem] border bg-gradient-to-br from-primary/[0.12] via-background to-amber-500/[0.08] shadow-sm ${c?"p-3":"p-4"}`,children:[!c&&i&&e.jsxs(P,{variant:"ghost",size:"sm",className:"-ml-2 mb-2",onClick:i,children:[e.jsx(ie,{className:"mr-1.5 h-4 w-4"}),"Retour"]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`flex shrink-0 items-center justify-center rounded-2xl bg-primary/12 text-primary ${c?"h-9 w-9":"h-11 w-11"}`,children:e.jsx(Ge,{className:c?"h-4 w-4":"h-5 w-5"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("h1",{className:`font-display font-semibold uppercase italic text-foreground ${c?"text-lg":"text-xl"}`,children:"Mon suivi"}),n&&e.jsx(k,{variant:"secondary",className:"text-[10px]",children:n})]}),!c&&e.jsxs("p",{className:"mt-1 text-sm text-muted-foreground",children:[t,": ton plan d'action, tes entretiens et tes échéances au même endroit."]})]})]})]}),c&&e.jsx(Se,{embedded:!0}),e.jsxs(as,{defaultValue:d||(c?"ressentis":"objectifs"),className:c?"space-y-3":"space-y-4",children:[e.jsxs(rs,{className:`grid h-auto w-full gap-2 rounded-2xl bg-transparent p-0 ${c?"grid-cols-3":"grid-cols-2 sm:grid-cols-4"}`,children:[!c&&e.jsxs(Q,{value:"objectifs",className:"gap-1 rounded-2xl border border-border bg-card px-3 py-2.5 text-xs data-[state=active]:border-primary/30 data-[state=active]:bg-primary/5 data-[state=active]:text-primary",children:[e.jsx(X,{className:"hidden h-3.5 w-3.5 sm:block"}),e.jsx("span",{className:"sm:hidden",children:"Plan d'action"}),e.jsx("span",{className:"hidden sm:inline",children:"Plan d'action"})]}),e.jsxs(Q,{value:"ressentis",className:"gap-1 rounded-2xl border border-border bg-card px-3 py-2.5 text-xs data-[state=active]:border-primary/30 data-[state=active]:bg-primary/5 data-[state=active]:text-primary",children:[e.jsx(H,{className:"hidden h-3.5 w-3.5 sm:block"}),e.jsx("span",{className:"sm:hidden",children:"Ressentis"}),e.jsx("span",{className:"hidden sm:inline",children:"Ressentis"})]}),e.jsxs(Q,{value:"entretiens",className:"gap-1 rounded-2xl border border-border bg-card px-3 py-2.5 text-xs data-[state=active]:border-primary/30 data-[state=active]:bg-primary/5 data-[state=active]:text-primary",children:[e.jsx(We,{className:"hidden h-3.5 w-3.5 sm:block"}),e.jsx("span",{className:"sm:hidden",children:"Entretiens"}),e.jsx("span",{className:"hidden sm:inline",children:"Entretiens"})]}),e.jsxs(Q,{value:"planification",className:"gap-1 rounded-2xl border border-border bg-card px-3 py-2.5 text-xs data-[state=active]:border-primary/30 data-[state=active]:bg-primary/5 data-[state=active]:text-primary",children:[e.jsx(Ie,{className:"hidden h-3.5 w-3.5 sm:block"}),e.jsx("span",{children:"Planif."})]})]}),!c&&e.jsx(G,{value:"objectifs",className:"mt-0",children:e.jsx(Se,{embedded:!0})}),e.jsx(G,{value:"ressentis",className:"mt-0",children:e.jsx(is,{athleteId:s,athleteName:t,showProgressAction:!1})}),e.jsx(G,{value:"entretiens",className:"mt-0",children:e.jsx(Ds,{embedded:!0})}),e.jsx(G,{value:"planification",className:"mt-0",children:e.jsx(Es,{athleteId:s})})]})]})}function Ps(){return typeof window>"u"?void 0:window.location.hash.match(/[?&]tab=([^&]+)/)?.[1]||void 0}function ft(){const s=J(m=>m.user),t=J(m=>m.userId),{data:n,isLoading:i}=T({queryKey:["profile",s,t],queryFn:()=>N.getProfile({displayName:s,userId:t}),enabled:!!s}),{data:c=[]}=T({queryKey:["profile-groups"],queryFn:()=>N.getGroups(),enabled:!!s}),d=c.find(m=>m.id===n?.group_id)?.name||n?.group_label||null;return i?e.jsxs("div",{className:"mx-auto max-w-4xl space-y-4 p-4",children:[e.jsx(te,{className:"h-28 rounded-3xl"}),e.jsx(te,{className:"h-12 rounded-2xl"}),e.jsx(te,{className:"h-64 rounded-2xl"})]}):e.jsx(As,{athleteId:t??0,athleteName:n?.display_name||s||"Nageur",groupLabel:d,standalone:!0,defaultTab:Ps()})}export{ft as default};
