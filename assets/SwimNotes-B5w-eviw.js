import{c as B,u as Q,d as T,R as K,j as e,r as g}from"./vendor-query-DyA9aSKS.js";import{F as C,X as z,P as E,u as U,s as X,f as w}from"./index-BnsSVa73.js";import{P as q}from"./PageHeader-D6LjMho-.js";import{a as _}from"./api-qDVaGRDA.js";import{A as M,S as G,H as R,f as k,p as J}from"./SwimTimeInput-CYSb1oEW.js";import{C as O}from"./chevron-right-DsKr1luY.js";import{C as V}from"./check-eeOlFj6f.js";import{T as S}from"./trash-2-BQNtXcSe.js";import{T as A}from"./timer-BcNPzq8z.js";import{P as W}from"./pencil-CNS3Jqw8.js";import"./vendor-react-BzrpNAyj.js";import"./vendor-charts-BrQ8X25f.js";import"./vendor-supabase-DFPLkPj_.js";import"./vendor-motion-lao-Njgm.js";import"./chevron-left-WCowTkaR.js";import"./swim-PRbalu5T.js";function Y(...s){return s.filter(Boolean).join(" ")}function Z(s){try{return new Date(s).toLocaleDateString("fr-FR",{weekday:"short",day:"numeric",month:"short"})}catch{return s}}function $({userId:s,expanded:d,onToggle:f,standalone:u}){const j=B(),{data:h,isLoading:i}=Q({queryKey:["swim-exercise-logs-history",s],queryFn:()=>_.getSwimExerciseLogsHistory(s,100),enabled:!!s&&d}),l=T({mutationFn:({logId:o,patch:m})=>_.updateSwimExerciseLog(o,m),onSuccess:()=>{j.invalidateQueries({queryKey:["swim-exercise-logs-history",s]})}}),b=T({mutationFn:o=>_.deleteSwimExerciseLog(o),onSuccess:()=>{j.invalidateQueries({queryKey:["swim-exercise-logs-history",s]})}}),x=K.useMemo(()=>{if(!h?.length)return[];const o=new Map;for(const m of h){const c=(m.created_at??"").slice(0,10);o.has(c)||o.set(c,[]),o.get(c).push(m)}return Array.from(o.entries()).map(([m,c])=>({date:m,entries:c}))},[h]),N=d?e.jsxs("div",{className:u?"space-y-3":"mt-2 space-y-3 rounded-2xl border border-border/60 bg-card/60 p-2",children:[i&&e.jsx("div",{className:"text-sm text-muted-foreground text-center py-4",children:"Chargement..."}),!i&&x.length===0&&e.jsx("div",{className:"text-sm text-muted-foreground text-center py-4",children:"Aucune note technique enregistree."}),x.map(({date:o,entries:m})=>e.jsxs("div",{className:"rounded-2xl border border-border overflow-hidden",children:[e.jsx("div",{className:"bg-muted/50 px-3 py-2 text-xs font-semibold text-muted-foreground",children:Z(o)}),e.jsx("div",{className:"divide-y divide-border",children:m.map(c=>e.jsx(I,{log:c,onSave:v=>l.mutate({logId:c.id,patch:v}),onDelete:()=>b.mutate(c.id),saving:l.isPending},c.id))})]},o))]}):null;return u?N:e.jsxs("div",{className:"mt-6",children:[e.jsxs("button",{type:"button",onClick:f,className:"flex w-full items-center justify-between rounded-2xl border border-dashed border-border/80 bg-background px-3 py-2.5 text-left transition hover:bg-muted/40",children:[e.jsxs("span",{className:"flex min-w-0 items-center gap-2",children:[e.jsx("span",{className:"flex h-8 w-8 shrink-0 items-center justify-center rounded-xl bg-muted text-muted-foreground",children:e.jsx(C,{className:"h-4 w-4"})}),e.jsxs("span",{className:"min-w-0",children:[e.jsx("span",{className:"block truncate text-sm font-semibold text-foreground",children:"Notes techniques"}),e.jsx("span",{className:"block truncate text-[11px] text-muted-foreground",children:"Repères détaillés, consultation optionnelle"})]})]}),e.jsx(O,{className:Y("h-4 w-4 transition-transform",d&&"rotate-90")})]}),N]})}function I({log:s,onSave:d,onDelete:f,saving:u}){const[j,h]=g.useState(!1),[i,l]=g.useState({notes:s.notes??"",tempo:s.tempo,split_times:s.split_times,stroke_count:s.stroke_count}),[b,x]=g.useState([]),N=()=>{l({notes:s.notes??"",tempo:s.tempo,split_times:[...s.split_times],stroke_count:[...s.stroke_count]}),x(s.split_times.map(t=>k(t.time_seconds))),h(!0)},o=()=>h(!1),m=()=>{d({notes:i.notes.trim()||null,tempo:i.tempo,split_times:i.split_times,stroke_count:i.stroke_count}),h(!1)},c=()=>{l(t=>({...t,split_times:[...t.split_times,{rep:t.split_times.length+1,time_seconds:0}]})),x(t=>[...t,""])},v=(t,r)=>{x(a=>a.map((n,p)=>p===t?r:n))},H=t=>{const r=J(b[t]),a=k(r);x(n=>n.map((p,y)=>y===t?a:p)),l(n=>({...n,split_times:n.split_times.map((p,y)=>y===t?{...p,time_seconds:r}:p)}))},L=t=>{l(r=>({...r,split_times:r.split_times.filter((a,n)=>n!==t).map((a,n)=>({...a,rep:n+1}))})),x(r=>r.filter((a,n)=>n!==t))},P=()=>{l(t=>({...t,stroke_count:[...t.stroke_count,{rep:t.stroke_count.length+1,count:0}]}))},D=(t,r)=>{l(a=>({...a,stroke_count:a.stroke_count.map((n,p)=>p===t?{...n,count:r}:n)}))},F=t=>{l(r=>({...r,stroke_count:r.stroke_count.filter((a,n)=>n!==t).map((a,n)=>({...a,rep:n+1}))}))};return j?e.jsxs("div",{className:"px-3 py-2.5 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-semibold text-foreground",children:s.exercise_label}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{type:"button",onClick:m,disabled:u,className:"p-1.5 rounded-lg text-primary hover:bg-primary/10 transition","aria-label":"Enregistrer",children:e.jsx(V,{className:"h-4 w-4"})}),e.jsx("button",{type:"button",onClick:o,className:"p-1.5 rounded-lg text-muted-foreground hover:bg-muted transition","aria-label":"Annuler",children:e.jsx(z,{className:"h-4 w-4"})}),e.jsx("button",{type:"button",onClick:f,className:"p-1.5 rounded-lg text-muted-foreground hover:text-destructive hover:bg-destructive/10 transition","aria-label":"Supprimer",children:e.jsx(S,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-xs font-medium text-muted-foreground min-w-[80px]",children:[e.jsx(M,{className:"h-3.5 w-3.5"}),"Tempo"]}),e.jsx("input",{type:"number",inputMode:"decimal",step:"0.1",min:0,value:i.tempo??"",onChange:t=>l(r=>({...r,tempo:t.target.value?Number(t.target.value):null})),placeholder:"coups/min",className:"w-24 rounded-xl border border-border bg-background px-2 py-1.5 text-sm text-center outline-none focus:ring-2 focus:ring-foreground/10"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-xs font-medium text-muted-foreground",children:[e.jsx(A,{className:"h-3.5 w-3.5"}),"Temps"]}),e.jsxs("button",{type:"button",onClick:c,className:"inline-flex items-center gap-1 text-xs text-primary hover:text-primary/80 transition",children:[e.jsx(E,{className:"h-3 w-3"}),"Rep"]})]}),i.split_times.length>0&&e.jsx("div",{className:"mt-1.5 flex flex-wrap gap-1.5",children:i.split_times.map((t,r)=>e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"text-[10px] text-muted-foreground w-4 text-right",children:t.rep}),e.jsx(G,{value:b[r]??"",onChange:a=>v(r,a),onBlur:()=>H(r),size:"compact"}),e.jsx("button",{type:"button",onClick:()=>L(r),className:"p-0.5 text-muted-foreground hover:text-destructive transition",children:e.jsx(S,{className:"h-3 w-3"})})]},r))})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-xs font-medium text-muted-foreground",children:[e.jsx(R,{className:"h-3.5 w-3.5"}),"Coups de bras"]}),e.jsxs("button",{type:"button",onClick:P,className:"inline-flex items-center gap-1 text-xs text-primary hover:text-primary/80 transition",children:[e.jsx(E,{className:"h-3 w-3"}),"Rep"]})]}),i.stroke_count.length>0&&e.jsx("div",{className:"mt-1.5 flex flex-wrap gap-1.5",children:i.stroke_count.map((t,r)=>e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"text-[10px] text-muted-foreground w-4 text-right",children:t.rep}),e.jsx("input",{type:"number",inputMode:"numeric",min:0,value:t.count||"",onChange:a=>D(r,Number(a.target.value)||0),placeholder:"nb",className:"w-14 rounded-lg border border-border bg-background px-1.5 py-1 text-xs text-center outline-none focus:ring-2 focus:ring-foreground/10"}),e.jsx("button",{type:"button",onClick:()=>F(r),className:"p-0.5 text-muted-foreground hover:text-destructive transition",children:e.jsx(S,{className:"h-3 w-3"})})]},r))})]}),e.jsx("textarea",{value:i.notes,onChange:t=>l(r=>({...r,notes:t.target.value})),placeholder:"Notes libres...",rows:2,className:"w-full resize-none rounded-xl border border-border bg-background px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-foreground/10"})]}):e.jsxs("div",{className:"px-3 py-2.5 space-y-1.5 group",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-sm font-semibold text-foreground",children:s.exercise_label}),e.jsx("button",{type:"button",onClick:N,className:"p-1.5 rounded-lg text-muted-foreground hover:bg-muted transition","aria-label":"Modifier",children:e.jsx(W,{className:"h-3.5 w-3.5"})})]}),e.jsxs("div",{className:"flex flex-wrap gap-x-4 gap-y-1 text-xs text-muted-foreground",children:[s.tempo!=null&&e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx(M,{className:"h-3 w-3"}),s.tempo," c/min"]}),s.split_times.length>0&&e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx(A,{className:"h-3 w-3"}),s.split_times.map(t=>k(t.time_seconds)||"—").join(" / ")]}),s.stroke_count.length>0&&e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx(R,{className:"h-3 w-3"}),s.stroke_count.map(t=>t.count).join(" / ")," cps"]})]}),s.notes&&e.jsx("div",{className:"text-xs text-foreground/70 italic",children:s.notes})]})}function fe(){const s=U(u=>u.user),[d,f]=g.useState(null);return g.useEffect(()=>{X.auth.getSession().then(({data:u})=>{f(u.session?.user?.id??null)})},[s]),d?e.jsxs("div",{className:"mx-auto max-w-lg px-4 pb-24",children:[e.jsx(q,{title:"Notes techniques",icon:e.jsx(C,{className:"h-3.5 w-3.5"}),backHref:"/"}),e.jsx("div",{className:"mt-2",children:e.jsx($,{userId:d,expanded:!0,onToggle:()=>{},standalone:!0})})]}):e.jsxs("div",{className:"mx-auto max-w-lg px-4",children:[e.jsx(q,{title:"Notes techniques",icon:e.jsx(C,{className:"h-3.5 w-3.5"}),backHref:"/"}),e.jsxs("div",{className:"mt-4 space-y-3",children:[e.jsx(w,{className:"h-16 rounded-2xl"}),e.jsx(w,{className:"h-16 rounded-2xl"}),e.jsx(w,{className:"h-16 rounded-2xl"})]})]})}export{fe as default};
