import{r as m,j as e,g as fe,h as k}from"./vendor-ui-Cp7LoSvI.js";import{c as pe,t as xe,v as he,a as M,u as ge,f as je,S as p,C as S,g as F,i as y,B as v,L as x,I as w,p as ve,h as I,l as E,r as Ne,j as be,d as _}from"./index-C51JTpHS.js";import{b as we,u as H,c as R}from"./vendor-query-DWM3xq1x.js";import{T as Se}from"./textarea-DeqMcPb0.js";import{S as ye,a as _e,b as Ce,c as Fe,d as Le}from"./select-DuE4W60P.js";import{B as Pe}from"./badge-D_uvcgaM.js";import{u as z,t as G,o as O,s as N,l as Ae}from"./types-DPaQBEwS.js";import{m as Ie,f as Ee}from"./animations-B_laV44n.js";import{C as Re}from"./circle-alert-DLG9jTgd.js";import{P as ke}from"./pen-CI9OiN34.js";import{S as Me}from"./save-DiWSopyc.js";import"./vendor-react-BzrpNAyj.js";import"./vendor-charts-BtSE1gaf.js";import"./vendor-supabase-Cs1gO9iU.js";import"./chevron-up-DS8lTf_A.js";import"./check-DGNcIIE_.js";import"./design-tokens-CGMys_0P.js";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Te=[["path",{d:"m16 17 5-5-5-5",key:"1bji2h"}],["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}]],$e=pe("log-out",Te);function Ue(s,r=[]){let i=[];function d(a,l){const u=m.createContext(l);u.displayName=a+"Context";const f=i.length;i=[...i,l];const h=n=>{const{scope:g,children:o,...b}=n,L=g?.[s]?.[f]||u,P=m.useMemo(()=>b,Object.values(b));return e.jsx(L.Provider,{value:P,children:o})};h.displayName=a+"Provider";function j(n,g){const o=g?.[s]?.[f]||u,b=m.useContext(o);if(b)return b;if(l!==void 0)return l;throw new Error(`\`${n}\` must be used within \`${a}\``)}return[h,j]}const c=()=>{const a=i.map(l=>m.createContext(l));return function(u){const f=u?.[s]||a;return m.useMemo(()=>({[`__scope${s}`]:{...u,[s]:f}}),[u,f])}};return c.scopeName=s,[d,qe(c,...r)]}function qe(...s){const r=s[0];if(s.length===1)return r;const i=()=>{const d=s.map(c=>({useScope:c(),scopeName:c.scopeName}));return function(a){const l=d.reduce((u,{useScope:f,scopeName:h})=>{const n=f(a)[`__scope${h}`];return{...u,...n}},{});return m.useMemo(()=>({[`__scope${r.scopeName}`]:l}),[l])}};return i.scopeName=r.scopeName,i}var Be=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],T=Be.reduce((s,r)=>{const i=xe(`Primitive.${r}`),d=m.forwardRef((c,a)=>{const{asChild:l,...u}=c,f=l?i:r;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),e.jsx(f,{...u,ref:a})});return d.displayName=`Primitive.${r}`,{...s,[r]:d}},{});function De(){return he.useSyncExternalStore(Ve,()=>!0,()=>!1)}function Ve(){return()=>{}}var $="Avatar",[He]=Ue($),[ze,Q]=He($),W=m.forwardRef((s,r)=>{const{__scopeAvatar:i,...d}=s,[c,a]=m.useState("idle");return e.jsx(ze,{scope:i,imageLoadingStatus:c,onImageLoadingStatusChange:a,children:e.jsx(T.span,{...d,ref:r})})});W.displayName=$;var Z="AvatarImage",J=m.forwardRef((s,r)=>{const{__scopeAvatar:i,src:d,onLoadingStatusChange:c=()=>{},...a}=s,l=Q(Z,i),u=Ge(d,a),f=fe(h=>{c(h),l.onImageLoadingStatusChange(h)});return k(()=>{u!=="idle"&&f(u)},[u,f]),u==="loaded"?e.jsx(T.img,{...a,ref:r,src:d}):null});J.displayName=Z;var X="AvatarFallback",Y=m.forwardRef((s,r)=>{const{__scopeAvatar:i,delayMs:d,...c}=s,a=Q(X,i),[l,u]=m.useState(d===void 0);return m.useEffect(()=>{if(d!==void 0){const f=window.setTimeout(()=>u(!0),d);return()=>window.clearTimeout(f)}},[d]),l&&a.imageLoadingStatus!=="loaded"?e.jsx(T.span,{...c,ref:r}):null});Y.displayName=X;function K(s,r){return s?r?(s.src!==r&&(s.src=r),s.complete&&s.naturalWidth>0?"loaded":"loading"):"error":"idle"}function Ge(s,{referrerPolicy:r,crossOrigin:i}){const d=De(),c=m.useRef(null),a=d?(c.current||(c.current=new window.Image),c.current):null,[l,u]=m.useState(()=>K(a,s));return k(()=>{u(K(a,s))},[a,s]),k(()=>{const f=n=>()=>{u(n)};if(!a)return;const h=f("loaded"),j=f("error");return a.addEventListener("load",h),a.addEventListener("error",j),r&&(a.referrerPolicy=r),typeof i=="string"&&(a.crossOrigin=i),()=>{a.removeEventListener("load",h),a.removeEventListener("error",j)}},[a,i,r]),l}var ee=W,se=J,re=Y;const te=m.forwardRef(({className:s,...r},i)=>e.jsx(ee,{ref:i,className:M("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",s),...r}));te.displayName=ee.displayName;const ae=m.forwardRef(({className:s,...r},i)=>e.jsx(se,{ref:i,className:M("aspect-square h-full w-full",s),...r}));ae.displayName=se.displayName;const ie=m.forwardRef(({className:s,...r},i)=>e.jsx(re,{ref:i,className:M("flex h-full w-full items-center justify-center rounded-full bg-muted",s),...r}));ie.displayName=re.displayName;const Ke=s=>s!=="coach"&&s!=="admin"&&s!=="comite",Oe=s=>{switch(s){case"coach":return"Entraineur EAC";case"admin":return"Admin";case"comite":return"Comité";default:return"Nageur"}};function Qe(s){if(!s)return"-";const r=new Date(s);return Number.isNaN(r.getTime())?s:r.toLocaleDateString("fr-FR")}const We=O({group_id:N().optional(),objectives:N().optional(),bio:N().optional(),avatar_url:N().url("URL invalide").optional().or(Ae("")),birthdate:N().optional().refine(s=>{if(!s)return!0;const r=new Date(s);if(isNaN(r.getTime()))return!1;const i=(new Date().getTime()-r.getTime())/(1e3*60*60*24*365.25);return i>=6&&i<=100},{message:"L'âge doit être entre 6 et 100 ans"}),ffn_iuf:N().optional().refine(s=>s?/^\d+$/.test(s):!0,{message:"L'IUF FFN doit être un nombre"})}),Ze=O({password:N().min(8,"Le mot de passe doit contenir au moins 8 caractères").regex(/[A-Z]/,"Le mot de passe doit contenir au moins une majuscule").regex(/\d/,"Le mot de passe doit contenir au moins un chiffre"),confirmPassword:N()}).refine(s=>s.password===s.confirmPassword,{message:"Les mots de passe ne correspondent pas",path:["confirmPassword"]});function ps(){const{user:s,userId:r,logout:i,role:d}=ge(),{toast:c}=je(),a=we(),l=Ke(d),u=d==="athlete"||d==="coach"||d==="admin",f=Oe(d),[h,j]=m.useState(!1),n=z({resolver:G(We),defaultValues:{group_id:"",objectives:"",bio:"",avatar_url:"",birthdate:"",ffn_iuf:""}}),g=z({resolver:G(Ze),defaultValues:{password:"",confirmPassword:""}}),{data:o,isLoading:b,error:L,refetch:P}=H({queryKey:["profile",s,r],queryFn:()=>_.getProfile({displayName:s,userId:r}),enabled:!!s}),{data:U=[],isLoading:q,error:ne,refetch:oe}=H({queryKey:["profile-groups"],queryFn:()=>_.getGroups(),enabled:!!s}),B=L||ne,ce=()=>{P(),oe()},le=m.useMemo(()=>{const t=o?.avatar_url;return t||(s?`https://api.dicebear.com/7.x/initials/svg?seed=${encodeURIComponent(s)}`:"")},[o,s]),A=R({mutationFn:t=>_.updateProfile({userId:r,profile:{group_id:t.group_id?Number(t.group_id):null,birthdate:t.birthdate||null,objectives:t.objectives,bio:t.bio,avatar_url:t.avatar_url,ffn_iuf:(t.ffn_iuf||"").trim()||null}}),onSuccess:()=>{a.invalidateQueries({queryKey:["profile"]}),j(!1),c({title:"Profil mis à jour"})},onError:t=>{c({title:"Mise à jour impossible",description:String(t?.message||t),variant:"destructive"})}}),D=R({mutationFn:t=>_.authPasswordUpdate(t),onSuccess:()=>{g.reset(),c({title:"Mot de passe mis à jour"})},onError:t=>{c({title:"Mise à jour impossible",description:String(t?.message||t),variant:"destructive"})}}),C=R({mutationFn:async()=>{const t=String(o?.ffn_iuf??"").trim();if(!t)throw new Error("IUF FFN manquant. Ajoutez-le dans votre profil.");return _.syncFfnSwimRecords({athleteId:r??void 0,athleteName:s??void 0,iuf:t})},onSuccess:t=>{a.invalidateQueries({queryKey:["swim-records"]}),c({title:"Records FFN importés",description:`${t?.inserted??0} ajouté(s), ${t?.updated??0} mis à jour, ${t?.skipped??0} inchangé(s)`})},onError:t=>{c({title:"Import FFN impossible",description:String(t?.message||t),variant:"destructive"})}}),de=()=>{n.reset({group_id:o?.group_id?String(o.group_id):"",objectives:o?.objectives||"",bio:o?.bio||"",avatar_url:o?.avatar_url||"",birthdate:o?.birthdate?String(o.birthdate).split("T")[0]:"",ffn_iuf:o?.ffn_iuf?String(o.ffn_iuf):""}),j(!0)},ue=n.handleSubmit(t=>{A.mutate(t)}),me=g.handleSubmit(t=>{D.mutate({password:t.password})}),V=U.find(t=>t.id===o?.group_id)?.name||o?.group_label||"Non défini";return b?e.jsxs("div",{className:"space-y-6",children:[e.jsx(p,{className:"h-10 w-32"}),e.jsxs(S,{children:[e.jsx(F,{children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(p,{className:"h-16 w-16 rounded-full"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{className:"h-6 w-32"}),e.jsx(p,{className:"h-4 w-24"})]})]})}),e.jsx(y,{children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{className:"h-4 w-16"}),e.jsx(p,{className:"h-5 w-24"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{className:"h-4 w-24"}),e.jsx(p,{className:"h-5 w-20"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{className:"h-4 w-20"}),e.jsx(p,{className:"h-5 w-28"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{className:"h-4 w-16"}),e.jsx(p,{className:"h-5 w-32"})]}),e.jsxs("div",{className:"col-span-2 space-y-2",children:[e.jsx(p,{className:"h-4 w-12"}),e.jsx(p,{className:"h-12 w-full"})]})]})})]})]}):B?e.jsxs("div",{className:"flex flex-col items-center justify-center p-8 text-center",children:[e.jsx(Re,{className:"h-12 w-12 text-destructive mb-4"}),e.jsx("h3",{className:"font-semibold",children:"Impossible de charger les données"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:B.message}),e.jsx(v,{onClick:()=>ce(),className:"mt-4",children:"Réessayer"})]}):e.jsxs(Ie.div,{className:"space-y-6",variants:Ee,initial:"hidden",animate:"visible",children:[e.jsx("div",{className:"rounded-xl bg-accent text-accent-foreground p-5",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(te,{className:"h-20 w-20 ring-2 ring-primary ring-offset-2 ring-offset-accent",children:[e.jsx(ae,{src:le,alt:s||"Profil"}),e.jsx(ie,{className:"text-lg",children:(s||"?").slice(0,2).toUpperCase()})]}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h1",{className:"text-2xl font-display font-bold uppercase italic text-accent-foreground truncate",children:s}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 mt-1",children:[e.jsx(Pe,{variant:"secondary",className:"text-xs",children:f}),e.jsx("span",{className:"text-sm opacity-80",children:V})]}),l&&String(o?.ffn_iuf??"").trim()&&e.jsxs("p",{className:"text-xs opacity-60 mt-1",children:["IUF ",o?.ffn_iuf]})]}),e.jsx(v,{variant:"ghost",size:"icon",className:"shrink-0 text-accent-foreground hover:bg-accent-foreground/10",onClick:de,"aria-label":"Modifier le profil",children:e.jsx(ke,{className:"h-4 w-4"})})]})}),e.jsxs(S,{children:[e.jsx(y,{className:"space-y-4 pt-6",children:h?e.jsxs("form",{onSubmit:ue,className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(x,{children:"Groupe"}),e.jsxs(ye,{value:n.watch("group_id"),onValueChange:t=>n.setValue("group_id",t),disabled:q,children:[e.jsx(_e,{children:e.jsx(Ce,{placeholder:q?"Chargement...":"Choisir un groupe"})}),e.jsx(Fe,{children:U.map(t=>e.jsx(Le,{value:String(t.id),children:t.name},t.id))})]})]}),l?e.jsxs("div",{className:"grid gap-2",children:[e.jsx(x,{children:"IUF FFN"}),e.jsx(w,{...n.register("ffn_iuf"),placeholder:"879576",inputMode:"numeric"}),n.formState.errors.ffn_iuf&&e.jsx("p",{className:"text-xs text-destructive",role:"alert","aria-live":"assertive",children:n.formState.errors.ffn_iuf.message}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Identifiant unique FFN (utilisé pour importer vos records compétition)."})]}):null,e.jsxs("div",{className:"grid gap-2",children:[e.jsx(x,{children:"Objectifs"}),e.jsx(w,{...n.register("objectives")}),n.formState.errors.objectives&&e.jsx("p",{className:"text-xs text-destructive",role:"alert","aria-live":"assertive",children:n.formState.errors.objectives.message})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(x,{children:"Bio"}),e.jsx(Se,{...n.register("bio")}),n.formState.errors.bio&&e.jsx("p",{className:"text-xs text-destructive",role:"alert","aria-live":"assertive",children:n.formState.errors.bio.message})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(x,{children:"Avatar (URL)"}),e.jsx(w,{...n.register("avatar_url"),placeholder:"https://..."}),n.formState.errors.avatar_url&&e.jsx("p",{className:"text-xs text-destructive",role:"alert","aria-live":"assertive",children:n.formState.errors.avatar_url.message})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(x,{children:"Date de naissance"}),e.jsx(w,{type:"date",...n.register("birthdate")}),n.formState.errors.birthdate&&e.jsx("p",{className:"text-xs text-destructive",role:"alert","aria-live":"assertive",children:n.formState.errors.birthdate.message})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(v,{type:"submit",disabled:A.isPending,className:"w-full",children:[e.jsx(Me,{className:"mr-2 h-4 w-4"}),"Enregistrer"]}),e.jsx(v,{type:"button",variant:"outline",onClick:()=>j(!1),disabled:A.isPending,children:"Annuler"})]})]}):e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx(x,{className:"text-xs text-muted-foreground uppercase",children:"Groupe"}),e.jsx("div",{className:"font-medium",children:V})]}),e.jsxs("div",{children:[e.jsx(x,{className:"text-xs text-muted-foreground uppercase",children:"Date de naissance"}),e.jsx("div",{className:"font-medium",children:Qe(o?.birthdate??null)})]}),l?e.jsxs("div",{children:[e.jsx(x,{className:"text-xs text-muted-foreground uppercase",children:"IUF FFN"}),e.jsx("div",{className:"font-medium",children:String(o?.ffn_iuf??"")||"Non renseigné"})]}):null,e.jsxs("div",{className:l?"":"col-span-2",children:[e.jsx(x,{className:"text-xs text-muted-foreground uppercase",children:"Objectifs"}),e.jsx("div",{className:"font-medium",children:o?.objectives||"Aucun objectif défini."})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx(x,{className:"text-xs text-muted-foreground uppercase",children:"Bio"}),e.jsx("div",{className:"font-medium",children:o?.bio||"Non renseignée."})]})]})}),e.jsx(ve,{className:"flex justify-end",children:e.jsxs(v,{variant:"outline",onClick:i,className:"gap-2",children:[e.jsx($e,{className:"h-4 w-4"}),"Se déconnecter"]})})]}),l?e.jsxs(S,{children:[e.jsxs(F,{children:[e.jsx(I,{children:"FFN"}),e.jsx(E,{children:"Importer vos records compétition depuis Extranat."})]}),e.jsxs(y,{className:"space-y-3",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:["IUF enregistré : ",e.jsx("span",{className:"font-medium text-foreground",children:String(o?.ffn_iuf??"")||"—"})]}),e.jsxs(v,{className:"w-full gap-2",onClick:()=>C.mutate(),disabled:C.isPending||!String(o?.ffn_iuf??"").trim(),children:[e.jsx(Ne,{className:["h-4 w-4",C.isPending?"animate-spin":""].join(" ")}),C.isPending?"Import en cours...":"Récupérer records depuis FFN"]}),String(o?.ffn_iuf??"").trim()?null:e.jsx("div",{className:"text-xs text-muted-foreground",children:"Ajoutez votre IUF FFN dans le profil (bouton crayon) pour activer l’import."})]})]}):null,u?e.jsxs(S,{children:[e.jsxs(F,{children:[e.jsx(I,{children:"Mot de passe"}),e.jsx(E,{children:"Modifiez votre mot de passe."})]}),e.jsx(y,{children:e.jsxs("form",{onSubmit:me,className:"space-y-3",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(x,{children:"Nouveau mot de passe"}),e.jsx(w,{type:"password",...g.register("password"),placeholder:"••••••••"}),g.formState.errors.password&&e.jsx("p",{className:"text-xs text-destructive",role:"alert","aria-live":"assertive",children:g.formState.errors.password.message})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(x,{children:"Confirmer"}),e.jsx(w,{type:"password",...g.register("confirmPassword"),placeholder:"••••••••"}),g.formState.errors.confirmPassword&&e.jsx("p",{className:"text-xs text-destructive",role:"alert","aria-live":"assertive",children:g.formState.errors.confirmPassword.message})]}),e.jsx(v,{type:"submit",className:"w-full",disabled:D.isPending,children:"Mettre à jour le mot de passe"})]})})]}):null,l?e.jsxs(S,{children:[e.jsxs(F,{children:[e.jsx(I,{children:"Records"}),e.jsx(E,{children:"Consultez vos records de natation et musculation."})]}),e.jsx(y,{children:e.jsx(be,{href:"/records",children:e.jsx(v,{asChild:!0,children:e.jsx("a",{children:"Voir mes records"})})})})]}):null]})}export{ps as default,Oe as getRoleLabel,Ke as shouldShowRecords};
