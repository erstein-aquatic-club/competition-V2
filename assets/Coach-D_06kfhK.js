import{r as c,b as ts,h as rs,l as ns,m as tt,j as e,d as as,n as rt,o as ve,u as Ie,I as nt,p as vs,q as er,R as he,c as sr,s as at,t as tr,v as rr,A as it,w as nr,x as ar,y as ir,z as lr,F as or,D as cr,B as dr,E as ur}from"./vendor-ui-CDk0TPZB.js";import{h as fe,k as K,i as is,L as k,I as V,B as S,C as G,b as J,c as X,f as H,d as ee,s as As,g as q,u as Le,l as mr,M as ls,a as pr,U as Be,W as Ps,D as xr,T as hr}from"./index-BkViUTIv.js";import{b as lt,u as ge,c as de}from"./vendor-query-BoCJU2ZS.js";import{u as fr,S as ue,a as me,b as pe,c as xe,d as z,C as gr}from"./select-opBc9ibw.js";import{C as jr,P as je}from"./plus-D1x73Mrp.js";import{T as Pe}from"./textarea-CfJDbbrX.js";import{D as De,a as Me,b as us,c as ms}from"./dialog-DoDUqi9p.js";import{C as fs}from"./checkbox-Dj7myxUA.js";import{L as Ds,A as He,a as We,b as Qe,c as Je,d as Xe,e as Ye,f as Ze,g as es,P as Ms}from"./alert-dialog-BQmekb2X.js";import{T as vr,a as yr,b as br,c as Nr}from"./tabs-CHw454rl.js";import{S as Ue,P as Ts}from"./save-BBwW1Fcw.js";import{c as ot,R as wr,i as Fs,g as _r,S as $s,a as Cr,L as Sr}from"./SwimSessionConsultation-CNRAknt3.js";import{f as kr}from"./vendor-date-cQbdWov0.js";import{C as Rr}from"./chevron-left-CMGjWVRA.js";import{S as Er}from"./search-DS5aNgUJ.js";import{T as Ar}from"./timer-iQQnKTIU.js";import{T as Pr,a as Dr,b as Vs,c as ps,d as Mr,e as xs}from"./table-pi38kGds.js";import{B as Tr}from"./badge-BF5GSsZM.js";import{A as Fr}from"./arrow-left-CU9kbUpa.js";import"./vendor-react-BzrpNAyj.js";import"./vendor-charts-bGfQb4ap.js";import"./vendor-supabase-CgI36rMY.js";import"./check-DCRb9OgG.js";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $r=[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8",key:"1s80jp"}],["path",{d:"M10 12h4",key:"a56b0p"}]],Vr=fe("archive",$r);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ir=[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]],Is=fe("arrow-down",Ir);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Or=[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]],Os=fe("arrow-up",Or);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qr=[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326",key:"11g9vi"}]],$e=fe("bell",qr);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zr=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],Gr=fe("eye",zr);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lr=[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]],Br=fe("funnel",Lr);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ur=[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]],ct=fe("grip-vertical",Ur);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Kr=[["path",{d:"M2 9.5a5.5 5.5 0 0 1 9.591-3.676.56.56 0 0 0 .818 0A5.49 5.49 0 0 1 22 9.5c0 2.29-1.5 4-3 5.5l-5.492 5.313a2 2 0 0 1-3 .019L5 15c-1.5-1.5-3-3.2-3-5.5",key:"mvr1a0"}],["path",{d:"M3.22 13H9.5l.5-1 2 4.5 2-7 1.5 3.5h5.27",key:"auskq0"}]],qs=fe("heart-pulse",Kr);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hr=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]],Wr=fe("pencil",Hr);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qr=[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],ye=fe("trash-2",Qr);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jr=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],zs=fe("upload",Jr);function gs(s,a,{checkForDefaultPrevented:r=!0}={}){return function(t){if(s?.(t),r===!1||!t.defaultPrevented)return a?.(t)}}var Xr=ts[" useInsertionEffect ".trim().toString()]||rs;function Yr({prop:s,defaultProp:a,onChange:r=()=>{},caller:n}){const[t,i,o]=Zr({defaultProp:a,onChange:r}),d=s!==void 0,j=d?s:t;{const p=c.useRef(s!==void 0);c.useEffect(()=>{const m=p.current;m!==d&&console.warn(`${n} is changing from ${m?"controlled":"uncontrolled"} to ${d?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),p.current=d},[d,n])}const x=c.useCallback(p=>{if(d){const m=en(p)?p(s):p;m!==s&&o.current?.(m)}else i(p)},[d,s,i,o]);return[j,x]}function Zr({defaultProp:s,onChange:a}){const[r,n]=c.useState(s),t=c.useRef(r),i=c.useRef(a);return Xr(()=>{i.current=a},[a]),c.useEffect(()=>{t.current!==r&&(i.current?.(r),t.current=r)},[r,t]),[r,n,i]}function en(s){return typeof s=="function"}var ys="Radio",[sn,dt]=as(ys),[tn,rn]=sn(ys),ut=c.forwardRef((s,a)=>{const{__scopeRadio:r,name:n,checked:t=!1,required:i,disabled:o,value:d="on",onCheck:j,form:x,...p}=s,[m,f]=c.useState(null),C=Ie(a,y=>f(y)),N=c.useRef(!1),I=m?x||!!m.closest("form"):!0;return e.jsxs(tn,{scope:r,checked:t,disabled:o,children:[e.jsx(ve.button,{type:"button",role:"radio","aria-checked":t,"data-state":ht(t),"data-disabled":o?"":void 0,disabled:o,value:d,...p,ref:C,onClick:gs(s.onClick,y=>{t||j?.(),I&&(N.current=y.isPropagationStopped(),N.current||y.stopPropagation())})}),I&&e.jsx(xt,{control:m,bubbles:!N.current,name:n,value:d,checked:t,required:i,disabled:o,form:x,style:{transform:"translateX(-100%)"}})]})});ut.displayName=ys;var mt="RadioIndicator",pt=c.forwardRef((s,a)=>{const{__scopeRadio:r,forceMount:n,...t}=s,i=rn(mt,r);return e.jsx(vs,{present:n||i.checked,children:e.jsx(ve.span,{"data-state":ht(i.checked),"data-disabled":i.disabled?"":void 0,...t,ref:a})})});pt.displayName=mt;var nn="RadioBubbleInput",xt=c.forwardRef(({__scopeRadio:s,control:a,checked:r,bubbles:n=!0,...t},i)=>{const o=c.useRef(null),d=Ie(o,i),j=fr(r),x=er(a);return c.useEffect(()=>{const p=o.current;if(!p)return;const m=window.HTMLInputElement.prototype,C=Object.getOwnPropertyDescriptor(m,"checked").set;if(j!==r&&C){const N=new Event("click",{bubbles:n});C.call(p,r),p.dispatchEvent(N)}},[j,r,n]),e.jsx(ve.input,{type:"radio","aria-hidden":!0,defaultChecked:r,...t,tabIndex:-1,ref:d,style:{...t.style,...x,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});xt.displayName=nn;function ht(s){return s?"checked":"unchecked"}var an=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],os="RadioGroup",[ln]=as(os,[ns,dt]),ft=ns(),gt=dt(),[on,cn]=ln(os),jt=c.forwardRef((s,a)=>{const{__scopeRadioGroup:r,name:n,defaultValue:t,value:i,required:o=!1,disabled:d=!1,orientation:j,dir:x,loop:p=!0,onValueChange:m,...f}=s,C=ft(r),N=tt(x),[I,y]=Yr({prop:i,defaultProp:t??null,onChange:m,caller:os});return e.jsx(on,{scope:r,name:n,required:o,disabled:d,value:I,onValueChange:y,children:e.jsx(rt,{asChild:!0,...C,orientation:j,dir:N,loop:p,children:e.jsx(ve.div,{role:"radiogroup","aria-required":o,"aria-orientation":j,"data-disabled":d?"":void 0,dir:N,...f,ref:a})})})});jt.displayName=os;var vt="RadioGroupItem",yt=c.forwardRef((s,a)=>{const{__scopeRadioGroup:r,disabled:n,...t}=s,i=cn(vt,r),o=i.disabled||n,d=ft(r),j=gt(r),x=c.useRef(null),p=Ie(a,x),m=i.value===t.value,f=c.useRef(!1);return c.useEffect(()=>{const C=I=>{an.includes(I.key)&&(f.current=!0)},N=()=>f.current=!1;return document.addEventListener("keydown",C),document.addEventListener("keyup",N),()=>{document.removeEventListener("keydown",C),document.removeEventListener("keyup",N)}},[]),e.jsx(nt,{asChild:!0,...d,focusable:!o,active:m,children:e.jsx(ut,{disabled:o,required:i.required,checked:m,...j,...t,name:i.name,ref:p,onCheck:()=>i.onValueChange(t.value),onKeyDown:gs(C=>{C.key==="Enter"&&C.preventDefault()}),onFocus:gs(t.onFocus,()=>{f.current&&x.current?.click()})})})});yt.displayName=vt;var dn="RadioGroupIndicator",bt=c.forwardRef((s,a)=>{const{__scopeRadioGroup:r,...n}=s,t=gt(r);return e.jsx(pt,{...t,...n,ref:a})});bt.displayName=dn;var Nt=jt,wt=yt,un=bt;const _t=c.forwardRef(({className:s,...a},r)=>e.jsx(Nt,{className:K("grid gap-2",s),...a,ref:r}));_t.displayName=Nt.displayName;const js=c.forwardRef(({className:s,...a},r)=>e.jsx(wt,{ref:r,className:K("aspect-square h-4 w-4 rounded-full border border-primary text-primary shadow focus:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",s),...a,children:e.jsx(un,{className:"flex items-center justify-center",children:e.jsx(jr,{className:"h-3.5 w-3.5 fill-primary"})})}));js.displayName=wt.displayName;const Gs=[{key:"endurance",label:"Endurance",fieldSuffix:"endurance"},{key:"hypertrophie",label:"Hypertrophie",fieldSuffix:"hypertrophie"},{key:"force",label:"Force",fieldSuffix:"force"}],Ls=s=>s==="endurance"||s==="hypertrophie"||s==="force"?s:"endurance",Bs=({exercise:s,onChange:a,disabled:r=!1})=>e.jsxs(vr,{defaultValue:"endurance",className:"w-full",children:[e.jsx(yr,{className:"grid w-full grid-cols-3",children:Gs.map(n=>e.jsx(br,{value:n.key,children:n.label},n.key))}),Gs.map(n=>{const t=`pct_1rm_${n.fieldSuffix}`,i=`Nb_series_${n.fieldSuffix}`,o=`Nb_reps_${n.fieldSuffix}`,d=`recup_${n.fieldSuffix}`,j=`recup_exercices_${n.fieldSuffix}`;return e.jsxs(Nr,{value:n.key,className:`space-y-3 rounded-lg border p-3 ${r?"opacity-60":""}`,children:[e.jsx("p",{className:"text-sm font-semibold",children:n.label}),e.jsxs("div",{className:"grid gap-3 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{children:"% 1RM"}),e.jsx(V,{type:"number",value:s[t]??"",disabled:r,onChange:x=>a({[t]:x.target.value===""?null:Number(x.target.value)})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{children:"Nb séries"}),e.jsx(V,{type:"number",value:s[i]??"",disabled:r,onChange:x=>a({[i]:x.target.value===""?null:Number(x.target.value)})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{children:"Nb reps"}),e.jsx(V,{type:"number",value:s[o]??"",disabled:r,onChange:x=>a({[o]:x.target.value===""?null:Number(x.target.value)})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{children:"Récup. séries (s)"}),e.jsx(V,{type:"number",value:s[d]??"",disabled:r,onChange:x=>a({[d]:x.target.value===""?null:Number(x.target.value)})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{children:"Récup. exercices (s)"}),e.jsx(V,{type:"number",value:s[j]??"",disabled:r,onChange:x=>a({[j]:x.target.value===""?null:Number(x.target.value)})})]})]})]},n.key)})]}),mn={pct_1rm_endurance:60,pct_1rm_hypertrophie:75,pct_1rm_force:85,Nb_series_endurance:4,Nb_series_hypertrophie:3,Nb_series_force:3,Nb_reps_endurance:16,Nb_reps_hypertrophie:8,Nb_reps_force:3,recup_endurance:120,recup_hypertrophie:200,recup_force:300,recup_exercices_endurance:300,recup_exercices_hypertrophie:400,recup_exercices_force:500},Ge=s=>{const a=Number(s);return Number.isFinite(a)?a:0},Us=(s,a,r,n)=>{const t=a==="force"?"force":a==="hypertrophie"?"hypertrophie":"endurance",i=`Nb_series_${t}`,o=`Nb_reps_${t}`,d=`pct_1rm_${t}`,j=`recup_${t}`;return{exercise_id:s.id,order_index:r,sets:Ge(s[i]),reps:Ge(s[o]),rest_seconds:Ge(s[j]),percent_1rm:Ge(s[d]),cycle_type:a,notes:n?.notes??""}},pn=()=>({nom_exercice:"",description:null,illustration_gif:null,exercise_type:"strength",warmup_reps:null,warmup_duration:null,...mn}),Ks=({exercise:s,warmupMode:a,onChange:r,onWarmupModeChange:n,idPrefix:t})=>e.jsxs("div",{className:"space-y-3 rounded-lg border p-3",children:[e.jsx("p",{className:"text-sm font-semibold",children:"Paramètres d’échauffement"}),e.jsxs(_t,{value:a,onValueChange:i=>{n(i==="duration"?"duration":"reps"),r(i==="duration"?{warmup_reps:null,warmup_duration:s.warmup_duration??0}:{warmup_duration:null,warmup_reps:s.warmup_reps??0})},className:"grid gap-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(js,{value:"reps",id:`${t}-warmup-reps`}),e.jsx(k,{htmlFor:`${t}-warmup-reps`,children:"Nombre de répétitions"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(js,{value:"duration",id:`${t}-warmup-duration`}),e.jsx(k,{htmlFor:`${t}-warmup-duration`,children:"Durée (secondes)"})]})]}),a==="duration"?e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{children:"Durée (s)"}),e.jsx(V,{type:"number",value:s.warmup_duration??"",onChange:i=>r({warmup_duration:i.target.value===""?null:Number(i.target.value)})})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{children:"Nombre de répétitions"}),e.jsx(V,{type:"number",value:s.warmup_reps??"",onChange:i=>r({warmup_reps:i.target.value===""?null:Number(i.target.value)})})]})]});function xn(){const{toast:s}=is(),a=lt(),[r,n]=c.useState(!1),[t,i]=c.useState(null),[o,d]=c.useState("all"),[j,x]=c.useState(!1),[p,m]=c.useState(!1),[f,C]=c.useState(null),[N,I]=c.useState(null),[y,ne]=c.useState(!1),[se,w]=c.useState(null),[D,oe]=c.useState(null),[R,te]=c.useState(null),[we,h]=c.useState(null),[M,Y]=c.useState("reps"),[W,E]=c.useState("reps"),[L,re]=c.useState(!1),Z=async(l,g)=>{if(l.size>10485760){s({title:"Fichier trop volumineux",description:"La taille maximale est de 10 Mo.",variant:"destructive"});return}re(!0);try{const B=l.name.split(".").pop()??"gif",Q=`exercises/${Date.now()}-${Math.random().toString(36).slice(2)}.${B}`,{error:ze}=await As.storage.from("exercise-gifs").upload(Q,l,{upsert:!1});if(ze)throw ze;const{data:Zt}=As.storage.from("exercise-gifs").getPublicUrl(Q);g(Zt.publicUrl),s({title:"Image uploadée"})}catch(B){const Q=B instanceof Error?B.message:"Réessayez.";s({title:"Erreur d'upload",description:Q,variant:"destructive"})}finally{re(!1)}},[P,F]=c.useState({title:"",description:"",cycle:"endurance",items:[]}),[U,ae]=c.useState({...pn()});c.useEffect(()=>{f&&E(f.warmup_duration!=null?"duration":"reps")},[f]);const{data:ce}=ge({queryKey:["exercises"],queryFn:()=>q.getExercises()}),{data:Re}=ge({queryKey:["strength_catalog"],queryFn:()=>q.getStrengthSessions()}),Ae=c.useMemo(()=>new Map((ce??[]).map(l=>[l.id,l])),[ce]),$=de({mutationFn:l=>q.createExercise(l),onSuccess:()=>{a.invalidateQueries({queryKey:["exercises"]}),x(!1),s({title:"Exercice ajouté"})}}),ie=de({mutationFn:l=>q.createStrengthSession(l),onSuccess:()=>{a.invalidateQueries({queryKey:["strength_catalog"]}),n(!1),F({title:"",description:"",cycle:"endurance",items:[]}),s({title:"Séance créée avec succès"})}}),_e=de({mutationFn:l=>q.updateExercise(l),onSuccess:()=>{a.invalidateQueries({queryKey:["exercises"]}),a.invalidateQueries({queryKey:["strength_catalog"]}),m(!1),C(null),s({title:"Exercice mis à jour"})}}),Ce=de({mutationFn:l=>q.deleteExercise(l),onSuccess:()=>{a.invalidateQueries({queryKey:["exercises"]}),a.invalidateQueries({queryKey:["strength_catalog"]}),oe(null),s({title:"Exercice supprimé"})}}),u=de({mutationFn:l=>q.deleteStrengthSession(l),onSuccess:()=>{a.invalidateQueries({queryKey:["strength_catalog"]}),w(null),s({title:"Séance supprimée"})}}),v=de({mutationFn:l=>q.updateStrengthSession(l),onSuccess:()=>{a.invalidateQueries({queryKey:["strength_catalog"]}),n(!1),i(null),F({title:"",description:"",cycle:"endurance",items:[]}),s({title:"Séance mise à jour"})}}),b=de({mutationFn:l=>q.persistStrengthSessionOrder(l)}),T=()=>{n(!1),i(null),F({title:"",description:"",cycle:"endurance",items:[]})},O=l=>{i(l.id),F({title:l.title??"",description:l.description??"",cycle:Ls(l.cycle),items:l.items?.map(g=>({exercise_id:g.exercise_id,order_index:g.order_index??0,sets:g.sets,reps:g.reps,rest_seconds:g.rest_seconds,percent_1rm:g.percent_1rm,cycle_type:g.cycle_type,notes:g.notes??""}))??[]}),n(!0)},le=l=>{C(l),m(!0)},A=()=>{const l={...P,items:Se(P.items)};t?v.mutate({...l,id:t}):ie.mutate(l)},Se=l=>l.map((g,_)=>({...g,order_index:_})),qe=()=>{const l=ce?.[0];F(g=>({...g,items:[...g.items,l?Us(l,g.cycle,g.items.length):{exercise_id:1,order_index:g.items.length,sets:0,reps:0,rest_seconds:0,percent_1rm:0}]}))},ke=(l,g,_)=>{const B=[...P.items];if(g==="exercise_id"){const Q=ce?.find(ze=>ze.id===_);Q?B[l]=Us(Q,P.cycle,B[l].order_index??l,B[l]):B[l]={...B[l],exercise_id:Number(_)}}else B[l]={...B[l],[g]:_};F({...P,items:B})},ds=l=>{const g=Se(P.items.filter((_,B)=>B!==l));F({...P,items:g})},Xt=(l,g)=>{if(l===g)return;const _=[...P.items],[B]=_.splice(l,1);_.splice(g,0,B);const Q=Se(_);F({...P,items:Q}),t&&b.mutate({id:t,title:P.title,description:P.description,cycle:P.cycle,items:Q})},Yt=new Set(P.items.map(l=>l.exercise_id)),_s=ce?.filter(l=>o==="all"||Yt.has(l.id)?!0:l.exercise_type===o)??[],Cs=e.jsx(De,{open:p,onOpenChange:m,children:e.jsxs(Me,{className:"sm:max-w-3xl max-h-[85vh] overflow-y-auto pb-safe",children:[e.jsx(us,{children:e.jsx(ms,{children:"Modifier l’exercice"})}),f&&e.jsxs("div",{className:"space-y-4",children:[f.exercise_type==="warmup"?e.jsx(Ks,{exercise:f,warmupMode:W,onChange:l=>C(g=>g&&{...g,...l}),onWarmupModeChange:E,idPrefix:"edit"}):null,e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{children:"Nom"}),e.jsx(V,{value:f.nom_exercice,onChange:l=>C({...f,nom_exercice:l.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{children:"Description"}),e.jsx(Pe,{value:f.description??"",onChange:l=>C({...f,description:l.target.value===""?null:l.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{children:"Illustration (GIF)"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(V,{value:f.illustration_gif??"",onChange:l=>C({...f,illustration_gif:l.target.value===""?null:l.target.value}),placeholder:"https://...",className:"flex-1"}),e.jsx(S,{type:"button",variant:"outline",size:"icon",disabled:L,onClick:()=>{const l=document.createElement("input");l.type="file",l.accept="image/*,.gif",l.onchange=g=>{const _=g.target.files?.[0];_&&Z(_,B=>C(Q=>Q&&{...Q,illustration_gif:B}))},l.click()},"aria-label":"Uploader une image",children:L?e.jsx(Ds,{className:"h-4 w-4 animate-spin"}):e.jsx(zs,{className:"h-4 w-4"})})]}),f.illustration_gif&&e.jsx("img",{src:f.illustration_gif,alt:"Aperçu",className:"mt-2 h-20 w-20 rounded-lg object-cover border"})]}),f.exercise_type!=="warmup"?e.jsx(Bs,{exercise:f,onChange:l=>C(g=>g&&{...g,...l})}):null,e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(fs,{id:"warmup-flag-edit",checked:f.exercise_type==="warmup",onCheckedChange:l=>C({...f,exercise_type:l===!0?"warmup":"strength"})}),e.jsx(k,{htmlFor:"warmup-flag-edit",children:"Exercice d’échauffement (warmup)"})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(S,{variant:"outline",onClick:()=>{m(!1),C(null)},children:"Annuler"}),e.jsxs(S,{onClick:()=>{f?.id&&_e.mutate(f)},disabled:!f.nom_exercice.trim(),children:[e.jsx(Ue,{className:"mr-2 h-4 w-4"})," Enregistrer"]})]})]})]})}),Ss=e.jsx(De,{open:j,onOpenChange:x,children:e.jsxs(Me,{className:"sm:max-w-3xl max-h-[85vh] overflow-y-auto pb-safe",children:[e.jsx(us,{children:e.jsx(ms,{children:"Créer un exercice"})}),e.jsxs("div",{className:"space-y-4",children:[U.exercise_type==="warmup"?e.jsx(Ks,{exercise:U,warmupMode:M,onChange:l=>ae(g=>({...g,...l})),onWarmupModeChange:Y,idPrefix:"create"}):null,e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{children:"Nom"}),e.jsx(V,{value:U.nom_exercice,onChange:l=>ae({...U,nom_exercice:l.target.value}),placeholder:"ex: Rotations Élastique"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{children:"Description"}),e.jsx(Pe,{value:U.description??"",onChange:l=>ae({...U,description:l.target.value===""?null:l.target.value}),placeholder:"Détails, consignes..."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{children:"Illustration (GIF)"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(V,{value:U.illustration_gif??"",onChange:l=>ae({...U,illustration_gif:l.target.value===""?null:l.target.value}),placeholder:"https://...",className:"flex-1"}),e.jsx(S,{type:"button",variant:"outline",size:"icon",disabled:L,onClick:()=>{const l=document.createElement("input");l.type="file",l.accept="image/*,.gif",l.onchange=g=>{const _=g.target.files?.[0];_&&Z(_,B=>ae(Q=>({...Q,illustration_gif:B})))},l.click()},"aria-label":"Uploader une image",children:L?e.jsx(Ds,{className:"h-4 w-4 animate-spin"}):e.jsx(zs,{className:"h-4 w-4"})})]}),U.illustration_gif&&e.jsx("img",{src:U.illustration_gif,alt:"Aperçu",className:"mt-2 h-20 w-20 rounded-lg object-cover border"})]}),U.exercise_type!=="warmup"?e.jsx(Bs,{exercise:U,onChange:l=>ae(g=>({...g,...l}))}):null,e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(fs,{id:"warmup-flag",checked:U.exercise_type==="warmup",onCheckedChange:l=>ae({...U,exercise_type:l===!0?"warmup":"strength"})}),e.jsx(k,{htmlFor:"warmup-flag",children:"Exercice d’échauffement (warmup)"})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(S,{variant:"outline",onClick:()=>x(!1),children:"Annuler"}),e.jsxs(S,{onClick:()=>$.mutate(U),disabled:!U.nom_exercice.trim(),children:[e.jsx(Ue,{className:"mr-2 h-4 w-4"})," Enregistrer"]})]})]})]})}),ks=e.jsx(De,{open:y,onOpenChange:l=>{ne(l),l||I(null)},children:e.jsxs(Me,{className:"sm:max-w-3xl",children:[e.jsx(us,{children:e.jsx(ms,{children:"Détails de la séance"})}),N&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-lg font-semibold",children:N.title}),e.jsx("p",{className:"text-sm text-muted-foreground",children:N.description||"—"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Cycle : ",N.cycle]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm font-semibold",children:"Exercices"}),e.jsx("div",{className:"space-y-2",children:(N.items??[]).slice().sort((l,g)=>(l.order_index??0)-(g.order_index??0)).map((l,g)=>{const _=Ae.get(l.exercise_id);return e.jsxs("div",{className:"rounded-md border px-3 py-2 text-sm",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("span",{className:"font-medium",children:[g+1,". ",_?.nom_exercice??l.exercise_name??"Exercice"]}),e.jsx("span",{className:"text-xs text-muted-foreground",children:_?.exercise_type==="warmup"||l.category==="warmup"?"Échauffement":"Travail"})]}),e.jsxs("div",{className:"mt-1 text-xs text-muted-foreground",children:[l.sets," séries • ",l.reps," reps • ",l.percent_1rm,"% 1RM • ",l.rest_seconds,"s"]})]},`${l.exercise_id}-${g}`)})})]})]})]})}),Rs=e.jsx(He,{open:!!se,onOpenChange:l=>{l||w(null)},children:e.jsxs(We,{children:[e.jsxs(Qe,{children:[e.jsx(Je,{children:"Supprimer la séance ?"}),e.jsxs(Xe,{children:['Cette action est définitive. La séance "',se?.title,'" sera supprimée.']})]}),e.jsxs(Ye,{children:[e.jsx(Ze,{children:"Annuler"}),e.jsx(es,{onClick:()=>{se?.id&&u.mutate(se.id)},children:"Supprimer"})]})]})}),Es=e.jsx(He,{open:!!D,onOpenChange:l=>{l||oe(null)},children:e.jsxs(We,{children:[e.jsxs(Qe,{children:[e.jsx(Je,{children:"Supprimer l’exercice ?"}),e.jsxs(Xe,{children:['Cette action est définitive. L’exercice "',D?.nom_exercice,'" sera supprimé.']})]}),e.jsxs(Ye,{children:[e.jsx(Ze,{children:"Annuler"}),e.jsx(es,{onClick:()=>{D?.id&&Ce.mutate(D.id)},children:"Supprimer"})]})]})});return r?e.jsxs("div",{className:"space-y-6 animate-in slide-in-from-bottom-4",children:[Ss,Cs,ks,Rs,Es,e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-bold uppercase",children:t?"Modifier Séance Muscu":"Nouvelle Séance Muscu"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(S,{variant:"outline",onClick:T,children:"Annuler"}),e.jsxs(S,{onClick:A,children:[e.jsx(Ue,{className:"mr-2 h-4 w-4"})," Enregistrer"]})]})]}),e.jsxs(G,{children:[e.jsx(J,{children:e.jsx(X,{children:"Informations Générales"})}),e.jsxs(H,{className:"space-y-4",children:[e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{children:"Titre"}),e.jsx(V,{value:P.title,onChange:l=>F({...P,title:l.target.value}),placeholder:"ex: Full Body A"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{children:"Cycle"}),e.jsxs(ue,{value:P.cycle,onValueChange:l=>F({...P,cycle:Ls(l)}),children:[e.jsx(me,{children:e.jsx(pe,{})}),e.jsxs(xe,{children:[e.jsx(z,{value:"endurance",children:"Endurance"}),e.jsx(z,{value:"hypertrophie",children:"Hypertrophie"}),e.jsx(z,{value:"force",children:"Force"})]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{children:"Description"}),e.jsx(Pe,{value:P.description,onChange:l=>F({...P,description:l.target.value})})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-bold",children:"Exercices"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(S,{size:"sm",variant:"outline",onClick:()=>x(!0),children:[e.jsx(je,{className:"mr-2 h-4 w-4"})," Nouvel exercice"]}),e.jsxs(S,{size:"sm",onClick:qe,children:[e.jsx(je,{className:"mr-2 h-4 w-4"})," Ajouter"]})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-[220px_1fr] items-end",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(k,{className:"flex items-center gap-2",children:[e.jsx(Br,{className:"h-4 w-4"})," Filtre exercices"]}),e.jsxs(ue,{value:o,onValueChange:l=>d(l),children:[e.jsx(me,{children:e.jsx(pe,{})}),e.jsxs(xe,{children:[e.jsx(z,{value:"all",children:"Tous"}),e.jsx(z,{value:"strength",children:"Séries de travail"}),e.jsx(z,{value:"warmup",children:"Échauffement"})]})]})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Les exercices marqués warmup sont affichés dans les séances avec le badge « Échauffement »."})]}),P.items.map((l,g)=>e.jsxs(G,{className:K("relative transition-all",we===g&&R!==null&&R!==g&&"ring-2 ring-primary bg-accent/30"),onDragOver:_=>_.preventDefault(),onDragEnter:()=>h(g),onDragLeave:()=>h(_=>_===g?null:_),onDrop:()=>{R!==null&&(Xt(R,g),te(null),h(null))},children:[e.jsx(S,{variant:"ghost",size:"icon",className:"absolute top-2 right-2 text-destructive",onClick:()=>ds(g),"aria-label":"Supprimer l'exercice",children:e.jsx(ye,{className:"h-4 w-4"})}),e.jsxs(H,{className:"pt-6 grid md:grid-cols-12 gap-4 items-end",children:[e.jsx("div",{className:"md:col-span-1 flex items-center justify-center",children:e.jsx("button",{type:"button",className:"cursor-grab rounded-md border p-1 text-muted-foreground hover:text-foreground",draggable:!0,onDragStart:()=>te(g),onDragEnd:()=>{te(null),h(null)},"aria-label":"Réordonner",children:e.jsx(ct,{className:"h-4 w-4"})})}),e.jsxs("div",{className:"md:col-span-3 space-y-2",children:[e.jsx(k,{children:"Exercice"}),e.jsxs(ue,{value:l.exercise_id.toString(),onValueChange:_=>ke(g,"exercise_id",parseInt(_)),children:[e.jsx(me,{children:e.jsx(pe,{})}),e.jsx(xe,{children:_s.length?_s.map(_=>e.jsxs(z,{value:_.id.toString(),children:[_.nom_exercice,_.exercise_type==="warmup"?" • Échauffement":""]},_.id)):e.jsx(z,{value:"no-exercise",disabled:!0,children:"Aucun exercice disponible"})})]})]}),e.jsxs("div",{className:"md:col-span-2 space-y-2",children:[e.jsx(k,{children:"Séries"}),e.jsx(V,{type:"number",value:l.sets===0?"":l.sets,onChange:_=>ke(g,"sets",_.target.value===""?0:Number(_.target.value))})]}),e.jsxs("div",{className:"md:col-span-2 space-y-2",children:[e.jsx(k,{children:"Reps"}),e.jsx(V,{type:"number",value:l.reps===0?"":l.reps,onChange:_=>ke(g,"reps",_.target.value===""?0:Number(_.target.value))})]}),e.jsxs("div",{className:"md:col-span-2 space-y-2",children:[e.jsx(k,{children:"% 1RM"}),e.jsx(V,{type:"number",value:l.percent_1rm===0?"":l.percent_1rm,onChange:_=>ke(g,"percent_1rm",_.target.value===""?0:Number(_.target.value))})]}),e.jsxs("div",{className:"md:col-span-2 space-y-2",children:[e.jsx(k,{children:"Repos (s)"}),e.jsx(V,{type:"number",value:l.rest_seconds===0?"":l.rest_seconds,onChange:_=>ke(g,"rest_seconds",_.target.value===""?0:Number(_.target.value))})]})]})]},`${l.exercise_id}-${g}`))]})]}):e.jsxs("div",{className:"space-y-4",children:[Ss,Cs,ks,Rs,Es,e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"font-bold text-lg",children:"Catalogue Séances Musculation"}),e.jsxs(S,{onClick:()=>{i(null),F({title:"",description:"",cycle:"endurance",items:[]}),n(!0)},children:[e.jsx(je,{className:"mr-2 h-4 w-4"})," Créer"]})]}),e.jsx("div",{className:"grid gap-4 md:grid-cols-2",children:Re?.map(l=>e.jsxs(G,{children:[e.jsxs(J,{children:[e.jsx(X,{children:l.title}),e.jsxs(ee,{children:[l.items?.length||0," exercices • ",l.cycle]})]}),e.jsx(H,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(S,{variant:"outline",size:"icon","aria-label":"Voir détails",onClick:()=>{I(l),ne(!0)},children:e.jsx(Gr,{className:"h-4 w-4"})}),e.jsx(S,{variant:"secondary",size:"icon","aria-label":"Modifier",onClick:()=>O(l),children:e.jsx(Ts,{className:"h-4 w-4"})}),e.jsx(S,{variant:"destructive",size:"icon","aria-label":"Supprimer",onClick:()=>w(l),children:e.jsx(ye,{className:"h-4 w-4"})})]})})]},l.id))}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-bold text-lg",children:"Catalogue Exercices"}),e.jsxs(S,{variant:"outline",onClick:()=>x(!0),children:[e.jsx(je,{className:"mr-2 h-4 w-4"})," Ajouter un exercice"]})]}),e.jsx("div",{className:"grid gap-3 md:grid-cols-2",children:ce?.map(l=>e.jsx(G,{children:e.jsxs(H,{className:"flex flex-col gap-3 py-4 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[l.illustration_gif?e.jsx("img",{src:l.illustration_gif,alt:`Illustration ${l.nom_exercice}`,className:"h-14 w-14 rounded-md object-cover",loading:"lazy",decoding:"async"}):null,e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:l.nom_exercice}),e.jsx("p",{className:"text-sm text-muted-foreground",children:l.exercise_type==="warmup"?"Échauffement":"Séries de travail"})]})]}),e.jsxs("div",{className:"flex w-full gap-2 sm:w-auto",children:[e.jsx(S,{variant:"outline",size:"icon","aria-label":"Modifier",onClick:()=>le(l),children:e.jsx(Ts,{className:"h-4 w-4"})}),e.jsx(S,{variant:"destructive",size:"icon","aria-label":"Supprimer",onClick:()=>oe(l),children:e.jsx(ye,{className:"h-4 w-4"})})]})]})},l.id))})]})]})}const Hs=["V0","V1","V2","V3","Max"],hn={V0:"bg-intensity-1",V1:"bg-intensity-2",V2:"bg-intensity-3",V3:"bg-intensity-4",Max:"bg-intensity-5"},Ws={souple:"V0",facile:"V0",relache:"V0",relâché:"V0"},fn=s=>{if(!s)return"V0";const a=s.trim();if(!a)return"V0";const r=a.toLowerCase();if(Ws[r])return Ws[r];const n=a.toUpperCase();if(n==="MAX")return"Max";if(n.startsWith("V")){const t=n.replace("V","V");return t==="V4"||t==="V5"?"Max":t}return a};function gn({value:s,onChange:a,className:r,ariaLabel:n="Sélection d'intensité"}){const t=fn(s),i=Hs.includes(t)?t:"Max";return e.jsx("div",{role:"radiogroup","aria-label":n,className:K("flex flex-wrap items-center gap-2",r),children:Hs.map(o=>{const d=i===o;return e.jsxs("button",{type:"button",role:"radio","aria-checked":d,"aria-label":`Intensité ${o==="Max"?"MAX":o}`,onClick:()=>a(o),className:K("flex flex-col items-center gap-1 rounded-full px-2 py-1 text-[10px] font-semibold text-muted-foreground transition","focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary",d?"text-foreground":"hover:text-foreground"),children:[e.jsx("span",{className:K("h-3 w-3 rounded-full",d?hn[o]??"bg-primary":"bg-muted")}),e.jsx("span",{children:o==="Max"?"MAX":o})]},o)})})}function jn(s){c.useEffect(()=>{if(!s)return;const a=r=>{r.preventDefault()};return window.addEventListener("beforeunload",a),()=>window.removeEventListener("beforeunload",a)},[s])}function Qs(s){return`Séance du ${kr(s,"dd/MM/yyyy")} - Soir - Matin`}const Js={souple:"V0",facile:"V0",relache:"V0",relâché:"V0"},vn=["V0","V1","V2","V3","Max"],Ve=s=>{if(!s)return"V0";const a=s.trim();if(!a)return"V0";const r=a.toLowerCase();if(Js[r])return Js[r];const n=a.toUpperCase();if(n==="MAX")return"Max";if(n.startsWith("V")){const t=Number.parseInt(n.slice(1),10);if(Number.isFinite(t)&&t>=4)return"Max";if(vn.includes(n))return n}return a},Xs=s=>s==="Max"?"MAX":s,hs=s=>{let a=0;return s.flatMap((r,n)=>r.exercises.map((t,i)=>{const o={block_title:r.title,block_description:r.description||null,block_order:n,block_repetitions:r.repetitions??null,block_modalities:r.modalities||null,block_equipment:r.equipment??[],exercise_repetitions:t.repetitions??null,exercise_rest:t.rest??null,exercise_stroke:t.stroke||null,exercise_stroke_type:t.strokeType||null,exercise_intensity:t.intensity?Ve(t.intensity):null,exercise_modalities:t.modalities||null,exercise_equipment:t.equipment??[],exercise_order:i},d=t.repetitions&&t.distance?`${t.repetitions}x${t.distance}m`:t.distance?`${t.distance}m`:null;return{ordre:a++,label:d,distance:t.distance??null,duration:null,intensity:t.intensity?Ve(t.intensity):null,notes:t.modalities||null,raw_payload:o}}))},yn=(s=[])=>{const a=new Map;return s.forEach(r=>{const n=r.raw_payload??{},t=n.block_title||n.section||"Bloc",i=Number(n.block_order??0),o=`${i}-${t}`,d=n.block_equipment??n.equipment??[],j=(Array.isArray(d)?d:String(d).split(",")).map(f=>String(f)).map(f=>Ys(f)).filter(Boolean);a.has(o)||a.set(o,{title:t,repetitions:n.block_repetitions??null,description:n.block_description??"",modalities:n.block_modalities??n.modalities??"",equipment:j,exercises:[],order:Number.isFinite(i)?i:0,exerciseOrder:new Map});const x=a.get(o),p=Number(n.exercise_order??r.ordre??x.exercises.length),m=Ve(n.exercise_intensity??r.intensity??"V1");x.exerciseOrder.set(p,{repetitions:n.exercise_repetitions??null,distance:r.distance??null,rest:n.exercise_rest??null,stroke:n.exercise_stroke??n.stroke??"crawl",strokeType:n.exercise_stroke_type??n.stroke_type??"nc",intensity:m,modalities:n.exercise_modalities??r.notes??"",equipment:Array.isArray(n.exercise_equipment)?n.exercise_equipment.map(f=>Ys(f)):[]})}),Array.from(a.values()).sort((r,n)=>r.order-n.order).map(r=>({title:r.title,repetitions:r.repetitions,description:r.description,modalities:r.modalities,equipment:r.equipment,exercises:Array.from(r.exerciseOrder.entries()).sort(([n],[t])=>n-t).map(([,n])=>n)}))},bn=s=>s?s.length>48?`${s.slice(0,45).trim()}…`:s:"",Ys=s=>{const a=s.trim().toLowerCase();return a&&(a.startsWith("plaquette")?"plaquettes":a.startsWith("palm")?"palmes":a.startsWith("tuba")?"tuba":a.startsWith("pull")?"pull":a.startsWith("elas")?"elastique":a)},Nn=(s=[])=>new Set(s.map(r=>{const n=r.raw_payload;return n?.block_title||n?.section||"Bloc"})).size,wn=s=>{const a=ot(s.items??[]),n=s.items?.some(i=>i.duration!=null)??!1?s.items?.reduce((i,o)=>i+(o.duration??0),0)??0:null,t=Nn(s.items??[]);return{totalDistance:a,totalDuration:n,blockCount:t}},Zs="swim_catalog_archived_ids",_n=(s,a)=>a===null?!1:!a.some(r=>r.session_type==="swim"&&r.session_id===s);function Cn(){const{toast:s}=is(),a=lt(),{userId:r,role:n}=Le(),[t,i]=c.useState(!1);jn(t);const[o,d]=c.useState(null),[j,x]=c.useState(null),[p,m]=c.useState(null),[f,C]=c.useState(""),[N,I]=c.useState("compact"),[y,ne]=c.useState(new Set),se=()=>({id:null,name:Qs(new Date),description:"",estimatedDuration:0,blocks:[]}),[w,D]=c.useState(se),{data:oe,isLoading:R}=ge({queryKey:["swim_catalog"],queryFn:()=>q.getSwimCatalog()}),{data:te,isError:we}=ge({queryKey:["coach-assignments"],queryFn:()=>q.getAssignmentsForCoach(),enabled:n==="coach"||n==="admin"});c.useEffect(()=>{if(typeof window>"u")return;const u=window.localStorage.getItem(Zs);if(u)try{const v=JSON.parse(u);Array.isArray(v)&&ne(new Set(v.map(b=>Number(b)).filter(b=>Number.isFinite(b))))}catch{return}},[]),c.useEffect(()=>{typeof window>"u"||window.localStorage.setItem(Zs,JSON.stringify(Array.from(y.values())))},[y]);const M=c.useMemo(()=>{const u=f.trim().toLowerCase();return u?(oe??[]).filter(v=>v.name.toLowerCase().includes(u)):oe??[]},[oe,f]).filter(u=>!y.has(u.id)),Y=de({mutationFn:u=>q.createSwimSession(u),onSuccess:(u,v)=>{a.invalidateQueries({queryKey:["swim_catalog"]}),i(!1),D(se()),s({title:v?.id?"Séance natation mise à jour":"Séance natation créée"})}}),W=de({mutationFn:u=>q.deleteSwimSession(u),onSuccess:()=>{a.invalidateQueries({queryKey:["swim_catalog"]}),x(null),s({title:"Séance supprimée"})},onError:()=>{s({title:"Suppression impossible",description:"Cette séance est utilisée dans une assignation.",variant:"destructive"})}}),E=()=>{D(u=>({...u,blocks:[...u.blocks,{title:"Nouveau bloc",repetitions:1,description:"",modalities:"",equipment:[],exercises:[{repetitions:4,distance:50,rest:null,stroke:"crawl",strokeType:"nc",intensity:"V2",modalities:"",equipment:[]}]}]}))},L=(u,v,b)=>{const T=[...w.blocks];T[u]={...T[u],[v]:b},D({...w,blocks:T})},re=u=>{const v=w.blocks.filter((b,T)=>T!==u);D({...w,blocks:v})},Z=(u,v)=>{const b=v==="up"?u-1:u+1;if(b<0||b>=w.blocks.length)return;const T=[...w.blocks],[O]=T.splice(u,1);T.splice(b,0,O),D({...w,blocks:T})},P=u=>{const v=[...w.blocks];v[u].exercises.push({repetitions:4,distance:50,rest:null,stroke:"crawl",strokeType:"nc",intensity:"V2",modalities:"",equipment:[]}),D({...w,blocks:v})},F=(u,v,b,T)=>{const O=[...w.blocks],le=[...O[u].exercises];le[v]={...le[v],[b]:T},O[u]={...O[u],exercises:le},D({...w,blocks:O})},U=(u,v)=>{const b=[...w.blocks];b[u].exercises=b[u].exercises.filter((T,O)=>O!==v),D({...w,blocks:b})},ae=[{value:"palmes",label:"Palmes"},{value:"tuba",label:"Tuba"},{value:"plaquettes",label:"Plaquettes"},{value:"pull",label:"Pull"},{value:"elastique",label:"Élastique"}],ce=[{value:"pap",label:"Papillon"},{value:"dos",label:"Dos"},{value:"brasse",label:"Brasse"},{value:"crawl",label:"Crawl"},{value:"4n",label:"4 nages"},{value:"spe",label:"Spé"}],Re=[{value:"nc",label:"NC"},{value:"educ",label:"Educ"},{value:"jambes",label:"Jambes"}];ce.reduce((u,v)=>(u[v.value]=v.label,u),{});const Ae=Re.reduce((u,v)=>(u[v.value]=v.label,u),{});w.id;const $=c.useMemo(()=>ot(hs(w.blocks)),[w.blocks]),ie={nc:"bg-sky-100 text-sky-900 ring-sky-200",educ:"bg-violet-100 text-violet-900 ring-violet-200",jambes:"bg-teal-100 text-teal-900 ring-teal-200"},_e={V0:"text-intensity-1",V1:"text-intensity-2",V2:"text-intensity-3",V3:"text-intensity-4",Max:"text-intensity-5"},Ce={V0:"ring-intensity-1/30",V1:"ring-intensity-2/30",V2:"ring-intensity-3/30",V3:"ring-intensity-4/30",Max:"ring-intensity-5/30"};return t?e.jsxs("div",{className:"animate-in slide-in-from-bottom-4 motion-reduce:animate-none",children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-border px-4 py-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{type:"button",onClick:()=>{i(!1),D(se())},className:"inline-flex h-9 w-9 items-center justify-center rounded-full hover:bg-muted","aria-label":"Retour",children:e.jsx(Rr,{className:"h-4 w-4"})}),e.jsx("div",{className:"text-base font-semibold",children:"Édition"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:()=>d({id:w.id??Date.now(),name:w.name,description:w.description,created_by:r??null,items:hs(w.blocks)}),className:"inline-flex h-9 w-9 items-center justify-center rounded-full hover:bg-muted","aria-label":"Aperçu nageur",title:"Aperçu nageur",children:e.jsx(Ms,{className:"h-4 w-4"})}),e.jsxs("button",{type:"button",onClick:()=>{if(!w.name.trim()){s({title:"Titre requis",description:"Ajoutez un nom de séance avant d'enregistrer.",variant:"destructive"});return}Y.mutate({id:w.id??void 0,name:w.name,description:w.description,estimated_duration:w.estimatedDuration||null,items:hs(w.blocks),created_by:r})},className:"inline-flex items-center gap-2 rounded-full bg-primary px-3 py-2 text-xs font-semibold text-primary-foreground",children:[e.jsx(Ue,{className:"h-4 w-4"})," Sauver"]})]})]}),e.jsxs("div",{className:"space-y-4 p-4",children:[e.jsx(G,{className:"rounded-2xl border-border",children:e.jsxs("div",{className:"space-y-3 p-4",children:[e.jsx("div",{className:"text-sm font-semibold",children:"Infos séance"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"col-span-2",children:[e.jsx("div",{className:"text-xs font-semibold text-muted-foreground",children:"Nom"}),e.jsx("div",{className:"mt-1",children:e.jsx(V,{value:w.name,onChange:u=>D({...w,name:u.target.value}),placeholder:"Nom de la séance",className:"rounded-2xl"})})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-semibold text-muted-foreground",children:"Durée estimée (min)"}),e.jsx("div",{className:"mt-1",children:e.jsx(V,{type:"number",min:0,value:w.estimatedDuration||"",onChange:u=>D({...w,estimatedDuration:u.target.value===""?0:Number(u.target.value)}),placeholder:"55",className:"rounded-2xl"})})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-semibold text-muted-foreground",children:"Distance totale"}),e.jsxs("div",{className:"mt-1 rounded-2xl border border-border bg-muted px-3 py-2 text-sm font-semibold",children:[$,"m"]})]})]})]})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-sm font-semibold",children:"Vue coach"}),e.jsxs("div",{className:"inline-flex rounded-full border border-border bg-card p-1 text-xs font-semibold",children:[e.jsx("button",{type:"button",onClick:()=>I("compact"),className:K("rounded-full px-3 py-1",N==="compact"?"bg-primary text-primary-foreground":"text-muted-foreground"),children:"Condensé"}),e.jsx("button",{type:"button",onClick:()=>I("detailed"),className:K("rounded-full px-3 py-1",N==="detailed"?"bg-primary text-primary-foreground":"text-muted-foreground"),children:"Détail"})]})]}),N==="compact"?e.jsx(G,{className:"rounded-2xl border-border",children:e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold",children:"Plan (ultra compact)"}),e.jsx("div",{className:"mt-1 text-xs text-muted-foreground",children:"Manipule les blocs vite. Passe en “Détail” pour éditer."})]}),e.jsxs(S,{variant:"secondary",size:"sm",onClick:E,className:"h-9 rounded-full px-3 text-xs",children:[e.jsx(je,{className:"h-4 w-4"})," Bloc"]})]}),e.jsxs("div",{className:"mt-3 space-y-2",children:[w.blocks.map((u,v)=>e.jsx("div",{className:"rounded-2xl border border-border bg-card px-3 py-2",children:e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-primary px-2 py-0.5 text-[11px] font-semibold text-primary-foreground",children:[e.jsx(wr,{className:"inline h-3 w-3"})," ",u.repetitions??1,"x"]}),e.jsx("div",{className:"truncate text-xs font-semibold",children:u.title?u.title:`Bloc ${v+1}`}),e.jsxs("div",{className:"text-[11px] text-muted-foreground",children:["· ",u.exercises.length," ex"]})]}),e.jsxs("div",{className:"mt-1 flex flex-wrap gap-1",children:[u.exercises.slice(0,4).map((b,T)=>{const O=Ve(b.intensity),le=Ae[b.strokeType]??b.strokeType;return e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-muted px-2 py-0.5 text-[11px] font-semibold text-muted-foreground",title:b.modalities?bn(b.modalities):"",children:[b.repetitions&&b.distance?`${b.repetitions}x`:"",b.distance?`${b.distance}m`:"—",e.jsx("span",{className:K("ml-1 inline-flex items-center rounded-full px-2 py-0.5 ring-1",ie[b.strokeType]??"bg-muted text-muted-foreground ring-border"),children:le}),e.jsxs("span",{className:K("ml-1 inline-flex items-center gap-1 rounded-full bg-card px-2 py-0.5 ring-1",Ce[O],_e[O]),children:[e.jsx("span",{className:K("h-2 w-2 rounded-full",Fs[O]??"bg-muted")}),Xs(O)]})]},`${v}-${T}`)}),u.exercises.length>4?e.jsxs("span",{className:"text-[11px] text-muted-foreground",children:["+",u.exercises.length-4]}):null]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{type:"button",onClick:()=>Z(v,"up"),className:"inline-flex h-9 w-9 items-center justify-center rounded-full hover:bg-muted disabled:opacity-40","aria-label":"Monter",title:"Monter",disabled:v===0,children:e.jsx(Os,{className:"h-4 w-4"})}),e.jsx("button",{type:"button",onClick:()=>Z(v,"down"),className:"inline-flex h-9 w-9 items-center justify-center rounded-full hover:bg-muted disabled:opacity-40","aria-label":"Descendre",title:"Descendre",disabled:v===w.blocks.length-1,children:e.jsx(Is,{className:"h-4 w-4"})}),e.jsx("button",{type:"button",onClick:()=>re(v),className:"inline-flex h-9 w-9 items-center justify-center rounded-full text-destructive hover:bg-destructive/10","aria-label":"Supprimer bloc",title:"Supprimer bloc",children:e.jsx(ye,{className:"h-4 w-4"})})]})]})},v)),w.blocks.length?null:e.jsx("div",{className:"rounded-2xl border border-dashed border-border bg-muted px-3 py-6 text-center text-sm text-muted-foreground",children:"Aucun bloc. Ajoute un bloc pour commencer."})]})]})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-sm font-semibold",children:"Édition détaillée"}),e.jsxs(S,{variant:"secondary",size:"sm",onClick:E,className:"h-9 rounded-full px-3 text-xs",children:[e.jsx(je,{className:"h-4 w-4"})," Ajouter bloc"]})]}),e.jsx("div",{className:"space-y-4",children:w.blocks.map((u,v)=>e.jsx(G,{className:"rounded-2xl border-border",children:e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("span",{className:"mt-1 inline-flex h-9 w-9 items-center justify-center rounded-2xl bg-muted text-muted-foreground",children:e.jsx(ct,{className:"h-4 w-4"})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-xs font-semibold text-muted-foreground",children:"Titre bloc"}),e.jsx(V,{value:u.title,onChange:b=>L(v,"title",b.target.value),placeholder:`Bloc ${v+1}`,className:"rounded-2xl"})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{type:"button",onClick:()=>Z(v,"up"),className:"inline-flex h-9 w-9 items-center justify-center rounded-full hover:bg-muted disabled:opacity-40","aria-label":"Monter",title:"Monter",disabled:v===0,children:e.jsx(Os,{className:"h-4 w-4"})}),e.jsx("button",{type:"button",onClick:()=>Z(v,"down"),className:"inline-flex h-9 w-9 items-center justify-center rounded-full hover:bg-muted disabled:opacity-40","aria-label":"Descendre",title:"Descendre",disabled:v===w.blocks.length-1,children:e.jsx(Is,{className:"h-4 w-4"})}),e.jsx("button",{type:"button",onClick:()=>re(v),className:"inline-flex h-9 w-9 items-center justify-center rounded-full text-destructive hover:bg-destructive/10","aria-label":"Supprimer bloc",title:"Supprimer bloc",children:e.jsx(ye,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"mt-3 grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-semibold text-muted-foreground",children:"Répétitions du bloc"}),e.jsx("div",{className:"mt-1",children:e.jsx(V,{type:"number",min:1,value:u.repetitions??"",onChange:b=>L(v,"repetitions",b.target.value===""?null:Number(b.target.value)),placeholder:"1",className:"rounded-2xl"})})]}),e.jsx("div",{className:"flex items-end justify-end",children:e.jsxs(S,{variant:"secondary",size:"sm",onClick:()=>P(v),className:"h-9 rounded-full px-3 text-xs",children:[e.jsx(je,{className:"h-4 w-4"})," Exercice"]})})]}),e.jsx("div",{className:"mt-4 space-y-3",children:u.exercises.map((b,T)=>{const O=Ve(b.intensity),le=b.modalities??"";return e.jsx("div",{className:"rounded-2xl border border-border bg-card p-3",children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"grid flex-1 grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-[11px] font-semibold text-muted-foreground",children:"Répétitions"}),e.jsx("div",{className:"mt-1",children:e.jsx(V,{type:"number",min:1,value:b.repetitions??"",onChange:A=>F(v,T,"repetitions",A.target.value===""?null:Number(A.target.value)),className:"rounded-2xl"})})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-[11px] font-semibold text-muted-foreground",children:"Distance (m)"}),e.jsx("div",{className:"mt-1",children:e.jsx(V,{type:"number",min:0,value:b.distance??"",onChange:A=>F(v,T,"distance",A.target.value===""?null:Number(A.target.value)),className:"rounded-2xl"})})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-[11px] font-semibold text-muted-foreground",children:"Nage"}),e.jsx("div",{className:"mt-1",children:e.jsxs(ue,{value:b.stroke,onValueChange:A=>F(v,T,"stroke",A),children:[e.jsx(me,{className:"rounded-2xl",children:e.jsx(pe,{})}),e.jsx(xe,{children:ce.map(A=>e.jsx(z,{value:A.value,children:A.label},A.value))})]})})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-[11px] font-semibold text-muted-foreground",children:"Type"}),e.jsx("div",{className:"mt-1",children:e.jsxs(ue,{value:b.strokeType,onValueChange:A=>F(v,T,"strokeType",A),children:[e.jsx(me,{className:"rounded-2xl",children:e.jsx(pe,{})}),e.jsx(xe,{children:Re.map(A=>e.jsx(z,{value:A.value,children:A.label},A.value))})]})})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-[11px] font-semibold text-muted-foreground",children:"Intensité (clic sur points)"}),e.jsxs("span",{className:K("inline-flex items-center gap-2 rounded-full bg-card px-2.5 py-1 text-xs font-semibold ring-1",Ce[O],_e[O]),children:[e.jsx("span",{className:K("h-2 w-2 rounded-full",Fs[O]??"bg-muted")}),Xs(O)]})]}),e.jsx("div",{className:"mt-2 flex items-center justify-between gap-2",children:e.jsx(gn,{value:b.intensity,onChange:A=>F(v,T,"intensity",A)})})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("div",{className:"text-[11px] font-semibold text-muted-foreground",children:"Équipements"}),e.jsx("div",{className:"mt-2 flex flex-wrap gap-2",children:ae.map(A=>{const Se=b.equipment.includes(A.value),qe=_r(A.value);return e.jsxs("button",{type:"button",onClick:()=>{const ke=Se?b.equipment.filter(ds=>ds!==A.value):[...b.equipment,A.value];F(v,T,"equipment",ke)},className:K("inline-flex items-center gap-2 rounded-full border px-3 py-2 text-xs font-semibold",Se?"border-primary bg-primary text-primary-foreground":"border-border bg-card text-muted-foreground hover:bg-muted"),children:[e.jsx("span",{className:K("inline-flex h-7 w-7 items-center justify-center rounded-full",Se?"bg-white/10":"bg-muted"),children:qe?e.jsx("img",{src:qe,alt:"",className:"h-4 w-4","aria-hidden":"true",loading:"lazy"}):null}),A.label]},A.value)})})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("div",{className:"text-[11px] font-semibold text-muted-foreground",children:"Modalités"}),e.jsx("div",{className:"mt-1",children:e.jsx(Pe,{value:le,onChange:A=>F(v,T,"modalities",A.target.value),placeholder:"Une modalité par ligne",rows:3,className:"rounded-2xl"})})]})]}),e.jsx("button",{type:"button",onClick:()=>U(v,T),className:"inline-flex h-9 w-9 items-center justify-center rounded-full text-destructive hover:bg-destructive/10","aria-label":"Supprimer exercice",title:"Supprimer exercice",children:e.jsx(ye,{className:"h-4 w-4"})})]})},T)})}),e.jsxs("div",{className:"mt-4 flex items-center justify-between",children:[e.jsxs(S,{variant:"secondary",size:"sm",onClick:()=>P(v),className:"h-9 rounded-full px-3 text-xs",children:[e.jsx(je,{className:"h-4 w-4"})," Ajouter exercice"]}),e.jsxs(S,{variant:"destructive",size:"sm",onClick:()=>re(v),className:"h-9 rounded-full px-3 text-xs",children:[e.jsx(ye,{className:"h-4 w-4"})," Supprimer bloc"]})]})]})},v))})]}),e.jsx("div",{className:"h-8"})]}),e.jsx(De,{open:!!o,onOpenChange:u=>{u||d(null)},children:e.jsx(Me,{className:"max-w-4xl",children:e.jsx($s,{title:o?.name??"",description:o?.description??void 0,items:o?.items})})})]}):e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-border px-4 py-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-base font-semibold",children:"Coach"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Création"})]}),e.jsxs("button",{type:"button",onClick:()=>{D(se()),I("compact"),i(!0)},className:"inline-flex items-center gap-2 rounded-full bg-primary px-3 py-2 text-xs font-semibold text-primary-foreground",children:[e.jsx(je,{className:"h-4 w-4"})," Nouvelle"]})]}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 rounded-2xl border border-border bg-card px-3 py-2",children:[e.jsx(Er,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("input",{className:"w-full bg-transparent text-sm outline-none placeholder:text-muted-foreground",placeholder:"Rechercher une séance",value:f,onChange:u=>C(u.target.value)})]}),we&&e.jsx("div",{className:"mt-4 rounded-lg border border-destructive/20 bg-destructive/10 p-4 text-sm text-destructive",children:"Impossible de charger les assignations."}),R&&e.jsx("div",{className:"mt-4 space-y-4",children:[1,2,3].map(u=>e.jsx("div",{className:"h-24 w-full rounded-xl bg-muted animate-pulse motion-reduce:animate-none"},u))}),e.jsx("div",{className:"mt-4 space-y-3",children:M.map(u=>{const{totalDistance:v,totalDuration:b,blockCount:T}=wn(u),O=_n(u.id,te??null),le=!O||W.isPending;return e.jsx(G,{className:"rounded-2xl border-border",children:e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-base font-semibold tracking-tight",children:u.name}),e.jsxs("div",{className:"mt-1 flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx(Cr,{className:"h-3.5 w-3.5"}),v,"m"]}),e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx(Ar,{className:"h-3.5 w-3.5"}),"~",b??"—"," min"]}),e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx(Sr,{className:"h-3.5 w-3.5"}),T]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:()=>d(u),className:"inline-flex h-9 w-9 items-center justify-center rounded-full hover:bg-muted","aria-label":"Aperçu nageur",title:"Aperçu nageur",children:e.jsx(Ms,{className:"h-4 w-4"})}),e.jsx("button",{type:"button",onClick:()=>{D({id:u.id??null,name:u.name??Qs(new Date),description:u.description??"",estimatedDuration:Number(u.estimated_duration??0),blocks:yn(u.items??[])}),I("compact"),i(!0)},className:"inline-flex h-9 w-9 items-center justify-center rounded-full hover:bg-muted","aria-label":"Modifier",title:"Modifier",children:e.jsx(Wr,{className:"h-4 w-4"})}),e.jsx("button",{type:"button",onClick:()=>m(u),className:"inline-flex h-9 w-9 items-center justify-center rounded-full hover:bg-muted","aria-label":"Archiver",title:"Archiver",children:e.jsx(Vr,{className:"h-4 w-4"})}),e.jsx("button",{type:"button",onClick:()=>{le||x(u)},className:K("inline-flex h-9 w-9 items-center justify-center rounded-full hover:bg-muted",le&&"cursor-not-allowed text-muted-foreground"),"aria-label":"Supprimer",title:te===null?"Suppression désactivée":O?"Supprimer":"Séance déjà assignée",children:e.jsx(ye,{className:"h-4 w-4"})})]})]})})},u.id)})}),e.jsx("div",{className:"h-8"})]}),e.jsx(De,{open:!!o,onOpenChange:u=>{u||d(null)},children:e.jsx(Me,{className:"max-w-4xl",children:e.jsx($s,{title:o?.name??"",description:o?.description??void 0,items:o?.items})})}),e.jsx(He,{open:!!p,onOpenChange:u=>{u||m(null)},children:e.jsxs(We,{children:[e.jsxs(Qe,{children:[e.jsx(Je,{children:"Archiver la séance ?"}),e.jsx(Xe,{children:"La séance sera masquée du catalogue (sans suppression)."})]}),e.jsxs(Ye,{children:[e.jsx(Ze,{children:"Annuler"}),e.jsx(es,{onClick:()=>{p&&(ne(u=>new Set([...Array.from(u),p.id])),m(null),s({title:"Séance archivée"}))},children:"Archiver"})]})]})}),e.jsx(He,{open:!!j,onOpenChange:u=>{u||x(null)},children:e.jsxs(We,{children:[e.jsxs(Qe,{children:[e.jsx(Je,{children:"Supprimer la séance ?"}),e.jsx(Xe,{children:"Cette action est définitive. La séance sera supprimée du catalogue."})]}),e.jsxs(Ye,{children:[e.jsx(Ze,{children:"Annuler"}),e.jsx(es,{onClick:()=>{j&&W.mutate(j.id)},children:"Supprimer"})]})]})})]})}function Sn(s,a,{checkForDefaultPrevented:r=!0}={}){return function(t){if(s?.(t),r===!1||!t.defaultPrevented)return a?.(t)}}var kn=ts[" useInsertionEffect ".trim().toString()]||rs;function Rn({prop:s,defaultProp:a,onChange:r=()=>{},caller:n}){const[t,i,o]=En({defaultProp:a,onChange:r}),d=s!==void 0,j=d?s:t;{const p=c.useRef(s!==void 0);c.useEffect(()=>{const m=p.current;m!==d&&console.warn(`${n} is changing from ${m?"controlled":"uncontrolled"} to ${d?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),p.current=d},[d,n])}const x=c.useCallback(p=>{if(d){const m=An(p)?p(s):p;m!==s&&o.current?.(m)}else i(p)},[d,s,i,o]);return[j,x]}function En({defaultProp:s,onChange:a}){const[r,n]=c.useState(s),t=c.useRef(r),i=c.useRef(a);return kn(()=>{i.current=a},[a]),c.useEffect(()=>{t.current!==r&&(i.current?.(r),t.current=r)},[r,t]),[r,n,i]}function An(s){return typeof s=="function"}var Ct="Toggle",bs=c.forwardRef((s,a)=>{const{pressed:r,defaultPressed:n,onPressedChange:t,...i}=s,[o,d]=Rn({prop:r,onChange:t,defaultProp:n??!1,caller:Ct});return e.jsx(ve.button,{type:"button","aria-pressed":o,"data-state":o?"on":"off","data-disabled":s.disabled?"":void 0,...i,ref:a,onClick:Sn(s.onClick,()=>{s.disabled||d(!o)})})});bs.displayName=Ct;var St=bs,Pn=ts[" useInsertionEffect ".trim().toString()]||rs;function kt({prop:s,defaultProp:a,onChange:r=()=>{},caller:n}){const[t,i,o]=Dn({defaultProp:a,onChange:r}),d=s!==void 0,j=d?s:t;{const p=c.useRef(s!==void 0);c.useEffect(()=>{const m=p.current;m!==d&&console.warn(`${n} is changing from ${m?"controlled":"uncontrolled"} to ${d?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),p.current=d},[d,n])}const x=c.useCallback(p=>{if(d){const m=Mn(p)?p(s):p;m!==s&&o.current?.(m)}else i(p)},[d,s,i,o]);return[j,x]}function Dn({defaultProp:s,onChange:a}){const[r,n]=c.useState(s),t=c.useRef(r),i=c.useRef(a);return Pn(()=>{i.current=a},[a]),c.useEffect(()=>{t.current!==r&&(i.current?.(r),t.current=r)},[r,t]),[r,n,i]}function Mn(s){return typeof s=="function"}var be="ToggleGroup",[Rt]=as(be,[ns]),Et=ns(),Ns=he.forwardRef((s,a)=>{const{type:r,...n}=s;if(r==="single"){const t=n;return e.jsx(Tn,{...t,ref:a})}if(r==="multiple"){const t=n;return e.jsx(Fn,{...t,ref:a})}throw new Error(`Missing prop \`type\` expected on \`${be}\``)});Ns.displayName=be;var[At,Pt]=Rt(be),Tn=he.forwardRef((s,a)=>{const{value:r,defaultValue:n,onValueChange:t=()=>{},...i}=s,[o,d]=kt({prop:r,defaultProp:n??"",onChange:t,caller:be});return e.jsx(At,{scope:s.__scopeToggleGroup,type:"single",value:he.useMemo(()=>o?[o]:[],[o]),onItemActivate:d,onItemDeactivate:he.useCallback(()=>d(""),[d]),children:e.jsx(Dt,{...i,ref:a})})}),Fn=he.forwardRef((s,a)=>{const{value:r,defaultValue:n,onValueChange:t=()=>{},...i}=s,[o,d]=kt({prop:r,defaultProp:n??[],onChange:t,caller:be}),j=he.useCallback(p=>d((m=[])=>[...m,p]),[d]),x=he.useCallback(p=>d((m=[])=>m.filter(f=>f!==p)),[d]);return e.jsx(At,{scope:s.__scopeToggleGroup,type:"multiple",value:o,onItemActivate:j,onItemDeactivate:x,children:e.jsx(Dt,{...i,ref:a})})});Ns.displayName=be;var[$n,Vn]=Rt(be),Dt=he.forwardRef((s,a)=>{const{__scopeToggleGroup:r,disabled:n=!1,rovingFocus:t=!0,orientation:i,dir:o,loop:d=!0,...j}=s,x=Et(r),p=tt(o),m={role:"group",dir:p,...j};return e.jsx($n,{scope:r,rovingFocus:t,disabled:n,children:t?e.jsx(rt,{asChild:!0,...x,orientation:i,dir:p,loop:d,children:e.jsx(ve.div,{...m,ref:a})}):e.jsx(ve.div,{...m,ref:a})})}),ss="ToggleGroupItem",Mt=he.forwardRef((s,a)=>{const r=Pt(ss,s.__scopeToggleGroup),n=Vn(ss,s.__scopeToggleGroup),t=Et(s.__scopeToggleGroup),i=r.value.includes(s.value),o=n.disabled||s.disabled,d={...s,pressed:i,disabled:o},j=he.useRef(null);return n.rovingFocus?e.jsx(nt,{asChild:!0,...t,focusable:!o,active:i,ref:j,children:e.jsx(et,{...d,ref:a})}):e.jsx(et,{...d,ref:a})});Mt.displayName=ss;var et=he.forwardRef((s,a)=>{const{__scopeToggleGroup:r,value:n,...t}=s,i=Pt(ss,r),o={role:"radio","aria-checked":s.pressed,"aria-pressed":void 0},d=i.type==="single"?o:void 0;return e.jsx(bs,{...d,...t,ref:a,onPressedChange:j=>{j?i.onItemActivate(n):i.onItemDeactivate(n)}})}),Tt=Ns,Ft=Mt;const $t=mr("inline-flex items-center justify-center gap-2 rounded-md text-sm font-medium transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-transparent",outline:"border border-input bg-transparent shadow-sm hover:bg-accent hover:text-accent-foreground"},size:{default:"h-9 px-2 min-w-9",sm:"h-8 px-1.5 min-w-8",lg:"h-10 px-2.5 min-w-10"}},defaultVariants:{variant:"default",size:"default"}}),In=c.forwardRef(({className:s,variant:a,size:r,...n},t)=>e.jsx(St,{ref:t,className:K($t({variant:a,size:r,className:s})),...n}));In.displayName=St.displayName;const Vt=c.createContext({size:"default",variant:"default"}),It=c.forwardRef(({className:s,variant:a,size:r,children:n,...t},i)=>e.jsx(Tt,{ref:i,className:K("flex items-center justify-center gap-1",s),...t,children:e.jsx(Vt.Provider,{value:{variant:a,size:r},children:n})}));It.displayName=Tt.displayName;const Ke=c.forwardRef(({className:s,children:a,variant:r,size:n,...t},i)=>{const o=c.useContext(Vt);return e.jsx(Ft,{ref:i,className:K($t({variant:o.variant||r,size:o.size||n}),s),...t,children:a})});Ke.displayName=Ft.displayName;const Te=({title:s,description:a,onBack:r,actions:n})=>e.jsxs("div",{className:"flex flex-wrap items-start justify-between gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs(S,{variant:"ghost",size:"sm",className:"-ml-2",onClick:r,children:[e.jsx(Fr,{className:"mr-2 h-4 w-4"}),"Retour à l'accueil"]}),e.jsx("h2",{className:"text-2xl font-display font-semibold uppercase italic text-primary",children:s}),a?e.jsx("p",{className:"text-sm text-muted-foreground",children:a}):null]}),n?e.jsx("div",{className:"flex items-center gap-2",children:n}):null]});function Fe(s,a,{checkForDefaultPrevented:r=!0}={}){return function(t){if(s?.(t),r===!1||!t.defaultPrevented)return a?.(t)}}function On(s){const a=qn(s),r=c.forwardRef((n,t)=>{const{children:i,...o}=n,d=c.Children.toArray(i),j=d.find(Gn);if(j){const x=j.props.children,p=d.map(m=>m===j?c.Children.count(x)>1?c.Children.only(null):c.isValidElement(x)?x.props.children:null:m);return e.jsx(a,{...o,ref:t,children:c.isValidElement(x)?c.cloneElement(x,void 0,p):null})}return e.jsx(a,{...o,ref:t,children:i})});return r.displayName=`${s}.Slot`,r}function qn(s){const a=c.forwardRef((r,n)=>{const{children:t,...i}=r;if(c.isValidElement(t)){const o=Bn(t),d=Ln(i,t.props);return t.type!==c.Fragment&&(d.ref=n?sr(n,o):o),c.cloneElement(t,d)}return c.Children.count(t)>1?c.Children.only(null):null});return a.displayName=`${s}.SlotClone`,a}var zn=Symbol("radix.slottable");function Gn(s){return c.isValidElement(s)&&typeof s.type=="function"&&"__radixId"in s.type&&s.type.__radixId===zn}function Ln(s,a){const r={...a};for(const n in a){const t=s[n],i=a[n];/^on[A-Z]/.test(n)?t&&i?r[n]=(...d)=>{const j=i(...d);return t(...d),j}:t&&(r[n]=t):n==="style"?r[n]={...t,...i}:n==="className"&&(r[n]=[t,i].filter(Boolean).join(" "))}return{...s,...r}}function Bn(s){let a=Object.getOwnPropertyDescriptor(s.props,"ref")?.get,r=a&&"isReactWarning"in a&&a.isReactWarning;return r?s.ref:(a=Object.getOwnPropertyDescriptor(s,"ref")?.get,r=a&&"isReactWarning"in a&&a.isReactWarning,r?s.props.ref:s.props.ref||s.ref)}var Un=ts[" useInsertionEffect ".trim().toString()]||rs;function Kn({prop:s,defaultProp:a,onChange:r=()=>{},caller:n}){const[t,i,o]=Hn({defaultProp:a,onChange:r}),d=s!==void 0,j=d?s:t;{const p=c.useRef(s!==void 0);c.useEffect(()=>{const m=p.current;m!==d&&console.warn(`${n} is changing from ${m?"controlled":"uncontrolled"} to ${d?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),p.current=d},[d,n])}const x=c.useCallback(p=>{if(d){const m=Wn(p)?p(s):p;m!==s&&o.current?.(m)}else i(p)},[d,s,i,o]);return[j,x]}function Hn({defaultProp:s,onChange:a}){const[r,n]=c.useState(s),t=c.useRef(r),i=c.useRef(a);return Un(()=>{i.current=a},[a]),c.useEffect(()=>{t.current!==r&&(i.current?.(r),t.current=r)},[r,t]),[r,n,i]}function Wn(s){return typeof s=="function"}var cs="Popover",[Ot]=as(cs,[at]),Oe=at(),[Qn,Ne]=Ot(cs),qt=s=>{const{__scopePopover:a,children:r,open:n,defaultOpen:t,onOpenChange:i,modal:o=!1}=s,d=Oe(a),j=c.useRef(null),[x,p]=c.useState(!1),[m,f]=Kn({prop:n,defaultProp:t??!1,onChange:i,caller:cs});return e.jsx(tr,{...d,children:e.jsx(Qn,{scope:a,contentId:rr(),triggerRef:j,open:m,onOpenChange:f,onOpenToggle:c.useCallback(()=>f(C=>!C),[f]),hasCustomAnchor:x,onCustomAnchorAdd:c.useCallback(()=>p(!0),[]),onCustomAnchorRemove:c.useCallback(()=>p(!1),[]),modal:o,children:r})})};qt.displayName=cs;var zt="PopoverAnchor",Jn=c.forwardRef((s,a)=>{const{__scopePopover:r,...n}=s,t=Ne(zt,r),i=Oe(r),{onCustomAnchorAdd:o,onCustomAnchorRemove:d}=t;return c.useEffect(()=>(o(),()=>d()),[o,d]),e.jsx(it,{...i,...n,ref:a})});Jn.displayName=zt;var Gt="PopoverTrigger",Lt=c.forwardRef((s,a)=>{const{__scopePopover:r,...n}=s,t=Ne(Gt,r),i=Oe(r),o=Ie(a,t.triggerRef),d=e.jsx(ve.button,{type:"button","aria-haspopup":"dialog","aria-expanded":t.open,"aria-controls":t.contentId,"data-state":Wt(t.open),...n,ref:o,onClick:Fe(s.onClick,t.onOpenToggle)});return t.hasCustomAnchor?d:e.jsx(it,{asChild:!0,...i,children:d})});Lt.displayName=Gt;var ws="PopoverPortal",[Xn,Yn]=Ot(ws,{forceMount:void 0}),Bt=s=>{const{__scopePopover:a,forceMount:r,children:n,container:t}=s,i=Ne(ws,a);return e.jsx(Xn,{scope:a,forceMount:r,children:e.jsx(vs,{present:r||i.open,children:e.jsx(nr,{asChild:!0,container:t,children:n})})})};Bt.displayName=ws;var Ee="PopoverContent",Ut=c.forwardRef((s,a)=>{const r=Yn(Ee,s.__scopePopover),{forceMount:n=r.forceMount,...t}=s,i=Ne(Ee,s.__scopePopover);return e.jsx(vs,{present:n||i.open,children:i.modal?e.jsx(ea,{...t,ref:a}):e.jsx(sa,{...t,ref:a})})});Ut.displayName=Ee;var Zn=On("PopoverContent.RemoveScroll"),ea=c.forwardRef((s,a)=>{const r=Ne(Ee,s.__scopePopover),n=c.useRef(null),t=Ie(a,n),i=c.useRef(!1);return c.useEffect(()=>{const o=n.current;if(o)return ar(o)},[]),e.jsx(ir,{as:Zn,allowPinchZoom:!0,children:e.jsx(Kt,{...s,ref:t,trapFocus:r.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:Fe(s.onCloseAutoFocus,o=>{o.preventDefault(),i.current||r.triggerRef.current?.focus()}),onPointerDownOutside:Fe(s.onPointerDownOutside,o=>{const d=o.detail.originalEvent,j=d.button===0&&d.ctrlKey===!0,x=d.button===2||j;i.current=x},{checkForDefaultPrevented:!1}),onFocusOutside:Fe(s.onFocusOutside,o=>o.preventDefault(),{checkForDefaultPrevented:!1})})})}),sa=c.forwardRef((s,a)=>{const r=Ne(Ee,s.__scopePopover),n=c.useRef(!1),t=c.useRef(!1);return e.jsx(Kt,{...s,ref:a,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:i=>{s.onCloseAutoFocus?.(i),i.defaultPrevented||(n.current||r.triggerRef.current?.focus(),i.preventDefault()),n.current=!1,t.current=!1},onInteractOutside:i=>{s.onInteractOutside?.(i),i.defaultPrevented||(n.current=!0,i.detail.originalEvent.type==="pointerdown"&&(t.current=!0));const o=i.target;r.triggerRef.current?.contains(o)&&i.preventDefault(),i.detail.originalEvent.type==="focusin"&&t.current&&i.preventDefault()}})}),Kt=c.forwardRef((s,a)=>{const{__scopePopover:r,trapFocus:n,onOpenAutoFocus:t,onCloseAutoFocus:i,disableOutsidePointerEvents:o,onEscapeKeyDown:d,onPointerDownOutside:j,onFocusOutside:x,onInteractOutside:p,...m}=s,f=Ne(Ee,r),C=Oe(r);return lr(),e.jsx(or,{asChild:!0,loop:!0,trapped:n,onMountAutoFocus:t,onUnmountAutoFocus:i,children:e.jsx(cr,{asChild:!0,disableOutsidePointerEvents:o,onInteractOutside:p,onEscapeKeyDown:d,onPointerDownOutside:j,onFocusOutside:x,onDismiss:()=>f.onOpenChange(!1),children:e.jsx(dr,{"data-state":Wt(f.open),role:"dialog",id:f.contentId,...C,...m,ref:a,style:{...m.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}})})})}),Ht="PopoverClose",ta=c.forwardRef((s,a)=>{const{__scopePopover:r,...n}=s,t=Ne(Ht,r);return e.jsx(ve.button,{type:"button",...n,ref:a,onClick:Fe(s.onClick,()=>t.onOpenChange(!1))})});ta.displayName=Ht;var ra="PopoverArrow",na=c.forwardRef((s,a)=>{const{__scopePopover:r,...n}=s,t=Oe(r);return e.jsx(ur,{...t,...n,ref:a})});na.displayName=ra;function Wt(s){return s?"open":"closed"}var aa=qt,ia=Lt,la=Bt,Qt=Ut;const oa=aa,ca=ia,Jt=c.forwardRef(({className:s,align:a="center",sideOffset:r=4,...n},t)=>e.jsx(la,{children:e.jsx(Qt,{ref:t,align:a,sideOffset:r,className:K("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-popover-content-transform-origin]",s),...n})}));Jt.displayName=Qt.displayName;const da=({onBack:s,swimSessions:a,strengthSessions:r,athletes:n,groups:t})=>{const{toast:i}=is(),[o,d]=c.useState({session_type:"swim",session_id:"",assigned_date:new Date().toISOString().split("T")[0],assigned_slot:"morning"}),[j,x]=c.useState(!1),[p,m]=c.useState("user"),[f,C]=c.useState(""),[N,I]=c.useState([]),y=h=>{const M=typeof h=="number"?h:Number(h);return Number.isFinite(M)&&M>0?M:null},ne=c.useMemo(()=>n.map(h=>({value:h.id?`id:${h.id}`:`name:${h.display_name}`,label:h.group_label?`${h.display_name} · ${h.group_label}`:h.display_name,id:h.id,name:h.display_name})),[n]),se=c.useMemo(()=>new Map(ne.map(h=>[h.value,h])),[ne]),w=c.useMemo(()=>t.map(h=>{const M=y(h.id);return M?{...h,gid:M}:null}).filter(h=>!!h),[t]),D=c.useMemo(()=>w.filter(h=>N.includes(h.gid)),[w,N]),oe=c.useMemo(()=>{if(D.length===0)return"Choisir des groupes";const h=D.slice(0,2).map(Y=>Y.name).join(", "),M=D.length>2?` +${D.length-2}`:"";return`${h}${M}`},[D]),R=de({mutationFn:async h=>q.assignments_create(h),onSuccess:()=>{i({title:"Séance assignée & notifiée"})},onError:h=>{const M="Impossible d'assigner la séance. Vérifiez les champs et réessayez.",Y=h instanceof Error?h.message:typeof h=="string"?h:M;let W=Y;const E=Y.match(/HTTP \d+:\s*(\{.*\})/);if(E)try{W=JSON.parse(E[1])?.error||M}catch{W=M}i({title:"Erreur d'assignation",description:W})}}),te=async()=>{const h=Number(o.session_id);if(!Number.isInteger(h)||h<=0){i({title:"Séance invalide",description:"Sélectionnez une séance valide."});return}if(p==="group"){if(N.length===0){i({title:"Groupe manquant",description:"Sélectionnez au moins un groupe."});return}x(!0);try{const L={assignment_type:o.session_type,session_id:h,scheduled_date:o.assigned_date,scheduled_slot:o.assigned_slot},re=Array.from(new Set(N));await Promise.all(re.map(Z=>q.assignments_create({...L,target_group_id:Z}))),i({title:"Séance assignée & notifiée"})}catch(L){const re="Impossible d'assigner la séance. Vérifiez les champs et réessayez.",Z=L instanceof Error?L.message:typeof L=="string"?L:re;let P=Z;const F=Z.match(/HTTP \d+:\s*(\{.*\})/);if(F)try{P=JSON.parse(F[1])?.error||re}catch{P=re}i({title:"Erreur d'assignation",description:P})}finally{x(!1)}return}const M=f.trim();if(!M){i({title:"Nageur manquant",description:"Sélectionnez un nageur."});return}const Y=se.get(M),W=Y?.id??(Number.isFinite(Number(M))&&Number(M)>0?Number(M):void 0);if(!Number.isFinite(W)||Number(W)<=0){i({title:"Nageur invalide",description:"Sélectionnez un nageur avec un identifiant valide."});return}const E=Y?.name??M.replace(/^name:/,"");R.mutate({assignment_type:o.session_type,session_id:h,target_athlete:E,target_user_id:W,scheduled_date:o.assigned_date,scheduled_slot:o.assigned_slot})},we=!o.session_id||(p==="group"?N.length===0:!f.trim())||R.isPending||j;return e.jsxs("div",{className:"space-y-6 pb-24",children:[e.jsx(Te,{title:"Assigner une séance",description:"Planifiez une séance pour un nageur ou un ou plusieurs groupes.",onBack:s}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-2",children:[e.jsxs(G,{className:"border-l-4 border-l-primary",children:[e.jsxs(J,{children:[e.jsx(X,{children:"Séance"}),e.jsx(ee,{children:"Choisissez le type et la séance à envoyer."})]}),e.jsxs(H,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{children:"Type"}),e.jsxs(ue,{value:o.session_type,onValueChange:h=>d({...o,session_type:h,session_id:""}),children:[e.jsx(me,{children:e.jsx(pe,{})}),e.jsxs(xe,{children:[e.jsx(z,{value:"swim",children:"Natation"}),e.jsx(z,{value:"strength",children:"Musculation"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{children:"Séance"}),e.jsxs(ue,{value:o.session_id,onValueChange:h=>d({...o,session_id:h}),children:[e.jsx(me,{children:e.jsx(pe,{placeholder:"Choisir..."})}),e.jsx(xe,{children:o.session_type==="swim"?a?.map(h=>e.jsx(z,{value:h.id.toString(),children:h.name},h.id)):r?.map(h=>e.jsx(z,{value:h.id.toString(),children:h.title},h.id))})]})]})]})]}),e.jsxs(G,{children:[e.jsxs(J,{children:[e.jsx(X,{children:"Cible & planification"}),e.jsx(ee,{children:"Définissez le destinataire, la date et le créneau."})]}),e.jsxs(H,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{children:"Cible"}),e.jsxs(ue,{value:p,onValueChange:h=>{m(h),C(""),I([])},children:[e.jsx(me,{children:e.jsx(pe,{})}),e.jsxs(xe,{children:[e.jsx(z,{value:"user",children:"Nageur"}),e.jsx(z,{value:"group",children:"Groupe(s)"})]})]})]}),p==="user"?e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{children:"Nageur"}),ne.length>0?e.jsxs(ue,{value:f,onValueChange:C,children:[e.jsx(me,{children:e.jsx(pe,{placeholder:"Choisir un nageur"})}),e.jsx(xe,{children:ne.map(h=>e.jsx(z,{value:h.value,children:h.label},h.value))})]}):e.jsx(V,{value:f,onChange:h=>C(h.target.value),placeholder:"ex: Camille"})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{children:"Groupes"}),t.length>0?e.jsxs(oa,{children:[e.jsx(ca,{asChild:!0,children:e.jsxs(S,{type:"button",variant:"outline",className:"w-full justify-between","aria-label":"Sélection des groupes",children:[e.jsx("span",{className:"truncate",children:oe}),e.jsx(gr,{className:"ml-2 h-4 w-4 opacity-50"})]})}),e.jsxs(Jt,{className:"w-[--radix-popover-trigger-width] p-2",align:"start",children:[e.jsx("div",{className:"max-h-64 overflow-auto",children:e.jsx("div",{className:"space-y-1",children:w.map(h=>{const M=N.includes(h.gid);return e.jsxs("label",{className:"flex cursor-pointer items-center gap-2 rounded-md px-2 py-1.5 hover:bg-muted",children:[e.jsx(fs,{checked:M,onCheckedChange:Y=>{const W=Y===!0;I(E=>W?E.includes(h.gid)?E:[...E,h.gid]:E.filter(L=>L!==h.gid))}}),e.jsx("span",{className:"text-sm",children:h.name})]},h.gid)})})}),N.length>0?e.jsx(S,{type:"button",variant:"ghost",size:"sm",className:"mt-2 w-full",onClick:()=>I([]),children:"Tout désélectionner"}):null]})]}):e.jsx("div",{className:"text-xs text-muted-foreground",children:"Aucun groupe disponible."}),N.length>0?e.jsxs("div",{className:"text-xs text-muted-foreground",children:[N.length," groupe",N.length>1?"s":""," sélectionné",N.length>1?"s":"","."]}):null]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{children:"Date"}),e.jsx(V,{type:"date",value:o.assigned_date,onChange:h=>d({...o,assigned_date:h.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{children:"Créneau"}),e.jsxs(ue,{value:o.assigned_slot,onValueChange:h=>d({...o,assigned_slot:h}),children:[e.jsx(me,{children:e.jsx(pe,{placeholder:"Choisir..."})}),e.jsxs(xe,{children:[e.jsx(z,{value:"morning",children:"Matin"}),e.jsx(z,{value:"evening",children:"Soir"})]})]})]})]})]})]}),e.jsx("div",{className:"sticky bottom-0 z-10 -mx-4 border-t bg-background/95 p-4 backdrop-blur sm:static sm:mx-0 sm:border-0 sm:p-0",children:e.jsxs(S,{className:"w-full sm:w-auto",onClick:te,disabled:we,children:[e.jsx($e,{className:"mr-2 h-4 w-4"}),R.isPending||j?"Assignation...":"Assigner & notifier"]})})]})},ua=({onBack:s,athletes:a,groups:r,athletesLoading:n})=>{const{toast:t}=is(),[i,o]=c.useState(""),[d,j]=c.useState("Message Coach"),[x,p]=c.useState(""),m=c.useMemo(()=>a.filter(y=>y.id).map(y=>({value:`user:${y.id}`,label:y.group_label?`${y.display_name} · ${y.group_label}`:y.display_name,id:y.id})),[a]),f=c.useMemo(()=>r.map(y=>({value:`group:${y.id}`,label:y.name,id:y.id})),[r]),C=c.useMemo(()=>new Map([...m,...f].map(y=>[y.value,y])),[m,f]),N=de({mutationFn:y=>q.notifications_send({...y,type:"message"}),onSuccess:()=>{t({title:"Message envoyé"}),o("")}}),I=()=>{if(!d.trim()||!i.trim()){t({title:"Message incomplet",description:"Ajoutez un titre et un contenu."});return}if(!x){t({title:"Destinataire manquant",description:"Sélectionnez un nageur ou un groupe."});return}const y=C.get(x);if(!y?.id){t({title:"Destinataire invalide",description:"Sélectionnez un destinataire valide."});return}if(x.startsWith("group:")){N.mutate({title:d,body:i,targets:[{target_group_id:y.id}]});return}N.mutate({title:d,body:i,targets:[{target_user_id:y.id}]})};return e.jsxs("div",{className:"space-y-6 pb-24",children:[e.jsx(Te,{title:"Messagerie rapide",description:"Envoyez un message ciblé à vos nageurs.",onBack:s}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-2",children:[e.jsxs(G,{className:"border-l-4 border-l-primary",children:[e.jsxs(J,{children:[e.jsx(X,{children:"Destinataire"}),e.jsx(ee,{children:"Sélectionnez un nageur ou un groupe à prévenir."})]}),e.jsx(H,{className:"space-y-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{children:"Destinataire"}),e.jsxs(ue,{value:x,onValueChange:p,children:[e.jsx(me,{children:e.jsx(pe,{placeholder:n?"Chargement...":"Choisir un nageur ou un groupe"})}),e.jsxs(xe,{children:[f.length?e.jsxs(e.Fragment,{children:[e.jsx(z,{value:"section-group",disabled:!0,children:"Groupes"}),f.map(y=>e.jsx(z,{value:y.value,children:y.label},y.value))]}):null,m.length?e.jsxs(e.Fragment,{children:[e.jsx(z,{value:"section-athlete",disabled:!0,children:"Nageurs"}),m.map(y=>e.jsx(z,{value:y.value,children:y.label},y.value))]}):null]})]})]})})]}),e.jsxs(G,{children:[e.jsxs(J,{children:[e.jsx(X,{children:"Contenu"}),e.jsx(ee,{children:"Rédigez votre message en quelques lignes."})]}),e.jsxs(H,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{htmlFor:"msg-title",children:"Titre"}),e.jsx(V,{id:"msg-title",value:d,onChange:y=>j(y.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{htmlFor:"msg-body",children:"Message"}),e.jsx(Pe,{id:"msg-body",placeholder:"Message...",value:i,onChange:y=>o(y.target.value),rows:5,maxLength:500}),e.jsxs("div",{className:"text-xs text-muted-foreground text-right",children:[i.length,"/500"]})]})]})]})]}),e.jsx("div",{className:"sticky bottom-0 z-10 -mx-4 border-t bg-background/95 p-4 backdrop-blur sm:static sm:mx-0 sm:border-0 sm:p-0",children:e.jsxs(S,{className:"w-full sm:w-auto",onClick:I,disabled:N.isPending,children:[e.jsx(ls,{className:"mr-2 h-4 w-4"}),N.isPending?"Envoi...":"Envoyer"]})})]})},ma=({onNavigate:s})=>e.jsxs(G,{className:"border-l-4 border-l-primary",children:[e.jsxs(J,{children:[e.jsx(X,{children:"Actions rapides"}),e.jsx(ee,{children:"Accélérez vos tâches les plus fréquentes."})]}),e.jsxs(H,{className:"grid gap-3 sm:grid-cols-2",children:[e.jsxs(S,{className:"justify-start",variant:"outline",onClick:()=>s("assignments"),children:[e.jsx($e,{className:"mr-2 h-4 w-4"}),"Assigner une séance"]}),e.jsxs(S,{className:"justify-start",variant:"outline",onClick:()=>s("messaging"),children:[e.jsx(ls,{className:"mr-2 h-4 w-4"}),"Message rapide"]})]})]}),pa=({onNavigate:s,onOpenRecordsAdmin:a,athletes:r,athletesLoading:n,upcomingBirthdays:t,birthdaysLoading:i,kpiLoading:o,kpiPeriod:d,onKpiPeriodChange:j,fatigueAlerts:x,mostLoadedAthlete:p})=>e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("h1",{className:"text-3xl font-display font-bold uppercase italic text-primary",children:"Espace Coach"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Votre tableau de bord pour gérer les séances, les nageurs et la communication."})]}),e.jsxs("div",{className:"space-y-3 sm:hidden",children:[e.jsx("div",{children:e.jsx("h2",{className:"text-sm font-semibold uppercase tracking-[0.2em] text-muted-foreground",children:"Par où commencer"})}),e.jsxs("div",{className:"grid gap-3",children:[e.jsx("button",{type:"button",onClick:()=>s("swim"),className:"rounded-xl border bg-white p-4 text-left shadow-sm transition hover:border-primary focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold",children:"Créer une séance natation"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Structurer un nouveau plan."})]}),e.jsx(Ps,{className:"h-5 w-5 text-primary"})]})}),e.jsx("button",{type:"button",onClick:()=>s("assignments"),className:"rounded-xl border bg-white p-4 text-left shadow-sm transition hover:border-primary focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold",children:"Assigner une séance"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Envoyer une séance à un nageur."})]}),e.jsx($e,{className:"h-5 w-5 text-primary"})]})}),e.jsx("button",{type:"button",onClick:()=>s("messaging"),className:"rounded-xl border bg-white p-4 text-left shadow-sm transition hover:border-primary focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold",children:"Envoyer un message"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Relancer ou féliciter un nageur."})]}),e.jsx(ls,{className:"h-5 w-5 text-primary"})]})})]})]}),e.jsx("div",{className:"hidden sm:block",children:e.jsx(ma,{onNavigate:s})}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsxs(G,{className:"shadow-sm",children:[e.jsxs(J,{children:[e.jsxs(X,{className:"flex items-center gap-2",children:[e.jsx(Ps,{className:"h-5 w-5 text-primary"}),"Natation"]}),e.jsx(ee,{children:"Consultez et créez des séances natation."})]}),e.jsx(H,{children:e.jsx(S,{className:"w-full",onClick:()=>s("swim"),children:"Accéder à la bibliothèque"})})]}),e.jsxs(G,{className:"shadow-sm",children:[e.jsxs(J,{children:[e.jsxs(X,{className:"flex items-center gap-2",children:[e.jsx(xr,{className:"h-5 w-5 text-primary"}),"Musculation"]}),e.jsx(ee,{children:"Préparez les plans muscu et les suivis."})]}),e.jsx(H,{children:e.jsx(S,{className:"w-full",onClick:()=>s("strength"),children:"Accéder à la bibliothèque"})})]}),e.jsxs(G,{className:"shadow-sm",children:[e.jsxs(J,{children:[e.jsxs(X,{className:"flex items-center gap-2",children:[e.jsx(Be,{className:"h-5 w-5 text-primary"}),"Mes nageurs"]}),e.jsx(ee,{children:"Accédez aux fiches individuelles et aux groupes."})]}),e.jsx(H,{children:e.jsx(S,{className:"w-full",onClick:()=>s("swimmers"),children:"Voir les nageurs"})})]}),e.jsxs(G,{className:"shadow-sm",children:[e.jsxs(J,{children:[e.jsxs(X,{className:"flex items-center gap-2",children:[e.jsx(hr,{className:"h-5 w-5 text-primary"}),"Records club"]}),e.jsx(ee,{children:"Importer les performances FFN et reconstruire les records."})]}),e.jsx(H,{children:e.jsx(S,{className:"w-full",variant:"outline",onClick:a,children:"Administration des records"})})]})]}),e.jsxs("div",{className:"grid gap-4 lg:grid-cols-2",children:[e.jsxs(G,{className:"sm:hidden bg-primary text-primary-foreground",children:[e.jsxs(J,{className:"space-y-1",children:[e.jsx(X,{className:"text-base",children:"Indicateurs clés"}),e.jsx(ee,{className:"text-primary-foreground/70",children:"Synthèse rapide pour aujourd'hui."})]}),e.jsxs(H,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between rounded-lg border border-primary-foreground/10 bg-primary-foreground/5 p-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.2em] text-primary-foreground/70",children:"Fatigue 5/5"}),e.jsx("p",{className:"text-2xl font-semibold",children:o?"…":x.length}),e.jsx("p",{className:"text-xs text-primary-foreground/70",children:o?"Chargement...":x.length?x.slice(0,2).map(m=>m.athleteName).join(", "):"Aucune alerte"})]}),e.jsx(qs,{className:"h-5 w-5 text-primary-foreground/70"})]}),e.jsxs("div",{className:"flex items-center justify-between rounded-lg border border-primary-foreground/10 bg-primary-foreground/5 p-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.2em] text-primary-foreground/70",children:"Nageur le plus chargé"}),e.jsx("p",{className:"text-lg font-semibold",children:o?"…":p?.athleteName??"-"}),e.jsx("p",{className:"text-xs text-primary-foreground/70",children:o?"Calcul en cours":p?`Charge ${Math.round(p.loadScore)}`:"Pas de données récentes"})]}),e.jsx(Be,{className:"h-5 w-5 text-primary-foreground/70"})]})]})]}),e.jsxs(G,{className:"hidden sm:block",children:[e.jsx(J,{className:"space-y-2",children:e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(X,{children:"Signaux clés"}),e.jsx(ee,{children:"Vue d'ensemble rapide de votre groupe."})]}),e.jsxs(It,{type:"single",size:"sm",variant:"outline",value:String(d),onValueChange:m=>{m&&j(Number(m))},children:[e.jsx(Ke,{value:"7","aria-label":"Période 7 jours","aria-pressed":d===7,children:"7j"}),e.jsx(Ke,{value:"30","aria-label":"Période 30 jours","aria-pressed":d===30,children:"30j"}),e.jsx(Ke,{value:"365","aria-label":"Période 365 jours","aria-pressed":d===365,children:"365j"})]})]})}),e.jsxs(H,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between rounded-lg border bg-muted/30 p-3",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Fatigue 5/5 (",d,"j)"]}),e.jsx("p",{className:"text-xl font-semibold",children:o?"…":x.length}),e.jsx("p",{className:"text-xs text-muted-foreground",children:o?"Chargement...":x.length?x.slice(0,2).map(m=>m.athleteName).join(", "):"Aucune alerte"})]}),e.jsx(qs,{className:"h-5 w-5 text-muted-foreground"})]}),e.jsxs("div",{className:"flex items-center justify-between rounded-lg border bg-muted/30 p-3",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Nageur le plus chargé (",d,"j)"]}),e.jsx("p",{className:"text-xl font-semibold",children:o?"…":p?.athleteName??"-"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:o?"Calcul en cours":p?`Charge ${Math.round(p.loadScore)}`:"Pas de données récentes"})]}),e.jsx(Be,{className:"h-5 w-5 text-muted-foreground"})]})]})]}),e.jsxs(G,{children:[e.jsxs(J,{children:[e.jsx(X,{children:"Anniversaires à venir"}),e.jsx(ee,{children:"Les 30 prochains jours."})]}),e.jsxs(H,{className:"space-y-3",children:[i?e.jsx("p",{className:"text-sm text-muted-foreground",children:"Chargement..."}):t&&t.length>0?t.slice(0,3).map(m=>e.jsxs("div",{className:"flex items-center justify-between rounded-lg border p-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:m.display_name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:xa(m.next_birthday)})]}),e.jsxs("span",{className:"text-xs font-semibold text-primary",children:["J-",m.days_until]})]},m.id)):e.jsx("p",{className:"text-sm text-muted-foreground",children:"Aucun anniversaire dans les 30 prochains jours."}),e.jsx(S,{variant:"outline",className:"w-full",onClick:()=>s("swimmers"),children:"Voir tous les nageurs"})]})]})]})]}),xa=s=>{if(!s)return"-";const a=new Date(s);return Number.isNaN(a.getTime())?s:a.toLocaleDateString("fr-FR")},st=s=>s.toISOString().split("T")[0],ha=s=>new Date(s.completed_at||s.started_at||s.date||s.created_at||0).getTime(),fa=s=>{if(!s.length)return null;const a=s.reduce((n,t)=>n+t,0)/s.length,r=Math.min(5,Math.max(1,Math.round(a/10*5)));return{average:a,rating:r}};function qa(){const s=Le(R=>R.role);Le(R=>R.selectedAthleteId);const a=Le(R=>R.setSelectedAthlete),[,r]=pr(),[n,t]=c.useState("home"),[i,o]=c.useState(7),d=s==="coach"||s==="admin",j=n==="assignments",x=n==="home"||n==="assignments"||n==="messaging"||n==="swimmers",p=n==="assignments"||n==="messaging",m=n==="home"||n==="swimmers",{data:f}=ge({queryKey:["swim_catalog"],queryFn:()=>q.getSwimCatalog(),enabled:d&&j}),{data:C}=ge({queryKey:["strength_catalog"],queryFn:()=>q.getStrengthSessions(),enabled:d&&j}),{data:N=[],isLoading:I}=ge({queryKey:["athletes"],queryFn:()=>q.getAthletes(),enabled:d&&x}),y=c.useMemo(()=>N.slice(0,5),[N]),{data:ne=[]}=ge({queryKey:["groups"],queryFn:()=>q.getGroups(),enabled:d&&p}),se=ge({queryKey:["upcoming-birthdays"],queryFn:()=>q.getUpcomingBirthdays({days:30}),enabled:d&&m}),w=se.data,D=ge({queryKey:["coach-kpis",i,y.map(R=>R.id??R.display_name)],enabled:d&&n==="home"&&y.length>0,queryFn:async()=>{const R=i,te=new Date;te.setDate(te.getDate()-R);const we=st(te),h=st(new Date),M=await Promise.all(y.map(async E=>{const[L,re]=await Promise.all([q.getSessions(E.display_name,E.id),q.getStrengthHistory(E.display_name,{athleteId:E.id,limit:50,from:we,to:h})]),Z=L.filter($=>new Date($.date).getTime()>=te.getTime()),P=Z.map($=>$.fatigue??$.feeling).filter($=>Number.isFinite($)),F=Z.reduce(($,ie)=>$+(Number(ie.duration)||0)*(Number(ie.effort)||0),0),ae=(re?.runs??[]).filter($=>ha($)>=te.getTime()),ce=ae.map($=>$.fatigue??$.feeling??$.rpe).filter($=>Number.isFinite(Number($))).map($=>Number($)),Re=ae.reduce(($,ie)=>{const _e=Number(ie.feeling??ie.rpe??0),Ce=Number(ie.duration??0);if(Ce>0&&_e>0)return $+Ce*_e;const u=Array.isArray(ie.logs)?ie.logs.length:0;return $+u*5},0),Ae=fa([...P,...ce]);return{athleteName:E.display_name,loadScore:F+Re,fatigueRating:Ae}})),Y=M.filter(E=>E.fatigueRating?.rating===5).map(E=>({athleteName:E.athleteName,rating:E.fatigueRating?.rating??0})),W=M.filter(E=>E.loadScore>0).sort((E,L)=>L.loadScore-E.loadScore)[0];return{fatigueAlerts:Y,mostLoadedAthlete:W??null}}}),oe=R=>{a({id:R.id??null,name:R.display_name}),r("/progress")};return d?e.jsxs("div",{className:"space-y-6",children:[n==="home"?e.jsx(pa,{onNavigate:t,onOpenRecordsAdmin:()=>r("/records-admin"),athletes:N,athletesLoading:I,upcomingBirthdays:w,birthdaysLoading:se.isLoading,kpiLoading:D.isLoading,kpiPeriod:i,onKpiPeriodChange:o,fatigueAlerts:D.data?.fatigueAlerts??[],mostLoadedAthlete:D.data?.mostLoadedAthlete??null}):null,n==="assignments"?e.jsx(da,{onBack:()=>t("home"),swimSessions:f,strengthSessions:C,athletes:N,groups:ne}):null,n==="swim"?e.jsxs("div",{className:"space-y-6",children:[e.jsx(Te,{title:"Bibliothèque natation",description:"Accédez aux séances et aux templates natation.",onBack:()=>t("home"),actions:e.jsxs(S,{variant:"outline",onClick:()=>t("assignments"),children:[e.jsx($e,{className:"mr-2 h-4 w-4"}),"Nouvelle assignation"]})}),e.jsx(Cn,{})]}):null,n==="strength"?e.jsxs("div",{className:"space-y-6",children:[e.jsx(Te,{title:"Bibliothèque musculation",description:"Consultez et créez des séances musculation.",onBack:()=>t("home"),actions:e.jsxs(S,{variant:"outline",onClick:()=>t("assignments"),children:[e.jsx($e,{className:"mr-2 h-4 w-4"}),"Nouvelle assignation"]})}),e.jsx(xn,{})]}):null,n==="swimmers"?e.jsxs("div",{className:"space-y-6",children:[e.jsx(Te,{title:"Nageurs",description:"Accédez aux fiches individuelles des nageurs.",onBack:()=>t("home"),actions:e.jsxs(S,{variant:"outline",onClick:()=>t("messaging"),children:[e.jsx(ls,{className:"mr-2 h-4 w-4"}),"Message rapide"]})}),e.jsxs(G,{children:[e.jsxs(J,{children:[e.jsx(X,{children:"Suivi des Nageurs"}),e.jsx(ee,{children:"Accédez aux fiches individuelles des nageurs."})]}),e.jsx(H,{children:I?e.jsx("div",{className:"space-y-3 p-2",children:[1,2,3,4,5].map(R=>e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-4 w-1/3 rounded-lg bg-muted animate-pulse motion-reduce:animate-none"}),e.jsx("div",{className:"h-4 w-1/4 rounded-lg bg-muted animate-pulse motion-reduce:animate-none"}),e.jsx("div",{className:"ml-auto h-8 w-16 rounded-lg bg-muted animate-pulse motion-reduce:animate-none"})]},R))}):N.length?e.jsx("div",{className:"w-full overflow-x-auto",children:e.jsxs(Pr,{children:[e.jsx(Dr,{children:e.jsxs(Vs,{children:[e.jsx(ps,{children:"Nageur"}),e.jsx(ps,{children:"Groupe"}),e.jsx(ps,{className:"text-right",children:"Fiche"})]})}),e.jsx(Mr,{children:N.map(R=>e.jsxs(Vs,{children:[e.jsx(xs,{className:"font-medium",children:R.display_name}),e.jsx(xs,{children:R.group_label?e.jsx(Tr,{variant:"secondary",children:R.group_label}):e.jsx("span",{className:"text-xs text-muted-foreground",children:"Sans groupe"})}),e.jsx(xs,{className:"text-right",children:e.jsx(S,{size:"sm",variant:"outline",onClick:()=>oe(R),children:"Voir la fiche"})})]},R.id??R.display_name))})]})}):e.jsx("p",{className:"text-sm text-muted-foreground",children:"Aucun nageur disponible."})})]})]}):null,n==="messaging"?e.jsx(ua,{onBack:()=>t("home"),athletes:N,groups:ne,athletesLoading:I}):null]}):e.jsx("div",{className:"flex items-center justify-center min-h-[60vh] animate-in fade-in motion-reduce:animate-none",children:e.jsxs(G,{className:"w-full max-w-sm shadow-xl border-t-4 border-t-primary",children:[e.jsxs(J,{children:[e.jsxs(X,{className:"flex items-center gap-2 uppercase italic",children:[e.jsx(Be,{className:"h-5 w-5 text-primary"}),"Accès Coach"]}),e.jsx(ee,{children:"Cette section est réservée aux coachs et administrateurs."})]}),e.jsx(H,{children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"Connectez-vous avec un compte autorisé pour accéder aux outils de gestion."})})]})})}export{qa as default};
