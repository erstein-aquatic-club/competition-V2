import{r as t,j as e}from"./vendor-ui-CDk0TPZB.js";import{u as H,a as de,C as ue,b as me,e as xe,c as pe,d as he,f as ge,L as o,I as c,B as m,s as v,g as fe}from"./index-DpV54lvT.js";import{u as je}from"./vendor-query-aL7hzhW6.js";import{D as _,a as K,b as Q,c as W,d as X}from"./dialog-Dgvl1I_Y.js";import{S as ve,a as be,b as ye,c as we,d as Ne}from"./select-DbHakkKm.js";import"./vendor-react-BzrpNAyj.js";import"./vendor-charts-bGfQb4ap.js";import"./vendor-supabase-CgI36rMY.js";import"./check-C4YYt1vA.js";const Se=a=>a,Ee=a=>{switch(a){case"coach":return"/coach";case"admin":return"/admin";case"comite":return"/comite";default:return"/"}};function Te(){const[a,J]=t.useState(""),[x,Y]=t.useState(""),[z,b]=t.useState(null),[D,L]=t.useState(!1),[l,p]=t.useState(!1),[h,Z]=t.useState(""),[y,k]=t.useState(""),[w,A]=t.useState(""),[N,P]=t.useState(""),[d,S]=t.useState(""),[T,i]=t.useState(null),[q,E]=t.useState(!1),[$,C]=t.useState(!1),[ee,g]=t.useState(!1),[R,f]=t.useState(""),[se,F]=t.useState(!1),[M,O]=t.useState(!1),[U,I]=t.useState(null),{loginFromSession:te,loadUser:re}=H(),[,ae]=de(),V=t.useRef(null),B=t.useRef(null),{data:u=[],isLoading:G,isError:ie}=je({queryKey:["register-groups"],queryFn:()=>fe.getGroups(),enabled:l,retry:2});t.useEffect(()=>{l&&!d&&u.length>0&&S(String(u[0].id))},[u,d,l]),t.useEffect(()=>{Se(l)&&B.current?.focus()},[l]);const ne=s=>s.includes("Invalid login")?"Identifiant ou mot de passe incorrect.":s.includes("Email not confirmed")?"Veuillez confirmer votre email avant de vous connecter.":s,oe=async s=>{s.preventDefault();const n=a.trim();if(n){if(!x.trim()){b("Mot de passe requis."),V.current?.focus();return}L(!0),b(null);try{const{data:r,error:j}=await v.auth.signInWithPassword({email:n,password:x});if(j)throw new Error(ne(j.message));if(!r.session)throw new Error("Session non reçue.");if(te(r.session),!await re())throw new Error("Impossible de récupérer le profil utilisateur.");const ce=H.getState().role;ae(Ee(ce),{replace:!0})}catch(r){const j=r instanceof Error?r.message:"Connexion impossible.";b(j)}finally{L(!1)}}},le=async()=>{O(!0),I(null);try{const{error:s}=await v.auth.resetPasswordForEmail(R,{redirectTo:window.location.origin+"/competition/#/reset-password"});if(s)throw s;F(!0)}catch(s){const n=s instanceof Error?s.message:"Erreur lors de l'envoi";I(n)}finally{O(!1)}};return e.jsxs("div",{className:"min-h-screen flex items-center justify-center p-4 bg-background relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-[-20%] right-[-10%] w-[600px] h-[600px] bg-primary/10 rounded-full blur-3xl pointer-events-none"}),e.jsxs(ue,{className:"w-full max-w-sm relative z-10 shadow-2xl border-t-8 border-t-primary animate-in fade-in zoom-in duration-500 motion-reduce:animate-none",children:[e.jsxs(me,{className:"text-center pb-2",children:[e.jsx("div",{className:"mx-auto mb-6 h-24 w-24 rounded-full bg-foreground flex items-center justify-center border-4 border-primary shadow-lg",children:e.jsx("img",{src:xe,alt:"EAC Logo",loading:"lazy",className:"h-full w-full object-cover rounded-full opacity-90"})}),e.jsxs(pe,{className:"text-3xl font-display italic uppercase tracking-tighter",children:["SUIVI",e.jsx("span",{className:"text-primary",children:"NATATION"})]}),e.jsx(he,{className:"uppercase tracking-widest text-xs font-bold",children:"Erstein Aquatic Club"})]}),e.jsx(ge,{children:e.jsxs("form",{onSubmit:oe,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"login-email",className:"sr-only",children:"Email"}),e.jsx(c,{id:"login-email","aria-label":"Email",placeholder:"Email",type:"email",value:a,onChange:s=>{J(s.target.value),l&&p(!1)},className:"text-center text-lg h-12 border-2 focus-visible:ring-primary",autoFocus:!0}),e.jsx("p",{className:"text-xs text-muted-foreground text-center",children:"Saisissez votre email et votre mot de passe."}),e.jsx(o,{htmlFor:"login-password",className:"sr-only",children:"Mot de passe"}),e.jsx(c,{id:"login-password","aria-label":"Mot de passe",placeholder:"Mot de passe",type:"password",value:x,onChange:s=>Y(s.target.value),ref:V,className:"text-center text-lg h-12 border-2 focus-visible:ring-primary"}),z?e.jsx("div",{className:"rounded-lg border border-destructive/20 bg-destructive/10 p-3 text-sm text-destructive text-center",children:z}):null]}),e.jsx(m,{type:"submit",className:"w-full h-12 text-lg font-bold uppercase tracking-wider shadow-md hover:scale-[1.02] transition-transform",disabled:!a.trim()||!x.trim()||D,children:D?"Connexion...":"CONNEXION"}),e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx("button",{type:"button",onClick:()=>{p(!0);const s=a.trim();k(s)},className:"text-xs text-muted-foreground underline underline-offset-4 transition-colors hover:text-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary focus-visible:ring-offset-2",children:"Créer un compte"}),e.jsx("button",{type:"button",className:"text-xs text-muted-foreground hover:text-primary underline",onClick:()=>{g(!0),f(a.trim())},children:"Mot de passe oublié ?"})]})]})})]}),e.jsx(_,{open:l,onOpenChange:s=>{p(s),s||(i(null),A(""),P(""),S(""),C(!1))},children:e.jsx(K,{className:"sm:max-w-md",children:$?e.jsxs("div",{className:"text-center space-y-4 py-4",children:[e.jsx("div",{className:"mx-auto flex h-16 w-16 items-center justify-center rounded-full bg-muted",children:e.jsx("span",{className:"text-3xl text-primary",children:"✓"})}),e.jsx("h2",{className:"text-xl font-semibold",children:"Compte créé avec succès !"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Un coach ou un administrateur doit valider votre inscription avant votre première connexion."}),e.jsx(m,{className:"w-full",variant:"outline",onClick:()=>{C(!1),p(!1)},children:"Retour à la connexion"})]}):e.jsxs(e.Fragment,{children:[e.jsxs(Q,{children:[e.jsx(W,{children:"Créer un compte"}),e.jsx(X,{children:"Complétez les informations pour créer votre profil."})]}),e.jsxs("form",{className:"space-y-4",onSubmit:async s=>{if(s.preventDefault(),!h.trim()){i("Ajoutez votre nom.");return}if(!y.trim()){i("Ajoutez votre email.");return}if(!d){i("Sélectionnez un groupe.");return}if(!N){i("Ajoutez votre date de naissance.");return}if(!w){i("Choisissez un mot de passe.");return}i(null),E(!0);try{const{data:n,error:r}=await v.auth.signUp({email:y.trim(),password:w,options:{data:{display_name:h.trim(),birthdate:N,group_id:Number(d)}}});if(r)throw new Error(r.message);if(n.user){await v.auth.signOut(),C(!0),E(!1);return}i("Création impossible.")}catch(n){const r=n instanceof Error?n.message:"Création impossible.";i(r)}finally{E(!1)}},children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"register-name",children:"Nom d'affichage"}),e.jsx(c,{id:"register-name",value:h,onChange:s=>Z(s.target.value),placeholder:"Votre nom",ref:B})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"register-email",children:"Email"}),e.jsx(c,{id:"register-email",type:"email",value:y,onChange:s=>k(s.target.value),placeholder:"prenom.nom@email.com",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"register-birthdate",children:"Date de naissance"}),e.jsx(c,{id:"register-birthdate",type:"date",value:N,onChange:s=>P(s.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"register-group",children:"Groupe"}),e.jsxs(ve,{value:d,onValueChange:S,disabled:G||u.length===0,children:[e.jsx(be,{id:"register-group",children:e.jsx(ye,{placeholder:G?"Chargement...":ie?"Erreur de chargement":"Sélectionnez un groupe"})}),e.jsx(we,{children:u.map(s=>e.jsx(Ne,{value:String(s.id),children:s.name},s.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"register-password",children:"Mot de passe"}),e.jsx(c,{id:"register-password",type:"password",value:w,onChange:s=>A(s.target.value),placeholder:"Choisissez un mot de passe"})]}),T?e.jsx("p",{className:"text-sm text-destructive",children:T}):null,e.jsx(m,{type:"submit",className:"w-full",disabled:q||!h.trim(),children:q?"Création...":"Créer le compte"})]})]})})}),e.jsx(_,{open:ee,onOpenChange:s=>{g(s),s||(I(null),F(!1),f(""))},children:e.jsx(K,{className:"sm:max-w-md",children:se?e.jsxs("div",{className:"text-center space-y-4 py-4",children:[e.jsx("div",{className:"mx-auto flex h-16 w-16 items-center justify-center rounded-full bg-muted",children:e.jsx("span",{className:"text-3xl text-primary",children:"✉"})}),e.jsx("h2",{className:"text-xl font-semibold",children:"Email envoyé"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Un email de réinitialisation a été envoyé. Vérifiez votre boîte de réception."}),e.jsx(m,{className:"w-full",variant:"outline",onClick:()=>{g(!1),F(!1),f("")},children:"Retour à la connexion"})]}):e.jsxs(e.Fragment,{children:[e.jsxs(Q,{children:[e.jsx(W,{children:"Réinitialiser le mot de passe"}),e.jsx(X,{children:"Entrez votre adresse email pour recevoir un lien de réinitialisation."})]}),e.jsxs("form",{className:"space-y-4",onSubmit:s=>{s.preventDefault(),le()},children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"reset-email",children:"Email"}),e.jsx(c,{id:"reset-email",type:"email",value:R,onChange:s=>f(s.target.value),placeholder:"votre@email.com",required:!0,autoFocus:!0})]}),U?e.jsx("div",{className:"rounded-lg border border-destructive/20 bg-destructive/10 p-3 text-sm text-destructive text-center",children:U}):null,e.jsx(m,{type:"submit",className:"w-full",disabled:!R.trim()||M,children:M?"Envoi...":"Envoyer le lien"}),e.jsx("div",{className:"flex justify-center",children:e.jsx("button",{type:"button",className:"text-xs text-muted-foreground hover:text-primary underline",onClick:()=>g(!1),children:"Retour à la connexion"})})]})]})})}),e.jsx("div",{className:"absolute bottom-4 text-xs text-muted-foreground opacity-50 uppercase font-bold tracking-widest",children:"EAC Performance Tracking"})]})}export{Te as default};
