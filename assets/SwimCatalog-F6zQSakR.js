import{j as e,r as b}from"./vendor-ui-DJQMR4VV.js";import{b as Je,u as ie,c as ne}from"./vendor-query-BT4y-huw.js";import{i as $,c as j,j as Ge,u as Ye,h as L,C as A,I as C,B as w,S as g,b as Ze}from"./index-DNODqqqp.js";import{T as Ie}from"./textarea-Jeq8J0o1.js";import{D as re,a as ae}from"./dialog-DTymDxcY.js";import{A as le,a as oe,b as ce,c as de,d as me,e as ue,f as xe,g as pe}from"./alert-dialog-DniiFp6-.js";import{S as he,a as fe,b as be,c as je,d as ge}from"./select-gPcOlEEO.js";import{c as Te,b as es,i as ye,g as ss,a as ve,R as ts,L as is}from"./SwimSessionConsultation-DWZ0RSPi.js";import{f as ns}from"./vendor-date-cQbdWov0.js";import{C as rs}from"./chevron-left-BpGqGoDe.js";import{P as Ne}from"./play-CZhuvOMQ.js";import{S as as}from"./save-BLtvUHxS.js";import{P as D}from"./plus-kykhVVIe.js";import{T as M,G as ls}from"./trash-2-DPsDWArt.js";import{C as we}from"./circle-alert-0p_Ck6v_.js";import{S as os}from"./search-Dco3EIYK.js";import{T as cs}from"./timer-QduAlcG4.js";import"./vendor-react-BzrpNAyj.js";import"./vendor-charts-Db4xOvcx.js";import"./vendor-supabase-D7B1G6YZ.js";import"./chevron-up-BGIoZ6nf.js";import"./check-CPgcghXC.js";import"./badge-DDSpudwr.js";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ds=[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8",key:"1s80jp"}],["path",{d:"M10 12h4",key:"a56b0p"}]],ms=$("archive",ds);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const us=[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]],Se=$("arrow-down",us);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xs=[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]],Ce=$("arrow-up",xs);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ps=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]],hs=$("pencil",ps),ke=["V0","V1","V2","V3","Max"],fs={V0:"bg-intensity-1",V1:"bg-intensity-2",V2:"bg-intensity-3",V3:"bg-intensity-4",Max:"bg-intensity-5"},_e={souple:"V0",facile:"V0",relache:"V0",relâché:"V0"},bs=r=>{if(!r)return"V0";const l=r.trim();if(!l)return"V0";const a=l.toLowerCase();if(_e[a])return _e[a];const i=l.toUpperCase();if(i==="MAX")return"Max";if(i.startsWith("V")){const o=i.replace("V","V");return o==="V4"||o==="V5"?"Max":o}return l};function js({value:r,onChange:l,className:a,ariaLabel:i="Sélection d'intensité"}){const o=bs(r),p=ke.includes(o)?o:"Max";return e.jsx("div",{role:"radiogroup","aria-label":i,className:j("flex flex-wrap items-center gap-2",a),children:ke.map(u=>{const h=p===u;return e.jsxs("button",{type:"button",role:"radio","aria-checked":h,"aria-label":`Intensité ${u==="Max"?"MAX":u}`,onClick:()=>l(u),className:j("flex flex-col items-center gap-1 rounded-full px-2 py-1 text-[10px] font-semibold text-muted-foreground transition","focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary",h?"text-foreground":"hover:text-foreground"),children:[e.jsx("span",{className:j("h-3 w-3 rounded-full",h?fs[u]??"bg-primary":"bg-muted")}),e.jsx("span",{children:u==="Max"?"MAX":u})]},u)})})}function gs(r){b.useEffect(()=>{if(!r)return;const l=a=>{a.preventDefault()};return window.addEventListener("beforeunload",l),()=>window.removeEventListener("beforeunload",l)},[r])}function Ve(r){return`Séance du ${ns(r,"dd/MM/yyyy")} - Soir - Matin`}const Ae={souple:"V0",facile:"V0",relache:"V0",relâché:"V0"},ys=["V0","V1","V2","V3","Max"],q=r=>{if(!r)return"V0";const l=r.trim();if(!l)return"V0";const a=l.toLowerCase();if(Ae[a])return Ae[a];const i=l.toUpperCase();if(i==="MAX")return"Max";if(i.startsWith("V")){const o=Number.parseInt(i.slice(1),10);if(Number.isFinite(o)&&o>=4)return"Max";if(ys.includes(i))return i}return l},De=r=>r==="Max"?"MAX":r,W=r=>{let l=0;return r.flatMap((a,i)=>a.exercises.map((o,p)=>{const u={block_title:a.title,block_description:a.description||null,block_order:i,block_repetitions:a.repetitions??null,block_modalities:a.modalities||null,block_equipment:a.equipment??[],exercise_repetitions:o.repetitions??null,exercise_rest:o.rest??null,exercise_stroke:o.stroke||null,exercise_stroke_type:o.strokeType||null,exercise_intensity:o.intensity?q(o.intensity):null,exercise_modalities:o.modalities||null,exercise_equipment:o.equipment??[],exercise_order:p},h=o.repetitions&&o.distance?`${o.repetitions}x${o.distance}m`:o.distance?`${o.distance}m`:null;return{ordre:l++,label:h,distance:o.distance??null,duration:null,intensity:o.intensity?q(o.intensity):null,notes:o.modalities||null,raw_payload:u}}))},vs=(r=[])=>{const l=new Map;return r.forEach(a=>{const i=a.raw_payload??{},o=i.block_title||i.section||"Bloc",p=Number(i.block_order??0),u=`${p}-${o}`,h=i.block_equipment??i.equipment??[],k=(Array.isArray(h)?h:String(h).split(",")).map(v=>String(v)).map(v=>Me(v)).filter(Boolean);l.has(u)||l.set(u,{title:o,repetitions:i.block_repetitions??null,description:i.block_description??"",modalities:i.block_modalities??i.modalities??"",equipment:k,exercises:[],order:Number.isFinite(p)?p:0,exerciseOrder:new Map});const S=l.get(u),_=Number(i.exercise_order??a.ordre??S.exercises.length),V=q(i.exercise_intensity??a.intensity??"V1");S.exerciseOrder.set(_,{repetitions:i.exercise_repetitions??null,distance:a.distance??null,rest:i.exercise_rest??null,stroke:i.exercise_stroke??i.stroke??"crawl",strokeType:i.exercise_stroke_type??i.stroke_type??"nc",intensity:V,modalities:i.exercise_modalities??a.notes??"",equipment:Array.isArray(i.exercise_equipment)?i.exercise_equipment.map(v=>Me(v)):[]})}),Array.from(l.values()).sort((a,i)=>a.order-i.order).map(a=>({title:a.title,repetitions:a.repetitions,description:a.description,modalities:a.modalities,equipment:a.equipment,exercises:Array.from(a.exerciseOrder.entries()).sort(([i],[o])=>i-o).map(([,i])=>i)}))},Ns=r=>r?r.length>48?`${r.slice(0,45).trim()}…`:r:"",Me=r=>{const l=r.trim().toLowerCase();return l&&(l.startsWith("plaquette")?"plaquettes":l.startsWith("palm")?"palmes":l.startsWith("tuba")?"tuba":l.startsWith("pull")?"pull":l.startsWith("elas")?"elastique":l)},ws=(r=[])=>new Set(r.map(a=>{const i=a.raw_payload;return i?.block_title||i?.section||"Bloc"})).size,Ss=r=>{const l=Te(r.items??[]),i=r.items?.some(p=>p.duration!=null)??!1?r.items?.reduce((p,u)=>p+(u.duration??0),0)??0:null,o=ws(r.items??[]);return{totalDistance:l,totalDuration:i,blockCount:o}},qe="swim_catalog_archived_ids",Cs=(r,l)=>l===null?!1:!l.some(a=>a.session_type==="swim"&&a.session_id===r);function Gs(){const{toast:r}=Ge(),l=Je(),{userId:a,role:i}=Ye(),[o,p]=b.useState(!1);gs(o);const[u,h]=b.useState(null),[k,S]=b.useState(null),[_,V]=b.useState(null),[v,Ee]=b.useState(""),[z,T]=b.useState("compact"),[O,K]=b.useState(new Set),E=()=>({id:null,name:Ve(new Date),description:"",estimatedDuration:0,blocks:[]}),[c,f]=b.useState(E),{data:P,isLoading:Be,error:R,refetch:Le}=ie({queryKey:["swim_catalog"],queryFn:()=>L.getSwimCatalog()}),{data:Q,isLoading:$e,isError:ze,error:X,refetch:Oe}=ie({queryKey:["coach-assignments"],queryFn:()=>L.getAssignmentsForCoach(),enabled:i==="coach"||i==="admin"});b.useEffect(()=>{if(typeof window>"u")return;const s=window.localStorage.getItem(qe);if(s)try{const t=JSON.parse(s);Array.isArray(t)&&K(new Set(t.map(n=>Number(n)).filter(n=>Number.isFinite(n))))}catch{return}},[]),b.useEffect(()=>{typeof window>"u"||window.localStorage.setItem(qe,JSON.stringify(Array.from(O.values())))},[O]);const Pe=b.useMemo(()=>{const s=v.trim().toLowerCase();return s?(P??[]).filter(t=>t.name.toLowerCase().includes(s)):P??[]},[P,v]).filter(s=>!O.has(s.id)),Re=ne({mutationFn:s=>L.createSwimSession(s),onSuccess:(s,t)=>{l.invalidateQueries({queryKey:["swim_catalog"]}),p(!1),f(E()),r({title:t?.id?"Séance natation mise à jour":"Séance natation créée"})}}),H=ne({mutationFn:s=>L.deleteSwimSession(s),onSuccess:()=>{l.invalidateQueries({queryKey:["swim_catalog"]}),S(null),r({title:"Séance supprimée"})},onError:()=>{r({title:"Suppression impossible",description:"Cette séance est utilisée dans une assignation.",variant:"destructive"})}}),J=()=>{f(s=>({...s,blocks:[...s.blocks,{title:"Nouveau bloc",repetitions:1,description:"",modalities:"",equipment:[],exercises:[{repetitions:4,distance:50,rest:null,stroke:"crawl",strokeType:"nc",intensity:"V2",modalities:"",equipment:[]}]}]}))},G=(s,t,n)=>{const m=[...c.blocks];m[s]={...m[s],[t]:n},f({...c,blocks:m})},F=s=>{const t=c.blocks.filter((n,m)=>m!==s);f({...c,blocks:t})},B=(s,t)=>{const n=t==="up"?s-1:s+1;if(n<0||n>=c.blocks.length)return;const m=[...c.blocks],[x]=m.splice(s,1);m.splice(n,0,x),f({...c,blocks:m})},Y=s=>{const t=[...c.blocks];t[s].exercises.push({repetitions:4,distance:50,rest:null,stroke:"crawl",strokeType:"nc",intensity:"V2",modalities:"",equipment:[]}),f({...c,blocks:t})},N=(s,t,n,m)=>{const x=[...c.blocks],y=[...x[s].exercises];y[t]={...y[t],[n]:m},x[s]={...x[s],exercises:y},f({...c,blocks:x})},Fe=(s,t)=>{const n=[...c.blocks];n[s].exercises=n[s].exercises.filter((m,x)=>x!==t),f({...c,blocks:n})},Ue=[{value:"palmes",label:"Palmes"},{value:"tuba",label:"Tuba"},{value:"plaquettes",label:"Plaquettes"},{value:"pull",label:"Pull"},{value:"elastique",label:"Élastique"}],Z=[{value:"pap",label:"Papillon"},{value:"dos",label:"Dos"},{value:"brasse",label:"Brasse"},{value:"crawl",label:"Crawl"},{value:"4n",label:"4 nages"},{value:"spe",label:"Spé"}],I=[{value:"nc",label:"NC"},{value:"educ",label:"Educ"},{value:"jambes",label:"Jambes"}];Z.reduce((s,t)=>(s[t.value]=t.label,s),{});const We=I.reduce((s,t)=>(s[t.value]=t.label,s),{});c.id;const Ke=b.useMemo(()=>Te(W(c.blocks)),[c.blocks]),Qe={nc:"bg-sky-100 text-sky-900 ring-sky-200",educ:"bg-violet-100 text-violet-900 ring-violet-200",jambes:"bg-teal-100 text-teal-900 ring-teal-200"},ee={V0:"text-intensity-1",V1:"text-intensity-2",V2:"text-intensity-3",V3:"text-intensity-4",Max:"text-intensity-5"},se={V0:"ring-intensity-1/30",V1:"ring-intensity-2/30",V2:"ring-intensity-3/30",V3:"ring-intensity-4/30",Max:"ring-intensity-5/30"};return o?e.jsxs("div",{className:"animate-in slide-in-from-bottom-4 motion-reduce:animate-none",children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-border px-4 py-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{type:"button",onClick:()=>{p(!1),f(E())},className:"inline-flex h-9 w-9 items-center justify-center rounded-full hover:bg-muted","aria-label":"Retour",children:e.jsx(rs,{className:"h-4 w-4"})}),e.jsx("div",{className:"text-base font-semibold",children:"Édition"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:()=>h({id:c.id??Date.now(),name:c.name,description:c.description,created_by:a??null,items:W(c.blocks)}),className:"inline-flex h-9 w-9 items-center justify-center rounded-full hover:bg-muted","aria-label":"Aperçu nageur",title:"Aperçu nageur",children:e.jsx(Ne,{className:"h-4 w-4"})}),e.jsxs("button",{type:"button",onClick:()=>{if(!c.name.trim()){r({title:"Titre requis",description:"Ajoutez un nom de séance avant d'enregistrer.",variant:"destructive"});return}Re.mutate({id:c.id??void 0,name:c.name,description:c.description,estimated_duration:c.estimatedDuration||null,items:W(c.blocks),created_by:a})},className:"inline-flex items-center gap-2 rounded-full bg-primary px-3 py-2 text-xs font-semibold text-primary-foreground",children:[e.jsx(as,{className:"h-4 w-4"})," Sauver"]})]})]}),e.jsxs("div",{className:"space-y-4 p-4",children:[e.jsx(A,{className:"rounded-2xl border-border",children:e.jsxs("div",{className:"space-y-3 p-4",children:[e.jsx("div",{className:"text-sm font-semibold",children:"Infos séance"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"col-span-2",children:[e.jsx("div",{className:"text-xs font-semibold text-muted-foreground",children:"Nom"}),e.jsx("div",{className:"mt-1",children:e.jsx(C,{value:c.name,onChange:s=>f({...c,name:s.target.value}),placeholder:"Nom de la séance",className:"rounded-2xl"})})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-semibold text-muted-foreground",children:"Durée estimée (min)"}),e.jsx("div",{className:"mt-1",children:e.jsx(C,{type:"number",min:0,value:c.estimatedDuration||"",onChange:s=>f({...c,estimatedDuration:s.target.value===""?0:Number(s.target.value)}),placeholder:"55",className:"rounded-2xl"})})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-semibold text-muted-foreground",children:"Distance totale"}),e.jsxs("div",{className:"mt-1 rounded-2xl border border-border bg-muted px-3 py-2 text-sm font-semibold",children:[Ke,"m"]})]})]})]})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-sm font-semibold",children:"Vue coach"}),e.jsxs("div",{className:"inline-flex rounded-full border border-border bg-card p-1 text-xs font-semibold",children:[e.jsx("button",{type:"button",onClick:()=>T("compact"),className:j("rounded-full px-3 py-1",z==="compact"?"bg-primary text-primary-foreground":"text-muted-foreground"),children:"Condensé"}),e.jsx("button",{type:"button",onClick:()=>T("detailed"),className:j("rounded-full px-3 py-1",z==="detailed"?"bg-primary text-primary-foreground":"text-muted-foreground"),children:"Détail"})]})]}),z==="compact"?e.jsx(A,{className:"rounded-2xl border-border",children:e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold",children:"Plan (ultra compact)"}),e.jsx("div",{className:"mt-1 text-xs text-muted-foreground",children:"Manipule les blocs vite. Passe en “Détail” pour éditer."})]}),e.jsxs(w,{variant:"secondary",size:"sm",onClick:J,className:"h-9 rounded-full px-3 text-xs",children:[e.jsx(D,{className:"h-4 w-4"})," Bloc"]})]}),e.jsxs("div",{className:"mt-3 space-y-2",children:[c.blocks.map((s,t)=>e.jsx("div",{className:"rounded-2xl border border-border bg-card px-3 py-2",children:e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-primary px-2 py-0.5 text-[11px] font-semibold text-primary-foreground",children:[e.jsx(es,{className:"inline h-3 w-3"})," ",s.repetitions??1,"x"]}),e.jsx("div",{className:"truncate text-xs font-semibold",children:s.title?s.title:`Bloc ${t+1}`}),e.jsxs("div",{className:"text-[11px] text-muted-foreground",children:["· ",s.exercises.length," ex"]})]}),e.jsxs("div",{className:"mt-1 flex flex-wrap gap-1",children:[s.exercises.slice(0,4).map((n,m)=>{const x=q(n.intensity),y=We[n.strokeType]??n.strokeType;return e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-muted px-2 py-0.5 text-[11px] font-semibold text-muted-foreground",title:n.modalities?Ns(n.modalities):"",children:[n.repetitions&&n.distance?`${n.repetitions}x`:"",n.distance?`${n.distance}m`:"—",e.jsx("span",{className:j("ml-1 inline-flex items-center rounded-full px-2 py-0.5 ring-1",Qe[n.strokeType]??"bg-muted text-muted-foreground ring-border"),children:y}),e.jsxs("span",{className:j("ml-1 inline-flex items-center gap-1 rounded-full bg-card px-2 py-0.5 ring-1",se[x],ee[x]),children:[e.jsx("span",{className:j("h-2 w-2 rounded-full",ye[x]??"bg-muted")}),De(x)]})]},`${t}-${m}`)}),s.exercises.length>4?e.jsxs("span",{className:"text-[11px] text-muted-foreground",children:["+",s.exercises.length-4]}):null]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{type:"button",onClick:()=>B(t,"up"),className:"inline-flex h-9 w-9 items-center justify-center rounded-full hover:bg-muted disabled:opacity-40","aria-label":"Monter",title:"Monter",disabled:t===0,children:e.jsx(Ce,{className:"h-4 w-4"})}),e.jsx("button",{type:"button",onClick:()=>B(t,"down"),className:"inline-flex h-9 w-9 items-center justify-center rounded-full hover:bg-muted disabled:opacity-40","aria-label":"Descendre",title:"Descendre",disabled:t===c.blocks.length-1,children:e.jsx(Se,{className:"h-4 w-4"})}),e.jsx("button",{type:"button",onClick:()=>F(t),className:"inline-flex h-9 w-9 items-center justify-center rounded-full text-destructive hover:bg-destructive/10","aria-label":"Supprimer bloc",title:"Supprimer bloc",children:e.jsx(M,{className:"h-4 w-4"})})]})]})},t)),c.blocks.length?null:e.jsx("div",{className:"rounded-2xl border border-dashed border-border bg-muted px-3 py-6 text-center text-sm text-muted-foreground",children:"Aucun bloc. Ajoute un bloc pour commencer."})]})]})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-sm font-semibold",children:"Édition détaillée"}),e.jsxs(w,{variant:"secondary",size:"sm",onClick:J,className:"h-9 rounded-full px-3 text-xs",children:[e.jsx(D,{className:"h-4 w-4"})," Ajouter bloc"]})]}),e.jsx("div",{className:"space-y-4",children:c.blocks.map((s,t)=>e.jsx(A,{className:"rounded-2xl border-border",children:e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("span",{className:"mt-1 inline-flex h-9 w-9 items-center justify-center rounded-2xl bg-muted text-muted-foreground",children:e.jsx(ls,{className:"h-4 w-4"})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-xs font-semibold text-muted-foreground",children:"Titre bloc"}),e.jsx(C,{value:s.title,onChange:n=>G(t,"title",n.target.value),placeholder:`Bloc ${t+1}`,className:"rounded-2xl"})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{type:"button",onClick:()=>B(t,"up"),className:"inline-flex h-9 w-9 items-center justify-center rounded-full hover:bg-muted disabled:opacity-40","aria-label":"Monter",title:"Monter",disabled:t===0,children:e.jsx(Ce,{className:"h-4 w-4"})}),e.jsx("button",{type:"button",onClick:()=>B(t,"down"),className:"inline-flex h-9 w-9 items-center justify-center rounded-full hover:bg-muted disabled:opacity-40","aria-label":"Descendre",title:"Descendre",disabled:t===c.blocks.length-1,children:e.jsx(Se,{className:"h-4 w-4"})}),e.jsx("button",{type:"button",onClick:()=>F(t),className:"inline-flex h-9 w-9 items-center justify-center rounded-full text-destructive hover:bg-destructive/10","aria-label":"Supprimer bloc",title:"Supprimer bloc",children:e.jsx(M,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"mt-3 grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-semibold text-muted-foreground",children:"Répétitions du bloc"}),e.jsx("div",{className:"mt-1",children:e.jsx(C,{type:"number",min:1,value:s.repetitions??"",onChange:n=>G(t,"repetitions",n.target.value===""?null:Number(n.target.value)),placeholder:"1",className:"rounded-2xl"})})]}),e.jsx("div",{className:"flex items-end justify-end",children:e.jsxs(w,{variant:"secondary",size:"sm",onClick:()=>Y(t),className:"h-9 rounded-full px-3 text-xs",children:[e.jsx(D,{className:"h-4 w-4"})," Exercice"]})})]}),e.jsx("div",{className:"mt-4 space-y-3",children:s.exercises.map((n,m)=>{const x=q(n.intensity),y=n.modalities??"";return e.jsx("div",{className:"rounded-2xl border border-border bg-card p-3",children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"grid flex-1 grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-[11px] font-semibold text-muted-foreground",children:"Répétitions"}),e.jsx("div",{className:"mt-1",children:e.jsx(C,{type:"number",min:1,value:n.repetitions??"",onChange:d=>N(t,m,"repetitions",d.target.value===""?null:Number(d.target.value)),className:"rounded-2xl"})})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-[11px] font-semibold text-muted-foreground",children:"Distance (m)"}),e.jsx("div",{className:"mt-1",children:e.jsx(C,{type:"number",min:0,value:n.distance??"",onChange:d=>N(t,m,"distance",d.target.value===""?null:Number(d.target.value)),className:"rounded-2xl"})})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-[11px] font-semibold text-muted-foreground",children:"Nage"}),e.jsx("div",{className:"mt-1",children:e.jsxs(he,{value:n.stroke,onValueChange:d=>N(t,m,"stroke",d),children:[e.jsx(fe,{className:"rounded-2xl",children:e.jsx(be,{})}),e.jsx(je,{children:Z.map(d=>e.jsx(ge,{value:d.value,children:d.label},d.value))})]})})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-[11px] font-semibold text-muted-foreground",children:"Type"}),e.jsx("div",{className:"mt-1",children:e.jsxs(he,{value:n.strokeType,onValueChange:d=>N(t,m,"strokeType",d),children:[e.jsx(fe,{className:"rounded-2xl",children:e.jsx(be,{})}),e.jsx(je,{children:I.map(d=>e.jsx(ge,{value:d.value,children:d.label},d.value))})]})})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-[11px] font-semibold text-muted-foreground",children:"Intensité (clic sur points)"}),e.jsxs("span",{className:j("inline-flex items-center gap-2 rounded-full bg-card px-2.5 py-1 text-xs font-semibold ring-1",se[x],ee[x]),children:[e.jsx("span",{className:j("h-2 w-2 rounded-full",ye[x]??"bg-muted")}),De(x)]})]}),e.jsx("div",{className:"mt-2 flex items-center justify-between gap-2",children:e.jsx(js,{value:n.intensity,onChange:d=>N(t,m,"intensity",d)})})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("div",{className:"text-[11px] font-semibold text-muted-foreground",children:"Équipements"}),e.jsx("div",{className:"mt-2 flex flex-wrap gap-2",children:Ue.map(d=>{const U=n.equipment.includes(d.value),te=ss(d.value);return e.jsxs("button",{type:"button",onClick:()=>{const Xe=U?n.equipment.filter(He=>He!==d.value):[...n.equipment,d.value];N(t,m,"equipment",Xe)},className:j("inline-flex items-center gap-2 rounded-full border px-3 py-2 text-xs font-semibold",U?"border-primary bg-primary text-primary-foreground":"border-border bg-card text-muted-foreground hover:bg-muted"),children:[e.jsx("span",{className:j("inline-flex h-7 w-7 items-center justify-center rounded-full",U?"bg-white/10":"bg-muted"),children:te?e.jsx("img",{src:te,alt:"",className:"h-4 w-4","aria-hidden":"true",loading:"lazy"}):null}),d.label]},d.value)})})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("div",{className:"text-[11px] font-semibold text-muted-foreground",children:"Modalités"}),e.jsx("div",{className:"mt-1",children:e.jsx(Ie,{value:y,onChange:d=>N(t,m,"modalities",d.target.value),placeholder:"Une modalité par ligne",rows:3,className:"rounded-2xl"})})]})]}),e.jsx("button",{type:"button",onClick:()=>Fe(t,m),className:"inline-flex h-9 w-9 items-center justify-center rounded-full text-destructive hover:bg-destructive/10","aria-label":"Supprimer exercice",title:"Supprimer exercice",children:e.jsx(M,{className:"h-4 w-4"})})]})},m)})}),e.jsxs("div",{className:"mt-4 flex items-center justify-between",children:[e.jsxs(w,{variant:"secondary",size:"sm",onClick:()=>Y(t),className:"h-9 rounded-full px-3 text-xs",children:[e.jsx(D,{className:"h-4 w-4"})," Ajouter exercice"]}),e.jsxs(w,{variant:"destructive",size:"sm",onClick:()=>F(t),className:"h-9 rounded-full px-3 text-xs",children:[e.jsx(M,{className:"h-4 w-4"})," Supprimer bloc"]})]})]})},t))})]}),e.jsx("div",{className:"h-8"})]}),e.jsx(re,{open:!!u,onOpenChange:s=>{s||h(null)},children:e.jsx(ae,{className:"max-w-4xl",children:e.jsx(ve,{title:u?.name??"",description:u?.description??void 0,items:u?.items})})})]}):Be||$e?e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-border px-4 py-3",children:[e.jsxs("div",{children:[e.jsx(g,{className:"h-5 w-16 mb-1"}),e.jsx(g,{className:"h-3 w-20"})]}),e.jsx(g,{className:"h-9 w-24 rounded-full"})]}),e.jsxs("div",{className:"p-4",children:[e.jsx(g,{className:"h-10 w-full rounded-2xl mb-4"}),e.jsx("div",{className:"space-y-3",children:Array.from({length:4}).map((s,t)=>e.jsx(A,{className:"rounded-2xl border-border",children:e.jsx(Ze,{children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(g,{className:"h-5 w-3/4 mb-2"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(g,{className:"h-4 w-16"}),e.jsx(g,{className:"h-4 w-16"}),e.jsx(g,{className:"h-4 w-12"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(g,{className:"h-9 w-9 rounded-full"}),e.jsx(g,{className:"h-9 w-9 rounded-full"}),e.jsx(g,{className:"h-9 w-9 rounded-full"}),e.jsx(g,{className:"h-9 w-9 rounded-full"})]})]})})},`skeleton-${t}`))})]})]}):R?e.jsxs("div",{className:"flex flex-col items-center justify-center p-8 text-center",children:[e.jsx(we,{className:"h-12 w-12 text-destructive mb-4"}),e.jsx("h3",{className:"font-semibold",children:"Impossible de charger les données"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:R instanceof Error?R.message:"Une erreur s'est produite"}),e.jsx(w,{onClick:()=>Le(),className:"mt-4",children:"Réessayer"})]}):e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-border px-4 py-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-base font-semibold",children:"Coach"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Création"})]}),e.jsxs("button",{type:"button",onClick:()=>{f(E()),T("compact"),p(!0)},className:"inline-flex items-center gap-2 rounded-full bg-primary px-3 py-2 text-xs font-semibold text-primary-foreground",children:[e.jsx(D,{className:"h-4 w-4"})," Nouvelle"]})]}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 rounded-2xl border border-border bg-card px-3 py-2",children:[e.jsx(os,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("input",{className:"w-full bg-transparent text-sm outline-none placeholder:text-muted-foreground",placeholder:"Rechercher une séance",value:v,onChange:s=>Ee(s.target.value)})]}),ze&&e.jsxs("div",{className:"mt-4 flex flex-col items-center rounded-lg border border-destructive/20 bg-destructive/10 p-4",children:[e.jsx(we,{className:"h-8 w-8 text-destructive mb-2"}),e.jsx("p",{className:"text-sm text-destructive font-semibold",children:"Impossible de charger les assignations"}),e.jsx("p",{className:"text-xs text-destructive/80 mt-1",children:X instanceof Error?X.message:"Une erreur s'est produite"}),e.jsx(w,{variant:"outline",size:"sm",onClick:()=>Oe(),className:"mt-2",children:"Réessayer"})]}),e.jsx("div",{className:"mt-4 space-y-3",children:Pe.map(s=>{const{totalDistance:t,totalDuration:n,blockCount:m}=Ss(s),x=Cs(s.id,Q??null),y=!x||H.isPending;return e.jsx(A,{className:"rounded-2xl border-border",children:e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-base font-semibold tracking-tight",children:s.name}),e.jsxs("div",{className:"mt-1 flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx(ts,{className:"h-3.5 w-3.5"}),t,"m"]}),e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx(cs,{className:"h-3.5 w-3.5"}),"~",n??"—"," min"]}),e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx(is,{className:"h-3.5 w-3.5"}),m]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:()=>h(s),className:"inline-flex h-9 w-9 items-center justify-center rounded-full hover:bg-muted","aria-label":"Aperçu nageur",title:"Aperçu nageur",children:e.jsx(Ne,{className:"h-4 w-4"})}),e.jsx("button",{type:"button",onClick:()=>{f({id:s.id??null,name:s.name??Ve(new Date),description:s.description??"",estimatedDuration:Number(s.estimated_duration??0),blocks:vs(s.items??[])}),T("compact"),p(!0)},className:"inline-flex h-9 w-9 items-center justify-center rounded-full hover:bg-muted","aria-label":"Modifier",title:"Modifier",children:e.jsx(hs,{className:"h-4 w-4"})}),e.jsx("button",{type:"button",onClick:()=>V(s),className:"inline-flex h-9 w-9 items-center justify-center rounded-full hover:bg-muted","aria-label":"Archiver",title:"Archiver",children:e.jsx(ms,{className:"h-4 w-4"})}),e.jsx("button",{type:"button",onClick:()=>{y||S(s)},className:j("inline-flex h-9 w-9 items-center justify-center rounded-full hover:bg-muted",y&&"cursor-not-allowed text-muted-foreground"),"aria-label":"Supprimer",title:Q===null?"Suppression désactivée":x?"Supprimer":"Séance déjà assignée",children:e.jsx(M,{className:"h-4 w-4"})})]})]})})},s.id)})}),e.jsx("div",{className:"h-8"})]}),e.jsx(re,{open:!!u,onOpenChange:s=>{s||h(null)},children:e.jsx(ae,{className:"max-w-4xl",children:e.jsx(ve,{title:u?.name??"",description:u?.description??void 0,items:u?.items})})}),e.jsx(le,{open:!!_,onOpenChange:s=>{s||V(null)},children:e.jsxs(oe,{children:[e.jsxs(ce,{children:[e.jsx(de,{children:"Archiver la séance ?"}),e.jsx(me,{children:"La séance sera masquée du catalogue (sans suppression)."})]}),e.jsxs(ue,{children:[e.jsx(xe,{children:"Annuler"}),e.jsx(pe,{onClick:()=>{_&&(K(s=>new Set([...Array.from(s),_.id])),V(null),r({title:"Séance archivée"}))},children:"Archiver"})]})]})}),e.jsx(le,{open:!!k,onOpenChange:s=>{s||S(null)},children:e.jsxs(oe,{children:[e.jsxs(ce,{children:[e.jsx(de,{children:"Supprimer la séance ?"}),e.jsx(me,{children:"Cette action est définitive. La séance sera supprimée du catalogue."})]}),e.jsxs(ue,{children:[e.jsx(xe,{children:"Annuler"}),e.jsx(pe,{onClick:()=>{k&&H.mutate(k.id)},children:"Supprimer"})]})]})})]})}export{Cs as canDeleteSwimCatalog,Gs as default};
