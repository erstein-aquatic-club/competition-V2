import{r as g,u as k,j as e}from"./vendor-query-DyA9aSKS.js";import{a as w}from"./api-bXFJWRB7.js";import{B as _}from"./badge-D4Rs7Ty5.js";import{B as A}from"./index-CEHY8p8P.js";import{C as S}from"./Coach-DW7BcPvW.js";import"./vendor-react-BzrpNAyj.js";import"./swim-xXx_YbJk.js";import"./vendor-charts-BrQ8X25f.js";import"./vendor-supabase-DFPLkPj_.js";import"./vendor-motion-lao-Njgm.js";import"./arrow-left-Cp7OJVYz.js";import"./search-DOfX7aOI.js";import"./trophy-CDuSfRDq.js";import"./bell-ring-DWicaLcn.js";import"./chevron-right-D8BEssX8.js";import"./zap-186aYcj7.js";import"./clock-Tf1tm2Ml.js";function F(r){if(r.length===0)return null;const l=r[0],d=l.effort,i=l.fatigue,a=l.performance,u=l.engagement,o=[];return d!=null&&o.push((11-d)/2),i!=null&&o.push((11-i)/2),a!=null&&o.push(a/2),u!=null&&o.push(u/2),o.length===0?null:Math.round(o.reduce((b,m)=>b+m,0)/o.length*10)/10}function $(r){return r==null?{label:"—",className:"bg-muted text-muted-foreground"}:r>=3.5?{label:`${r.toFixed(1)}`,className:"bg-emerald-100 text-emerald-800 dark:bg-emerald-900/30 dark:text-emerald-400"}:r>=2.5?{label:`${r.toFixed(1)}`,className:"bg-amber-100 text-amber-800 dark:bg-amber-900/30 dark:text-amber-400"}:{label:`${r.toFixed(1)}`,className:"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400"}}function M({score:r}){if(r==null)return e.jsx("span",{className:"text-[11px] text-muted-foreground",children:"—"});const l=Math.round(r),d=r>=3.5,i=r>=2.5,a=d?"bg-emerald-500":i?"bg-amber-500":"bg-red-500";return e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"flex gap-0.5",children:Array.from({length:5}).map((u,o)=>e.jsx("div",{className:`h-2 w-2 rounded-full transition-colors ${o<l?a:"bg-muted"}`},o))}),e.jsx("span",{className:`text-[10px] font-bold tabular-nums ${d?"text-emerald-600 dark:text-emerald-400":i?"text-amber-600 dark:text-amber-400":"text-red-600 dark:text-red-400"}`,children:r.toFixed(1)})]})}function B({value:r,max:l}){const i=l>0?r/l:0,a=Math.ceil(i*5),u=[35,55,70,85,100],o=i>=.7?"bg-emerald-500 dark:bg-emerald-400":i>=.4?"bg-blue-500 dark:bg-blue-400":"bg-amber-500 dark:bg-amber-400";return e.jsx("div",{className:"flex items-end gap-0.5",style:{height:"18px"},children:Array.from({length:5}).map((b,m)=>e.jsx("div",{className:`w-1.5 rounded-sm transition-all ${m<a?o:"bg-muted"}`,style:{height:`${u[m]}%`}},m))})}function T({dateStr:r}){if(!r)return e.jsx("span",{className:"text-[10px] text-muted-foreground/60",children:"Aucune séance"});const l=new Date(r),d=Math.floor((Date.now()-l.getTime())/864e5),i=d===0?"Aujourd'hui":d===1?"Hier":d<7?`Il y a ${d}j`:l.toLocaleDateString("fr-FR",{day:"numeric",month:"short"}),a=d>=14;return e.jsx("span",{className:`text-[10px] ${a?"text-amber-600 dark:text-amber-400 font-semibold":"text-muted-foreground"}`,children:i})}function X({athletes:r,athletesLoading:l,onBack:d,onOpenAthlete:i}){const[a,u]=g.useState(null),[o,b]=g.useState("name"),[m,j]=g.useState(30),{data:y=[]}=k({queryKey:["recent-sessions-all",30],queryFn:()=>w.getRecentSessionsAllAthletes(30),enabled:r.length>0,staleTime:300*1e3}),{data:v}=k({queryKey:["objectives-counts-by-user"],queryFn:()=>w.getObjectivesCountsByUser(),enabled:r.length>0,staleTime:300*1e3}),N=g.useMemo(()=>{const t=new Map;return r.forEach(s=>{s.group_id&&s.group_label&&t.set(s.group_id,s.group_label)}),Array.from(t.entries()).map(([s,n])=>({id:s,name:n})).sort((s,n)=>s.name.localeCompare(n.name,"fr"))},[r]),x=g.useMemo(()=>{const t=new Map,s=new Map;for(const n of y){if(n.athlete_id==null)continue;const c=s.get(n.athlete_id)??[];c.push(n),s.set(n.athlete_id,c)}for(const n of r){if(n.id==null)continue;const c=s.get(n.id)??[],p=F(c),h=c.length>0?c[0].session_date:null;t.set(n.id,{forme:p,lastSessionDate:h,sessionsCount30d:c.length,assiduity:null,objectivesTotal:v?.get(n.id)??0,objectivesAchieved:0})}return t},[r,y,v]),C=g.useMemo(()=>{let t=0;for(const[,s]of x)s.sessionsCount30d>t&&(t=s.sessionsCount30d);return Math.max(t,1)},[x]),f=g.useMemo(()=>{let t=[...r];switch(a!=null&&(t=t.filter(s=>s.group_id===a)),o){case"forme":t.sort((s,n)=>{const c=s.id!=null?x.get(s.id)?.forme??99:99,p=n.id!=null?x.get(n.id)?.forme??99:99;return c-p});break;case"assiduity":t.sort((s,n)=>{const c=s.id!=null?x.get(s.id)?.sessionsCount30d??99:99,p=n.id!=null?x.get(n.id)?.sessionsCount30d??99:99;return c-p});break;default:t.sort((s,n)=>s.display_name.localeCompare(n.display_name,"fr"))}return t},[r,a,o,x]);return g.useEffect(()=>{j(30)},[a,o]),e.jsxs("div",{className:"space-y-4 pb-4",children:[e.jsx(S,{title:"Nageurs",description:l?"Chargement…":`${r.length} nageur${r.length!==1?"s":""}`,onBack:d}),N.length>1&&e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{type:"button",onClick:()=>u(null),className:`rounded-full px-3 py-2 text-xs font-semibold border transition-colors ${a==null?"bg-foreground text-background border-foreground":"bg-card text-foreground border-border hover:bg-muted"}`,children:"Tous"}),N.map(t=>e.jsx("button",{type:"button",onClick:()=>u(a===t.id?null:t.id),className:`rounded-full px-3 py-2 text-xs font-semibold border transition-colors ${a===t.id?"bg-foreground text-background border-foreground":"bg-card text-foreground border-border hover:bg-muted"}`,children:t.name},t.id))]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-[10px] font-bold uppercase tracking-[0.18em] text-muted-foreground",children:"Trier :"}),[{key:"name",label:"Nom"},{key:"forme",label:"Forme"},{key:"assiduity",label:"Activité"}].map(t=>e.jsx("button",{type:"button",onClick:()=>b(t.key),className:`rounded-full px-3 py-1.5 text-xs font-semibold border transition-colors ${o===t.key?"bg-primary/10 text-primary border-primary/30":"bg-card text-muted-foreground border-border hover:bg-muted"}`,children:t.label},t.key))]}),l?e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3",children:[1,2,3,4,5,6].map(t=>e.jsxs("div",{className:"rounded-2xl border bg-card p-4 animate-pulse motion-reduce:animate-none",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-muted"}),e.jsxs("div",{className:"space-y-1.5 flex-1",children:[e.jsx("div",{className:"h-4 w-24 rounded bg-muted"}),e.jsx("div",{className:"h-3 w-16 rounded bg-muted"})]})]}),e.jsxs("div",{className:"mt-4 space-y-2.5",children:[e.jsx("div",{className:"h-2.5 w-full rounded-full bg-muted"}),e.jsx("div",{className:"h-2.5 w-2/3 rounded-full bg-muted"})]})]},t))}):f.length===0?e.jsx("p",{className:"text-sm text-muted-foreground text-center py-8",children:a!=null?"Aucun nageur dans ce groupe.":"Aucun nageur disponible."}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3",children:f.slice(0,m).map(t=>{const s=t.id!=null?x.get(t.id):null;$(s?.forme??null);const n=s?.sessionsCount30d??0,c=n===0,p=s?.forme??null,h=p!==null&&p<2.5;return e.jsxs("button",{type:"button",onClick:()=>i(t),className:["group rounded-2xl border bg-card p-4 text-left transition-all duration-150","hover:shadow-lg hover:border-primary/20 hover:-translate-y-0.5","active:scale-[0.98] active:shadow-sm",h?"border-red-200/60 dark:border-red-900/30":""].join(" "),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[t.avatar_url?e.jsx("img",{src:t.avatar_url,alt:"",className:"h-10 w-10 rounded-full object-cover border border-border flex-shrink-0"}):e.jsx("div",{className:["h-10 w-10 rounded-full flex items-center justify-center text-sm font-bold flex-shrink-0",h?"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400":"bg-primary/10 text-primary"].join(" "),children:t.display_name.charAt(0).toUpperCase()}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-sm font-semibold truncate",children:t.display_name}),t.group_label&&e.jsx(_,{variant:"secondary",className:"text-[10px] px-1.5 py-0 mt-0.5",children:t.group_label})]}),(s?.objectivesTotal??0)>0&&e.jsxs("div",{className:"flex shrink-0 items-center gap-1 rounded-full bg-amber-100 dark:bg-amber-900/30 px-2 py-0.5",children:[e.jsx("span",{className:"text-[10px] font-bold text-amber-700 dark:text-amber-400",children:s.objectivesTotal}),e.jsx("span",{className:"text-[9px] text-amber-600 dark:text-amber-500",children:"obj"})]})]}),e.jsxs("div",{className:"mt-3.5 space-y-2.5",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-[10px] font-semibold uppercase tracking-[0.14em] text-muted-foreground",children:"Forme"}),e.jsx(M,{score:s?.forme??null})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-[10px] font-semibold uppercase tracking-[0.14em] text-muted-foreground",children:"Activité 30j"}),e.jsxs("span",{className:`text-[10px] mt-0.5 ${c?"text-amber-600 dark:text-amber-400 font-semibold":"text-muted-foreground"}`,children:[n," séance",n!==1?"s":""]})]}),e.jsx(B,{value:n,max:C})]}),e.jsxs("div",{className:"flex items-center justify-between border-t border-border/40 pt-2",children:[e.jsx("span",{className:"text-[10px] text-muted-foreground/70",children:"Dernier ressenti"}),e.jsx(T,{dateStr:s?.lastSessionDate??null})]})]})]},t.id??t.display_name)})}),f.length>m&&e.jsxs("div",{className:"flex flex-col items-center gap-2 py-4",children:[e.jsxs("p",{className:"text-xs text-muted-foreground",children:[m," sur ",f.length," nageurs"]}),e.jsx(A,{variant:"outline",size:"sm",onClick:()=>j(t=>t+30),children:"Voir plus"})]})]})]})}export{X as default};
