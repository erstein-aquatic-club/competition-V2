const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/StrengthCatalog-3Fss38S0.js","assets/vendor-query-BiSH4r2z.js","assets/vendor-react-BzrpNAyj.js","assets/api-BiBAAZUV.js","assets/index-B6IymwQz.js","assets/vendor-supabase-6k692oZB.js","assets/index-BKGAFatk.css","assets/swim-BnKcfG80.js","assets/index-BnsoBhS0.js","assets/index-CXOnxKUo.js","assets/select-DoVFPXXc.js","assets/chevron-down-ByZTK6iK.js","assets/check-Df515Vt7.js","assets/chevron-up-BrKkEvH-.js","assets/CalendarGrid-Dd769tiV.js","assets/chevron-left-Ba-CmJ6o.js","assets/chevron-right-X92MA2gY.js","assets/textarea-Dj9D6sAl.js","assets/dialog-Ba_UNaGB.js","assets/index-C6_MY0P-.js","assets/checkbox-Dstdc3jd.js","assets/alert-dialog-DpBYTJLY.js","assets/tabs-CHEAESVy.js","assets/SessionListView-B2cGwJfR.js","assets/play-Vi3weTGc.js","assets/save-CWZ7sksu.js","assets/circle-alert-DqQbiBqw.js","assets/pencil-C4KwYlGa.js","assets/trash-2-BrjcQhyc.js","assets/drawer-knES6Q0q.js","assets/search-Ct3XJNU9.js","assets/plus-b9MhAowr.js","assets/loader-circle-BepMCVAb.js","assets/pen-DM-GY9dW.js","assets/SwimCatalog-CDIYrPr0.js","assets/SwimSessionTimeline-DB_4ieZk.js","assets/swimConsultationUtils-DIgQ2xDI.js","assets/timer-C0AQIUFE.js","assets/eye-Dj-E7i1C.js","assets/clock-_CiYYZcR.js","assets/format-B9mPVj_w.js","assets/share-2-BjCr2npT.js"])))=>i.map(i=>d[i]);
import{c as le,B as k,d as W,C as Me,i as De,k as Ae,l as Te,g as Fe,L as P,I as ie,W as He,D as Ye,R as is,U as Se,m as ls,n as os,T as qe,s as cs,u as Ie,b as ds,P as Ke,o as us,_ as We}from"./index-B6IymwQz.js";import{j as e,r as l,u as B,c as oe,d as R}from"./vendor-query-BiSH4r2z.js";import{a as M}from"./api-BiBAAZUV.js";import{B as H}from"./badge-zdH1tLPS.js";import{T as Ee,a as X}from"./toggle-group-DWBuXKrr.js";import{S as Z,a as ee,b as se,c as te,d as V}from"./select-DoVFPXXc.js";import{a as ms,b as xs,P as ps}from"./CalendarGrid-Dd769tiV.js";import{S as ve,a as ye,b as be,c as Ne,d as Oe}from"./sheet-CsNo5Atc.js";import{T as Je}from"./trash-2-BrjcQhyc.js";import{C as hs}from"./checkbox-Dstdc3jd.js";import{S as gs}from"./separator-BFoMB6xP.js";import{A as ue,a as me,b as xe,c as pe,d as he,e as ge,f as je,g as fe}from"./alert-dialog-DpBYTJLY.js";import{C as js,a as fs,b as vs}from"./collapsible-Czx6L56k.js";import{P as ae}from"./plus-b9MhAowr.js";import{U as ys,a as bs}from"./user-plus-9vgm6dAx.js";import{C as Ns}from"./chevron-down-ByZTK6iK.js";import{T as Xe}from"./textarea-Dj9D6sAl.js";import{S as ws}from"./switch-CPuRscZV.js";import{M as Ss}from"./map-pin-BuwOTZgj.js";import{T as ze}from"./target-DKZru84V.js";import"./vendor-react-BzrpNAyj.js";import"./vendor-supabase-6k692oZB.js";import"./swim-BnKcfG80.js";import"./index-BnsoBhS0.js";import"./index-CXOnxKUo.js";import"./check-Df515Vt7.js";import"./chevron-up-BrKkEvH-.js";import"./chevron-left-Ba-CmJ6o.js";import"./chevron-right-X92MA2gY.js";import"./index-C6_MY0P-.js";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cs=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],we=le("arrow-left",Cs);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _s=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 18h.01",key:"lrp35t"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M16 18h.01",key:"kzsmim"}]],Le=le("calendar-days",_s);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ks=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]],Ms=le("external-link",ks);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ds=[["path",{d:"M2 9.5a5.5 5.5 0 0 1 9.591-3.676.56.56 0 0 0 .818 0A5.49 5.49 0 0 1 22 9.5c0 2.29-1.5 4-3 5.5l-5.492 5.313a2 2 0 0 1-3 .019L5 15c-1.5-1.5-3-3.2-3-5.5",key:"mvr1a0"}],["path",{d:"M3.22 13H9.5l.5-1 2 4.5 2-7 1.5 3.5h5.27",key:"auskq0"}]],As=le("heart-pulse",Ds);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ts=[["path",{d:"m22 7-8.991 5.727a2 2 0 0 1-2.009 0L2 7",key:"132q7q"}],["rect",{x:"2",y:"4",width:"20",height:"16",rx:"2",key:"izxlao"}]],Pe=le("mail",Ts);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fs=[["path",{d:"M18 21a8 8 0 0 0-16 0",key:"3ypg7q"}],["circle",{cx:"10",cy:"8",r:"5",key:"o932ke"}],["path",{d:"M22 20c0-3.37-2-6.5-4-8a5 5 0 0 0-.45-8.3",key:"10s06x"}]],Ze=le("users-round",Fs),ne=({title:s,description:n,onBack:r,actions:a})=>e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs(k,{variant:"ghost",size:"sm",className:"-ml-2",onClick:r,children:[e.jsx(we,{className:"mr-2 h-4 w-4"}),"Retour"]}),e.jsx("h2",{className:"text-2xl font-display font-semibold uppercase italic text-primary",children:s}),n?e.jsx("p",{className:"text-sm text-muted-foreground",children:n}):null]}),a?e.jsx("div",{className:"flex items-center gap-2",children:a}):null]}),qs=({onBack:s,athletes:n,groups:r,athletesLoading:a})=>{const{toast:o}=W(),[g,f]=l.useState(""),[d,x]=l.useState(""),p=l.useMemo(()=>n.filter(t=>t.id&&t.email).map(t=>({value:`user:${t.id}`,label:t.group_label?`${t.display_name} · ${t.group_label}`:t.display_name,email:t.email})),[n]),h=l.useMemo(()=>r.map(t=>({value:`group:${t.id}`,label:t.name,id:t.id})),[r]),c=()=>{if(!d)return[];if(d.startsWith("user:")){const t=p.find(m=>m.value===d);return t?[t.email]:[]}if(d.startsWith("group:")){const t=Number(d.split(":")[1]);return n.filter(m=>m.group_id===t&&m.email).map(m=>m.email)}return[]},j=()=>{const t=c();if(!t.length){o({title:"Aucune adresse email",description:"Aucun nageur avec une adresse email dans cette sélection."});return}const m=new URLSearchParams;m.set("bcc",t.join(",")),g.trim()&&m.set("subject",g.trim()),window.location.href=`mailto:?${m.toString()}`},y=c();return e.jsxs("div",{className:"space-y-6 pb-24",children:[e.jsx(ne,{title:"Contacter par email",description:"Ouvre votre application mail avec les destinataires en CCI.",onBack:s}),e.jsxs(Me,{className:"border-l-4 border-l-primary",children:[e.jsxs(De,{children:[e.jsx(Ae,{children:"Destinataire"}),e.jsx(Te,{children:"Sélectionnez un nageur ou un groupe."})]}),e.jsxs(Fe,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{children:"Destinataire"}),e.jsxs(Z,{value:d,onValueChange:x,children:[e.jsx(ee,{children:e.jsx(se,{placeholder:a?"Chargement...":"Choisir un nageur ou un groupe"})}),e.jsxs(te,{children:[h.length?e.jsxs(e.Fragment,{children:[e.jsx(V,{value:"section-group",disabled:!0,children:"Groupes"}),h.map(t=>e.jsx(V,{value:t.value,children:t.label},t.value))]}):null,p.length?e.jsxs(e.Fragment,{children:[e.jsx(V,{value:"section-athlete",disabled:!0,children:"Nageurs"}),p.map(t=>e.jsx(V,{value:t.value,children:t.label},t.value))]}):null]})]})]}),d&&y.length>0?e.jsxs("p",{className:"text-xs text-muted-foreground",children:[y.length," adresse",y.length>1?"s":""," email",y.length>1?" (envoi en CCI)":""]}):null,d&&y.length===0?e.jsx("p",{className:"text-xs text-destructive",children:"Aucune adresse email disponible pour cette sélection."}):null]})]}),e.jsxs(Me,{children:[e.jsxs(De,{children:[e.jsx(Ae,{children:"Objet"}),e.jsx(Te,{children:"Optionnel — pré-rempli dans votre application mail."})]}),e.jsx(Fe,{children:e.jsx(ie,{value:g,onChange:t=>f(t.target.value),placeholder:"Objet du mail…"})})]}),e.jsx("div",{className:"sticky bottom-0 z-10 -mx-4 border-t bg-background/95 p-4 backdrop-blur sm:static sm:mx-0 sm:border-0 sm:p-0",children:e.jsxs(k,{className:"w-full sm:w-auto",onClick:j,disabled:!d||y.length===0,children:[e.jsx(Pe,{className:"mr-2 h-4 w-4"}),"Ouvrir dans l'app mail",e.jsx(Ms,{className:"ml-2 h-3 w-3"})]})})]})};function Ge(s){return String(s).padStart(2,"0")}function re(s){return`${s.getFullYear()}-${Ge(s.getMonth()+1)}-${Ge(s.getDate())}`}function Ce(s){return new Date(s.getFullYear(),s.getMonth(),1)}function Be(s,n){const r=new Date(s);return r.setDate(r.getDate()+n),r}function zs(s){return(s.getDay()+6)%7}function _e(s){if(!s)return"AM";const n=s.toLowerCase();return n==="evening"||n.includes("soir")||n==="pm"?"PM":"AM"}const Ls=[{key:"swim-morning",label:"Nage — Matin",type:"swim",scheduledSlot:"morning"},{key:"swim-evening",label:"Nage — Soir",type:"swim",scheduledSlot:"evening"},{key:"strength",label:"Musculation",type:"strength",scheduledSlot:null}];function Es({groupId:s,userId:n,enabled:r}){const a=l.useMemo(()=>new Date,[]),[o,g]=l.useState(()=>Ce(new Date)),[f,d]=l.useState(()=>re(new Date)),[x,p]=l.useState(null),[h,c]=l.useState(!1),j=l.useMemo(()=>Ce(o),[o]),y=l.useMemo(()=>{const C=zs(j),D=Be(j,-C),A=[];for(let u=0;u<42;u++)A.push(Be(D,u));return A},[j]),t=l.useMemo(()=>{const C=re(y[0]),D=re(y[y.length-1]);return{from:C,to:D}},[y]),m=!!(s||n),{data:S=[],isLoading:v}=B({queryKey:["coach-calendar-assignments",s,n,t.from,t.to],queryFn:()=>M.getCoachAssignments({groupId:s??null,userId:n??null,from:t.from,to:t.to}),enabled:m}),w=l.useMemo(()=>{const C=new Map;for(const D of S){const A=D.scheduledDate?.slice(0,10);A&&(C.has(A)||C.set(A,[]),C.get(A).push(D))}return C},[S]),E=l.useMemo(()=>{const C={};for(const D of y){const A=re(D),u=w.get(A)??[],L=u.some($=>_e($.scheduledSlot)==="AM"),O=u.some($=>_e($.scheduledSlot)==="PM"),N=(L?1:0)+(O?1:0),K=[{slotKey:"AM",expected:L,completed:L,absent:!1},{slotKey:"PM",expected:O,completed:O,absent:!1}];C[A]={completed:N,total:N,slots:K}}return C},[y,w]),q=l.useMemo(()=>{const[C,D,A]=f.split("-").map(Number);return new Date(C,D-1,A)},[f]),_=l.useMemo(()=>w.get(f)??[],[w,f]),F=l.useMemo(()=>{const C=_;return Ls.map(D=>{const A=C.filter(O=>D.type!==O.type?!1:D.type==="swim"?_e(O.scheduledSlot)===(D.scheduledSlot==="morning"?"AM":"PM"):!0),u=A.find(O=>O.targetType==="user"),L=A.find(O=>O.targetType==="group");return{...D,assignment:u??L??null}})},[_]),T=l.useMemo(()=>{const C={};for(const D of y){const A=re(D),u=w.get(A)??[];C[A]=u.some(L=>L.type==="strength")}return C},[y,w]),b=E[f]??{completed:0,total:0,slots:[{slotKey:"AM",expected:!1,completed:!1,absent:!1},{slotKey:"PM",expected:!1,completed:!1,absent:!1}]},i=l.useCallback(()=>{g(C=>new Date(C.getFullYear(),C.getMonth()-1,1))},[]),I=l.useCallback(()=>{g(C=>new Date(C.getFullYear(),C.getMonth()+1,1))},[]),Q=l.useCallback(()=>{g(Ce(new Date)),d(re(new Date))},[]),Y=l.useCallback(C=>{d(C),c(!0)},[]);return{today:a,monthCursor:o,selectedISO:f,selectedDayIndex:x,drawerOpen:h,gridDates:y,completionByISO:E,selectedDate:q,selectedDayStatus:b,assignmentsForSelectedDay:_,slotsForSelectedDay:F,hasStrengthByISO:T,isLoading:v,hasFilter:m,setSelectedISO:d,setSelectedDayIndex:p,setDrawerOpen:c,prevMonth:i,nextMonth:I,jumpToday:Q,openDay:Y}}function Os(s){const[n,r,a]=s.split("-").map(Number);return new Date(n,r-1,a).toLocaleDateString("fr-FR",{weekday:"long",day:"numeric",month:"long"})}function Ps({onBack:s,athletes:n,groups:r,swimSessions:a,strengthSessions:o}){const[g,f]=l.useState("group"),[d,x]=l.useState(""),[p,h]=l.useState(""),c=g==="group"&&d?Number(d):null,j=g==="user"&&p?Number(p):null,{today:y,monthCursor:t,selectedISO:m,selectedDayIndex:S,drawerOpen:v,gridDates:w,completionByISO:E,selectedDayStatus:q,slotsForSelectedDay:_,hasStrengthByISO:F,hasFilter:T,setSelectedISO:b,setSelectedDayIndex:i,setDrawerOpen:I,prevMonth:Q,nextMonth:Y,jumpToday:C,openDay:D}=Es({groupId:c,userId:j,enabled:!0}),A=oe(),u=R({mutationFn:N=>M.assignments_create(N),onSuccess:()=>{A.invalidateQueries({queryKey:["coach-calendar-assignments"]})}}),L=R({mutationFn:N=>M.assignments_delete(N),onSuccess:()=>{A.invalidateQueries({queryKey:["coach-calendar-assignments"]})}}),O=(N,K)=>{let $=K;if(N.key==="ArrowLeft"&&($=Math.max(0,K-1)),N.key==="ArrowRight"&&($=Math.min(w.length-1,K+1)),N.key==="ArrowUp"&&($=Math.max(0,K-7)),N.key==="ArrowDown"&&($=Math.min(w.length-1,K+7)),$!==K){N.preventDefault(),i($);const U=de=>String(de).padStart(2,"0"),G=w[$],ce=`${G.getFullYear()}-${U(G.getMonth()+1)}-${U(G.getDate())}`;b(ce)}if(N.key==="Enter"||N.key===" "){N.preventDefault();const U=de=>String(de).padStart(2,"0"),G=w[K],ce=`${G.getFullYear()}-${U(G.getMonth()+1)}-${U(G.getDate())}`;D(ce)}};return e.jsxs("div",{className:"space-y-4",children:[e.jsx(ne,{title:"Calendrier",description:"Vue mensuelle des assignations",onBack:s}),e.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center",children:[e.jsxs(Ee,{type:"single",value:g,onValueChange:N=>{(N==="group"||N==="user")&&f(N)},className:"shrink-0",children:[e.jsx(X,{value:"group",className:"text-xs px-3",children:"Groupe"}),e.jsx(X,{value:"user",className:"text-xs px-3",children:"Nageur"})]}),g==="group"?e.jsxs(Z,{value:d,onValueChange:x,children:[e.jsx(ee,{className:"w-full sm:w-56",children:e.jsx(se,{placeholder:"Choisir un groupe"})}),e.jsx(te,{children:r.map(N=>e.jsx(V,{value:String(N.id),children:N.name},String(N.id)))})]}):e.jsxs(Z,{value:p,onValueChange:h,children:[e.jsx(ee,{className:"w-full sm:w-56",children:e.jsx(se,{placeholder:"Choisir un nageur"})}),e.jsx(te,{children:n.filter(N=>N.id!=null).map(N=>e.jsxs(V,{value:String(N.id),children:[N.display_name,N.group_label?` · ${N.group_label}`:""]},String(N.id)))})]})]}),T?e.jsxs("div",{className:"rounded-2xl border bg-card shadow-sm",children:[e.jsx(ms,{monthCursor:t,selectedDayStatus:q,onPrevMonth:Q,onNextMonth:Y,onJumpToday:C}),e.jsx(xs,{monthCursor:t,gridDates:w,completionByISO:E,strengthByISO:F,selectedISO:m,selectedDayIndex:S,today:y,onDayClick:D,onKeyDown:O})]}):e.jsx("div",{className:"py-12 text-center text-sm text-muted-foreground",children:"Sélectionnez un groupe ou un nageur pour afficher le calendrier."}),e.jsx(ve,{open:v,onOpenChange:I,children:e.jsxs(ye,{side:"bottom",className:"max-h-[70vh] overflow-y-auto rounded-t-2xl",children:[e.jsxs(be,{className:"pb-3",children:[e.jsx(Ne,{className:"capitalize text-left",children:Os(m)}),e.jsx(Oe,{className:"sr-only",children:"Gérer les assignations pour cette journée"})]}),e.jsx("div",{className:"space-y-3",children:_.map(N=>{const K=N.assignment?.targetType==="group",$=g==="user";return e.jsx($s,{slot:N,swimSessions:a,strengthSessions:o,isGroupAssignment:K&&$,onAssign:U=>{u.mutate({assignment_type:N.type,session_id:U,scheduled_date:m,scheduled_slot:N.scheduledSlot??void 0,target_group_id:c,target_user_id:j})},onDelete:U=>{L.mutate(U)},onReplace:(U,G)=>{K&&$?u.mutate({assignment_type:N.type,session_id:G,scheduled_date:m,scheduled_slot:N.scheduledSlot??void 0,target_user_id:j}):L.mutate(U,{onSuccess:()=>{u.mutate({assignment_type:N.type,session_id:G,scheduled_date:m,scheduled_slot:N.scheduledSlot??void 0,target_group_id:c,target_user_id:j})}})},isPending:u.isPending||L.isPending},N.key)})})]})})]})}function $s({slot:s,swimSessions:n,strengthSessions:r,isGroupAssignment:a,onAssign:o,onDelete:g,onReplace:f,isPending:d}){const[x,p]=l.useState(!1),h=s.type==="swim",c=h?(n??[]).map(t=>({id:t.id,label:t.name})):(r??[]).map(t=>({id:t.id,label:t.title})),j=s.assignment!==null,y=t=>{const m=Number(t);m&&(j&&x?(f(s.assignment.id,m),p(!1)):o(m))};return e.jsxs("div",{className:"rounded-xl border p-3 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[h?e.jsx(He,{className:"h-4 w-4 text-blue-500 shrink-0"}):e.jsx(Ye,{className:"h-4 w-4 text-orange-500 shrink-0"}),e.jsx("span",{className:"text-xs font-semibold text-muted-foreground uppercase tracking-wide",children:s.label})]}),j&&!x?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("p",{className:"text-sm font-semibold truncate flex-1",children:[s.assignment.title,a&&e.jsx("span",{className:"ml-1.5 text-[10px] font-medium text-muted-foreground bg-muted px-1.5 py-0.5 rounded-full align-middle",children:"Groupe"})]}),e.jsx(k,{type:"button",size:"icon",variant:"ghost",className:"h-7 w-7 shrink-0",disabled:d,onClick:()=>p(!0),title:a?"Personnaliser":"Changer",children:e.jsx(is,{className:"h-3.5 w-3.5"})}),!a&&e.jsx(k,{type:"button",size:"icon",variant:"ghost",className:"h-7 w-7 shrink-0 text-destructive hover:text-destructive",disabled:d,onClick:()=>g(s.assignment.id),title:"Supprimer",children:e.jsx(Je,{className:"h-3.5 w-3.5"})})]}):e.jsxs(Z,{value:"",onValueChange:y,disabled:d||c.length===0,children:[e.jsx(ee,{className:"h-9 text-xs",children:e.jsx(se,{placeholder:x?a?"Personnaliser pour ce nageur":"Choisir le remplacement":"Choisir une séance"})}),e.jsx(te,{children:c.map(t=>e.jsx(V,{value:String(t.id),children:t.label},t.id))})]}),x?e.jsx("button",{type:"button",className:"text-xs text-muted-foreground hover:text-foreground",onClick:()=>p(!1),children:"Annuler"}):null]})}const es=({athletes:s,selected:n,onToggle:r,filterToUserIds:a})=>{const[o,g]=l.useState(""),f=l.useMemo(()=>{let x=s.filter(p=>p.id!=null);if(a&&(x=x.filter(p=>a.has(p.id))),o.trim()){const p=o.toLowerCase();x=x.filter(h=>h.display_name.toLowerCase().includes(p))}return x},[s,a,o]),d=l.useMemo(()=>{const x=new Map;for(const p of f){const h=p.group_label||"Sans groupe";x.has(h)||x.set(h,[]),x.get(h).push(p)}return[...x.entries()].sort(([p],[h])=>p.localeCompare(h,"fr"))},[f]);return e.jsxs("div",{className:"space-y-3",children:[e.jsx(ie,{placeholder:"Rechercher un nageur...",value:o,onChange:x=>g(x.target.value)}),e.jsxs("div",{className:"max-h-[50vh] overflow-y-auto space-y-3",children:[d.map(([x,p])=>e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-semibold uppercase tracking-wider text-muted-foreground mb-1.5",children:x}),e.jsx("div",{className:"space-y-1",children:p.map(h=>e.jsxs("label",{className:"flex items-center gap-2.5 rounded-lg border px-3 py-2 cursor-pointer hover:bg-muted/50 transition-colors",children:[e.jsx(hs,{checked:n.has(h.id),onCheckedChange:()=>r(h.id)}),e.jsx("span",{className:"text-sm",children:h.display_name})]},h.id))})]},x)),d.length===0&&e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"Aucun nageur trouvé."})]}),n.size>0&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:[n.size," nageur",n.size>1?"s":""," ","sélectionné",n.size>1?"s":""]})]})},ss=({open:s,onOpenChange:n,athletes:r,parentGroupId:a,parentMembers:o,onCreated:g})=>{const{toast:f}=W(),[d,x]=l.useState(""),[p,h]=l.useState(new Set),c=t=>{h(m=>{const S=new Set(m);return S.has(t)?S.delete(t):S.add(t),S})},j=R({mutationFn:()=>M.createTemporaryGroup({name:d.trim(),member_user_ids:[...p],parent_group_id:a??void 0}),onSuccess:()=>{f({title:"Groupe créé",description:`Le groupe "${d.trim()}" a été créé avec ${p.size} nageur${p.size>1?"s":""}.`}),x(""),h(new Set),n(!1),g()},onError:t=>{f({title:"Erreur",description:t.message,variant:"destructive"})}}),y=()=>{if(!d.trim()){f({title:"Nom requis",description:"Veuillez saisir un nom pour le groupe.",variant:"destructive"});return}j.mutate()};return e.jsx(ve,{open:s,onOpenChange:n,children:e.jsxs(ye,{side:"right",className:"w-full sm:max-w-md overflow-y-auto",children:[e.jsxs(be,{children:[e.jsx(Ne,{children:a?"Créer un sous-groupe":"Créer un groupe"}),e.jsx(Oe,{children:a?"Sélectionnez des nageurs du groupe parent pour ce sous-groupe.":"Créez un groupe temporaire (stage, compétition) avec des nageurs de différents groupes."})]}),e.jsxs("div",{className:"mt-6 space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{htmlFor:"group-name",children:"Nom du groupe"}),e.jsx(ie,{id:"group-name",placeholder:"Ex : Stage Pâques 2026",value:d,onChange:t=>x(t.target.value)})]}),e.jsx(gs,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{children:"Nageurs"}),e.jsx(es,{athletes:r,selected:p,onToggle:c,filterToUserIds:o??null})]}),e.jsx(k,{className:"w-full",onClick:y,disabled:j.isPending||!d.trim(),children:j.isPending?"Création...":"Créer le groupe"})]})]})})},Rs=({open:s,onOpenChange:n,groupId:r,athletes:a,existingMemberIds:o,onAdded:g})=>{const{toast:f}=W(),[d,x]=l.useState(new Set),p=l.useMemo(()=>a.filter(j=>j.id!=null&&!o.has(j.id)),[a,o]),h=j=>{x(y=>{const t=new Set(y);return t.has(j)?t.delete(j):t.add(j),t})},c=R({mutationFn:()=>M.addTemporaryGroupMembers(r,[...d]),onSuccess:()=>{f({title:"Nageurs ajoutés",description:`${d.size} nageur${d.size>1?"s":""} ajouté${d.size>1?"s":""}.`}),x(new Set),n(!1),g()},onError:j=>{f({title:"Erreur",description:j.message,variant:"destructive"})}});return e.jsx(ve,{open:s,onOpenChange:n,children:e.jsxs(ye,{side:"right",className:"w-full sm:max-w-md overflow-y-auto",children:[e.jsxs(be,{children:[e.jsx(Ne,{children:"Ajouter des nageurs"}),e.jsx(Oe,{children:"Sélectionnez les nageurs à ajouter au groupe."})]}),e.jsxs("div",{className:"mt-6 space-y-4",children:[e.jsx(es,{athletes:p,selected:d,onToggle:h}),e.jsx(k,{className:"w-full",onClick:()=>c.mutate(),disabled:c.isPending||d.size===0,children:c.isPending?"Ajout...":`Ajouter ${d.size} nageur${d.size>1?"s":""}`})]})]})})},Is=({groupId:s,athletes:n,onBack:r})=>{const{toast:a}=W(),o=oe(),[g,f]=l.useState(!1),[d,x]=l.useState(!1),[p,h]=l.useState(null),{data:c,isLoading:j}=B({queryKey:["temp-group-detail",s],queryFn:()=>M.getTemporaryGroupDetail(s)}),y=R({mutationFn:v=>M.removeTemporaryGroupMember(s,v),onSuccess:()=>{a({title:"Nageur retiré"}),o.invalidateQueries({queryKey:["temp-group-detail",s]}),o.invalidateQueries({queryKey:["temp-groups"]})},onError:v=>{a({title:"Erreur",description:v.message,variant:"destructive"})}}),t=()=>{o.invalidateQueries({queryKey:["temp-group-detail",s]}),o.invalidateQueries({queryKey:["temp-groups"]})},m=l.useMemo(()=>new Set((c?.members??[]).map(v=>v.user_id)),[c]),S=l.useMemo(()=>new Set((c?.members??[]).map(v=>v.user_id)),[c]);return j?e.jsxs("div",{className:"space-y-4",children:[e.jsxs(k,{variant:"ghost",size:"sm",className:"-ml-2",onClick:r,children:[e.jsx(we,{className:"mr-2 h-4 w-4"}),"Retour aux groupes"]}),e.jsx("div",{className:"space-y-2",children:[1,2,3].map(v=>e.jsx("div",{className:"rounded-xl border p-3 animate-pulse motion-reduce:animate-none",children:e.jsx("div",{className:"h-4 w-32 rounded bg-muted"})},v))})]}):c?e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs(k,{variant:"ghost",size:"sm",className:"-ml-2",onClick:r,children:[e.jsx(we,{className:"mr-2 h-4 w-4"}),"Retour aux groupes"]}),e.jsx("h2",{className:"text-2xl font-display font-semibold uppercase italic text-primary",children:c.name}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(H,{variant:c.is_active?"default":"secondary",children:c.is_active?"Actif":"Terminé"}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:[c.members.length," membre",c.members.length!==1?"s":""]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-xs font-semibold uppercase tracking-[0.15em] text-muted-foreground",children:"Membres"}),c.is_active&&e.jsxs(k,{size:"sm",variant:"outline",onClick:()=>f(!0),children:[e.jsx(ys,{className:"mr-1.5 h-3.5 w-3.5"}),"Ajouter"]})]}),c.members.length===0?e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"Aucun membre dans ce groupe."}):e.jsx("div",{className:"space-y-1.5",children:c.members.map(v=>e.jsxs("div",{className:"flex items-center gap-3 rounded-xl border bg-card p-3",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-sm font-semibold truncate",children:v.display_name}),v.permanent_group_label&&e.jsx(H,{variant:"secondary",className:"text-[10px] px-1.5 py-0 mt-0.5",children:v.permanent_group_label})]}),c.is_active&&e.jsx(k,{size:"icon",variant:"ghost",className:"h-8 w-8 text-muted-foreground hover:text-destructive",onClick:()=>h({userId:v.user_id,name:v.display_name}),title:"Retirer du groupe",children:e.jsx(bs,{className:"h-4 w-4"})})]},v.user_id))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-xs font-semibold uppercase tracking-[0.15em] text-muted-foreground",children:"Sous-groupes"}),c.is_active&&e.jsxs(k,{size:"sm",variant:"outline",onClick:()=>x(!0),children:[e.jsx(ae,{className:"mr-1.5 h-3.5 w-3.5"}),"Sous-groupe"]})]}),c.subgroups.length===0?e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"Aucun sous-groupe."}):e.jsx("div",{className:"space-y-2",children:c.subgroups.map(v=>e.jsxs(js,{children:[e.jsxs(fs,{className:"flex w-full items-center justify-between rounded-xl border bg-card p-3 text-left hover:bg-muted/50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ze,{className:"h-4 w-4 text-primary"}),e.jsx("span",{className:"text-sm font-semibold",children:v.name}),e.jsx(H,{variant:"secondary",className:"text-[10px] px-1.5 py-0",children:v.members.length})]}),e.jsx(Ns,{className:"h-4 w-4 text-muted-foreground transition-transform [[data-state=open]_&]:rotate-180"})]}),e.jsx(vs,{children:e.jsxs("div",{className:"ml-4 mt-1 space-y-1",children:[v.members.map(w=>e.jsx("div",{className:"flex items-center gap-2 rounded-lg border px-3 py-2",children:e.jsx("span",{className:"text-sm",children:w.display_name})},w.user_id)),v.members.length===0&&e.jsx("p",{className:"text-xs text-muted-foreground py-2",children:"Aucun membre."})]})})]},v.id))})]}),e.jsx(Rs,{open:g,onOpenChange:f,groupId:s,athletes:n,existingMemberIds:m,onAdded:t}),e.jsx(ss,{open:d,onOpenChange:x,athletes:n,parentGroupId:s,parentMembers:S,onCreated:t}),e.jsx(ue,{open:!!p,onOpenChange:v=>{v||h(null)},children:e.jsxs(me,{children:[e.jsxs(xe,{children:[e.jsx(pe,{children:"Retirer du groupe"}),e.jsxs(he,{children:["Voulez-vous retirer ",p?.name," de ce groupe ?",c.subgroups.length>0?" Le nageur sera aussi retiré des sous-groupes.":""]})]}),e.jsxs(ge,{children:[e.jsx(je,{children:"Annuler"}),e.jsx(fe,{onClick:()=>{p&&(y.mutate(p.userId),h(null))},className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Retirer"})]})]})})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs(k,{variant:"ghost",size:"sm",className:"-ml-2",onClick:r,children:[e.jsx(we,{className:"mr-2 h-4 w-4"}),"Retour aux groupes"]}),e.jsx("p",{className:"text-sm text-muted-foreground text-center py-8",children:"Groupe introuvable."})]})},Ve=({group:s,onManage:n,onDeactivate:r,onReactivate:a,onDelete:o})=>{const g=new Date(s.created_at).toLocaleDateString("fr-FR",{day:"numeric",month:"short",year:"numeric"});return e.jsxs("div",{className:"rounded-xl border bg-card p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-sm font-bold truncate",children:s.name}),e.jsxs("div",{className:"flex items-center gap-2 mt-1 flex-wrap",children:[e.jsxs("span",{className:"text-xs text-muted-foreground",children:[s.member_count," membre",s.member_count!==1?"s":""]}),s.subgroup_count>0&&e.jsxs("span",{className:"text-xs text-muted-foreground",children:[s.subgroup_count," sous-groupe",s.subgroup_count!==1?"s":""]}),e.jsx("span",{className:"text-xs text-muted-foreground",children:g})]})]}),e.jsx(H,{variant:s.is_active?"default":"secondary",children:s.is_active?"Actif":"Terminé"})]}),e.jsx("div",{className:"flex items-center gap-2 flex-wrap",children:s.is_active?e.jsxs(e.Fragment,{children:[e.jsxs(k,{size:"sm",variant:"outline",onClick:()=>n(s.id),children:[e.jsx(ls,{className:"mr-1.5 h-3.5 w-3.5"}),"Gérer"]}),e.jsxs(k,{size:"sm",variant:"outline",onClick:()=>r(s.id),children:[e.jsx(ps,{className:"mr-1.5 h-3.5 w-3.5"}),"Terminer"]})]}):e.jsxs(e.Fragment,{children:[e.jsxs(k,{size:"sm",variant:"outline",onClick:()=>a(s.id),children:[e.jsx(os,{className:"mr-1.5 h-3.5 w-3.5"}),"Réactiver"]}),e.jsxs(k,{size:"sm",variant:"outline",className:"text-destructive hover:text-destructive",onClick:()=>o(s.id),children:[e.jsx(Je,{className:"mr-1.5 h-3.5 w-3.5"}),"Supprimer"]})]})})]})},Ks=({onBack:s,athletes:n,athletesLoading:r})=>{const{toast:a}=W(),o=oe(),[g,f]=l.useState("list"),[d,x]=l.useState(null),[p,h]=l.useState(!1),[c,j]=l.useState(null),[y,t]=l.useState(null),{data:m=[],isLoading:S}=B({queryKey:["temp-groups"],queryFn:()=>M.getTemporaryGroups()}),v=l.useMemo(()=>m.filter(b=>b.is_active),[m]),w=l.useMemo(()=>m.filter(b=>!b.is_active),[m]),E=R({mutationFn:b=>M.deactivateTemporaryGroup(b),onSuccess:()=>{a({title:"Groupe terminé"}),o.invalidateQueries({queryKey:["temp-groups"]})},onError:b=>{a({title:"Erreur",description:b.message,variant:"destructive"})}}),q=R({mutationFn:b=>M.reactivateTemporaryGroup(b),onSuccess:()=>{a({title:"Groupe réactivé"}),o.invalidateQueries({queryKey:["temp-groups"]})},onError:b=>{a({title:"Erreur",description:b.message,variant:"destructive"})}}),_=R({mutationFn:b=>M.deleteTemporaryGroup(b),onSuccess:()=>{a({title:"Groupe supprimé"}),o.invalidateQueries({queryKey:["temp-groups"]})},onError:b=>{a({title:"Erreur",description:b.message,variant:"destructive"})}}),F=b=>{x(b),f("detail")},T=()=>{x(null),f("list"),o.invalidateQueries({queryKey:["temp-groups"]})};return g==="detail"&&d!=null?e.jsx(Is,{groupId:d,athletes:n,onBack:T}):e.jsxs("div",{className:"space-y-6 pb-24",children:[e.jsx(ne,{title:"Groupes temporaires",description:"Créez et gérez des groupes pour les stages, compétitions ou événements.",onBack:s,actions:e.jsxs(k,{size:"sm",onClick:()=>h(!0),children:[e.jsx(ae,{className:"mr-1.5 h-3.5 w-3.5"}),"Créer un groupe"]})}),S||r?e.jsx("div",{className:"space-y-2",children:[1,2,3].map(b=>e.jsx("div",{className:"rounded-xl border p-4 animate-pulse motion-reduce:animate-none",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-4 w-40 rounded bg-muted"}),e.jsx("div",{className:"ml-auto h-6 w-16 rounded bg-muted"})]})},b))}):m.length===0?e.jsxs("div",{className:"text-center py-12 space-y-3",children:[e.jsx(Se,{className:"h-10 w-10 text-muted-foreground mx-auto"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Aucun groupe temporaire pour le moment."}),e.jsxs(k,{variant:"outline",size:"sm",onClick:()=>h(!0),children:[e.jsx(ae,{className:"mr-1.5 h-3.5 w-3.5"}),"Créer le premier groupe"]})]}):e.jsxs(e.Fragment,{children:[v.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h3",{className:"text-xs font-semibold uppercase tracking-[0.15em] text-muted-foreground",children:["Actifs (",v.length,")"]}),v.map(b=>e.jsx(Ve,{group:b,onManage:F,onDeactivate:i=>j(i),onReactivate:i=>q.mutate(i),onDelete:i=>t(i)},b.id))]}),w.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h3",{className:"text-xs font-semibold uppercase tracking-[0.15em] text-muted-foreground",children:["Terminés (",w.length,")"]}),w.map(b=>e.jsx(Ve,{group:b,onManage:F,onDeactivate:i=>j(i),onReactivate:i=>q.mutate(i),onDelete:i=>t(i)},b.id))]})]}),e.jsx(ss,{open:p,onOpenChange:h,athletes:n,onCreated:()=>{o.invalidateQueries({queryKey:["temp-groups"]})}}),e.jsx(ue,{open:c!=null,onOpenChange:b=>{b||j(null)},children:e.jsxs(me,{children:[e.jsxs(xe,{children:[e.jsx(pe,{children:"Terminer le groupe"}),e.jsx(he,{children:"Voulez-vous marquer ce groupe comme terminé ? Les sous-groupes seront aussi désactivés. Vous pourrez le réactiver plus tard si nécessaire."})]}),e.jsxs(ge,{children:[e.jsx(je,{children:"Annuler"}),e.jsx(fe,{onClick:()=>{c!=null&&(E.mutate(c),j(null))},children:"Terminer"})]})]})}),e.jsx(ue,{open:y!=null,onOpenChange:b=>{b||t(null)},children:e.jsxs(me,{children:[e.jsxs(xe,{children:[e.jsx(pe,{children:"Supprimer le groupe"}),e.jsx(he,{children:"Cette action est irréversible. Le groupe et tous ses sous-groupes seront supprimés définitivement."})]}),e.jsxs(ge,{children:[e.jsx(je,{children:"Annuler"}),e.jsx(fe,{onClick:()=>{y!=null&&(_.mutate(y),t(null))},className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Supprimer"})]})]})})]})};function ke(s){return new Date(s+"T00:00:00").toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric"})}function Gs(s){const n=new Date;n.setHours(0,0,0,0);const r=new Date(s+"T00:00:00");return Math.ceil((r.getTime()-n.getTime())/(1e3*60*60*24))}const Bs=({open:s,onOpenChange:n,competition:r})=>{const{toast:a}=W(),o=oe(),g=!!r,[f,d]=l.useState(""),[x,p]=l.useState(""),[h,c]=l.useState(""),[j,y]=l.useState(!0),[t,m]=l.useState(""),[S,v]=l.useState(""),[w,E]=l.useState(!1);l.useEffect(()=>{s&&(r?(d(r.name),p(r.date),c(r.end_date??""),y(!!r.end_date),m(r.location??""),v(r.description??"")):(d(""),p(""),c(""),y(!0),m(""),v("")))},[s,r]);const q=R({mutationFn:i=>M.createCompetition(i),onSuccess:()=>{a({title:"Competition creee"}),o.invalidateQueries({queryKey:["competitions"]}),n(!1)},onError:i=>{a({title:"Erreur",description:i.message,variant:"destructive"})}}),_=R({mutationFn:i=>M.updateCompetition(r.id,i),onSuccess:()=>{a({title:"Competition mise a jour"}),o.invalidateQueries({queryKey:["competitions"]}),n(!1)},onError:i=>{a({title:"Erreur",description:i.message,variant:"destructive"})}}),F=R({mutationFn:()=>M.deleteCompetition(r.id),onSuccess:()=>{a({title:"Competition supprimee"}),o.invalidateQueries({queryKey:["competitions"]}),n(!1)},onError:i=>{a({title:"Erreur",description:i.message,variant:"destructive"})}}),T=()=>{if(!f.trim()){a({title:"Nom requis",description:"Veuillez saisir un nom pour la competition.",variant:"destructive"});return}if(!x){a({title:"Date requise",description:"Veuillez saisir une date.",variant:"destructive"});return}const i={name:f.trim(),date:x,end_date:j&&h?h:null,location:t.trim()||null,description:S.trim()||null};g?_.mutate(i):q.mutate(i)},b=q.isPending||_.isPending||F.isPending;return e.jsxs(e.Fragment,{children:[e.jsx(ve,{open:s,onOpenChange:n,children:e.jsxs(ye,{side:"right",className:"w-full sm:max-w-md overflow-y-auto",children:[e.jsx(be,{children:e.jsx(Ne,{children:g?"Modifier la competition":"Nouvelle competition"})}),e.jsxs("div",{className:"mt-6 space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{htmlFor:"comp-name",children:"Nom *"}),e.jsx(ie,{id:"comp-name",placeholder:"Ex : Championnats Regionaux",value:f,onChange:i=>d(i.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{htmlFor:"comp-date",children:"Date *"}),e.jsx("input",{id:"comp-date",type:"date",value:x,onChange:i=>p(i.target.value),className:"flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(P,{htmlFor:"comp-multiday",children:"Multi-jours"}),e.jsx(ws,{id:"comp-multiday",checked:j,onCheckedChange:y})]}),j&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{htmlFor:"comp-end-date",children:"Date de fin"}),e.jsx("input",{id:"comp-end-date",type:"date",value:h,onChange:i=>c(i.target.value),min:x||void 0,className:"flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{htmlFor:"comp-location",children:"Lieu"}),e.jsx(ie,{id:"comp-location",placeholder:"Ex : Piscine de Strasbourg",value:t,onChange:i=>m(i.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{htmlFor:"comp-description",children:"Description"}),e.jsx(Xe,{id:"comp-description",placeholder:"Notes, informations complementaires...",value:S,onChange:i=>v(i.target.value),rows:3})]}),e.jsxs("div",{className:"space-y-2 pt-2",children:[e.jsx(k,{className:"w-full",onClick:T,disabled:b||!f.trim()||!x,children:b?"Enregistrement...":g?"Enregistrer":"Creer"}),g&&e.jsx(k,{variant:"outline",className:"w-full text-destructive hover:text-destructive",onClick:()=>E(!0),disabled:b,children:"Supprimer cette competition"})]})]})]})}),e.jsx(ue,{open:w,onOpenChange:E,children:e.jsxs(me,{children:[e.jsxs(xe,{children:[e.jsx(pe,{children:"Supprimer la competition"}),e.jsxs(he,{children:["Cette action est irreversible. La competition «"," ",r?.name," » sera supprimee definitivement."]})]}),e.jsxs(ge,{children:[e.jsx(je,{children:"Annuler"}),e.jsx(fe,{onClick:()=>{F.mutate(),E(!1)},className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Supprimer"})]})]})})]})},Vs=({competition:s,onEdit:n})=>{const r=Gs(s.date),a=r<0,o=r>=0,g=s.end_date?`du ${ke(s.date)} au ${ke(s.end_date)}`:ke(s.date);return e.jsxs("button",{type:"button",className:`w-full text-left rounded-xl border bg-card p-3 space-y-1 transition-colors hover:bg-muted/50 ${a?"opacity-60":""}`,onClick:()=>n(s),children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-sm font-semibold truncate",children:s.name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:g})]}),e.jsxs("div",{className:"flex items-center gap-1.5 shrink-0",children:[o&&e.jsxs(H,{variant:"outline",className:"border-orange-300 text-orange-600 dark:text-orange-400 text-[10px] px-1.5 py-0",children:["J-",r]}),a&&e.jsx(H,{variant:"secondary",className:"text-[10px] px-1.5 py-0",children:"Passee"})]})]}),s.location&&e.jsxs("div",{className:"flex items-center gap-1 text-xs text-muted-foreground",children:[e.jsx(Ss,{className:"h-3 w-3 shrink-0"}),e.jsx("span",{className:"truncate",children:s.location})]})]})},Qs=({onBack:s})=>{const[n,r]=l.useState(!1),[a,o]=l.useState(null),{data:g=[],isLoading:f}=B({queryKey:["competitions"],queryFn:()=>M.getCompetitions()}),d=l.useMemo(()=>{const c=new Date;c.setHours(0,0,0,0);const j=c.getTime(),y=[],t=[];for(const m of g)new Date(m.date+"T00:00:00").getTime()>=j?y.push(m):t.push(m);return y.sort((m,S)=>new Date(m.date+"T00:00:00").getTime()-new Date(S.date+"T00:00:00").getTime()),t.sort((m,S)=>new Date(S.date+"T00:00:00").getTime()-new Date(m.date+"T00:00:00").getTime()),[...y,...t]},[g]),x=()=>{o(null),r(!0)},p=c=>{o(c),r(!0)},h=g.length===0?"Gerez les competitions du club.":`${g.length} competition${g.length>1?"s":""}`;return e.jsxs("div",{className:"space-y-6 pb-24",children:[e.jsx(ne,{title:"Competitions",description:h,onBack:s,actions:e.jsxs(k,{variant:"outline",size:"sm",onClick:x,children:[e.jsx(ae,{className:"mr-1.5 h-3.5 w-3.5"}),"Ajouter"]})}),f?e.jsx("div",{className:"space-y-2",children:[1,2,3].map(c=>e.jsx("div",{className:"rounded-xl border p-3 animate-pulse motion-reduce:animate-none",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-4 w-40 rounded bg-muted"}),e.jsx("div",{className:"ml-auto h-5 w-12 rounded bg-muted"})]})},c))}):d.length===0?e.jsxs("div",{className:"text-center py-12 space-y-3",children:[e.jsx(qe,{className:"h-10 w-10 text-muted-foreground mx-auto"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Aucune competition creee."}),e.jsxs(k,{variant:"outline",size:"sm",onClick:x,children:[e.jsx(ae,{className:"mr-1.5 h-3.5 w-3.5"}),"Creer la premiere competition"]})]}):e.jsx("div",{className:"space-y-2",children:d.map(c=>e.jsx(Vs,{competition:c,onEdit:p},c.id))}),e.jsx(Bs,{open:n,onOpenChange:r,competition:a})]})},Us=["50NL","100NL","200NL","400NL","800NL","1500NL","50DOS","100DOS","200DOS","50BR","100BR","200BR","50PAP","100PAP","200PAP","200QN","400QN"];function ts(s){const n=s.match(/^(\d+)(NL|DOS|BR|PAP|QN)$/);if(!n)return s;const r={NL:"Nage Libre",DOS:"Dos",BR:"Brasse",PAP:"Papillon",QN:"4 Nages"};return`${n[1]}m ${r[n[2]]||n[2]}`}function ns(s){const n=Math.floor(s/60),r=s%60,a=Math.floor(r),o=Math.round((r-a)*100);return`${n}:${String(a).padStart(2,"0")}:${String(o).padStart(2,"0")}`}function Qe(s){const n=s.match(/^(\d+):(\d{2})[.::](\d{2})$/);return n?parseInt(n[1])*60+parseInt(n[2])+parseInt(n[3])/100:null}async function Hs(s){const{data:n,error:r}=await cs.rpc("get_auth_uid_for_user",{p_user_id:s});return r?(console.error("[objectives] Failed to resolve auth UUID:",r.message),null):n}const Ys=({open:s,onOpenChange:n,objective:r,athleteName:a,athleteAuthId:o,competitions:g})=>{const{toast:f}=W(),d=oe(),x=!!r,[p,h]=l.useState("chrono"),[c,j]=l.useState(""),[y,t]=l.useState("25"),[m,S]=l.useState(""),[v,w]=l.useState(""),[E,q]=l.useState(""),[_,F]=l.useState(!1),T=u=>{if(u)if(r){const L=!!r.event_code,O=!!r.text;h(L&&O?"both":O?"texte":"chrono"),j(r.event_code??""),t(String(r.pool_length??25)),S(r.target_time_seconds!=null?ns(r.target_time_seconds):""),w(r.text??""),q(r.competition_id??"")}else h("chrono"),j(""),t("25"),S(""),w(""),q("");n(u)},b=R({mutationFn:u=>M.createObjective(u),onSuccess:()=>{f({title:"Objectif cree"}),d.invalidateQueries({queryKey:["objectives"]}),n(!1)},onError:u=>{f({title:"Erreur",description:u.message,variant:"destructive"})}}),i=R({mutationFn:u=>M.updateObjective(r.id,u),onSuccess:()=>{f({title:"Objectif mis a jour"}),d.invalidateQueries({queryKey:["objectives"]}),n(!1)},onError:u=>{f({title:"Erreur",description:u.message,variant:"destructive"})}}),I=R({mutationFn:()=>M.deleteObjective(r.id),onSuccess:()=>{f({title:"Objectif supprime"}),d.invalidateQueries({queryKey:["objectives"]}),n(!1)},onError:u=>{f({title:"Erreur",description:u.message,variant:"destructive"})}}),Q=p==="chrono"||p==="both",Y=p==="texte"||p==="both",C=()=>{if(Q&&!c){f({title:"Epreuve requise",description:"Veuillez selectionner une epreuve.",variant:"destructive"});return}if(Q&&m&&Qe(m)===null){f({title:"Format invalide",description:"Le temps doit être au format m:ss:cc (ex: 1:05:30)",variant:"destructive"});return}if(Y&&!v.trim()){f({title:"Texte requis",description:"Veuillez saisir un objectif texte.",variant:"destructive"});return}const u={athlete_id:o,competition_id:E&&E!=="none"?E:null,event_code:Q?c:null,pool_length:Q?Number(y):null,target_time_seconds:Q&&m?Qe(m):null,text:Y?v.trim():null};x?i.mutate(u):b.mutate(u)},D=b.isPending||i.isPending||I.isPending,A=l.useMemo(()=>{const u=new Date;return u.setHours(0,0,0,0),g.filter(L=>new Date(L.date+"T00:00:00").getTime()>=u.getTime())},[g]);return e.jsxs(e.Fragment,{children:[e.jsx(ve,{open:s,onOpenChange:T,children:e.jsxs(ye,{side:"right",className:"w-full sm:max-w-md overflow-y-auto",children:[e.jsx(be,{children:e.jsx(Ne,{children:x?"Modifier l'objectif":"Nouvel objectif"})}),e.jsxs("div",{className:"mt-6 space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{children:"Nageur"}),e.jsx("p",{className:"text-sm font-medium",children:a})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{children:"Type d'objectif"}),e.jsxs(Ee,{type:"single",variant:"outline",value:p,onValueChange:u=>{u&&h(u)},className:"justify-start",children:[e.jsx(X,{value:"chrono",className:"text-xs",children:"Chrono"}),e.jsx(X,{value:"texte",className:"text-xs",children:"Texte"}),e.jsx(X,{value:"both",className:"text-xs",children:"Les deux"})]})]}),Q&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{children:"Epreuve *"}),e.jsxs(Z,{value:c,onValueChange:j,children:[e.jsx(ee,{children:e.jsx(se,{placeholder:"Choisir une epreuve"})}),e.jsx(te,{children:Us.map(u=>e.jsx(V,{value:u,children:ts(u)},u))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{children:"Bassin"}),e.jsxs(Z,{value:y,onValueChange:t,children:[e.jsx(ee,{children:e.jsx(se,{})}),e.jsxs(te,{children:[e.jsx(V,{value:"25",children:"25m"}),e.jsx(V,{value:"50",children:"50m"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{children:"Temps cible (min:sec:centièmes)"}),e.jsx(ie,{placeholder:"Ex : 1:05:30",value:m,onChange:u=>S(u.target.value)})]})]}),Y&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{children:"Objectif texte *"}),e.jsx(Xe,{placeholder:"Ex : Ameliorer la coulée de dos",value:v,onChange:u=>w(u.target.value),rows:3})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{children:"Lier a une competition"}),e.jsxs(Z,{value:E,onValueChange:q,children:[e.jsx(ee,{children:e.jsx(se,{placeholder:"Aucune"})}),e.jsxs(te,{children:[e.jsx(V,{value:"none",children:"Aucune"}),A.map(u=>e.jsxs(V,{value:u.id,children:[u.name," (",u.date,")"]},u.id))]})]})]}),e.jsxs("div",{className:"space-y-2 pt-2",children:[e.jsx(k,{className:"w-full",onClick:C,disabled:D,children:D?"Enregistrement...":x?"Enregistrer":"Creer"}),x&&e.jsx(k,{variant:"outline",className:"w-full text-destructive hover:text-destructive",onClick:()=>F(!0),disabled:D,children:"Supprimer cet objectif"})]})]})]})}),e.jsx(ue,{open:_,onOpenChange:F,children:e.jsxs(me,{children:[e.jsxs(xe,{children:[e.jsx(pe,{children:"Supprimer l'objectif"}),e.jsx(he,{children:"Cette action est irreversible. L'objectif sera supprime definitivement."})]}),e.jsxs(ge,{children:[e.jsx(je,{children:"Annuler"}),e.jsx(fe,{onClick:()=>{I.mutate(),F(!1)},className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Supprimer"})]})]})})]})},Ws=({objective:s,onEdit:n})=>{const r=!!s.event_code,a=!!s.text;return e.jsxs("button",{type:"button",className:"w-full text-left rounded-xl border bg-card p-3 space-y-1.5 transition-colors hover:bg-muted/50",onClick:()=>n(s),children:[r&&e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"text-sm font-semibold",children:ts(s.event_code)}),s.pool_length&&e.jsxs(H,{variant:"secondary",className:"text-[10px] px-1.5 py-0",children:[s.pool_length,"m"]}),s.target_time_seconds!=null&&e.jsx(H,{variant:"outline",className:"text-[10px] px-1.5 py-0 font-mono",children:ns(s.target_time_seconds)})]}),a&&e.jsx("p",{className:"text-sm text-muted-foreground line-clamp-2",children:s.text}),s.competition_name&&e.jsx(H,{variant:"outline",className:"border-orange-300 text-orange-600 dark:text-orange-400 text-[10px] px-1.5 py-0",children:s.competition_name})]})},Js=({onBack:s,athletes:n,athletesLoading:r})=>{const{toast:a}=W(),[o,g]=l.useState(""),[f,d]=l.useState(!1),[x,p]=l.useState(null),h=l.useMemo(()=>o?n.find(_=>_.id!=null&&String(_.id)===o)??null:null,[n,o]),{data:c,isLoading:j}=B({queryKey:["auth-uid",o],queryFn:()=>Hs(Number(o)),enabled:!!o}),{data:y=[]}=B({queryKey:["competitions"],queryFn:()=>M.getCompetitions()}),{data:t=[],isLoading:m}=B({queryKey:["objectives",c],queryFn:()=>M.getObjectives(c),enabled:!!c}),S=l.useMemo(()=>{const _=n.filter(T=>T.id!=null),F=new Map;for(const T of _){const b=T.group_label||"Sans groupe";F.has(b)||F.set(b,[]),F.get(b).push(T)}return[...F.entries()].sort(([T],[b])=>T.localeCompare(b,"fr"))},[n]),v=()=>{if(!c){a({title:"Nageur requis",description:"Veuillez selectionner un nageur.",variant:"destructive"});return}p(null),d(!0)},w=_=>{p(_),d(!0)},E=r||!!o&&j,q=!!c&&!j;return e.jsxs("div",{className:"space-y-6 pb-24",children:[e.jsx(ne,{title:"Objectifs",description:"Definissez des objectifs chrono ou texte pour chaque nageur.",onBack:s,actions:e.jsxs(k,{variant:"outline",size:"sm",onClick:v,disabled:!c,children:[e.jsx(ae,{className:"mr-1.5 h-3.5 w-3.5"}),"Ajouter"]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{children:"Nageur"}),e.jsxs(Z,{value:o,onValueChange:g,children:[e.jsx(ee,{children:e.jsx(se,{placeholder:"Selectionner un nageur"})}),e.jsx(te,{children:S.map(([_,F])=>e.jsxs("div",{children:[e.jsx("div",{className:"px-2 py-1.5 text-xs font-semibold uppercase tracking-wider text-muted-foreground",children:_}),F.map(T=>e.jsx(V,{value:String(T.id),children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:T.display_name}),T.group_label&&e.jsx(H,{variant:"secondary",className:"text-[10px] px-1.5 py-0",children:T.group_label})]})},T.id))]},_))})]})]}),!o&&e.jsxs("div",{className:"text-center py-12 space-y-3",children:[e.jsx(ze,{className:"h-10 w-10 text-muted-foreground mx-auto"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Selectionnez un nageur pour voir et gerer ses objectifs."})]}),E&&o&&e.jsx("div",{className:"space-y-2",children:[1,2,3].map(_=>e.jsx("div",{className:"rounded-xl border p-3 animate-pulse motion-reduce:animate-none",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-4 w-40 rounded bg-muted"}),e.jsx("div",{className:"ml-auto h-5 w-12 rounded bg-muted"})]})},_))}),q&&m&&e.jsx("div",{className:"space-y-2",children:[1,2].map(_=>e.jsx("div",{className:"rounded-xl border p-3 animate-pulse motion-reduce:animate-none",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-4 w-32 rounded bg-muted"}),e.jsx("div",{className:"ml-auto h-5 w-16 rounded bg-muted"})]})},_))}),q&&!m&&t.length===0&&e.jsxs("div",{className:"text-center py-12 space-y-3",children:[e.jsx(ze,{className:"h-10 w-10 text-muted-foreground mx-auto"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Aucun objectif defini pour ",h?.display_name,"."]}),e.jsxs(k,{variant:"outline",size:"sm",onClick:v,children:[e.jsx(ae,{className:"mr-1.5 h-3.5 w-3.5"}),"Creer le premier objectif"]})]}),q&&!m&&t.length>0&&e.jsx("div",{className:"space-y-2",children:t.map(_=>e.jsx(Ws,{objective:_,onEdit:w},_.id))}),c&&h&&e.jsx(Ys,{open:f,onOpenChange:d,objective:x,athleteName:h.display_name,athleteAuthId:c,competitions:y})]})},Xs=l.lazy(()=>We(()=>import("./StrengthCatalog-3Fss38S0.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33]))),Zs=l.lazy(()=>We(()=>import("./SwimCatalog-CDIYrPr0.js"),__vite__mapDeps([34,1,2,3,4,5,6,7,18,19,9,10,11,12,13,21,16,35,36,37,38,39,23,15,24,25,26,27,28,17,31,40,30,41]))),et=({onNavigate:s,onOpenRecordsAdmin:n,onOpenRecordsClub:r,athletes:a,athletesLoading:o,upcomingBirthdays:g,birthdaysLoading:f,kpiLoading:d,kpiPeriod:x,onKpiPeriodChange:p,fatigueAlerts:h,mostLoadedAthlete:c,swimSessionCount:j,strengthSessionCount:y})=>{const t=new Date().getHours(),m=t<12?"Bonjour":t<18?"Bon après-midi":"Bonsoir",S=new Date().toLocaleDateString("fr-FR",{weekday:"long",day:"numeric",month:"long"}),v=h.length>0;return e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-display font-bold uppercase italic",children:[m,", ",e.jsx("span",{className:"text-primary",children:"Coach"})]}),e.jsx("p",{className:"text-sm text-muted-foreground capitalize",children:S})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h2",{className:"text-xs font-semibold uppercase tracking-[0.15em] text-muted-foreground",children:["Signaux · ",x,"j"]}),e.jsxs(Ee,{type:"single",size:"sm",variant:"outline",value:String(x),onValueChange:w=>{w&&p(Number(w))},children:[e.jsx(X,{value:"7",className:"h-7 px-2 text-xs","aria-label":"7 jours",children:"7j"}),e.jsx(X,{value:"30",className:"h-7 px-2 text-xs","aria-label":"30 jours",children:"30j"}),e.jsx(X,{value:"365",className:"h-7 px-2 text-xs","aria-label":"1 an",children:"1an"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:`rounded-xl border p-3 ${v?"border-destructive/30 bg-destructive/5":"bg-muted/30"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-[11px] text-muted-foreground",children:"Fatigue 5/5"}),e.jsx(As,{className:`h-3.5 w-3.5 ${v?"text-destructive":"text-muted-foreground"}`})]}),e.jsx("p",{className:"text-xl font-bold tabular-nums",children:d?"–":h.length}),e.jsx("p",{className:"text-[11px] text-muted-foreground truncate",children:d?"Chargement…":v?h.slice(0,2).map(w=>w.athleteName.split(" ")[0]).join(", "):"Aucune alerte"})]}),e.jsxs("div",{className:"rounded-xl border bg-muted/30 p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-[11px] text-muted-foreground",children:"Plus chargé"}),e.jsx(Se,{className:"h-3.5 w-3.5 text-muted-foreground"})]}),e.jsx("p",{className:"text-xl font-bold truncate",children:d?"–":c?.athleteName?.split(" ")[0]??"–"}),e.jsx("p",{className:"text-[11px] text-muted-foreground",children:d?"Calcul…":c?`Charge ${Math.round(c.loadScore)}`:"Pas de données"})]})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs("button",{type:"button",onClick:()=>s("calendar"),className:"flex items-center gap-1.5 rounded-full bg-primary text-primary-foreground px-3.5 py-2 text-sm font-semibold active:opacity-80 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",children:[e.jsx(Le,{className:"h-3.5 w-3.5"}),"Assigner"]}),e.jsxs("button",{type:"button",onClick:()=>s("messaging"),className:"flex items-center gap-1.5 rounded-full border px-3.5 py-2 text-sm font-semibold active:bg-muted focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",children:[e.jsx(Pe,{className:"h-3.5 w-3.5"}),"Email"]}),e.jsxs("button",{type:"button",onClick:()=>s("groups"),className:"flex items-center gap-1.5 rounded-full border px-3.5 py-2 text-sm font-semibold active:bg-muted focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",children:[e.jsx(Ze,{className:"h-3.5 w-3.5"}),"Groupes"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("button",{type:"button",onClick:()=>s("swim"),className:"rounded-xl border bg-card p-4 text-left shadow-sm active:bg-muted/50 transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",children:[e.jsx(He,{className:"h-5 w-5 text-primary mb-2"}),e.jsx("p",{className:"text-sm font-bold",children:"Natation"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:j!=null?`${j} séance${j!==1?"s":""}`:"Bibliothèque"})]}),e.jsxs("button",{type:"button",onClick:()=>s("strength"),className:"rounded-xl border bg-card p-4 text-left shadow-sm active:bg-muted/50 transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",children:[e.jsx(Ye,{className:"h-5 w-5 text-primary mb-2"}),e.jsx("p",{className:"text-sm font-bold",children:"Musculation"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:y!=null?`${y} séance${y!==1?"s":""}`:"Bibliothèque"})]}),e.jsxs("button",{type:"button",onClick:()=>s("swimmers"),className:"rounded-xl border bg-card p-4 text-left shadow-sm active:bg-muted/50 transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",children:[e.jsx(Se,{className:"h-5 w-5 text-primary mb-2"}),e.jsx("p",{className:"text-sm font-bold",children:"Nageurs"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:o?"Chargement…":`${a.length} nageur${a.length!==1?"s":""}`})]}),e.jsxs("button",{type:"button",onClick:n,className:"rounded-xl border bg-card p-4 text-left shadow-sm active:bg-muted/50 transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",children:[e.jsx(qe,{className:"h-5 w-5 text-primary mb-2"}),e.jsx("p",{className:"text-sm font-bold",children:"Records club"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Import & administration"})]}),e.jsxs("button",{type:"button",onClick:()=>s("competitions"),className:"rounded-xl border bg-card p-4 text-left shadow-sm active:bg-muted/50 transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",children:[e.jsx(qe,{className:"h-5 w-5 text-amber-500 mb-2"}),e.jsx("p",{className:"text-sm font-bold",children:"Compétitions"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Échéances & calendrier"})]}),e.jsxs("button",{type:"button",onClick:()=>s("objectives"),className:"rounded-xl border bg-card p-4 text-left shadow-sm active:bg-muted/50 transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",children:[e.jsx(ze,{className:"h-5 w-5 text-primary mb-2"}),e.jsx("p",{className:"text-sm font-bold",children:"Objectifs"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Temps cibles & objectifs"})]})]}),e.jsx("button",{type:"button",onClick:r,className:"w-full text-center text-sm text-primary font-semibold py-1 active:opacity-70 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring rounded",children:"Voir les records du club"}),!f&&g&&g.length>0?e.jsxs("div",{className:"space-y-2",children:[e.jsx("h2",{className:"text-xs font-semibold uppercase tracking-[0.15em] text-muted-foreground",children:"Anniversaires"}),e.jsx("div",{className:"space-y-1.5",children:g.slice(0,3).map(w=>e.jsxs("div",{className:"flex items-center justify-between gap-2 rounded-lg border px-3 py-2",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("span",{className:"text-sm font-medium truncate block",children:w.display_name}),e.jsx("span",{className:"text-[11px] text-muted-foreground",children:st(w.next_birthday)})]}),e.jsxs("span",{className:"text-xs font-bold text-primary shrink-0",children:["J-",w.days_until]})]},w.id))})]}):null]})},st=s=>{if(!s)return"-";const n=new Date(s);return Number.isNaN(n.getTime())?s:n.toLocaleDateString("fr-FR")},Ue=s=>s.toISOString().split("T")[0],tt=s=>new Date(s.completed_at||s.started_at||s.date||s.created_at||0).getTime(),nt=s=>{if(!s.length)return null;const n=s.reduce((a,o)=>a+o,0)/s.length,r=Math.min(5,Math.max(1,Math.round(n/10*5)));return{average:n,rating:r}};function zt(){const s=Ie(i=>i.role),n=Ie(i=>i.setSelectedAthlete),[,r]=ds(),[a,o]=l.useState("home"),[g,f]=l.useState(7);l.useEffect(()=>{const i=()=>o("home");return window.addEventListener("nav:reset",i),()=>window.removeEventListener("nav:reset",i)},[]);const d=s==="coach"||s==="admin",x=a==="home"||a==="calendar",p=a==="home"||a==="messaging"||a==="swimmers"||a==="calendar"||a==="groups"||a==="objectives",h=a==="messaging"||a==="calendar"||a==="groups",c=a==="home"||a==="swimmers",{data:j}=B({queryKey:["swim_catalog"],queryFn:()=>M.getSwimCatalog(),enabled:d&&x}),{data:y}=B({queryKey:["strength_catalog"],queryFn:()=>M.getStrengthSessions(),enabled:d&&x}),{data:t=[],isLoading:m}=B({queryKey:["athletes"],queryFn:()=>M.getAthletes(),enabled:d&&p}),S=l.useMemo(()=>t.slice(0,5),[t]),{data:v=[]}=B({queryKey:["groups"],queryFn:()=>M.getGroups(),enabled:d&&h}),w=B({queryKey:["upcoming-birthdays"],queryFn:()=>M.getUpcomingBirthdays({days:30}),enabled:d&&c}),E=w.data,q=B({queryKey:["coach-kpis",g,S.map(i=>i.id??i.display_name)],enabled:d&&a==="home"&&S.length>0,queryFn:async()=>{const i=g,I=new Date;I.setDate(I.getDate()-i);const Q=Ue(I),Y=Ue(new Date),C=await Promise.all(S.map(async u=>{const[L,O]=await Promise.all([M.getSessions(u.display_name,u.id),M.getStrengthHistory(u.display_name,{athleteId:u.id,limit:50,from:Q,to:Y})]),N=L.filter(z=>new Date(z.date).getTime()>=I.getTime()),K=N.map(z=>z.fatigue??z.feeling).filter(z=>Number.isFinite(z)),$=N.reduce((z,J)=>z+(Number(J.duration)||0)*(Number(J.effort)||0),0),G=(O?.runs??[]).filter(z=>tt(z)>=I.getTime()),ce=G.map(z=>z.fatigue??z.feeling??z.rpe).filter(z=>Number.isFinite(Number(z))).map(z=>Number(z)),de=G.reduce((z,J)=>{const $e=Number(J.feeling??J.rpe??0),Re=Number(J.duration??0);if(Re>0&&$e>0)return z+Re*$e;const rs=Array.isArray(J.logs)?J.logs.length:0;return z+rs*5},0),as=nt([...K,...ce]);return{athleteName:u.display_name,loadScore:$+de,fatigueRating:as}})),D=C.filter(u=>u.fatigueRating?.rating===5).map(u=>({athleteName:u.athleteName,rating:u.fatigueRating?.rating??0})),A=C.filter(u=>u.loadScore>0).sort((u,L)=>L.loadScore-u.loadScore)[0];return{fatigueAlerts:D,mostLoadedAthlete:A??null}}}),_=i=>{n({id:i.id??null,name:i.display_name}),r("/progress")},{toast:F}=W(),T=oe(),b=R({mutationFn:async i=>{const I=await M.importSingleSwimmer(i.iuf,i.name);return await M.recalculateClubRecords(),I},onSuccess:i=>{F({title:"Import terminé",description:`${i.total_found} trouvées, ${i.new_imported} nouvelles.`}),T.invalidateQueries({queryKey:["club-records"]})},onError:i=>{F({title:"Erreur import",description:i.message,variant:"destructive"})}});return d?e.jsxs("div",{className:"space-y-6",children:[a==="home"?e.jsx(et,{onNavigate:o,onOpenRecordsAdmin:()=>r("/records-admin"),onOpenRecordsClub:()=>r("/records-club"),athletes:t,athletesLoading:m,upcomingBirthdays:E,birthdaysLoading:w.isLoading,kpiLoading:q.isLoading,kpiPeriod:g,onKpiPeriodChange:f,fatigueAlerts:q.data?.fatigueAlerts??[],mostLoadedAthlete:q.data?.mostLoadedAthlete??null,swimSessionCount:j?.length,strengthSessionCount:y?.length}):null,a==="swim"?e.jsxs("div",{className:"space-y-6",children:[e.jsx(ne,{title:"Bibliothèque natation",description:"Accédez aux séances et aux templates natation.",onBack:()=>o("home"),actions:e.jsxs(k,{variant:"outline",size:"sm",onClick:()=>o("calendar"),children:[e.jsx(Le,{className:"mr-1.5 h-3.5 w-3.5"}),"Assigner"]})}),e.jsx(l.Suspense,{fallback:e.jsx(Ke,{}),children:e.jsx(Zs,{})})]}):null,a==="strength"?e.jsxs("div",{className:"space-y-6",children:[e.jsx(ne,{title:"Bibliothèque musculation",description:"Consultez et créez des séances musculation.",onBack:()=>o("home"),actions:e.jsxs(k,{variant:"outline",size:"sm",onClick:()=>o("calendar"),children:[e.jsx(Le,{className:"mr-1.5 h-3.5 w-3.5"}),"Assigner"]})}),e.jsx(l.Suspense,{fallback:e.jsx(Ke,{}),children:e.jsx(Xs,{})})]}):null,a==="swimmers"?e.jsxs("div",{className:"space-y-4",children:[e.jsx(ne,{title:"Nageurs",description:m?"Chargement…":`${t.length} nageur${t.length!==1?"s":""} inscrit${t.length!==1?"s":""}`,onBack:()=>o("home"),actions:e.jsxs(k,{variant:"outline",size:"sm",onClick:()=>o("messaging"),children:[e.jsx(Pe,{className:"mr-1.5 h-3.5 w-3.5"}),"Email"]})}),m?e.jsx("div",{className:"space-y-2",children:[1,2,3,4,5].map(i=>e.jsx("div",{className:"rounded-xl border p-3 animate-pulse motion-reduce:animate-none",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-4 w-32 rounded bg-muted"}),e.jsx("div",{className:"ml-auto h-8 w-16 rounded bg-muted"})]})},i))}):t.length?e.jsx("div",{className:"space-y-2",children:t.map(i=>e.jsxs("div",{className:"flex items-center gap-3 rounded-xl border bg-card p-3",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-sm font-semibold truncate",children:i.display_name}),e.jsxs("div",{className:"flex items-center gap-2 mt-0.5",children:[i.group_label?e.jsx(H,{variant:"secondary",className:"text-[10px] px-1.5 py-0",children:i.group_label}):null,i.ffn_iuf?e.jsx("span",{className:"text-[10px] font-mono text-muted-foreground",children:i.ffn_iuf}):null]})]}),e.jsxs("div",{className:"flex items-center gap-1 shrink-0",children:[i.ffn_iuf?e.jsx(k,{size:"icon",variant:"ghost",className:"h-8 w-8",disabled:b.isPending,onClick:()=>b.mutate({iuf:i.ffn_iuf,name:i.display_name}),title:"Importer performances FFN",children:e.jsx(us,{className:"h-4 w-4"})}):null,e.jsx(k,{size:"sm",variant:"outline",onClick:()=>_(i),children:"Fiche"})]})]},i.id??i.display_name))}):e.jsx("p",{className:"text-sm text-muted-foreground text-center py-8",children:"Aucun nageur disponible."})]}):null,a==="messaging"?e.jsx(qs,{onBack:()=>o("home"),athletes:t,groups:v,athletesLoading:m}):null,a==="calendar"?e.jsx(Ps,{onBack:()=>o("home"),athletes:t,groups:v,swimSessions:j,strengthSessions:y}):null,a==="groups"?e.jsx(Ks,{onBack:()=>o("home"),athletes:t,groups:v,athletesLoading:m}):null,a==="competitions"?e.jsx(Qs,{onBack:()=>o("home")}):null,a==="objectives"?e.jsx(Js,{onBack:()=>o("home"),athletes:t,athletesLoading:m}):null]}):e.jsx("div",{className:"flex items-center justify-center min-h-[60vh] animate-in fade-in motion-reduce:animate-none",children:e.jsxs(Me,{className:"w-full max-w-sm shadow-xl border-t-4 border-t-primary",children:[e.jsxs(De,{children:[e.jsxs(Ae,{className:"flex items-center gap-2 uppercase italic",children:[e.jsx(Se,{className:"h-5 w-5 text-primary"}),"Accès Coach"]}),e.jsx(Te,{children:"Cette section est réservée aux coachs et administrateurs."})]}),e.jsx(Fe,{children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"Connectez-vous avec un compte autorisé pour accéder aux outils de gestion."})})]})})}export{zt as default};
