import{u as H,M as L,r as n,k as u,al as G,Q as v,j as e,B as N,C as F,g as A,h as I,a0 as E,i as T,_ as m,S as R,b as w,d as B,e as M,f as k}from"./index-CUOftdJB.js";import{S as O}from"./switch-BCrMieYT.js";import{B as D}from"./badge-D3Ti4N4Q.js";import{T as K,a as Q,b as $,c as d,d as X,e as c}from"./table-Y3nlC8ZD.js";const P=[{value:"M",label:"Garçon"},{value:"F",label:"Fille"}],q=x=>x==="user"?"Compte":"Ancien";function ee(){const x=H(s=>s.role),{toast:i}=L(),[r,o]=n.useState({display_name:"",iuf:"",sex:"",birthdate:""}),[p,S]=n.useState([]),[f,y]=n.useState(!1),[h,_]=n.useState(null),g=x==="coach"||x==="admin",l=n.useCallback(async()=>{if(g){y(!0),_(null);try{const s=await u.getClubRecordSwimmers();S(s)}catch(s){const a=G(s,"Impossible de charger la liste.");_(a.message),S([])}finally{y(!1)}}},[g]);n.useEffect(()=>{l()},[l]);const C=v({mutationFn:()=>u.createClubRecordSwimmer({display_name:r.display_name.trim(),iuf:r.iuf.trim()||null,sex:r.sex?r.sex:null,birthdate:r.birthdate||null,is_active:!0}),onSuccess:()=>{i({title:"Nageur ajouté"}),o({display_name:"",iuf:"",sex:"",birthdate:""}),l()},onError:()=>{i({title:"Impossible d'ajouter le nageur",variant:"destructive"})}}),U=v({mutationFn:({id:s,payload:a})=>u.updateClubRecordSwimmer(s,a),onSuccess:()=>{l(),i({title:"Sauvegardé"})},onError:()=>{i({title:"Mise à jour impossible",variant:"destructive"})}}),V=v({mutationFn:({userId:s,payload:a})=>u.updateClubRecordSwimmerForUser(s,a),onSuccess:()=>{l(),i({title:"Sauvegardé"})},onError:()=>{i({title:"Mise à jour impossible",variant:"destructive"})}}),j=(s,a)=>{if(s.source_type==="user"&&s.user_id){V.mutate({userId:s.user_id,payload:a});return}s.id&&U.mutate({id:s.id,payload:a})},b=v({mutationFn:()=>u.importClubRecords(),onSuccess:s=>{i({title:"Import terminé",description:s?`Performances importées: ${s.imported??0}. Erreurs: ${s.errors??0}.`:""}),l()},onError:()=>{i({title:"Import impossible",variant:"destructive"})}}),z=n.useMemo(()=>[...p].sort((s,a)=>s.source_type!==a.source_type?s.source_type.localeCompare(a.source_type):s.display_name.localeCompare(a.display_name)),[p]);return g?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-display font-bold uppercase italic text-primary",children:"Administration des records"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Gérez les nageurs pris en compte pour les records et lancez l'import FFN."})]}),e.jsx(N,{onClick:()=>b.mutate(),disabled:b.isPending,children:b.isPending?"Import en cours...":"Mettre à jour les records"})]}),e.jsxs(F,{children:[e.jsxs(A,{children:[e.jsx(I,{children:"Ajouter un ancien nageur"}),e.jsx(E,{children:"Ajoutez un nageur sans compte pour l'import des performances FFN."})]}),e.jsxs(T,{className:"grid gap-4 md:grid-cols-[2fr_1fr_1fr_1fr_auto]",children:[e.jsx(m,{placeholder:"Nom du nageur",value:r.display_name,onChange:s=>o(a=>({...a,display_name:s.target.value}))}),e.jsx(m,{placeholder:"IUF",value:r.iuf,onChange:s=>o(a=>({...a,iuf:s.target.value}))}),e.jsxs(R,{value:r.sex,onValueChange:s=>o(a=>({...a,sex:s})),children:[e.jsx(w,{children:e.jsx(B,{placeholder:"Sexe"})}),e.jsx(M,{children:P.map(s=>e.jsx(k,{value:s.value,children:s.label},s.value))})]}),e.jsx(m,{type:"date",value:r.birthdate,onChange:s=>o(a=>({...a,birthdate:s.target.value}))}),e.jsx(N,{onClick:()=>C.mutate(),disabled:!r.display_name.trim()||C.isPending,children:"Ajouter"})]})]}),e.jsxs(F,{children:[e.jsxs(A,{children:[e.jsx(I,{children:"Liste des nageurs suivis"}),e.jsx(E,{children:"Mettre à jour l'IUF, le sexe ou l'activation pour l'import FFN."})]}),e.jsxs(T,{children:[f&&e.jsx("div",{className:"space-y-3",children:[1,2,3,4].map(s=>e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"h-4 w-32 rounded bg-muted animate-pulse motion-reduce:animate-none"}),e.jsx("div",{className:"h-4 w-20 rounded bg-muted animate-pulse motion-reduce:animate-none"}),e.jsx("div",{className:"h-4 w-16 rounded bg-muted animate-pulse motion-reduce:animate-none"}),e.jsx("div",{className:"h-4 w-24 rounded bg-muted animate-pulse motion-reduce:animate-none"})]},s))}),h&&e.jsx("p",{className:"text-sm text-destructive",children:h}),!f&&!h&&p.length===0&&e.jsx("p",{className:"text-sm text-muted-foreground",children:"Aucun nageur disponible."}),!f&&!h&&p.length>0&&e.jsxs(K,{children:[e.jsx(Q,{children:e.jsxs($,{children:[e.jsx(d,{children:"Nageur"}),e.jsx(d,{children:"Source"}),e.jsx(d,{children:"IUF"}),e.jsx(d,{children:"Sexe"}),e.jsx(d,{children:"Naissance"}),e.jsx(d,{children:"Actif"})]})}),e.jsx(X,{children:z.map(s=>{const a=s.id??`user-${s.user_id??"unknown"}`;return e.jsxs($,{children:[e.jsx(c,{className:"font-medium",children:s.display_name}),e.jsx(c,{children:e.jsx(D,{variant:s.source_type==="manual"?"secondary":"outline",children:q(s.source_type)})}),e.jsx(c,{children:e.jsx(m,{defaultValue:s.iuf??"",onBlur:t=>j(s,{iuf:t.target.value.trim()||null})},`${a}-${s.iuf??""}`)}),e.jsx(c,{children:e.jsxs(R,{value:s.sex??"",onValueChange:t=>j(s,{sex:t||null}),children:[e.jsx(w,{children:e.jsx(B,{placeholder:"Sexe"})}),e.jsx(M,{children:P.map(t=>e.jsx(k,{value:t.value,children:t.label},t.value))})]})}),e.jsx(c,{children:e.jsx(m,{type:"date",defaultValue:s.birthdate??"",onBlur:t=>j(s,{birthdate:t.target.value||null})},`${a}-${s.birthdate??""}`)}),e.jsx(c,{children:e.jsx(O,{checked:!!s.is_active,onCheckedChange:t=>j(s,{is_active:t})})})]},a)})})]})]})]})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("h1",{className:"text-3xl font-display font-bold uppercase italic text-primary",children:"Administration des records"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Accès réservé aux coachs."})]})}export{ee as default};
