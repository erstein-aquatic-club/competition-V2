const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-nkJi-Yve.js","assets/vendor-query-DyA9aSKS.js","assets/vendor-react-BzrpNAyj.js","assets/vendor-charts-BrQ8X25f.js","assets/vendor-supabase-DFPLkPj_.js","assets/vendor-motion-lao-Njgm.js","assets/index-BCk1P4Me.css"])))=>i.map(i=>d[i]);
import{c as qe,u as w,r as x,d as I,j as e,f as Ee}from"./vendor-query-DyA9aSKS.js";import{d as Ae,B as L,L as A,v as Ge,_ as He,u as Q,P as Z,w as Oe,I as Qe,s as Je,a as Ue,f as ee}from"./index-nkJi-Yve.js";import{a as g}from"./api-BGfDQhA-.js";import{P as Ye}from"./PageHeader-Ceanton_.js";import{B as T}from"./badge-CWAnASYE.js";import{C as ie,a as ce,b as le}from"./collapsible-CzgRIWmn.js";import{T as Xe,a as Ze,b as W,c as G}from"./tabs-Hh37opwq.js";import{M as Pe,S as es,w as $e,a as Le,G as ss,C as ae,b as ts,c as as}from"./weekTypeColor-a1I18fgC.js";import{T as R}from"./textarea-CEr3xHet.js";import{O as J,a as he}from"./ObjectiveCard-PcRW-tl8.js";import{A as oe}from"./arrow-left-D4T2-jsp.js";import{C as rs}from"./chevron-up-DvnzJjfo.js";import{C as ns}from"./chevron-down-CYDFeumV.js";import{C as H}from"./clock-seXXjoJS.js";import{C as ge}from"./circle-check-CNZh99Uv.js";import{C as de}from"./chevron-right-DZYrmKEV.js";import{T as Be}from"./trophy-CGkiSiqN.js";import{T as is,a as se}from"./toggle-group-Jks0cRtd.js";import{S as fe,a as je,b as be,c as ye,d as te}from"./select-B0NQSh5A.js";import{S as cs,a as ls,b as os,c as ds,d as ms}from"./sheet-DNj1fZ8Q.js";import{A as us,a as xs,b as ps,c as hs,d as gs,e as fs,f as js,g as bs}from"./alert-dialog-Bo6vTQwY.js";import{F as ys,e as Ns,f as vs,p as Ne}from"./objectiveHelpers-DC7i01Ud.js";import{M as ws}from"./map-pin-ByB73ZfT.js";import{S as Ke}from"./sparkles-DQkc5UBN.js";import{E as _s}from"./external-link-CsVac0ww.js";import"./vendor-react-BzrpNAyj.js";import"./vendor-charts-BrQ8X25f.js";import"./vendor-supabase-DFPLkPj_.js";import"./vendor-motion-lao-Njgm.js";import"./swim-DoHgFizT.js";import"./chevron-left-CfYPwfLR.js";import"./index-tNF8ThRK.js";import"./index-CyZHMdNr.js";import"./chart-column-NzSQxgfQ.js";import"./index-CEu8kfNR.js";import"./index-DCX2sNhR.js";import"./index-11zajPhv.js";function z(s){return new Date(s+"T12:00:00").toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric"})}function ve(s){return new Date(s+"T00:00:00").toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit"})}function Cs(s){const t=new Date(s+"T00:00:00");return t.setDate(t.getDate()+6),t.toISOString().split("T")[0]}function Ss(s){const t=new Date;t.setHours(0,0,0,0);const a=new Date(s+"T00:00:00"),l=new Date(s+"T00:00:00");return l.setDate(l.getDate()+6),t>=a&&t<=l}function we(s,t){const a=[],l=new Date(s+"T00:00:00"),d=new Date(t+"T00:00:00"),i=new Date(l),o=i.getDay(),f=o===0?1:o===1?0:8-o;for(i.setDate(i.getDate()+f);i<=d;)a.push(i.toISOString().split("T")[0]),i.setDate(i.getDate()+7);return a}function _e(s,t){const a=new Date(s+"T00:00:00"),l=new Date(t+"T00:00:00");return Math.round((l.getTime()-a.getTime())/(1e3*60*60*24))}function ks({onBack:s,embedded:t=!1}){const{toast:a}=Ae(),l=qe(),{data:d}=w({queryKey:["auth-user"],queryFn:async()=>{const{data:c}=await(await He(async()=>{const{supabase:j}=await import("./index-nkJi-Yve.js").then(q=>q.ai);return{supabase:j}},__vite__mapDeps([0,1,2,3,4,5,6]))).supabase.auth.getUser();return c.user}}),i=d?.app_metadata?.app_user_id,{data:o=[],isLoading:f}=w({queryKey:["my-interviews"],queryFn:()=>g.getMyInterviews()}),{data:y=[]}=w({queryKey:["athlete-objectives"],queryFn:()=>g.getAthleteObjectives()}),{data:F}=w({queryKey:["my-profile-iuf"],queryFn:()=>g.getProfile({userId:i}),enabled:!!i}),_=F?.ffn_iuf??null,v=x.useMemo(()=>{const c=new Date;return c.setDate(c.getDate()-360),c.toISOString().slice(0,10)},[]),{data:S=[]}=w({queryKey:["swimmer-performances-recent",_],queryFn:()=>g.getSwimmerPerformances({iuf:_,fromDate:v}),enabled:!!_}),u=x.useCallback(()=>l.invalidateQueries({queryKey:["my-interviews"]}),[l]),p=I({mutationFn:({id:c,input:j})=>g.updateInterviewAthleteSections(c,j),onSuccess:()=>{a({title:"Sauvegardé"}),u()},onError:c=>a({title:"Erreur",description:c.message,variant:"destructive"})}),r=I({mutationFn:c=>g.submitInterviewToCoach(c),onSuccess:()=>{a({title:"Envoyé au coach"}),u()},onError:c=>a({title:"Erreur",description:c.message,variant:"destructive"})}),m=I({mutationFn:c=>g.signInterview(c),onSuccess:()=>{a({title:"Entretien signé"}),u()},onError:c=>a({title:"Erreur",description:c.message,variant:"destructive"})});return e.jsxs("div",{className:"space-y-6 pb-24",children:[!t&&e.jsxs("div",{className:"space-y-1",children:[e.jsxs(L,{variant:"ghost",size:"sm",className:"-ml-2",onClick:s,children:[e.jsx(oe,{className:"mr-1.5 h-4 w-4"}),"Retour"]}),e.jsx("h2",{className:"text-2xl font-display font-semibold uppercase italic text-primary",children:"Mes entretiens"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Entretiens individuels avec le coach"})]}),f&&e.jsx("div",{className:"space-y-3",children:[1,2,3].map(c=>e.jsx("div",{className:"rounded-xl border p-4 animate-pulse motion-reduce:animate-none",children:e.jsx("div",{className:"h-4 w-40 rounded bg-muted"})},c))}),!f&&o.length===0&&e.jsxs("div",{className:"text-center py-12 space-y-3",children:[e.jsx(Pe,{className:"h-10 w-10 text-muted-foreground mx-auto"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Aucun entretien en cours. Votre coach initiera les entretiens."})]}),!f&&o.map(c=>e.jsx(Ts,{interview:c,objectives:y,performances:S,appUserId:i??null,onSave:(j,q)=>p.mutate({id:j,input:q}),onSubmit:j=>{window.confirm("Envoyer votre préparation au coach ? Vous ne pourrez plus la modifier.")&&r.mutate(j)},onSign:j=>{window.confirm("Confirmer la signature de cet entretien ?")&&m.mutate(j)},isSaving:p.isPending,isSubmitting:r.isPending,isSigning:m.isPending},c.id))]})}function Ts({interview:s,objectives:t,performances:a,appUserId:l,onSave:d,onSubmit:i,onSign:o,isSaving:f,isSubmitting:y,isSigning:F}){const _=s.status==="draft_athlete",v=s.status==="draft_coach",S=s.status==="sent",u=s.status==="signed",[p,r]=x.useState(!1),[m,c]=x.useState(s.athlete_successes??""),[j,q]=x.useState(s.athlete_difficulties??""),[D,O]=x.useState(s.athlete_goals??""),[k,P]=x.useState(s.athlete_commitments??""),[C,$]=x.useState(s.athlete_commitment_review??""),{data:h}=w({queryKey:["my-previous-interview",s.date,s.id],queryFn:()=>l?g.getPreviousInterview(l,s.date,s.id):null,enabled:(_||S||u||v)&&!!l}),N=x.useRef(!1),M=x.useCallback(()=>{N.current||!_||(N.current=!0,d(s.id,{athlete_successes:m||null,athlete_difficulties:j||null,athlete_goals:D||null,athlete_commitments:k||null,athlete_commitment_review:C||null}),setTimeout(()=>{N.current=!1},500))},[s.id,m,j,D,k,C,d,_]),E=_?e.jsxs(T,{className:"bg-amber-100 text-amber-800 dark:bg-amber-900/30 dark:text-amber-400 border-amber-300 dark:border-amber-700",children:[e.jsx(H,{className:"h-3 w-3 mr-1"}),"À préparer"]}):v?e.jsxs(T,{className:"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400 border-blue-300 dark:border-blue-700",children:[e.jsx(H,{className:"h-3 w-3 mr-1"}),"En préparation"]}):S?e.jsxs(T,{className:"bg-emerald-100 text-emerald-800 dark:bg-emerald-900/30 dark:text-emerald-400 border-emerald-300 dark:border-emerald-700",children:[e.jsx(ge,{className:"h-3 w-3 mr-1"}),"À signer"]}):e.jsx(T,{variant:"secondary",children:"Signé"}),B=_?"border-amber-300 dark:border-amber-700 border-l-4":v?"border-blue-300 dark:border-blue-700 border-l-4":S?"border-emerald-300 dark:border-emerald-700 border-l-4":"";return e.jsxs("div",{className:`rounded-xl border bg-card shadow-sm ${B}`,children:[e.jsxs("button",{type:"button",className:"w-full flex items-center justify-between p-4 text-left",onClick:()=>r(b=>!b),children:[e.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[e.jsx("span",{className:"text-sm font-semibold",children:z(s.date)}),E,u&&s.signed_at&&e.jsxs("span",{className:"text-xs text-muted-foreground",children:["le ",z(s.signed_at.slice(0,10))]})]}),p?e.jsx(rs,{className:"h-4 w-4 text-muted-foreground shrink-0"}):e.jsx(ns,{className:"h-4 w-4 text-muted-foreground shrink-0"})]}),p&&e.jsxs("div",{className:"px-4 pb-4 space-y-4",children:[_&&e.jsxs(e.Fragment,{children:[h&&(h.athlete_commitments||h.coach_actions)&&e.jsxs("div",{className:"rounded-xl border bg-muted/30 p-3 space-y-2",children:[e.jsx("p",{className:"text-xs font-bold uppercase tracking-widest text-muted-foreground",children:"Bilan des engagements précédents"}),h.athlete_commitments&&e.jsxs("div",{className:"border-l-4 border-blue-400 rounded-r-lg bg-blue-50/50 dark:bg-blue-950/20 p-2 space-y-0.5",children:[e.jsx("p",{className:"text-[10px] font-semibold text-muted-foreground",children:"Mes engagements"}),e.jsx("p",{className:"text-xs whitespace-pre-wrap",children:h.athlete_commitments})]}),h.coach_actions&&e.jsxs("div",{className:"border-l-4 border-amber-400 rounded-r-lg bg-amber-50/50 dark:bg-amber-950/20 p-2 space-y-0.5",children:[e.jsx("p",{className:"text-[10px] font-semibold text-muted-foreground",children:"Actions du coach"}),e.jsx("p",{className:"text-xs whitespace-pre-wrap",children:h.coach_actions})]}),e.jsxs("div",{className:"space-y-1 pt-1",children:[e.jsx(A,{htmlFor:`commitment-review-${s.id}`,className:"text-xs",children:"Comment avez-vous tenu vos engagements ?"}),e.jsx(R,{id:`commitment-review-${s.id}`,placeholder:"Mon bilan sur les engagements pris...",value:C,onChange:b=>$(b.target.value),onBlur:M,rows:3})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{htmlFor:`successes-${s.id}`,children:"Mes réussites"}),e.jsx(R,{id:`successes-${s.id}`,placeholder:"Ce dont je suis fier/fière cette saison...",value:m,onChange:b=>c(b.target.value),onBlur:M,rows:3})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{htmlFor:`difficulties-${s.id}`,children:"Mes difficultés"}),e.jsx(R,{id:`difficulties-${s.id}`,placeholder:"Les points que je souhaite améliorer...",value:j,onChange:b=>q(b.target.value),onBlur:M,rows:3})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{children:"Mes objectifs"}),t.length>0&&e.jsx("div",{className:"space-y-1.5",children:t.map(b=>e.jsx(J,{objective:b,performances:a,compact:!0},b.id))}),e.jsx(R,{id:`goals-${s.id}`,placeholder:"Objectifs supplémentaires ou commentaires...",value:D,onChange:b=>O(b.target.value),onBlur:M,rows:3})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{htmlFor:`commitments-${s.id}`,children:"Mes engagements"}),e.jsx(R,{id:`commitments-${s.id}`,placeholder:"Ce que je m'engage à faire...",value:k,onChange:b=>P(b.target.value),onBlur:M,rows:3})]}),f&&e.jsx("p",{className:"text-xs text-muted-foreground animate-pulse",children:"Sauvegarde..."}),e.jsxs(L,{className:"w-full gap-2",onClick:()=>i(s.id),disabled:y,children:[e.jsx(es,{className:"h-4 w-4"}),y?"Envoi...":"Envoyer au coach"]})]}),v&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"rounded-xl border border-dashed border-blue-300 dark:border-blue-700 bg-blue-50/50 dark:bg-blue-950/20 p-6 text-center space-y-2",children:[e.jsx(H,{className:"h-8 w-8 mx-auto text-blue-500"}),e.jsx("p",{className:"text-sm font-medium",children:"Entretien envoyé au coach"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Votre coach prépare l'entretien. Vous recevrez le compte-rendu complet après l'entretien en présentiel."}),s.submitted_at&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Envoyé le ",z(s.submitted_at.slice(0,10))]})]}),h&&(h.athlete_commitments||h.coach_actions)&&e.jsx(Ce,{prevInterview:h,commitmentReview:s.athlete_commitment_review}),l&&e.jsxs(e.Fragment,{children:[e.jsx(V,{label:"Planification"}),e.jsx(Se,{athleteId:l,interviewDate:s.date})]})]}),(S||u)&&e.jsxs(e.Fragment,{children:[h&&(h.athlete_commitments||h.coach_actions)&&e.jsx(Ce,{prevInterview:h,commitmentReview:s.athlete_commitment_review}),e.jsx(ke,{label:"Réussites",athleteText:s.athlete_successes,coachText:s.coach_comment_successes||s.coach_review}),e.jsx(ke,{label:"Difficultés",athleteText:s.athlete_difficulties,coachText:s.coach_comment_difficulties}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{label:"Objectifs"}),t.length>0&&e.jsx("div",{className:"space-y-1.5",children:t.map(b=>e.jsx(J,{objective:b,performances:a,compact:!0},b.id))}),e.jsx(re,{text:s.athlete_goals}),e.jsx(ne,{text:s.coach_comment_goals||s.coach_objectives})]}),l&&e.jsxs(e.Fragment,{children:[e.jsx(V,{label:"Planification"}),e.jsx(Se,{athleteId:l,interviewDate:s.date})]}),e.jsxs("div",{className:"rounded-xl bg-card border shadow-sm p-3 space-y-2",children:[e.jsx(V,{label:"Engagements & Actions"}),e.jsx(re,{text:s.athlete_commitments,label:"Mes engagements"}),e.jsx(ne,{text:s.coach_actions,label:"Actions du coach"})]}),S&&e.jsxs(L,{className:"w-full gap-2",onClick:()=>o(s.id),disabled:F,children:[e.jsx(ge,{className:"h-4 w-4"}),F?"Signature...":"Signer l'entretien"]})]})]})]})}function Ce({prevInterview:s,commitmentReview:t}){const[a,l]=x.useState(!1);return e.jsxs(ie,{open:a,onOpenChange:l,children:[e.jsx(ce,{asChild:!0,children:e.jsxs("button",{type:"button",className:"w-full flex items-center gap-2 rounded-xl border bg-muted/30 px-3 py-2.5 text-left transition-colors hover:bg-muted/50",children:[e.jsx(de,{className:`h-3.5 w-3.5 text-muted-foreground shrink-0 transition-transform ${a?"rotate-90":""}`}),e.jsx("span",{className:"text-xs font-bold uppercase tracking-widest text-muted-foreground",children:"Rappel engagements précédents"}),e.jsx(T,{variant:"secondary",className:"text-[10px] px-1.5 py-0 ml-auto",children:z(s.date)})]})}),e.jsx(le,{children:e.jsxs("div",{className:"rounded-b-xl border border-t-0 bg-muted/30 px-3 pb-3 space-y-2",children:[s.athlete_commitments&&e.jsxs("div",{className:"border-l-4 border-blue-400 rounded-r-lg bg-blue-50/50 dark:bg-blue-950/20 p-2",children:[e.jsx("p",{className:"text-[10px] font-semibold text-muted-foreground",children:"Mes engagements"}),e.jsx("p",{className:"text-xs whitespace-pre-wrap",children:s.athlete_commitments})]}),s.coach_actions&&e.jsxs("div",{className:"border-l-4 border-amber-400 rounded-r-lg bg-amber-50/50 dark:bg-amber-950/20 p-2",children:[e.jsx("p",{className:"text-[10px] font-semibold text-muted-foreground",children:"Actions du coach"}),e.jsx("p",{className:"text-xs whitespace-pre-wrap",children:s.coach_actions})]}),t&&e.jsxs("div",{className:"border-l-4 border-blue-400 rounded-r-lg bg-blue-50/80 dark:bg-blue-950/30 p-2",children:[e.jsx("p",{className:"text-[10px] font-semibold text-muted-foreground",children:"Mon bilan"}),e.jsx("p",{className:"text-xs whitespace-pre-wrap",children:t})]})]})})]})}function Se({athleteId:s,interviewDate:t}){const{data:a=[]}=w({queryKey:["competitions"],queryFn:()=>g.getCompetitions()}),{data:l=[]}=w({queryKey:["my-competition-ids",s],queryFn:()=>g.getMyCompetitionIds(s)}),d=x.useMemo(()=>{const u=new Set(l);return a.filter(r=>u.has(r.id)&&r.date>=t).sort((r,m)=>r.date.localeCompare(m.date))[0]??null},[a,l,t]),{data:i=[]}=w({queryKey:["training-cycles","athlete",s],queryFn:()=>g.getTrainingCycles({athleteId:s})}),o=x.useMemo(()=>{const u=new Set(l);return a.filter(p=>u.has(p.id)&&p.date>=t).sort((p,r)=>p.date.localeCompare(r.date))},[a,l,t]),f=x.useMemo(()=>{const u=new Map;return i.slice().sort((p,r)=>(p.end_competition_date??"").localeCompare(r.end_competition_date??"")).forEach(p=>{p.end_competition_id&&!u.has(p.end_competition_id)&&u.set(p.end_competition_id,p)}),u},[i]),y=x.useMemo(()=>{const u=new Set;return o.map(p=>f.get(p.id)??null).filter(p=>!p||u.has(p.id)?!1:(u.add(p.id),!0))},[o,f]),F=Ee({queries:y.map(u=>({queryKey:["training-weeks",u.id],queryFn:()=>g.getTrainingWeeks(u.id),enabled:!!u.id}))}),_=x.useMemo(()=>{const u=new Map;return y.forEach((p,r)=>{u.set(p.id,F[r]?.data??[])}),u},[y,F]),v=x.useMemo(()=>new Date().toISOString().split("T")[0],[]),S=d?_e(v,d.date):null;return d?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"rounded-xl border bg-muted/20 p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm flex-wrap",children:[e.jsx(Be,{className:"h-4 w-4 text-amber-500 shrink-0"}),e.jsxs("span",{className:"font-medium",children:[o.length," échéance",o.length>1?"s":""," visible",o.length>1?"s":""]}),e.jsxs(T,{variant:"secondary",className:"text-[10px]",children:["prochaine J-",S]})]}),e.jsx("p",{className:"mt-1 text-xs text-muted-foreground",children:"Vision multi-macrocycles depuis l'entretien, jusqu'aux prochaines compétitions assignées."})]}),e.jsx("div",{className:"space-y-3",children:o.map((u,p)=>{const r=f.get(u.id)??null,m=r?.start_date??r?.start_competition_date??t,c=m>t?m:t,j=r?we(c,u.date):[],q=r?we(m,u.date):[],D=Math.max(q.length-j.length,0),O=_e(v,u.date),k=r?_.get(r.id)??[]:[],P=new Map(k.map(C=>[C.week_start,C]));return e.jsxs("div",{className:"rounded-xl border bg-card shadow-sm overflow-hidden",children:[e.jsxs("div",{className:"border-b border-border bg-muted/20 px-3 py-2.5",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"text-sm font-semibold",children:u.name}),p===0&&e.jsx(T,{className:"text-[10px] bg-primary/10 text-primary border-primary/20",children:"Prochaine"}),e.jsx(T,{variant:"secondary",className:"text-[10px]",children:z(u.date)}),e.jsxs(T,{variant:"outline",className:"text-[10px]",children:["J-",O]})]}),r?e.jsxs("div",{className:"mt-1 flex items-center gap-2 flex-wrap text-xs text-muted-foreground",children:[e.jsx("span",{className:"font-medium text-foreground",children:r.name}),r.start_competition_name&&e.jsxs("span",{children:["depuis ",r.start_competition_name]}),e.jsxs("span",{children:[q.length," sem."]}),D>0&&e.jsxs("span",{children:[D," déjà écoulée",D>1?"s":""]})]}):e.jsx("p",{className:"mt-1 text-xs text-muted-foreground",children:"Aucun macrocycle créé pour cette échéance."})]}),r?j.length===0?e.jsx("div",{className:"px-3 py-3 text-xs text-muted-foreground italic",children:"Aucune semaine future à afficher sur ce macrocycle."}):e.jsx("div",{className:"px-3 py-3",children:e.jsx("div",{className:"relative ml-2 border-l-2 border-border pl-3 space-y-1.5",children:j.map((C,$)=>{const h=P.get(C),N=Ss(C),M=Cs(C);return e.jsxs("div",{className:`rounded-lg border bg-card px-2.5 py-2 text-xs ${N?"ring-2 ring-primary bg-primary/5":""}`,children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:`h-2 w-2 rounded-full shrink-0 ${N?"bg-primary":h?.week_type?"bg-muted-foreground/40":"bg-muted-foreground/20"}`}),e.jsxs("span",{className:"text-muted-foreground whitespace-nowrap",children:["Sem. ",D+$+1]}),e.jsxs("span",{className:"text-muted-foreground/70 whitespace-nowrap",children:[ve(C)," - ",ve(M)]}),h?.week_type&&e.jsx(T,{className:"text-[10px] px-1.5 py-0 border-0 ml-auto",style:{backgroundColor:Le(h.week_type),color:$e(h.week_type)},children:h.week_type})]}),h?.notes&&e.jsx("p",{className:"mt-1 pl-4 text-[11px] text-muted-foreground line-clamp-2",children:h.notes})]},C)})})}):e.jsx("div",{className:"px-3 py-3 text-xs text-muted-foreground italic",children:"La compétition reste visible pour garder la projection long terme, même sans planification détaillée."})]},u.id)})})]}):e.jsx("p",{className:"text-xs text-muted-foreground italic text-center py-2",children:"Aucune compétition assignée à venir."})}function ke({label:s,athleteText:t,coachText:a}){return e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{label:s}),e.jsx(re,{text:t}),e.jsx(ne,{text:a})]})}function V({label:s}){return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-px flex-1 bg-border"}),e.jsx("span",{className:"text-xs font-bold uppercase tracking-widest text-muted-foreground",children:s}),e.jsx("div",{className:"h-px flex-1 bg-border"})]})}function re({text:s,label:t}){return e.jsxs("div",{className:"border-l-4 border-blue-400 rounded-r-lg bg-blue-50/50 dark:bg-blue-950/20 p-2.5 space-y-0.5",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(Ge,{className:"h-3 w-3 text-blue-500"}),e.jsx("p",{className:"text-[10px] font-bold uppercase tracking-widest text-muted-foreground",children:t??"Nageur"})]}),e.jsx("p",{className:"text-sm whitespace-pre-wrap",children:s?.trim()||e.jsx("span",{className:"italic text-muted-foreground",children:"Non renseigné"})})]})}function ne({text:s,label:t}){return s?.trim()?e.jsxs("div",{className:"border-l-4 border-amber-400 rounded-r-lg bg-amber-50/50 dark:bg-amber-950/20 p-2.5 space-y-0.5",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(ss,{className:"h-3 w-3 text-amber-500"}),e.jsx("p",{className:"text-[10px] font-bold uppercase tracking-widest text-muted-foreground",children:t??"Coach"})]}),e.jsx("p",{className:"text-sm whitespace-pre-wrap",children:s})]}):null}function Te({onBack:s,embedded:t=!1}){const{toast:a}=Ae(),l=qe(),[d,i]=x.useState(!1),[o,f]=x.useState(null),[y,F]=x.useState(null),{data:_}=w({queryKey:["auth-user"],queryFn:async()=>{const{data:n}=await Je.auth.getUser();return n.user}}),v=_?.id??null,{data:S=[],isLoading:u}=w({queryKey:["athlete-objectives"],queryFn:()=>g.getAthleteObjectives(),enabled:!!v,refetchInterval:3e4}),p=Q(n=>n.userId),r=Q(n=>n.user),{data:m}=w({queryKey:["my-profile"],queryFn:()=>g.getProfile({displayName:r,userId:p}),enabled:!!p}),c=m?.ffn_iuf??null,j=x.useMemo(()=>{const n=new Date;return n.setDate(n.getDate()-360),n.toISOString().slice(0,10)},[]),{data:q=[]}=w({queryKey:["swimmer-performances-recent",c],queryFn:()=>g.getSwimmerPerformances({iuf:c,fromDate:j}),enabled:!!c}),D=x.useMemo(()=>S.filter(n=>n.created_by!==v),[S,v]),O=x.useMemo(()=>S.filter(n=>n.created_by===v),[S,v]),[k,P]=x.useState("chrono"),[C,$]=x.useState(""),[h,N]=x.useState("25"),[M,E]=x.useState(""),[B,b]=x.useState(""),Re=()=>{P("chrono"),$(""),N("25"),E(""),b("")},U=()=>{f(null),Re(),i(!0)},Ie=n=>{f(n);const We=!!n.event_code,pe=!!n.text;P(We&&pe?"both":pe?"texte":"chrono"),$(n.event_code??""),N(String(n.pool_length??25)),E(n.target_time_seconds!=null?vs(n.target_time_seconds):""),b(n.text??""),i(!0)},Y=()=>l.invalidateQueries({queryKey:["athlete-objectives"]}),me=I({mutationFn:n=>g.createObjective(n),onSuccess:()=>{a({title:"Objectif créé"}),Y(),i(!1)},onError:n=>a({title:"Erreur",description:n.message,variant:"destructive"})}),ue=I({mutationFn:n=>g.updateObjective(o.id,n),onSuccess:()=>{a({title:"Objectif mis à jour"}),Y(),i(!1)},onError:n=>a({title:"Erreur",description:n.message,variant:"destructive"})}),Ve=I({mutationFn:n=>g.deleteObjective(n),onSuccess:()=>{a({title:"Objectif supprimé"}),Y(),F(null)},onError:n=>a({title:"Erreur",description:n.message,variant:"destructive"})}),K=k==="chrono"||k==="both",X=k==="texte"||k==="both",xe=me.isPending||ue.isPending,ze=()=>{if(K&&!C){a({title:"Épreuve requise",variant:"destructive"});return}if(K&&M&&Ne(M)===null){a({title:"Format invalide",description:"Format : m:ss:cc (ex: 1:05:30)",variant:"destructive"});return}if(X&&!B.trim()){a({title:"Texte requis",variant:"destructive"});return}if(!v)return;const n={athlete_id:v,event_code:K?C:null,pool_length:K?Number(h):null,target_time_seconds:K&&M?Ne(M):null,text:X?B.trim():null};o?ue.mutate(n):me.mutate(n)};return e.jsxs("div",{className:t?"space-y-3":"space-y-6 pb-24",children:[t?e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-[10px] font-black uppercase tracking-[0.2em] text-muted-foreground/70",children:"Objectifs"}),e.jsxs(L,{variant:"ghost",size:"sm",className:"h-7 px-2 text-xs",onClick:U,children:[e.jsx(Z,{className:"mr-1 h-3 w-3"}),"Ajouter"]})]}):e.jsxs("div",{className:"space-y-1",children:[e.jsxs(L,{variant:"ghost",size:"sm",className:"-ml-2",onClick:s,children:[e.jsx(oe,{className:"mr-1.5 h-4 w-4"}),"Retour"]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-display font-semibold uppercase italic text-primary",children:"Mon plan"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Mes objectifs d'entraînement"})]}),e.jsxs(L,{variant:"outline",size:"sm",onClick:U,children:[e.jsx(Z,{className:"mr-1.5 h-3.5 w-3.5"}),"Ajouter"]})]})]}),u&&e.jsx("div",{className:"space-y-1.5",children:[1,2].map(n=>e.jsx("div",{className:"rounded-lg border p-2.5 animate-pulse motion-reduce:animate-none",children:e.jsx("div",{className:"h-3.5 w-36 rounded bg-muted"})},n))}),!u&&S.length===0&&e.jsxs("div",{className:"text-center py-8 space-y-2",children:[e.jsx(Oe,{className:"h-8 w-8 text-muted-foreground/40 mx-auto"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Aucun objectif pour le moment."}),e.jsxs(L,{variant:"ghost",size:"sm",className:"text-xs h-7",onClick:U,children:[e.jsx(Z,{className:"mr-1 h-3 w-3"}),"Ajouter"]})]}),D.length>0&&e.jsxs("div",{className:"space-y-2",children:[!t&&e.jsx("h3",{className:"text-[10px] font-semibold uppercase tracking-[0.15em] text-muted-foreground",children:"Objectifs du coach"}),e.jsx(he,{children:D.map(n=>e.jsx(J,{objective:n,performances:q,showCoachBadge:!0},n.id))})]}),O.length>0&&e.jsxs("div",{className:"space-y-2",children:[!t&&e.jsx("h3",{className:"text-[10px] font-semibold uppercase tracking-[0.15em] text-muted-foreground",children:"Mes objectifs personnels"}),e.jsx(he,{children:O.map(n=>e.jsx(J,{objective:n,performances:q,onClick:()=>Ie(n)},n.id))})]}),e.jsx(cs,{open:d,onOpenChange:i,children:e.jsxs(ls,{side:"bottom",className:"max-h-[85vh] overflow-y-auto",children:[e.jsxs(os,{children:[e.jsx(ds,{children:o?"Modifier l'objectif":"Nouvel objectif"}),e.jsx(ms,{children:o?"Modifiez votre objectif personnel.":"Ajoutez un objectif personnel."})]}),e.jsxs("div",{className:"mt-4 space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{children:"Type d'objectif"}),e.jsxs(is,{type:"single",variant:"outline",value:k,onValueChange:n=>{n&&P(n)},className:"justify-start",children:[e.jsx(se,{value:"chrono",className:"text-xs",children:"Chrono"}),e.jsx(se,{value:"texte",className:"text-xs",children:"Texte"}),e.jsx(se,{value:"both",className:"text-xs",children:"Les deux"})]})]}),K&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{children:"Épreuve *"}),e.jsxs(fe,{value:C,onValueChange:$,children:[e.jsx(je,{children:e.jsx(be,{placeholder:"Choisir une épreuve"})}),e.jsx(ye,{children:ys.map(n=>e.jsx(te,{value:n,children:Ns(n)},n))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{children:"Bassin"}),e.jsxs(fe,{value:h,onValueChange:N,children:[e.jsx(je,{children:e.jsx(be,{})}),e.jsxs(ye,{children:[e.jsx(te,{value:"25",children:"25m"}),e.jsx(te,{value:"50",children:"50m"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{children:"Temps cible (min:sec:centièmes)"}),e.jsx(Qe,{placeholder:"Ex : 1:05:30",value:M,onChange:n=>E(n.target.value)})]})]}),X&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{children:"Objectif texte *"}),e.jsx(R,{placeholder:"Ex : Améliorer la coulée de dos",value:B,onChange:n=>b(n.target.value),rows:3})]}),e.jsx(L,{className:"w-full",onClick:ze,disabled:xe,children:xe?"Enregistrement...":o?"Enregistrer":"Créer"})]})]})}),e.jsx(us,{open:!!y,onOpenChange:n=>{n||F(null)},children:e.jsxs(xs,{children:[e.jsxs(ps,{children:[e.jsx(hs,{children:"Supprimer l'objectif"}),e.jsx(gs,{children:"Cette action est irréversible. L'objectif sera supprimé définitivement."})]}),e.jsxs(fs,{children:[e.jsx(js,{children:"Annuler"}),e.jsx(bs,{onClick:()=>{y&&Ve.mutate(y.id)},className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Supprimer"})]})]})})]})}function Ds(s){return new Date(s+"T12:00:00").toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric"})}function De(s){return new Date(s+"T00:00:00").toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit"})}function Ms(s){const t=new Date(s+"T00:00:00");return t.setDate(t.getDate()+6),t.toISOString().split("T")[0]}function Fs(s){const t=new Date;t.setHours(0,0,0,0);const a=new Date(s+"T00:00:00"),l=new Date(s+"T00:00:00");return l.setDate(l.getDate()+6),t>=a&&t<=l}function Me(s,t){const a=[],l=new Date(s+"T00:00:00"),d=new Date(t+"T00:00:00"),i=new Date(l),o=i.getDay(),f=o===0?1:o===1?0:8-o;for(i.setDate(i.getDate()+f);i<=d;)a.push(i.toISOString().split("T")[0]),i.setDate(i.getDate()+7);return a}function Fe(s,t){const a=new Date(s+"T00:00:00"),l=new Date(t+"T00:00:00");return Math.round((l.getTime()-a.getTime())/(1e3*60*60*24))}const qs=["Lundi","Mardi","Mercredi","Jeudi","Vendredi","Samedi","Dimanche"];function Es(s){const t=s.toLowerCase();return t.includes("piscine")||t.includes("bassin")||t.includes("natation")||t.includes("nage")}function As(s,t){const a=o=>{const[f,y]=o.split(":").map(Number);return f*60+y},l=a(t)-a(s),d=Math.floor(l/60),i=l%60;return d===0?`${i}min`:i===0?`${d}h`:`${d}h${String(i).padStart(2,"0")}`}function Os({athleteId:s}){const{data:t=[],isLoading:a}=w({queryKey:["swimmer-slots",s],queryFn:()=>g.getSwimmerSlots(s),enabled:!!s}),l=x.useMemo(()=>{const d=new Map;for(const i of t){const o=d.get(i.day_of_week)??[];o.push(i),d.set(i.day_of_week,o)}return d},[t]);return a?e.jsx("div",{className:"space-y-2",children:[1,2,3].map(d=>e.jsx("div",{className:"h-12 rounded-xl border animate-pulse bg-muted/30"},d))}):t.length===0?e.jsx("div",{className:"rounded-xl border border-dashed bg-muted/20 py-6 text-center",children:e.jsx("p",{className:"text-xs text-muted-foreground",children:"Aucun créneau personnalisé."})}):e.jsx("div",{className:"space-y-1.5",children:[1,2,3,4,5,6,7].map(d=>{const i=l.get(d);return!i||i.length===0?null:e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-[10px] font-semibold uppercase tracking-wider text-muted-foreground px-0.5",children:qs[d-1]}),i.map(o=>{const f=Es(o.location);return e.jsxs("div",{className:"flex rounded-xl border bg-card overflow-hidden",children:[e.jsx("div",{className:`w-1 shrink-0 ${f?"bg-blue-500":"bg-amber-400"}`}),e.jsxs("div",{className:"flex-1 px-3 py-2 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-sm font-bold tabular-nums",children:[o.start_time.slice(0,5)," – ",o.end_time.slice(0,5)]}),e.jsx("span",{className:`text-xs tabular-nums px-1.5 py-0.5 rounded-md font-medium ${f?"bg-blue-500/10 text-blue-600 dark:text-blue-400":"bg-amber-400/10 text-amber-600 dark:text-amber-400"}`,children:As(o.start_time,o.end_time)})]}),e.jsxs("div",{className:"flex items-center gap-1.5 mt-0.5",children:[e.jsx(ws,{className:"h-3 w-3 text-muted-foreground shrink-0"}),e.jsx("span",{className:"text-xs text-muted-foreground truncate",children:o.location})]})]})]},o.id)})]},d)})})}function Ps({athleteId:s}){const[,t]=Ue(),a=x.useMemo(()=>new Date().toISOString().split("T")[0],[]),[l,d]=x.useState([]),{data:i=[]}=w({queryKey:["competitions"],queryFn:()=>g.getCompetitions()}),{data:o=[]}=w({queryKey:["my-competition-ids",s],queryFn:()=>g.getMyCompetitionIds(s)}),{data:f=[]}=w({queryKey:["training-cycles","athlete",s],queryFn:()=>g.getTrainingCycles({athleteId:s})}),y=x.useMemo(()=>{const r=new Set(o);return i.filter(m=>r.has(m.id)&&m.date>=a).sort((m,c)=>m.date.localeCompare(c.date))},[o,i,a]),F=x.useMemo(()=>{const r=new Map;return f.slice().sort((m,c)=>(m.end_competition_date??"").localeCompare(c.end_competition_date??"")).forEach(m=>{m.end_competition_id&&!r.has(m.end_competition_id)&&r.set(m.end_competition_id,m)}),r},[f]),_=x.useMemo(()=>{const r=new Set;return y.map(m=>F.get(m.id)??null).filter(m=>!m||r.has(m.id)?!1:(r.add(m.id),!0))},[F,y]),v=Ee({queries:_.map(r=>({queryKey:["training-weeks",r.id],queryFn:()=>g.getTrainingWeeks(r.id),enabled:!!r.id}))}),S=x.useMemo(()=>{const r=new Map;return _.forEach((m,c)=>{r.set(m.id,v[c]?.data??[])}),r},[_,v]),u=y[0]??null,p=r=>{d(m=>m.includes(r)?m.filter(c=>c!==r):[...m,r])};return y.length===0?e.jsxs("div",{className:"rounded-3xl border border-dashed bg-card/70 px-4 py-8 text-center",children:[e.jsx(ae,{className:"mx-auto h-10 w-10 text-muted-foreground/60"}),e.jsx("p",{className:"mt-3 text-sm font-medium",children:"Aucune échéance à venir."}),e.jsx("p",{className:"mt-1 text-xs text-muted-foreground",children:"Ton plan apparaîtra ici."})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"rounded-3xl border bg-gradient-to-br from-primary/[0.08] via-background to-amber-500/[0.08] p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx(Ke,{className:"h-4 w-4 text-primary"}),e.jsxs("span",{className:"text-sm font-semibold",children:[y.length," échéance",y.length>1?"s":""]}),u&&e.jsxs(T,{variant:"secondary",className:"text-[10px] px-2 py-0.5",children:["cap J-",Fe(a,u.date)]})]}),e.jsx("p",{className:"mt-2 text-xs text-muted-foreground",children:"Vue de tes prochains cycles."})]}),e.jsx("div",{className:"space-y-3",children:y.map((r,m)=>{const c=F.get(r.id)??null,j=c?.start_date??c?.start_competition_date??a,q=j>a?j:a,D=c?Me(q,r.date):[],O=c?Me(j,r.date):[],k=Math.max(O.length-D.length,0),P=c?S.get(c.id)??[]:[],C=new Map(P.map(N=>[N.week_start,N])),$=Fe(a,r.date),h=l.includes(r.id);return e.jsx(ie,{open:h,onOpenChange:()=>p(r.id),children:e.jsxs("section",{className:"overflow-hidden rounded-3xl border bg-card shadow-sm",children:[e.jsx(ce,{asChild:!0,children:e.jsx("button",{type:"button",className:"w-full border-b border-border bg-muted/20 px-4 py-3 text-left transition-colors hover:bg-muted/30",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(de,{className:`mt-0.5 h-4 w-4 shrink-0 text-muted-foreground transition-transform ${h?"rotate-90":""}`}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"text-sm font-semibold",children:r.name}),m===0&&e.jsx(T,{className:"border-primary/20 bg-primary/10 text-[10px] text-primary",children:"Priorité"}),e.jsx(T,{variant:"secondary",className:"text-[10px]",children:Ds(r.date)}),e.jsxs(T,{variant:"outline",className:"text-[10px]",children:["J-",$]}),e.jsx("button",{type:"button",className:"ml-auto shrink-0 rounded-lg p-1 text-muted-foreground hover:text-foreground hover:bg-muted transition",onClick:N=>{N.stopPropagation(),t(`/competition/${r.id}`)},"aria-label":"Voir la compétition",children:e.jsx(_s,{className:"h-3.5 w-3.5"})})]}),c?e.jsxs("div",{className:"mt-1 flex items-center gap-2 flex-wrap text-xs text-muted-foreground",children:[e.jsx("span",{className:"font-medium text-foreground",children:c.name}),e.jsxs("span",{children:[O.length," sem."]}),k>0&&e.jsxs("span",{children:[k," sem. passée",k>1?"s":""]})]}):e.jsx("p",{className:"mt-1 text-xs text-muted-foreground",children:"Pas de cycle détaillé."})]})]})})}),e.jsx(le,{children:c?D.length===0?e.jsx("div",{className:"px-4 py-4 text-xs text-muted-foreground italic",children:"Pas de semaine à venir."}):e.jsx("div",{className:"px-4 py-4",children:e.jsx("div",{className:"relative ml-2 space-y-2 border-l-2 border-border pl-4",children:D.map((N,M)=>{const E=C.get(N),B=Fs(N),b=Ms(N);return e.jsxs("div",{className:`rounded-2xl border bg-card px-3 py-2 text-xs ${B?"ring-2 ring-primary/40 bg-primary/[0.04]":""}`,children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:`h-2 w-2 rounded-full shrink-0 ${B?"bg-primary":E?.week_type?"bg-muted-foreground/40":"bg-muted-foreground/20"}`}),e.jsxs("span",{className:"whitespace-nowrap text-muted-foreground",children:["Sem. ",k+M+1]}),e.jsxs("span",{className:"whitespace-nowrap text-muted-foreground/70",children:[De(N)," - ",De(b)]}),E?.week_type&&e.jsx(T,{className:"ml-auto border-0 px-1.5 py-0 text-[10px]",style:{backgroundColor:Le(E.week_type),color:$e(E.week_type)},children:E.week_type})]}),E?.notes&&e.jsx("p",{className:"mt-1 pl-4 text-[11px] text-muted-foreground line-clamp-2",children:E.notes})]},N)})})}):e.jsx("div",{className:"px-4 py-4 text-xs text-muted-foreground italic",children:"L'échéance reste affichée."})})]})},r.id)})})]})}function $s({athleteId:s,athleteName:t,groupLabel:a,onBack:l,standalone:d,defaultTab:i}){return e.jsxs("div",{className:`mx-auto max-w-4xl pb-24 ${d?"space-y-3":"space-y-4"}`,children:[!d&&e.jsxs("div",{className:"rounded-[1.75rem] border bg-gradient-to-br from-primary/[0.12] via-background to-amber-500/[0.08] shadow-sm p-4",children:[l&&e.jsxs(L,{variant:"ghost",size:"sm",className:"-ml-2 mb-2",onClick:l,children:[e.jsx(oe,{className:"mr-1.5 h-4 w-4"}),"Retour"]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex shrink-0 items-center justify-center rounded-2xl bg-primary/12 text-primary h-11 w-11",children:e.jsx(Be,{className:"h-5 w-5"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("h1",{className:"font-display font-semibold uppercase italic text-foreground text-xl",children:"Mon suivi"}),a&&e.jsx(T,{variant:"secondary",className:"text-[10px]",children:a})]}),e.jsxs("p",{className:"mt-1 text-sm text-muted-foreground",children:[t,": ton plan d'action, tes entretiens et tes échéances au même endroit."]})]})]})]}),d&&e.jsx(Te,{embedded:!0}),e.jsxs(Xe,{defaultValue:i||(d?"ressentis":"objectifs"),className:d?"space-y-3":"space-y-4",children:[e.jsxs(Ze,{className:`grid h-auto w-full gap-2 rounded-2xl bg-transparent p-0 ${d?"grid-cols-3":"grid-cols-2 sm:grid-cols-4"}`,children:[!d&&e.jsxs(W,{value:"objectifs",className:"gap-1 rounded-2xl border border-border bg-card px-3 py-2.5 text-xs data-[state=active]:border-primary/30 data-[state=active]:bg-primary/5 data-[state=active]:text-primary",children:[e.jsx(Oe,{className:"hidden h-3.5 w-3.5 sm:block"}),e.jsx("span",{className:"sm:hidden",children:"Plan d'action"}),e.jsx("span",{className:"hidden sm:inline",children:"Plan d'action"})]}),e.jsxs(W,{value:"ressentis",className:"gap-1 rounded-2xl border border-border bg-card px-3 py-2.5 text-xs data-[state=active]:border-primary/30 data-[state=active]:bg-primary/5 data-[state=active]:text-primary",children:[e.jsx(H,{className:"hidden h-3.5 w-3.5 sm:block"}),e.jsx("span",{className:"sm:hidden",children:"Ressentis"}),e.jsx("span",{className:"hidden sm:inline",children:"Ressentis"})]}),e.jsxs(W,{value:"entretiens",className:"gap-1 rounded-2xl border border-border bg-card px-3 py-2.5 text-xs data-[state=active]:border-primary/30 data-[state=active]:bg-primary/5 data-[state=active]:text-primary",children:[e.jsx(Pe,{className:"hidden h-3.5 w-3.5 sm:block"}),e.jsx("span",{className:"sm:hidden",children:"Entretiens"}),e.jsx("span",{className:"hidden sm:inline",children:"Entretiens"})]}),e.jsxs(W,{value:"planification",className:"gap-1 rounded-2xl border border-border bg-card px-3 py-2.5 text-xs data-[state=active]:border-primary/30 data-[state=active]:bg-primary/5 data-[state=active]:text-primary",children:[e.jsx(ae,{className:"hidden h-3.5 w-3.5 sm:block"}),e.jsx("span",{children:"Planif."})]})]}),!d&&e.jsx(G,{value:"objectifs",className:"mt-0",children:e.jsx(Te,{embedded:!0})}),e.jsx(G,{value:"ressentis",className:"mt-0",children:e.jsx(ts,{athleteId:s,athleteName:t,showProgressAction:!1})}),e.jsx(G,{value:"entretiens",className:"mt-0",children:e.jsx(ks,{embedded:!0})}),e.jsxs(G,{value:"planification",className:"mt-0 space-y-4",children:[e.jsxs(ie,{defaultOpen:!0,children:[e.jsx(ce,{asChild:!0,children:e.jsxs("button",{type:"button",className:"w-full flex items-center gap-2 group",children:[e.jsx(as,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("h2",{className:"text-sm font-semibold",children:"Créneaux"}),e.jsx(de,{className:"ml-auto h-4 w-4 text-muted-foreground transition-transform group-data-[state=open]:rotate-90"})]})}),e.jsx(le,{className:"mt-2",children:e.jsx(Os,{athleteId:s})})]}),e.jsxs("section",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ae,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("h2",{className:"text-sm font-semibold",children:"Cycle"})]}),e.jsx(Ps,{athleteId:s})]})]})]})]})}function Ls(){return typeof window>"u"?void 0:window.location.hash.match(/[?&]tab=([^&]+)/)?.[1]||void 0}function vt(){const s=Q(o=>o.user),t=Q(o=>o.userId),{data:a,isLoading:l}=w({queryKey:["profile",s,t],queryFn:()=>g.getProfile({displayName:s,userId:t}),enabled:!!s}),{data:d=[]}=w({queryKey:["profile-groups"],queryFn:()=>g.getGroups(),enabled:!!s}),i=d.find(o=>o.id===a?.group_id)?.name||a?.group_label||null;return l?e.jsxs("div",{className:"mx-auto max-w-4xl space-y-4 p-4",children:[e.jsx(ee,{className:"h-12 rounded-2xl"}),e.jsx(ee,{className:"h-12 rounded-2xl"}),e.jsx(ee,{className:"h-64 rounded-2xl"})]}):e.jsxs("div",{className:"mx-auto max-w-4xl px-4",children:[e.jsx(Ye,{title:"Mon suivi",subtitle:i??void 0,icon:e.jsx(Ke,{className:"h-3.5 w-3.5"})}),e.jsx("div",{className:"pt-2",children:e.jsx($s,{athleteId:t??0,athleteName:a?.display_name||s||"Nageur",groupLabel:i,standalone:!0,defaultTab:Ls()})})]})}export{vt as default};
