import{c as pt,r as x,u as K,d as O,j as e}from"./vendor-query-DyA9aSKS.js";import{u as se,d as ht,W as ne,B as b,T as Ce,D as ft,v as Ee,w as gt,L as k,I,C as re,e as ie,X as de}from"./index-OLfroB1X.js";import{a as y}from"./api-7ADM4VoL.js";import{T as jt}from"./textarea-Vphp8oA7.js";import{S as ke,a as Fe,b as Ie,c as Re,d as Me}from"./sheet-DJYfR8WR.js";import{T as vt,a as bt,b as Te,c as Pe}from"./tabs-CQ9QJRM5.js";import{S as Nt,a as yt,b as wt,c as St,d as Le}from"./select-lwxMVV28.js";import{shouldShowRecords as _t}from"./Profile-2Kt32CLz.js";import{I as qe}from"./InlineBanner-CGw1FZZi.js";import{c as Ct,s as ae,l as oe,f as Et}from"./animations-CrcLFysI.js";import{P as kt}from"./PageHeader-Rdb0V7Xb.js";import{u as Ft,m as F}from"./vendor-motion-CMsaQ8FX.js";import{C as le}from"./circle-alert-7Tv_TatP.js";import{P as $e}from"./pen-Cz79Bs1d.js";import{C as ce}from"./index-Cb2uUvLe.js";import{C as It}from"./chevron-right-__sVSviT.js";import{a as Rt,i as Mt,h as Tt,X as Pt,Y as Lt,T as qt,g as $t}from"./vendor-charts-BrQ8X25f.js";import{S as Dt}from"./sticky-note-Y1s7Djx9.js";import{C as zt}from"./chevron-down-DqNh7iI3.js";import"./vendor-react-BzrpNAyj.js";import"./vendor-supabase-DFPLkPj_.js";import"./swim-vy7G2def.js";import"./index-nOf_ljaa.js";import"./index-C08NmDF9.js";import"./index-CFtJoroH.js";import"./index-DCX2sNhR.js";import"./chevron-up-f8pMxrlg.js";import"./avatar-CukkXxJS.js";import"./badge-Bd-eDupl.js";import"./dialog-CGgxMo6O.js";import"./types-g3FhkFPf.js";import"./toggle-group-RD-PAKCd.js";import"./alert-dialog-CXW8Sa8O.js";import"./objectiveHelpers-BZkbUkU3.js";import"./target-CMErNKDQ.js";import"./trash-2-BVUa2mQg.js";import"./SwimmerFeedbackTab-B-RWEsqj.js";import"./chart-column-bVRAdZOe.js";import"./collapsible-CO4s9bEw.js";import"./clock-vlsJkz8D.js";import"./circle-check-BFo0mZ3O.js";import"./sparkles-C6pjlfxS.js";import"./bell-ring-1t5beZDV.js";import"./flame-1doMjbIJ.js";import"./save-CsZYdG_l.js";import"./design-tokens-CKgCpdH6.js";import"./chevron-left-Bh71aajQ.js";const At=r=>r.toLowerCase().replace(/\./g,"").replace(/\s+/g," ").trim();function De(r){const n=At(r);return n.includes("nl")||n.includes("nage libre")?0:n.includes("dos")?1:n.includes("bra")||n.includes("brasse")?2:n.includes("pap")||n.includes("papillon")?3:n.includes("4n")||n.includes("4 n")||n.includes("4 nages")?4:99}function ze(r){const n=r.match(/^(\d+)/);return n?Number(n[1]):Number.POSITIVE_INFINITY}function Kt(r,n){const p=De(r),m=De(n);return p!==m?p-m:ze(r)-ze(n)}const R=(...r)=>r.filter(Boolean).join(" ");function q(r){if(!r)return"—";const n=new Date(r);return Number.isNaN(n.getTime())?r:n.toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"2-digit"})}function Q(r){if(r==null)return"—";const n=Math.round(Math.max(0,r*1e3)),p=Math.floor(n/6e4),m=Math.floor(n%6e4/1e3),g=Math.floor(n%1e3/10);return p>0?`${p}:${String(m).padStart(2,"0")}.${String(g).padStart(2,"0")}`:`${m}.${String(g).padStart(2,"0")}`}function Ot(r){const n=r.trim();if(!n)return null;if(n.includes(":")){const[m,g]=n.split(":"),h=Number(m);if(!Number.isFinite(h)||h<0)return null;const w=g.replace(",","."),S=Number(w);return!Number.isFinite(S)||S<0?null:h*60+S}const p=Number(n.replace(",","."));return!Number.isFinite(p)||p<0?null:p}function Qt(r){if(!r)return null;const n=r.match(/FFN\s*\((\d+)\s*pts\)/i);if(!n)return null;const p=Number(n[1]);return Number.isFinite(p)?p:null}function Bt({value:r,placeholder:n,onSave:p,onCancel:m,inputMode:g="decimal",hint:h}){const[w,S]=x.useState(r);return x.useEffect(()=>{S(r)},[r]),e.jsx("div",{className:"w-full",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(I,{value:w,onChange:U=>S(U.target.value),placeholder:n,inputMode:g,className:"h-10 rounded-xl",autoFocus:!0}),h?e.jsx("div",{className:"mt-1 text-xs text-muted-foreground",children:h}):null]}),e.jsx(b,{type:"button",onClick:()=>p(w),className:"h-10 w-10 p-0 rounded-xl","aria-label":"Valider",children:e.jsx(ce,{className:"h-5 w-5"})}),e.jsx(b,{type:"button",variant:"outline",onClick:m,className:"h-10 w-10 p-0 rounded-xl","aria-label":"Annuler",children:e.jsx(de,{className:"h-5 w-5"})})]})})}const _=()=>e.jsx("div",{className:"h-10 rounded-xl bg-muted animate-pulse motion-reduce:animate-none"});function zs(){const r=se(t=>t.user),n=se(t=>t.userId),p=se(t=>t.role),{toast:m}=ht(),g=pt(),h=Ft(),w={id:null,event_name:"",pool_length:"",time_seconds:"",record_date:"",notes:""},[S,U]=x.useState(()=>{const t=window.location.hash,s=t.indexOf("?");return s>=0&&new URLSearchParams(t.substring(s)).get("tab")==="1rm"?"1rm":"swim"}),[l,j]=x.useState(w),[d,Ae]=x.useState("training"),[$,Ke]=x.useState(25),[X,B]=x.useState(null),[Oe,me]=x.useState(null),[Qe,ue]=x.useState(""),[Be,He]=x.useState(null),[Ve,D]=x.useState(null),[xe,M]=x.useState(""),[H,We]=x.useState(25),[z,Y]=x.useState(null),[Ue,pe]=x.useState(!1),T=_t(p);x.useEffect(()=>{window.scrollTo({top:0,left:0,behavior:"auto"})},[]);const he=t=>{const s=t?.pool_length??t?.poolLength??t?.poolLen??t?.pool;if(s==null)return null;if(typeof s=="number")return s===25||s===50?s:null;const u=String(s).match(/\b(25|50)\b/);if(!u)return null;const o=Number(u[1]);return o===25||o===50?o:null},G=K({queryKey:["1rm",r,n],queryFn:()=>y.get1RM({athleteName:r,athleteId:n}),enabled:!!r&&T}),J=K({queryKey:["exercises"],queryFn:()=>y.getExercises(),enabled:T}),Z=K({queryKey:["swim-records",n,r],queryFn:()=>y.getSwimRecords({athleteId:n??void 0,athleteName:r??void 0}),enabled:!!r&&T}),P=K({queryKey:["profile",n],queryFn:()=>y.getProfile({userId:n??void 0}),enabled:!!n&&T}),C=String(P.data?.ffn_iuf??"").trim(),fe=G.error||J.error||Z.error||P.error,Xe=()=>{G.refetch(),J.refetch(),Z.refetch(),P.refetch()},ee=K({queryKey:["swimmer-performances",n,C,H],queryFn:()=>y.getSwimmerPerformances({userId:n??void 0,iuf:C||void 0,poolLength:H}),enabled:!!C&&T&&d==="history"}),{data:te,isLoading:Ye,isError:Ge}=ee,V=O({mutationFn:()=>{if(!C)throw new Error("IUF FFN manquant. Ajoutez-le dans votre profil.");return y.importSwimmerPerformances({iuf:C,userId:n??void 0})},onSuccess:t=>{g.invalidateQueries({queryKey:["swimmer-performances"]}),m({title:"Import terminé",description:`${t.total_found} trouvée(s), ${t.new_imported} importée(s), ${t.already_existed} déjà existante(s)`}),pe(!0),setTimeout(()=>pe(!1),2e3)},onError:t=>{m({title:"Import impossible",description:String(t?.message||t),variant:"destructive"})}}),L=x.useMemo(()=>{if(!te?.length)return[];const t=new Map;for(const o of te){const a=t.get(o.event_code)??[];a.push(o),t.set(o.event_code,a)}const s=o=>o.toLowerCase().replace(/\./g,"").replace(/\s+/g," ").trim(),i=o=>{const a=s(o);return a.includes("nl")||a.includes("nage libre")?0:a.includes("dos")?1:a.includes("bra")||a.includes("brasse")?2:a.includes("pap")||a.includes("papillon")?3:a.includes("4n")||a.includes("4 n")||a.includes("4 nages")?4:99},u=o=>{const a=o.match(/^(\d+)/);return a?Number(a[1]):1/0};return[...t.entries()].map(([o,a])=>{const f=[...a].sort((N,c)=>(c.competition_date??"").localeCompare(N.competition_date??"")),v=f.reduce((N,c)=>c.time_seconds<N.time_seconds?c:N,f[0]);return{eventCode:o,performances:f,bestTime:v.time_seconds,bestId:v.id}}).sort((o,a)=>{const f=i(o.eventCode),v=i(a.eventCode);return f!==v?f-v:u(o.eventCode)-u(a.eventCode)})},[te]),ge=x.useMemo(()=>{if(!z)return[];const t=L.find(s=>s.eventCode===z);return t?[...t.performances].filter(s=>s.competition_date).sort((s,i)=>(s.competition_date??"").localeCompare(i.competition_date??"")).map(s=>({date:q(s.competition_date),time:s.time_seconds,display:s.time_display??Q(s.time_seconds)})):[]},[z,L]),E=x.useMemo(()=>L.find(t=>t.eventCode===z)??null,[L,z]),{data:Je,isLoading:Ze,isError:et}=G,{data:tt,isLoading:st,isError:nt}=J,{data:je,isLoading:rt,isFetching:Ht,isError:it,refetch:at}=Z,ot=()=>{at()};x.useEffect(()=>{d==="comp"&&ot()},[d]);const ve=d==="history"?H:$,lt=d==="training"?"Entraînement":d==="comp"?"Compétition":"Historique",be=O({mutationFn:t=>y.update1RM({...t,athlete_id:n,athlete_name:r}),onSuccess:()=>{g.invalidateQueries({queryKey:["1rm"]}),m({title:"1RM mis à jour"})}}),Ne=O({mutationFn:t=>y.updateExerciseNote({athlete_id:n,exercise_id:t.exercise_id,notes:t.notes}),onSuccess:()=>{g.invalidateQueries({queryKey:["1rm"]}),m({title:"Note mise à jour"})}}),W=O({mutationFn:t=>y.upsertSwimRecord(t),onSuccess:()=>{g.invalidateQueries({queryKey:["swim-records"]}),j(w),B(null),m({title:"Record mis à jour"})}});O({mutationFn:t=>y.syncFfnSwimRecords({athleteId:n??void 0,athleteName:r??void 0,iuf:t}),onSuccess:t=>{g.invalidateQueries({queryKey:["swim-records"]}),m({title:"Synchro FFN terminée",description:`${t?.inserted??0} ajouté(s), ${t?.updated??0} mis à jour, ${t?.skipped??0} inchangé(s)`})},onError:t=>{m({title:"Synchro FFN impossible",description:String(t?.message||t),variant:"destructive"})}});const A=()=>{j(w),B(null)},dt=t=>{const s=he(t);j({id:t.id,event_name:t.event_name??"",pool_length:s?String(s):"",time_seconds:t.time_seconds!=null?Q(Number(t.time_seconds)):"",record_date:t.record_date?String(t.record_date).split("T")[0]:"",notes:t.notes??""}),B(t.id)},ye=()=>{if(!l.event_name.trim()){m({title:"Nom d'épreuve requis",variant:"destructive"});return}if(!l.pool_length){m({title:"Bassin requis",variant:"destructive"});return}const t=Ot(l.time_seconds);if(t===null){m({title:"Temps invalide",description:"Ex: 1:02.34 ou 62.34",variant:"destructive"});return}W.mutate({id:l.id||null,athlete_id:n,athleteName:r,athlete_name:r,event_name:l.event_name,pool_length:parseInt(l.pool_length,10),time_seconds:t,record_date:l.record_date||null,notes:l.notes||null,record_type:d})},ct=t=>{t.preventDefault(),ye()},we=x.useMemo(()=>(je?.records??[]).filter(i=>{const u=he(i);if(!u||u!==$)return!1;const o=String(i.record_type??"training");return d==="comp"?o==="comp":o==="training"}).sort((i,u)=>Kt(String(i.event_name??""),String(u.event_name??""))),[je,$,d]),Se=()=>{j({...w,pool_length:String($)}),B("add")},mt=t=>{Ae(t),A()},ut=(t,s)=>{me(t),ue(s!=null&&Number(s)>0?String(s):"")},_e=()=>{me(null),ue("")},xt=(t,s)=>{const i=Number(String(s??"").replace(",","."));if(!Number.isFinite(i)||i<=0){m({title:"Valeur invalide",description:"Entrez un nombre > 0",variant:"destructive"});return}be.mutate({exercise_id:t,one_rm:i}),_e()};return T?fe?e.jsx("div",{className:"min-h-[100dvh]",children:e.jsxs("div",{className:"mx-auto max-w-lg px-4 pt-16 pb-10 text-center",children:[e.jsx(le,{className:"h-10 w-10 mx-auto text-destructive/60"}),e.jsx("p",{className:"mt-3 text-sm font-semibold",children:"Impossible de charger les données"}),e.jsx("p",{className:"mt-1 text-xs text-muted-foreground",children:fe.message}),e.jsx(b,{onClick:Xe,size:"sm",className:"mt-4 rounded-2xl",children:"Réessayer"})]})}):e.jsx("div",{className:"min-h-[100dvh]",children:e.jsxs("div",{className:"mx-auto max-w-lg",children:[e.jsx(kt,{className:"-mx-0",title:"Mes Records",icon:e.jsx(Ce,{className:"h-3.5 w-3.5"}),backHref:"/profile",backLabel:"Retour au profil"}),e.jsx("div",{className:"px-3 pt-3",children:e.jsxs(vt,{value:S,onValueChange:t=>U(t),children:[e.jsxs(bt,{className:"w-full rounded-2xl bg-muted/50 border border-border p-1 flex",children:[e.jsxs(Te,{value:"swim","aria-label":"Records de natation",className:`flex-1 rounded-xl px-3 py-2 text-sm font-bold uppercase tracking-wide gap-1.5
                  data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm
                  data-[state=inactive]:text-muted-foreground`,children:[e.jsx(ne,{className:"h-4 w-4"}),"Natation"]}),e.jsxs(Te,{value:"1rm","aria-label":"Records de musculation",className:`flex-1 rounded-xl px-3 py-2 text-sm font-bold uppercase tracking-wide gap-1.5
                  data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm
                  data-[state=inactive]:text-muted-foreground`,children:[e.jsx(ft,{className:"h-4 w-4"}),"Musculation"]})]}),S==="swim"?e.jsxs("div",{className:"mt-2.5 rounded-2xl border border-border/60 bg-muted/20 px-3 py-3",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-[10px] font-semibold uppercase tracking-[0.14em] text-muted-foreground",children:"Vue active"}),e.jsxs("p",{className:"truncate text-sm font-semibold text-foreground",children:[lt," · ",ve,"m"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[d==="training"?e.jsx(b,{type:"button",size:"sm",onClick:Se,className:"rounded-xl text-xs h-8 gap-1",children:"Ajouter"}):null,d==="history"?e.jsx(F.div,{variants:Ct,animate:Ue?"visible":"hidden",children:e.jsxs(b,{type:"button",size:"sm",onClick:()=>V.mutate(),disabled:V.isPending||!C,className:"rounded-xl text-xs h-8 gap-1",children:[V.isPending?e.jsx(Ee,{className:"h-3 w-3 animate-spin"}):e.jsx(gt,{className:"h-3 w-3"}),V.isPending?"Import...":"Importer"]})}):null]})]}),e.jsx("div",{className:"mt-3 flex flex-wrap gap-2",children:["training","comp","history"].map(t=>{const s=t==="training"?"Entraînement":t==="comp"?"Compétition":"Historique";return e.jsx("button",{type:"button",onClick:()=>{mt(t),t!=="history"&&Y(null)},className:R("rounded-xl border px-3 py-1.5 text-xs font-semibold transition",d===t?"border-primary/30 bg-primary/5 text-primary":"border-border text-muted-foreground hover:border-primary/30 hover:text-foreground"),"aria-pressed":d===t,children:s},t)})}),e.jsxs("div",{className:"mt-2 flex flex-wrap items-center gap-2",children:[[25,50].map(t=>e.jsxs("button",{type:"button",onClick:()=>{d==="history"?We(t):(Ke(t),A())},className:R("rounded-xl border px-3 py-1.5 text-xs font-semibold transition",ve===t?"border-primary/30 bg-primary/5 text-primary":"border-border text-muted-foreground hover:border-primary/30 hover:text-foreground"),children:[t,"m"]},t)),d==="comp"?e.jsx("span",{className:"text-[11px] text-muted-foreground",children:"Données FFN synchronisées"}):null]})]}):null,e.jsx(ke,{open:d==="training"&&X==="add",onOpenChange:t=>{!t&&X==="add"&&A()},children:e.jsxs(Fe,{side:"bottom",className:"max-h-[90vh] overflow-y-auto rounded-t-3xl",children:[e.jsxs(Ie,{className:"text-left",children:[e.jsx(Re,{children:"Ajouter un record"}),e.jsx(Me,{children:"Saisis rapidement un meilleur temps d'entraînement sans quitter la liste."})]}),e.jsx("form",{onSubmit:ct,className:"mt-5",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"col-span-2",children:[e.jsx(k,{className:"text-xs mb-1.5 block",children:"Épreuve"}),e.jsx(I,{value:l.event_name,onChange:t=>j({...l,event_name:t.target.value}),placeholder:"Ex: 100 NL, 200 Dos",className:"h-10 rounded-xl"})]}),e.jsxs("div",{children:[e.jsx(k,{className:"text-xs mb-1.5 block",children:"Bassin"}),e.jsxs(Nt,{value:l.pool_length,onValueChange:t=>j({...l,pool_length:t}),children:[e.jsx(yt,{className:"h-10 rounded-xl",children:e.jsx(wt,{placeholder:"—"})}),e.jsxs(St,{children:[e.jsx(Le,{value:"25",children:"25m"}),e.jsx(Le,{value:"50",children:"50m"})]})]})]}),e.jsxs("div",{children:[e.jsx(k,{className:"text-xs mb-1.5 block",children:"Temps"}),e.jsx(I,{value:l.time_seconds,inputMode:"decimal",placeholder:"1:02.34",onChange:t=>j({...l,time_seconds:t.target.value}),className:"h-10 rounded-xl"})]}),e.jsxs("div",{children:[e.jsx(k,{className:"text-xs mb-1.5 block",children:"Date"}),e.jsx(I,{type:"date",value:l.record_date,onChange:t=>j({...l,record_date:t.target.value}),className:"h-10 rounded-xl"})]}),e.jsxs("div",{children:[e.jsx(k,{className:"text-xs mb-1.5 block",children:"Notes"}),e.jsx(I,{value:l.notes,onChange:t=>j({...l,notes:t.target.value}),placeholder:"Optionnel",className:"h-10 rounded-xl"})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 pb-2",children:[e.jsx(b,{type:"button",variant:"outline",onClick:A,className:"rounded-xl",children:"Annuler"}),e.jsx(b,{type:"submit",disabled:W.isPending,className:"rounded-xl",children:W.isPending?"Ajout...":"Ajouter"})]})]})})]})}),e.jsxs(Pe,{value:"swim",className:"mt-0",children:[d!=="history"?e.jsx(e.Fragment,{children:e.jsx("div",{className:"mt-3",children:e.jsx(re,{className:"w-full min-w-0 rounded-2xl",children:e.jsx(ie,{className:"p-0",children:rt?e.jsxs("div",{className:"p-4 grid gap-3",children:[e.jsx(_,{}),e.jsx(_,{}),e.jsx(_,{})]}):it?e.jsx("div",{className:"mx-4 my-4 rounded-lg border border-destructive/20 bg-destructive/10 p-4 text-sm text-destructive",children:"Impossible de charger les records natation."}):we.length===0?e.jsxs("div",{className:"py-8 text-center",children:[e.jsx(ne,{className:"h-8 w-8 mx-auto text-muted-foreground/30"}),e.jsxs("p",{className:"mt-2 text-sm text-muted-foreground",children:["Aucun record en ",$,"m"]}),d==="training"&&e.jsx(b,{type:"button",size:"sm",variant:"outline",onClick:Se,className:"mt-3 rounded-xl text-xs h-8",children:"Ajouter un record"})]}):e.jsx(F.div,{className:"divide-y divide-border motion-reduce:animate-none",variants:h?void 0:ae,initial:h?!1:"hidden",animate:h?!1:"visible",children:we.map(t=>{const s=X===t.id,i=Q(t.time_seconds),u=q(t.record_date),o=(t.notes??"").trim(),a=t?.ffn_points??t?.ffnPoints??t?.points??t?.pts??null,f=a==null?NaN:Number(a),v=Number.isFinite(f)?f:Qt(t?.notes),N=(t?.meet??t?.meet_name??t?.meetName??t?.competition??"").trim?.()??"";return e.jsxs(F.div,{className:"px-3 py-2.5 motion-reduce:animate-none",variants:oe,children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("span",{className:"text-sm font-semibold truncate",children:t.event_name}),e.jsxs("div",{className:"flex items-center gap-2 shrink-0",children:[e.jsx("span",{className:"font-mono text-primary font-bold tabular-nums text-sm",children:i}),d==="training"&&e.jsx("button",{type:"button",onClick:()=>dt(t),className:"inline-flex items-center justify-center h-8 w-8 rounded-xl text-muted-foreground hover:text-foreground hover:bg-muted/60 transition","aria-label":`Modifier ${t.event_name}`,children:e.jsx($e,{className:"h-3.5 w-3.5"})})]})]}),e.jsxs("div",{className:"flex items-center gap-3 mt-0.5 text-xs text-muted-foreground",children:[d==="comp"&&v!=null&&e.jsxs("span",{className:"tabular-nums",children:[String(v)," pts"]}),e.jsx("span",{className:"tabular-nums",children:u}),d==="comp"&&N&&e.jsx("span",{className:"truncate",children:N}),d==="training"&&o&&e.jsx("span",{className:"truncate italic",children:o})]}),d==="training"&&s?e.jsx(F.div,{className:"mt-3",variants:Et,initial:"hidden",animate:"visible",children:e.jsxs("div",{className:"rounded-2xl bg-muted/30 border border-border p-4 space-y-4",children:[e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(k,{children:"Temps"}),e.jsx(I,{value:l.time_seconds,inputMode:"decimal",placeholder:"1:02.34",onChange:c=>j({...l,time_seconds:c.target.value}),className:"rounded-xl"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Format: mm:ss.cc ou secondes"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(k,{children:"Date"}),e.jsx(I,{type:"date",value:l.record_date,onChange:c=>j({...l,record_date:c.target.value}),className:"rounded-xl"})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(k,{children:"Notes"}),e.jsx(jt,{value:l.notes,onChange:c=>j({...l,notes:c.target.value}),rows:2,className:"rounded-xl"})]}),e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsxs(b,{type:"button",size:"sm",variant:"outline",onClick:A,className:"rounded-2xl gap-2",children:[e.jsx(de,{className:"h-4 w-4"}),"Annuler"]}),e.jsxs(b,{type:"button",size:"sm",onClick:ye,disabled:W.isPending,className:"rounded-2xl gap-2",children:[e.jsx(ce,{className:"h-4 w-4"}),"Enregistrer"]})]})]})}):null]},t.id)})})})})})}):null,d==="history"?e.jsxs("div",{className:"mt-3 space-y-3",children:[e.jsx(qe,{variant:"destructive",icon:e.jsx(le,{}),label:"Impossible de charger votre profil",visible:P.isError,animate:!1}),e.jsx(qe,{variant:"yellow",icon:e.jsx(le,{}),label:"IUF FFN non renseigné",sublabel:e.jsxs(e.Fragment,{children:["Renseignez votre numéro dans ",e.jsx("a",{href:"/#/profile",className:"underline font-medium hover:text-foreground",children:"votre profil"})]}),visible:!P.isError&&!C&&!P.isLoading,animate:!1}),Ye?e.jsxs("div",{className:"grid gap-3",children:[e.jsx(_,{}),e.jsx(_,{}),e.jsx(_,{})]}):Ge?e.jsxs("div",{className:"rounded-lg border border-destructive/20 bg-destructive/10 p-4 text-sm text-destructive",children:[e.jsx("p",{className:"font-semibold",children:"Impossible de charger les performances"}),e.jsx("p",{className:"mt-1 text-xs",children:ee.error instanceof Error?ee.error.message:"Vérifiez votre connexion internet et réessayez."})]}):L.length===0?e.jsx("div",{className:"px-4 py-6 text-sm text-muted-foreground",children:C?'Aucune performance trouvée. Cliquez sur "Importer" pour récupérer vos données FFN.':"Ajoutez votre IUF FFN dans votre profil pour commencer."}):e.jsx(F.div,{className:"space-y-2 motion-reduce:animate-none",variants:h?void 0:ae,initial:h?!1:"hidden",animate:h?!1:"visible",children:L.map(t=>{const s=t.performances.find(u=>u.id===t.bestId)??t.performances[0],i=t.performances[0];return e.jsx(F.div,{variants:oe,children:e.jsx(re,{className:"rounded-2xl",children:e.jsx(ie,{className:"p-0",children:e.jsxs("button",{type:"button",onClick:()=>Y(t.eventCode),className:"w-full flex items-center justify-between gap-3 px-3 py-3 text-left cursor-pointer",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[e.jsx("span",{className:"text-sm font-semibold truncate",children:t.eventCode}),e.jsx("span",{className:"inline-flex items-center justify-center h-5 min-w-5 px-1.5 rounded-full bg-muted text-xs font-semibold tabular-nums text-muted-foreground",children:t.performances.length})]}),e.jsxs("div",{className:"mt-1 flex items-center gap-3 text-xs text-muted-foreground",children:[e.jsxs("span",{children:["Meilleur: ",q(s?.competition_date)]}),i?.competition_date&&i.id!==s?.id?e.jsxs("span",{children:["Dernier: ",q(i.competition_date)]}):null]})]}),e.jsxs("div",{className:"flex items-center gap-2 shrink-0",children:[e.jsx("span",{className:"font-mono text-primary font-bold tabular-nums text-sm",children:Q(t.bestTime)}),e.jsx(It,{className:"h-4 w-4 text-muted-foreground"})]})]})})})},t.eventCode)})}),e.jsx(ke,{open:!!E,onOpenChange:t=>{t||Y(null)},children:e.jsxs(Fe,{side:"bottom",className:"max-h-[90vh] overflow-y-auto rounded-t-3xl",children:[e.jsxs(Ie,{className:"text-left",children:[e.jsx(Re,{children:E?.eventCode??"Historique"}),e.jsx(Me,{children:E?`${E.performances.length} performance${E.performances.length>1?"s":""} en bassin ${H}m`:"Historique détaillé"})]}),E?e.jsxs("div",{className:"mt-5 space-y-4",children:[ge.length>1?e.jsxs("div",{className:"rounded-2xl border border-border bg-muted/20 px-2 pt-3 pb-1",children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-2 px-2",children:"Courbe de progression"}),e.jsx(Rt,{width:"100%",height:180,children:e.jsxs(Mt,{data:ge,margin:{top:5,right:10,left:0,bottom:5},children:[e.jsx(Tt,{strokeDasharray:"3 3",className:"stroke-border"}),e.jsx(Pt,{dataKey:"date",tick:{fontSize:10},className:"text-muted-foreground"}),e.jsx(Lt,{domain:["auto","auto"],tick:{fontSize:10},className:"text-muted-foreground",reversed:!0,tickFormatter:t=>{const s=Math.floor(t/60),i=Math.floor(t%60),u=Math.round(t%1*100);return s>0?`${s}:${String(i).padStart(2,"0")}`:`${i}.${String(u).padStart(2,"0")}`}}),e.jsx(qt,{formatter:t=>{const s=Math.floor(t/60),i=Math.floor(t%60),u=Math.round(t%1*100);return[s>0?`${s}:${String(i).padStart(2,"0")}.${String(u).padStart(2,"0")}`:`${i}.${String(u).padStart(2,"0")}`,"Temps"]},labelStyle:{fontSize:11},contentStyle:{borderRadius:12,fontSize:12}}),e.jsx($t,{type:"monotone",dataKey:"time",stroke:"hsl(var(--primary))",strokeWidth:2,dot:{r:3},activeDot:{r:5}})]})})]}):null,e.jsx("div",{className:"overflow-hidden rounded-2xl border border-border",children:e.jsx("div",{className:"divide-y divide-border",children:E.performances.map(t=>{const s=t.id===E.bestId;return e.jsxs("div",{className:R("px-3 py-2.5",s&&"bg-primary/5"),children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex items-center gap-1.5 min-w-0",children:[s?e.jsx(Ce,{className:"h-3.5 w-3.5 text-primary shrink-0"}):null,e.jsx("span",{className:"text-xs text-muted-foreground tabular-nums",children:q(t.competition_date)})]}),e.jsx("span",{className:R("font-mono tabular-nums text-sm shrink-0",s?"text-primary font-bold":"font-medium"),children:t.time_display??Q(t.time_seconds)})]}),e.jsxs("div",{className:"flex items-center gap-3 mt-0.5 text-xs text-muted-foreground",children:[t.ffn_points!=null?e.jsxs("span",{className:"tabular-nums",children:[String(t.ffn_points)," pts"]}):null,t.competition_name?e.jsx("span",{className:"truncate",children:t.competition_name}):null]})]},t.id)})})})]}):null]})})]}):null,e.jsx("div",{className:"h-6"})]}),e.jsxs(Pe,{value:"1rm",className:"mt-0",children:[e.jsx("div",{className:"mt-3",children:e.jsx(re,{className:"w-full min-w-0 rounded-2xl",children:e.jsxs(ie,{className:"p-0",children:[Ze||st?e.jsxs("div",{className:"p-4 grid gap-3",children:[e.jsx(_,{}),e.jsx(_,{}),e.jsx(_,{})]}):et||nt?e.jsx("div",{className:"p-4 text-sm text-muted-foreground",children:"Impossible de charger les records musculation."}):e.jsx(F.div,{className:"divide-y divide-border motion-reduce:animate-none",variants:h?void 0:ae,initial:h?!1:"hidden",animate:h?!1:"visible",children:tt?.filter(t=>t.exercise_type!=="warmup").map(t=>{const s=Je?.find(c=>c.exercise_id===t.id),i=Number(s?.weight??0),u=i>0?`${i} kg`:"—",o=s?.recorded_at??s?.date??null,a=s?.notes??null,f=Oe===t.id,v=Be===t.id,N=Ve===t.id;return e.jsxs(F.div,{className:"px-3 py-2.5 motion-reduce:animate-none",variants:oe,children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("span",{className:"text-sm font-semibold truncate",children:t.nom_exercice}),e.jsxs("div",{className:"flex items-center gap-2 shrink-0",children:[e.jsx("span",{className:R("font-mono font-bold tabular-nums text-sm",i>0?"text-primary":"text-muted-foreground"),children:u}),!f&&e.jsx("button",{type:"button",onClick:()=>ut(t.id,s?.weight??null),className:"inline-flex items-center justify-center h-8 w-8 rounded-xl text-muted-foreground hover:text-foreground hover:bg-muted/60 transition","aria-label":`Modifier ${t.nom_exercice}`,children:e.jsx($e,{className:"h-3.5 w-3.5"})})]})]}),e.jsxs("div",{className:"flex items-center justify-between mt-0.5",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground min-w-0",children:[e.jsx("span",{className:"tabular-nums shrink-0",children:q(o)}),a&&!N?e.jsx("button",{type:"button",onClick:()=>{D(t.id),M(a??"")},className:"truncate italic hover:text-foreground transition text-left",title:"Modifier la note",children:a}):null]}),e.jsxs("div",{className:"flex items-center gap-1 shrink-0",children:[e.jsx("button",{type:"button",onClick:()=>{N?(D(null),M("")):(D(t.id),M(a??""))},className:R("inline-flex items-center justify-center h-7 w-7 rounded-lg transition",a?"text-primary hover:text-primary/80":"text-muted-foreground/40 hover:text-muted-foreground"),"aria-label":a?"Modifier la note":"Ajouter une note",children:e.jsx(Dt,{className:"h-3.5 w-3.5"})}),i>0&&!f?e.jsxs("button",{type:"button",onClick:()=>He(v?null:t.id),className:"inline-flex items-center gap-0.5 h-7 px-1.5 rounded-lg text-xs text-muted-foreground hover:text-foreground transition","aria-label":"Table des pourcentages",children:[e.jsx(zt,{className:R("h-3.5 w-3.5 transition-transform",v&&"rotate-180")}),e.jsx("span",{className:"text-[10px] font-bold",children:"%"})]}):null]})]}),f?e.jsx("div",{className:"mt-3",children:e.jsx(Bt,{value:Qe,placeholder:"Ex: 100",inputMode:"decimal",hint:"Charge max (kg).",onCancel:_e,onSave:c=>xt(t.id,c)})}):null,N?e.jsx("div",{className:"mt-3",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(I,{value:xe,onChange:c=>M(c.target.value),placeholder:"Machine n°3, cran 5...",className:"h-9 rounded-lg text-sm flex-1",autoFocus:!0}),e.jsx(b,{type:"button",size:"sm",onClick:()=>{const c=xe.trim()||null;Ne.mutate({exercise_id:t.id,notes:c}),D(null),M("")},disabled:Ne.isPending,className:"rounded-lg h-9 w-9 p-0 shrink-0","aria-label":"Enregistrer",children:e.jsx(ce,{className:"h-4 w-4"})}),e.jsx(b,{type:"button",size:"sm",variant:"outline",onClick:()=>{D(null),M("")},className:"rounded-lg h-9 w-9 p-0 shrink-0","aria-label":"Annuler",children:e.jsx(de,{className:"h-4 w-4"})})]})}):null,v&&i>0?e.jsx("div",{className:"mt-3 rounded-xl bg-muted/30 border border-border p-3",children:e.jsx("div",{className:"grid grid-cols-5 gap-2 text-center text-xs",children:[50,60,70,80,90].map(c=>e.jsxs("div",{className:"space-y-0.5",children:[e.jsxs("div",{className:"text-[10px] text-muted-foreground font-medium",children:[c,"%"]}),e.jsx("div",{className:"font-bold tabular-nums font-mono",children:Math.round(i*c/10)/10})]},c))})}):null]},t.id)})}),be.isPending?e.jsxs("div",{className:"px-4 pb-4 text-xs text-muted-foreground flex items-center gap-2",children:[e.jsx(Ee,{className:"h-3 w-3 animate-spin"})," Mise à jour..."]}):null]})})}),e.jsx("div",{className:"h-6"})]})]})})]})}):e.jsx("div",{className:"min-h-[100dvh]",children:e.jsxs("div",{className:"mx-auto max-w-lg px-4 pt-16 pb-10 text-center",children:[e.jsx(ne,{className:"h-10 w-10 mx-auto text-muted-foreground/30"}),e.jsx("p",{className:"mt-3 text-sm text-muted-foreground",children:"Cette page est réservée aux nageurs."})]})})}export{zs as default};
