const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-b2N4RXqt.js","assets/vendor-query-DyA9aSKS.js","assets/vendor-react-BzrpNAyj.js","assets/vendor-charts-BrQ8X25f.js","assets/vendor-supabase-DFPLkPj_.js","assets/vendor-motion-CMsaQ8FX.js","assets/index-CVx-s1wx.css"])))=>i.map(i=>d[i]);
import{r as p,a as Xs,j as e,c as Fe,u as O,d as K,f as ms}from"./vendor-query-DyA9aSKS.js";import{c as Q,x as Js,y as er,z as Ce,A as me,E as tr,a as Ge,B,X as sr,d as Ue,u as ie,P as Ye,L as F,I as ae,s as rr,T as $e,G as nr,_ as ar,b as jt,C as ye,e as je,h as Oe,j as ze,k as Le,f as ir,D as or,t as Rt,H as Tt,J as lr,g as te,w as cr,K as dr,M as ur,N as mr}from"./index-b2N4RXqt.js";import{a as A}from"./api-CKzxOzx9.js";import{T as se}from"./textarea-B3U72ikC.js";import{A as Mt,a as Bt,b as qt}from"./avatar-iXdckMzj.js";import{e as ps,S as nt,a as at,b as it,c as ot,d as Ie}from"./select-C6sRp211.js";import{B as T}from"./badge-CAMDV6Tr.js";import{S as lt,a as ct,b as dt,c as ut,d as mt}from"./sheet-DKbExC8p.js";import{_ as pr,a as U}from"./vendor-supabase-DFPLkPj_.js";import{g as hr}from"./vendor-react-BzrpNAyj.js";import{D as fr,a as xr,b as gr,c as vr,d as br}from"./dialog-CpcCpFZR.js";import{c as wr,u as yr}from"./index-WeziBD9c.js";import{u as jr}from"./index-DCX2sNhR.js";import{C as Nr}from"./index-Q9WkxysR.js";import{u as Ot,t as zt,o as hs,s as re}from"./types-g3FhkFPf.js";import{f as Sr}from"./animations-CrcLFysI.js";import{T as Cr,a as Qe}from"./toggle-group-Dt4RtBMO.js";import{A as _r,a as Ar,b as Pr,c as Er,d as Dr,e as kr,f as Rr,g as Tr}from"./alert-dialog-Bbf9eVqs.js";import{F as Mr,e as Nt,f as Se,p as Lt,s as fs,a as xs,c as gs,d as Br,S as vs,b as qr}from"./objectiveHelpers-BZkbUkU3.js";import{A as pe,T as We,M as St}from"./target-Dq53GzMS.js";import{T as Ct}from"./trash-2-B4tgAOb9.js";import{S as Or,w as bs,a as ws,G as zr,C as _t,b as Lr}from"./SwimmerFeedbackTab-DKsa1o7Q.js";import{C as ys,a as js,b as Ns}from"./collapsible-5QD_55MP.js";import{C as Ir}from"./chevron-up-CHroF9si.js";import{C as Ss}from"./chevron-down-C1QX5__x.js";import{C as Ne}from"./clock-DXSgFoje.js";import{C as It}from"./circle-check-D1HQqL5a.js";import{C as de}from"./chevron-right-BACt73rk.js";import{T as Fr,a as Ur,b as Re,c as Te}from"./tabs-CeCyzWaz.js";import{S as $r}from"./sparkles-D72i7iGm.js";import{B as Cs}from"./bell-ring-D9ytKxJq.js";import{F as Wr}from"./flame-CMxKZ8SZ.js";import{m as le,A as _s}from"./vendor-motion-CMsaQ8FX.js";import{S as As}from"./save-DJ_vGkKC.js";import{C as Kr}from"./circle-alert-CCRnJyuE.js";import{P as Vr}from"./pen-HRNyjVvt.js";import"./vendor-charts-BrQ8X25f.js";import"./swim-CQSyO4VL.js";import"./index-DJRe3gu4.js";import"./design-tokens-CKgCpdH6.js";import"./index-BKaepEhf.js";import"./chart-column-BIuAIU3-.js";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hr=[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M17 17H4a1 1 0 0 1-.74-1.673C4.59 13.956 6 12.499 6 8a6 6 0 0 1 .258-1.742",key:"178tsu"}],["path",{d:"m2 2 20 20",key:"1ooewy"}],["path",{d:"M8.668 3.01A6 6 0 0 1 18 8c0 2.687.77 4.653 1.707 6.05",key:"1hqiys"}]],Zr=Q("bell-off",Hr);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gr=[["path",{d:"M12 18V5",key:"adv99a"}],["path",{d:"M15 13a4.17 4.17 0 0 1-3-4 4.17 4.17 0 0 1-3 4",key:"1e3is1"}],["path",{d:"M17.598 6.5A3 3 0 1 0 12 5a3 3 0 1 0-5.598 1.5",key:"1gqd8o"}],["path",{d:"M17.997 5.125a4 4 0 0 1 2.526 5.77",key:"iwvgf7"}],["path",{d:"M18 18a4 4 0 0 0 2-7.464",key:"efp6ie"}],["path",{d:"M19.967 17.483A4 4 0 1 1 12 18a4 4 0 1 1-7.967-.517",key:"1gq6am"}],["path",{d:"M6 18a4 4 0 0 1-2-7.464",key:"k1g0md"}],["path",{d:"M6.003 5.125a4 4 0 0 0-2.526 5.77",key:"q97ue3"}]],Yr=Q("brain",Gr);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qr=[["path",{d:"M13.997 4a2 2 0 0 1 1.76 1.05l.486.9A2 2 0 0 0 18.003 7H20a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2h1.997a2 2 0 0 0 1.759-1.048l.489-.904A2 2 0 0 1 10.004 4z",key:"18u6gg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]],Xr=Q("camera",Qr);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jr=[["circle",{cx:"12.1",cy:"12.1",r:"1",key:"18d7e5"}]],en=Q("dot",Jr);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tn=[["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}],["path",{d:"M3 7V5a2 2 0 0 1 2-2h2",key:"aa7l1z"}],["path",{d:"M17 3h2a2 2 0 0 1 2 2v2",key:"4qcy5o"}],["path",{d:"M21 17v2a2 2 0 0 1-2 2h-2",key:"6vwrx8"}],["path",{d:"M7 21H5a2 2 0 0 1-2-2v-2",key:"ioqczr"}]],sn=Q("focus",tn);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rn=[["polyline",{points:"22 12 16 12 14 15 10 15 8 12 2 12",key:"o97t9d"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z",key:"oot6mr"}]],nn=Q("inbox",rn);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const an=[["path",{d:"m16 17 5-5-5-5",key:"1bji2h"}],["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}]],on=Q("log-out",an);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ln=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]],cn=Q("lock",ln);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dn=[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"11",x2:"11",y1:"8",y2:"14",key:"1vmskp"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]],un=Q("zoom-in",dn),Me=400,mn=200*1024,pn=.85,hn=.4,fn=.1,xn=["image/jpeg","image/png","image/webp","image/heic","image/heif"];function gn(s){return xn.includes(s.type)||/\.(jpe?g|png|webp|heic|heif)$/i.test(s.name)}function vn(s){return new Promise((n,t)=>{const r=new Image;r.onload=()=>n(r),r.onerror=()=>t(new Error("Impossible de charger l'image")),r.src=URL.createObjectURL(s)})}function bn(s){let{width:n,height:t}=s;if(n>Me||t>Me){const i=Math.min(Me/n,Me/t);n=Math.round(n*i),t=Math.round(t*i)}const r=document.createElement("canvas");return r.width=n,r.height=t,r.getContext("2d").drawImage(s,0,0,n,t),r}function pt(s,n,t){return new Promise((r,a)=>{s.toBlob(i=>i?r(i):a(new Error("Compression échouée")),n,t)})}let Be=null;function Ft(){if(Be===null)try{const s=document.createElement("canvas");s.width=1,s.height=1,Be=s.toDataURL("image/webp").startsWith("data:image/webp")}catch{Be=!1}return Be}async function wn(s,n){const t=await new Promise((i,o)=>{const l=new Image;l.onload=()=>i(l),l.onerror=()=>o(new Error("Impossible de charger l'image")),l.src=s}),r=document.createElement("canvas");return r.width=n.width,r.height=n.height,r.getContext("2d").drawImage(t,n.x,n.y,n.width,n.height,0,0,n.width,n.height),pt(r,"image/png",1)}async function yn(s){const n=await vn(s),t=bn(n);URL.revokeObjectURL(n.src);const r=Ft()?"image/webp":"image/jpeg",a=Ft()?"webp":"jpg";let i=pn,o=await pt(t,r,i);for(;o.size>mn&&i>hn;)i-=fn,o=await pt(t,r,i);return{blob:o,mimeType:r,extension:a}}var Xe,Ut;function jn(){if(Ut)return Xe;Ut=1;var s=!1,n,t,r,a,i,o,l,c,u,m,d,b,f,x,h;function y(){if(!s){s=!0;var g=navigator.userAgent,w=/(?:MSIE.(\d+\.\d+))|(?:(?:Firefox|GranParadiso|Iceweasel).(\d+\.\d+))|(?:Opera(?:.+Version.|.)(\d+\.\d+))|(?:AppleWebKit.(\d+(?:\.\d+)?))|(?:Trident\/\d+\.\d+.*rv:(\d+\.\d+))/.exec(g),S=/(Mac OS X)|(Windows)|(Linux)/.exec(g);if(b=/\b(iPhone|iP[ao]d)/.exec(g),f=/\b(iP[ao]d)/.exec(g),m=/Android/i.exec(g),x=/FBAN\/\w+;/i.exec(g),h=/Mobile/i.exec(g),d=!!/Win64/.exec(g),w){n=w[1]?parseFloat(w[1]):w[5]?parseFloat(w[5]):NaN,n&&document&&document.documentMode&&(n=document.documentMode);var P=/(?:Trident\/(\d+.\d+))/.exec(g);o=P?parseFloat(P[1])+4:n,t=w[2]?parseFloat(w[2]):NaN,r=w[3]?parseFloat(w[3]):NaN,a=w[4]?parseFloat(w[4]):NaN,a?(w=/(?:Chrome\/(\d+\.\d+))/.exec(g),i=w&&w[1]?parseFloat(w[1]):NaN):i=NaN}else n=t=r=i=a=NaN;if(S){if(S[1]){var k=/(?:Mac OS X (\d+(?:[._]\d+)?))/.exec(g);l=k?parseFloat(k[1].replace("_",".")):!0}else l=!1;c=!!S[2],u=!!S[3]}else l=c=u=!1}}var j={ie:function(){return y()||n},ieCompatibilityMode:function(){return y()||o>n},ie64:function(){return j.ie()&&d},firefox:function(){return y()||t},opera:function(){return y()||r},webkit:function(){return y()||a},safari:function(){return j.webkit()},chrome:function(){return y()||i},windows:function(){return y()||c},osx:function(){return y()||l},linux:function(){return y()||u},iphone:function(){return y()||b},mobile:function(){return y()||b||f||m||h},nativeApp:function(){return y()||x},android:function(){return y()||m},ipad:function(){return y()||f}};return Xe=j,Xe}var Je,$t;function Nn(){if($t)return Je;$t=1;var s=!!(typeof window<"u"&&window.document&&window.document.createElement),n={canUseDOM:s,canUseWorkers:typeof Worker<"u",canUseEventListeners:s&&!!(window.addEventListener||window.attachEvent),canUseViewport:s&&!!window.screen,isInWorker:!s};return Je=n,Je}var et,Wt;function Sn(){if(Wt)return et;Wt=1;var s=Nn(),n;s.canUseDOM&&(n=document.implementation&&document.implementation.hasFeature&&document.implementation.hasFeature("","")!==!0);/**
 * Checks if an event is supported in the current execution environment.
 *
 * NOTE: This will not work correctly for non-generic events such as `change`,
 * `reset`, `load`, `error`, and `select`.
 *
 * Borrows from Modernizr.
 *
 * @param {string} eventNameSuffix Event name, e.g. "click".
 * @param {?boolean} capture Check if the capture phase is supported.
 * @return {boolean} True if the event is supported.
 * @internal
 * @license Modernizr 3.0.0pre (Custom Build) | MIT
 */function t(r,a){if(!s.canUseDOM||a&&!("addEventListener"in document))return!1;var i="on"+r,o=i in document;if(!o){var l=document.createElement("div");l.setAttribute(i,"return;"),o=typeof l[i]=="function"}return!o&&n&&r==="wheel"&&(o=document.implementation.hasFeature("Events.wheel","3.0")),o}return et=t,et}var tt,Kt;function Cn(){if(Kt)return tt;Kt=1;var s=jn(),n=Sn(),t=10,r=40,a=800;function i(o){var l=0,c=0,u=0,m=0;return"detail"in o&&(c=o.detail),"wheelDelta"in o&&(c=-o.wheelDelta/120),"wheelDeltaY"in o&&(c=-o.wheelDeltaY/120),"wheelDeltaX"in o&&(l=-o.wheelDeltaX/120),"axis"in o&&o.axis===o.HORIZONTAL_AXIS&&(l=c,c=0),u=l*t,m=c*t,"deltaY"in o&&(m=o.deltaY),"deltaX"in o&&(u=o.deltaX),(u||m)&&o.deltaMode&&(o.deltaMode==1?(u*=r,m*=r):(u*=a,m*=a)),u&&!l&&(l=u<1?-1:1),m&&!c&&(c=m<1?-1:1),{spinX:l,spinY:c,pixelX:u,pixelY:m}}return i.getEventType=function(){return s.firefox()?"DOMMouseScroll":n("wheel")?"wheel":"mousewheel"},tt=i,tt}var st,Vt;function _n(){return Vt||(Vt=1,st=Cn()),st}var An=_n();const Pn=hr(An);function En(s,n,t,r,a,i){i===void 0&&(i=0);var o=ue(s,n,i),l=o.width,c=o.height,u=Math.min(l,t),m=Math.min(c,r);return u>m*a?{width:m*a,height:m}:{width:u,height:u/a}}function Dn(s){return s.width>s.height?s.width/s.naturalWidth:s.height/s.naturalHeight}function be(s,n,t,r,a){a===void 0&&(a=0);var i=ue(n.width,n.height,a),o=i.width,l=i.height;return{x:Ht(s.x,o,t.width,r),y:Ht(s.y,l,t.height,r)}}function Ht(s,n,t,r){var a=n*r/2-t/2;return Ke(s,-a,a)}function Zt(s,n){return Math.sqrt(Math.pow(s.y-n.y,2)+Math.pow(s.x-n.x,2))}function Gt(s,n){return Math.atan2(n.y-s.y,n.x-s.x)*180/Math.PI}function kn(s,n,t,r,a,i,o){i===void 0&&(i=0),o===void 0&&(o=!0);var l=o?Rn:Tn,c=ue(n.width,n.height,i),u=ue(n.naturalWidth,n.naturalHeight,i),m={x:l(100,((c.width-t.width/a)/2-s.x/a)/c.width*100),y:l(100,((c.height-t.height/a)/2-s.y/a)/c.height*100),width:l(100,t.width/c.width*100/a),height:l(100,t.height/c.height*100/a)},d=Math.round(l(u.width,m.width*u.width/100)),b=Math.round(l(u.height,m.height*u.height/100)),f=u.width>=u.height*r,x=f?{width:Math.round(b*r),height:b}:{width:d,height:Math.round(d/r)},h=U(U({},x),{x:Math.round(l(u.width-x.width,m.x*u.width/100)),y:Math.round(l(u.height-x.height,m.y*u.height/100))});return{croppedAreaPercentages:m,croppedAreaPixels:h}}function Rn(s,n){return Math.min(s,Math.max(0,n))}function Tn(s,n){return n}function Mn(s,n,t,r,a,i){var o=ue(n.width,n.height,t),l=Ke(r.width/o.width*(100/s.width),a,i),c={x:l*o.width/2-r.width/2-o.width*l*(s.x/100),y:l*o.height/2-r.height/2-o.height*l*(s.y/100)};return{crop:c,zoom:l}}function Bn(s,n,t){var r=Dn(n);return t.height>t.width?t.height/(s.height*r):t.width/(s.width*r)}function qn(s,n,t,r,a,i){t===void 0&&(t=0);var o=ue(n.naturalWidth,n.naturalHeight,t),l=Ke(Bn(s,n,r),a,i),c=r.height>r.width?r.height/s.height:r.width/s.width,u={x:((o.width-s.width)/2-s.x)*c,y:((o.height-s.height)/2-s.y)*c};return{crop:u,zoom:l}}function Yt(s,n){return{x:(n.x+s.x)/2,y:(n.y+s.y)/2}}function On(s){return s*Math.PI/180}function ue(s,n,t){var r=On(t);return{width:Math.abs(Math.cos(r)*s)+Math.abs(Math.sin(r)*n),height:Math.abs(Math.sin(r)*s)+Math.abs(Math.cos(r)*n)}}function Ke(s,n,t){return Math.min(Math.max(s,n),t)}function qe(){for(var s=[],n=0;n<arguments.length;n++)s[n]=arguments[n];return s.filter(function(t){return typeof t=="string"&&t.length>0}).join(" ").trim()}var zn=`.reactEasyCrop_Container {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  overflow: hidden;
  user-select: none;
  touch-action: none;
  cursor: move;
  display: flex;
  justify-content: center;
  align-items: center;
}

.reactEasyCrop_Image,
.reactEasyCrop_Video {
  will-change: transform; /* this improves performances and prevent painting issues on iOS Chrome */
}

.reactEasyCrop_Contain {
  max-width: 100%;
  max-height: 100%;
  margin: auto;
  position: absolute;
  top: 0;
  bottom: 0;
  left: 0;
  right: 0;
}
.reactEasyCrop_Cover_Horizontal {
  width: 100%;
  height: auto;
}
.reactEasyCrop_Cover_Vertical {
  width: auto;
  height: 100%;
}

.reactEasyCrop_CropArea {
  position: absolute;
  left: 50%;
  top: 50%;
  transform: translate(-50%, -50%);
  border: 1px solid rgba(255, 255, 255, 0.5);
  box-sizing: border-box;
  box-shadow: 0 0 0 9999em;
  color: rgba(0, 0, 0, 0.5);
  overflow: hidden;
}

.reactEasyCrop_CropAreaRound {
  border-radius: 50%;
}

.reactEasyCrop_CropAreaGrid::before {
  content: ' ';
  box-sizing: border-box;
  position: absolute;
  border: 1px solid rgba(255, 255, 255, 0.5);
  top: 0;
  bottom: 0;
  left: 33.33%;
  right: 33.33%;
  border-top: 0;
  border-bottom: 0;
}

.reactEasyCrop_CropAreaGrid::after {
  content: ' ';
  box-sizing: border-box;
  position: absolute;
  border: 1px solid rgba(255, 255, 255, 0.5);
  top: 33.33%;
  bottom: 33.33%;
  left: 0;
  right: 0;
  border-left: 0;
  border-right: 0;
}
`,Ln=1,In=3,Fn=1,Un=(function(s){pr(n,s);function n(){var t=s!==null&&s.apply(this,arguments)||this;return t.cropperRef=p.createRef(),t.imageRef=p.createRef(),t.videoRef=p.createRef(),t.containerPosition={x:0,y:0},t.containerRef=null,t.styleRef=null,t.containerRect=null,t.mediaSize={width:0,height:0,naturalWidth:0,naturalHeight:0},t.dragStartPosition={x:0,y:0},t.dragStartCrop={x:0,y:0},t.gestureZoomStart=0,t.gestureRotationStart=0,t.isTouching=!1,t.lastPinchDistance=0,t.lastPinchRotation=0,t.rafDragTimeout=null,t.rafPinchTimeout=null,t.wheelTimer=null,t.currentDoc=typeof document<"u"?document:null,t.currentWindow=typeof window<"u"?window:null,t.resizeObserver=null,t.previousCropSize=null,t.isInitialized=!1,t.state={cropSize:null,hasWheelJustStarted:!1,mediaObjectFit:void 0},t.initResizeObserver=function(){if(!(typeof window.ResizeObserver>"u"||!t.containerRef)){var r=!0;t.resizeObserver=new window.ResizeObserver(function(a){if(r){r=!1;return}t.computeSizes()}),t.resizeObserver.observe(t.containerRef)}},t.preventZoomSafari=function(r){return r.preventDefault()},t.cleanEvents=function(){t.currentDoc&&(t.currentDoc.removeEventListener("mousemove",t.onMouseMove),t.currentDoc.removeEventListener("mouseup",t.onDragStopped),t.currentDoc.removeEventListener("touchmove",t.onTouchMove),t.currentDoc.removeEventListener("touchend",t.onDragStopped),t.currentDoc.removeEventListener("gesturechange",t.onGestureChange),t.currentDoc.removeEventListener("gestureend",t.onGestureEnd),t.currentDoc.removeEventListener("scroll",t.onScroll))},t.clearScrollEvent=function(){t.containerRef&&t.containerRef.removeEventListener("wheel",t.onWheel),t.wheelTimer&&clearTimeout(t.wheelTimer)},t.onMediaLoad=function(){var r=t.computeSizes();r&&(t.previousCropSize=r,t.emitCropData(),t.setInitialCrop(r),t.isInitialized=!0),t.props.onMediaLoaded&&t.props.onMediaLoaded(t.mediaSize)},t.setInitialCrop=function(r){if(t.props.initialCroppedAreaPercentages){var a=Mn(t.props.initialCroppedAreaPercentages,t.mediaSize,t.props.rotation,r,t.props.minZoom,t.props.maxZoom),i=a.crop,o=a.zoom;t.props.onCropChange(i),t.props.onZoomChange&&t.props.onZoomChange(o)}else if(t.props.initialCroppedAreaPixels){var l=qn(t.props.initialCroppedAreaPixels,t.mediaSize,t.props.rotation,r,t.props.minZoom,t.props.maxZoom),i=l.crop,o=l.zoom;t.props.onCropChange(i),t.props.onZoomChange&&t.props.onZoomChange(o)}},t.computeSizes=function(){var r,a,i,o,l,c,u=t.imageRef.current||t.videoRef.current;if(u&&t.containerRef){t.containerRect=t.containerRef.getBoundingClientRect(),t.saveContainerPosition();var m=t.containerRect.width/t.containerRect.height,d=((r=t.imageRef.current)===null||r===void 0?void 0:r.naturalWidth)||((a=t.videoRef.current)===null||a===void 0?void 0:a.videoWidth)||0,b=((i=t.imageRef.current)===null||i===void 0?void 0:i.naturalHeight)||((o=t.videoRef.current)===null||o===void 0?void 0:o.videoHeight)||0,f=u.offsetWidth<d||u.offsetHeight<b,x=d/b,h=void 0;if(f)switch(t.state.mediaObjectFit){default:case"contain":h=m>x?{width:t.containerRect.height*x,height:t.containerRect.height}:{width:t.containerRect.width,height:t.containerRect.width/x};break;case"horizontal-cover":h={width:t.containerRect.width,height:t.containerRect.width/x};break;case"vertical-cover":h={width:t.containerRect.height*x,height:t.containerRect.height};break}else h={width:u.offsetWidth,height:u.offsetHeight};t.mediaSize=U(U({},h),{naturalWidth:d,naturalHeight:b}),t.props.setMediaSize&&t.props.setMediaSize(t.mediaSize);var y=t.props.cropSize?t.props.cropSize:En(t.mediaSize.width,t.mediaSize.height,t.containerRect.width,t.containerRect.height,t.props.aspect,t.props.rotation);return(((l=t.state.cropSize)===null||l===void 0?void 0:l.height)!==y.height||((c=t.state.cropSize)===null||c===void 0?void 0:c.width)!==y.width)&&t.props.onCropSizeChange&&t.props.onCropSizeChange(y),t.setState({cropSize:y},t.recomputeCropPosition),t.props.setCropSize&&t.props.setCropSize(y),y}},t.saveContainerPosition=function(){if(t.containerRef){var r=t.containerRef.getBoundingClientRect();t.containerPosition={x:r.left,y:r.top}}},t.onMouseDown=function(r){t.currentDoc&&(r.preventDefault(),t.currentDoc.addEventListener("mousemove",t.onMouseMove),t.currentDoc.addEventListener("mouseup",t.onDragStopped),t.saveContainerPosition(),t.onDragStart(n.getMousePoint(r)))},t.onMouseMove=function(r){return t.onDrag(n.getMousePoint(r))},t.onScroll=function(r){t.currentDoc&&(r.preventDefault(),t.saveContainerPosition())},t.onTouchStart=function(r){t.currentDoc&&(t.isTouching=!0,!(t.props.onTouchRequest&&!t.props.onTouchRequest(r))&&(t.currentDoc.addEventListener("touchmove",t.onTouchMove,{passive:!1}),t.currentDoc.addEventListener("touchend",t.onDragStopped),t.saveContainerPosition(),r.touches.length===2?t.onPinchStart(r):r.touches.length===1&&t.onDragStart(n.getTouchPoint(r.touches[0]))))},t.onTouchMove=function(r){r.preventDefault(),r.touches.length===2?t.onPinchMove(r):r.touches.length===1&&t.onDrag(n.getTouchPoint(r.touches[0]))},t.onGestureStart=function(r){t.currentDoc&&(r.preventDefault(),t.currentDoc.addEventListener("gesturechange",t.onGestureChange),t.currentDoc.addEventListener("gestureend",t.onGestureEnd),t.gestureZoomStart=t.props.zoom,t.gestureRotationStart=t.props.rotation)},t.onGestureChange=function(r){if(r.preventDefault(),!t.isTouching){var a=n.getMousePoint(r),i=t.gestureZoomStart-1+r.scale;if(t.setNewZoom(i,a,{shouldUpdatePosition:!0}),t.props.onRotationChange){var o=t.gestureRotationStart+r.rotation;t.props.onRotationChange(o)}}},t.onGestureEnd=function(r){t.cleanEvents()},t.onDragStart=function(r){var a,i,o=r.x,l=r.y;t.dragStartPosition={x:o,y:l},t.dragStartCrop=U({},t.props.crop),(i=(a=t.props).onInteractionStart)===null||i===void 0||i.call(a)},t.onDrag=function(r){var a=r.x,i=r.y;t.currentWindow&&(t.rafDragTimeout&&t.currentWindow.cancelAnimationFrame(t.rafDragTimeout),t.rafDragTimeout=t.currentWindow.requestAnimationFrame(function(){if(t.state.cropSize&&!(a===void 0||i===void 0)){var o=a-t.dragStartPosition.x,l=i-t.dragStartPosition.y,c={x:t.dragStartCrop.x+o,y:t.dragStartCrop.y+l},u=t.props.restrictPosition?be(c,t.mediaSize,t.state.cropSize,t.props.zoom,t.props.rotation):c;t.props.onCropChange(u)}}))},t.onDragStopped=function(){var r,a;t.isTouching=!1,t.cleanEvents(),t.emitCropData(),(a=(r=t.props).onInteractionEnd)===null||a===void 0||a.call(r)},t.onWheel=function(r){if(t.currentWindow&&!(t.props.onWheelRequest&&!t.props.onWheelRequest(r))){r.preventDefault();var a=n.getMousePoint(r),i=Pn(r).pixelY,o=t.props.zoom-i*t.props.zoomSpeed/200;t.setNewZoom(o,a,{shouldUpdatePosition:!0}),t.state.hasWheelJustStarted||t.setState({hasWheelJustStarted:!0},function(){var l,c;return(c=(l=t.props).onInteractionStart)===null||c===void 0?void 0:c.call(l)}),t.wheelTimer&&clearTimeout(t.wheelTimer),t.wheelTimer=t.currentWindow.setTimeout(function(){return t.setState({hasWheelJustStarted:!1},function(){var l,c;return(c=(l=t.props).onInteractionEnd)===null||c===void 0?void 0:c.call(l)})},250)}},t.getPointOnContainer=function(r,a){var i=r.x,o=r.y;if(!t.containerRect)throw new Error("The Cropper is not mounted");return{x:t.containerRect.width/2-(i-a.x),y:t.containerRect.height/2-(o-a.y)}},t.getPointOnMedia=function(r){var a=r.x,i=r.y,o=t.props,l=o.crop,c=o.zoom;return{x:(a+l.x)/c,y:(i+l.y)/c}},t.setNewZoom=function(r,a,i){var o=i===void 0?{}:i,l=o.shouldUpdatePosition,c=l===void 0?!0:l;if(!(!t.state.cropSize||!t.props.onZoomChange)){var u=Ke(r,t.props.minZoom,t.props.maxZoom);if(c){var m=t.getPointOnContainer(a,t.containerPosition),d=t.getPointOnMedia(m),b={x:d.x*u-m.x,y:d.y*u-m.y},f=t.props.restrictPosition?be(b,t.mediaSize,t.state.cropSize,u,t.props.rotation):b;t.props.onCropChange(f)}t.props.onZoomChange(u)}},t.getCropData=function(){if(!t.state.cropSize)return null;var r=t.props.restrictPosition?be(t.props.crop,t.mediaSize,t.state.cropSize,t.props.zoom,t.props.rotation):t.props.crop;return kn(r,t.mediaSize,t.state.cropSize,t.getAspect(),t.props.zoom,t.props.rotation,t.props.restrictPosition)},t.emitCropData=function(){var r=t.getCropData();if(r){var a=r.croppedAreaPercentages,i=r.croppedAreaPixels;t.props.onCropComplete&&t.props.onCropComplete(a,i),t.props.onCropAreaChange&&t.props.onCropAreaChange(a,i)}},t.emitCropAreaChange=function(){var r=t.getCropData();if(r){var a=r.croppedAreaPercentages,i=r.croppedAreaPixels;t.props.onCropAreaChange&&t.props.onCropAreaChange(a,i)}},t.recomputeCropPosition=function(){var r,a;if(t.state.cropSize){var i=t.props.crop;if(t.isInitialized&&(!((r=t.previousCropSize)===null||r===void 0)&&r.width)&&(!((a=t.previousCropSize)===null||a===void 0)&&a.height)){var o=Math.abs(t.previousCropSize.width-t.state.cropSize.width)>1e-6||Math.abs(t.previousCropSize.height-t.state.cropSize.height)>1e-6;if(o){var l=t.state.cropSize.width/t.previousCropSize.width,c=t.state.cropSize.height/t.previousCropSize.height;i={x:t.props.crop.x*l,y:t.props.crop.y*c}}}var u=t.props.restrictPosition?be(i,t.mediaSize,t.state.cropSize,t.props.zoom,t.props.rotation):i;t.previousCropSize=t.state.cropSize,t.props.onCropChange(u),t.emitCropData()}},t.onKeyDown=function(r){var a,i,o=t.props,l=o.crop,c=o.onCropChange,u=o.keyboardStep,m=o.zoom,d=o.rotation,b=u;if(t.state.cropSize){r.shiftKey&&(b*=.2);var f=U({},l);switch(r.key){case"ArrowUp":f.y-=b,r.preventDefault();break;case"ArrowDown":f.y+=b,r.preventDefault();break;case"ArrowLeft":f.x-=b,r.preventDefault();break;case"ArrowRight":f.x+=b,r.preventDefault();break;default:return}t.props.restrictPosition&&(f=be(f,t.mediaSize,t.state.cropSize,m,d)),r.repeat||(i=(a=t.props).onInteractionStart)===null||i===void 0||i.call(a),c(f)}},t.onKeyUp=function(r){var a,i;switch(r.key){case"ArrowUp":case"ArrowDown":case"ArrowLeft":case"ArrowRight":r.preventDefault();break;default:return}t.emitCropData(),(i=(a=t.props).onInteractionEnd)===null||i===void 0||i.call(a)},t}return n.prototype.componentDidMount=function(){!this.currentDoc||!this.currentWindow||(this.containerRef&&(this.containerRef.ownerDocument&&(this.currentDoc=this.containerRef.ownerDocument),this.currentDoc.defaultView&&(this.currentWindow=this.currentDoc.defaultView),this.initResizeObserver(),typeof window.ResizeObserver>"u"&&this.currentWindow.addEventListener("resize",this.computeSizes),this.props.zoomWithScroll&&this.containerRef.addEventListener("wheel",this.onWheel,{passive:!1}),this.containerRef.addEventListener("gesturestart",this.onGestureStart)),this.currentDoc.addEventListener("scroll",this.onScroll),this.props.disableAutomaticStylesInjection||(this.styleRef=this.currentDoc.createElement("style"),this.styleRef.setAttribute("type","text/css"),this.props.nonce&&this.styleRef.setAttribute("nonce",this.props.nonce),this.styleRef.innerHTML=zn,this.currentDoc.head.appendChild(this.styleRef)),this.imageRef.current&&this.imageRef.current.complete&&this.onMediaLoad(),this.props.setImageRef&&this.props.setImageRef(this.imageRef),this.props.setVideoRef&&this.props.setVideoRef(this.videoRef),this.props.setCropperRef&&this.props.setCropperRef(this.cropperRef))},n.prototype.componentWillUnmount=function(){var t,r;!this.currentDoc||!this.currentWindow||(typeof window.ResizeObserver>"u"&&this.currentWindow.removeEventListener("resize",this.computeSizes),(t=this.resizeObserver)===null||t===void 0||t.disconnect(),this.containerRef&&this.containerRef.removeEventListener("gesturestart",this.preventZoomSafari),this.styleRef&&((r=this.styleRef.parentNode)===null||r===void 0||r.removeChild(this.styleRef)),this.cleanEvents(),this.props.zoomWithScroll&&this.clearScrollEvent())},n.prototype.componentDidUpdate=function(t){var r,a,i,o,l,c,u,m,d;t.rotation!==this.props.rotation?(this.computeSizes(),this.recomputeCropPosition()):t.aspect!==this.props.aspect?this.computeSizes():t.objectFit!==this.props.objectFit?this.computeSizes():t.zoom!==this.props.zoom?this.recomputeCropPosition():((r=t.cropSize)===null||r===void 0?void 0:r.height)!==((a=this.props.cropSize)===null||a===void 0?void 0:a.height)||((i=t.cropSize)===null||i===void 0?void 0:i.width)!==((o=this.props.cropSize)===null||o===void 0?void 0:o.width)?this.computeSizes():(((l=t.crop)===null||l===void 0?void 0:l.x)!==((c=this.props.crop)===null||c===void 0?void 0:c.x)||((u=t.crop)===null||u===void 0?void 0:u.y)!==((m=this.props.crop)===null||m===void 0?void 0:m.y))&&this.emitCropAreaChange(),t.zoomWithScroll!==this.props.zoomWithScroll&&this.containerRef&&(this.props.zoomWithScroll?this.containerRef.addEventListener("wheel",this.onWheel,{passive:!1}):this.clearScrollEvent()),t.video!==this.props.video&&((d=this.videoRef.current)===null||d===void 0||d.load());var b=this.getObjectFit();b!==this.state.mediaObjectFit&&this.setState({mediaObjectFit:b},this.computeSizes)},n.prototype.getAspect=function(){var t=this.props,r=t.cropSize,a=t.aspect;return r?r.width/r.height:a},n.prototype.getObjectFit=function(){var t,r,a,i;if(this.props.objectFit==="cover"){var o=this.imageRef.current||this.videoRef.current;if(o&&this.containerRef){this.containerRect=this.containerRef.getBoundingClientRect();var l=this.containerRect.width/this.containerRect.height,c=((t=this.imageRef.current)===null||t===void 0?void 0:t.naturalWidth)||((r=this.videoRef.current)===null||r===void 0?void 0:r.videoWidth)||0,u=((a=this.imageRef.current)===null||a===void 0?void 0:a.naturalHeight)||((i=this.videoRef.current)===null||i===void 0?void 0:i.videoHeight)||0,m=c/u;return m<l?"horizontal-cover":"vertical-cover"}return"horizontal-cover"}return this.props.objectFit},n.prototype.onPinchStart=function(t){var r=n.getTouchPoint(t.touches[0]),a=n.getTouchPoint(t.touches[1]);this.lastPinchDistance=Zt(r,a),this.lastPinchRotation=Gt(r,a),this.onDragStart(Yt(r,a))},n.prototype.onPinchMove=function(t){var r=this;if(!(!this.currentDoc||!this.currentWindow)){var a=n.getTouchPoint(t.touches[0]),i=n.getTouchPoint(t.touches[1]),o=Yt(a,i);this.onDrag(o),this.rafPinchTimeout&&this.currentWindow.cancelAnimationFrame(this.rafPinchTimeout),this.rafPinchTimeout=this.currentWindow.requestAnimationFrame(function(){var l=Zt(a,i),c=r.props.zoom*(l/r.lastPinchDistance);r.setNewZoom(c,o,{shouldUpdatePosition:!1}),r.lastPinchDistance=l;var u=Gt(a,i),m=r.props.rotation+(u-r.lastPinchRotation);r.props.onRotationChange&&r.props.onRotationChange(m),r.lastPinchRotation=u})}},n.prototype.render=function(){var t=this,r,a=this.props,i=a.image,o=a.video,l=a.mediaProps,c=a.cropperProps,u=a.transform,m=a.crop,d=m.x,b=m.y,f=a.rotation,x=a.zoom,h=a.cropShape,y=a.showGrid,j=a.roundCropAreaPixels,g=a.style,w=g.containerStyle,S=g.cropAreaStyle,P=g.mediaStyle,k=a.classes,L=k.containerClassName,M=k.cropAreaClassName,I=k.mediaClassName,C=(r=this.state.mediaObjectFit)!==null&&r!==void 0?r:this.getObjectFit();return p.createElement("div",{onMouseDown:this.onMouseDown,onTouchStart:this.onTouchStart,ref:function(_){return t.containerRef=_},"data-testid":"container",style:w,className:qe("reactEasyCrop_Container",L)},i?p.createElement("img",U({alt:"",className:qe("reactEasyCrop_Image",C==="contain"&&"reactEasyCrop_Contain",C==="horizontal-cover"&&"reactEasyCrop_Cover_Horizontal",C==="vertical-cover"&&"reactEasyCrop_Cover_Vertical",I)},l,{src:i,ref:this.imageRef,style:U(U({},P),{transform:u||"translate(".concat(d,"px, ").concat(b,"px) rotate(").concat(f,"deg) scale(").concat(x,")")}),onLoad:this.onMediaLoad})):o&&p.createElement("video",U({autoPlay:!0,playsInline:!0,loop:!0,muted:!0,className:qe("reactEasyCrop_Video",C==="contain"&&"reactEasyCrop_Contain",C==="horizontal-cover"&&"reactEasyCrop_Cover_Horizontal",C==="vertical-cover"&&"reactEasyCrop_Cover_Vertical",I)},l,{ref:this.videoRef,onLoadedMetadata:this.onMediaLoad,style:U(U({},P),{transform:u||"translate(".concat(d,"px, ").concat(b,"px) rotate(").concat(f,"deg) scale(").concat(x,")")}),controls:!1}),(Array.isArray(o)?o:[{src:o}]).map(function(E){return p.createElement("source",U({key:E.src},E))})),this.state.cropSize&&p.createElement("div",U({ref:this.cropperRef,style:U(U({},S),{width:j?Math.round(this.state.cropSize.width):this.state.cropSize.width,height:j?Math.round(this.state.cropSize.height):this.state.cropSize.height}),tabIndex:0,onKeyDown:this.onKeyDown,onKeyUp:this.onKeyUp,"data-testid":"cropper",className:qe("reactEasyCrop_CropArea",h==="round"&&"reactEasyCrop_CropAreaRound",y&&"reactEasyCrop_CropAreaGrid",M)},c)))},n.defaultProps={zoom:1,rotation:0,aspect:4/3,maxZoom:In,minZoom:Ln,cropShape:"rect",objectFit:"contain",showGrid:!0,style:{},classes:{},mediaProps:{},cropperProps:{},zoomSpeed:1,restrictPosition:!0,zoomWithScroll:!0,keyboardStep:Fn},n.getMousePoint=function(t){return{x:Number(t.clientX),y:Number(t.clientY)}},n.getTouchPoint=function(t){return{x:Number(t.clientX),y:Number(t.clientY)}},n})(p.Component);function oe(s,n,{checkForDefaultPrevented:t=!0}={}){return function(a){if(s?.(a),t===!1||!a.defaultPrevented)return n?.(a)}}var $n=Xs[" useInsertionEffect ".trim().toString()]||Js;function Wn({prop:s,defaultProp:n,onChange:t=()=>{},caller:r}){const[a,i,o]=Kn({defaultProp:n,onChange:t}),l=s!==void 0,c=l?s:a;{const m=p.useRef(s!==void 0);p.useEffect(()=>{const d=m.current;d!==l&&console.warn(`${r} is changing from ${d?"controlled":"uncontrolled"} to ${l?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),m.current=l},[l,r])}const u=p.useCallback(m=>{if(l){const d=Vn(m)?m(s):m;d!==s&&o.current?.(d)}else i(m)},[l,s,i,o]);return[c,u]}function Kn({defaultProp:s,onChange:n}){const[t,r]=p.useState(s),a=p.useRef(t),i=p.useRef(n);return $n(()=>{i.current=n},[n]),p.useEffect(()=>{a.current!==t&&(i.current?.(t),a.current=t)},[t,a]),[t,r,i]}function Vn(s){return typeof s=="function"}var Ps=["PageUp","PageDown"],Es=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],Ds={"from-left":["Home","PageDown","ArrowDown","ArrowLeft"],"from-right":["Home","PageDown","ArrowDown","ArrowRight"],"from-bottom":["Home","PageDown","ArrowDown","ArrowLeft"],"from-top":["Home","PageDown","ArrowUp","ArrowLeft"]},he="Slider",[ht,Hn,Zn]=wr(he),[ks]=er(he,[Zn]),[Gn,Ve]=ks(he),Rs=p.forwardRef((s,n)=>{const{name:t,min:r=0,max:a=100,step:i=1,orientation:o="horizontal",disabled:l=!1,minStepsBetweenThumbs:c=0,defaultValue:u=[r],value:m,onValueChange:d=()=>{},onValueCommit:b=()=>{},inverted:f=!1,form:x,...h}=s,y=p.useRef(new Set),j=p.useRef(0),w=o==="horizontal"?Yn:Qn,[S=[],P]=Wn({prop:m,defaultProp:u,onChange:E=>{[...y.current][j.current]?.focus(),d(E)}}),k=p.useRef(S);function L(E){const _=sa(S,E);C(E,_)}function M(E){C(E,j.current)}function I(){const E=k.current[j.current];S[j.current]!==E&&b(S)}function C(E,_,{commit:z}={commit:!1}){const D=ia(i),R=oa(Math.round((E-r)/i)*i+r,D),Z=ps(R,[r,a]);P((W=[])=>{const $=ea(W,Z,_);if(aa($,c*i)){j.current=$.indexOf(Z);const G=String($)!==String(W);return G&&z&&b($),G?$:W}else return W})}return e.jsx(Gn,{scope:s.__scopeSlider,name:t,disabled:l,min:r,max:a,valueIndexToChangeRef:j,thumbs:y.current,values:S,orientation:o,form:x,children:e.jsx(ht.Provider,{scope:s.__scopeSlider,children:e.jsx(ht.Slot,{scope:s.__scopeSlider,children:e.jsx(w,{"aria-disabled":l,"data-disabled":l?"":void 0,...h,ref:n,onPointerDown:oe(h.onPointerDown,()=>{l||(k.current=S)}),min:r,max:a,inverted:f,onSlideStart:l?void 0:L,onSlideMove:l?void 0:M,onSlideEnd:l?void 0:I,onHomeKeyDown:()=>!l&&C(r,0,{commit:!0}),onEndKeyDown:()=>!l&&C(a,S.length-1,{commit:!0}),onStepKeyDown:({event:E,direction:_})=>{if(!l){const R=Ps.includes(E.key)||E.shiftKey&&Es.includes(E.key)?10:1,Z=j.current,W=S[Z],$=i*R*_;C(W+$,Z,{commit:!0})}}})})})})});Rs.displayName=he;var[Ts,Ms]=ks(he,{startEdge:"left",endEdge:"right",size:"width",direction:1}),Yn=p.forwardRef((s,n)=>{const{min:t,max:r,dir:a,inverted:i,onSlideStart:o,onSlideMove:l,onSlideEnd:c,onStepKeyDown:u,...m}=s,[d,b]=p.useState(null),f=me(n,w=>b(w)),x=p.useRef(void 0),h=yr(a),y=h==="ltr",j=y&&!i||!y&&i;function g(w){const S=x.current||d.getBoundingClientRect(),P=[0,S.width],L=At(P,j?[t,r]:[r,t]);return x.current=S,L(w-S.left)}return e.jsx(Ts,{scope:s.__scopeSlider,startEdge:j?"left":"right",endEdge:j?"right":"left",direction:j?1:-1,size:"width",children:e.jsx(Bs,{dir:h,"data-orientation":"horizontal",...m,ref:f,style:{...m.style,"--radix-slider-thumb-transform":"translateX(-50%)"},onSlideStart:w=>{const S=g(w.clientX);o?.(S)},onSlideMove:w=>{const S=g(w.clientX);l?.(S)},onSlideEnd:()=>{x.current=void 0,c?.()},onStepKeyDown:w=>{const P=Ds[j?"from-left":"from-right"].includes(w.key);u?.({event:w,direction:P?-1:1})}})})}),Qn=p.forwardRef((s,n)=>{const{min:t,max:r,inverted:a,onSlideStart:i,onSlideMove:o,onSlideEnd:l,onStepKeyDown:c,...u}=s,m=p.useRef(null),d=me(n,m),b=p.useRef(void 0),f=!a;function x(h){const y=b.current||m.current.getBoundingClientRect(),j=[0,y.height],w=At(j,f?[r,t]:[t,r]);return b.current=y,w(h-y.top)}return e.jsx(Ts,{scope:s.__scopeSlider,startEdge:f?"bottom":"top",endEdge:f?"top":"bottom",size:"height",direction:f?1:-1,children:e.jsx(Bs,{"data-orientation":"vertical",...u,ref:d,style:{...u.style,"--radix-slider-thumb-transform":"translateY(50%)"},onSlideStart:h=>{const y=x(h.clientY);i?.(y)},onSlideMove:h=>{const y=x(h.clientY);o?.(y)},onSlideEnd:()=>{b.current=void 0,l?.()},onStepKeyDown:h=>{const j=Ds[f?"from-bottom":"from-top"].includes(h.key);c?.({event:h,direction:j?-1:1})}})})}),Bs=p.forwardRef((s,n)=>{const{__scopeSlider:t,onSlideStart:r,onSlideMove:a,onSlideEnd:i,onHomeKeyDown:o,onEndKeyDown:l,onStepKeyDown:c,...u}=s,m=Ve(he,t);return e.jsx(Ce.span,{...u,ref:n,onKeyDown:oe(s.onKeyDown,d=>{d.key==="Home"?(o(d),d.preventDefault()):d.key==="End"?(l(d),d.preventDefault()):Ps.concat(Es).includes(d.key)&&(c(d),d.preventDefault())}),onPointerDown:oe(s.onPointerDown,d=>{const b=d.target;b.setPointerCapture(d.pointerId),d.preventDefault(),m.thumbs.has(b)?b.focus():r(d)}),onPointerMove:oe(s.onPointerMove,d=>{d.target.hasPointerCapture(d.pointerId)&&a(d)}),onPointerUp:oe(s.onPointerUp,d=>{const b=d.target;b.hasPointerCapture(d.pointerId)&&(b.releasePointerCapture(d.pointerId),i(d))})})}),qs="SliderTrack",Os=p.forwardRef((s,n)=>{const{__scopeSlider:t,...r}=s,a=Ve(qs,t);return e.jsx(Ce.span,{"data-disabled":a.disabled?"":void 0,"data-orientation":a.orientation,...r,ref:n})});Os.displayName=qs;var ft="SliderRange",zs=p.forwardRef((s,n)=>{const{__scopeSlider:t,...r}=s,a=Ve(ft,t),i=Ms(ft,t),o=p.useRef(null),l=me(n,o),c=a.values.length,u=a.values.map(b=>Fs(b,a.min,a.max)),m=c>1?Math.min(...u):0,d=100-Math.max(...u);return e.jsx(Ce.span,{"data-orientation":a.orientation,"data-disabled":a.disabled?"":void 0,...r,ref:l,style:{...s.style,[i.startEdge]:m+"%",[i.endEdge]:d+"%"}})});zs.displayName=ft;var xt="SliderThumb",Ls=p.forwardRef((s,n)=>{const t=Hn(s.__scopeSlider),[r,a]=p.useState(null),i=me(n,l=>a(l)),o=p.useMemo(()=>r?t().findIndex(l=>l.ref.current===r):-1,[t,r]);return e.jsx(Xn,{...s,ref:i,index:o})}),Xn=p.forwardRef((s,n)=>{const{__scopeSlider:t,index:r,name:a,...i}=s,o=Ve(xt,t),l=Ms(xt,t),[c,u]=p.useState(null),m=me(n,g=>u(g)),d=c?o.form||!!c.closest("form"):!0,b=tr(c),f=o.values[r],x=f===void 0?0:Fs(f,o.min,o.max),h=ta(r,o.values.length),y=b?.[l.size],j=y?ra(y,x,l.direction):0;return p.useEffect(()=>{if(c)return o.thumbs.add(c),()=>{o.thumbs.delete(c)}},[c,o.thumbs]),e.jsxs("span",{style:{transform:"var(--radix-slider-thumb-transform)",position:"absolute",[l.startEdge]:`calc(${x}% + ${j}px)`},children:[e.jsx(ht.ItemSlot,{scope:s.__scopeSlider,children:e.jsx(Ce.span,{role:"slider","aria-label":s["aria-label"]||h,"aria-valuemin":o.min,"aria-valuenow":f,"aria-valuemax":o.max,"aria-orientation":o.orientation,"data-orientation":o.orientation,"data-disabled":o.disabled?"":void 0,tabIndex:o.disabled?void 0:0,...i,ref:m,style:f===void 0?{display:"none"}:s.style,onFocus:oe(s.onFocus,()=>{o.valueIndexToChangeRef.current=r})})}),d&&e.jsx(Is,{name:a??(o.name?o.name+(o.values.length>1?"[]":""):void 0),form:o.form,value:f},r)]})});Ls.displayName=xt;var Jn="RadioBubbleInput",Is=p.forwardRef(({__scopeSlider:s,value:n,...t},r)=>{const a=p.useRef(null),i=me(a,r),o=jr(n);return p.useEffect(()=>{const l=a.current;if(!l)return;const c=window.HTMLInputElement.prototype,m=Object.getOwnPropertyDescriptor(c,"value").set;if(o!==n&&m){const d=new Event("input",{bubbles:!0});m.call(l,n),l.dispatchEvent(d)}},[o,n]),e.jsx(Ce.input,{style:{display:"none"},...t,ref:i,defaultValue:n})});Is.displayName=Jn;function ea(s=[],n,t){const r=[...s];return r[t]=n,r.sort((a,i)=>a-i)}function Fs(s,n,t){const i=100/(t-n)*(s-n);return ps(i,[0,100])}function ta(s,n){return n>2?`Value ${s+1} of ${n}`:n===2?["Minimum","Maximum"][s]:void 0}function sa(s,n){if(s.length===1)return 0;const t=s.map(a=>Math.abs(a-n)),r=Math.min(...t);return t.indexOf(r)}function ra(s,n,t){const r=s/2,i=At([0,50],[0,r]);return(r-i(n)*t)*t}function na(s){return s.slice(0,-1).map((n,t)=>s[t+1]-n)}function aa(s,n){if(n>0){const t=na(s);return Math.min(...t)>=n}return!0}function At(s,n){return t=>{if(s[0]===s[1]||n[0]===n[1])return n[0];const r=(n[1]-n[0])/(s[1]-s[0]);return n[0]+r*(t-s[0])}}function ia(s){return(String(s).split(".")[1]||"").length}function oa(s,n){const t=Math.pow(10,n);return Math.round(s*t)/t}var Us=Rs,la=Os,ca=zs,da=Ls;const $s=p.forwardRef(({className:s,trackClassName:n,rangeClassName:t,trackStyle:r,rangeStyle:a,...i},o)=>e.jsxs(Us,{ref:o,className:Ge("relative flex w-full touch-none select-none items-center",s),...i,children:[e.jsx(la,{className:Ge("relative h-1.5 w-full grow overflow-hidden rounded-full bg-primary/20",n),style:r,children:e.jsx(ca,{className:Ge("absolute h-full bg-primary",t),style:a})}),e.jsx(da,{className:"block h-4 w-4 rounded-full border border-primary/50 bg-background shadow transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50"})]}));$s.displayName=Us.displayName;function ua({open:s,imageSrc:n,onClose:t,onCropDone:r}){const[a,i]=p.useState({x:0,y:0}),[o,l]=p.useState(1),[c,u]=p.useState(null),[m,d]=p.useState(!1),b=p.useCallback((h,y)=>{u(y)},[]),f=async()=>{if(c){d(!0);try{const h=await wn(n,c);r(h)}catch{}finally{d(!1)}}},x=h=>{h||t()};return e.jsx(fr,{open:s,onOpenChange:x,children:e.jsxs(xr,{className:"max-w-sm p-4 gap-3",children:[e.jsxs(gr,{children:[e.jsx(vr,{children:"Recadrer la photo"}),e.jsx(br,{children:"Déplacez et zoomez pour ajuster."})]}),e.jsx("div",{className:"relative w-full aspect-square rounded-lg overflow-hidden bg-black",children:e.jsx(Un,{image:n,crop:a,zoom:o,aspect:1,cropShape:"round",showGrid:!1,onCropChange:i,onCropComplete:b,onZoomChange:l})}),e.jsxs("div",{className:"flex items-center gap-3 px-1",children:[e.jsx(un,{className:"h-4 w-4 text-muted-foreground shrink-0"}),e.jsx($s,{value:[o],min:1,max:3,step:.1,onValueChange:([h])=>l(h)})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(B,{variant:"outline",className:"flex-1 gap-2",onClick:t,disabled:m,children:[e.jsx(sr,{className:"h-4 w-4"}),"Annuler"]}),e.jsxs(B,{className:"flex-1 gap-2",onClick:f,disabled:m||!c,children:[e.jsx(Nr,{className:"h-4 w-4"}),m?"Traitement...":"Valider"]})]})]})})}function Ws({onBack:s,embedded:n=!1}){const{toast:t}=Ue(),r=Fe(),[a,i]=p.useState(!1),[o,l]=p.useState(null),[c,u]=p.useState(null),{data:m}=O({queryKey:["auth-user"],queryFn:async()=>{const{data:N}=await rr.auth.getUser();return N.user}}),d=m?.id??null,{data:b=[],isLoading:f}=O({queryKey:["athlete-objectives"],queryFn:()=>A.getAthleteObjectives(),enabled:!!d,refetchInterval:3e4}),x=ie(N=>N.userId),h=ie(N=>N.user),{data:y}=O({queryKey:["my-profile"],queryFn:()=>A.getProfile({displayName:h,userId:x}),enabled:!!x}),j=y?.ffn_iuf??null,g=p.useMemo(()=>{const N=new Date;return N.setDate(N.getDate()-360),N.toISOString().slice(0,10)},[]),{data:w=[]}=O({queryKey:["swimmer-performances-recent",j],queryFn:()=>A.getSwimmerPerformances({iuf:j,fromDate:g}),enabled:!!j}),S=p.useMemo(()=>b.filter(N=>N.created_by!==d),[b,d]),P=p.useMemo(()=>b.filter(N=>N.created_by===d),[b,d]),[k,L]=p.useState("chrono"),[M,I]=p.useState(""),[C,E]=p.useState("25"),[_,z]=p.useState(""),[D,R]=p.useState(""),Z=()=>{L("chrono"),I(""),E("25"),z(""),R("")},W=()=>{l(null),Z(),i(!0)},$=N=>{l(N);const De=!!N.event_code,V=!!N.text;L(De&&V?"both":V?"texte":"chrono"),I(N.event_code??""),E(String(N.pool_length??25)),z(N.target_time_seconds!=null?Se(N.target_time_seconds):""),R(N.text??""),i(!0)},G=()=>r.invalidateQueries({queryKey:["athlete-objectives"]}),_e=K({mutationFn:N=>A.createObjective(N),onSuccess:()=>{t({title:"Objectif créé"}),G(),i(!1)},onError:N=>t({title:"Erreur",description:N.message,variant:"destructive"})}),Ae=K({mutationFn:N=>A.updateObjective(o.id,N),onSuccess:()=>{t({title:"Objectif mis à jour"}),G(),i(!1)},onError:N=>t({title:"Erreur",description:N.message,variant:"destructive"})}),Pe=K({mutationFn:N=>A.deleteObjective(N),onSuccess:()=>{t({title:"Objectif supprimé"}),G(),u(null)},onError:N=>t({title:"Erreur",description:N.message,variant:"destructive"})}),X=k==="chrono"||k==="both",J=k==="texte"||k==="both",fe=_e.isPending||Ae.isPending,Ee=()=>{if(X&&!M){t({title:"Épreuve requise",variant:"destructive"});return}if(X&&_&&Lt(_)===null){t({title:"Format invalide",description:"Format : m:ss:cc (ex: 1:05:30)",variant:"destructive"});return}if(J&&!D.trim()){t({title:"Texte requis",variant:"destructive"});return}if(!d)return;const N={athlete_id:d,event_code:X?M:null,pool_length:X?Number(C):null,target_time_seconds:X&&_?Lt(_):null,text:J?D.trim():null};o?Ae.mutate(N):_e.mutate(N)};return e.jsxs("div",{className:"space-y-6 pb-24",children:[n?e.jsx("div",{className:"flex items-center justify-end",children:e.jsxs(B,{variant:"outline",size:"sm",onClick:W,children:[e.jsx(Ye,{className:"mr-1.5 h-3.5 w-3.5"}),"Ajouter"]})}):e.jsxs("div",{className:"space-y-1",children:[e.jsxs(B,{variant:"ghost",size:"sm",className:"-ml-2",onClick:s,children:[e.jsx(pe,{className:"mr-1.5 h-4 w-4"}),"Retour"]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-display font-semibold uppercase italic text-primary",children:"Mon plan"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Mes objectifs d'entraînement"})]}),e.jsxs(B,{variant:"outline",size:"sm",onClick:W,children:[e.jsx(Ye,{className:"mr-1.5 h-3.5 w-3.5"}),"Ajouter"]})]})]}),f&&e.jsx("div",{className:"space-y-2",children:[1,2,3].map(N=>e.jsx("div",{className:"rounded-xl border p-3 animate-pulse motion-reduce:animate-none",children:e.jsx("div",{className:"h-4 w-40 rounded bg-muted"})},N))}),!f&&b.length===0&&e.jsxs("div",{className:"text-center py-12 space-y-3",children:[e.jsx(We,{className:"h-10 w-10 text-muted-foreground mx-auto"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Aucun objectif pour le moment."}),e.jsxs(B,{variant:"outline",size:"sm",onClick:W,children:[e.jsx(Ye,{className:"mr-1.5 h-3.5 w-3.5"}),"Ajouter un objectif"]})]}),S.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-xs font-semibold uppercase tracking-[0.15em] text-muted-foreground",children:"Objectifs du coach"}),S.map(N=>e.jsx(Qt,{objective:N,isPersonal:!1,performances:w},N.id))]}),(S.length>0||P.length>0)&&e.jsx("p",{className:"text-[10px] text-muted-foreground/60 italic text-center",children:"Les temps « Actuel » correspondent à la meilleure performance des 360 derniers jours sur l'épreuve."}),P.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-xs font-semibold uppercase tracking-[0.15em] text-muted-foreground",children:"Mes objectifs personnels"}),P.map(N=>e.jsx(Qt,{objective:N,isPersonal:!0,performances:w,onEdit:$,onDelete:u},N.id))]}),e.jsx(lt,{open:a,onOpenChange:i,children:e.jsxs(ct,{side:"bottom",className:"max-h-[85vh] overflow-y-auto",children:[e.jsxs(dt,{children:[e.jsx(ut,{children:o?"Modifier l'objectif":"Nouvel objectif"}),e.jsx(mt,{children:o?"Modifiez votre objectif personnel.":"Ajoutez un objectif personnel."})]}),e.jsxs("div",{className:"mt-4 space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{children:"Type d'objectif"}),e.jsxs(Cr,{type:"single",variant:"outline",value:k,onValueChange:N=>{N&&L(N)},className:"justify-start",children:[e.jsx(Qe,{value:"chrono",className:"text-xs",children:"Chrono"}),e.jsx(Qe,{value:"texte",className:"text-xs",children:"Texte"}),e.jsx(Qe,{value:"both",className:"text-xs",children:"Les deux"})]})]}),X&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{children:"Épreuve *"}),e.jsxs(nt,{value:M,onValueChange:I,children:[e.jsx(at,{children:e.jsx(it,{placeholder:"Choisir une épreuve"})}),e.jsx(ot,{children:Mr.map(N=>e.jsx(Ie,{value:N,children:Nt(N)},N))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{children:"Bassin"}),e.jsxs(nt,{value:C,onValueChange:E,children:[e.jsx(at,{children:e.jsx(it,{})}),e.jsxs(ot,{children:[e.jsx(Ie,{value:"25",children:"25m"}),e.jsx(Ie,{value:"50",children:"50m"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{children:"Temps cible (min:sec:centièmes)"}),e.jsx(ae,{placeholder:"Ex : 1:05:30",value:_,onChange:N=>z(N.target.value)})]})]}),J&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{children:"Objectif texte *"}),e.jsx(se,{placeholder:"Ex : Améliorer la coulée de dos",value:D,onChange:N=>R(N.target.value),rows:3})]}),e.jsx(B,{className:"w-full",onClick:Ee,disabled:fe,children:fe?"Enregistrement...":o?"Enregistrer":"Créer"})]})]})}),e.jsx(_r,{open:!!c,onOpenChange:N=>{N||u(null)},children:e.jsxs(Ar,{children:[e.jsxs(Pr,{children:[e.jsx(Er,{children:"Supprimer l'objectif"}),e.jsx(Dr,{children:"Cette action est irréversible. L'objectif sera supprimé définitivement."})]}),e.jsxs(kr,{children:[e.jsx(Rr,{children:"Annuler"}),e.jsx(Tr,{onClick:()=>{c&&Pe.mutate(c.id)},className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Supprimer"})]})]})})]})}function ma(s){const n=s.split("-");return n.length===3?`${n[2]}/${n[1]}/${n[0]}`:s}function Qt({objective:s,isPersonal:n,performances:t,onEdit:r,onDelete:a}){const i=s.event_code?fs(s.event_code):null,o=i?vs[i]??"":"",l=s.event_code?xs(t,s.event_code,s.pool_length):null;let c=null,u=null;l&&s.target_time_seconds!=null&&s.event_code&&(c=l.time-s.target_time_seconds,u=gs(l.time,s.target_time_seconds,s.event_code));const m=!!s.competition_name,d=s.competition_date?Br(s.competition_date):null;return e.jsxs("div",{className:`rounded-lg border bg-card p-3 text-sm space-y-1.5 ${o?`border-l-4 ${o}`:""}`,children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx(We,{className:"h-3.5 w-3.5 text-muted-foreground shrink-0"}),!n&&e.jsx(T,{variant:"secondary",className:"text-[10px] px-1.5 py-0",children:"Coach"}),e.jsxs("div",{className:"flex-1 min-w-0 flex items-center gap-1.5 flex-wrap",children:[s.event_code&&e.jsx("span",{className:"font-medium",children:Nt(s.event_code)}),s.event_code&&s.pool_length&&e.jsxs("span",{className:"text-muted-foreground",children:["(",s.pool_length,"m)"]}),s.target_time_seconds!=null&&e.jsx("span",{className:"font-mono text-xs text-primary",children:Se(s.target_time_seconds)})]}),n&&r&&a&&e.jsxs("div",{className:"ml-auto flex gap-1 shrink-0",children:[e.jsx("button",{type:"button",onClick:()=>r(s),className:"text-xs text-primary hover:underline",children:"Modifier"}),e.jsx("button",{type:"button",onClick:()=>a(s),className:"text-muted-foreground hover:text-destructive p-0.5",children:e.jsx(Ct,{className:"h-3.5 w-3.5"})})]})]}),s.text&&e.jsx("p",{className:"text-muted-foreground text-xs pl-5",children:s.text}),s.event_code&&l&&e.jsxs("div",{className:"flex items-center gap-2 pl-5 text-xs text-muted-foreground flex-wrap",children:[e.jsxs("span",{children:["Actuel : ",e.jsx("span",{className:"font-mono",children:Se(l.time)})]}),l.date&&e.jsxs("span",{className:"text-muted-foreground/60",children:["(",ma(l.date),")"]}),c!=null&&e.jsx("span",{className:c<=0?"text-emerald-600 font-medium":"text-amber-600",children:c<=0?"Objectif atteint !":`+${c.toFixed(2)}s`})]}),s.event_code&&!l&&e.jsx("p",{className:"text-[10px] text-muted-foreground italic pl-5",children:"Pas encore de temps enregistré"}),u!=null&&e.jsx("div",{className:"pl-5 pr-1",children:e.jsx("div",{className:"h-1.5 w-full rounded-full bg-muted overflow-hidden",children:e.jsx("div",{className:`h-full rounded-full transition-all duration-500 ${qr(u)}`,style:{width:`${Math.min(u,100)}%`}})})}),m&&e.jsx("div",{className:"pl-5",children:e.jsxs(T,{variant:"outline",className:"border-orange-300 text-orange-600 dark:text-orange-400 text-[10px] px-1.5 py-0",children:[s.competition_name,d!=null&&d>0&&e.jsxs("span",{className:"ml-1 font-bold",children:["J-",d]})]})})]})}function ce(s){return new Date(s+"T12:00:00").toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric"})}function Xt(s){return new Date(s+"T00:00:00").toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit"})}function pa(s){const n=new Date(s+"T00:00:00");return n.setDate(n.getDate()+6),n.toISOString().split("T")[0]}function ha(s){const n=new Date;n.setHours(0,0,0,0);const t=new Date(s+"T00:00:00"),r=new Date(s+"T00:00:00");return r.setDate(r.getDate()+6),n>=t&&n<=r}function Jt(s,n){const t=[],r=new Date(s+"T00:00:00"),a=new Date(n+"T00:00:00"),i=new Date(r),o=i.getDay(),l=o===0?1:o===1?0:8-o;for(i.setDate(i.getDate()+l);i<=a;)t.push(i.toISOString().split("T")[0]),i.setDate(i.getDate()+7);return t}function es(s,n){const t=new Date(s+"T00:00:00"),r=new Date(n+"T00:00:00");return Math.round((r.getTime()-t.getTime())/(1e3*60*60*24))}function Ks({onBack:s,embedded:n=!1}){const{toast:t}=Ue(),r=Fe(),{data:a}=O({queryKey:["auth-user"],queryFn:async()=>{const{data:j}=await(await ar(async()=>{const{supabase:g}=await import("./index-b2N4RXqt.js").then(w=>w.ag);return{supabase:g}},__vite__mapDeps([0,1,2,3,4,5,6]))).supabase.auth.getUser();return j.user}}),i=a?.app_metadata?.app_user_id,{data:o=[],isLoading:l}=O({queryKey:["my-interviews"],queryFn:()=>A.getMyInterviews()}),{data:c=[]}=O({queryKey:["athlete-objectives"],queryFn:()=>A.getAthleteObjectives()}),{data:u}=O({queryKey:["my-profile-iuf"],queryFn:()=>A.getProfile({userId:i}),enabled:!!i}),m=u?.ffn_iuf??null,d=p.useMemo(()=>{const j=new Date;return j.setDate(j.getDate()-360),j.toISOString().slice(0,10)},[]),{data:b=[]}=O({queryKey:["swimmer-performances-recent",m],queryFn:()=>A.getSwimmerPerformances({iuf:m,fromDate:d}),enabled:!!m}),f=p.useCallback(()=>r.invalidateQueries({queryKey:["my-interviews"]}),[r]),x=K({mutationFn:({id:j,input:g})=>A.updateInterviewAthleteSections(j,g),onSuccess:()=>{t({title:"Sauvegardé"}),f()},onError:j=>t({title:"Erreur",description:j.message,variant:"destructive"})}),h=K({mutationFn:j=>A.submitInterviewToCoach(j),onSuccess:()=>{t({title:"Envoyé au coach"}),f()},onError:j=>t({title:"Erreur",description:j.message,variant:"destructive"})}),y=K({mutationFn:j=>A.signInterview(j),onSuccess:()=>{t({title:"Entretien signé"}),f()},onError:j=>t({title:"Erreur",description:j.message,variant:"destructive"})});return e.jsxs("div",{className:"space-y-6 pb-24",children:[!n&&e.jsxs("div",{className:"space-y-1",children:[e.jsxs(B,{variant:"ghost",size:"sm",className:"-ml-2",onClick:s,children:[e.jsx(pe,{className:"mr-1.5 h-4 w-4"}),"Retour"]}),e.jsx("h2",{className:"text-2xl font-display font-semibold uppercase italic text-primary",children:"Mes entretiens"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Entretiens individuels avec le coach"})]}),l&&e.jsx("div",{className:"space-y-3",children:[1,2,3].map(j=>e.jsx("div",{className:"rounded-xl border p-4 animate-pulse motion-reduce:animate-none",children:e.jsx("div",{className:"h-4 w-40 rounded bg-muted"})},j))}),!l&&o.length===0&&e.jsxs("div",{className:"text-center py-12 space-y-3",children:[e.jsx(St,{className:"h-10 w-10 text-muted-foreground mx-auto"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Aucun entretien en cours. Votre coach initiera les entretiens."})]}),!l&&o.map(j=>e.jsx(fa,{interview:j,objectives:c,performances:b,appUserId:i??null,onSave:(g,w)=>x.mutate({id:g,input:w}),onSubmit:g=>{window.confirm("Envoyer votre préparation au coach ? Vous ne pourrez plus la modifier.")&&h.mutate(g)},onSign:g=>{window.confirm("Confirmer la signature de cet entretien ?")&&y.mutate(g)},isSaving:x.isPending,isSubmitting:h.isPending,isSigning:y.isPending},j.id))]})}function fa({interview:s,objectives:n,performances:t,appUserId:r,onSave:a,onSubmit:i,onSign:o,isSaving:l,isSubmitting:c,isSigning:u}){const m=s.status==="draft_athlete",d=s.status==="draft_coach",b=s.status==="sent",f=s.status==="signed",[x,h]=p.useState(!1),[y,j]=p.useState(s.athlete_successes??""),[g,w]=p.useState(s.athlete_difficulties??""),[S,P]=p.useState(s.athlete_goals??""),[k,L]=p.useState(s.athlete_commitments??""),[M,I]=p.useState(s.athlete_commitment_review??""),{data:C}=O({queryKey:["my-previous-interview",s.date,s.id],queryFn:()=>r?A.getPreviousInterview(r,s.date,s.id):null,enabled:(m||b||f||d)&&!!r}),E=p.useRef(!1),_=p.useCallback(()=>{E.current||!m||(E.current=!0,a(s.id,{athlete_successes:y||null,athlete_difficulties:g||null,athlete_goals:S||null,athlete_commitments:k||null,athlete_commitment_review:M||null}),setTimeout(()=>{E.current=!1},500))},[s.id,y,g,S,k,M,a,m]),z=m?e.jsxs(T,{className:"bg-amber-100 text-amber-800 dark:bg-amber-900/30 dark:text-amber-400 border-amber-300 dark:border-amber-700",children:[e.jsx(Ne,{className:"h-3 w-3 mr-1"}),"À préparer"]}):d?e.jsxs(T,{className:"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400 border-blue-300 dark:border-blue-700",children:[e.jsx(Ne,{className:"h-3 w-3 mr-1"}),"En préparation"]}):b?e.jsxs(T,{className:"bg-emerald-100 text-emerald-800 dark:bg-emerald-900/30 dark:text-emerald-400 border-emerald-300 dark:border-emerald-700",children:[e.jsx(It,{className:"h-3 w-3 mr-1"}),"À signer"]}):e.jsx(T,{variant:"secondary",children:"Signé"}),D=m?"border-amber-300 dark:border-amber-700 border-l-4":d?"border-blue-300 dark:border-blue-700 border-l-4":b?"border-emerald-300 dark:border-emerald-700 border-l-4":"";return e.jsxs("div",{className:`rounded-xl border bg-card shadow-sm ${D}`,children:[e.jsxs("button",{type:"button",className:"w-full flex items-center justify-between p-4 text-left",onClick:()=>h(R=>!R),children:[e.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[e.jsx("span",{className:"text-sm font-semibold",children:ce(s.date)}),z,f&&s.signed_at&&e.jsxs("span",{className:"text-xs text-muted-foreground",children:["le ",ce(s.signed_at.slice(0,10))]})]}),x?e.jsx(Ir,{className:"h-4 w-4 text-muted-foreground shrink-0"}):e.jsx(Ss,{className:"h-4 w-4 text-muted-foreground shrink-0"})]}),x&&e.jsxs("div",{className:"px-4 pb-4 space-y-4",children:[m&&e.jsxs(e.Fragment,{children:[C&&(C.athlete_commitments||C.coach_actions)&&e.jsxs("div",{className:"rounded-xl border bg-muted/30 p-3 space-y-2",children:[e.jsx("p",{className:"text-xs font-bold uppercase tracking-widest text-muted-foreground",children:"Bilan des engagements précédents"}),C.athlete_commitments&&e.jsxs("div",{className:"border-l-4 border-blue-400 rounded-r-lg bg-blue-50/50 dark:bg-blue-950/20 p-2 space-y-0.5",children:[e.jsx("p",{className:"text-[10px] font-semibold text-muted-foreground",children:"Mes engagements"}),e.jsx("p",{className:"text-xs whitespace-pre-wrap",children:C.athlete_commitments})]}),C.coach_actions&&e.jsxs("div",{className:"border-l-4 border-amber-400 rounded-r-lg bg-amber-50/50 dark:bg-amber-950/20 p-2 space-y-0.5",children:[e.jsx("p",{className:"text-[10px] font-semibold text-muted-foreground",children:"Actions du coach"}),e.jsx("p",{className:"text-xs whitespace-pre-wrap",children:C.coach_actions})]}),e.jsxs("div",{className:"space-y-1 pt-1",children:[e.jsx(F,{htmlFor:`commitment-review-${s.id}`,className:"text-xs",children:"Comment avez-vous tenu vos engagements ?"}),e.jsx(se,{id:`commitment-review-${s.id}`,placeholder:"Mon bilan sur les engagements pris...",value:M,onChange:R=>I(R.target.value),onBlur:_,rows:3})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:`successes-${s.id}`,children:"Mes réussites"}),e.jsx(se,{id:`successes-${s.id}`,placeholder:"Ce dont je suis fier/fière cette saison...",value:y,onChange:R=>j(R.target.value),onBlur:_,rows:3})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:`difficulties-${s.id}`,children:"Mes difficultés"}),e.jsx(se,{id:`difficulties-${s.id}`,placeholder:"Les points que je souhaite améliorer...",value:g,onChange:R=>w(R.target.value),onBlur:_,rows:3})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{children:"Mes objectifs"}),n.length>0&&e.jsx("div",{className:"space-y-1.5",children:n.map(R=>e.jsx(ns,{objective:R,performances:t},R.id))}),e.jsx(se,{id:`goals-${s.id}`,placeholder:"Objectifs supplémentaires ou commentaires...",value:S,onChange:R=>P(R.target.value),onBlur:_,rows:3})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:`commitments-${s.id}`,children:"Mes engagements"}),e.jsx(se,{id:`commitments-${s.id}`,placeholder:"Ce que je m'engage à faire...",value:k,onChange:R=>L(R.target.value),onBlur:_,rows:3})]}),l&&e.jsx("p",{className:"text-xs text-muted-foreground animate-pulse",children:"Sauvegarde..."}),e.jsxs(B,{className:"w-full gap-2",onClick:()=>i(s.id),disabled:c,children:[e.jsx(Or,{className:"h-4 w-4"}),c?"Envoi...":"Envoyer au coach"]})]}),d&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"rounded-xl border border-dashed border-blue-300 dark:border-blue-700 bg-blue-50/50 dark:bg-blue-950/20 p-6 text-center space-y-2",children:[e.jsx(Ne,{className:"h-8 w-8 mx-auto text-blue-500"}),e.jsx("p",{className:"text-sm font-medium",children:"Entretien envoyé au coach"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Votre coach prépare l'entretien. Vous recevrez le compte-rendu complet après l'entretien en présentiel."}),s.submitted_at&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Envoyé le ",ce(s.submitted_at.slice(0,10))]})]}),C&&(C.athlete_commitments||C.coach_actions)&&e.jsx(ts,{prevInterview:C,commitmentReview:s.athlete_commitment_review}),r&&e.jsxs(e.Fragment,{children:[e.jsx(we,{label:"Planification"}),e.jsx(ss,{athleteId:r,interviewDate:s.date})]})]}),(b||f)&&e.jsxs(e.Fragment,{children:[C&&(C.athlete_commitments||C.coach_actions)&&e.jsx(ts,{prevInterview:C,commitmentReview:s.athlete_commitment_review}),e.jsx(rs,{label:"Réussites",athleteText:s.athlete_successes,coachText:s.coach_comment_successes||s.coach_review}),e.jsx(rs,{label:"Difficultés",athleteText:s.athlete_difficulties,coachText:s.coach_comment_difficulties}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(we,{label:"Objectifs"}),n.length>0&&e.jsx("div",{className:"space-y-1.5",children:n.map(R=>e.jsx(ns,{objective:R,performances:t},R.id))}),e.jsx(gt,{text:s.athlete_goals}),e.jsx(vt,{text:s.coach_comment_goals||s.coach_objectives})]}),r&&e.jsxs(e.Fragment,{children:[e.jsx(we,{label:"Planification"}),e.jsx(ss,{athleteId:r,interviewDate:s.date})]}),e.jsxs("div",{className:"rounded-xl bg-card border shadow-sm p-3 space-y-2",children:[e.jsx(we,{label:"Engagements & Actions"}),e.jsx(gt,{text:s.athlete_commitments,label:"Mes engagements"}),e.jsx(vt,{text:s.coach_actions,label:"Actions du coach"})]}),b&&e.jsxs(B,{className:"w-full gap-2",onClick:()=>o(s.id),disabled:u,children:[e.jsx(It,{className:"h-4 w-4"}),u?"Signature...":"Signer l'entretien"]})]})]})]})}function ts({prevInterview:s,commitmentReview:n}){const[t,r]=p.useState(!1);return e.jsxs(ys,{open:t,onOpenChange:r,children:[e.jsx(js,{asChild:!0,children:e.jsxs("button",{type:"button",className:"w-full flex items-center gap-2 rounded-xl border bg-muted/30 px-3 py-2.5 text-left transition-colors hover:bg-muted/50",children:[e.jsx(de,{className:`h-3.5 w-3.5 text-muted-foreground shrink-0 transition-transform ${t?"rotate-90":""}`}),e.jsx("span",{className:"text-xs font-bold uppercase tracking-widest text-muted-foreground",children:"Rappel engagements précédents"}),e.jsx(T,{variant:"secondary",className:"text-[10px] px-1.5 py-0 ml-auto",children:ce(s.date)})]})}),e.jsx(Ns,{children:e.jsxs("div",{className:"rounded-b-xl border border-t-0 bg-muted/30 px-3 pb-3 space-y-2",children:[s.athlete_commitments&&e.jsxs("div",{className:"border-l-4 border-blue-400 rounded-r-lg bg-blue-50/50 dark:bg-blue-950/20 p-2",children:[e.jsx("p",{className:"text-[10px] font-semibold text-muted-foreground",children:"Mes engagements"}),e.jsx("p",{className:"text-xs whitespace-pre-wrap",children:s.athlete_commitments})]}),s.coach_actions&&e.jsxs("div",{className:"border-l-4 border-amber-400 rounded-r-lg bg-amber-50/50 dark:bg-amber-950/20 p-2",children:[e.jsx("p",{className:"text-[10px] font-semibold text-muted-foreground",children:"Actions du coach"}),e.jsx("p",{className:"text-xs whitespace-pre-wrap",children:s.coach_actions})]}),n&&e.jsxs("div",{className:"border-l-4 border-blue-400 rounded-r-lg bg-blue-50/80 dark:bg-blue-950/30 p-2",children:[e.jsx("p",{className:"text-[10px] font-semibold text-muted-foreground",children:"Mon bilan"}),e.jsx("p",{className:"text-xs whitespace-pre-wrap",children:n})]})]})})]})}function ss({athleteId:s,interviewDate:n}){const{data:t=[]}=O({queryKey:["competitions"],queryFn:()=>A.getCompetitions()}),{data:r=[]}=O({queryKey:["my-competition-ids",s],queryFn:()=>A.getMyCompetitionIds(s)}),a=p.useMemo(()=>{const f=new Set(r);return t.filter(h=>f.has(h.id)&&h.date>=n).sort((h,y)=>h.date.localeCompare(y.date))[0]??null},[t,r,n]),{data:i=[]}=O({queryKey:["training-cycles","athlete",s],queryFn:()=>A.getTrainingCycles({athleteId:s})}),o=p.useMemo(()=>{const f=new Set(r);return t.filter(x=>f.has(x.id)&&x.date>=n).sort((x,h)=>x.date.localeCompare(h.date))},[t,r,n]),l=p.useMemo(()=>{const f=new Map;return i.slice().sort((x,h)=>(x.end_competition_date??"").localeCompare(h.end_competition_date??"")).forEach(x=>{x.end_competition_id&&!f.has(x.end_competition_id)&&f.set(x.end_competition_id,x)}),f},[i]),c=p.useMemo(()=>{const f=new Set;return o.map(x=>l.get(x.id)??null).filter(x=>!x||f.has(x.id)?!1:(f.add(x.id),!0))},[o,l]),u=ms({queries:c.map(f=>({queryKey:["training-weeks",f.id],queryFn:()=>A.getTrainingWeeks(f.id),enabled:!!f.id}))}),m=p.useMemo(()=>{const f=new Map;return c.forEach((x,h)=>{f.set(x.id,u[h]?.data??[])}),f},[c,u]),d=p.useMemo(()=>new Date().toISOString().split("T")[0],[]),b=a?es(d,a.date):null;return a?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"rounded-xl border bg-muted/20 p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm flex-wrap",children:[e.jsx($e,{className:"h-4 w-4 text-amber-500 shrink-0"}),e.jsxs("span",{className:"font-medium",children:[o.length," échéance",o.length>1?"s":""," visible",o.length>1?"s":""]}),e.jsxs(T,{variant:"secondary",className:"text-[10px]",children:["prochaine J-",b]})]}),e.jsx("p",{className:"mt-1 text-xs text-muted-foreground",children:"Vision multi-macrocycles depuis l'entretien, jusqu'aux prochaines compétitions assignées."})]}),e.jsx("div",{className:"space-y-3",children:o.map((f,x)=>{const h=l.get(f.id)??null,y=h?.start_date??h?.start_competition_date??n,j=y>n?y:n,g=h?Jt(j,f.date):[],w=h?Jt(y,f.date):[],S=Math.max(w.length-g.length,0),P=es(d,f.date),k=h?m.get(h.id)??[]:[],L=new Map(k.map(M=>[M.week_start,M]));return e.jsxs("div",{className:"rounded-xl border bg-card shadow-sm overflow-hidden",children:[e.jsxs("div",{className:"border-b border-border bg-muted/20 px-3 py-2.5",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"text-sm font-semibold",children:f.name}),x===0&&e.jsx(T,{className:"text-[10px] bg-primary/10 text-primary border-primary/20",children:"Prochaine"}),e.jsx(T,{variant:"secondary",className:"text-[10px]",children:ce(f.date)}),e.jsxs(T,{variant:"outline",className:"text-[10px]",children:["J-",P]})]}),h?e.jsxs("div",{className:"mt-1 flex items-center gap-2 flex-wrap text-xs text-muted-foreground",children:[e.jsx("span",{className:"font-medium text-foreground",children:h.name}),h.start_competition_name&&e.jsxs("span",{children:["depuis ",h.start_competition_name]}),e.jsxs("span",{children:[w.length," sem."]}),S>0&&e.jsxs("span",{children:[S," déjà écoulée",S>1?"s":""]})]}):e.jsx("p",{className:"mt-1 text-xs text-muted-foreground",children:"Aucun macrocycle créé pour cette échéance."})]}),h?g.length===0?e.jsx("div",{className:"px-3 py-3 text-xs text-muted-foreground italic",children:"Aucune semaine future à afficher sur ce macrocycle."}):e.jsx("div",{className:"px-3 py-3",children:e.jsx("div",{className:"relative ml-2 border-l-2 border-border pl-3 space-y-1.5",children:g.map((M,I)=>{const C=L.get(M),E=ha(M),_=pa(M);return e.jsxs("div",{className:`rounded-lg border bg-card px-2.5 py-2 text-xs ${E?"ring-2 ring-primary bg-primary/5":""}`,children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:`h-2 w-2 rounded-full shrink-0 ${E?"bg-primary":C?.week_type?"bg-muted-foreground/40":"bg-muted-foreground/20"}`}),e.jsxs("span",{className:"text-muted-foreground whitespace-nowrap",children:["Sem. ",S+I+1]}),e.jsxs("span",{className:"text-muted-foreground/70 whitespace-nowrap",children:[Xt(M)," - ",Xt(_)]}),C?.week_type&&e.jsx(T,{className:"text-[10px] px-1.5 py-0 border-0 ml-auto",style:{backgroundColor:ws(C.week_type),color:bs(C.week_type)},children:C.week_type})]}),C?.notes&&e.jsx("p",{className:"mt-1 pl-4 text-[11px] text-muted-foreground line-clamp-2",children:C.notes})]},M)})})}):e.jsx("div",{className:"px-3 py-3 text-xs text-muted-foreground italic",children:"La compétition reste visible pour garder la projection long terme, même sans planification détaillée."})]},f.id)})})]}):e.jsx("p",{className:"text-xs text-muted-foreground italic text-center py-2",children:"Aucune compétition assignée à venir."})}function rs({label:s,athleteText:n,coachText:t}){return e.jsxs("div",{className:"space-y-2",children:[e.jsx(we,{label:s}),e.jsx(gt,{text:n}),e.jsx(vt,{text:t})]})}function we({label:s}){return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-px flex-1 bg-border"}),e.jsx("span",{className:"text-xs font-bold uppercase tracking-widest text-muted-foreground",children:s}),e.jsx("div",{className:"h-px flex-1 bg-border"})]})}function gt({text:s,label:n}){return e.jsxs("div",{className:"border-l-4 border-blue-400 rounded-r-lg bg-blue-50/50 dark:bg-blue-950/20 p-2.5 space-y-0.5",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(nr,{className:"h-3 w-3 text-blue-500"}),e.jsx("p",{className:"text-[10px] font-bold uppercase tracking-widest text-muted-foreground",children:n??"Nageur"})]}),e.jsx("p",{className:"text-sm whitespace-pre-wrap",children:s?.trim()||e.jsx("span",{className:"italic text-muted-foreground",children:"Non renseigné"})})]})}function vt({text:s,label:n}){return s?.trim()?e.jsxs("div",{className:"border-l-4 border-amber-400 rounded-r-lg bg-amber-50/50 dark:bg-amber-950/20 p-2.5 space-y-0.5",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(zr,{className:"h-3 w-3 text-amber-500"}),e.jsx("p",{className:"text-[10px] font-bold uppercase tracking-widest text-muted-foreground",children:n??"Coach"})]}),e.jsx("p",{className:"text-sm whitespace-pre-wrap",children:s})]}):null}function ns({objective:s,performances:n}){const t=s.event_code?fs(s.event_code):null,r=t?vs[t]??"":"",a=s.event_code?xs(n,s.event_code,s.pool_length):null;let i=null;return a&&s.target_time_seconds!=null&&s.event_code&&(i=a.time-s.target_time_seconds,gs(a.time,s.target_time_seconds,s.event_code)),e.jsxs("div",{className:`rounded-lg border bg-card p-2 text-sm space-y-1 ${r?`border-l-4 ${r}`:""}`,children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx(We,{className:"h-3.5 w-3.5 text-muted-foreground shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0 flex items-center gap-1 flex-wrap",children:[s.event_code&&e.jsx("span",{className:"font-medium",children:Nt(s.event_code)}),s.event_code&&s.pool_length&&e.jsxs("span",{className:"text-muted-foreground",children:["(",s.pool_length,"m)"]}),s.target_time_seconds!=null&&e.jsx("span",{className:"font-mono text-xs text-primary",children:Se(s.target_time_seconds)})]}),s.competition_name&&e.jsx(T,{variant:"secondary",className:"text-[10px] shrink-0",children:s.competition_name})]}),s.text&&e.jsx("p",{className:"text-muted-foreground text-xs pl-5",children:s.text}),a&&e.jsxs("div",{className:"flex items-center gap-2 pl-5 text-xs text-muted-foreground flex-wrap",children:[e.jsxs("span",{children:["Actuel : ",e.jsx("span",{className:"font-mono",children:Se(a.time)})]}),a.date&&e.jsxs("span",{className:"text-muted-foreground/60",children:["(",ce(a.date),")"]}),i!=null&&e.jsx("span",{className:i<=0?"text-emerald-600 font-medium":"text-amber-600",children:i<=0?"Objectif atteint !":`+${i.toFixed(2)}s`})]}),!a&&s.event_code&&s.target_time_seconds!=null&&e.jsx("p",{className:"text-[10px] text-muted-foreground italic pl-5",children:"Pas encore de temps enregistré"})]})}function xa(s){return new Date(s+"T12:00:00").toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric"})}function as(s){return new Date(s+"T00:00:00").toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit"})}function ga(s){const n=new Date(s+"T00:00:00");return n.setDate(n.getDate()+6),n.toISOString().split("T")[0]}function va(s){const n=new Date;n.setHours(0,0,0,0);const t=new Date(s+"T00:00:00"),r=new Date(s+"T00:00:00");return r.setDate(r.getDate()+6),n>=t&&n<=r}function is(s,n){const t=[],r=new Date(s+"T00:00:00"),a=new Date(n+"T00:00:00"),i=new Date(r),o=i.getDay(),l=o===0?1:o===1?0:8-o;for(i.setDate(i.getDate()+l);i<=a;)t.push(i.toISOString().split("T")[0]),i.setDate(i.getDate()+7);return t}function os(s,n){const t=new Date(s+"T00:00:00"),r=new Date(n+"T00:00:00");return Math.round((r.getTime()-t.getTime())/(1e3*60*60*24))}function ba({athleteId:s}){const n=p.useMemo(()=>new Date().toISOString().split("T")[0],[]),[t,r]=p.useState([]),{data:a=[]}=O({queryKey:["competitions"],queryFn:()=>A.getCompetitions()}),{data:i=[]}=O({queryKey:["my-competition-ids",s],queryFn:()=>A.getMyCompetitionIds(s)}),{data:o=[]}=O({queryKey:["training-cycles","athlete",s],queryFn:()=>A.getTrainingCycles({athleteId:s})}),l=p.useMemo(()=>{const x=new Set(i);return a.filter(h=>x.has(h.id)&&h.date>=n).sort((h,y)=>h.date.localeCompare(y.date))},[i,a,n]),c=p.useMemo(()=>{const x=new Map;return o.slice().sort((h,y)=>(h.end_competition_date??"").localeCompare(y.end_competition_date??"")).forEach(h=>{h.end_competition_id&&!x.has(h.end_competition_id)&&x.set(h.end_competition_id,h)}),x},[o]),u=p.useMemo(()=>{const x=new Set;return l.map(h=>c.get(h.id)??null).filter(h=>!h||x.has(h.id)?!1:(x.add(h.id),!0))},[c,l]),m=ms({queries:u.map(x=>({queryKey:["training-weeks",x.id],queryFn:()=>A.getTrainingWeeks(x.id),enabled:!!x.id}))}),d=p.useMemo(()=>{const x=new Map;return u.forEach((h,y)=>{x.set(h.id,m[y]?.data??[])}),x},[u,m]),b=l[0]??null,f=x=>{r(h=>h.includes(x)?h.filter(y=>y!==x):[...h,x])};return l.length===0?e.jsxs("div",{className:"rounded-3xl border border-dashed bg-card/70 px-4 py-8 text-center",children:[e.jsx(_t,{className:"mx-auto h-10 w-10 text-muted-foreground/60"}),e.jsx("p",{className:"mt-3 text-sm font-medium",children:"Aucune échéance à venir."}),e.jsx("p",{className:"mt-1 text-xs text-muted-foreground",children:"Ton plan apparaîtra ici."})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"rounded-3xl border bg-gradient-to-br from-primary/[0.08] via-background to-amber-500/[0.08] p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx($r,{className:"h-4 w-4 text-primary"}),e.jsxs("span",{className:"text-sm font-semibold",children:[l.length," échéance",l.length>1?"s":""]}),b&&e.jsxs(T,{variant:"secondary",className:"text-[10px] px-2 py-0.5",children:["cap J-",os(n,b.date)]})]}),e.jsx("p",{className:"mt-2 text-xs text-muted-foreground",children:"Vue de tes prochains cycles."})]}),e.jsx("div",{className:"space-y-3",children:l.map((x,h)=>{const y=c.get(x.id)??null,j=y?.start_date??y?.start_competition_date??n,g=j>n?j:n,w=y?is(g,x.date):[],S=y?is(j,x.date):[],P=Math.max(S.length-w.length,0),k=y?d.get(y.id)??[]:[],L=new Map(k.map(C=>[C.week_start,C])),M=os(n,x.date),I=t.includes(x.id);return e.jsx(ys,{open:I,onOpenChange:()=>f(x.id),children:e.jsxs("section",{className:"overflow-hidden rounded-3xl border bg-card shadow-sm",children:[e.jsx(js,{asChild:!0,children:e.jsx("button",{type:"button",className:"w-full border-b border-border bg-muted/20 px-4 py-3 text-left transition-colors hover:bg-muted/30",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(de,{className:`mt-0.5 h-4 w-4 shrink-0 text-muted-foreground transition-transform ${I?"rotate-90":""}`}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"text-sm font-semibold",children:x.name}),h===0&&e.jsx(T,{className:"border-primary/20 bg-primary/10 text-[10px] text-primary",children:"Priorité"}),e.jsx(T,{variant:"secondary",className:"text-[10px]",children:xa(x.date)}),e.jsxs(T,{variant:"outline",className:"text-[10px]",children:["J-",M]})]}),y?e.jsxs("div",{className:"mt-1 flex items-center gap-2 flex-wrap text-xs text-muted-foreground",children:[e.jsx("span",{className:"font-medium text-foreground",children:y.name}),e.jsxs("span",{children:[S.length," sem."]}),P>0&&e.jsxs("span",{children:[P," sem. passée",P>1?"s":""]})]}):e.jsx("p",{className:"mt-1 text-xs text-muted-foreground",children:"Pas de cycle détaillé."})]})]})})}),e.jsx(Ns,{children:y?w.length===0?e.jsx("div",{className:"px-4 py-4 text-xs text-muted-foreground italic",children:"Pas de semaine à venir."}):e.jsx("div",{className:"px-4 py-4",children:e.jsx("div",{className:"relative ml-2 space-y-2 border-l-2 border-border pl-4",children:w.map((C,E)=>{const _=L.get(C),z=va(C),D=ga(C);return e.jsxs("div",{className:`rounded-2xl border bg-card px-3 py-2 text-xs ${z?"ring-2 ring-primary/40 bg-primary/[0.04]":""}`,children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:`h-2 w-2 rounded-full shrink-0 ${z?"bg-primary":_?.week_type?"bg-muted-foreground/40":"bg-muted-foreground/20"}`}),e.jsxs("span",{className:"whitespace-nowrap text-muted-foreground",children:["Sem. ",P+E+1]}),e.jsxs("span",{className:"whitespace-nowrap text-muted-foreground/70",children:[as(C)," - ",as(D)]}),_?.week_type&&e.jsx(T,{className:"ml-auto border-0 px-1.5 py-0 text-[10px]",style:{backgroundColor:ws(_.week_type),color:bs(_.week_type)},children:_.week_type})]}),_?.notes&&e.jsx("p",{className:"mt-1 pl-4 text-[11px] text-muted-foreground line-clamp-2",children:_.notes})]},C)})})}):e.jsx("div",{className:"px-4 py-4 text-xs text-muted-foreground italic",children:"L'échéance reste affichée."})})]})},x.id)})})]})}function wa({athleteId:s,athleteName:n,groupLabel:t,onBack:r}){const[,a]=jt();return e.jsxs("div",{className:"mx-auto max-w-4xl space-y-4 pb-24",children:[e.jsxs("div",{className:"rounded-[1.75rem] border bg-gradient-to-br from-primary/[0.12] via-background to-amber-500/[0.08] p-4 shadow-sm",children:[e.jsxs(B,{variant:"ghost",size:"sm",className:"-ml-2 mb-2",onClick:r,children:[e.jsx(pe,{className:"mr-1.5 h-4 w-4"}),"Retour"]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex h-11 w-11 shrink-0 items-center justify-center rounded-2xl bg-primary/12 text-primary",children:e.jsx($e,{className:"h-5 w-5"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("h1",{className:"text-xl font-display font-semibold uppercase italic text-foreground",children:"Mon suivi"}),e.jsx(T,{className:"border-primary/20 bg-primary/10 text-[10px] text-primary",children:"Vue nageur"}),t&&e.jsx(T,{variant:"secondary",className:"text-[10px]",children:t})]}),e.jsxs("p",{className:"mt-1 text-sm text-muted-foreground",children:[n,": ton plan d'action, tes entretiens et tes échéances au même endroit."]})]})]})]}),e.jsxs(Fr,{defaultValue:"objectifs",className:"space-y-4",children:[e.jsxs(Ur,{className:"grid w-full grid-cols-4 rounded-2xl",children:[e.jsxs(Re,{value:"objectifs",className:"gap-1 text-xs",children:[e.jsx(We,{className:"h-3.5 w-3.5"}),e.jsx("span",{className:"hidden sm:inline",children:"Plan d'action"})]}),e.jsxs(Re,{value:"entretiens",className:"gap-1 text-xs",children:[e.jsx(St,{className:"h-3.5 w-3.5"}),e.jsx("span",{className:"hidden sm:inline",children:"Entretiens"})]}),e.jsxs(Re,{value:"planification",className:"gap-1 text-xs",children:[e.jsx(_t,{className:"h-3.5 w-3.5"}),e.jsx("span",{className:"hidden sm:inline",children:"Planif."})]}),e.jsxs(Re,{value:"ressentis",className:"gap-1 text-xs",children:[e.jsx(Ne,{className:"h-3.5 w-3.5"}),e.jsx("span",{className:"hidden sm:inline",children:"Ressentis"})]})]}),e.jsx(Te,{value:"objectifs",className:"mt-0",children:e.jsx(Ws,{embedded:!0})}),e.jsx(Te,{value:"entretiens",className:"mt-0",children:e.jsx(Ks,{embedded:!0})}),e.jsx(Te,{value:"planification",className:"mt-0",children:e.jsx(ba,{athleteId:s})}),e.jsx(Te,{value:"ressentis",className:"mt-0",children:e.jsx(Lr,{athleteId:s,athleteName:n,onOpenProgression:()=>a("/progress")})})]})]})}function bt(s){const n=s.metadata?.url;if(typeof n=="string"&&n.trim())return n;const t=String(s.title??"").toLowerCase(),r=String(s.message??"").toLowerCase(),a=String(s.type??"").toLowerCase(),i=`${t} ${r}`;return a==="interview"||i.includes("entretien")?"/profile?section=interviews":a==="assignment"?"/":a==="objective"||i.includes("objectif")?"/profile?section=objectives":"/profile?section=messages"}function rt(s){const n=bt(s);return n==="/profile?section=interviews"?"Ouvrir l'entretien":n==="/profile?section=objectives"?"Ouvrir les objectifs":n==="/"?"Ouvrir l'accueil":n==="/profile?section=messages"?null:"Ouvrir"}const ls=s=>`profile-notifications-dismissed:${s}`;function cs(s){const n=new Date(s);return Number.isNaN(n.getTime())?s:n.toLocaleString("fr-FR",{day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"})}function ya({userId:s,onBack:n,onOpenProfileSection:t}){const[,r]=jt(),{toast:a}=Ue(),i=Fe(),[o,l]=p.useState(null),[c,u]=p.useState(()=>{if(typeof window>"u"||s<=0)return[];try{const g=window.localStorage.getItem(ls(s)),w=g?JSON.parse(g):[];return Array.isArray(w)?w.map(S=>Number(S)).filter(S=>Number.isFinite(S)):[]}catch{return[]}}),{data:m,isLoading:d}=O({queryKey:["profile-notifications",s],queryFn:()=>A.notifications_list({targetUserId:s,limit:100}),enabled:s>0}),b=p.useMemo(()=>(m?.notifications??[]).filter(g=>g.target_id==null||!c.includes(g.target_id)),[m?.notifications,c]);p.useEffect(()=>{typeof window>"u"||s<=0||window.localStorage.setItem(ls(s),JSON.stringify(c))},[c,s]),p.useEffect(()=>{if(!b.length){l(null);return}l(g=>g&&b.some(w=>w.target_id===g)?g:b.find(w=>!w.read)?.target_id??b[0].target_id??null)},[b]);const f=p.useMemo(()=>b.find(g=>g.target_id===o)??b[0]??null,[b,o]),x=async g=>{l(g.target_id??null),g.target_id&&!g.read&&A.notifications_mark_read({targetId:g.target_id}).then(()=>i.invalidateQueries({queryKey:["profile-notifications"]})).catch(()=>{})},h=g=>{const w=bt(g);if(w!=="/profile?section=messages"){if(w==="/profile?section=interviews"){t("interviews");return}if(w==="/profile?section=objectives"){t("objectives");return}if(w==="/"){window.location.hash="#/";return}r(w)}},y=g=>{x(g),bt(g)!=="/profile?section=messages"&&h(g)},j=()=>{const g=b.map(w=>w.target_id).filter(w=>w!=null);g.length!==0&&(u(w=>Array.from(new Set([...w,...g]))),l(null),a({title:"Notifications masquées",description:"La boîte de réception a été vidée sur cet appareil uniquement."}))};return e.jsxs("div",{className:"space-y-5 pb-24",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs(B,{variant:"ghost",size:"sm",className:"-ml-2",onClick:n,children:[e.jsx(pe,{className:"mr-1.5 h-4 w-4"}),"Retour"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex h-10 w-10 items-center justify-center rounded-2xl border border-primary/20 bg-primary/10",children:e.jsx(Cs,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-display font-semibold uppercase italic text-primary",children:"Messages"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Détails des notifications reçues et accès rapide aux actions liées."})]})]}),b.length>0?e.jsxs(B,{variant:"ghost",size:"sm",className:"-ml-1 w-fit",onClick:j,children:[e.jsx(Ct,{className:"h-4 w-4"}),"Masquer toutes les notifications sur cet appareil"]}):null]}),d?e.jsx("div",{className:"space-y-3",children:[1,2,3].map(g=>e.jsx("div",{className:"h-24 rounded-2xl border bg-card/60 animate-pulse motion-reduce:animate-none"},g))}):null,!d&&b.length===0?e.jsx(ye,{className:"overflow-hidden border-primary/15 bg-gradient-to-br from-card via-card to-primary/5",children:e.jsxs(je,{className:"flex flex-col items-center gap-3 py-10 text-center",children:[e.jsx("div",{className:"flex h-12 w-12 items-center justify-center rounded-2xl border border-dashed border-primary/30 bg-primary/5",children:e.jsx(nn,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm font-semibold",children:"Aucun message pour le moment"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Les notifications du coach et les rappels automatiques apparaîtront ici."})]})]})}):null,f?e.jsxs(ye,{className:"overflow-hidden border-primary/20 bg-gradient-to-br from-card via-card to-primary/5 shadow-sm",children:[e.jsxs(Oe,{className:"gap-3",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx(T,{variant:f.read?"outline":"default",children:f.read?"Lu":"Nouveau"}),e.jsx(T,{variant:"secondary",children:f.type||"message"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:cs(f.date)})]}),e.jsxs("div",{children:[e.jsx(ze,{className:"text-lg",children:f.title}),e.jsx(Le,{className:"mt-2 text-sm leading-relaxed text-foreground/80",children:f.message||"Aucun détail supplémentaire."})]})]}),rt(f)?e.jsx(je,{className:"pt-0",children:e.jsxs(B,{variant:"outline",className:"w-full justify-between",onClick:async()=>{x(f),h(f)},children:[rt(f),e.jsx(de,{className:"h-4 w-4"})]})}):null]}):null,b.length>0?e.jsx("div",{className:"space-y-3",children:b.map(g=>{const w=g.target_id===f?.target_id,S=rt(g);return e.jsx("button",{type:"button",onClick:()=>y(g),className:`w-full rounded-2xl border p-4 text-left transition focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring ${w?"border-primary/35 bg-primary/5 shadow-sm":"border-border bg-card hover:border-primary/20 hover:bg-muted/40"}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"pt-0.5",children:g.read?e.jsx(en,{className:"h-5 w-5 text-muted-foreground"}):e.jsx("div",{className:"h-2.5 w-2.5 rounded-full bg-primary shadow-[0_0_0_4px_rgba(227,6,19,0.08)]"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx("p",{className:"truncate text-sm font-semibold",children:g.title}),e.jsx("span",{className:"shrink-0 text-[11px] text-muted-foreground",children:cs(g.date)})]}),e.jsx("p",{className:"mt-1 line-clamp-2 text-sm text-muted-foreground",children:g.message||"Aucun détail supplémentaire."}),S?e.jsxs("span",{className:"mt-2 inline-flex items-center gap-1 text-xs font-semibold uppercase tracking-[0.08em] text-primary",children:[S,e.jsx(de,{className:"h-3.5 w-3.5"})]}):null]})]})},g.target_id??g.id)})}):null]})}const wt=[{id:1,text:"Es-tu toujours en quête de nouvelles expériences et avide d'apprendre ?",options:[{label:"Oui, en permanence",scores:["1B","2A"],weight:36},{label:"Pas de façon obsessionnelle",scores:["2B","3"],weight:30},{label:"Ça dépend des périodes",scores:["2A"],weight:36}]},{id:2,text:"Dirais-tu que tu es plutôt calme au quotidien, mais avec des coups de sang qui retombent vite ?",options:[{label:"Oui, je peux m'emporter mais ça retombe vite",scores:["1B","2A"],weight:36},{label:"Non, quand je m'énerve ça dure",scores:["2B","3"],weight:30},{label:"Ça dépend des moments",scores:["2A"],weight:36}]},{id:3,text:"Qu'est-ce qui te motive le plus : atteindre des objectifs précis (records, médailles) ou voir des progrès petit à petit ?",options:[{label:"Les objectifs précis",scores:["1A","1B","2A"],weight:52},{label:"Les progrès graduels",scores:["3"],weight:28},{label:"Un mélange des deux",scores:["2A"],weight:37}]},{id:4,text:"Tu donnes le meilleur de toi quand les enjeux sont élevés (finales, grandes compétitions) ou quand la pression est faible ?",options:[{label:"Quand les enjeux sont élevés",scores:["1A","1B"],weight:28},{label:"Quand la pression est faible",scores:["2B","3"],weight:30},{label:"Entre les deux",scores:["2A"],weight:26}]},{id:5,text:"Les règles et l'autorité, c'est ton truc ou pas du tout ?",options:[{label:"Pas du tout, j'aime les bousculer",scores:["1A","1B"],weight:28},{label:"Oui, je les respecte",scores:["2B","3"],weight:30},{label:"Ça dépend des situations",scores:["2A"],weight:26}]},{id:6,text:"Préfères-tu t'entraîner longtemps à intensité modérée, ou court mais à fond ?",options:[{label:"Court mais à fond",scores:["1A","1B"],weight:28},{label:"Longtemps à intensité modérée",scores:["3"],weight:28},{label:"Un peu des deux",scores:["2A"],weight:26}]},{id:7,text:"Est-ce que tu fais souvent passer les autres avant toi — quitte à le regretter ensuite ?",options:[{label:"Oui, souvent",scores:["2B"],weight:0},{label:"Parfois",scores:["1B","2A","2B"],weight:15},{label:"Pas vraiment",scores:["1A"],weight:0}]},{id:8,text:"Es-tu capable de bien te concentrer sur une tâche tout en sachant passer rapidement d'une chose à l'autre ?",options:[{label:"Oui",scores:["1B","2A"],weight:38},{label:"Un peu",scores:["2A"],weight:37},{label:"Pas vraiment",scores:["1A","2B","3"],weight:35}]},{id:9,text:"Est-ce que tu te retrouves souvent dans le rôle du « leader silencieux » — celui qui montre l'exemple sans avoir besoin de donner des ordres ?",options:[{label:"Oui",scores:["1B","2A"],weight:38},{label:"Un peu",scores:["2A"],weight:37},{label:"Pas vraiment",scores:[],weight:0}]},{id:10,text:"Es-tu très impatient(e) et toujours en train de vouloir faire quelque chose en attendant ?",options:[{label:"Oui",scores:["1B","2A"],weight:38},{label:"Un peu",scores:["2A"],weight:37},{label:"Pas vraiment",scores:["3"],weight:57}]},{id:11,text:"Es-tu particulièrement motivé(e) par le fait de gagner le respect et l'admiration des autres ?",options:[{label:"Oui",scores:["1B","2A","2B"],weight:0},{label:"Un peu",scores:["2A","2B"],weight:31},{label:"Pas vraiment",scores:["1A","1B","3"],weight:0}]},{id:12,text:"As-tu tendance à adopter le comportement de la personne en face de toi, à faire ce qu'il faut pour être apprécié(e) ?",options:[{label:"Oui",scores:["1B","2A"],weight:36},{label:"Un peu",scores:["1B","2A"],weight:12},{label:"Pas vraiment",scores:[],weight:0}]},{id:13,text:"Quand quelqu'un te raconte quelque chose, tu adores rebondir avec « Ah non, moi aussi ça m'est arrivé ! » — tu cherches toujours à créer un lien ?",options:[{label:"Oui",scores:["1B","2A","2B"],weight:0},{label:"Un peu",scores:["2A","2B"],weight:31},{label:"Pas vraiment",scores:[],weight:0}]},{id:14,text:"Est-ce que tu procrastines souvent et fais ton meilleur travail à la dernière minute ?",options:[{label:"Oui, tout le temps",scores:["1B","2A","2B"],weight:13},{label:"Parfois",scores:["2A"],weight:29},{label:"Jamais",scores:["3"],weight:57}]},{id:15,text:"L'opinion des autres compte beaucoup pour toi ?",options:[{label:"Oui",scores:["2A","2B"],weight:20},{label:"Un peu",scores:["1B","2A","2B"],weight:0},{label:"Pas du tout",scores:["1A","1B"],weight:0}]},{id:16,text:"Tu as besoin de varier et de changer régulièrement pour rester motivé(e) à l'entraînement ?",options:[{label:"Oui, c'est indispensable",scores:["1B","2A","2B"],weight:0},{label:"Un peu",scores:["1B","2A"],weight:16},{label:"Non, je préfère la régularité",scores:["1A","2B","3"],weight:35}]},{id:17,text:"Tu es ami(e) avec tout le monde, ou plutôt du genre à avoir un petit cercle d'amis très proches ?",options:[{label:"J'ai beaucoup d'amis",scores:["2A"],weight:52},{label:"Peu d'amis, mais très proches",scores:["1A","2B","3"],weight:35},{label:"Un mélange des deux",scores:["1B","2A"],weight:36}]},{id:18,text:"Tu as besoin de te donner à fond et de « sentir la brûlure » pour que tes séances te motivent ?",options:[{label:"Oui, j'adore sentir que ça brûle",scores:["2B"],weight:0},{label:"Non, je suis motivé(e) par autre chose",scores:["1A","2B","3"],weight:35}]},{id:19,text:"Tu aimes bien t'habiller et soigner ton apparence ?",options:[{label:"Oui",scores:["2A","2B"],weight:26},{label:"Parfois",scores:["1B","2A"],weight:21},{label:"Pas spécialement",scores:["1A","2B","3"],weight:0}]},{id:20,text:"Tu as du mal à te laisser aller et à baisser ta garde ?",options:[{label:"Oui",scores:["3"],weight:78},{label:"Un peu",scores:["2B","3"],weight:4},{label:"Pas vraiment",scores:["1B","2A"],weight:25}]},{id:21,text:"Tu aimes tout planifier à l'avance pour éviter les imprévus ?",options:[{label:"Oui",scores:["2B","3"],weight:46},{label:"Parfois",scores:[],weight:0},{label:"Non, je suis plutôt spontané(e)",scores:["1B","2A"],weight:25}]},{id:22,text:"Tu as besoin de te sentir calme et en contrôle pour donner le meilleur de toi-même ?",options:[{label:"Oui",scores:["2B","3"],weight:0},{label:"Non",scores:["1B","2A"],weight:25}]},{id:23,text:"Qu'est-ce qui te pousse le plus : gagner, ou impressionner les autres et gagner leur respect ?",options:[{label:"Gagner",scores:["1A","1B","2A","2B"],weight:17},{label:"Impressionner et gagner le respect",scores:["1A","1B","2A","2B"],weight:6},{label:"Un mélange des deux",scores:["1B","2A"],weight:25}]},{id:24,text:"Tes amis diraient que tu es du genre à toujours vouloir avoir raison dans une discussion animée ?",options:[{label:"Oui, c'est tout moi",scores:["1A","2A","2B"],weight:43},{label:"Pas vraiment",scores:["1A","1B","2A","2B"],weight:4}]},{id:25,text:"Tu fais du trash-talk avant les courses ?",options:[{label:"Oui, carrément",scores:["1A","2A","2B"],weight:38},{label:"Parfois, pour rigoler",scores:["1B","2A"],weight:26},{label:"Pas vraiment",scores:["1A","1B","2A","2B","3"],weight:20}]},{id:26,text:"Tu préfères des échauffements courts ou longs ?",options:[{label:"Courts",scores:["1A","1B","2A","2B","3"],weight:24},{label:"Longs",scores:["1A","1B","2A","2B","3"],weight:0}]},{id:27,text:"Tu nages mieux en fin de série difficile, ou tu es capable d'envoyer fort dès le départ ?",options:[{label:"Fort dès le départ",scores:["1A","1B","2A","2B","3"],weight:24},{label:"Je monte en puissance et je suis meilleur vers la fin",scores:["1A","1B","2A","2B","3"],weight:0}]},{id:28,text:"Tu préfères beaucoup de variété dans tes entraînements, ou quelque chose de plus prévisible ?",options:[{label:"J'ai besoin de changement pour rester motivé(e)",scores:["1A","1B","2A","2B","3"],weight:24},{label:"Je n'aime pas trop que ça change",scores:["1A","1B","2B","3"],weight:0}]},{id:29,text:"Tu t'ennuies vite quand tu enchaînes les mêmes distances, les mêmes nages, les mêmes allures ?",options:[{label:"Oui, j'ai besoin de varier",scores:["1A","1B","2A","2B","3"],weight:24},{label:"Non, j'aime la répétition",scores:["1A","1B","2B","3"],weight:0}]},{id:30,text:"Tu aimes être le leader du groupe ou le centre de l'attention ?",options:[{label:"Oui",scores:["1A","2B","3"],weight:32},{label:"Ça ne me dérange pas",scores:["1A","1B"],weight:0}]}],yt={"1A":{code:"1A",name:"Intensité",fullName:"Le Neurotype INTENSITÉ",neurotransmitter:"Dopamine",motto:"Tu dois devenir plus fort pour devenir plus rapide.",traits:["Bruyant, confiant, compétitif — adore être le leader","Impatient ; s'épanouit face aux défis orientés vers un objectif","Agit par impulsion et aime prendre des risques","Adore gagner — mauvais perdant et mauvais gagnant","Peut être très intense mais s'épuise vite","Déteste les règles, sauf quand c'est lui qui les enfreint","Très charismatique — excellent motivateur sur de courtes périodes"],gymTraining:["Travail explosif lourd, travail de puissance depuis l'arrêt, isométriques haute intensité, développement de la force brute (exercices composés, peu de répétitions, haute intensité)","Force maximale : travailler à 85 %+ du max en 3-5 répétitions par série","Temps de repos longs (2-5 min) pour maintenir l'intensité","Faible volume mais effort maximal pour se sentir au mieux et progresser le plus vite","Doit viser des records personnels chaque semaine en changeant les exercices principaux régulièrement"],poolTraining:["Sprints courts à fond (5-10 s) avec beaucoup de récupération (2-10 min)","A besoin de progrès chiffrés et suivis pour rester motivé","S'épanouit avec le travail de sprint résisté (parachutes, plaquettes, palmes, élastiques)","Se démotive avec les longues séries aérobiques","Le conditioning doit être basé sur de la haute intensité avec des repos courts — pas trop de volume, sinon il perd son tranchant, son intensité et sa motivation"]},"1B":{code:"1B",name:"Explosif",fullName:"Le Neurotype EXPLOSIF",neurotransmitter:"Dopamine + Adrénaline",motto:"Tu dois devenir plus puissant pour devenir plus rapide et plus fort.",traits:["Très compétitif mais garde ses émotions plus sous contrôle que le 1A","Apprend de nouvelles compétences rapidement et s'adapte vite","Performe mieux sous pression et aime les défis","S'ennuie facilement et a besoin de variété","Adore les tâches explosives et à forte intensité","D'un naturel plutôt calme, mais capable de montées explosives ponctuelles avant de retrouver son calme rapidement"],gymTraining:["Travail explosif haute intensité : sauts, haltérophilie olympique, mouvements réactifs","Profite du travail en superset/contraste (ex. : squat lourd + saut en contre-haut)","La variété est essentielle — rotation fréquente des exercices","Faible volume mais puissance maximale : 1-5 répétitions à 85 %+ du max","Peut aussi profiter d'un travail de force de base pour poser les fondations"],poolTraining:["Sprints courts (5-10 s) avec récupération complète (2-10 min)","A besoin de variété dans le travail de nage (différents stimuli : technique, vitesse, résistance)","Peut intégrer du travail résisté mais plutôt léger","Faible tolérance au travail lactique","Le meilleur moyen de développer son endurance aérobie : intervalles haute intensité ou travail à intensité modérée en changeant régulièrement le focus"]},"2A":{code:"2A",name:"Variation",fullName:"Le Neurotype VARIATION",neurotransmitter:"Adrénaline + Sérotonine",motto:"Tout fonctionne, mais rien ne fonctionne longtemps.",traits:["Adaptable — peut s'épanouir dans la plupart des conditions d'entraînement","Facilement influencé par l'environnement et le style de coaching","A besoin de changements fréquents pour rester engagé","Peut encaisser un volume élevé mais risque le burn-out mental","Papillon social — ami avec tout le monde, s'adapte à tous les groupes","Motivé par le cadre social de l'entraînement","Extraverti, énergique et communicatif"],gymTraining:["Rotation entre différents schémas de répétitions","Alternance de blocs d'entraînement (phases de 3-4 semaines)","Entraînement hybride : mélange de force, d'explosivité et de volume","S'ennuie vite avec un programme trop figé","Répond bien à un cadre structuré mais avec de la variété intégrée"],poolTraining:["Capable de gérer aussi bien la haute intensité que l'endurance, mais a besoin de changer régulièrement","Mélanger les focus au sein des séances (technique, vitesse, allure, résistance)","S'épanouit avec un mix de travail résisté, de vitesse et d'allure de course","Profite de l'ambiance de groupe et du cadre social","Se démotive si les séances sont trop répétitives"]},"2B":{code:"2B",name:"Sensation",fullName:"Le Neurotype SENSATION",neurotransmitter:"Sérotonine + GABA",motto:"Guidé par les émotions, il s'épanouit quand il se sent fort et connecté.",traits:["Guidé par ses émotions et très intuitif","Travaille plus dur quand il se sent respecté et valorisé","Peut avoir tendance à en faire trop s'il pense que cela lui vaudra de la reconnaissance","Peut être en difficulté dans les situations de forte pression","Empathique — ressent intensément les émotions des autres","Fait souvent passer les autres avant lui-même (et le regrette parfois)","Motivé par le sens personnel plutôt que par la compétition pure"],gymTraining:["La connexion corps-esprit (mind-muscle connection) est primordiale","Pour la force : répétitions modérées (6-10) avec des tempos lents","Préfère une programmation structurée et prévisible","Aime la sensation d'effort, de « pump » et de brûlure musculaire","A besoin d'une surcharge progressive régulière et méthodique"],poolTraining:["Monte en puissance progressivement au fil de la séance — meilleur vers la fin","Aime travailler dur et « sentir » qu'il a bien bossé","Peut encaisser du travail d'endurance mais a besoin de soutien émotionnel","Le travail de vitesse doit être sur des distances plus longues (25-50 m) avec moins de repos","A besoin d'encouragements et d'un cadre bienveillant pour donner le meilleur de lui-même"]},3:{code:"3",name:"Contrôle",fullName:"Le Neurotype CONTRÔLE",neurotransmitter:"GABA",motto:"S'épanouit dans la structure, la précision et la constance.",traits:["Très analytique et soucieux du détail","A tendance à trop réfléchir et supporte mal l'imprévu","Préfère la planification à long terme et la structure","N'aime pas prendre de risques — préfère une progression constante et contrôlée","A du mal à baisser sa garde et à faire confiance aux autres","A besoin de se sentir calme et en contrôle pour performer","Introverti, réservé, fidèle à la routine"],gymTraining:["Blocs d'entraînement constants (mêmes exercices, même structure pendant plusieurs semaines/mois)","Surcharge progressive graduelle et méthodique","Préfère le travail isométrique et le tempo lent","A besoin de tout connaître à l'avance (exercices, séries, repos)","Se sent déstabilisé par les changements non prévus dans le programme"],poolTraining:["A besoin d'échauffements longs et progressifs","Préfère des séries constantes avec un minimum de variation","Peut encaisser un volume élevé d'endurance","Le travail de vitesse doit rester minimal et prévisible","Performe mieux quand il connaît la séance à l'avance et peut s'y préparer mentalement"]}},ds={"1A":"#ef4444","1B":"#f97316","2A":"#eab308","2B":"#22c55e",3:"#3b82f6"},ja={"1A":490,"1B":680,"2A":845,"2B":680,3:700};function Na(s){const n=["1A","1B","2A","2B","3"],t={"1A":0,"1B":0,"2A":0,"2B":0,3:0};for(const i of wt){const o=s[i.id];if(o!==void 0&&i.options[o]){const l=i.options[o];for(const c of l.scores)t[c]+=l.weight}}const r={};for(const i of n)r[i]=Math.round(t[i]/ja[i]*100);return{dominant:n.reduce((i,o)=>r[o]>r[i]?o:i),scores:r,takenAt:new Date().toISOString()}}function Sa(s){return s>=71?"match":s>=49?"potential":"unsuited"}const Ca={enter:s=>({x:s>0?100:-100,opacity:0}),center:{x:0,opacity:1},exit:s=>({x:s>0?-100:100,opacity:0})},_a={duration:.25,ease:"easeInOut"},Aa=[{icon:sn,title:"Focus",text:"Adopte des méthodes d'entraînement adaptées"},{icon:$e,title:"Accomplir",text:"Obtiens de meilleurs gains en moins de temps"},{icon:Wr,title:"Performer",text:"Développe la confiance dans ton programme"},{icon:ir,title:"Résultats",text:"Commence à exploser tes records !"}];function Pa({onComplete:s,onCancel:n}){const[t,r]=p.useState("intro"),[a,i]=p.useState(0),[o,l]=p.useState({}),[c,u]=p.useState(!1),m=p.useRef(1),d=wt.length,b=wt[a];p.useCallback(()=>{a<d-1&&(m.current=1,i(g=>g+1))},[a,d]);const f=p.useCallback(()=>{a>0?(m.current=-1,i(g=>g-1)):r("intro")},[a]),x=p.useCallback(g=>{if(c)return;u(!0);const w={...o,[b.id]:g};l(w),setTimeout(()=>{if(a===d-1){const S=Na(w);s(S)}else m.current=1,i(S=>S+1);u(!1)},300)},[c,o,b,a,d,s]);if(t==="intro")return e.jsxs("div",{className:"flex flex-col items-center px-5 py-8 text-center max-w-md mx-auto",children:[e.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:"Découvre ton Type d'Entraînement"}),e.jsx("p",{className:"mt-3 text-sm text-muted-foreground leading-relaxed",children:"Connaître ton Neurotype te permet de t'entraîner d'une manière qui maximise tes résultats, ta récupération et ta motivation !"}),e.jsx("div",{className:"grid grid-cols-2 gap-3 mt-8 w-full",children:Aa.map(({icon:g,title:w,text:S})=>e.jsxs("div",{className:"flex flex-col items-center gap-1.5 rounded-xl border bg-card p-4",children:[e.jsx(g,{className:"h-6 w-6 text-primary"}),e.jsx("span",{className:"text-sm font-semibold",children:w}),e.jsx("span",{className:"text-xs text-muted-foreground leading-snug",children:S})]},w))}),e.jsx(B,{className:"mt-8 w-full",size:"lg",onClick:()=>r("quiz"),children:"Commencer le quiz"}),e.jsx("button",{type:"button",className:"mt-3 text-sm text-muted-foreground hover:text-foreground transition-colors",onClick:n,children:"Retour"})]});const h=(a+1)/d*100,y=o[b.id],j=["A","B","C","D"];return e.jsxs("div",{className:"flex flex-col max-w-md mx-auto px-5 py-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("button",{type:"button",className:"p-2 -ml-2 text-muted-foreground hover:text-foreground transition-colors",onClick:f,"aria-label":"Question précédente",children:e.jsx(pe,{className:"h-5 w-5"})}),e.jsxs("span",{className:"text-sm font-medium tabular-nums",children:[a+1," / ",d]}),e.jsx("button",{type:"button",className:"text-xs text-muted-foreground hover:text-foreground transition-colors",onClick:n,children:"Quitter"})]}),e.jsx("div",{className:"mt-3 h-1.5 w-full rounded-full bg-muted overflow-hidden",children:e.jsx(le.div,{className:"h-full rounded-full bg-primary",initial:!1,animate:{width:`${h}%`},transition:{duration:.4,ease:"easeOut"}})}),e.jsx(_s,{mode:"wait",custom:m.current,children:e.jsxs(le.div,{custom:m.current,variants:Ca,initial:"enter",animate:"center",exit:"exit",transition:_a,className:"mt-8 flex flex-col gap-4",children:[e.jsx("p",{className:"text-base font-medium leading-relaxed normal-case not-italic",children:b.text}),e.jsx("div",{className:"flex flex-col gap-2.5 mt-2",children:b.options.map((g,w)=>{const S=y===w,P=c&&S,k=P||S;return e.jsxs(le.button,{type:"button",disabled:c,initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:w*.06,duration:.25},className:["flex items-start gap-3 rounded-xl border p-3.5 text-left w-full transition-all duration-200 normal-case tracking-normal font-normal",P?"border-primary bg-primary/8 shadow-sm":S?"border-primary/40 bg-primary/5":"bg-card hover:bg-muted/50 active:scale-[0.98]"].join(" "),onClick:()=>x(w),children:[e.jsx("span",{className:["flex-shrink-0 flex items-center justify-center w-7 h-7 rounded-full text-xs font-bold transition-colors duration-200",k?"bg-primary text-primary-foreground":"bg-muted text-muted-foreground"].join(" "),children:j[w]}),e.jsx("span",{className:"text-sm leading-snug pt-1",children:g.label})]},w)})})]},a)})]})}const Ea=["1A","1B","2A","2B","3"];function Da({level:s}){const n={match:{label:"Correspondance",className:"bg-emerald-100 text-emerald-700 dark:bg-emerald-900/40 dark:text-emerald-400"},potential:{label:"Potentiel",className:"bg-amber-100 text-amber-700 dark:bg-amber-900/40 dark:text-amber-400"},unsuited:{label:"Inadapté",className:"bg-muted text-muted-foreground"}}[s];return e.jsx("span",{className:`inline-block rounded-full px-2 py-0.5 text-[10px] font-medium leading-tight whitespace-nowrap ${n.className}`,children:n.label})}function ka({title:s,icon:n,items:t,defaultOpen:r=!1}){const[a,i]=p.useState(r);return e.jsxs("div",{className:"rounded-xl border bg-card text-card-foreground overflow-hidden",children:[e.jsxs("button",{type:"button",onClick:()=>i(o=>!o),className:"flex w-full items-center gap-2 px-4 py-3 text-left font-semibold text-sm",children:[n,e.jsx("span",{className:"flex-1",children:s}),e.jsx(Ss,{className:`h-4 w-4 text-muted-foreground transition-transform duration-300 ${a?"rotate-180":""}`})]}),e.jsx(_s,{initial:!1,children:a&&e.jsx(le.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.3,ease:"easeInOut"},className:"overflow-hidden",children:e.jsx("ul",{className:"space-y-2 px-4 pb-4 text-sm text-muted-foreground",children:t.map((o,l)=>e.jsxs("li",{className:"flex gap-2",children:[e.jsx("span",{className:"mt-1.5 h-1.5 w-1.5 shrink-0 rounded-full bg-muted-foreground/40"}),e.jsx("span",{children:o})]},l))})},"content")})]})}function Ra({result:s,onSave:n,onRetry:t,onBack:r,isSaving:a}){const i=yt[s.dominant],o=ds[s.dominant],[l,c]=p.useState(!1);return p.useEffect(()=>{const u=setTimeout(()=>c(!0),300);return()=>clearTimeout(u)},[]),e.jsxs(le.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"mx-auto max-w-lg space-y-6 pb-28",children:[e.jsxs("button",{type:"button",onClick:r,className:"flex items-center gap-1 text-sm text-muted-foreground hover:text-foreground transition-colors",children:[e.jsx(pe,{className:"h-4 w-4"}),"Retour"]}),e.jsxs("div",{className:"flex flex-col items-center text-center space-y-3",children:[e.jsx("span",{className:"inline-flex items-center justify-center rounded-full px-5 py-2 text-2xl font-bold text-white shadow-lg",style:{backgroundColor:o},children:i.code}),e.jsx("h1",{className:"text-xl font-bold",children:i.fullName}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Neurotransmetteur dominant :"," ",e.jsx("span",{className:"font-medium text-foreground",children:i.neurotransmitter})]}),e.jsxs("p",{className:"italic text-muted-foreground text-sm",children:["« ",i.motto," »"]}),e.jsx("p",{className:"text-xs text-muted-foreground/70 leading-relaxed normal-case not-italic mt-1",children:"Ces résultats sont donnés à titre indicatif pour t'aider à réfléchir sur tes préférences d'entraînement."})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h2",{className:"text-base font-semibold",children:"Tes scores"}),e.jsx("div",{className:"space-y-3",children:Ea.map(u=>{const m=s.scores[u],d=Sa(m),b=yt[u];return e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsxs("span",{className:"font-medium",children:[u," ",e.jsx("span",{className:"text-muted-foreground",children:b.name})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsxs("span",{className:"tabular-nums font-medium",children:[m,"%"]}),e.jsx(Da,{level:d})]})]}),e.jsx("div",{className:"h-3 w-full rounded-full bg-muted overflow-hidden",children:e.jsx("div",{className:"h-3 rounded-full transition-all duration-700 ease-out",style:{width:l?`${m}%`:"0%",backgroundColor:ds[u]}})})]},u)})})]}),e.jsxs("div",{className:"rounded-xl border bg-card text-card-foreground overflow-hidden",children:[e.jsxs("div",{className:"flex items-center gap-2 px-4 py-3 font-semibold text-sm",children:[e.jsx(or,{className:"h-4 w-4"}),e.jsx("span",{children:"Entraînement en Salle"})]}),e.jsx("ul",{className:"space-y-2 px-4 pb-4 text-sm text-muted-foreground",children:i.gymTraining.map((u,m)=>e.jsxs("li",{className:"flex gap-2",children:[e.jsx("span",{className:"mt-1.5 h-1.5 w-1.5 shrink-0 rounded-full bg-muted-foreground/40"}),e.jsx("span",{children:u})]},m))})]}),e.jsx(ka,{title:"Traits de personnalité",items:i.traits}),e.jsxs("div",{className:"flex flex-col gap-3 pt-2",children:[e.jsx(B,{onClick:()=>n(s),disabled:a,className:"w-full",children:a?e.jsxs(e.Fragment,{children:[e.jsx(Rt,{className:"mr-2 h-4 w-4 animate-spin"}),"Enregistrement..."]}):e.jsxs(e.Fragment,{children:[e.jsx(As,{className:"mr-2 h-4 w-4"}),"Enregistrer mon résultat"]})}),e.jsxs(B,{variant:"outline",onClick:t,className:"w-full",children:[e.jsx(Rt,{className:"mr-2 h-4 w-4"}),"Refaire le quiz"]})]})]})}function us(){if(typeof window>"u")return"home";const t=window.location.hash.match(/[?&]section=([^&]+)/)?.[1];switch(t){case"messages":case"performance-hub":case"objectives":case"interviews":case"neurotype-quiz":case"neurotype-result":return t;default:return"home"}}const Ta=s=>s!=="coach"&&s!=="admin"&&s!=="comite",Ma=s=>{switch(s){case"coach":return"Entraineur EAC";case"admin":return"Admin";case"comite":return"Comité";default:return"Nageur"}},Ba=s=>yt[s]?.name??s;function ee({icon:s,title:n,description:t,onClick:r,accentClassName:a="text-primary",badgeLabel:i}){return e.jsxs("button",{type:"button",onClick:r,className:"flex w-full items-center gap-3 rounded-2xl border border-border/70 bg-background/70 px-4 py-3 text-left transition hover:border-primary/25 hover:bg-muted/40 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",children:[e.jsx("div",{className:"flex h-10 w-10 shrink-0 items-center justify-center rounded-2xl bg-primary/10",children:e.jsx(s,{className:`h-5 w-5 ${a}`})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-sm font-semibold",children:n}),e.jsx("p",{className:"text-xs text-muted-foreground",children:t})]}),i?e.jsx(T,{variant:"secondary",className:"shrink-0 text-[10px] uppercase tracking-[0.08em]",children:i}):null,e.jsx(de,{className:"h-4 w-4 shrink-0 text-muted-foreground"})]})}const qa=hs({group_id:re().optional(),bio:re().optional(),birthdate:re().optional().refine(s=>{if(!s)return!0;const n=new Date(s);if(isNaN(n.getTime()))return!1;const t=(new Date().getTime()-n.getTime())/(1e3*60*60*24*365.25);return t>=6&&t<=100},{message:"L'âge doit être entre 6 et 100 ans"}),ffn_iuf:re().optional().refine(s=>s?/^\d+$/.test(s):!0,{message:"L'IUF FFN doit être un nombre"}),phone:re().optional()}),Oa=hs({password:re().min(8,"Le mot de passe doit contenir au moins 8 caractères").regex(/[A-Z]/,"Le mot de passe doit contenir au moins une majuscule").regex(/\d/,"Le mot de passe doit contenir au moins un chiffre"),confirmPassword:re()}).refine(s=>s.password===s.confirmPassword,{message:"Les mots de passe ne correspondent pas",path:["confirmPassword"]});function _i(){const s=ie(v=>v.user),n=ie(v=>v.userId),t=ie(v=>v.logout),r=ie(v=>v.role),{toast:a}=Ue(),i=Fe(),[,o]=jt(),l=Ta(r),c=r==="athlete"||r==="coach"||r==="admin",u=Ma(r),[m,d]=p.useState(()=>us()),[b,f]=p.useState(!1),[x,h]=p.useState(!1),[y,j]=p.useState(!1),[g,w]=p.useState(null),[S,P]=p.useState(null),[k,L]=p.useState(!1),[M,I]=p.useState(!1);p.useEffect(()=>{const v=()=>{d("home"),f(!1),h(!1),w(null),P(null)};return window.addEventListener("nav:reset",v),()=>window.removeEventListener("nav:reset",v)},[]),p.useEffect(()=>{const v=()=>{d(us())};return window.addEventListener("hashchange",v),()=>window.removeEventListener("hashchange",v)},[]),p.useEffect(()=>{if(typeof window>"u")return;const v=m==="home"?"#/profile":`#/profile?section=${m}`;if(window.location.hash===v)return;const q=`${window.location.pathname}${window.location.search}${v}`;window.history.replaceState(null,"",q)},[m]),p.useEffect(()=>{Tt()&&lr().then(L)},[]);const C=async()=>{if(n){I(!0);try{if(k){if(!await ur(n)){a({title:"Désactivation impossible",description:"Le service worker push n'est pas disponible sur cet appareil.",variant:"destructive"});return}L(!1)}else{if(!await mr(n)){a({title:"Activation impossible",description:"Vérifiez que l'app est installée, que les notifications sont autorisées et que la configuration push est disponible.",variant:"destructive"});return}L(!0)}}catch(v){a({title:"Notifications push indisponibles",description:v instanceof Error?v.message:"Une erreur est survenue pendant l'activation.",variant:"destructive"})}finally{I(!1)}}},E=async()=>{j(!0),localStorage.removeItem("app_build_timestamp");try{const v=window.__pwaRegistration??await navigator.serviceWorker?.getRegistration();if(v&&(await v.update(),await new Promise(q=>setTimeout(q,1500))),"caches"in window){const q=await caches.keys();await Promise.all(q.map(H=>caches.delete(H)))}window.location.reload()}catch{window.location.reload()}},_=Ot({resolver:zt(qa),defaultValues:{group_id:"",bio:"",birthdate:"",ffn_iuf:"",phone:""}}),z=Ot({resolver:zt(Oa),defaultValues:{password:"",confirmPassword:""}}),{data:D,isLoading:R,error:Z,refetch:W}=O({queryKey:["profile",s,n],queryFn:()=>A.getProfile({displayName:s,userId:n}),enabled:!!s}),{data:$=[],isLoading:G,error:_e,refetch:Ae}=O({queryKey:["profile-groups"],queryFn:()=>A.getGroups(),enabled:!!s}),Pe=Z||_e,X=()=>{W(),Ae()},J=l,{data:fe}=O({queryKey:["profile-notifications-unread",n],queryFn:()=>A.notifications_list({targetUserId:n??null,status:"unread",limit:100}),enabled:J&&!!n}),{data:Ee=[]}=O({queryKey:["profile-interviews-summary"],queryFn:()=>A.getMyInterviews(),enabled:J&&!!s}),{data:N=[]}=O({queryKey:["profile-objectives-summary"],queryFn:()=>A.getAthleteObjectives(),enabled:J&&!!s}),De=p.useMemo(()=>{const v=D?.avatar_url;return v||(s?`https://api.dicebear.com/7.x/initials/svg?seed=${encodeURIComponent(s)}`:"")},[D,s]),V=fe?.pagination.total??fe?.notifications.length??0,Y=p.useMemo(()=>Ee.filter(v=>v.status==="draft_athlete"||v.status==="sent").length,[Ee]),xe=N.length,ge=p.useMemo(()=>{const v=new Date;return v.setHours(0,0,0,0),N.map(q=>q.competition_date??null).filter(q=>!!q).filter(q=>{const H=new Date(`${q}T00:00:00`);return!Number.isNaN(H.getTime())&&H>=v}).sort((q,H)=>q.localeCompare(H))[0]??null},[N]),ne=p.useMemo(()=>{if(!ge)return null;const v=new Date;v.setHours(0,0,0,0);const H=new Date(`${ge}T00:00:00`).getTime()-v.getTime();return Math.max(0,Math.round(H/(1e3*60*60*24)))},[ge]),ve=(V>0?1:0)+(Y>0?1:0)+(ne!==null?1:0),ke=p.useMemo(()=>{const v=[];return xe>0&&v.push(`${xe} objectif${xe>1?"s":""} actif${xe>1?"s":""}`),Y>0&&v.push(`${Y} entretien${Y>1?"s":""} à traiter`),ne!==null&&v.push(`cap J-${ne}`),v.join(" • ")},[xe,Y,ne]),He=K({mutationFn:v=>A.updateProfile({userId:n,profile:{group_id:v.group_id?Number(v.group_id):null,group_label:v.group_id?$.find(q=>q.id===Number(v.group_id))?.name??null:null,birthdate:v.birthdate||null,bio:v.bio,ffn_iuf:(v.ffn_iuf||"").trim()||null,phone:v.phone||null}}),onSuccess:()=>{i.invalidateQueries({queryKey:["profile"]}),f(!1),a({title:"Profil mis à jour"})},onError:v=>{a({title:"Mise à jour impossible",description:String(v?.message||v),variant:"destructive"})}}),Pt=K({mutationFn:v=>A.authPasswordUpdate(v),onSuccess:()=>{z.reset(),a({title:"Mot de passe mis à jour"})},onError:v=>{a({title:"Mise à jour impossible",description:String(v?.message||v),variant:"destructive"})}}),Ze=K({mutationFn:async v=>{if(!n)throw new Error("Utilisateur non identifié");const q=new File([v],"avatar.png",{type:"image/png"}),{blob:H,mimeType:Ys,extension:Qs}=await yn(q);return A.uploadAvatar({userId:n,blob:H,mimeType:Ys,extension:Qs})},onSuccess:()=>{w(null),i.invalidateQueries({queryKey:["profile"]}),i.invalidateQueries({queryKey:["hall-of-fame"]}),a({title:"Photo de profil mise à jour"})},onError:v=>{a({title:"Impossible de charger la photo",description:String(v?.message||v),variant:"destructive"})}}),Vs=v=>{if(!gn(v)){a({title:"Format non supporté",description:"Utilisez JPEG, PNG ou WebP.",variant:"destructive"});return}if(v.size>10*1024*1024){a({title:"Fichier trop volumineux",description:"La taille maximale est de 10 Mo.",variant:"destructive"});return}const q=URL.createObjectURL(v);w(q)},Et=K({mutationFn:async()=>{if(!n)throw new Error("Utilisateur non identifié");return A.deleteAvatar(n)},onSuccess:()=>{i.invalidateQueries({queryKey:["profile"]}),i.invalidateQueries({queryKey:["hall-of-fame"]}),a({title:"Photo supprimée"})},onError:v=>{a({title:"Impossible de supprimer la photo",description:String(v?.message||v),variant:"destructive"})}}),Dt=K({mutationFn:v=>A.updateProfile({userId:n,profile:{neurotype_result:v}}),onSuccess:()=>{i.invalidateQueries({queryKey:["profile"]}),P(null),d("home"),a({title:"Neurotype enregistré"})},onError:v=>{a({title:"Erreur",description:String(v?.message||v),variant:"destructive"})}}),Hs=()=>{_.reset({group_id:D?.group_id?String(D.group_id):"",bio:D?.bio||"",birthdate:D?.birthdate?String(D.birthdate).split("T")[0]:"",ffn_iuf:D?.ffn_iuf?String(D.ffn_iuf):"",phone:D?.phone||""}),f(!0)},Zs=_.handleSubmit(v=>{He.mutate(v)}),Gs=z.handleSubmit(v=>{Pt.mutate({password:v.password})}),kt=$.find(v=>v.id===D?.group_id)?.name||D?.group_label||"Non défini";return R?e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"rounded-xl bg-accent p-5",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(te,{className:"h-20 w-20 rounded-full"}),e.jsxs("div",{className:"space-y-2 flex-1",children:[e.jsx(te,{className:"h-6 w-32"}),e.jsx(te,{className:"h-4 w-24"})]})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(te,{className:"h-24 rounded-xl"}),e.jsx(te,{className:"h-24 rounded-xl"}),e.jsx(te,{className:"h-24 rounded-xl"}),e.jsx(te,{className:"h-24 rounded-xl"})]})]}):Pe?e.jsxs("div",{className:"flex flex-col items-center justify-center p-8 text-center",children:[e.jsx(Kr,{className:"h-12 w-12 text-destructive mb-4"}),e.jsx("h3",{className:"font-semibold",children:"Impossible de charger les données"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:Pe.message}),e.jsx(B,{onClick:()=>X(),className:"mt-4",children:"Réessayer"})]}):m==="neurotype-quiz"?e.jsx(Pa,{onComplete:v=>{P(v),d("neurotype-result")},onCancel:()=>d("home")}):m==="neurotype-result"&&S?e.jsx(Ra,{result:S,onSave:v=>Dt.mutate(v),onRetry:()=>{P(null),d("neurotype-quiz")},onBack:()=>d("home"),isSaving:Dt.isPending}):m==="interviews"?e.jsx(Ks,{onBack:()=>d("home")}):m==="objectives"?e.jsx(Ws,{onBack:()=>d("home")}):m==="messages"?e.jsx(ya,{userId:n??0,onBack:()=>d("home"),onOpenProfileSection:v=>d(v)}):m==="performance-hub"?e.jsx(wa,{athleteId:n??0,athleteName:D?.display_name||s||"Nageur",groupLabel:kt,onBack:()=>d("home")}):e.jsxs(le.div,{className:"space-y-6",variants:Sr,initial:"hidden",animate:"visible",children:[e.jsx("div",{className:"rounded-xl bg-accent text-accent-foreground p-5",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(Mt,{className:"h-20 w-20 ring-2 ring-primary ring-offset-2 ring-offset-accent",children:[e.jsx(Bt,{src:De,alt:s||"Profil"}),e.jsx(qt,{className:"text-lg",children:(s||"?").slice(0,2).toUpperCase()})]}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h1",{className:"text-2xl font-display font-bold uppercase italic text-accent-foreground truncate",children:s}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 mt-1",children:[e.jsx(T,{variant:"secondary",className:"text-xs",children:u}),e.jsx("span",{className:"text-sm opacity-80",children:kt})]}),D?.bio&&e.jsx("p",{className:"text-xs opacity-70 mt-1.5 line-clamp-2",children:D.bio})]})]})}),e.jsxs("div",{className:"space-y-4",children:[J?e.jsxs(ye,{className:"overflow-hidden border-primary/15 bg-gradient-to-br from-primary/[0.1] via-card to-amber-500/[0.08] shadow-sm",children:[e.jsx(Oe,{className:"gap-3 pb-3",children:e.jsxs("div",{className:"flex flex-wrap items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx(ze,{className:"text-base uppercase tracking-[0.08em]",children:"À faire maintenant"}),e.jsx(Le,{className:"mt-1",children:"Les actions utiles aujourd'hui, sans passer par plusieurs menus."})]}),e.jsx(T,{variant:ve>0?"default":"outline",className:"text-[10px] uppercase tracking-[0.08em]",children:ve>0?`${ve} action${ve>1?"s":""}`:"rien d'urgent"})]})}),e.jsxs(je,{className:"space-y-3",children:[e.jsx(ee,{icon:Cs,title:"Messages",description:V>0?`${V} message${V>1?"s":""} à lire`:"Boîte de réception et historique des notifications",badgeLabel:V>0?`${V} non lu${V>1?"s":""}`:null,onClick:()=>d("messages")}),Y>0?e.jsx(ee,{icon:St,title:"Entretien",description:Y>1?`${Y} entretiens demandent une action`:"Un entretien attend ta réponse ou ta signature",badgeLabel:`${Y} en attente`,onClick:()=>d("interviews")}):null,ge&&ne!==null?e.jsx(ee,{icon:_t,title:"Prochaine échéance",description:`Objectif programmé le ${new Date(`${ge}T00:00:00`).toLocaleDateString("fr-FR",{day:"numeric",month:"long"})}`,badgeLabel:`J-${ne}`,onClick:()=>d("performance-hub")}):null,ve===0?e.jsxs("div",{className:"rounded-2xl border border-dashed border-primary/20 bg-background/70 px-4 py-3",children:[e.jsx("p",{className:"text-sm font-medium",children:"Aucune urgence pour le moment."}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Tu peux consulter ton suivi complet quand tu veux, mais rien ne demande une action immédiate."})]}):null]})]}):null,l?e.jsxs(ye,{className:"overflow-hidden border-primary/15 bg-gradient-to-br from-card via-card to-primary/5 shadow-sm",children:[e.jsx(Oe,{className:"gap-3 pb-3",children:e.jsxs("div",{className:"flex flex-wrap items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx(ze,{className:"text-base uppercase tracking-[0.08em]",children:"Mon suivi"}),e.jsx(Le,{className:"mt-1",children:"Un seul point d'entrée pour la progression, les entretiens et la planification."})]}),ke?e.jsx(T,{variant:"secondary",className:"text-[10px] uppercase tracking-[0.08em]",children:ke}):null]})}),e.jsxs(je,{className:"space-y-4",children:[e.jsxs("button",{type:"button",onClick:()=>d("performance-hub"),className:"flex w-full items-start gap-3 rounded-3xl border border-primary/20 bg-background/80 px-4 py-4 text-left transition hover:border-primary/35 hover:bg-primary/[0.04] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",children:[e.jsx("div",{className:"flex h-12 w-12 shrink-0 items-center justify-center rounded-2xl bg-primary/10",children:e.jsx(Ne,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-sm font-semibold uppercase tracking-[0.08em] text-primary",children:"Ouvrir mon suivi"}),e.jsx("p",{className:"mt-1 text-sm text-foreground/80",children:"Retrouve ton plan d'action, tes entretiens, tes ressentis et tes prochaines échéances au même endroit."}),ke?e.jsx("p",{className:"mt-2 text-xs text-muted-foreground",children:ke}):null]}),e.jsx(de,{className:"mt-1 h-4 w-4 shrink-0 text-muted-foreground"})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-3 sm:grid-cols-2",children:[e.jsx(ee,{icon:$e,title:"Records",description:"Consulter mes performances",onClick:()=>o("/records")}),e.jsx(ee,{icon:Yr,title:D?.neurotype_result?`${D.neurotype_result.dominant} — ${Ba(D.neurotype_result.dominant)}`:"Neurotype",description:D?.neurotype_result?"Relire mon profil neurotype":"Découvrir mon profil",onClick:()=>{D?.neurotype_result?(P(D.neurotype_result),d("neurotype-result")):d("neurotype-quiz")}})]})]})]}):null,e.jsxs(ye,{className:"overflow-hidden border-primary/15 bg-card shadow-sm",children:[e.jsxs(Oe,{className:"pb-3",children:[e.jsx(ze,{className:"text-base uppercase tracking-[0.08em]",children:"Mon compte"}),e.jsx(Le,{children:"Gère tes informations, la sécurité et cet appareil depuis un seul bloc."})]}),e.jsxs(je,{className:"space-y-3",children:[e.jsx(ee,{icon:Vr,title:"Mon profil",description:"Modifier mes informations personnelles",onClick:Hs}),c?e.jsx(ee,{icon:cn,title:"Sécurité",description:"Changer mon mot de passe",onClick:()=>h(!0)}):null,e.jsx(ee,{icon:cr,title:"Mettre l'app à jour",description:"Force la vérification d'une nouvelle version sur cet appareil",onClick:E,badgeLabel:y?"en cours":null}),Tt()?e.jsxs("div",{className:"rounded-2xl border border-border/70 bg-background/70 px-4 py-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex h-10 w-10 shrink-0 items-center justify-center rounded-2xl bg-primary/10",children:k?e.jsx(dr,{className:"h-5 w-5 text-primary"}):e.jsx(Zr,{className:"h-5 w-5 text-muted-foreground"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-sm font-semibold",children:"Notifications push"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:k?"Activées sur cet appareil":"Désactivées sur cet appareil"})]}),e.jsx(B,{size:"sm",variant:k?"outline":"default",onClick:C,disabled:M,children:M?"...":k?"Désactiver":"Activer"})]}),e.jsx("p",{className:"mt-2 text-[10px] text-muted-foreground/70",children:"Les notifications sont gérées appareil par appareil. Réactive-les ici après une réinstallation."})]}):null,e.jsxs("p",{className:"text-[10px] text-center text-muted-foreground/60 pt-1",children:["Version du ",new Date("2026-02-28T22:17:22.668Z").toLocaleDateString("fr-FR",{day:"numeric",month:"long",year:"numeric",hour:"2-digit",minute:"2-digit"})]})]})]})]}),e.jsxs(B,{variant:"destructive",onClick:t,className:"w-full gap-2",children:[e.jsx(on,{className:"h-4 w-4"}),"Se déconnecter"]}),e.jsx(lt,{open:b,onOpenChange:f,children:e.jsxs(ct,{side:"bottom",className:"max-h-[85vh] overflow-y-auto",children:[e.jsxs(dt,{children:[e.jsx(ut,{children:"Modifier le profil"}),e.jsx(mt,{children:"Mettez à jour vos informations personnelles."})]}),e.jsxs("form",{onSubmit:Zs,className:"space-y-4 mt-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(F,{children:"Groupe"}),e.jsxs(nt,{value:_.watch("group_id"),onValueChange:v=>_.setValue("group_id",v),disabled:G,children:[e.jsx(at,{children:e.jsx(it,{placeholder:G?"Chargement...":"Choisir un groupe"})}),e.jsx(ot,{children:$.map(v=>e.jsx(Ie,{value:String(v.id),children:v.name},v.id))})]})]}),l?e.jsxs("div",{className:"grid gap-2",children:[e.jsx(F,{children:"IUF FFN"}),e.jsx(ae,{..._.register("ffn_iuf"),placeholder:"879576",inputMode:"numeric"}),_.formState.errors.ffn_iuf&&e.jsx("p",{className:"text-xs text-destructive",role:"alert","aria-live":"assertive",children:_.formState.errors.ffn_iuf.message}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Identifiant unique FFN (utilisé pour importer vos records compétition)."})]}):null,e.jsxs("div",{className:"grid gap-2",children:[e.jsx(F,{children:"Bio"}),e.jsx(se,{..._.register("bio")}),_.formState.errors.bio&&e.jsx("p",{className:"text-xs text-destructive",role:"alert","aria-live":"assertive",children:_.formState.errors.bio.message})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(F,{children:"Photo de profil"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(Mt,{className:"h-16 w-16 ring-2 ring-primary/20",children:[e.jsx(Bt,{src:De,alt:"Avatar"}),e.jsx(qt,{children:(s||"?").slice(0,2).toUpperCase()})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs(B,{type:"button",variant:"outline",size:"sm",className:"gap-2",disabled:Ze.isPending,onClick:()=>document.getElementById("avatar-upload")?.click(),children:[e.jsx(Xr,{className:"h-4 w-4"}),Ze.isPending?"Envoi...":"Changer la photo"]}),D?.avatar_url&&e.jsxs(B,{type:"button",variant:"ghost",size:"sm",className:"gap-2 text-destructive hover:text-destructive",disabled:Et.isPending,onClick:()=>Et.mutate(),children:[e.jsx(Ct,{className:"h-3.5 w-3.5"}),"Supprimer"]})]})]}),e.jsx("input",{id:"avatar-upload",type:"file",accept:"image/jpeg,image/png,image/webp,.heic,.heif",className:"hidden",onChange:v=>{const q=v.target.files?.[0];q&&Vs(q),v.target.value=""}})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(F,{children:"Date de naissance"}),e.jsx(ae,{type:"date",..._.register("birthdate")}),_.formState.errors.birthdate&&e.jsx("p",{className:"text-xs text-destructive",role:"alert","aria-live":"assertive",children:_.formState.errors.birthdate.message})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(F,{htmlFor:"edit-phone",children:"Telephone"}),e.jsx(ae,{id:"edit-phone",type:"tel",placeholder:"06 12 34 56 78",..._.register("phone")})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(B,{type:"submit",disabled:He.isPending,className:"w-full",children:[e.jsx(As,{className:"mr-2 h-4 w-4"}),"Enregistrer"]}),e.jsx(B,{type:"button",variant:"outline",onClick:()=>f(!1),disabled:He.isPending,children:"Annuler"})]})]})]})}),e.jsx(lt,{open:x,onOpenChange:h,children:e.jsxs(ct,{side:"bottom",className:"max-h-[85vh] overflow-y-auto",children:[e.jsxs(dt,{children:[e.jsx(ut,{children:"Changer le mot de passe"}),e.jsx(mt,{children:"Votre mot de passe doit contenir au moins 8 caractères, une majuscule et un chiffre."})]}),e.jsxs("form",{onSubmit:Gs,className:"space-y-3 mt-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(F,{children:"Nouveau mot de passe"}),e.jsx(ae,{type:"password",...z.register("password"),placeholder:"••••••••"}),z.formState.errors.password&&e.jsx("p",{className:"text-xs text-destructive",role:"alert","aria-live":"assertive",children:z.formState.errors.password.message})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(F,{children:"Confirmer"}),e.jsx(ae,{type:"password",...z.register("confirmPassword"),placeholder:"••••••••"}),z.formState.errors.confirmPassword&&e.jsx("p",{className:"text-xs text-destructive",role:"alert","aria-live":"assertive",children:z.formState.errors.confirmPassword.message})]}),e.jsx(B,{type:"submit",className:"w-full",disabled:Pt.isPending,children:"Mettre à jour le mot de passe"})]})]})}),g&&e.jsx(ua,{open:!!g,imageSrc:g,onClose:()=>{URL.revokeObjectURL(g),w(null)},onCropDone:v=>{URL.revokeObjectURL(g),Ze.mutate(v)}})]})}export{_i as default,Ma as getRoleLabel,Ta as shouldShowRecords};
