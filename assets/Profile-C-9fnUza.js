import{r as l,j as e,c as Te,u as K,d as I}from"./vendor-query-BiSH4r2z.js";import{c as ve,A as We,E as Ye,G as Ze,p as ae,a as je,d as ke,u as Ie,B as S,L as N,I as U,s as Je,b as Xe,S as T,T as et,o as tt}from"./index-D0WgjKP9.js";import{a as _}from"./api-K6Gp0vsu.js";import{A as st,a as Me,b as we,F as rt,e as Fe,T as Re,f as ne,p as ye,s as at,d as nt,S as it}from"./objectiveHelpers-CYCtv0u6.js";import{S as ie,a as oe,b as ce,c as le,d as Z}from"./select-C-lv63Ob.js";import{B as J}from"./badge-CdMHf_Py.js";import{S as de,a as ue,b as me,c as pe,d as he,A as ot,e as ct,f as lt,g as dt,h as ut,i as mt,j as pt,k as ht}from"./alert-dialog-Dis1qM0z.js";import{u as Se,t as _e,o as Oe,s as k}from"./types-Ca14D1uM.js";import{f as xt}from"./animations-CrcLFysI.js";import{T as ft,a as re}from"./toggle-group-DV_iV0YX.js";import{P as Ce}from"./plus-vxBkA6bh.js";import{T as Ue}from"./trash-2-Bb4ap7Gj.js";import{C as gt}from"./circle-alert-BAvvEzX4.js";import{m as vt}from"./proxy-Dh0N-Z8G.js";import{P as jt}from"./pen-Ciykxf9J.js";import{S as bt}from"./save-C-JxMqls.js";import"./vendor-react-BzrpNAyj.js";import"./vendor-supabase-6k692oZB.js";import"./swim-DMuzwGFl.js";import"./index-CuZQS-bZ.js";import"./chevron-down-BvOqjJbk.js";import"./check-77qh0D2J.js";import"./chevron-up-CTVIrLbG.js";import"./index-CVg6i5VD.js";import"./design-tokens-CKgCpdH6.js";import"./index-DgT9ZqV4.js";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Nt=[["path",{d:"M13.997 4a2 2 0 0 1 1.76 1.05l.486.9A2 2 0 0 0 18.003 7H20a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2h1.997a2 2 0 0 0 1.759-1.048l.489-.904A2 2 0 0 1 10.004 4z",key:"18u6gg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]],wt=ve("camera",Nt);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yt=[["path",{d:"m16 17 5-5-5-5",key:"1bji2h"}],["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}]],St=ve("log-out",yt);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _t=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]],Ct=ve("lock",_t);function At(t,s=[]){let a=[];function o(n,u){const d=l.createContext(u);d.displayName=n+"Context";const m=a.length;a=[...a,u];const f=p=>{const{scope:v,children:j,...b}=p,E=v?.[t]?.[m]||d,A=l.useMemo(()=>b,Object.values(b));return e.jsx(E.Provider,{value:A,children:j})};f.displayName=n+"Provider";function g(p,v){const j=v?.[t]?.[m]||d,b=l.useContext(j);if(b)return b;if(u!==void 0)return u;throw new Error(`\`${p}\` must be used within \`${n}\``)}return[f,g]}const c=()=>{const n=a.map(u=>l.createContext(u));return function(d){const m=d?.[t]||n;return l.useMemo(()=>({[`__scope${t}`]:{...d,[t]:m}}),[d,m])}};return c.scopeName=t,[o,Et(c,...s)]}function Et(...t){const s=t[0];if(t.length===1)return s;const a=()=>{const o=t.map(c=>({useScope:c(),scopeName:c.scopeName}));return function(n){const u=o.reduce((d,{useScope:m,scopeName:f})=>{const p=m(n)[`__scope${f}`];return{...d,...p}},{});return l.useMemo(()=>({[`__scope${s.scopeName}`]:u}),[u])}};return a.scopeName=s.scopeName,a}var Pt=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],be=Pt.reduce((t,s)=>{const a=We(`Primitive.${s}`),o=l.forwardRef((c,n)=>{const{asChild:u,...d}=c,m=u?a:s;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),e.jsx(m,{...d,ref:n})});return o.displayName=`Primitive.${s}`,{...t,[s]:o}},{});function Lt(){return Ye.useSyncExternalStore(Tt,()=>!0,()=>!1)}function Tt(){return()=>{}}var Ne="Avatar",[kt]=At(Ne),[It,De]=kt(Ne),qe=l.forwardRef((t,s)=>{const{__scopeAvatar:a,...o}=t,[c,n]=l.useState("idle");return e.jsx(It,{scope:a,imageLoadingStatus:c,onImageLoadingStatusChange:n,children:e.jsx(be.span,{...o,ref:s})})});qe.displayName=Ne;var $e="AvatarImage",Ve=l.forwardRef((t,s)=>{const{__scopeAvatar:a,src:o,onLoadingStatusChange:c=()=>{},...n}=t,u=De($e,a),d=Mt(o,n),m=Ze(f=>{c(f),u.onImageLoadingStatusChange(f)});return ae(()=>{d!=="idle"&&m(d)},[d,m]),d==="loaded"?e.jsx(be.img,{...n,ref:s,src:o}):null});Ve.displayName=$e;var ze="AvatarFallback",Be=l.forwardRef((t,s)=>{const{__scopeAvatar:a,delayMs:o,...c}=t,n=De(ze,a),[u,d]=l.useState(o===void 0);return l.useEffect(()=>{if(o!==void 0){const m=window.setTimeout(()=>d(!0),o);return()=>window.clearTimeout(m)}},[o]),u&&n.imageLoadingStatus!=="loaded"?e.jsx(be.span,{...c,ref:s}):null});Be.displayName=ze;function Ae(t,s){return t?s?(t.src!==s&&(t.src=s),t.complete&&t.naturalWidth>0?"loaded":"loading"):"error":"idle"}function Mt(t,{referrerPolicy:s,crossOrigin:a}){const o=Lt(),c=l.useRef(null),n=o?(c.current||(c.current=new window.Image),c.current):null,[u,d]=l.useState(()=>Ae(n,t));return ae(()=>{d(Ae(n,t))},[n,t]),ae(()=>{const m=p=>()=>{d(p)};if(!n)return;const f=m("loaded"),g=m("error");return n.addEventListener("load",f),n.addEventListener("error",g),s&&(n.referrerPolicy=s),typeof a=="string"&&(n.crossOrigin=a),()=>{n.removeEventListener("load",f),n.removeEventListener("error",g)}},[n,a,s]),u}var Ke=qe,Ge=Ve,He=Be;const xe=l.forwardRef(({className:t,...s},a)=>e.jsx(Ke,{ref:a,className:je("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",t),...s}));xe.displayName=Ke.displayName;const fe=l.forwardRef(({className:t,...s},a)=>e.jsx(Ge,{ref:a,className:je("aspect-square h-full w-full",t),...s}));fe.displayName=Ge.displayName;const ge=l.forwardRef(({className:t,...s},a)=>e.jsx(He,{ref:a,className:je("flex h-full w-full items-center justify-center rounded-full bg-muted",t),...s}));ge.displayName=He.displayName;const W=400,Ft=200*1024,Rt=.85,Ot=.4,Ut=.1,Dt=["image/jpeg","image/png","image/webp","image/heic","image/heif"];function qt(t){return Dt.includes(t.type)||/\.(jpe?g|png|webp|heic|heif)$/i.test(t.name)}function $t(t){return new Promise((s,a)=>{const o=new Image;o.onload=()=>s(o),o.onerror=()=>a(new Error("Impossible de charger l'image")),o.src=URL.createObjectURL(t)})}function Vt(t){let{width:s,height:a}=t;if(s>W||a>W){const n=Math.min(W/s,W/a);s=Math.round(s*n),a=Math.round(a*n)}const o=document.createElement("canvas");return o.width=s,o.height=a,o.getContext("2d").drawImage(t,0,0,s,a),o}function Ee(t,s,a){return new Promise((o,c)=>{t.toBlob(n=>n?o(n):c(new Error("Compression échouée")),s,a)})}let Y=null;function Pe(){if(Y===null)try{const t=document.createElement("canvas");t.width=1,t.height=1,Y=t.toDataURL("image/webp").startsWith("data:image/webp")}catch{Y=!1}return Y}async function zt(t){const s=await $t(t),a=Vt(s);URL.revokeObjectURL(s.src);const o=Pe()?"image/webp":"image/jpeg",c=Pe()?"webp":"jpg";let n=Rt,u=await Ee(a,o,n);for(;u.size>Ft&&n>Ot;)n-=Ut,u=await Ee(a,o,n);return{blob:u,mimeType:o,extension:c}}function Bt({onBack:t}){const{toast:s}=ke(),a=Te(),[o,c]=l.useState(!1),[n,u]=l.useState(null),[d,m]=l.useState(null),{data:f}=K({queryKey:["auth-user"],queryFn:async()=>{const{data:r}=await Je.auth.getUser();return r.user}}),g=f?.id??null,{data:p=[],isLoading:v}=K({queryKey:["athlete-objectives"],queryFn:()=>_.getAthleteObjectives(),enabled:!!g}),{userId:j}=Ie(),{data:b}=K({queryKey:["swim-records",j],queryFn:()=>_.getSwimRecords({athleteId:j}),enabled:!!j}),E=b?.records??[],A=l.useMemo(()=>p.filter(r=>r.created_by!==g),[p,g]),G=l.useMemo(()=>p.filter(r=>r.created_by===g),[p,g]),[P,x]=l.useState("chrono"),[w,h]=l.useState(""),[H,D]=l.useState("25"),[L,M]=l.useState(""),[F,q]=l.useState(""),X=()=>{x("chrono"),h(""),D("25"),M(""),q("")},$=()=>{u(null),X(),c(!0)},ee=r=>{u(r);const i=!!r.event_code,y=!!r.text;x(i&&y?"both":y?"texte":"chrono"),h(r.event_code??""),D(String(r.pool_length??25)),M(r.target_time_seconds!=null?ne(r.target_time_seconds):""),q(r.text??""),c(!0)},R=()=>a.invalidateQueries({queryKey:["athlete-objectives"]}),O=I({mutationFn:r=>_.createObjective(r),onSuccess:()=>{s({title:"Objectif créé"}),R(),c(!1)},onError:r=>s({title:"Erreur",description:r.message,variant:"destructive"})}),V=I({mutationFn:r=>_.updateObjective(n.id,r),onSuccess:()=>{s({title:"Objectif mis à jour"}),R(),c(!1)},onError:r=>s({title:"Erreur",description:r.message,variant:"destructive"})}),z=I({mutationFn:r=>_.deleteObjective(r),onSuccess:()=>{s({title:"Objectif supprimé"}),R(),m(null)},onError:r=>s({title:"Erreur",description:r.message,variant:"destructive"})}),C=P==="chrono"||P==="both",B=P==="texte"||P==="both",Q=O.isPending||V.isPending,te=()=>{if(C&&!w){s({title:"Épreuve requise",variant:"destructive"});return}if(C&&L&&ye(L)===null){s({title:"Format invalide",description:"Format : m:ss:cc (ex: 1:05:30)",variant:"destructive"});return}if(B&&!F.trim()){s({title:"Texte requis",variant:"destructive"});return}if(!g)return;const r={athlete_id:g,event_code:C?w:null,pool_length:C?Number(H):null,target_time_seconds:C&&L?ye(L):null,text:B?F.trim():null};n?V.mutate(r):O.mutate(r)};return e.jsxs("div",{className:"space-y-6 pb-24",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs(S,{variant:"ghost",size:"sm",className:"-ml-2",onClick:t,children:[e.jsx(st,{className:"mr-1.5 h-4 w-4"}),"Retour"]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-display font-semibold uppercase italic text-primary",children:"Mon plan"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Mes objectifs d'entraînement"})]}),e.jsxs(S,{variant:"outline",size:"sm",onClick:$,children:[e.jsx(Ce,{className:"mr-1.5 h-3.5 w-3.5"}),"Ajouter"]})]})]}),v&&e.jsx("div",{className:"space-y-2",children:[1,2,3].map(r=>e.jsx("div",{className:"rounded-xl border p-3 animate-pulse motion-reduce:animate-none",children:e.jsx("div",{className:"h-4 w-40 rounded bg-muted"})},r))}),!v&&p.length===0&&e.jsxs("div",{className:"text-center py-12 space-y-3",children:[e.jsx(Me,{className:"h-10 w-10 text-muted-foreground mx-auto"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Aucun objectif pour le moment."}),e.jsxs(S,{variant:"outline",size:"sm",onClick:$,children:[e.jsx(Ce,{className:"mr-1.5 h-3.5 w-3.5"}),"Ajouter un objectif"]})]}),A.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-xs font-semibold uppercase tracking-[0.15em] text-muted-foreground",children:"Objectifs du coach"}),A.map(r=>e.jsx(Le,{objective:r,isPersonal:!1,bestTime:r.event_code?we(E,r.event_code,r.pool_length):null},r.id))]}),G.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-xs font-semibold uppercase tracking-[0.15em] text-muted-foreground",children:"Mes objectifs personnels"}),G.map(r=>e.jsx(Le,{objective:r,isPersonal:!0,bestTime:r.event_code?we(E,r.event_code,r.pool_length):null,onEdit:ee,onDelete:m},r.id))]}),e.jsx(de,{open:o,onOpenChange:c,children:e.jsxs(ue,{side:"bottom",className:"max-h-[85vh] overflow-y-auto",children:[e.jsxs(me,{children:[e.jsx(pe,{children:n?"Modifier l'objectif":"Nouvel objectif"}),e.jsx(he,{children:n?"Modifiez votre objectif personnel.":"Ajoutez un objectif personnel."})]}),e.jsxs("div",{className:"mt-4 space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{children:"Type d'objectif"}),e.jsxs(ft,{type:"single",variant:"outline",value:P,onValueChange:r=>{r&&x(r)},className:"justify-start",children:[e.jsx(re,{value:"chrono",className:"text-xs",children:"Chrono"}),e.jsx(re,{value:"texte",className:"text-xs",children:"Texte"}),e.jsx(re,{value:"both",className:"text-xs",children:"Les deux"})]})]}),C&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{children:"Épreuve *"}),e.jsxs(ie,{value:w,onValueChange:h,children:[e.jsx(oe,{children:e.jsx(ce,{placeholder:"Choisir une épreuve"})}),e.jsx(le,{children:rt.map(r=>e.jsx(Z,{value:r,children:Fe(r)},r))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{children:"Bassin"}),e.jsxs(ie,{value:H,onValueChange:D,children:[e.jsx(oe,{children:e.jsx(ce,{})}),e.jsxs(le,{children:[e.jsx(Z,{value:"25",children:"25m"}),e.jsx(Z,{value:"50",children:"50m"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{children:"Temps cible (min:sec:centièmes)"}),e.jsx(U,{placeholder:"Ex : 1:05:30",value:L,onChange:r=>M(r.target.value)})]})]}),B&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{children:"Objectif texte *"}),e.jsx(Re,{placeholder:"Ex : Améliorer la coulée de dos",value:F,onChange:r=>q(r.target.value),rows:3})]}),e.jsx(S,{className:"w-full",onClick:te,disabled:Q,children:Q?"Enregistrement...":n?"Enregistrer":"Créer"})]})]})}),e.jsx(ot,{open:!!d,onOpenChange:r=>{r||m(null)},children:e.jsxs(ct,{children:[e.jsxs(lt,{children:[e.jsx(dt,{children:"Supprimer l'objectif"}),e.jsx(ut,{children:"Cette action est irréversible. L'objectif sera supprimé définitivement."})]}),e.jsxs(mt,{children:[e.jsx(pt,{children:"Annuler"}),e.jsx(ht,{onClick:()=>{d&&z.mutate(d.id)},className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Supprimer"})]})]})})]})}function Le({objective:t,isPersonal:s,bestTime:a,onEdit:o,onDelete:c}){const n=!!t.event_code,u=!!t.text,d=n?at(t.event_code):null,m=d?it[d]??"":"",f=t.target_time_seconds!=null,g=!!t.competition_name,p=t.competition_date?nt(t.competition_date):null;let v=null;if(f&&a!=null&&t.target_time_seconds!=null){const j=t.target_time_seconds;if(a<=j)v=100;else{const b=j*1.2;a>=b?v=5:v=Math.round((b-a)/(b-j)*100)}}return e.jsxs("div",{className:["rounded-xl border bg-card p-4 space-y-3",n?`border-l-4 ${m}`:""].join(" "),children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[!s&&e.jsx(J,{variant:"secondary",className:"text-[10px] px-1.5 py-0",children:"Coach"}),n&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-sm font-semibold",children:Fe(t.event_code)}),t.pool_length&&e.jsxs(J,{variant:"secondary",className:"text-[10px] px-1.5 py-0",children:[t.pool_length,"m"]})]}),s&&o&&c&&e.jsxs("div",{className:"ml-auto flex gap-1",children:[e.jsx("button",{type:"button",onClick:()=>o(t),className:"text-xs text-primary hover:underline",children:"Modifier"}),e.jsx("button",{type:"button",onClick:()=>c(t),className:"text-muted-foreground hover:text-destructive p-0.5",children:e.jsx(Ue,{className:"h-3.5 w-3.5"})})]})]}),n&&f&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-end justify-between",children:[a!=null?e.jsxs("div",{className:"text-xs text-muted-foreground",children:[e.jsx("span",{className:"font-mono",children:ne(a)}),e.jsx("span",{className:"ml-1",children:"actuel"})]}):e.jsx("div",{}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-2xl font-mono font-bold tracking-tight text-primary",children:ne(t.target_time_seconds)}),e.jsx("div",{className:"text-[10px] text-muted-foreground uppercase tracking-wider",children:"objectif"})]})]}),v!=null&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"h-2 w-full rounded-full bg-muted overflow-hidden",children:e.jsx("div",{className:["h-full rounded-full transition-all duration-500",v>=100?"bg-emerald-500":"bg-primary"].join(" "),style:{width:`${Math.min(v,100)}%`}})}),e.jsx("div",{className:"text-[10px] text-muted-foreground text-right",children:v>=100?"Objectif atteint !":`${v}%`})]}),a==null&&e.jsx("p",{className:"text-[10px] text-muted-foreground italic",children:"Pas encore de temps enregistré pour cette épreuve"})]}),u&&e.jsx("p",{className:"text-sm text-muted-foreground",children:t.text}),g&&e.jsxs(J,{variant:"outline",className:"border-orange-300 text-orange-600 dark:text-orange-400 text-[10px] px-1.5 py-0",children:[t.competition_name,p!=null&&p>0&&e.jsxs("span",{className:"ml-1 font-bold",children:["J-",p]})]})]})}const Kt=t=>t!=="coach"&&t!=="admin"&&t!=="comite",Gt=t=>{switch(t){case"coach":return"Entraineur EAC";case"admin":return"Admin";case"comite":return"Comité";default:return"Nageur"}},Ht=Oe({group_id:k().optional(),bio:k().optional(),birthdate:k().optional().refine(t=>{if(!t)return!0;const s=new Date(t);if(isNaN(s.getTime()))return!1;const a=(new Date().getTime()-s.getTime())/(1e3*60*60*24*365.25);return a>=6&&a<=100},{message:"L'âge doit être entre 6 et 100 ans"}),ffn_iuf:k().optional().refine(t=>t?/^\d+$/.test(t):!0,{message:"L'IUF FFN doit être un nombre"}),phone:k().optional()}),Qt=Oe({password:k().min(8,"Le mot de passe doit contenir au moins 8 caractères").regex(/[A-Z]/,"Le mot de passe doit contenir au moins une majuscule").regex(/\d/,"Le mot de passe doit contenir au moins un chiffre"),confirmPassword:k()}).refine(t=>t.password===t.confirmPassword,{message:"Les mots de passe ne correspondent pas",path:["confirmPassword"]});function Ns(){const{user:t,userId:s,logout:a,role:o}=Ie(),{toast:c}=ke(),n=Te(),[,u]=Xe(),d=Kt(o),m=o==="athlete"||o==="coach"||o==="admin",f=Gt(o),[g,p]=l.useState("home"),[v,j]=l.useState(!1),[b,E]=l.useState(!1),[A,G]=l.useState(!1),P=async()=>{G(!0),localStorage.removeItem("app_build_timestamp");try{const i=window.__pwaRegistration??await navigator.serviceWorker?.getRegistration();if(i&&(await i.update(),await new Promise(y=>setTimeout(y,1500))),"caches"in window){const y=await caches.keys();await Promise.all(y.map(se=>caches.delete(se)))}window.location.reload()}catch{window.location.reload()}},x=Se({resolver:_e(Ht),defaultValues:{group_id:"",bio:"",birthdate:"",ffn_iuf:"",phone:""}}),w=Se({resolver:_e(Qt),defaultValues:{password:"",confirmPassword:""}}),{data:h,isLoading:H,error:D,refetch:L}=K({queryKey:["profile",t,s],queryFn:()=>_.getProfile({displayName:t,userId:s}),enabled:!!t}),{data:M=[],isLoading:F,error:q,refetch:X}=K({queryKey:["profile-groups"],queryFn:()=>_.getGroups(),enabled:!!t}),$=D||q,ee=()=>{L(),X()},R=l.useMemo(()=>{const i=h?.avatar_url;return i||(t?`https://api.dicebear.com/7.x/initials/svg?seed=${encodeURIComponent(t)}`:"")},[h,t]),O=I({mutationFn:i=>_.updateProfile({userId:s,profile:{group_id:i.group_id?Number(i.group_id):null,birthdate:i.birthdate||null,bio:i.bio,ffn_iuf:(i.ffn_iuf||"").trim()||null,phone:i.phone||null}}),onSuccess:()=>{n.invalidateQueries({queryKey:["profile"]}),j(!1),c({title:"Profil mis à jour"})},onError:i=>{c({title:"Mise à jour impossible",description:String(i?.message||i),variant:"destructive"})}}),V=I({mutationFn:i=>_.authPasswordUpdate(i),onSuccess:()=>{w.reset(),c({title:"Mot de passe mis à jour"})},onError:i=>{c({title:"Mise à jour impossible",description:String(i?.message||i),variant:"destructive"})}}),z=I({mutationFn:async i=>{if(!s)throw new Error("Utilisateur non identifié");if(!qt(i))throw new Error("Format non supporté. Utilisez JPEG, PNG ou WebP.");if(i.size>10*1024*1024)throw new Error("Fichier trop volumineux (max 10 Mo).");const{blob:y,mimeType:se,extension:Qe}=await zt(i);return _.uploadAvatar({userId:s,blob:y,mimeType:se,extension:Qe})},onSuccess:()=>{n.invalidateQueries({queryKey:["profile"]}),c({title:"Photo de profil mise à jour"})},onError:i=>{c({title:"Impossible de charger la photo",description:String(i?.message||i),variant:"destructive"})}}),C=I({mutationFn:async()=>{if(!s)throw new Error("Utilisateur non identifié");return _.deleteAvatar(s)},onSuccess:()=>{n.invalidateQueries({queryKey:["profile"]}),c({title:"Photo supprimée"})},onError:i=>{c({title:"Impossible de supprimer la photo",description:String(i?.message||i),variant:"destructive"})}}),B=()=>{x.reset({group_id:h?.group_id?String(h.group_id):"",bio:h?.bio||"",birthdate:h?.birthdate?String(h.birthdate).split("T")[0]:"",ffn_iuf:h?.ffn_iuf?String(h.ffn_iuf):"",phone:h?.phone||""}),j(!0)},Q=x.handleSubmit(i=>{O.mutate(i)}),te=w.handleSubmit(i=>{V.mutate({password:i.password})}),r=M.find(i=>i.id===h?.group_id)?.name||h?.group_label||"Non défini";return H?e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"rounded-xl bg-accent p-5",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(T,{className:"h-20 w-20 rounded-full"}),e.jsxs("div",{className:"space-y-2 flex-1",children:[e.jsx(T,{className:"h-6 w-32"}),e.jsx(T,{className:"h-4 w-24"})]})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(T,{className:"h-24 rounded-xl"}),e.jsx(T,{className:"h-24 rounded-xl"}),e.jsx(T,{className:"h-24 rounded-xl"}),e.jsx(T,{className:"h-24 rounded-xl"})]})]}):$?e.jsxs("div",{className:"flex flex-col items-center justify-center p-8 text-center",children:[e.jsx(gt,{className:"h-12 w-12 text-destructive mb-4"}),e.jsx("h3",{className:"font-semibold",children:"Impossible de charger les données"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:$.message}),e.jsx(S,{onClick:()=>ee(),className:"mt-4",children:"Réessayer"})]}):g==="objectives"?e.jsx(Bt,{onBack:()=>p("home")}):e.jsxs(vt.div,{className:"space-y-6",variants:xt,initial:"hidden",animate:"visible",children:[e.jsx("div",{className:"rounded-xl bg-accent text-accent-foreground p-5",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(xe,{className:"h-20 w-20 ring-2 ring-primary ring-offset-2 ring-offset-accent",children:[e.jsx(fe,{src:R,alt:t||"Profil"}),e.jsx(ge,{className:"text-lg",children:(t||"?").slice(0,2).toUpperCase()})]}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h1",{className:"text-2xl font-display font-bold uppercase italic text-accent-foreground truncate",children:t}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 mt-1",children:[e.jsx(J,{variant:"secondary",className:"text-xs",children:f}),e.jsx("span",{className:"text-sm opacity-80",children:r})]}),h?.bio&&e.jsx("p",{className:"text-xs opacity-70 mt-1.5 line-clamp-2",children:h.bio})]})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("button",{type:"button",onClick:B,className:"rounded-xl border bg-card p-4 text-left shadow-sm active:bg-muted/50 transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",children:[e.jsx(jt,{className:"h-5 w-5 text-primary mb-2"}),e.jsx("p",{className:"text-sm font-bold",children:"Mon profil"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Modifier mes infos"})]}),m&&e.jsxs("button",{type:"button",onClick:()=>E(!0),className:"rounded-xl border bg-card p-4 text-left shadow-sm active:bg-muted/50 transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",children:[e.jsx(Ct,{className:"h-5 w-5 text-primary mb-2"}),e.jsx("p",{className:"text-sm font-bold",children:"Sécurité"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Mot de passe"})]}),d&&e.jsxs("button",{type:"button",onClick:()=>u("/records"),className:"rounded-xl border bg-card p-4 text-left shadow-sm active:bg-muted/50 transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",children:[e.jsx(et,{className:"h-5 w-5 text-primary mb-2"}),e.jsx("p",{className:"text-sm font-bold",children:"Records"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Mes perfs personnelles"})]}),e.jsxs("button",{type:"button",onClick:()=>p("objectives"),className:"rounded-xl border bg-card p-4 text-left shadow-sm active:bg-muted/50 transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",children:[e.jsx(Me,{className:"h-5 w-5 text-primary mb-2"}),e.jsx("p",{className:"text-sm font-bold",children:"Objectifs"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Mon plan"})]})]}),e.jsxs(S,{variant:"destructive",onClick:a,className:"w-full gap-2",children:[e.jsx(St,{className:"h-4 w-4"}),"Se déconnecter"]}),e.jsxs("div",{className:"space-y-1 pt-2",children:[e.jsxs("button",{type:"button",onClick:P,disabled:A,className:"w-full flex items-center justify-center gap-2 text-xs text-muted-foreground hover:text-foreground transition-colors py-2",children:[e.jsx(tt,{className:["h-3 w-3",A?"animate-bounce":""].join(" ")}),A?"Recherche en cours...":"Rechercher des mises à jour"]}),e.jsxs("p",{className:"text-[10px] text-center text-muted-foreground/60",children:["Version du ",new Date("2026-02-24T12:52:09.392Z").toLocaleDateString("fr-FR",{day:"numeric",month:"long",year:"numeric",hour:"2-digit",minute:"2-digit"})]})]}),e.jsx(de,{open:v,onOpenChange:j,children:e.jsxs(ue,{side:"bottom",className:"max-h-[85vh] overflow-y-auto",children:[e.jsxs(me,{children:[e.jsx(pe,{children:"Modifier le profil"}),e.jsx(he,{children:"Mettez à jour vos informations personnelles."})]}),e.jsxs("form",{onSubmit:Q,className:"space-y-4 mt-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(N,{children:"Groupe"}),e.jsxs(ie,{value:x.watch("group_id"),onValueChange:i=>x.setValue("group_id",i),disabled:F,children:[e.jsx(oe,{children:e.jsx(ce,{placeholder:F?"Chargement...":"Choisir un groupe"})}),e.jsx(le,{children:M.map(i=>e.jsx(Z,{value:String(i.id),children:i.name},i.id))})]})]}),d?e.jsxs("div",{className:"grid gap-2",children:[e.jsx(N,{children:"IUF FFN"}),e.jsx(U,{...x.register("ffn_iuf"),placeholder:"879576",inputMode:"numeric"}),x.formState.errors.ffn_iuf&&e.jsx("p",{className:"text-xs text-destructive",role:"alert","aria-live":"assertive",children:x.formState.errors.ffn_iuf.message}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Identifiant unique FFN (utilisé pour importer vos records compétition)."})]}):null,e.jsxs("div",{className:"grid gap-2",children:[e.jsx(N,{children:"Bio"}),e.jsx(Re,{...x.register("bio")}),x.formState.errors.bio&&e.jsx("p",{className:"text-xs text-destructive",role:"alert","aria-live":"assertive",children:x.formState.errors.bio.message})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(N,{children:"Photo de profil"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(xe,{className:"h-16 w-16 ring-2 ring-primary/20",children:[e.jsx(fe,{src:R,alt:"Avatar"}),e.jsx(ge,{children:(t||"?").slice(0,2).toUpperCase()})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs(S,{type:"button",variant:"outline",size:"sm",className:"gap-2",disabled:z.isPending,onClick:()=>document.getElementById("avatar-upload")?.click(),children:[e.jsx(wt,{className:"h-4 w-4"}),z.isPending?"Envoi...":"Changer la photo"]}),h?.avatar_url&&e.jsxs(S,{type:"button",variant:"ghost",size:"sm",className:"gap-2 text-destructive hover:text-destructive",disabled:C.isPending,onClick:()=>C.mutate(),children:[e.jsx(Ue,{className:"h-3.5 w-3.5"}),"Supprimer"]})]})]}),e.jsx("input",{id:"avatar-upload",type:"file",accept:"image/jpeg,image/png,image/webp,.heic,.heif",className:"hidden",onChange:i=>{const y=i.target.files?.[0];y&&z.mutate(y),i.target.value=""}})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(N,{children:"Date de naissance"}),e.jsx(U,{type:"date",...x.register("birthdate")}),x.formState.errors.birthdate&&e.jsx("p",{className:"text-xs text-destructive",role:"alert","aria-live":"assertive",children:x.formState.errors.birthdate.message})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(N,{htmlFor:"edit-phone",children:"Telephone"}),e.jsx(U,{id:"edit-phone",type:"tel",placeholder:"06 12 34 56 78",...x.register("phone")})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(S,{type:"submit",disabled:O.isPending,className:"w-full",children:[e.jsx(bt,{className:"mr-2 h-4 w-4"}),"Enregistrer"]}),e.jsx(S,{type:"button",variant:"outline",onClick:()=>j(!1),disabled:O.isPending,children:"Annuler"})]})]})]})}),e.jsx(de,{open:b,onOpenChange:E,children:e.jsxs(ue,{side:"bottom",className:"max-h-[85vh] overflow-y-auto",children:[e.jsxs(me,{children:[e.jsx(pe,{children:"Changer le mot de passe"}),e.jsx(he,{children:"Votre mot de passe doit contenir au moins 8 caractères, une majuscule et un chiffre."})]}),e.jsxs("form",{onSubmit:te,className:"space-y-3 mt-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(N,{children:"Nouveau mot de passe"}),e.jsx(U,{type:"password",...w.register("password"),placeholder:"••••••••"}),w.formState.errors.password&&e.jsx("p",{className:"text-xs text-destructive",role:"alert","aria-live":"assertive",children:w.formState.errors.password.message})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(N,{children:"Confirmer"}),e.jsx(U,{type:"password",...w.register("confirmPassword"),placeholder:"••••••••"}),w.formState.errors.confirmPassword&&e.jsx("p",{className:"text-xs text-destructive",role:"alert","aria-live":"assertive",children:w.formState.errors.confirmPassword.message})]}),e.jsx(S,{type:"submit",className:"w-full",disabled:V.isPending,children:"Mettre à jour le mot de passe"})]})]})})]})}export{Ns as default,Gt as getRoleLabel,Kt as shouldShowRecords};
