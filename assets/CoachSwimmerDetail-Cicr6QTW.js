import{r as o,u as T,j as e,c as me,d as z}from"./vendor-query-BiSH4r2z.js";import{c as mt,B as k,d as ue,L as R,I as ye,s as Ve,X as ut,O as Be,T as ve,Z as xt,b as ht,u as pt}from"./index-DJXKQe3g.js";import{a as p}from"./api-bJGR0jeX.js";import{T as gt,a as jt,b as xe,c as he}from"./tabs-BR6ymnmH.js";import{B as K}from"./badge-7Ya4zrXx.js";import{C as ft}from"./chevron-down-DUg7Og3E.js";import{a as _e,e as ke,f as Se,F as bt,T as Te,p as Ke,M as Ge,A as yt}from"./objectiveHelpers-BJWAljoZ.js";import{S as Z,a as Y,b as ee,c as te,d as B}from"./select-D0O4DYHC.js";import{T as Nt,a as Ce}from"./toggle-group-Dv5nIJKK.js";import{S as Ee,a as De,b as qe,c as Fe,A as ae,e as ne,f as re,g as ie,h as ce,i as le,j as oe,k as de}from"./alert-dialog-U1LpuJ9a.js";import{P as se}from"./plus-DWZAKVby.js";import{C as vt}from"./copy-DF0jriB9.js";import{T as He}from"./trash-2-CepBEp71.js";import{C as Ct}from"./index-DJRmJIm7.js";import{P as wt}from"./pencil-CDw3FZci.js";import{C as Je}from"./clock-BZUoitrQ.js";import{C as _t}from"./circle-check-BwqtKouF.js";import{S as We,G as Xe}from"./send-BCIyymVq.js";import"./vendor-react-BzrpNAyj.js";import"./vendor-supabase-DFPLkPj_.js";import"./swim-3yhmQrIF.js";import"./index-4KCusY2U.js";import"./index-DnQp0dhm.js";import"./index-Oirgu2G-.js";import"./chevron-up-CxeaeNfi.js";import"./index-CnfUu9Ts.js";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kt=[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M16 2v4",key:"4m81vk"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M17 14h-6",key:"bkmgh3"}],["path",{d:"M13 18H7",key:"bb0bb7"}],["path",{d:"M7 14h.01",key:"1qa3f1"}],["path",{d:"M17 18h.01",key:"1bdyru"}]],Ze=mt("calendar-range",kt);function $e(...t){return t.filter(Boolean).join(" ")}const St=[{key:"effort",label:"Diff.",mode:"hard"},{key:"feeling",label:"Fat.",mode:"hard"},{key:"performance",label:"Perf",mode:"good"},{key:"engagement",label:"Eng.",mode:"good"}];function Tt(t,a){const s=Number(a);if(!Number.isFinite(s)||s<1||s>5)return"bg-muted text-muted-foreground";const n=t==="hard"?6-s:s;return n>=4?"bg-emerald-100 text-emerald-800 dark:bg-emerald-900/30 dark:text-emerald-400":n>=3?"bg-amber-100 text-amber-800 dark:bg-amber-900/30 dark:text-amber-400":"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400"}function Et({athleteId:t,athleteName:a}){const[s,n]=o.useState(20),[m,c]=o.useState(null),{data:r=[],isLoading:h}=T({queryKey:["sessions",t],queryFn:()=>p.getSessions(a,t)}),g=r.slice(0,s),j=r.length>s;return h?e.jsx("div",{className:"space-y-3",children:[1,2,3,4,5].map(x=>e.jsxs("div",{className:"rounded-2xl border bg-card p-3 animate-pulse motion-reduce:animate-none",children:[e.jsx("div",{className:"h-4 w-32 rounded bg-muted mb-2"}),e.jsx("div",{className:"h-3 w-full rounded bg-muted"})]},x))}):r.length===0?e.jsx("p",{className:"text-sm text-muted-foreground text-center py-8",children:"Aucun ressenti enregistre."}):e.jsxs("div",{className:"space-y-2",children:[g.map(x=>{const d=m===x.id;return e.jsxs("button",{type:"button",onClick:()=>c(d?null:x.id),className:"w-full rounded-2xl border bg-card p-3 text-left hover:border-primary/20 transition-all",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("span",{className:"text-sm font-semibold text-foreground",children:new Date(x.date).toLocaleDateString("fr-FR",{weekday:"short",day:"numeric",month:"short"})}),e.jsx("span",{className:"text-xs text-muted-foreground ml-1.5",children:x.slot})]}),e.jsx("div",{className:"flex items-center gap-1",children:St.map(b=>{const y=x[b.key];return e.jsx("span",{title:`${b.label}: ${y??"â€”"}`,className:$e("inline-flex items-center justify-center h-6 w-6 rounded-lg text-[10px] font-bold",Tt(b.mode,y)),children:y??"â€”"},b.key)})})]}),e.jsxs("div",{className:"flex items-center justify-between mt-1.5",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:x.distance>0?`${x.distance}m`:"â€”"}),x.comments&&e.jsx(ft,{className:$e("h-3.5 w-3.5 text-muted-foreground transition-transform",d&&"rotate-180")})]}),d&&x.comments&&e.jsx("div",{className:"mt-2 pt-2 border-t border-border",children:e.jsx("p",{className:"text-xs text-foreground whitespace-pre-wrap",children:x.comments})})]},x.id)}),j&&e.jsxs("button",{type:"button",onClick:x=>{x.stopPropagation(),n(d=>d+20)},className:"w-full rounded-2xl border border-dashed border-border py-2 text-xs font-medium text-muted-foreground hover:bg-muted transition",children:["Charger plus (",r.length-s," restants)"]})]})}async function Dt(t){const{data:a,error:s}=await Ve.rpc("get_auth_uid_for_user",{p_user_id:t});return s?(console.error("[objectives-tab] Failed to resolve auth UUID:",s.message),null):a}const qt=({open:t,onOpenChange:a,objective:s,athleteName:n,athleteAuthId:m,competitions:c})=>{const{toast:r}=ue(),h=me(),g=!!s,[j,x]=o.useState("chrono"),[d,b]=o.useState(""),[y,f]=o.useState("25"),[v,L]=o.useState(""),[C,P]=o.useState(""),[A,u]=o.useState(""),[w,N]=o.useState(!1);o.useEffect(()=>{if(t)if(s){const l=!!s.event_code,S=!!s.text;x(l&&S?"both":S?"texte":"chrono"),b(s.event_code??""),f(String(s.pool_length??25)),L(s.target_time_seconds!=null?Se(s.target_time_seconds):""),P(s.text??""),u(s.competition_id??"")}else x("chrono"),b(""),f("25"),L(""),P(""),u("")},[t,s]);const E=z({mutationFn:l=>p.createObjective(l),onSuccess:()=>{r({title:"Objectif cree"}),h.invalidateQueries({queryKey:["objectives",m]}),a(!1)},onError:l=>{r({title:"Erreur",description:l.message,variant:"destructive"})}}),D=z({mutationFn:l=>p.updateObjective(s.id,l),onSuccess:()=>{r({title:"Objectif mis a jour"}),h.invalidateQueries({queryKey:["objectives",m]}),a(!1)},onError:l=>{r({title:"Erreur",description:l.message,variant:"destructive"})}}),q=z({mutationFn:()=>p.deleteObjective(s.id),onSuccess:()=>{r({title:"Objectif supprime"}),h.invalidateQueries({queryKey:["objectives",m]}),a(!1)},onError:l=>{r({title:"Erreur",description:l.message,variant:"destructive"})}}),F=j==="chrono"||j==="both",M=j==="texte"||j==="both",G=()=>{if(F&&!d){r({title:"Epreuve requise",description:"Veuillez selectionner une epreuve.",variant:"destructive"});return}if(F&&v&&Ke(v)===null){r({title:"Format invalide",description:"Le temps doit etre au format m:ss:cc (ex: 1:05:30)",variant:"destructive"});return}if(M&&!C.trim()){r({title:"Texte requis",description:"Veuillez saisir un objectif texte.",variant:"destructive"});return}const l={athlete_id:m,competition_id:A&&A!=="none"?A:null,event_code:F?d:null,pool_length:F?Number(y):null,target_time_seconds:F&&v?Ke(v):null,text:M?C.trim():null};g?D.mutate(l):E.mutate(l)},I=E.isPending||D.isPending||q.isPending,W=o.useMemo(()=>{const l=new Date;return l.setHours(0,0,0,0),c.filter(S=>new Date(S.date+"T00:00:00").getTime()>=l.getTime())},[c]);return e.jsxs(e.Fragment,{children:[e.jsx(Ee,{open:t,onOpenChange:a,children:e.jsxs(De,{side:"right",className:"w-full sm:max-w-md overflow-y-auto",children:[e.jsx(qe,{children:e.jsx(Fe,{children:g?"Modifier l'objectif":"Nouvel objectif"})}),e.jsxs("div",{className:"mt-6 space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{children:"Nageur"}),e.jsx("p",{className:"text-sm font-medium",children:n})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{children:"Type d'objectif"}),e.jsxs(Nt,{type:"single",variant:"outline",value:j,onValueChange:l=>{l&&x(l)},className:"justify-start",children:[e.jsx(Ce,{value:"chrono",className:"text-xs",children:"Chrono"}),e.jsx(Ce,{value:"texte",className:"text-xs",children:"Texte"}),e.jsx(Ce,{value:"both",className:"text-xs",children:"Les deux"})]})]}),F&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{children:"Epreuve *"}),e.jsxs(Z,{value:d,onValueChange:b,children:[e.jsx(Y,{children:e.jsx(ee,{placeholder:"Choisir une epreuve"})}),e.jsx(te,{children:bt.map(l=>e.jsx(B,{value:l,children:ke(l)},l))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{children:"Bassin"}),e.jsxs(Z,{value:y,onValueChange:f,children:[e.jsx(Y,{children:e.jsx(ee,{})}),e.jsxs(te,{children:[e.jsx(B,{value:"25",children:"25m"}),e.jsx(B,{value:"50",children:"50m"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{children:"Temps cible (min:sec:centiemes)"}),e.jsx(ye,{placeholder:"Ex : 1:05:30",value:v,onChange:l=>L(l.target.value)})]})]}),M&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{children:"Objectif texte *"}),e.jsx(Te,{placeholder:"Ex : Ameliorer la coulee de dos",value:C,onChange:l=>P(l.target.value),rows:3})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{children:"Lier a une competition"}),e.jsxs(Z,{value:A,onValueChange:u,children:[e.jsx(Y,{children:e.jsx(ee,{placeholder:"Aucune"})}),e.jsxs(te,{children:[e.jsx(B,{value:"none",children:"Aucune"}),W.map(l=>e.jsxs(B,{value:l.id,children:[l.name," (",l.date,")"]},l.id))]})]})]}),e.jsxs("div",{className:"space-y-2 pt-2",children:[e.jsx(k,{className:"w-full",onClick:G,disabled:I,children:I?"Enregistrement...":g?"Enregistrer":"Creer"}),g&&e.jsx(k,{variant:"outline",className:"w-full text-destructive hover:text-destructive",onClick:()=>N(!0),disabled:I,children:"Supprimer cet objectif"})]})]})]})}),e.jsx(ae,{open:w,onOpenChange:N,children:e.jsxs(ne,{children:[e.jsxs(re,{children:[e.jsx(ie,{children:"Supprimer l'objectif"}),e.jsx(ce,{children:"Cette action est irreversible. L'objectif sera supprime definitivement."})]}),e.jsxs(le,{children:[e.jsx(oe,{children:"Annuler"}),e.jsx(de,{onClick:()=>{q.mutate(),N(!1)},className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Supprimer"})]})]})})]})},Ft=({objective:t,onEdit:a})=>{const s=!!t.event_code,n=!!t.text;return e.jsxs("button",{type:"button",className:"w-full text-left rounded-xl border bg-card p-3 space-y-1.5 transition-colors hover:bg-muted/50",onClick:()=>a(t),children:[s&&e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"text-sm font-semibold",children:ke(t.event_code)}),t.pool_length&&e.jsxs(K,{variant:"secondary",className:"text-[10px] px-1.5 py-0",children:[t.pool_length,"m"]}),t.target_time_seconds!=null&&e.jsx(K,{variant:"outline",className:"text-[10px] px-1.5 py-0 font-mono",children:Se(t.target_time_seconds)})]}),n&&e.jsx("p",{className:"text-sm text-muted-foreground line-clamp-2",children:t.text}),t.competition_name&&e.jsx(K,{variant:"outline",className:"border-orange-300 text-orange-600 dark:text-orange-400 text-[10px] px-1.5 py-0",children:t.competition_name})]})},At=({athleteId:t,athleteName:a})=>{const[s,n]=o.useState(!1),[m,c]=o.useState(null),{data:r,isLoading:h}=T({queryKey:["auth-uid",t],queryFn:()=>Dt(t),enabled:!!t}),{data:g=[]}=T({queryKey:["competitions"],queryFn:()=>p.getCompetitions()}),{data:j=[],isLoading:x}=T({queryKey:["objectives",r],queryFn:()=>p.getObjectives(r),enabled:!!r}),d=()=>{c(null),n(!0)},b=v=>{c(v),n(!0)},y=h,f=!!r&&!h;return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex justify-end",children:e.jsxs(k,{variant:"outline",size:"sm",onClick:d,disabled:!r,children:[e.jsx(se,{className:"mr-1.5 h-3.5 w-3.5"}),"Ajouter un objectif"]})}),y&&e.jsx("div",{className:"space-y-2",children:[1,2,3].map(v=>e.jsx("div",{className:"rounded-xl border p-3 animate-pulse motion-reduce:animate-none",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-4 w-40 rounded bg-muted"}),e.jsx("div",{className:"ml-auto h-5 w-12 rounded bg-muted"})]})},v))}),f&&x&&e.jsx("div",{className:"space-y-2",children:[1,2].map(v=>e.jsx("div",{className:"rounded-xl border p-3 animate-pulse motion-reduce:animate-none",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-4 w-32 rounded bg-muted"}),e.jsx("div",{className:"ml-auto h-5 w-16 rounded bg-muted"})]})},v))}),f&&!x&&j.length===0&&e.jsxs("div",{className:"text-center py-12 space-y-3",children:[e.jsx(_e,{className:"h-10 w-10 text-muted-foreground mx-auto"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Aucun objectif defini pour ",a,"."]}),e.jsxs(k,{variant:"outline",size:"sm",onClick:d,children:[e.jsx(se,{className:"mr-1.5 h-3.5 w-3.5"}),"Creer le premier objectif"]})]}),f&&!x&&j.length>0&&e.jsx("div",{className:"space-y-2",children:j.map(v=>e.jsx(Ft,{objective:v,onEdit:b},v.id))}),r&&e.jsx(qt,{open:s,onOpenChange:n,objective:m,athleteName:a,athleteAuthId:r,competitions:g})]})};function Ye(t){let a=0;for(let n=0;n<t.length;n++)a=t.charCodeAt(n)+((a<<5)-a);return`hsl(${Math.abs(a)%360}, 70%, 85%)`}function et(t){let a=0;for(let n=0;n<t.length;n++)a=t.charCodeAt(n)+((a<<5)-a);return`hsl(${Math.abs(a)%360}, 60%, 30%)`}function we(t,a){const s=[],n=new Date(t+"T00:00:00"),m=new Date(a+"T00:00:00"),c=new Date(n),r=c.getDay(),h=r===0?1:r===1?0:8-r;for(c.setDate(c.getDate()+h);c<=m;)s.push(c.toISOString().split("T")[0]),c.setDate(c.getDate()+7);return s}function be(t){return new Date(t+"T00:00:00").toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric"})}function pe(t){return new Date(t+"T00:00:00").toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit"})}function Mt(t){const a=new Date(t+"T00:00:00");return a.setDate(a.getDate()+6),a.toISOString().split("T")[0]}function Lt(t){const a=new Date;a.setHours(0,0,0,0);const s=new Date(t+"T00:00:00"),n=new Date(t+"T00:00:00");return n.setDate(n.getDate()+6),a>=s&&a<=n}const Pt=({athleteId:t})=>{const{toast:a}=ue(),s=me(),[n,m]=o.useState(null),[c,r]=o.useState(null),[h,g]=o.useState(""),[j,x]=o.useState(""),[d,b]=o.useState(!1),[y,f]=o.useState(!1),[v,L]=o.useState(!1),[C,P]=o.useState(""),[A,u]=o.useState(""),[w,N]=o.useState(""),{data:E=[]}=T({queryKey:["athletes"],queryFn:()=>p.getAthletes()}),D=o.useMemo(()=>E.find(_=>_.id===t)?.group_id??null,[E,t]),{data:q=[],isLoading:F}=T({queryKey:["training-cycles","athlete",t],queryFn:()=>p.getTrainingCycles({athleteId:t})}),{data:M=[],isLoading:G}=T({queryKey:["training-cycles","group",D],queryFn:()=>p.getTrainingCycles({groupId:D}),enabled:D!=null}),I=q.length===0&&M.length>0,W=q.length>0?q:M;o.useEffect(()=>{W.length>0&&(!n||!W.find(i=>i.id===n))&&m(W[0].id)},[W,n]);const l=W.find(i=>i.id===n)??null,{data:S=[],isLoading:$}=T({queryKey:["training-weeks",n],queryFn:()=>p.getTrainingWeeks(n),enabled:!!n}),{data:X=[]}=T({queryKey:["competitions"],queryFn:()=>p.getCompetitions()}),Ae=o.useMemo(()=>[...X].sort((i,_)=>i.date.localeCompare(_.date)),[X]),st=o.useMemo(()=>{const i=new Set;return S.forEach(_=>{_.week_type&&i.add(_.week_type)}),Array.from(i).sort()},[S]),at=o.useMemo(()=>{if(!l)return[];const i=l.start_competition_date,_=l.end_competition_date;return!i||!_?[]:we(i,_)},[l]),nt=o.useMemo(()=>{const i=new Map;return S.forEach(_=>i.set(_.week_start,_)),i},[S]),Me=F||G,Ne=z({mutationFn:async i=>{const _=await p.createTrainingCycle(i),O=X.find(V=>V.id===i.start_competition_id),U=X.find(V=>V.id===i.end_competition_id);if(O&&U){const V=we(O.date,U.date);V.length>0&&await p.bulkUpsertTrainingWeeks(V.map(dt=>({cycle_id:_.id,week_start:dt})))}return _},onSuccess:i=>{a({title:"Cycle cree"}),m(i.id),b(!1),P(""),u(""),N(""),s.invalidateQueries({queryKey:["training-cycles"]}),s.invalidateQueries({queryKey:["training-weeks",i.id]})},onError:i=>{a({title:"Erreur",description:i.message,variant:"destructive"})}}),rt=z({mutationFn:i=>p.deleteTrainingCycle(i),onSuccess:()=>{a({title:"Cycle supprime"}),m(null),f(!1),s.invalidateQueries({queryKey:["training-cycles"]})},onError:i=>{a({title:"Erreur",description:i.message,variant:"destructive"})}}),Le=z({mutationFn:i=>p.upsertTrainingWeek(i),onSuccess:()=>{r(null),s.invalidateQueries({queryKey:["training-weeks",n]})},onError:i=>{a({title:"Erreur",description:i.message,variant:"destructive"})}}),Pe=z({mutationFn:async()=>{for(const i of M){const _=await p.createTrainingCycle({athlete_id:t,group_id:null,start_competition_id:i.start_competition_id,end_competition_id:i.end_competition_id,name:i.name,notes:i.notes}),O=await p.getTrainingWeeks(i.id);O.length>0&&await p.bulkUpsertTrainingWeeks(O.map(U=>({cycle_id:_.id,week_start:U.week_start,week_type:U.week_type,notes:U.notes})))}},onSuccess:()=>{a({title:"Planification personnalisee"}),L(!1),m(null),s.invalidateQueries({queryKey:["training-cycles"]})},onError:i=>{a({title:"Erreur",description:i.message,variant:"destructive"})}}),Oe=()=>{if(!C.trim()){a({title:"Nom requis",variant:"destructive"});return}if(!A||!w){a({title:"Competitions requises",description:"Selectionnez les competitions de debut et fin.",variant:"destructive"});return}const i=X.find(O=>O.id===A),_=X.find(O=>O.id===w);if(i&&_&&_.date<=i.date){a({title:"Dates invalides",description:"La competition de fin doit etre apres celle de debut.",variant:"destructive"});return}Ne.mutate({athlete_id:t,group_id:null,start_competition_id:A,end_competition_id:w,name:C.trim()})},it=i=>{r(i.id),g(i.week_type??""),x(i.notes??"")},ct=i=>{r(`new:${i}`),g(""),x("")},lt=(i,_)=>{n&&Le.mutate({cycle_id:n,week_start:i,week_type:h.trim()||null,notes:j.trim()||null})},ot=()=>{r(null)};return!Me&&W.length===0?e.jsxs("div",{className:"text-center py-12 space-y-3",children:[e.jsx(Ze,{className:"h-10 w-10 text-muted-foreground mx-auto"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Aucun cycle de planification."}),e.jsxs(k,{variant:"outline",size:"sm",onClick:()=>b(!0),children:[e.jsx(se,{className:"mr-1.5 h-3.5 w-3.5"}),"Nouveau cycle"]}),e.jsx(ze,{open:d,onOpenChange:b,competitions:Ae,name:C,setName:P,startId:A,setStartId:u,endId:w,setEndId:N,onSubmit:Oe,isPending:Ne.isPending})]}):Me?e.jsx("div",{className:"space-y-3",children:[1,2,3].map(i=>e.jsx("div",{className:"rounded-xl border p-3 animate-pulse motion-reduce:animate-none",children:e.jsx("div",{className:"h-4 w-48 rounded bg-muted"})},i))}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[W.length>1?e.jsxs(Z,{value:n??"",onValueChange:m,children:[e.jsx(Y,{className:"w-auto min-w-[180px] h-8 text-sm",children:e.jsx(ee,{placeholder:"Choisir un cycle"})}),e.jsx(te,{children:W.map(i=>e.jsx(B,{value:i.id,children:i.name},i.id))})]}):l?e.jsx("span",{className:"text-sm font-semibold",children:l.name}):null,I&&e.jsx(K,{variant:"secondary",className:"text-[10px] px-1.5 py-0",children:"Planif. groupe"}),e.jsx("div",{className:"flex-1"}),I&&e.jsxs(k,{variant:"outline",size:"sm",className:"text-xs h-7",onClick:()=>L(!0),children:[e.jsx(vt,{className:"mr-1 h-3 w-3"}),"Personnaliser"]}),e.jsxs(k,{variant:"outline",size:"sm",className:"text-xs h-7",onClick:()=>b(!0),children:[e.jsx(se,{className:"mr-1 h-3 w-3"}),"Nouveau"]}),l&&!I&&e.jsx(k,{variant:"ghost",size:"sm",className:"text-xs h-7 text-destructive hover:text-destructive",onClick:()=>f(!0),children:e.jsx(He,{className:"h-3 w-3"})})]}),l&&e.jsxs("div",{className:"space-y-0",children:[e.jsxs("div",{className:"flex items-center gap-2 py-2 px-1",children:[e.jsx("span",{className:"text-base","aria-hidden":"true",children:"ðŸŠ"}),e.jsx("span",{className:"text-sm font-medium",children:l.start_competition_name??"Competition"}),l.start_competition_date&&e.jsxs("span",{className:"text-xs text-muted-foreground",children:["(",be(l.start_competition_date),")"]})]}),e.jsx("div",{className:"relative ml-3 border-l-2 border-border pl-4 space-y-1",children:$?e.jsx("div",{className:"py-4",children:e.jsx("div",{className:"h-4 w-32 rounded bg-muted animate-pulse motion-reduce:animate-none"})}):at.map((i,_)=>{const O=nt.get(i),U=Lt(i),V=c===(O?.id??`new:${i}`);return e.jsx(Ot,{monday:i,weekNumber:_+1,week:O,isCurrent:U,isEditing:V,isGroupPlan:I,editWeekType:h,setEditWeekType:g,editWeekNotes:j,setEditWeekNotes:x,existingWeekTypes:st,onStartEdit:()=>O?it(O):ct(i),onSave:()=>lt(i),onCancel:ot,isSaving:Le.isPending},i)})}),e.jsxs("div",{className:"flex items-center gap-2 py-2 px-1",children:[e.jsx("span",{className:"text-base","aria-hidden":"true",children:"ðŸŽ¯"}),e.jsx("span",{className:"text-sm font-medium",children:l.end_competition_name??"Competition"}),l.end_competition_date&&e.jsxs("span",{className:"text-xs text-muted-foreground",children:["(",be(l.end_competition_date),")"]})]})]}),e.jsx(ze,{open:d,onOpenChange:b,competitions:Ae,name:C,setName:P,startId:A,setStartId:u,endId:w,setEndId:N,onSubmit:Oe,isPending:Ne.isPending}),e.jsx(ae,{open:y,onOpenChange:f,children:e.jsxs(ne,{children:[e.jsxs(re,{children:[e.jsx(ie,{children:"Supprimer le cycle"}),e.jsx(ce,{children:"Cette action est irreversible. Le cycle et toutes ses semaines seront supprimes."})]}),e.jsxs(le,{children:[e.jsx(oe,{children:"Annuler"}),e.jsx(de,{onClick:()=>n&&rt.mutate(n),className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Supprimer"})]})]})}),e.jsx(ae,{open:v,onOpenChange:L,children:e.jsxs(ne,{children:[e.jsxs(re,{children:[e.jsx(ie,{children:"Personnaliser la planification"}),e.jsx(ce,{children:"Les cycles du groupe seront copies en tant que planification individuelle pour ce nageur. Vous pourrez ensuite les modifier independamment."})]}),e.jsxs(le,{children:[e.jsx(oe,{children:"Annuler"}),e.jsx(de,{onClick:()=>Pe.mutate(),children:Pe.isPending?"Copie...":"Personnaliser"})]})]})})]})},Ot=({monday:t,weekNumber:a,week:s,isCurrent:n,isEditing:m,isGroupPlan:c,editWeekType:r,setEditWeekType:h,editWeekNotes:g,setEditWeekNotes:j,existingWeekTypes:x,onStartEdit:d,onSave:b,onCancel:y,isSaving:f})=>{const v=Mt(t),L=`week-types-${t}`;return m?e.jsxs("div",{className:`rounded-lg border bg-card p-3 space-y-2 ${n?"ring-2 ring-primary":""}`,children:[e.jsxs("div",{className:"text-xs font-medium text-muted-foreground",children:["Sem. ",a," (",pe(t)," - ",pe(v),")"]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(R,{className:"text-xs",children:"Type de semaine"}),e.jsx(ye,{className:"h-7 text-sm",placeholder:"Ex : Foncier, Affutage, Recup...",list:L,value:r,onChange:C=>h(C.target.value)}),e.jsx("datalist",{id:L,children:x.map(C=>e.jsx("option",{value:C},C))})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(R,{className:"text-xs",children:"Notes"}),e.jsx(Te,{className:"text-sm min-h-[48px]",placeholder:"Notes optionnelles...",rows:2,value:g,onChange:C=>j(C.target.value)})]}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsxs(k,{variant:"ghost",size:"sm",className:"h-7 text-xs",onClick:y,children:[e.jsx(ut,{className:"mr-1 h-3 w-3"}),"Annuler"]}),e.jsxs(k,{size:"sm",className:"h-7 text-xs",onClick:b,disabled:f,children:[e.jsx(Ct,{className:"mr-1 h-3 w-3"}),f?"...":"Enregistrer"]})]})]}):e.jsxs("button",{type:"button",className:`w-full text-left rounded-lg border bg-card px-3 py-2 flex items-center gap-2 transition-colors ${c?"cursor-default":"hover:bg-muted/50"} ${n?"ring-2 ring-primary":""}`,onClick:c?void 0:d,disabled:c,children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs("span",{className:"text-xs font-medium text-muted-foreground whitespace-nowrap",children:["Sem. ",a]}),e.jsxs("span",{className:"text-[10px] text-muted-foreground/70 whitespace-nowrap",children:["(",pe(t)," - ",pe(v),")"]}),s?.week_type&&e.jsx(K,{className:"text-[10px] px-1.5 py-0 border-0",style:{backgroundColor:Ye(s.week_type),color:et(s.week_type)},children:s.week_type})]}),s?.notes&&e.jsx("p",{className:"text-xs text-muted-foreground mt-0.5 line-clamp-1",children:s.notes})]}),!c&&e.jsx(wt,{className:"h-3 w-3 text-muted-foreground/40 shrink-0"})]})},ze=({open:t,onOpenChange:a,competitions:s,name:n,setName:m,startId:c,setStartId:r,endId:h,setEndId:g,onSubmit:j,isPending:x})=>(o.useEffect(()=>{t&&(m(""),r(""),g(""))},[t]),e.jsx(Ee,{open:t,onOpenChange:a,children:e.jsxs(De,{side:"right",className:"w-full sm:max-w-md overflow-y-auto",children:[e.jsx(qe,{children:e.jsx(Fe,{children:"Nouveau cycle"})}),e.jsxs("div",{className:"mt-6 space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{children:"Nom du cycle *"}),e.jsx(ye,{placeholder:"Ex : Preparation hiver",value:n,onChange:d=>m(d.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{children:"Competition de debut *"}),e.jsxs(Z,{value:c,onValueChange:r,children:[e.jsx(Y,{children:e.jsx(ee,{placeholder:"Choisir..."})}),e.jsx(te,{children:s.map(d=>e.jsxs(B,{value:d.id,children:[d.name," (",be(d.date),")"]},d.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{children:"Competition de fin *"}),e.jsxs(Z,{value:h,onValueChange:g,children:[e.jsx(Y,{children:e.jsx(ee,{placeholder:"Choisir..."})}),e.jsx(te,{children:s.map(d=>e.jsxs(B,{value:d.id,children:[d.name," (",be(d.date),")"]},d.id))})]})]}),c&&h&&(()=>{const d=s.find(y=>y.id===c),b=s.find(y=>y.id===h);if(d&&b&&b.date>d.date){const y=we(d.date,b.date).length;return e.jsxs("p",{className:"text-xs text-muted-foreground",children:[y," semaine",y>1?"s":""," seront generees."]})}return null})(),e.jsx(k,{className:"w-full",onClick:j,disabled:x,children:x?"Creation...":"Creer le cycle"})]})]})}));function J(t){return new Date(t+"T12:00:00").toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric"})}function ge(t){return new Date(t+"T00:00:00").toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit"})}function Kt(t){const a=new Date(t+"T00:00:00");return a.setDate(a.getDate()+6),a.toISOString().split("T")[0]}function Wt(t){const a=new Date;a.setHours(0,0,0,0);const s=new Date(t+"T00:00:00"),n=new Date(t+"T00:00:00");return n.setDate(n.getDate()+6),a>=s&&a<=n}function Re(t,a){const s=[],n=new Date(t+"T00:00:00"),m=new Date(a+"T00:00:00"),c=new Date(n),r=c.getDay(),h=r===0?1:r===1?0:8-r;for(c.setDate(c.getDate()+h);c<=m;)s.push(c.toISOString().split("T")[0]),c.setDate(c.getDate()+7);return s}function $t(t,a){const s=new Date(t+"T00:00:00"),n=new Date(a+"T00:00:00");return Math.round((n.getTime()-s.getTime())/(1e3*60*60*24))}const zt={draft_athlete:{label:"En attente nageur",variant:"secondary",className:"bg-amber-100 text-amber-800 dark:bg-amber-900/40 dark:text-amber-300 border-amber-200 dark:border-amber-800"},draft_coach:{label:"Preparation coach",variant:"secondary",className:"bg-blue-100 text-blue-800 dark:bg-blue-900/40 dark:text-blue-300 border-blue-200 dark:border-blue-800"},sent:{label:"Envoye",variant:"secondary",className:"bg-green-100 text-green-800 dark:bg-green-900/40 dark:text-green-300 border-green-200 dark:border-green-800"},signed:{label:"Signe",variant:"secondary",className:"bg-slate-100 text-slate-600 dark:bg-slate-800/40 dark:text-slate-300 border-slate-200 dark:border-slate-700"}};function tt(t){const a=zt[t];return e.jsx(K,{variant:a.variant,className:`text-[10px] px-1.5 py-0 ${a.className}`,children:a.label})}function Rt(t){const a=[t.athlete_successes,t.athlete_difficulties,t.athlete_goals,t.athlete_commitments,t.coach_review,t.coach_objectives,t.coach_actions];for(const s of a)if(s&&s.trim())return s.trim();return null}async function It(t){const{data:a,error:s}=await Ve.rpc("get_auth_uid_for_user",{p_user_id:t});return s?(console.error("[interviews-tab] Failed to resolve auth UUID:",s.message),null):a}const H=({label:t,text:a})=>e.jsxs("div",{className:"border-l-4 border-blue-400 rounded-r-lg bg-blue-50/50 dark:bg-blue-950/20 p-3 space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(Be,{className:"h-3.5 w-3.5 text-blue-500"}),e.jsx("p",{className:"text-xs font-bold uppercase tracking-widest text-muted-foreground",children:t})]}),e.jsx("p",{className:"text-sm whitespace-pre-wrap",children:a?.trim()||e.jsx("span",{className:"italic text-muted-foreground",children:"Non renseigne"})})]}),je=({label:t,text:a})=>e.jsxs("div",{className:"border-l-4 border-amber-400 rounded-r-lg bg-amber-50/50 dark:bg-amber-950/20 p-3 space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(Xe,{className:"h-3.5 w-3.5 text-amber-500"}),e.jsx("p",{className:"text-xs font-bold uppercase tracking-widest text-muted-foreground",children:t})]}),e.jsx("p",{className:"text-sm whitespace-pre-wrap",children:a?.trim()||e.jsx("span",{className:"italic text-muted-foreground",children:"Non renseigne"})})]}),fe=({label:t,value:a,onChange:s,placeholder:n,rows:m=3})=>e.jsxs("div",{className:"border-l-4 border-amber-400 rounded-r-lg bg-amber-50/50 dark:bg-amber-950/20 p-3 space-y-1.5",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(Xe,{className:"h-3.5 w-3.5 text-amber-500"}),e.jsx("p",{className:"text-xs font-bold uppercase tracking-widest text-muted-foreground",children:t})]}),e.jsx(Te,{className:"bg-white dark:bg-background",placeholder:n,value:a,onChange:c=>s(c.target.value),rows:m})]}),Q=({label:t})=>e.jsxs("div",{className:"flex items-center gap-2 pt-3",children:[e.jsx("div",{className:"h-px flex-1 bg-border"}),e.jsx("span",{className:"text-xs font-bold uppercase tracking-widest text-muted-foreground",children:t}),e.jsx("div",{className:"h-px flex-1 bg-border"})]}),Ie=({objective:t})=>{const a=!!t.event_code,s=!!t.text;return e.jsxs("div",{className:"rounded-lg border bg-card p-2.5 text-sm space-y-0.5",children:[a&&e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx(_e,{className:"h-3.5 w-3.5 text-muted-foreground shrink-0"}),e.jsx("span",{className:"font-medium",children:ke(t.event_code)}),t.pool_length&&e.jsxs(K,{variant:"secondary",className:"text-[10px] px-1.5 py-0",children:[t.pool_length,"m"]}),t.target_time_seconds!=null&&e.jsx(K,{variant:"outline",className:"text-[10px] px-1.5 py-0 font-mono",children:Se(t.target_time_seconds)})]}),s&&e.jsx("p",{className:"text-muted-foreground line-clamp-2",children:t.text})]})},Qe=({prevInterview:t})=>e.jsxs("div",{className:"rounded-xl border bg-muted/30 p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs font-bold uppercase tracking-widest text-muted-foreground",children:"Bilan du cycle precedent"}),e.jsx(K,{variant:"secondary",className:"text-[10px] px-1.5 py-0",children:J(t.date)})]}),t.athlete_commitments&&e.jsxs("div",{className:"border-l-4 border-blue-400 rounded-r-lg bg-blue-50/50 dark:bg-blue-950/20 p-3 space-y-1",children:[e.jsx("p",{className:"text-xs font-semibold text-muted-foreground",children:"Engagements nageur"}),e.jsx("p",{className:"text-sm whitespace-pre-wrap",children:t.athlete_commitments})]}),t.coach_actions&&e.jsxs("div",{className:"border-l-4 border-amber-400 rounded-r-lg bg-amber-50/50 dark:bg-amber-950/20 p-3 space-y-1",children:[e.jsx("p",{className:"text-xs font-semibold text-muted-foreground",children:"Actions coach"}),e.jsx("p",{className:"text-sm whitespace-pre-wrap",children:t.coach_actions})]}),t.athlete_commitment_review&&e.jsxs("div",{className:"border-l-4 border-blue-400 rounded-r-lg bg-blue-50/80 dark:bg-blue-950/30 p-3 space-y-1",children:[e.jsx("p",{className:"text-xs font-semibold text-muted-foreground",children:"Bilan du nageur"}),e.jsx("p",{className:"text-sm whitespace-pre-wrap",children:t.athlete_commitment_review})]}),!t.athlete_commitments&&!t.coach_actions&&e.jsx("p",{className:"text-xs text-muted-foreground italic",children:"Aucun engagement enregistre."})]}),Ue=({athleteId:t,interviewDate:a})=>{const{toast:s}=ue(),n=me(),{data:m=[]}=T({queryKey:["competitions"],queryFn:()=>p.getCompetitions()}),{data:c=[]}=T({queryKey:["my-competition-ids",t],queryFn:()=>p.getMyCompetitionIds(t)}),r=o.useMemo(()=>{const u=new Set(c);return m.filter(N=>u.has(N.id)&&N.date>=a).sort((N,E)=>N.date.localeCompare(E.date))[0]??null},[m,c,a]),{data:h=[]}=T({queryKey:["training-cycles","athlete",t],queryFn:()=>p.getTrainingCycles({athleteId:t})}),g=o.useMemo(()=>r?h.find(u=>u.end_competition_id===r.id||u.end_competition_date&&u.end_competition_date>=a)??null:null,[h,r,a]),{data:j=[]}=T({queryKey:["training-weeks",g?.id],queryFn:()=>p.getTrainingWeeks(g.id),enabled:!!g}),[x,d]=o.useState(null),[b,y]=o.useState(""),f=o.useMemo(()=>{const u=new Set;return j.forEach(w=>{w.week_type&&u.add(w.week_type)}),Array.from(u).sort()},[j]),v=o.useMemo(()=>{const u=new Map;return j.forEach(w=>u.set(w.week_start,w)),u},[j]),L=o.useMemo(()=>{if(!r)return[];const u=a,w=r.date;return Re(u,w)},[r,a]),C=r?$t(new Date().toISOString().split("T")[0],r.date):null,P=z({mutationFn:async()=>{if(!r)throw new Error("Pas de competition");const w=m.filter(D=>D.date<=a).sort((D,q)=>q.date.localeCompare(D.date))[0]??r,N=await p.createTrainingCycle({athlete_id:t,group_id:null,start_competition_id:w.id,end_competition_id:r.id,name:`Preparation ${r.name}`}),E=Re(a,r.date);return E.length>0&&await p.bulkUpsertTrainingWeeks(E.map(D=>({cycle_id:N.id,week_start:D}))),N},onSuccess:()=>{s({title:"Planification creee"}),n.invalidateQueries({queryKey:["training-cycles"]}),n.invalidateQueries({queryKey:["training-weeks"]})},onError:u=>{s({title:"Erreur",description:u.message,variant:"destructive"})}}),A=z({mutationFn:u=>p.upsertTrainingWeek(u),onSuccess:()=>{d(null),n.invalidateQueries({queryKey:["training-weeks",g?.id]})},onError:u=>{s({title:"Erreur",description:u.message,variant:"destructive"})}});return r?g?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm flex-wrap",children:[e.jsx(ve,{className:"h-4 w-4 text-amber-500 shrink-0"}),e.jsx("span",{className:"font-medium",children:r.name}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:["(",J(r.date),")"]}),C!=null&&e.jsxs(K,{variant:"secondary",className:"text-[10px]",children:["J-",C]})]}),e.jsx("div",{className:"relative ml-2 border-l-2 border-border pl-3 space-y-1",children:L.map((u,w)=>{const N=v.get(u),E=Wt(u),D=x===u,q=Kt(u),F=`inline-week-${u}`;return D?e.jsxs("div",{className:`rounded-lg border bg-card p-2 space-y-1.5 ${E?"ring-2 ring-primary":""}`,children:[e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Sem. ",w+1," (",ge(u)," - ",ge(q),")"]}),e.jsx(ye,{className:"h-7 text-sm",placeholder:"Foncier, Techni., Affutage...",list:F,value:b,onChange:M=>y(M.target.value)}),e.jsx("datalist",{id:F,children:f.map(M=>e.jsx("option",{value:M},M))}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx(k,{variant:"ghost",size:"sm",className:"h-6 text-xs px-2",onClick:()=>d(null),children:"Annuler"}),e.jsx(k,{size:"sm",className:"h-6 text-xs px-2",onClick:()=>{g&&A.mutate({cycle_id:g.id,week_start:u,week_type:b.trim()||null})},disabled:A.isPending,children:"OK"})]})]},u):e.jsxs("button",{type:"button",className:`w-full text-left rounded-lg px-2 py-1.5 flex items-center gap-2 text-xs transition-colors hover:bg-muted/50 ${E?"ring-2 ring-primary bg-primary/5":""}`,onClick:()=>{d(u),y(N?.week_type??"")},children:[e.jsx("span",{className:`h-2 w-2 rounded-full shrink-0 ${E?"bg-primary":N?.week_type?"bg-muted-foreground/40":"bg-muted-foreground/20"}`}),e.jsxs("span",{className:"text-muted-foreground whitespace-nowrap",children:["Sem. ",w+1]}),e.jsxs("span",{className:"text-muted-foreground/60 whitespace-nowrap",children:[ge(u)," - ",ge(q)]}),N?.week_type&&e.jsx(K,{className:"text-[10px] px-1.5 py-0 border-0 ml-auto",style:{backgroundColor:Ye(N.week_type),color:et(N.week_type)},children:N.week_type})]},u)})}),e.jsxs("div",{className:"flex items-center gap-2 ml-2 pl-3 text-xs",children:[e.jsx(ve,{className:"h-3.5 w-3.5 text-amber-500"}),e.jsx("span",{className:"font-semibold",children:r.name})]})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(ve,{className:"h-4 w-4 text-amber-500"}),e.jsx("span",{className:"font-medium",children:r.name}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:["(",J(r.date),")"]}),C!=null&&e.jsxs(K,{variant:"secondary",className:"text-[10px]",children:["J-",C]})]}),e.jsx(k,{variant:"outline",size:"sm",className:"w-full text-xs",onClick:()=>P.mutate(),disabled:P.isPending,children:P.isPending?"Creation...":"Creer la planification"})]}):e.jsx("div",{className:"text-center py-4",children:e.jsx("p",{className:"text-xs text-muted-foreground italic",children:"Aucune competition assignee a venir â€” planification non disponible."})})},Qt=({open:t,onOpenChange:a,interview:s,athleteId:n,athleteAuthId:m})=>{const{toast:c}=ue(),r=me(),[h,g]=o.useState(""),[j,x]=o.useState(""),[d,b]=o.useState(""),[y,f]=o.useState(""),[v,L]=o.useState(""),[C,P]=o.useState(""),[A,u]=o.useState(!1),[w,N]=o.useState(!1),[E,D]=o.useState(null);t&&s&&s.id!==E&&(g(s.coach_comment_successes??""),x(s.coach_comment_difficulties??""),b(s.coach_comment_goals??""),f(s.coach_review??""),L(s.coach_objectives??""),P(s.coach_actions??""),D(s.id)),!t&&E!==null&&D(null);const{data:q}=T({queryKey:["previous-interview",n,s?.date],queryFn:()=>p.getPreviousInterview(n,s.date),enabled:!!s?.date}),{data:F=[]}=T({queryKey:["objectives",m],queryFn:()=>p.getObjectives(m),enabled:!!m}),M=()=>({coach_comment_successes:h.trim()||null,coach_comment_difficulties:j.trim()||null,coach_comment_goals:d.trim()||null,coach_review:y.trim()||null,coach_objectives:v.trim()||null,coach_actions:C.trim()||null}),G=z({mutationFn:()=>p.updateInterviewCoachSections(s.id,M()),onSuccess:()=>{c({title:"Enregistre"}),r.invalidateQueries({queryKey:["interviews",n]})},onError:$=>{c({title:"Erreur",description:$.message,variant:"destructive"})}}),I=z({mutationFn:async()=>(await p.updateInterviewCoachSections(s.id,M()),p.sendInterviewToAthlete(s.id)),onSuccess:()=>{c({title:"Entretien envoye au nageur"}),r.invalidateQueries({queryKey:["interviews",n]}),a(!1)},onError:$=>{c({title:"Erreur",description:$.message,variant:"destructive"})}}),W=z({mutationFn:()=>p.deleteInterview(s.id),onSuccess:()=>{c({title:"Entretien supprime"}),r.invalidateQueries({queryKey:["interviews",n]}),a(!1)},onError:$=>{c({title:"Erreur",description:$.message,variant:"destructive"})}}),l=G.isPending||I.isPending||W.isPending;if(!s)return null;const S=s.status;return e.jsxs(e.Fragment,{children:[e.jsx(Ee,{open:t,onOpenChange:a,children:e.jsxs(De,{side:"right",className:"w-full sm:max-w-lg overflow-y-auto",children:[e.jsx(qe,{children:e.jsxs(Fe,{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs("span",{children:["Entretien du ",J(s.date)]}),tt(S)]})}),e.jsxs("div",{className:"mt-6 space-y-5",children:[S==="draft_athlete"&&e.jsxs("div",{className:"rounded-xl border border-dashed border-amber-300 bg-amber-50/50 dark:bg-amber-950/20 p-6 text-center space-y-2",children:[e.jsx(Je,{className:"h-8 w-8 mx-auto text-amber-500"}),e.jsx("p",{className:"text-sm font-medium",children:"En attente de la preparation du nageur"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Le contenu n'est pas encore visible. Le nageur doit d'abord remplir ses sections."})]}),S==="draft_coach"&&e.jsxs(e.Fragment,{children:[q&&e.jsx(Qe,{prevInterview:q}),e.jsx(Q,{label:"Reussites"}),e.jsx(H,{label:"Nageur",text:s.athlete_successes}),e.jsx(fe,{label:"Coach",value:h,onChange:g,placeholder:"Votre commentaire sur les reussites..."}),e.jsx(Q,{label:"Difficultes"}),e.jsx(H,{label:"Nageur",text:s.athlete_difficulties}),e.jsx(fe,{label:"Coach",value:j,onChange:x,placeholder:"Votre commentaire sur les difficultes..."}),e.jsx(Q,{label:"Objectifs"}),F.length>0&&e.jsx("div",{className:"space-y-1.5",children:F.map($=>e.jsx(Ie,{objective:$},$.id))}),e.jsx(H,{label:"Nageur",text:s.athlete_goals}),e.jsx(fe,{label:"Coach",value:d,onChange:b,placeholder:"Objectifs complementaires, commentaires..."}),e.jsx(Q,{label:"Planification"}),e.jsx(Ue,{athleteId:n,interviewDate:s.date}),e.jsx(Q,{label:"Engagements & Actions"}),e.jsxs("div",{className:"rounded-xl bg-card border shadow-sm p-4 space-y-3",children:[e.jsxs("div",{className:"border-l-4 border-blue-400 rounded-r-lg bg-blue-50/50 dark:bg-blue-950/20 p-3 space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(Be,{className:"h-3.5 w-3.5 text-blue-500"}),e.jsx("p",{className:"text-xs font-bold uppercase tracking-widest text-muted-foreground",children:"Engagements du nageur"})]}),e.jsx("p",{className:"text-sm whitespace-pre-wrap",children:s.athlete_commitments?.trim()||e.jsx("span",{className:"italic text-muted-foreground",children:"Non renseigne"})})]}),e.jsx(fe,{label:"Actions du coach",value:C,onChange:P,placeholder:"Actions concretes, points de suivi..."})]})]}),(S==="sent"||S==="signed")&&e.jsxs(e.Fragment,{children:[q&&e.jsx(Qe,{prevInterview:q}),e.jsx(Q,{label:"Reussites"}),e.jsx(H,{label:"Nageur",text:s.athlete_successes}),e.jsx(je,{label:"Coach",text:s.coach_comment_successes||s.coach_review}),e.jsx(Q,{label:"Difficultes"}),e.jsx(H,{label:"Nageur",text:s.athlete_difficulties}),e.jsx(je,{label:"Coach",text:s.coach_comment_difficulties}),e.jsx(Q,{label:"Objectifs"}),F.length>0&&e.jsx("div",{className:"space-y-1.5",children:F.map($=>e.jsx(Ie,{objective:$},$.id))}),e.jsx(H,{label:"Nageur",text:s.athlete_goals}),e.jsx(je,{label:"Coach",text:s.coach_comment_goals||s.coach_objectives}),e.jsx(Q,{label:"Planification"}),e.jsx(Ue,{athleteId:n,interviewDate:s.date}),e.jsx(Q,{label:"Engagements & Actions"}),e.jsxs("div",{className:"rounded-xl bg-card border shadow-sm p-4 space-y-3",children:[e.jsx(H,{label:"Engagements du nageur",text:s.athlete_commitments}),e.jsx(je,{label:"Actions du coach",text:s.coach_actions})]}),S==="signed"&&s.signed_at&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(_t,{className:"h-4 w-4 text-green-600"}),e.jsxs("span",{children:["Signe le ",J(s.signed_at.slice(0,10))]})]})]}),e.jsxs("div",{className:"space-y-2 pt-2 border-t",children:[S==="draft_coach"&&e.jsxs(e.Fragment,{children:[e.jsx(k,{className:"w-full",variant:"outline",onClick:()=>G.mutate(),disabled:l,children:G.isPending?"Enregistrement...":"Enregistrer"}),e.jsxs(k,{className:"w-full",onClick:()=>N(!0),disabled:l,children:[e.jsx(We,{className:"mr-1.5 h-3.5 w-3.5"}),"Envoyer au nageur"]})]}),e.jsxs(k,{variant:"outline",className:"w-full text-destructive hover:text-destructive",onClick:()=>u(!0),disabled:l,children:[e.jsx(He,{className:"mr-1.5 h-3.5 w-3.5"}),"Supprimer"]})]})]})]})}),e.jsx(ae,{open:A,onOpenChange:u,children:e.jsxs(ne,{children:[e.jsxs(re,{children:[e.jsx(ie,{children:"Supprimer l'entretien"}),e.jsxs(ce,{children:["Cette action est irreversible. L'entretien du ",s.date?J(s.date):""," sera supprime definitivement."]})]}),e.jsxs(le,{children:[e.jsx(oe,{children:"Annuler"}),e.jsx(de,{onClick:()=>{W.mutate(),u(!1)},className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Supprimer"})]})]})}),e.jsx(ae,{open:w,onOpenChange:N,children:e.jsxs(ne,{children:[e.jsxs(re,{children:[e.jsx(ie,{children:"Envoyer au nageur"}),e.jsx(ce,{children:"L'entretien sera envoye au nageur pour consultation. Les sections coach seront enregistrees automatiquement."})]}),e.jsxs(le,{children:[e.jsx(oe,{children:"Annuler"}),e.jsxs(de,{onClick:()=>{I.mutate(),N(!1)},children:[e.jsx(We,{className:"mr-1.5 h-3.5 w-3.5"}),"Envoyer"]})]})]})})]})},Ut=({interview:t,onClick:a})=>{const s=Rt(t);return e.jsxs("button",{type:"button",className:"w-full text-left rounded-xl border bg-card p-3 space-y-1.5 transition-colors hover:bg-muted/50",onClick:a,children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"text-sm font-semibold",children:J(t.date)}),tt(t.status)]}),s&&e.jsx("p",{className:"text-xs text-muted-foreground line-clamp-2",children:s})]})},Vt=({athleteId:t,athleteName:a})=>{const{toast:s}=ue(),n=me(),[m,c]=o.useState(null),[r,h]=o.useState(!1),{data:g}=T({queryKey:["auth-uid",t],queryFn:()=>It(t),enabled:!!t}),{data:j=[],isLoading:x}=T({queryKey:["interviews",t],queryFn:()=>p.getInterviews(t),enabled:!!t}),d=z({mutationFn:()=>p.createInterview({athlete_id:t}),onSuccess:f=>{s({title:"Entretien cree"}),n.invalidateQueries({queryKey:["interviews",t]}),c(f),h(!0)},onError:f=>{s({title:"Erreur",description:f.message,variant:"destructive"})}}),b=f=>{c(f),h(!0)},y=f=>{h(f),f||c(null)};return x?e.jsx("div",{className:"space-y-2",children:[1,2,3].map(f=>e.jsx("div",{className:"rounded-xl border p-3 animate-pulse motion-reduce:animate-none",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-4 w-24 rounded bg-muted"}),e.jsx("div",{className:"ml-auto h-5 w-20 rounded bg-muted"})]})},f))}):j.length===0?e.jsxs("div",{className:"text-center py-12 space-y-3",children:[e.jsx(Ge,{className:"h-10 w-10 text-muted-foreground mx-auto"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Aucun entretien pour ",a,"."]}),e.jsxs(k,{variant:"outline",size:"sm",onClick:()=>d.mutate(),disabled:d.isPending,children:[e.jsx(se,{className:"mr-1.5 h-3.5 w-3.5"}),d.isPending?"Creation...":"Nouvel entretien"]})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"text-sm font-semibold",children:"Entretiens"}),e.jsx(K,{variant:"secondary",className:"text-[10px] px-1.5 py-0",children:j.length})]}),e.jsxs(k,{variant:"outline",size:"sm",onClick:()=>d.mutate(),disabled:d.isPending,children:[e.jsx(se,{className:"mr-1.5 h-3.5 w-3.5"}),d.isPending?"Creation...":"Nouvel entretien"]})]}),e.jsx("div",{className:"space-y-2",children:j.map(f=>e.jsx(Ut,{interview:f,onClick:()=>b(f)},f.id))}),e.jsx(Qt,{open:r,onOpenChange:y,interview:m,athleteId:t,athleteAuthId:g??null})]})};function bs(){const[,t]=xt("/coach/swimmer/:id"),[,a]=ht(),{selectedAthleteId:s,selectedAthleteName:n}=pt(),m=t?.id?Number(t.id):s,c=n,{data:r}=T({queryKey:["profile",m],queryFn:()=>p.getProfile({userId:m}),enabled:m!=null}),h=r?.display_name??c??"Nageur",g=r?.avatar_url??null,j=r?.group_label??null;return m?e.jsxs("div",{className:"mx-auto max-w-3xl px-4 py-4 space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{type:"button",onClick:()=>a("/coach?section=swimmers"),className:"h-9 w-9 rounded-xl border border-border bg-card flex items-center justify-center hover:bg-muted transition","aria-label":"Retour",children:e.jsx(yt,{className:"h-4 w-4"})}),g?e.jsx("img",{src:g,alt:"",className:"h-10 w-10 rounded-full object-cover border border-border"}):e.jsx("div",{className:"h-10 w-10 rounded-full bg-primary/10 flex items-center justify-center text-sm font-bold text-primary",children:h.charAt(0).toUpperCase()}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h1",{className:"text-lg font-bold truncate",children:h}),j&&e.jsx(K,{variant:"secondary",className:"text-[10px] px-1.5 py-0",children:j})]})]}),e.jsxs(gt,{defaultValue:"ressentis",children:[e.jsxs(jt,{className:"w-full grid grid-cols-4",children:[e.jsxs(xe,{value:"ressentis",className:"text-xs gap-1",children:[e.jsx(Je,{className:"h-3.5 w-3.5"}),e.jsx("span",{className:"hidden sm:inline",children:"Ressentis"})]}),e.jsxs(xe,{value:"objectifs",className:"text-xs gap-1",children:[e.jsx(_e,{className:"h-3.5 w-3.5"}),e.jsx("span",{className:"hidden sm:inline",children:"Objectifs"})]}),e.jsxs(xe,{value:"planification",className:"text-xs gap-1",children:[e.jsx(Ze,{className:"h-3.5 w-3.5"}),e.jsx("span",{className:"hidden sm:inline",children:"Planif."})]}),e.jsxs(xe,{value:"entretiens",className:"text-xs gap-1",children:[e.jsx(Ge,{className:"h-3.5 w-3.5"}),e.jsx("span",{className:"hidden sm:inline",children:"Entretiens"})]})]}),e.jsx(he,{value:"ressentis",className:"mt-4",children:e.jsx(Et,{athleteId:m,athleteName:h})}),e.jsx(he,{value:"objectifs",className:"mt-4",children:e.jsx(At,{athleteId:m,athleteName:h})}),e.jsx(he,{value:"planification",className:"mt-4",children:e.jsx(Pt,{athleteId:m})}),e.jsx(he,{value:"entretiens",className:"mt-4",children:e.jsx(Vt,{athleteId:m,athleteName:h})})]})]}):e.jsxs("div",{className:"p-4 text-center text-muted-foreground",children:[e.jsx("p",{children:"Aucun nageur sÃ©lectionnÃ©."}),e.jsx("button",{type:"button",onClick:()=>a("/coach?section=swimmers"),className:"mt-2 text-primary underline",children:"Retour au dashboard"})]})}export{bs as default};
