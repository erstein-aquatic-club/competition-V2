import{r as d,R as Hs,j as e,c as Xs,u as Y,d as M}from"./vendor-query-BiSH4r2z.js";import{a as F}from"./api-Co6exKwR.js";import{c as we,o as Ys,q as as,P as re,r as Se,v as Js,N as Zs,a as U,D as Ce,C as et,L as _,I as R,d as st,B as $,S as ue,s as Ge}from"./index-Dm3SzHfx.js";import{c as is,R as tt,I as rt}from"./index-BIx1lmEv.js";import{u as nt}from"./index-DnMXTEkQ.js";import{u as at,S as me,a as pe,b as xe,c as he,d as q}from"./select-jxDxI7r7.js";import{C as it}from"./CalendarGrid-zF3qKrap.js";import{T as Z}from"./objectiveHelpers-CSu3km8c.js";import{D as ee,a as se,b as je,c as ve}from"./dialog-DmbCDscj.js";import{C as Le}from"./checkbox-CYtuykeF.js";import{A as Ke,e as Ue,f as Qe,g as ze,h as Be,i as Ve,j as We,k as He}from"./alert-dialog-L_oQGHNz.js";import{T as ls,a as cs,b as ye,c as Ne}from"./tabs-Bm2RHQqV.js";import{A as lt,a as ct,F as ot,S as dt,b as ut,c as mt,d as Xe}from"./SessionListView-DVaBpcQX.js";import{D as pt,a as xt,b as ht,c as ft}from"./drawer-BsMwj3BP.js";import{C as gt,a as jt,b as vt,c as yt,d as Ye,e as Nt,P as os,f as ds,g as us}from"./Coach-PRs7megh.js";import{C as ms}from"./chevron-down-EvTvp7Cv.js";import{C as bt}from"./index-Dwh2gPk0.js";import{T as Ee}from"./trash-2-Dnn9zDHj.js";import{P as te}from"./plus-DgIReocw.js";import{C as _t}from"./chevron-right-BPr1v7-t.js";import{P as wt}from"./pencil-CZfkrj_C.js";import{L as Je}from"./loader-circle-DVUs4jxK.js";import{C as St}from"./circle-alert-CdocIJGN.js";import{S as Ct}from"./search-DofV1hsu.js";import{P as Et}from"./pen-C1SVbmGv.js";import"./vendor-react-BzrpNAyj.js";import"./swim-BW1Hd6td.js";import"./vendor-supabase-DFPLkPj_.js";import"./index-fh39PRN_.js";import"./chevron-up-QOusOpIj.js";import"./chevron-left-C95jZMwJ.js";import"./index-2kZIjqxy.js";import"./play-Doos4HBb.js";import"./save-C4H9alKO.js";import"./share-2-BvlygocU.js";import"./toggle-group-DPtJRI4m.js";import"./badge-CTeJgXGc.js";import"./copy-CaHVuSI0.js";import"./InlineBanner-BDLbL9E1.js";import"./separator-Bzm1b7ca.js";import"./collapsible-CNJUPpNJ.js";import"./user-plus-C3XXUHgj.js";import"./switch-SxF2OwTf.js";import"./map-pin-oi0vMsQL.js";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kt=[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]],Rt=we("ellipsis",kt);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dt=[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]],Ft=we("funnel",Dt);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const It=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],Ze=we("upload",It);function be(t,n,{checkForDefaultPrevented:a=!0}={}){return function(i){if(t?.(i),a===!1||!i.defaultPrevented)return n?.(i)}}var Pt=Hs[" useInsertionEffect ".trim().toString()]||Ys;function Mt({prop:t,defaultProp:n,onChange:a=()=>{},caller:o}){const[i,c,h]=At({defaultProp:n,onChange:a}),p=t!==void 0,j=p?t:i;{const u=d.useRef(t!==void 0);d.useEffect(()=>{const f=u.current;f!==p&&console.warn(`${o} is changing from ${f?"controlled":"uncontrolled"} to ${p?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),u.current=p},[p,o])}const l=d.useCallback(u=>{if(p){const f=qt(u)?u(t):u;f!==t&&h.current?.(f)}else c(u)},[p,t,c,h]);return[j,l]}function At({defaultProp:t,onChange:n}){const[a,o]=d.useState(t),i=d.useRef(a),c=d.useRef(n);return Pt(()=>{c.current=n},[n]),d.useEffect(()=>{i.current!==a&&(c.current?.(a),i.current=a)},[a,i]),[a,o,c]}function qt(t){return typeof t=="function"}var ke="Radio",[Tt,ps]=as(ke),[Ot,$t]=Tt(ke),xs=d.forwardRef((t,n)=>{const{__scopeRadio:a,name:o,checked:i=!1,required:c,disabled:h,value:p="on",onCheck:j,form:l,...u}=t,[f,w]=d.useState(null),b=Se(n,I=>w(I)),v=d.useRef(!1),S=f?l||!!f.closest("form"):!0;return e.jsxs(Ot,{scope:a,checked:i,disabled:h,children:[e.jsx(re.button,{type:"button",role:"radio","aria-checked":i,"data-state":js(i),"data-disabled":h?"":void 0,disabled:h,value:p,...u,ref:b,onClick:be(t.onClick,I=>{i||j?.(),S&&(v.current=I.isPropagationStopped(),v.current||I.stopPropagation())})}),S&&e.jsx(gs,{control:f,bubbles:!v.current,name:o,value:p,checked:i,required:c,disabled:h,form:l,style:{transform:"translateX(-100%)"}})]})});xs.displayName=ke;var hs="RadioIndicator",fs=d.forwardRef((t,n)=>{const{__scopeRadio:a,forceMount:o,...i}=t,c=$t(hs,a);return e.jsx(Js,{present:o||c.checked,children:e.jsx(re.span,{"data-state":js(c.checked),"data-disabled":c.disabled?"":void 0,...i,ref:n})})});fs.displayName=hs;var Gt="RadioBubbleInput",gs=d.forwardRef(({__scopeRadio:t,control:n,checked:a,bubbles:o=!0,...i},c)=>{const h=d.useRef(null),p=Se(h,c),j=at(a),l=Zs(n);return d.useEffect(()=>{const u=h.current;if(!u)return;const f=window.HTMLInputElement.prototype,b=Object.getOwnPropertyDescriptor(f,"checked").set;if(j!==a&&b){const v=new Event("click",{bubbles:o});b.call(u,a),u.dispatchEvent(v)}},[j,a,o]),e.jsx(re.input,{type:"radio","aria-hidden":!0,defaultChecked:a,...i,tabIndex:-1,ref:p,style:{...i.style,...l,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});gs.displayName=Gt;function js(t){return t?"checked":"unchecked"}var Lt=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],ne="RadioGroup",[Kt]=as(ne,[is,ps]),vs=is(),ys=ps(),[Ut,Qt]=Kt(ne),Ns=d.forwardRef((t,n)=>{const{__scopeRadioGroup:a,name:o,defaultValue:i,value:c,required:h=!1,disabled:p=!1,orientation:j,dir:l,loop:u=!0,onValueChange:f,...w}=t,b=vs(a),v=nt(l),[S,I]=Mt({prop:c,defaultProp:i??null,onChange:f,caller:ne});return e.jsx(Ut,{scope:a,name:o,required:h,disabled:p,value:S,onValueChange:I,children:e.jsx(tt,{asChild:!0,...b,orientation:j,dir:v,loop:u,children:e.jsx(re.div,{role:"radiogroup","aria-required":h,"aria-orientation":j,"data-disabled":p?"":void 0,dir:v,...w,ref:n})})})});Ns.displayName=ne;var bs="RadioGroupItem",_s=d.forwardRef((t,n)=>{const{__scopeRadioGroup:a,disabled:o,...i}=t,c=Qt(bs,a),h=c.disabled||o,p=vs(a),j=ys(a),l=d.useRef(null),u=Se(n,l),f=c.value===i.value,w=d.useRef(!1);return d.useEffect(()=>{const b=S=>{Lt.includes(S.key)&&(w.current=!0)},v=()=>w.current=!1;return document.addEventListener("keydown",b),document.addEventListener("keyup",v),()=>{document.removeEventListener("keydown",b),document.removeEventListener("keyup",v)}},[]),e.jsx(rt,{asChild:!0,...p,focusable:!h,active:f,children:e.jsx(xs,{disabled:h,required:c.required,checked:f,...j,...i,name:c.name,ref:u,onCheck:()=>c.onValueChange(i.value),onKeyDown:be(b=>{b.key==="Enter"&&b.preventDefault()}),onFocus:be(i.onFocus,()=>{w.current&&l.current?.click()})})})});_s.displayName=bs;var zt="RadioGroupIndicator",ws=d.forwardRef((t,n)=>{const{__scopeRadioGroup:a,...o}=t,i=ys(a);return e.jsx(fs,{...i,...o,ref:n})});ws.displayName=zt;var Ss=Ns,Cs=_s,Bt=ws;const Es=d.forwardRef(({className:t,...n},a)=>e.jsx(Ss,{className:U("grid gap-2",t),...n,ref:a}));Es.displayName=Ss.displayName;const _e=d.forwardRef(({className:t,...n},a)=>e.jsx(Cs,{ref:a,className:U("aspect-square h-4 w-4 rounded-full border border-primary text-primary shadow focus:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",t),...n,children:e.jsx(Bt,{className:"flex items-center justify-center",children:e.jsx(it,{className:"h-3.5 w-3.5 fill-primary"})})}));_e.displayName=Cs.displayName;function Vt({exercises:t,selectedId:n,onSelect:a}){const[o,i]=d.useState(!1),c=t.find(l=>l.id===n),h=t.filter(l=>l.exercise_type!=="warmup"),p=t.filter(l=>l.exercise_type==="warmup"),j=l=>{a(l),i(!1)};return e.jsxs(e.Fragment,{children:[e.jsxs("button",{type:"button",onClick:()=>i(!0),className:"flex w-full items-center gap-2 rounded-xl border border-input bg-background px-3 py-2 text-sm hover:bg-accent/50",children:[c?.illustration_gif?e.jsx("img",{src:c.illustration_gif,alt:"",className:"h-7 w-7 shrink-0 rounded-md object-cover"}):e.jsx("div",{className:"flex h-7 w-7 shrink-0 items-center justify-center rounded-md bg-muted",children:e.jsx(Ce,{className:"h-3.5 w-3.5 text-muted-foreground"})}),e.jsx("span",{className:"min-w-0 flex-1 truncate text-left font-medium",children:c?.nom_exercice??"Choisir un exercice"}),e.jsx(ms,{className:"h-4 w-4 shrink-0 text-muted-foreground"})]}),e.jsx(pt,{open:o,onOpenChange:i,children:e.jsxs(xt,{className:"max-h-[85vh]",children:[e.jsx(ht,{className:"pb-0",children:e.jsx(ft,{children:"Choisir un exercice"})}),e.jsxs(gt,{className:"mt-2",shouldFilter:!0,children:[e.jsx(jt,{placeholder:"Rechercher...",className:"h-12"}),e.jsxs(vt,{className:"max-h-[60vh] px-1 pb-safe",children:[e.jsx(yt,{children:"Aucun exercice trouvé"}),h.length>0&&e.jsx(Ye,{heading:"Travail",children:h.map(l=>e.jsx(es,{exercise:l,isSelected:l.id===n,onSelect:()=>j(l.id)},l.id))}),p.length>0&&e.jsx(Ye,{heading:"Échauffement",children:p.map(l=>e.jsx(es,{exercise:l,isSelected:l.id===n,onSelect:()=>j(l.id)},l.id))})]})]})]})})]})}function es({exercise:t,isSelected:n,onSelect:a}){return e.jsxs(Nt,{value:t.nom_exercice,onSelect:a,className:"flex items-center gap-3 rounded-xl px-2 py-2.5",children:[t.illustration_gif?e.jsx("img",{src:t.illustration_gif,alt:"",className:"h-9 w-9 shrink-0 rounded-lg object-cover",loading:"lazy",decoding:"async"}):e.jsx("div",{className:"flex h-9 w-9 shrink-0 items-center justify-center rounded-lg bg-muted",children:e.jsx(Ce,{className:"h-4 w-4 text-muted-foreground"})}),e.jsx("span",{className:"min-w-0 flex-1 truncate text-sm font-medium",children:t.nom_exercice}),n&&e.jsx(bt,{className:"h-4 w-4 shrink-0 text-primary"})]})}function Wt({exercise:t,exercises:n,exerciseFilter:a,index:o,totalItems:i,onChange:c,onDelete:h,onMoveUp:p,onMoveDown:j}){const[l,u]=d.useState(!1),[f,w]=d.useState(!1),b=n.filter(g=>a==="all"?!0:g.exercise_type===a),v=n.find(g=>g.id===t.exercise_id),S=v?.nom_exercice??"Exercice",I=v?.exercise_type==="warmup",y=v?.illustration_gif;return e.jsxs(e.Fragment,{children:[e.jsxs(et,{className:U("rounded-2xl border-border transition-all",l&&"ring-1 ring-primary/20"),children:[e.jsxs("button",{type:"button",className:"flex w-full items-center gap-3 p-3 text-left",onClick:()=>u(!l),children:[e.jsx("span",{className:"flex h-7 w-7 shrink-0 items-center justify-center rounded-full bg-muted text-xs font-bold text-muted-foreground",children:o+1}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"truncate text-sm font-semibold",children:S}),I&&e.jsx("span",{className:"shrink-0 rounded-full bg-amber-100 px-2 py-0.5 text-[10px] font-semibold text-amber-800",children:"Échauf."})]}),e.jsxs("div",{className:"mt-0.5 text-xs text-muted-foreground",children:[t.sets,"×",t.reps,t.percent_1rm?` @ ${t.percent_1rm}% 1RM`:"",t.rest_seconds?` · ${t.rest_seconds}s repos`:""]})]}),y&&e.jsx("button",{type:"button",className:"shrink-0 rounded-lg overflow-hidden border border-border bg-muted",onClick:g=>{g.stopPropagation(),w(!0)},children:e.jsx("img",{src:y,alt:S,className:"h-9 w-9 object-cover"})}),e.jsx(ms,{className:U("h-4 w-4 shrink-0 text-muted-foreground transition-transform",l&&"rotate-180")})]}),l&&e.jsxs("div",{className:"border-t border-border px-3 pb-3 pt-3 space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(_,{className:"text-xs",children:"Séries"}),e.jsx(R,{type:"number",inputMode:"numeric",value:t.sets===0?"":t.sets,onChange:g=>c("sets",g.target.value===""?0:Number(g.target.value)),className:"rounded-xl h-10"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(_,{className:"text-xs",children:"Reps"}),e.jsx(R,{type:"number",inputMode:"numeric",value:t.reps===0?"":t.reps,onChange:g=>c("reps",g.target.value===""?0:Number(g.target.value)),className:"rounded-xl h-10"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(_,{className:"text-xs",children:"% 1RM"}),e.jsx(R,{type:"number",inputMode:"numeric",value:t.percent_1rm===0?"":t.percent_1rm,onChange:g=>c("percent_1rm",g.target.value===""?0:Number(g.target.value)),className:"rounded-xl h-10"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(_,{className:"text-xs",children:"Repos (s)"}),e.jsx(R,{type:"number",inputMode:"numeric",value:t.rest_seconds===0?"":t.rest_seconds,onChange:g=>c("rest_seconds",g.target.value===""?0:Number(g.target.value)),className:"rounded-xl h-10"})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(_,{className:"text-xs",children:"Exercice"}),e.jsx(Vt,{exercises:b,selectedId:t.exercise_id,onSelect:g=>c("exercise_id",g)})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(_,{className:"text-xs",children:"Notes"}),e.jsx(Z,{value:t.notes??"",onChange:g=>c("notes",g.target.value||null),placeholder:"Notes optionnelles...",className:"rounded-xl min-h-[60px]"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{type:"button",onClick:g=>{g.stopPropagation(),p()},disabled:o===0,className:"inline-flex h-9 w-9 items-center justify-center rounded-full hover:bg-muted disabled:opacity-30","aria-label":"Monter",children:e.jsx(lt,{className:"h-4 w-4"})}),e.jsx("button",{type:"button",onClick:g=>{g.stopPropagation(),j()},disabled:o===i-1,className:"inline-flex h-9 w-9 items-center justify-center rounded-full hover:bg-muted disabled:opacity-30","aria-label":"Descendre",children:e.jsx(ct,{className:"h-4 w-4"})})]}),e.jsxs("button",{type:"button",onClick:g=>{g.stopPropagation(),h()},className:"inline-flex h-9 items-center gap-2 rounded-full px-3 text-xs font-medium text-destructive hover:bg-destructive/10",children:[e.jsx(Ee,{className:"h-3.5 w-3.5"}),"Supprimer"]})]})]})]}),y&&e.jsx(ee,{open:f,onOpenChange:w,children:e.jsx(se,{className:"sm:max-w-md p-2",children:e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx("img",{src:y,alt:S,className:"w-full max-h-[70vh] object-contain rounded-lg"}),e.jsx("p",{className:"text-sm font-medium text-center",children:S})]})})})]})}const Ht=t=>t==="endurance"||t==="hypertrophie"||t==="force"?t:"endurance";function Xt({session:t,exercises:n,editingSessionId:a,folders:o,onSessionChange:i,onCycleChange:c,onSave:h,onCancel:p,onAddItem:j,onUpdateItem:l,onRemoveItem:u,onReorderItems:f,onExerciseDialogOpen:w,isSaving:b}){const[v,S]=d.useState("all"),[I,y]=d.useState(!1),[g,B]=d.useState(!1),G=new Map(n.map(x=>[x.id,x])),Q=t.items.reduce((x,E)=>x+(E.sets||0),0),L=x=>{x>0&&f(x,x-1)},ae=x=>{x<t.items.length-1&&f(x,x+1)},z=()=>{y(!0)};return e.jsxs("div",{className:"space-y-4 animate-in slide-in-from-bottom-4",children:[e.jsx(ot,{isEditing:!!a,isSaving:b,onSave:h,onCancel:p,onPreview:z}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsx(dt,{name:t.title,onNameChange:x=>i({...t,title:x}),showDuration:!1,showTotalDistance:!1,collapsible:!0,collapsed:g,onToggleCollapse:()=>B(!g),collapsedSummary:e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsx("span",{className:"font-medium text-foreground",children:t.title||"Sans titre"}),e.jsx("span",{children:"·"}),e.jsx("span",{className:"capitalize",children:t.cycle}),e.jsx("span",{children:"·"}),e.jsxs("span",{children:[Q," séries"]})]}),additionalFields:e.jsxs(e.Fragment,{children:[o&&o.length>0&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-semibold text-muted-foreground",children:"Dossier"}),e.jsx("div",{className:"mt-1",children:e.jsxs(me,{value:t.folder_id?.toString()??"none",onValueChange:x=>i({...t,folder_id:x==="none"?null:parseInt(x)}),children:[e.jsx(pe,{className:"rounded-2xl",children:e.jsx(xe,{})}),e.jsxs(he,{children:[e.jsx(q,{value:"none",children:"Aucun"}),o.map(x=>e.jsx(q,{value:x.id.toString(),children:x.name},x.id))]})]})})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-semibold text-muted-foreground",children:"Cycle"}),e.jsx("div",{className:"mt-1",children:e.jsxs(me,{value:t.cycle,onValueChange:x=>c(Ht(x)),children:[e.jsx(pe,{className:"rounded-2xl",children:e.jsx(xe,{})}),e.jsxs(he,{children:[e.jsx(q,{value:"endurance",children:"Endurance"}),e.jsx(q,{value:"hypertrophie",children:"Hypertrophie"}),e.jsx(q,{value:"force",children:"Force"})]})]})})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-semibold text-muted-foreground",children:"Séries totales"}),e.jsx("div",{className:"mt-1 rounded-2xl border border-border bg-muted px-3 py-2 text-sm font-semibold",children:Q})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("div",{className:"text-xs font-semibold text-muted-foreground",children:"Description"}),e.jsx("div",{className:"mt-1",children:e.jsx(Z,{value:t.description,onChange:x=>i({...t,description:x.target.value}),placeholder:"Description optionnelle...",className:"rounded-2xl min-h-[60px]"})})]})]})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm font-semibold",children:["Exercices (",t.items.length,")"]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(me,{value:v,onValueChange:x=>S(x),children:[e.jsxs(pe,{className:"h-8 w-auto gap-1 rounded-full border-dashed text-xs",children:[e.jsx(Ft,{className:"h-3 w-3"}),e.jsx(xe,{})]}),e.jsxs(he,{children:[e.jsx(q,{value:"all",children:"Tous"}),e.jsx(q,{value:"strength",children:"Travail"}),e.jsx(q,{value:"warmup",children:"Échauf."})]})]})})]}),e.jsx("div",{className:"space-y-2",children:t.items.map((x,E)=>e.jsx(Wt,{exercise:x,exercises:n,exerciseFilter:v,index:E,totalItems:t.items.length,onChange:(T,V)=>l(E,T,V),onDelete:()=>u(E),onMoveUp:()=>L(E),onMoveDown:()=>ae(E)},`${x.exercise_id}-${E}`))}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs("button",{type:"button",onClick:j,className:"inline-flex items-center gap-2 rounded-full bg-primary px-4 py-2 text-xs font-semibold text-primary-foreground",children:[e.jsx(te,{className:"h-4 w-4"})," Ajouter un exercice"]}),e.jsxs("button",{type:"button",onClick:w,className:"inline-flex items-center gap-2 rounded-full border border-border px-4 py-2 text-xs font-semibold hover:bg-muted",children:[e.jsx(te,{className:"h-4 w-4"})," Nouvel exercice"]})]})]}),e.jsx(ee,{open:I,onOpenChange:y,children:e.jsxs(se,{className:"sm:max-w-3xl",children:[e.jsx(je,{children:e.jsx(ve,{children:"Aperçu de la séance"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-lg font-semibold",children:t.title||"Sans titre"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:t.description||"—"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Cycle : ",t.cycle]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm font-semibold",children:"Exercices"}),e.jsx("div",{className:"space-y-2",children:t.items.slice().sort((x,E)=>(x.order_index??0)-(E.order_index??0)).map((x,E)=>{const T=G.get(x.exercise_id);return e.jsxs("div",{className:"rounded-xl border px-3 py-2 text-sm",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("span",{className:"font-medium",children:[E+1,". ",T?.nom_exercice??"Exercice"]}),e.jsx("span",{className:"text-xs text-muted-foreground",children:T?.exercise_type==="warmup"?"Échauffement":"Travail"})]}),e.jsxs("div",{className:"mt-1 text-xs text-muted-foreground",children:[x.sets," séries • ",x.reps," reps • ",x.percent_1rm,"% 1RM •"," ",x.rest_seconds,"s"]})]},`${x.exercise_id}-${E}`)})})]})]})]})})]})}function ss({name:t,count:n,children:a,onRename:o,onDelete:i,defaultOpen:c=!1}){const[h,p]=d.useState(c),[j,l]=d.useState(!1),[u,f]=d.useState(t),[w,b]=d.useState(!1),v=d.useRef(null);d.useEffect(()=>{j&&(v.current?.focus(),v.current?.select())},[j]);const S=()=>{const y=u.trim();y&&y!==t?o(y):f(t),l(!1)},I=()=>{f(t),l(!1)};return e.jsxs("div",{children:[e.jsxs("div",{className:U("flex items-center gap-1 rounded-xl px-2 py-1.5 cursor-pointer select-none hover:bg-muted/50"),onClick:()=>{j||p(y=>!y)},children:[e.jsx(_t,{className:U("h-4 w-4 shrink-0 text-muted-foreground transition-transform",h&&"rotate-90")}),j?e.jsx(R,{ref:v,className:"h-7 text-sm rounded-lg flex-1",value:u,onChange:y=>f(y.target.value),onClick:y=>y.stopPropagation(),onKeyDown:y=>{y.stopPropagation(),y.key==="Enter"&&S(),y.key==="Escape"&&I()},onBlur:S}):e.jsx("span",{className:"text-sm font-semibold truncate",children:t}),!j&&e.jsxs("span",{className:"text-xs text-muted-foreground",children:["(",n,")"]}),e.jsx("div",{className:"flex-1"}),e.jsxs(os,{open:w,onOpenChange:b,children:[e.jsx(ds,{asChild:!0,children:e.jsx("button",{className:"h-7 w-7 shrink-0 inline-flex items-center justify-center rounded-full hover:bg-muted",onClick:y=>{y.stopPropagation()},children:e.jsx(Rt,{className:"h-4 w-4 text-muted-foreground"})})}),e.jsxs(us,{align:"end",className:"w-40 p-1",onClick:y=>y.stopPropagation(),children:[e.jsxs("button",{className:"flex w-full items-center gap-2 rounded-md px-2 py-1.5 text-sm hover:bg-muted",onClick:()=>{b(!1),f(t),l(!0)},children:[e.jsx(wt,{className:"h-4 w-4"}),"Rename"]}),e.jsxs("button",{className:"flex w-full items-center gap-2 rounded-md px-2 py-1.5 text-sm text-destructive hover:bg-muted",onClick:()=>{b(!1),i()},children:[e.jsx(Ee,{className:"h-4 w-4"}),"Delete"]})]})]})]}),h&&e.jsx("div",{className:"ml-4",children:a})]})}function fe({folders:t,currentFolderId:n,onMove:a,children:o}){const[i,c]=d.useState(!1);function h(p){a(p),c(!1)}return e.jsxs(os,{open:i,onOpenChange:c,children:[e.jsx(ds,{asChild:!0,children:o??e.jsx("button",{className:"flex h-9 w-9 items-center justify-center rounded-full hover:bg-muted","aria-label":"Déplacer",title:"Déplacer vers un dossier",children:e.jsx(ut,{className:"h-4 w-4"})})}),e.jsxs(us,{className:"w-44 p-1",align:"end",children:[e.jsx("button",{className:"flex w-full items-center gap-2 rounded-md px-2 py-1.5 text-sm hover:bg-muted",style:{fontWeight:n?void 0:"bold"},onClick:()=>h(null),children:"Aucun dossier"}),t.map(p=>e.jsx("button",{className:"flex w-full items-center gap-2 rounded-md px-2 py-1.5 text-sm hover:bg-muted",style:{fontWeight:n===p.id?"bold":void 0},onClick:()=>h(p.id),children:p.name},p.id))]})]})}const ts=[{key:"endurance",label:"Endurance",fieldSuffix:"endurance"},{key:"hypertrophie",label:"Hypertrophie",fieldSuffix:"hypertrophie"},{key:"force",label:"Force",fieldSuffix:"force"}],Yt=t=>t==="endurance"||t==="hypertrophie"||t==="force"?t:"endurance",rs=({exercise:t,onChange:n,disabled:a=!1})=>e.jsxs(ls,{defaultValue:"endurance",className:"w-full",children:[e.jsx(cs,{className:"grid w-full grid-cols-3",children:ts.map(o=>e.jsx(ye,{value:o.key,children:o.label},o.key))}),ts.map(o=>{const i=`pct_1rm_${o.fieldSuffix}`,c=`Nb_series_${o.fieldSuffix}`,h=`Nb_reps_${o.fieldSuffix}`,p=`recup_${o.fieldSuffix}`,j=`recup_exercices_${o.fieldSuffix}`;return e.jsxs(Ne,{value:o.key,className:`space-y-3 rounded-lg border p-3 ${a?"opacity-60":""}`,children:[e.jsx("p",{className:"text-sm font-semibold",children:o.label}),e.jsxs("div",{className:"grid gap-3 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(_,{children:"% 1RM"}),e.jsx(R,{type:"number",value:t[i]??"",disabled:a,onChange:l=>n({[i]:l.target.value===""?null:Number(l.target.value)})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(_,{children:"Nb séries"}),e.jsx(R,{type:"number",value:t[c]??"",disabled:a,onChange:l=>n({[c]:l.target.value===""?null:Number(l.target.value)})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(_,{children:"Nb reps"}),e.jsx(R,{type:"number",value:t[h]??"",disabled:a,onChange:l=>n({[h]:l.target.value===""?null:Number(l.target.value)})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(_,{children:"Récup. séries (s)"}),e.jsx(R,{type:"number",value:t[p]??"",disabled:a,onChange:l=>n({[p]:l.target.value===""?null:Number(l.target.value)})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(_,{children:"Récup. exercices (s)"}),e.jsx(R,{type:"number",value:t[j]??"",disabled:a,onChange:l=>n({[j]:l.target.value===""?null:Number(l.target.value)})})]})]})]},o.key)})]}),Jt={pct_1rm_endurance:60,pct_1rm_hypertrophie:75,pct_1rm_force:85,Nb_series_endurance:4,Nb_series_hypertrophie:3,Nb_series_force:3,Nb_reps_endurance:16,Nb_reps_hypertrophie:8,Nb_reps_force:3,recup_endurance:120,recup_hypertrophie:200,recup_force:300,recup_exercices_endurance:300,recup_exercices_hypertrophie:400,recup_exercices_force:500},J=t=>{const n=Number(t);return Number.isFinite(n)?n:0},ge=(t,n,a,o)=>{const i=n==="force"?"force":n==="hypertrophie"?"hypertrophie":"endurance",c=`Nb_series_${i}`,h=`Nb_reps_${i}`,p=`pct_1rm_${i}`,j=`recup_${i}`;return{exercise_id:t.id,order_index:a,sets:J(t[c]),reps:J(t[h]),rest_seconds:J(t[j]),percent_1rm:J(t[p]),cycle_type:n,notes:o?.notes??""}},Zt=()=>({nom_exercice:"",description:null,illustration_gif:null,exercise_type:"strength",warmup_reps:null,warmup_duration:null,...Jt}),ns=({exercise:t,warmupMode:n,onChange:a,onWarmupModeChange:o,idPrefix:i})=>e.jsxs("div",{className:"space-y-3 rounded-lg border p-3",children:[e.jsx("p",{className:"text-sm font-semibold",children:"Paramètres d'échauffement"}),e.jsxs(Es,{value:n,onValueChange:c=>{o(c==="duration"?"duration":"reps"),a(c==="duration"?{warmup_reps:null,warmup_duration:t.warmup_duration??0}:{warmup_duration:null,warmup_reps:t.warmup_reps??0})},className:"grid gap-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(_e,{value:"reps",id:`${i}-warmup-reps`}),e.jsx(_,{htmlFor:`${i}-warmup-reps`,children:"Nombre de répétitions"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(_e,{value:"duration",id:`${i}-warmup-duration`}),e.jsx(_,{htmlFor:`${i}-warmup-duration`,children:"Durée (secondes)"})]})]}),n==="duration"?e.jsxs("div",{className:"space-y-2",children:[e.jsx(_,{children:"Durée (s)"}),e.jsx(R,{type:"number",value:t.warmup_duration??"",onChange:c=>a({warmup_duration:c.target.value===""?null:Number(c.target.value)})})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsx(_,{children:"Nombre de répétitions"}),e.jsx(R,{type:"number",value:t.warmup_reps??"",onChange:c=>a({warmup_reps:c.target.value===""?null:Number(c.target.value)})})]})]});function zr(){const{toast:t}=st(),n=Xs(),[a,o]=d.useState(!1),[i,c]=d.useState(null),[h,p]=d.useState(!1),[j,l]=d.useState(!1),[u,f]=d.useState(null),[w,b]=d.useState(null),[v,S]=d.useState(null),[I,y]=d.useState("reps"),[g,B]=d.useState("reps"),[G,Q]=d.useState(!1),[L,ae]=d.useState(""),[z,x]=d.useState("sessions"),[E,T]=d.useState(null),V=async(s,r)=>{if(s.size>10485760){t({title:"Fichier trop volumineux",description:"La taille maximale est de 10 Mo.",variant:"destructive"});return}Q(!0);try{const N=s.name.split(".").pop()??"gif",C=`exercises/${Date.now()}-${Math.random().toString(36).slice(2)}.${N}`,{error:K}=await Ge.storage.from("exercise-gifs").upload(C,s,{upsert:!1});if(K)throw K;const{data:Ws}=Ge.storage.from("exercise-gifs").getPublicUrl(C);r(Ws.publicUrl),t({title:"Image uploadée"})}catch(N){const C=N instanceof Error?N.message:"Réessayez.";t({title:"Erreur d'upload",description:C,variant:"destructive"})}finally{Q(!1)}},[D,P]=d.useState({title:"",description:"",cycle:"endurance",items:[],folder_id:null}),[k,O]=d.useState({...Zt()});d.useEffect(()=>{u&&B(u.warmup_duration!=null?"duration":"reps")},[u]);const{data:A,isLoading:ks,error:ie,refetch:Rs}=Y({queryKey:["exercises"],queryFn:()=>F.getExercises()}),{data:W,isLoading:Ds,error:Fs,refetch:er}=Y({queryKey:["strength_catalog"],queryFn:()=>F.getStrengthSessions()}),{data:H}=Y({queryKey:["strength_folders","session"],queryFn:()=>F.getStrengthFolders("session")}),{data:Re}=Y({queryKey:["strength_folders","exercise"],queryFn:()=>F.getStrengthFolders("exercise")}),De=s=>{const r=s.items?.reduce((m,N)=>m+(N.sets||0),0)??0;return e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"capitalize",children:s.cycle}),e.jsx("span",{children:"·"}),e.jsxs("span",{children:[s.items?.length??0," exos"]}),e.jsx("span",{children:"·"}),e.jsxs("span",{children:[r," séries"]})]})},le=d.useMemo(()=>{if(!W)return[];if(!L.trim())return W;const s=L.toLowerCase();return W.filter(r=>r.title?.toLowerCase().includes(s))},[W,L]),Is=le.filter(s=>!s.folder_id),Ps=d.useMemo(()=>{const s=new Map;for(const r of le)if(r.folder_id){const m=s.get(r.folder_id)??[];m.push(r),s.set(r.folder_id,m)}return s},[le]),Ms=d.useMemo(()=>(A??[]).filter(s=>!s.folder_id),[A]),As=d.useMemo(()=>{const s=new Map;for(const r of A??[])if(r.folder_id){const m=s.get(r.folder_id)??[];m.push(r),s.set(r.folder_id,m)}return s},[A]),qs=M({mutationFn:s=>F.createExercise(s),onSuccess:()=>{n.invalidateQueries({queryKey:["exercises"]}),p(!1),t({title:"Exercice ajouté"})}}),Fe=M({mutationFn:s=>F.createStrengthSession(s),onSuccess:()=>{n.invalidateQueries({queryKey:["strength_catalog"]}),o(!1),P({title:"",description:"",cycle:"endurance",items:[],folder_id:null}),t({title:"Séance créée avec succès"})}}),Ts=M({mutationFn:s=>F.updateExercise(s),onSuccess:()=>{n.invalidateQueries({queryKey:["exercises"]}),n.invalidateQueries({queryKey:["strength_catalog"]}),l(!1),f(null),t({title:"Exercice mis à jour"})}}),Os=M({mutationFn:s=>F.deleteExercise(s),onSuccess:()=>{n.invalidateQueries({queryKey:["exercises"]}),n.invalidateQueries({queryKey:["strength_catalog"]}),S(null),t({title:"Exercice supprimé"})}}),ce=M({mutationFn:s=>F.deleteStrengthSession(s),onSuccess:()=>{n.invalidateQueries({queryKey:["strength_catalog"]}),b(null),t({title:"Séance supprimée"})}}),Ie=M({mutationFn:s=>F.updateStrengthSession(s),onSuccess:()=>{n.invalidateQueries({queryKey:["strength_catalog"]}),o(!1),c(null),P({title:"",description:"",cycle:"endurance",items:[],folder_id:null}),t({title:"Séance mise à jour"})}}),$s=M({mutationFn:s=>F.persistStrengthSessionOrder(s)}),Gs=M({mutationFn:({name:s,type:r})=>F.createStrengthFolder(s,r),onSuccess:()=>{n.invalidateQueries({queryKey:["strength_folders"]}),t({title:"Dossier créé"})}}),Pe=M({mutationFn:({id:s,name:r})=>F.renameStrengthFolder(s,r),onSuccess:()=>{n.invalidateQueries({queryKey:["strength_folders"]}),t({title:"Dossier renommé"})}}),Me=M({mutationFn:s=>F.deleteStrengthFolder(s),onSuccess:()=>{n.invalidateQueries({queryKey:["strength_folders"]}),n.invalidateQueries({queryKey:["strength_catalog"]}),n.invalidateQueries({queryKey:["exercises"]}),t({title:"Dossier supprimé"})}}),oe=M({mutationFn:({itemId:s,folderId:r,table:m})=>F.moveToFolder(s,r,m),onSuccess:()=>{n.invalidateQueries({queryKey:["strength_catalog"]}),n.invalidateQueries({queryKey:["exercises"]}),t({title:"Déplacé"})}}),Ls=()=>{o(!1),c(null),P({title:"",description:"",cycle:"endurance",items:[],folder_id:null})},X=s=>{c(s.id),P({title:s.title??"",description:s.description??"",cycle:Yt(s.cycle),items:s.items?.map(r=>({exercise_id:r.exercise_id,order_index:r.order_index??0,sets:r.sets,reps:r.reps,rest_seconds:r.rest_seconds,percent_1rm:r.percent_1rm,cycle_type:r.cycle_type,notes:r.notes??""}))??[],folder_id:s.folder_id??null}),o(!0)},Ks=s=>{f(s),l(!0)},Us=()=>{const s={...D,items:de(D.items)};i?Ie.mutate({...s,id:i}):Fe.mutate(s)},de=s=>s.map((r,m)=>({...r,order_index:m})),Qs=()=>{const s=A?.[0];P(r=>({...r,items:[...r.items,s?ge(s,r.cycle,r.items.length):{exercise_id:1,order_index:r.items.length,sets:0,reps:0,rest_seconds:0,percent_1rm:0}]}))},zs=(s,r,m)=>{const N=[...D.items];if(r==="exercise_id"){const C=A?.find(K=>K.id===m);C?N[s]=ge(C,D.cycle,N[s].order_index??s,N[s]):N[s]={...N[s],exercise_id:Number(m)}}else N[s]={...N[s],[r]:m};P({...D,items:N})},Bs=s=>{const r=de(D.items.filter((m,N)=>N!==s));P({...D,items:r})},Vs=(s,r)=>{if(s===r)return;const m=[...D.items],[N]=m.splice(s,1);m.splice(r,0,N);const C=de(m);P({...D,items:C}),i&&$s.mutate({id:i,title:D.title,description:D.description,cycle:D.cycle,items:C})},Ae=e.jsx(ee,{open:j,onOpenChange:l,children:e.jsxs(se,{className:"sm:max-w-3xl max-h-[85vh] overflow-y-auto pb-safe",children:[e.jsx(je,{children:e.jsx(ve,{children:"Modifier l'exercice"})}),u&&e.jsxs("div",{className:"space-y-4",children:[u.exercise_type==="warmup"?e.jsx(ns,{exercise:u,warmupMode:g,onChange:s=>f(r=>r&&{...r,...s}),onWarmupModeChange:B,idPrefix:"edit"}):null,e.jsxs("div",{className:"space-y-2",children:[e.jsx(_,{children:"Nom"}),e.jsx(R,{value:u.nom_exercice,onChange:s=>f({...u,nom_exercice:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(_,{children:"Description"}),e.jsx(Z,{value:u.description??"",onChange:s=>f({...u,description:s.target.value===""?null:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(_,{children:"Illustration (GIF)"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(R,{value:u.illustration_gif??"",onChange:s=>f({...u,illustration_gif:s.target.value===""?null:s.target.value}),placeholder:"https://...",className:"flex-1"}),e.jsx($,{type:"button",variant:"outline",size:"icon",disabled:G,onClick:()=>{const s=document.createElement("input");s.type="file",s.accept="image/*,.gif",s.onchange=r=>{const m=r.target.files?.[0];m&&V(m,N=>f(C=>C&&{...C,illustration_gif:N}))},s.click()},"aria-label":"Uploader une image",children:G?e.jsx(Je,{className:"h-4 w-4 animate-spin"}):e.jsx(Ze,{className:"h-4 w-4"})})]}),u.illustration_gif&&e.jsx("img",{src:u.illustration_gif,alt:"Aperçu",className:"mt-2 h-20 w-20 rounded-lg object-cover border"})]}),u.exercise_type!=="warmup"?e.jsx(rs,{exercise:u,onChange:s=>f(r=>r&&{...r,...s})}):null,e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Le,{id:"warmup-flag-edit",checked:u.exercise_type==="warmup",onCheckedChange:s=>f({...u,exercise_type:s===!0?"warmup":"strength"})}),e.jsx(_,{htmlFor:"warmup-flag-edit",children:"Exercice d'échauffement (warmup)"})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx($,{variant:"outline",onClick:()=>{l(!1),f(null)},className:"h-10",children:"Annuler"}),e.jsx($,{variant:"default",onClick:()=>{u?.id&&Ts.mutate(u)},disabled:!u.nom_exercice.trim(),className:"h-10",children:"Enregistrer"})]})]})]})}),qe=e.jsx(ee,{open:h,onOpenChange:p,children:e.jsxs(se,{className:"sm:max-w-3xl max-h-[85vh] overflow-y-auto pb-safe",children:[e.jsx(je,{children:e.jsx(ve,{children:"Créer un exercice"})}),e.jsxs("div",{className:"space-y-4",children:[k.exercise_type==="warmup"?e.jsx(ns,{exercise:k,warmupMode:I,onChange:s=>O(r=>({...r,...s})),onWarmupModeChange:y,idPrefix:"create"}):null,e.jsxs("div",{className:"space-y-2",children:[e.jsx(_,{children:"Nom"}),e.jsx(R,{value:k.nom_exercice,onChange:s=>O({...k,nom_exercice:s.target.value}),placeholder:"ex: Rotations Élastique"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(_,{children:"Description"}),e.jsx(Z,{value:k.description??"",onChange:s=>O({...k,description:s.target.value===""?null:s.target.value}),placeholder:"Détails, consignes..."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(_,{children:"Illustration (GIF)"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(R,{value:k.illustration_gif??"",onChange:s=>O({...k,illustration_gif:s.target.value===""?null:s.target.value}),placeholder:"https://...",className:"flex-1"}),e.jsx($,{type:"button",variant:"outline",size:"icon",disabled:G,onClick:()=>{const s=document.createElement("input");s.type="file",s.accept="image/*,.gif",s.onchange=r=>{const m=r.target.files?.[0];m&&V(m,N=>O(C=>({...C,illustration_gif:N})))},s.click()},"aria-label":"Uploader une image",children:G?e.jsx(Je,{className:"h-4 w-4 animate-spin"}):e.jsx(Ze,{className:"h-4 w-4"})})]}),k.illustration_gif&&e.jsx("img",{src:k.illustration_gif,alt:"Aperçu",className:"mt-2 h-20 w-20 rounded-lg object-cover border"})]}),k.exercise_type!=="warmup"?e.jsx(rs,{exercise:k,onChange:s=>O(r=>({...r,...s}))}):null,e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Le,{id:"warmup-flag",checked:k.exercise_type==="warmup",onCheckedChange:s=>O({...k,exercise_type:s===!0?"warmup":"strength"})}),e.jsx(_,{htmlFor:"warmup-flag",children:"Exercice d'échauffement (warmup)"})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx($,{variant:"outline",onClick:()=>p(!1),className:"h-10",children:"Annuler"}),e.jsx($,{variant:"default",onClick:()=>qs.mutate(k),disabled:!k.nom_exercice.trim(),className:"h-10",children:"Enregistrer"})]})]})]})}),Te=e.jsx(Ke,{open:!!w,onOpenChange:s=>{s||b(null)},children:e.jsxs(Ue,{children:[e.jsxs(Qe,{children:[e.jsx(ze,{children:"Supprimer la séance ?"}),e.jsxs(Be,{children:['Cette action est définitive. La séance "',w?.title,'" sera supprimée.']})]}),e.jsxs(Ve,{children:[e.jsx(We,{children:"Annuler"}),e.jsx(He,{onClick:()=>{w?.id&&ce.mutate(w.id)},children:"Supprimer"})]})]})}),Oe=e.jsx(Ke,{open:!!v,onOpenChange:s=>{s||S(null)},children:e.jsxs(Ue,{children:[e.jsxs(Qe,{children:[e.jsx(ze,{children:"Supprimer l'exercice ?"}),e.jsxs(Be,{children:[`Cette action est définitive. L'exercice "`,v?.nom_exercice,'" sera supprimé.']})]}),e.jsxs(Ve,{children:[e.jsx(We,{children:"Annuler"}),e.jsx(He,{onClick:()=>{v?.id&&Os.mutate(v.id)},children:"Supprimer"})]})]})});if(a)return e.jsxs(e.Fragment,{children:[qe,Ae,Te,Oe,e.jsx(Xt,{session:D,exercises:A??[],editingSessionId:i,folders:H,onSessionChange:P,onCycleChange:s=>{const r=D.items.map((m,N)=>{const C=A?.find(K=>K.id===m.exercise_id);return C?ge(C,s,N,m):{...m,cycle_type:s}});P({...D,cycle:s,items:r})},onSave:Us,onCancel:Ls,onAddItem:Qs,onUpdateItem:zs,onRemoveItem:Bs,onReorderItems:Vs,onExerciseDialogOpen:()=>p(!0),isSaving:Fe.isPending||Ie.isPending})]});if(ks)return e.jsxs("div",{className:"space-y-4 p-4",children:[e.jsx(ue,{className:"h-7 w-64"}),e.jsx(ue,{className:"h-10 w-full rounded-2xl"}),e.jsx("div",{className:"space-y-3",children:Array.from({length:4}).map((s,r)=>e.jsx(ue,{className:"h-20 w-full rounded-2xl"},r))})]});if(ie)return e.jsxs("div",{className:"flex flex-col items-center justify-center p-8 text-center",children:[e.jsx(St,{className:"h-12 w-12 text-destructive mb-4"}),e.jsx("h3",{className:"font-semibold",children:"Impossible de charger les données"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:ie instanceof Error?ie.message:"Une erreur s'est produite"}),e.jsx($,{variant:"default",onClick:()=>Rs(),className:"mt-4 h-12 md:h-10",children:"Réessayer"})]});const $e=s=>e.jsxs("div",{className:"flex items-center gap-3 rounded-xl px-3 py-2 hover:bg-muted/50",children:[s.illustration_gif?e.jsx("button",{type:"button",className:"shrink-0 rounded-lg overflow-hidden border border-border bg-muted",onClick:()=>T({url:s.illustration_gif,name:s.nom_exercice}),children:e.jsx("img",{src:s.illustration_gif,alt:s.nom_exercice,className:"h-10 w-10 object-cover",loading:"lazy",decoding:"async"})}):e.jsx("div",{className:"flex h-10 w-10 shrink-0 items-center justify-center rounded-lg bg-muted",children:e.jsx(Ce,{className:"h-4 w-4 text-muted-foreground"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("div",{className:"truncate text-sm font-medium",children:s.nom_exercice}),e.jsx("div",{className:"text-xs text-muted-foreground",children:s.exercise_type==="warmup"?"Échauffement":"Séries de travail"})]}),e.jsxs("div",{className:"flex shrink-0 items-center gap-1",children:[e.jsx(fe,{folders:Re??[],currentFolderId:s.folder_id,onMove:r=>oe.mutate({itemId:s.id,folderId:r,table:"dim_exercices"})}),e.jsx("button",{type:"button",onClick:()=>Ks(s),className:"inline-flex h-9 w-9 items-center justify-center rounded-full hover:bg-muted","aria-label":"Modifier",children:e.jsx(Et,{className:"h-4 w-4"})}),e.jsx("button",{type:"button",onClick:()=>S(s),className:"inline-flex h-9 w-9 items-center justify-center rounded-full text-destructive hover:bg-destructive/10","aria-label":"Supprimer",children:e.jsx(Ee,{className:"h-4 w-4"})})]})]},s.id);return e.jsxs("div",{children:[qe,Ae,Te,Oe,E&&e.jsx("div",{className:"fixed inset-0 z-50 bg-black/60 flex items-center justify-center p-4",onClick:()=>T(null),children:e.jsxs("div",{className:"relative max-w-md w-full",onClick:s=>s.stopPropagation(),children:[e.jsx("img",{src:E.url,alt:E.name,className:"w-full max-h-[80vh] object-contain rounded-2xl"}),e.jsx("p",{className:"mt-2 text-sm font-medium text-center text-white",children:E.name})]})}),e.jsxs("div",{className:"flex items-center justify-between border-b border-border px-4 py-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-base font-semibold",children:"Musculation"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Catalogue"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{type:"button",onClick:()=>{const s=prompt("Nom du dossier");s?.trim()&&Gs.mutate({name:s.trim(),type:z==="sessions"?"session":"exercise"})},className:"inline-flex items-center gap-2 rounded-full border border-border px-3 py-2 text-xs font-semibold hover:bg-muted",children:[e.jsx(mt,{className:"h-4 w-4"})," Dossier"]}),z==="sessions"?e.jsxs("button",{type:"button",onClick:()=>{c(null),P({title:"",description:"",cycle:"endurance",items:[],folder_id:null}),o(!0)},className:"inline-flex items-center gap-2 rounded-full bg-primary px-3 py-2 text-xs font-semibold text-primary-foreground",children:[e.jsx(te,{className:"h-4 w-4"})," Nouvelle"]}):e.jsxs("button",{type:"button",onClick:()=>p(!0),className:"inline-flex items-center gap-2 rounded-full bg-primary px-3 py-2 text-xs font-semibold text-primary-foreground",children:[e.jsx(te,{className:"h-4 w-4"})," Ajouter"]})]})]}),e.jsx("div",{className:"p-4 space-y-4",children:e.jsxs(ls,{value:z,onValueChange:s=>x(s),children:[e.jsxs(cs,{className:"grid w-full grid-cols-2",children:[e.jsx(ye,{value:"sessions",children:"Séances"}),e.jsxs(ye,{value:"exercises",children:["Exercices (",A?.length??0,")"]})]}),e.jsxs(Ne,{value:"sessions",className:"space-y-4 mt-4",children:[e.jsxs("div",{className:"flex items-center gap-2 rounded-2xl border border-border bg-card px-3 py-2",children:[e.jsx(Ct,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("input",{className:"w-full bg-transparent text-sm outline-none placeholder:text-muted-foreground",placeholder:"Rechercher une séance",value:L,onChange:s=>ae(s.target.value)})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(Xe,{sessions:Is,isLoading:Ds,error:Fs,renderTitle:s=>s.title??"Sans titre",renderMetrics:De,renderExtraActions:s=>e.jsx(fe,{folders:H??[],currentFolderId:s.folder_id,onMove:r=>oe.mutate({itemId:s.id,folderId:r,table:"strength_sessions"})}),onPreview:s=>X(s),onEdit:s=>X(s),onDelete:s=>b(s),canDelete:()=>!0,isDeleting:ce.isPending}),H?.map(s=>{const r=Ps.get(s.id)??[];return e.jsx(ss,{name:s.name,count:r.length,onRename:m=>Pe.mutate({id:s.id,name:m}),onDelete:()=>Me.mutate(s.id),children:r.length>0?e.jsx(Xe,{sessions:r,renderTitle:m=>m.title??"Sans titre",renderMetrics:De,renderExtraActions:m=>e.jsx(fe,{folders:H??[],currentFolderId:m.folder_id,onMove:N=>oe.mutate({itemId:m.id,folderId:N,table:"strength_sessions"})}),onPreview:m=>X(m),onEdit:m=>X(m),onDelete:m=>b(m),canDelete:()=>!0,isDeleting:ce.isPending}):e.jsx("div",{className:"rounded-xl border border-dashed border-border px-3 py-4 text-center text-xs text-muted-foreground",children:"Dossier vide"})},s.id)})]})]}),e.jsxs(Ne,{value:"exercises",className:"space-y-3 mt-4",children:[e.jsx("div",{className:"space-y-1",children:Ms.map($e)}),Re?.map(s=>{const r=As.get(s.id)??[];return e.jsx(ss,{name:s.name,count:r.length,onRename:m=>Pe.mutate({id:s.id,name:m}),onDelete:()=>Me.mutate(s.id),children:r.length>0?e.jsx("div",{className:"space-y-1",children:r.map($e)}):e.jsx("div",{className:"rounded-xl border border-dashed border-border px-3 py-4 text-center text-xs text-muted-foreground",children:"Dossier vide"})},s.id)})]})]})})]})}export{ge as createStrengthItemFromExercise,zr as default};
