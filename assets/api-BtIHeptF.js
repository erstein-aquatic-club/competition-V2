import{s as a,u as ue}from"./index-CmT0igch.js";import{b as v,c as L,n as $,d as N,e as D,f as k,h as c,l as h,S as _,j as q,k as I,m as de,o as Y,p as V,q as J,v as le,i as j,r as K,t as me,u as Q,w as B,a as _e,g as fe,x as ge,y as pe,z as we,A as he,C as Se}from"./swim-yZ4Uojp_.js";const W=e=>({id:N(e.id),numero_exercice:v(e.numero_exercice??e.numero),nom_exercice:e.nom_exercice??e.name??"",description:e.description??null,illustration_gif:e.illustration_gif??null,exercise_type:$(e.exercise_type??e.type??(e.is_warmup?"warmup":"strength")),warmup_reps:v(e.warmup_reps),warmup_duration:v(e.warmup_duration),Nb_series_endurance:v(e.Nb_series_endurance),Nb_reps_endurance:v(e.Nb_reps_endurance),pct_1rm_endurance:L(e.pct_1rm_endurance),recup_endurance:v(e.recup_endurance),recup_exercices_endurance:v(e.recup_exercices_endurance),Nb_series_hypertrophie:v(e.Nb_series_hypertrophie),Nb_reps_hypertrophie:v(e.Nb_reps_hypertrophie),pct_1rm_hypertrophie:L(e.pct_1rm_hypertrophie),recup_hypertrophie:v(e.recup_hypertrophie),recup_exercices_hypertrophie:v(e.recup_exercices_hypertrophie),Nb_series_force:v(e.Nb_series_force),Nb_reps_force:v(e.Nb_reps_force),pct_1rm_force:L(e.pct_1rm_force),recup_force:v(e.recup_force),recup_exercices_force:v(e.recup_exercices_force)}),ye=e=>{const t={athlete_name:e.athlete_name,session_date:e.date,time_slot:e.slot,distance:e.distance,duration:e.duration,rpe:k(e.effort),performance:k(e.performance??e.feeling),engagement:k(e.engagement??e.feeling),fatigue:k(e.feeling),comments:e.comments};return e.athlete_id!==null&&e.athlete_id!==void 0&&String(e.athlete_id)!==""&&(t.athlete_id=e.athlete_id),e.stroke_distances&&(t.stroke_distances=e.stroke_distances),t},Ee=e=>{if(!e)return null;const t=String(e.athlete_name||"").trim(),r=String(e.session_date||e.date||"").trim();if(!t||!r)return null;const s=D(v(e.rpe??e.effort)),n=D(v(e.performance??e.feeling)),i=D(v(e.engagement??e.feeling)),o=D(v(e.fatigue??e.feeling)),u=s??3,d=D(v(e.performance??e.engagement??e.fatigue??e.feeling))??3;return{id:N(e.id,Date.now()),athlete_id:e.athlete_id?N(e.athlete_id):void 0,athlete_name:t,date:r,slot:String(e.time_slot||e.slot||""),effort:u,feeling:d,rpe:s,performance:n,engagement:i,fatigue:o,distance:N(e.distance,0),duration:N(e.duration,0),comments:e.comments||"",stroke_distances:e.stroke_distances??null,created_at:e.created_at||e.updated_at||new Date().toISOString()}};async function be(e){if(!c())return null;let t=a.from("user_profiles").select("*");e.userId?t=t.eq("user_id",e.userId):e.displayName&&(t=t.eq("display_name",e.displayName));const{data:r,error:s}=await t.maybeSingle();if(s)throw new Error(s.message);return r?{id:r.user_id??null,display_name:r.display_name??null,email:r.email??null,birthdate:r.birthdate??null,group_id:v(r.group_id)??null,group_label:r.group_label??null,objectives:r.objectives??null,bio:r.bio??null,avatar_url:r.avatar_url??null,ffn_iuf:r.ffn_iuf??null,phone:r.phone??null,neurotype_result:r.neurotype_result??null}:null}async function ve(e){if(!c())return{status:"skipped"};const t=e.userId;if(!t)return{status:"skipped"};const r=e.profile.ffn_iuf?.trim()||null;if(r){const{data:n,error:i}=await a.from("club_record_swimmers").select("id").eq("iuf",r).eq("source_type","manual");if(i)throw new Error(i.message);if(n&&n.length>0){const o=n.map(d=>d.id),{error:u}=await a.from("club_record_swimmers").delete().in("id",o);if(u)throw new Error(u.message)}}const{error:s}=await a.from("user_profiles").upsert({user_id:t,...e.profile},{onConflict:"user_id"});if(s)throw new Error(s.message);if(e.profile.display_name){const{error:n}=await a.from("users").update({display_name:e.profile.display_name}).eq("id",t);if(n)throw new Error(n.message)}return{status:"updated"}}async function Ie(){if(!c()){const d=new Map,l=(w,b)=>{const T=String(w??"").trim();if(!T)return;const x=b!=null?v(b):null,C=x!==null?`id:${x}`:`name:${T.toLowerCase()}`;d.has(C)||d.set(C,{id:x,display_name:T})};return(h(_.SESSIONS)??[]).forEach(w=>l(w.athlete_name,w.athlete_id)),(h(_.STRENGTH_RUNS)??[]).forEach(w=>l(w.athlete_name,w.athlete_id)),(h(_.ASSIGNMENTS)??[]).forEach(w=>l(w.target_athlete,w.target_user_id)),Array.from(d.values()).sort((w,b)=>w.display_name.localeCompare(b.display_name,"fr"))}const{data:e,error:t}=await a.from("groups").select("id, name");if(t)throw new Error(t.message);const{data:r}=await a.from("user_profiles").select("user_id, ffn_iuf, avatar_url"),s=new Map((r??[]).map(d=>[d.user_id,d]));if(!e?.length){const{data:d,error:l}=await a.from("users").select("id, display_name, email").eq("role","athlete").eq("is_active",!0);if(l)throw new Error(l.message);return(d??[]).map(m=>({id:m.id,display_name:m.display_name,email:m.email??null,ffn_iuf:s.get(m.id)?.ffn_iuf??null,avatar_url:s.get(m.id)?.avatar_url??null})).filter(m=>m.display_name).sort((m,S)=>m.display_name.localeCompare(S.display_name,"fr"))}const{data:n,error:i}=await a.from("group_members").select("user_id, group_id, users!inner(display_name, role, email), groups!inner(is_temporary)").eq("users.role","athlete").eq("groups.is_temporary",!1);if(i)throw new Error(i.message);const o=new Map(e.map(d=>[d.id,d.name])),u=new Map;return(n??[]).forEach(d=>{const l=d.user_id;u.has(l)||u.set(l,{id:l,display_name:d.users?.display_name??"",email:d.users?.email??null,group_id:d.group_id??null,group_label:o.get(d.group_id)??null,ffn_iuf:s.get(l)?.ffn_iuf??null,avatar_url:s.get(l)?.avatar_url??null})}),Array.from(u.values()).filter(d=>d.display_name).sort((d,l)=>d.display_name.localeCompare(l.display_name,"fr"))}async function Te(){if(!c())return[];const{data:e,error:t}=await a.from("groups").select("id, name, description, is_temporary, is_active, parent_group_id");if(t)throw new Error(t.message);return(e??[]).filter(r=>r.is_temporary?r.is_active===!0:!0).map(r=>({id:N(r.id,0),name:String(r.name??`Groupe ${r.id??""}`).trim(),member_count:null,is_temporary:r.is_temporary??!1,is_active:r.is_active??!0,parent_group_id:r.parent_group_id??null})).filter(r=>r.id>0&&r.name).sort((r,s)=>r.is_temporary&&!s.is_temporary?-1:!r.is_temporary&&s.is_temporary?1:r.name.localeCompare(s.name,"fr"))}async function Ne(e){if(!c())return[];const t=e?.days??30,{data:r,error:s}=await a.rpc("get_upcoming_birthdays",{p_days:t});if(s)throw new Error(s.message);return Array.isArray(r)?r:[]}async function qe(e){if(!c())return[];let t=a.from("users").select("id, display_name, role, email, is_active");e?.role&&(t=t.eq("role",e.role)),e?.includeInactive||(t=t.eq("is_active",!0));const{data:r,error:s}=await t.order("display_name");if(s)throw new Error(s.message);return(r??[]).map(n=>({id:n.id,display_name:n.display_name??"",role:n.role??"",email:n.email??null,is_active:n.is_active??null,group_label:null}))}async function xe(e){if(!c())return{status:"skipped",user:null,initialPassword:null};const{data:t,error:r}=await a.functions.invoke("admin-user",{body:{action:"create_coach",display_name:e.display_name,email:e.email,password:e.password}});if(r)throw new Error(r.message);return{status:"created",user:t?.user??null,initialPassword:t?.initial_password??null}}async function Ce(e){if(!c())return{status:"skipped"};const{error:t}=await a.functions.invoke("admin-user",{body:{action:"update_role",user_id:e.userId,role:e.role}});if(t)throw new Error(t.message);return{status:"updated"}}async function Re(e){if(!c())return{status:"skipped"};const{error:t}=await a.functions.invoke("admin-user",{body:{action:"disable_user",user_id:e.userId}});if(t)throw new Error(t.message);return{status:"disabled"}}async function Ae(){if(!c())return[];const{data:e,error:t}=await a.from("user_profiles").select("user_id, display_name, email, users!user_profiles_user_id_fkey(created_at)").eq("is_approved",!1);if(t)throw new Error(t.message);return(e??[]).map(r=>({user_id:r.user_id,display_name:r.display_name,email:r.email,created_at:r.users?.created_at??new Date().toISOString()}))}async function Oe(e){if(!c())return;const{error:t}=await a.from("user_profiles").update({is_approved:!0,approved_at:new Date().toISOString()}).eq("user_id",e);if(t)throw new Error(t.message)}async function De(e){if(!c())return;const{error:t}=await a.from("users").delete().eq("id",e);if(t)throw new Error(t.message)}async function Me(e){if(!c())return{status:"skipped"};const{data:{user:t}}=await a.auth.getUser();if(!e.userId||e.userId===t?.user_metadata?.app_user_id){const{error:s}=await a.auth.updateUser({password:e.password});if(s)throw new Error(s.message);return{status:"updated"}}const{error:r}=await a.functions.invoke("admin-user",{body:{action:"update_password",user_id:e.userId,password:e.password}});if(r)throw new Error(r.message);return{status:"updated"}}async function ke(e){if(!c())throw new Error("Supabase non disponible");const t=`${e.userId}.${e.extension}`,{error:r}=await a.storage.from("avatars").upload(t,e.blob,{contentType:e.mimeType,upsert:!0});if(r)throw new Error(r.message);const{data:s}=a.storage.from("avatars").getPublicUrl(t),n=`${s.publicUrl}?t=${Date.now()}`,{error:i}=await a.from("user_profiles").update({avatar_url:n}).eq("user_id",e.userId);if(i)throw new Error(i.message);return n}async function Ue(e){if(!c())return;const{error:t}=await a.storage.from("avatars").remove([`${e}.webp`,`${e}.jpg`]);if(t)throw new Error(t.message);const{error:r}=await a.from("user_profiles").update({avatar_url:null}).eq("user_id",e);if(r)throw new Error(r.message)}async function Ge(e=30){if(!c())return[];const t=new Date;t.setDate(t.getDate()-e);const r=t.toISOString().slice(0,10),{data:s,error:n}=await a.from("dim_sessions").select("athlete_id, athlete_name, session_date, rpe, performance, engagement, fatigue").gte("session_date",r).order("session_date",{ascending:!1});if(n)throw new Error(n.message);return(s??[]).map(i=>({athlete_id:i.athlete_id?N(i.athlete_id):null,athlete_name:String(i.athlete_name??""),session_date:String(i.session_date??""),effort:v(i.rpe),performance:v(i.performance),engagement:v(i.engagement),fatigue:v(i.fatigue)}))}const Z=["Piscine","Compétition"];async function Fe(e){if(c()){let r=a.from("timesheet_shifts").select("*").order("shift_date",{ascending:!1});e?.coachId&&(r=r.eq("coach_id",e.coachId)),e?.from&&(r=r.gte("shift_date",e.from)),e?.to&&(r=r.lte("shift_date",e.to));const{data:s,error:n}=await r;if(n)throw new Error(n.message);const i=s??[];if(i.length===0)return i;const o=i.map(l=>l.id),{data:u}=await a.from("timesheet_shift_groups").select("shift_id, group_name").in("shift_id",o),d=new Map;for(const l of u??[]){const m=d.get(l.shift_id)??[];m.push(l.group_name),d.set(l.shift_id,m)}return i.map(l=>({...l,group_names:d.get(l.id)??[]}))}return await q(200),(h(_.TIMESHEET_SHIFTS)||[]).filter(r=>!(e?.coachId&&r.coach_id!==e.coachId||e?.from&&r.shift_date<e.from||e?.to&&r.shift_date>e.to)).sort((r,s)=>r.shift_date!==s.shift_date?r.shift_date<s.shift_date?1:-1:r.start_time<s.start_time?1:-1)}async function Pe(){if(c()){const{data:s,error:n}=await a.from("timesheet_locations").select("*").order("name");if(n)throw new Error(n.message);return s??[]}await q(120);const e=h(_.TIMESHEET_LOCATIONS);if(Array.isArray(e)&&e.length)return e;const t=new Date().toISOString(),r=Z.map((s,n)=>({id:n+1,name:s,created_at:t,updated_at:t}));return I(_.TIMESHEET_LOCATIONS,r),r}async function He(e){if(c()){const{error:d}=await a.from("timesheet_locations").insert({name:e.name.trim()});if(d)throw new Error(d.message);return{status:"created"}}await q(120);const t=e.name.trim();if(!t)throw new Error("Missing location name");const r=h(_.TIMESHEET_LOCATIONS),s=new Date().toISOString(),n=Array.isArray(r)&&r.length?r:Z.map((d,l)=>({id:l+1,name:d,created_at:s,updated_at:s}));if(n.some(d=>d.name.toLowerCase()===t.toLowerCase()))return{status:"exists"};const o=new Date().toISOString(),u={id:Date.now(),name:t,created_at:o,updated_at:o};return I(_.TIMESHEET_LOCATIONS,[...n,u]),{status:"created"}}async function Le(e){if(c()){const{error:s}=await a.from("timesheet_locations").delete().eq("id",e.id);if(s)throw new Error(s.message);return{status:"deleted"}}await q(120);const r=(h(_.TIMESHEET_LOCATIONS)||[]).filter(s=>s.id!==e.id);return I(_.TIMESHEET_LOCATIONS,r),{status:"deleted"}}async function je(){if(c()){const{data:e,error:t}=await a.from("users").select("id, display_name").eq("role","coach").eq("is_active",!0);if(t)throw new Error(t.message);return(e??[]).map(r=>({id:r.id,display_name:r.display_name}))}return[]}async function $e(e){if(c()){const{data:s,error:n}=await a.from("timesheet_shifts").insert({coach_id:e.coach_id,shift_date:e.shift_date,start_time:e.start_time,end_time:e.end_time??null,location:e.location??null,is_travel:e.is_travel}).select("id").single();if(n)throw new Error(n.message);return e.group_names?.length&&await ee(s.id,e.group_names),{status:"created"}}await q(200);const t=h(_.TIMESHEET_SHIFTS)||[],r={...e,id:Date.now(),created_at:new Date().toISOString()};return I(_.TIMESHEET_SHIFTS,[...t,r]),{status:"created"}}async function Be(e){if(c()){const{id:n,group_names:i,...o}=e,{error:u}=await a.from("timesheet_shifts").update(o).eq("id",n);if(u)throw new Error(u.message);return i!==void 0&&await ee(n,i??[]),{status:"updated"}}await q(200);const t=h(_.TIMESHEET_SHIFTS)||[],r=t.findIndex(n=>n.id===e.id);if(r===-1)return{status:"missing"};const s=[...t];return s[r]={...s[r],...e,updated_at:new Date().toISOString()},I(_.TIMESHEET_SHIFTS,s),{status:"updated"}}async function We(e){if(c()){const{error:s}=await a.from("timesheet_shifts").delete().eq("id",e.id);if(s)throw new Error(s.message);return{status:"deleted"}}await q(200);const r=(h(_.TIMESHEET_SHIFTS)||[]).filter(s=>s.id!==e.id);return I(_.TIMESHEET_SHIFTS,r),{status:"deleted"}}async function ze(){if(c()){const{data:e,error:t}=await a.from("timesheet_group_labels").select("*").order("name");if(t)throw new Error(t.message);return e??[]}return await q(120),h("timesheet_group_labels")||[]}async function Xe(e){if(c()){const{error:i}=await a.from("timesheet_group_labels").insert({name:e.name.trim()});if(i)throw new Error(i.message);return{status:"created"}}await q(120);const t=e.name.trim();if(!t)throw new Error("Missing label name");const r=h("timesheet_group_labels")||[];if(r.some(i=>i.name.toLowerCase()===t.toLowerCase()))return{status:"exists"};const n={id:Date.now(),name:t,created_at:new Date().toISOString()};return I("timesheet_group_labels",[...r,n]),{status:"created"}}async function Ye(e){if(c()){const{error:r}=await a.from("timesheet_group_labels").delete().eq("id",e.id);if(r)throw new Error(r.message);return{status:"deleted"}}await q(120);const t=h("timesheet_group_labels")||[];return I("timesheet_group_labels",t.filter(r=>r.id!==e.id)),{status:"deleted"}}async function ee(e,t){if(c()){const{error:r}=await a.from("timesheet_shift_groups").delete().eq("shift_id",e);if(r)throw new Error(r.message);if(t.length>0){const s=t.map(i=>({shift_id:e,group_name:i})),{error:n}=await a.from("timesheet_shift_groups").insert(s);if(n)throw new Error(n.message)}return{status:"updated"}}return{status:"noop"}}async function Ve(){if(c()){const{data:e,error:t}=await a.from("groups").select("id, name").eq("is_temporary",!1).eq("is_active",!0).order("name");if(t)throw new Error(t.message);return e??[]}return[]}async function Je(e){return await q(200),(h(_.NOTIFICATIONS)||[]).filter(r=>r.target_athlete===e||r.target_athlete==="All").reverse()}async function Ke(e){if(c()){const{data:n,error:i}=await a.from("notifications").insert({title:e.title,body:e.body??null,type:e.type}).select("id").single();if(i)throw new Error(i.message);if(n&&e.targets.length>0){const{error:o}=await a.from("notification_targets").insert(e.targets.map(u=>({notification_id:n.id,target_user_id:u.target_user_id??null,target_group_id:u.target_group_id??null})));if(o)throw new Error(o.message)}return{status:"sent"}}const t=h(_.NOTIFICATIONS)||[],r={sender:"Coach",title:e.title,message:e.body||"",type:e.type},s=e.targets.map((n,i)=>({...r,id:Date.now()+i,read:!1,date:new Date().toISOString(),sender_id:null,sender_email:null,target_user_id:n.target_user_id??null,target_group_id:n.target_group_id??null}));return I(_.NOTIFICATIONS,[...t,...s]),{status:"sent"}}async function Qe(e){const r=(h(_.NOTIFICATIONS)||[]).map(s=>s.id===e?{...s,read:!0}:s);I(_.NOTIFICATIONS,r)}async function Ze(e){const t=e.limit??20,r=Number.isFinite(t)?Math.min(Math.max(Number(t),1),200):20,s=e.offset??0,n=Number.isFinite(s)?Math.max(Number(s),0):0,i=e.order==="asc"?"asc":"desc";if(c()){const f=await de(e.targetUserId??null),w=[];if(e.targetUserId&&w.push(`target_user_id.eq.${e.targetUserId}`),f.forEach(g=>w.push(`target_group_id.eq.${g}`)),!w.length)return{notifications:[],pagination:{limit:r,offset:n,total:0}};let b=a.from("notification_targets").select("*, notifications!inner(*)").or(w.join(",")).order("notifications(created_at)",{ascending:i==="asc"});e.status==="read"?b=b.not("read_at","is",null):e.status==="unread"&&(b=b.is("read_at",null)),e.type&&(b=b.eq("notifications.type",e.type)),e.from&&(b=b.gte("notifications.created_at",e.from)),e.to&&(b=b.lte("notifications.created_at",e.to+"T23:59:59"));const{data:T,error:x}=await b;if(x)throw new Error(x.message);const C=(T??[]).map(g=>{const E=g.notifications||{};return{id:N(g.id,Date.now()),target_id:v(g.id)??void 0,target_user_id:v(g.target_user_id)??null,sender_id:v(E.created_by)??null,sender_email:null,target_group_id:v(g.target_group_id)??null,target_group_name:null,sender_name:null,sender_role:null,counterparty_id:null,counterparty_name:null,counterparty_role:null,sender:E.created_by?"Coach":"Système",title:String(E.title||""),message:String(E.body||""),type:String(E.type||"message"),read:!!g.read_at,date:E.created_at||new Date().toISOString()}}),p=C.length;return{notifications:C.slice(n,n+r),pagination:{limit:r,offset:n,total:p}}}await q(200);const d=(h(_.NOTIFICATIONS)||[]).filter(f=>!(e.targetUserId&&f.target_user_id!==e.targetUserId||e.targetAthleteName&&!(f.target_athlete===e.targetAthleteName||f.target_athlete==="All")||e.type&&f.type!==e.type||e.status==="read"&&!f.read||e.status==="unread"&&f.read)).sort((f,w)=>{const b=new Date(f.date||f.created_at||0).getTime(),T=new Date(w.date||w.created_at||0).getTime();return i==="asc"?b-T:T-b}),l=d.length;return{notifications:d.slice(n,n+r).map(f=>({id:N(f.id,Date.now()),target_user_id:v(f.target_user_id)??null,sender_id:v(f.sender_id)??null,sender_email:f.sender_email?String(f.sender_email):null,sender:String(f.sender||"Coach"),title:String(f.title||""),message:String(f.message||""),type:String(f.type||"message"),read:!!f.read,date:f.date||new Date().toISOString(),related_id:f.related_id??void 0})),pagination:{limit:r,offset:n,total:l}}}async function et(e){const t=e.targetId??e.id;if(!t)throw new Error("Missing target id");if(c()){const{error:n}=await a.from("notification_targets").update({read_at:new Date().toISOString()}).eq("id",t);if(n)throw new Error(n.message);return}const s=(h(_.NOTIFICATIONS)||[]).map(n=>n.id===t?{...n,read:!0}:n);I(_.NOTIFICATIONS,s)}const te=e=>{const t=V(e?.cycle??e?.cycle_type),s=(Array.isArray(e?.items)?e.items:[]).map((i,o)=>J(i,o,t));le(s);const n=s.sort((i,o)=>i.order_index-o.order_index).map(i=>({ordre:i.order_index,exercise_id:i.exercise_id,cycle_type:i.cycle_type,sets:i.sets,reps:i.reps,pct_1rm:i.percent_1rm,rest_series_s:i.rest_seconds,notes:i.notes}));return{cycle:t,normalizedItems:s,itemsPayload:n}},re=(e,t,r)=>e.map(s=>({session_id:t,ordre:s.ordre,exercise_id:s.exercise_id,block:"main",cycle_type:s.cycle_type??r,sets:s.sets,reps:s.reps,pct_1rm:s.pct_1rm,rest_series_s:s.rest_series_s,notes:s.notes})),tt=(e,t)=>({id:t,assignment_id:e.assignment_id,athlete_id:e.athlete_id??null,athlete_name:e.athleteName??null,session_id:e.session_id??null,cycle_type:e.cycle_type??null,status:"in_progress",progress_pct:e.progress_pct??0,started_at:new Date().toISOString(),logs:[]}),rt=e=>({run_id:e.run_id,exercise_id:e.exercise_id,set_index:e.set_index??null,reps:e.reps??null,weight:e.weight??null,pct_1rm_suggested:e.pct_1rm_suggested??null,rest_seconds:e.rest_seconds??null,rpe:e.rpe??null,notes:e.notes??null,completed_at:new Date().toISOString()}),st=(e,t)=>e.map((r,s)=>({run_id:t,exercise_id:r.exercise_id,set_index:r.set_index??r.set_number??s,reps:r.reps??null,weight:r.weight??null,rpe:r.rpe??null,notes:r.notes??null,completed_at:new Date().toISOString()})),nt=e=>{const t={};return e.progress_pct!==void 0&&(t.progress_pct=e.progress_pct),e.status&&(t.status=e.status),e.status==="completed"&&(t.completed_at=new Date().toISOString()),e.fatigue!==void 0&&(t.raw_payload={fatigue:e.fatigue,comments:e.comments}),t},se=(e,t)=>e.map(r=>{const s=t.find(n=>n.id===r.exercise_id);return{...r,exercise_name:s?.nom_exercice,category:s?.exercise_type}}),X=e=>{const t=new Map;for(const r of e){const s=Y(Number(r.weight),Number(r.reps));if(!s)continue;const n=Number(r.exercise_id);if(!Number.isFinite(n))continue;const i=t.get(n)??0;s>i&&t.set(n,s)}return t};async function at(){if(c()){const{data:r,error:s}=await a.from("dim_exercices").select("*");if(s)throw new Error(s.message);return(r??[]).map(me)}const e=h(_.EXERCISES)||[];return(Array.isArray(e)?e:[]).map(r=>W(r))}async function it(e){const t=$(e.exercise_type);if(c()){const n=K({...e,exercise_type:t}),{error:i}=await a.from("dim_exercices").insert(n);if(i)throw new Error(i.message);return{status:"created"}}const r=h(_.EXERCISES)||[],s=W({...e,exercise_type:t,id:Date.now()});return I(_.EXERCISES,[...r,s]),{status:"created"}}async function ot(e){const t=$(e.exercise_type);if(c()){const o=K({...e,exercise_type:t}),{error:u}=await a.from("dim_exercices").update(o).eq("id",e.id);if(u)throw new Error(u.message);return{status:"updated"}}const r=h(_.EXERCISES)||[],s=r.findIndex(o=>o.id===e.id);if(s===-1)throw new Error("Exercice introuvable");const n=W({...r[s],...e,exercise_type:t}),i=[...r];return i[s]=n,I(_.EXERCISES,i),{status:"updated"}}async function ct(e){if(c()){const{error:i}=await a.from("dim_exercices").delete().eq("id",e);if(i)throw new Error(i.message);return{status:"deleted"}}const r=(h(_.EXERCISES)||[]).filter(i=>i.id!==e);I(_.EXERCISES,r);const n=(h(_.STRENGTH_SESSIONS)||[]).map(i=>({...i,items:Array.isArray(i.items)?i.items.filter(o=>o.exercise_id!==e):i.items}));return I(_.STRENGTH_SESSIONS,n),{status:"deleted"}}async function z(){if(c()){const{data:e,error:t}=await a.from("strength_sessions").select("*, strength_session_items(*, dim_exercices(nom_exercice, exercise_type))").order("created_at",{ascending:!1});if(t)throw new Error(t.message);return(e??[]).map(r=>{const s=Array.isArray(r.strength_session_items)?r.strength_session_items:[],n=V(s[0]?.cycle_type);return{id:N(r.id,Date.now()),title:String(r.name||""),description:r.description??"",cycle:n,folder_id:v(r.folder_id),items:s.sort((i,o)=>(i.ordre??0)-(o.ordre??0)).map((i,o)=>({...J(i,o,n),exercise_name:i.dim_exercices?.nom_exercice??void 0,category:i.dim_exercices?.exercise_type??void 0}))}})}return h(_.STRENGTH_SESSIONS)||[]}async function ut(e){const{cycle:t,normalizedItems:r,itemsPayload:s}=te(e);if(c()){const{data:u,error:d}=await a.from("strength_sessions").insert({name:e?.title??e?.name??"",description:e?.description??"",folder_id:e?.folder_id??null}).select("id").single();if(d)throw new Error(d.message);const l=u.id;if(s.length>0){const{error:m}=await a.from("strength_session_items").insert(re(s,l,t));if(m)throw new Error(m.message)}return{status:"created",id:l}}const n=h(_.STRENGTH_SESSIONS)||[],i=Date.now(),o=se(r,h(_.EXERCISES)||[]);return I(_.STRENGTH_SESSIONS,[...n,{...e,title:e?.title??e?.name??"",cycle:t,items:o,id:i}]),{status:"created",id:i}}async function ne(e){if(!e?.id)throw new Error("Session id manquant");const{cycle:t,normalizedItems:r,itemsPayload:s}=te(e);if(c()){const{error:l}=await a.from("strength_sessions").update({name:e?.title??e?.name??"",description:e?.description??"",folder_id:e?.folder_id??null}).eq("id",e.id);if(l)throw new Error(l.message);if(await a.from("strength_session_items").delete().eq("session_id",e.id),s.length>0){const{error:m}=await a.from("strength_session_items").insert(re(s,e.id,t));if(m)throw new Error(m.message)}return{status:"updated"}}const n=h(_.STRENGTH_SESSIONS)||[],i=n.findIndex(l=>l.id===e.id);if(i===-1)throw new Error("Séance introuvable");const o=se(r,h(_.EXERCISES)||[]),u={...n[i],...e,title:e?.title??e?.name??"",cycle:t,items:o},d=[...n];return d[i]=u,I(_.STRENGTH_SESSIONS,d),{status:"updated"}}async function dt(e){return ne(e)}async function lt(e){if(c()){const{error:s}=await a.from("strength_sessions").delete().eq("id",e);if(s)throw new Error(s.message);return{status:"deleted"}}const r=(h(_.STRENGTH_SESSIONS)||[]).filter(s=>s.id!==e);return I(_.STRENGTH_SESSIONS,r),{status:"deleted"}}async function mt(e){if(c()){const{data:n,error:i}=await a.from("strength_session_runs").insert({assignment_id:e.assignment_id??null,athlete_id:e.athlete_id??null,session_id:e.session_id??null,status:"in_progress",progress_pct:e.progress_pct??0,started_at:new Date().toISOString()}).select("id").single();if(i)throw new Error(i.message);return e.assignment_id&&await a.from("session_assignments").update({status:"in_progress"}).eq("id",e.assignment_id),{run_id:n.id}}const t=h(_.STRENGTH_RUNS)||[],r=Date.now(),s=tt(e,r);if(I(_.STRENGTH_RUNS,[...t,s]),e.assignment_id){const i=(h(_.ASSIGNMENTS)||[]).map(o=>o.id===e.assignment_id?{...o,status:"in_progress"}:o);I(_.ASSIGNMENTS,i)}return{run_id:r}}async function _t(e){const t=async S=>{if(j(e.weight))return null;const f=Y(Number(e.weight),Number(e.reps));if(!f)return null;const w=S?.athleteId??null,b=S?.athleteName??null;if(w===null&&!b)return null;const T=await G({athleteName:b,athleteId:w}),C=new Map((T||[]).map(p=>[p.exercise_id,Number(p.weight??0)])).get(e.exercise_id)??0;return f<=C||c()&&(w==null||w==="")?null:(await F({athlete_id:w??void 0,athlete_name:b??void 0,exercise_id:e.exercise_id,one_rm:f}),f)},r=S=>{const f=e.athlete_id??e.athleteId??null,w=e.athlete_name??e.athleteName??null;if(f!==null||w)return{athleteId:f,athleteName:w};if(!S)return{athleteId:null,athleteName:null};const b=S.find(T=>T.id===e.run_id);return{athleteId:b?.athlete_id??null,athleteName:b?.athlete_name??null}};if(c()){const{error:S}=await a.from("strength_set_logs").insert(rt(e));if(S)throw new Error(S.message);const f=r(),w=await t(f);return{status:"ok",one_rm_updated:!!w,one_rm:w??void 0}}const s=h(_.STRENGTH_RUNS)||[],n=s.findIndex(S=>S.id===e.run_id),i=n>=0?s[n]:{id:e.run_id,logs:[]},o=[...i.logs||[],{...e,completed_at:new Date().toISOString()}],u={...i,logs:o},d=n>=0?[...s.slice(0,n),u,...s.slice(n+1)]:[...s,u];I(_.STRENGTH_RUNS,d);const l=r(d),m=await t(l);return{status:"ok",one_rm_updated:!!m,one_rm:m??void 0}}async function ft(e){if(c()){const u=nt(e),{error:d}=await a.from("strength_session_runs").update(u).eq("id",e.run_id);if(d)throw new Error(d.message);return e.status==="completed"&&e.assignment_id&&await a.from("session_assignments").update({status:"completed"}).eq("id",e.assignment_id),{status:"ok"}}const t=h(_.STRENGTH_RUNS)||[],r=t.findIndex(u=>u.id===e.run_id),s=new Date().toISOString(),n=r>=0?t[r]:{id:e.run_id,started_at:s},i={...n,...e,id:e.run_id,updated_at:s};if(e.status==="completed"&&!i.completed_at&&(i.completed_at=s),e.status==="completed"){const u=e.assignment_id??n.assignment_id;if(u){const l=(h(_.ASSIGNMENTS)||[]).map(m=>m.id===u?{...m,status:"completed"}:m);I(_.ASSIGNMENTS,l)}}const o=r>=0?[...t.slice(0,r),i,...t.slice(r+1)]:[...t,i];return I(_.STRENGTH_RUNS,o),{status:"ok"}}async function gt(e){if(c()){const{error:n}=await a.from("strength_session_runs").delete().eq("id",e);if(n)throw new Error(n.message);return{status:"deleted",source:"remote"}}const t=h(_.STRENGTH_RUNS)||[],r=t.find(n=>n.id===e),s=t.filter(n=>n.id!==e);if(I(_.STRENGTH_RUNS,s),r?.assignment_id){const i=(h(_.ASSIGNMENTS)||[]).map(o=>o.id===r.assignment_id?{...o,status:"assigned"}:o);I(_.ASSIGNMENTS,i)}return{status:"deleted",source:"local"}}async function pt(e){if(c()){let o=e.run_id;if(!o){const{data:d,error:l}=await a.from("strength_session_runs").insert({assignment_id:e.assignment_id??null,athlete_id:e.athlete_id??null,status:"in_progress",progress_pct:e.progress_pct??0,started_at:new Date().toISOString()}).select("id").single();if(l)throw new Error(l.message);o=d.id}if(o&&Array.isArray(e.logs)&&e.logs.length>0){const{error:d}=await a.from("strength_set_logs").insert(st(e.logs,o));if(d)throw new Error(d.message)}const u=X(Array.isArray(e.logs)?e.logs:[]);if(u.size>0){const d=e.athlete_id??null,l=e.athlete_name??null;if(d!=null&&d!==""){const m=await G({athleteName:l,athleteId:d}),S=new Map((m||[]).map(f=>[f.exercise_id,Number(f.weight??0)]));await Promise.all(Array.from(u.entries()).filter(([f,w])=>w>(S.get(f)??0)).map(([f,w])=>F({athlete_id:d??void 0,athlete_name:l??void 0,exercise_id:f,one_rm:w})))}}return o&&await a.from("strength_session_runs").update({progress_pct:e.progress_pct??100,status:"completed",completed_at:new Date().toISOString()}).eq("id",o),e.assignment_id&&await a.from("session_assignments").update({status:"completed"}).eq("id",e.assignment_id),{status:"ok",run_id:o??null}}const t=h(_.STRENGTH_RUNS)||[],r=e.run_id??Date.now(),s=t.find(o=>o.id===r)||{},n={...s,...e,id:r,status:"completed",started_at:s.started_at??e.started_at??e.date??new Date().toISOString(),completed_at:new Date().toISOString()};if(I(_.STRENGTH_RUNS,[...t.filter(o=>o.id!==r),n]),e.assignment_id){const u=(h(_.ASSIGNMENTS)||[]).map(d=>d.id===e.assignment_id?{...d,status:"completed"}:d);I(_.ASSIGNMENTS,u)}const i=X(Array.isArray(e.logs)?e.logs:[]);if(i.size>0){const o=e.athlete_id??null,u=e.athlete_name??null,d=await G({athleteName:u,athleteId:o}),l=new Map((d||[]).map(m=>[m.exercise_id,Number(m.weight??0)]));await Promise.all(Array.from(i.entries()).filter(([m,S])=>S>(l.get(m)??0)).map(([m,S])=>F({athlete_id:o??void 0,athlete_name:u??void 0,exercise_id:m,one_rm:S})))}return{status:"ok",run_id:r}}async function wt(e,t){const r=t?.limit??50,s=Number.isFinite(r)?Math.min(Math.max(Number(r),1),200):50,n=t?.offset??0,i=Number.isFinite(n)?Math.max(Number(n),0):0,o=t?.order==="asc"?"asc":"desc",u=t?.athleteId,d=u!=null&&u!=="";if(c()){let p=a.from("strength_session_runs").select("*, strength_set_logs(*)").order("started_at",{ascending:o==="asc"}).range(i,i+s-1);d&&(p=p.eq("athlete_id",Number(u))),t?.status&&(p=p.eq("status",t.status)),t?.from&&(p=p.gte("started_at",t.from)),t?.to&&(p=p.lte("started_at",t.to+"T23:59:59"));const{data:y,error:g,count:E}=await p;if(g)throw new Error(g.message);return{runs:y??[],pagination:{limit:s,offset:i,total:E??(y??[]).length},exercise_summary:[]}}const S=(h(_.STRENGTH_RUNS)||[]).filter(p=>{if(d&&String(p.athlete_id)!==String(u)||!d&&e&&p.athlete_name!==e||t?.status&&p.status!==t.status)return!1;if(t?.from||t?.to){const y=new Date(p.date||p.started_at||p.created_at||0).getTime();if(t?.from){const g=new Date(t.from).getTime();if(Number.isFinite(g)&&y<g)return!1}if(t?.to){const g=new Date(t.to);g.setHours(23,59,59,999);const E=g.getTime();if(Number.isFinite(E)&&y>E)return!1}}return!0}).sort((p,y)=>{const g=new Date(p.date||p.started_at||p.created_at||0).getTime(),E=new Date(y.date||y.started_at||y.created_at||0).getTime();return o==="asc"?g-E:E-g}),f=h(_.EXERCISES)||[],w=new Map((Array.isArray(f)?f:[]).map(p=>[N(p.id),p.nom_exercice||p.name||`Exercice ${p.id}`])),b=new Map;S.forEach(p=>{(p.logs||[]).forEach(y=>{const g=N(y.exercise_id);if(!g)return;const E=b.get(g)||{exercise_id:g,exercise_name:w.get(g)||`Exercice ${g}`,total_sets:0,total_reps:0,total_volume:0,max_weight:null,last_performed_at:null},A=Number(y.reps??0)||0,R=y.weight,O=j(R)?0:Number(R??0)||0;E.total_sets+=1,E.total_reps+=A,E.total_volume+=A*O,j(R)||(E.max_weight=Math.max(E.max_weight??0,O)||E.max_weight);const M=y.completed_at||p.completed_at||p.started_at||null;if(M){const U=new Date(M).getTime(),H=E.last_performed_at?new Date(E.last_performed_at).getTime():0;(!E.last_performed_at||U>H)&&(E.last_performed_at=M)}b.set(g,E)})});const T=S.length,x=S.slice(i,i+s),C=Array.from(b.values()).sort((p,y)=>y.total_volume-p.total_volume);return{runs:x,pagination:{limit:s,offset:i,total:T},exercise_summary:C}}async function ht(e,t){const r=t?.limit??200,s=Number.isFinite(r)?Math.min(Math.max(Number(r),1),200):200,n=t?.offset??0,i=Number.isFinite(n)?Math.max(Number(n),0):0,o=t?.order==="asc"?"asc":"desc",u=t?.athleteId,d=u!=null&&u!=="",l=t?.period??"day";if(c()){const y={p_period:l};d&&(y.p_athlete_id=Number(u)),t?.from&&(y.p_from=t.from),t?.to&&(y.p_to=t.to);const{data:g,error:E}=await a.rpc("get_strength_history_aggregate",y);if(E)throw new Error(E.message);const A=Array.isArray(g)?g:[];return{periods:A,pagination:{limit:s,offset:i,total:A.length}}}const S=(h(_.STRENGTH_RUNS)||[]).filter(y=>d?y.athlete_id?String(y.athlete_id)===String(u):!1:y.athlete_name===e),f=t?.from?new Date(t.from):null,w=t?.to?new Date(t.to):null,b=new Map,T=y=>{if(l==="month")return`${y.getUTCFullYear()}-${String(y.getUTCMonth()+1).padStart(2,"0")}`;if(l==="week"){const g=new Date(Date.UTC(y.getUTCFullYear(),y.getUTCMonth(),y.getUTCDate())),E=g.getUTCDay()||7;g.setUTCDate(g.getUTCDate()+4-E);const A=new Date(Date.UTC(g.getUTCFullYear(),0,1)),R=Math.ceil(((g.getTime()-A.getTime())/864e5+1)/7);return`${g.getUTCFullYear()}-W${String(R).padStart(2,"0")}`}return y.toISOString().split("T")[0]};S.forEach(y=>{(Array.isArray(y.logs)?y.logs:[]).forEach(E=>{const A=E.completed_at||y.started_at||y.date||y.created_at;if(!A)return;const R=new Date(A);if(Number.isNaN(R.getTime())||f&&R<f||w&&R>w)return;const O=T(R),M=b.get(O)||{period:O,tonnage:0,volume:0},U=Number(E.reps)||0,H=Number(E.weight)||0;M.volume+=U,M.tonnage+=U*H,b.set(O,M)})});const x=Array.from(b.values()).sort((y,g)=>o==="asc"?y.period.localeCompare(g.period):g.period.localeCompare(y.period)),C=x.length;return{periods:x.slice(i,i+s),pagination:{limit:s,offset:i,total:C}}}async function G(e){const t=typeof e=="string"?e:e?.athleteName??null,r=typeof e=="string"?null:e?.athleteId??null;if(c()){let n=a.from("one_rm_records").select("*");r!=null&&String(r)!==""&&(n=n.eq("athlete_id",Number(r)));const{data:i,error:o}=await n;if(o)throw new Error(o.message);return(i??[]).map(u=>({id:v(u.id),athlete_id:v(u.athlete_id),exercise_id:N(u.exercise_id),weight:Number(u.one_rm??0),recorded_at:u.recorded_at??null,notes:u.notes??null}))}return(h(_.ONE_RM)||[]).filter(n=>n.athlete_name===t)}async function F(e){if(c()){const n=e.athlete_id??e.athleteId,i=e.one_rm??e.weight;if(n==null||n===""||i===null||i===void 0)throw new Error("athlete_id et one_rm sont requis");const o={athlete_id:Number(n),exercise_id:e.exercise_id,one_rm:i,recorded_at:new Date().toISOString()};e.notes!==void 0&&(o.notes=e.notes);const{error:u}=await a.from("one_rm_records").upsert(o,{onConflict:"athlete_id,exercise_id"});if(u)throw new Error(u.message);return{status:"ok"}}const t=h(_.ONE_RM)||[],r=e.athlete_name??e.athleteName,s=t.filter(n=>!(n.athlete_name===r&&n.exercise_id===e.exercise_id));return I(_.ONE_RM,[...s,{...e,athlete_name:r,id:Date.now(),date:new Date().toISOString()}]),{status:"ok"}}async function St(e){if(c()){const{data:s,error:n}=await a.from("one_rm_records").update({notes:e.notes}).eq("athlete_id",Number(e.athlete_id)).eq("exercise_id",e.exercise_id).select("id");if(n)throw new Error(n.message);if(!s||s.length===0){const{error:i}=await a.from("one_rm_records").insert({athlete_id:Number(e.athlete_id),exercise_id:e.exercise_id,notes:e.notes,one_rm:0,recorded_at:new Date().toISOString()});if(i)throw new Error(i.message)}return{status:"ok"}}const t=h(_.ONE_RM)||[],r=t.findIndex(s=>String(s.athlete_id)===String(e.athlete_id)&&s.exercise_id===e.exercise_id);return r>=0?t[r].notes=e.notes:t.push({athlete_id:Number(e.athlete_id),exercise_id:e.exercise_id,one_rm:0,notes:e.notes,id:Date.now(),date:new Date().toISOString()}),I(_.ONE_RM,t),{status:"ok"}}async function yt(e){if(c()){const{data:t,error:r}=await a.from("strength_folders").select("*").eq("type",e).order("sort_order",{ascending:!0});if(r)throw new Error(r.message);return(t??[]).map(s=>({id:N(s.id),name:String(s.name||""),type:s.type,sort_order:N(s.sort_order)}))}return[]}async function Et(e,t){if(!c())throw new Error("Supabase requis");const{data:r,error:s}=await a.from("strength_folders").insert({name:e,type:t}).select("*").single();if(s)throw new Error(s.message);return{id:N(r.id),name:String(r.name),type:r.type,sort_order:N(r.sort_order)}}async function bt(e,t){if(!c())throw new Error("Supabase requis");const{error:r}=await a.from("strength_folders").update({name:t}).eq("id",e);if(r)throw new Error(r.message)}async function vt(e){if(!c())throw new Error("Supabase requis");const{error:t}=await a.from("strength_folders").delete().eq("id",e);if(t)throw new Error(t.message)}async function It(e,t,r){if(!c())throw new Error("Supabase requis");const{error:s}=await a.from(r).update({folder_id:t}).eq("id",e);if(s)throw new Error(s.message)}async function Tt(){return c()?null:(await q(100),h(_.ASSIGNMENTS)||[])}async function Nt(e,t,r){if(c()){const{permanentGroupIds:n,temporaryGroupIds:i,hasActiveTemporary:o}=await Q(t??null),u=[];if(t!=null&&u.push(`target_user_id.eq.${t}`),(o?i:n).forEach(p=>u.push(`target_group_id.eq.${p}`)),!u.length)return[];let l=a.from("session_assignments").select("*").or(u.join(","));r?.assignmentType&&(l=l.eq("assignment_type",r.assignmentType)),r?.status?l=l.eq("status",r.status):l=l.neq("status","completed");const{data:m,error:S}=await l;if(S)throw new Error(S.message);if(!m?.length)return[];const[f,w]=await Promise.all([B(),z()]),b=new Map(f.map(p=>[p.id,p])),T=new Map(w.map(p=>[p.id,p])),x=m.map(p=>{const y=p.assignment_type==="strength"?"strength":"swim",g=v(y==="swim"?p.swim_catalog_id:p.strength_session_id)??0,E=p.scheduled_date||p.created_at||"",A=String(p.status||"assigned"),R=y==="swim"?b.get(g):void 0,O=y==="strength"?T.get(g):void 0,M={id:N(p.id,Date.now()),session_id:g,session_type:y,title:y==="swim"?R?.name??"Séance natation":O?.title??"Séance musculation",description:R?.description??O?.description??"",assigned_date:E||new Date().toISOString(),assigned_slot:p.scheduled_slot??null,status:A,items:O?.items??R?.items};return y==="strength"&&(M.cycle=O?.cycle??"endurance"),M}),C=new Map(x.map(p=>[p.id,p]));return Array.from(C.values())}return await q(200),(h(_.ASSIGNMENTS)||[]).filter(n=>!(t!=null&&String(t)!==""&&String(n.target_user_id)===String(t)||n.target_athlete===e)||r?.assignmentType&&n.session_type!==r.assignmentType?!1:r?.status?n.status===r.status:n.status!=="completed")}async function qt(e,t){const r=e.assignment_type??e.session_type;if(!r)return{status:"error"};const s=e.scheduled_date??e.assigned_date??new Date().toISOString();if(c()){const d={assignment_type:r,scheduled_date:s,scheduled_slot:e.scheduled_slot??null,assigned_by:t??null,status:"assigned"};r==="swim"?d.swim_catalog_id=e.session_id:d.strength_session_id=e.session_id,e.target_user_id!==null&&e.target_user_id!==void 0?d.target_user_id=e.target_user_id:e.target_group_id!==null&&e.target_group_id!==void 0&&(d.target_group_id=e.target_group_id);const{data:l,error:m}=await a.from("session_assignments").insert(d).select("id").single();if(m)throw new Error(m.message);const{data:S,error:f}=await a.from("notifications").insert({title:"Nouvelle séance assignée",body:`Séance prévue le ${s}.`,type:"assignment"}).select("id").single();if(!f&&S){const w={notification_id:S.id};e.target_user_id&&(w.target_user_id=e.target_user_id),e.target_group_id&&(w.target_group_id=e.target_group_id),await a.from("notification_targets").insert(w)}return{status:"assigned"}}let n;if(r==="swim"?n=(h(_.SWIM_SESSIONS)||[]).find(d=>d.id===e.session_id):n=(h(_.STRENGTH_SESSIONS)||[]).find(d=>d.id===e.session_id),!n)return{status:"error"};const i={id:Date.now(),session_id:e.session_id,session_type:r,target_athlete:e.target_athlete??"",target_user_id:e.target_user_id??null,target_group_id:e.target_group_id??null,assigned_date:s,title:n.name??n.title,description:n.description,items:n.items,status:"assigned"},o=h(_.ASSIGNMENTS)||[];I(_.ASSIGNMENTS,[...o,i]);const u=h(_.NOTIFICATIONS)||[];return I(_.NOTIFICATIONS,[...u,{id:Date.now()+1,sender:"Coach",target_athlete:e.target_athlete,target_user_id:e.target_user_id??null,target_group_id:e.target_group_id??null,title:"Nouvelle séance assignée",message:`Séance ${n.title??n.name} prévue le ${s}.`,type:"assignment",related_id:i.id,read:!1,date:new Date().toISOString()}]),{status:"assigned"}}async function xt(e){if(c()){const{error:s}=await a.from("session_assignments").delete().eq("id",e);if(s)throw new Error(s.message);return{status:"deleted"}}const r=(h(_.ASSIGNMENTS)||[]).filter(s=>s.id!==e);return I(_.ASSIGNMENTS,r),{status:"deleted"}}async function Ct(e){if(!c())return[];let t=a.from("session_assignments").select("*").gte("scheduled_date",e.from).lte("scheduled_date",e.to);if(e.groupId)t=t.eq("target_group_id",e.groupId);else if(e.userId){const{permanentGroupIds:d,temporaryGroupIds:l,hasActiveTemporary:m}=await Q(e.userId),S=[`target_user_id.eq.${e.userId}`];(m?l:d).forEach(w=>S.push(`target_group_id.eq.${w}`)),t=t.or(S.join(","))}else return[];const{data:r,error:s}=await t;if(s)throw new Error(s.message);if(!r?.length)return[];const[n,i]=await Promise.all([B(),z()]),o=new Map(n.map(d=>[d.id,d])),u=new Map(i.map(d=>[d.id,d]));return r.map(d=>{const l=d.assignment_type==="strength"?"strength":"swim",m=v(l==="swim"?d.swim_catalog_id:d.strength_session_id)??0,S=l==="swim"?o.get(m):void 0,f=l==="strength"?u.get(m):void 0;return{id:N(d.id,0),title:l==="swim"?S?.name??"Séance natation":f?.title??"Séance musculation",type:l,scheduledDate:d.scheduled_date??"",scheduledSlot:d.scheduled_slot??null,targetLabel:"",targetType:d.target_group_id?"group":"user",status:d.status??"assigned"}})}async function Rt(e){if(c()){const l=e?{from_date:e}:{},{data:m,error:S}=await a.rpc("get_hall_of_fame",l);if(!S&&m){const f=Array.isArray(m)?m:[],w=[...f].map(g=>({athlete_name:g.athlete_name,total_distance:Number(g.total_distance??0),avatar_url:g.avatar_url??null})).sort((g,E)=>E.total_distance-g.total_distance).slice(0,5),b=[...f].map(g=>({athlete_name:g.athlete_name,avg_effort:Number(g.avg_performance??g.avg_engagement??0),avatar_url:g.avatar_url??null})).sort((g,E)=>E.avg_effort-g.avg_effort).slice(0,5),T=[...f].map(g=>({athlete_name:g.athlete_name,avg_engagement:Number(g.avg_engagement??0),avatar_url:g.avatar_url??null})).sort((g,E)=>E.avg_engagement-g.avg_engagement).slice(0,5);let x=[];const C=e?{from_date:e}:{},{data:p,error:y}=await a.rpc("get_hall_of_fame_strength",C);return!y&&p&&(x=(Array.isArray(p)?p:[]).map(g=>({athlete_name:g.athlete_name??"Inconnu",total_volume:Number(g.total_volume??0),total_reps:Number(g.total_reps??0),total_sets:Number(g.total_sets??0),max_weight:Number(g.max_weight??0),avatar_url:g.avatar_url??null}))),{distance:w,performance:b,engagement:T,strength:x}}}await q(300);const t=h(_.SESSIONS)||[],r=h(_.STRENGTH_RUNS)||[],s=e?t.filter(l=>l.session_date>=e||l.date>=e):t,n=e?r.filter(l=>(l.started_at??l.date??"")>=e):r,i=new Map;s.forEach(l=>{i.has(l.athlete_name)||i.set(l.athlete_name,{distance:0,effortSum:0,count:0,engagementSum:0,engagementCount:0});const m=i.get(l.athlete_name);m.distance+=l.distance,m.effortSum+=l.effort,m.count+=1,l.engagement!==null&&l.engagement!==void 0&&Number.isFinite(l.engagement)&&(m.engagementSum+=l.engagement,m.engagementCount+=1)});const o=Array.from(i.entries()).map(([l,m])=>({athlete_name:l,total_distance:m.distance,avg_effort:m.effortSum/m.count,avg_engagement:m.engagementCount?m.engagementSum/m.engagementCount:0})),u=new Map;n.forEach(l=>{u.has(l.athlete_name)||u.set(l.athlete_name,{volume:0,reps:0,sets:0,maxWeight:0});const m=u.get(l.athlete_name);l.logs&&l.logs.forEach(S=>{const f=Number(S.reps??0),w=Number(S.weight??0);m.volume+=f*w,m.reps+=f,m.sets+=1,w>m.maxWeight&&(m.maxWeight=w)})});const d=Array.from(u.entries()).map(([l,m])=>({athlete_name:l,total_volume:m.volume,total_reps:m.reps,total_sets:m.sets,max_weight:m.maxWeight}));return{distance:[...o].sort((l,m)=>m.total_distance-l.total_distance).slice(0,5),performance:[...o].sort((l,m)=>m.avg_effort-l.avg_effort).slice(0,5),engagement:[...o].sort((l,m)=>m.avg_engagement-l.avg_engagement).slice(0,5),strength:[...d].sort((l,m)=>m.total_volume-l.total_volume).slice(0,5)}}async function At(e){if(!c())return[];let t=a.from("club_records").select("*");e.pool_m&&(t=t.eq("pool_m",e.pool_m)),e.sex&&(t=t.eq("sex",e.sex)),e.age&&(t=t.eq("age",e.age)),e.event_code&&(t=t.eq("event_code",e.event_code));const{data:r,error:s}=await t;if(s)throw new Error(s.message);return r??[]}async function Ot(){if(!c())return[];const{data:e,error:t}=await a.from("club_record_swimmers").select("*");if(t)throw new Error(t.message);return(e??[]).map(r=>({...r,is_active:r.is_active?1:0}))}async function Dt(e){if(!c())return null;const t=e.iuf?.trim()||null;if(t){const{data:n,error:i}=await a.from("club_record_swimmers").select("id, display_name, source_type").eq("iuf",t).limit(1);if(i)throw new Error(i.message);if(n&&n.length>0){const o=n[0],u=o.source_type==="user"?"inscrit":"déjà ajouté";throw new Error(`Un nageur avec cet IUF existe déjà : ${o.display_name} (${u})`)}}const{data:r,error:s}=await a.from("club_record_swimmers").insert({source_type:"manual",display_name:e.display_name,iuf:t,sex:e.sex??null,birthdate:e.birthdate??null,is_active:e.is_active!==!1}).select().single();if(s)throw new Error(s.message);return r?{...r,is_active:r.is_active?1:0}:null}async function Mt(e,t){if(!c())return null;let r;if(t.iuf!==void 0&&(r=typeof t.iuf=="string"&&t.iuf.trim()||null,r)){const{data:o,error:u}=await a.from("club_record_swimmers").select("id, display_name, source_type").eq("iuf",r).neq("id",e).limit(1);if(u)throw new Error(u.message);if(o&&o.length>0){const d=o[0],l=d.source_type==="user"?"inscrit":"déjà ajouté";throw new Error(`Un nageur avec cet IUF existe déjà : ${d.display_name} (${l})`)}}const s={};t.iuf!==void 0&&(s.iuf=r??null),t.is_active!==void 0&&(s.is_active=t.is_active),t.sex!==void 0&&(s.sex=t.sex),t.birthdate!==void 0&&(s.birthdate=t.birthdate);const{data:n,error:i}=await a.from("club_record_swimmers").update(s).eq("id",e).select().single();if(i)throw new Error(i.message);return n?{...n,is_active:n.is_active?1:0}:null}async function kt(e,t){if(!c())return null;const r={};t.iuf!==void 0&&(r.iuf=t.iuf),t.is_active!==void 0&&(r.is_active=t.is_active),t.sex!==void 0&&(r.sex=t.sex),t.birthdate!==void 0&&(r.birthdate=t.birthdate);const{data:s,error:n}=await a.from("club_record_swimmers").update(r).eq("user_id",e).eq("source_type","user").select().single();if(n)throw new Error(n.message);return s?{...s,is_active:s.is_active?1:0}:null}async function Ut(){if(!c())return null;const{data:e,error:t}=await a.functions.invoke("import-club-records");if(t){const r=e?.error??t.message;throw new Error(String(r))}return e}async function Gt(e){if(!c())return[];let t=a.from("import_logs").select("*").order("started_at",{ascending:!1});e?.swimmerIuf&&(t=t.eq("swimmer_iuf",e.swimmerIuf)),e?.limit&&(t=t.limit(e.limit));const{data:r,error:s}=await t;if(s)throw new Error(s.message);return r??[]}async function Ft(e,t){if(!c())throw new Error("Supabase not configured");const{data:r,error:s}=await a.functions.invoke("ffn-performances",{body:{swimmer_iuf:e,swimmer_name:t??null}});if(s){const n=r?.error??s.message;throw new Error(String(n))}return r??{total_found:0,new_imported:0,already_existed:0}}async function Pt(e){if(c()){let s=a.from("swim_records").select("*").order("record_date",{ascending:!1});e.athleteId&&(s=s.eq("athlete_id",e.athleteId));const{data:n,error:i}=await s;if(i)throw new Error(i.message);const o=n??[];return{records:o,pagination:{limit:o.length,offset:0,total:o.length}}}const r=(h(_.SWIM_RECORDS)||[]).filter(s=>e.athleteId?s.athlete_id===e.athleteId:e.athleteName?s.athlete_name===e.athleteName:!1);return{records:r,pagination:{limit:r.length,offset:0,total:r.length}}}async function Ht(e){if(c()){const s={athlete_id:e.athlete_id??null,event_name:e.event_name,pool_length:e.pool_length??null,time_seconds:e.time_seconds??null,record_date:e.record_date??null,notes:e.notes??null};if(e.id){const{error:n}=await a.from("swim_records").update(s).eq("id",e.id);if(n)throw new Error(n.message)}else{const{error:n}=await a.from("swim_records").insert(s);if(n)throw new Error(n.message)}return{status:"ok"}}const t=h(_.SWIM_RECORDS)||[];if(e.id){const s=t.map(n=>n.id===e.id?{...n,...e,athlete_id:e.athlete_id??n.athlete_id}:n);return I(_.SWIM_RECORDS,s),{status:"ok"}}const r={...e,id:Date.now(),athlete_id:e.athlete_id??-1,athlete_name:e.athleteName??null};return I(_.SWIM_RECORDS,[...t,r]),{status:"created"}}async function Lt(e){if(!c())return[];let t=a.from("swimmer_performances").select("*").order("competition_date",{ascending:!1});e.userId&&(t=t.eq("user_id",e.userId)),e.iuf&&(t=t.eq("swimmer_iuf",e.iuf)),e.eventCode&&(t=t.eq("event_code",e.eventCode)),e.poolLength&&(t=t.eq("pool_length",e.poolLength)),e.fromDate&&(t=t.gte("competition_date",e.fromDate)),e.toDate&&(t=t.lte("competition_date",e.toDate)),e.limit&&(t=t.limit(e.limit));const{data:r,error:s}=await t;if(s)throw new Error(s.message);return r??[]}async function jt(e){if(!c())throw new Error("Supabase not configured");const{data:t,error:r}=await a.functions.invoke("ffn-performances",{body:{swimmer_iuf:e.iuf,user_id:e.userId??null}});if(r){const s=t?.error??r.message;throw new Error(String(s))}return t??{total_found:0,new_imported:0,already_existed:0}}async function $t(){if(!c())return null;const{data:e,error:t}=await a.functions.invoke("import-club-records",{body:{mode:"recalculate"}});if(t){const r=e?.error??t.message;throw new Error(String(r))}return e}async function Bt(){if(!c())return;const{data:e,error:t}=await a.from("users").select("id, display_name, role, birthdate").eq("role","athlete").eq("is_active",!0);if(t)throw new Error(t.message);if(!e||e.length===0)return;const{data:r}=await a.from("club_record_swimmers").select("id, user_id, iuf, sex, birthdate, display_name").eq("source_type","user"),s=new Map((r??[]).map(o=>[o.user_id,o])),{data:n}=await a.from("user_profiles").select("user_id, ffn_iuf, birthdate, sex"),i=new Map((n??[]).map(o=>[o.user_id,o]));for(const o of e){const u=i.get(o.id),d=u?.ffn_iuf??null,l=u?.sex??null,m=u?.birthdate??o.birthdate??null,S=s.get(o.id);if(!S)await a.from("club_record_swimmers").insert({source_type:"user",user_id:o.id,display_name:o.display_name,iuf:d,sex:l,birthdate:m,is_active:!0});else{const f={};d&&d!==S.iuf&&(f.iuf=d),l&&l!==S.sex&&(f.sex=l),m&&m!==S.birthdate&&(f.birthdate=m),o.display_name&&o.display_name!==S.display_name&&(f.display_name=o.display_name),Object.keys(f).length>0&&await a.from("club_record_swimmers").update(f).eq("id",S.id)}}}async function Wt(e){if(!c())return[];let t=a.from("club_performances").select("*").eq("event_code",e.event_code).eq("pool_m",e.pool_m).eq("sex",e.sex).order("time_ms",{ascending:!0});e.age!=null&&(t=t.eq("age",e.age));const{data:r,error:s}=await t;if(s)throw new Error(s.message);return r??[]}async function zt(e){if(!c())return null;const{data:t,error:r}=await a.from("app_settings").select("value").eq("key",e).single();return r?null:t?.value??null}async function Xt(e,t){if(!c())throw new Error("Supabase not configured");const{data:r,error:s}=await a.rpc("merge_club_record_swimmers",{p_manual_id:e,p_user_swimmer_id:t});if(s)throw new Error(s.message);return r}async function Yt(e,t){if(!c())return;const{error:r}=await a.from("app_settings").upsert({key:e,value:t,updated_at:new Date().toISOString()},{onConflict:"key"});if(r)throw new Error(r.message)}async function Vt(e){if(!c())return[];const{data:t,error:r}=await a.from("swim_exercise_logs").select("*").eq("session_id",e).order("created_at",{ascending:!0});if(r)throw new Error(r.message);return(t??[]).map(ae)}async function Jt(e,t=50){if(!c())return[];const{data:r,error:s}=await a.from("swim_exercise_logs").select("*").eq("user_id",e).order("created_at",{ascending:!1}).limit(t);if(s)throw new Error(s.message);return(r??[]).map(ae)}async function Kt(e,t,r){if(!c())return;const{error:s}=await a.from("swim_exercise_logs").delete().eq("session_id",e).eq("user_id",t);if(s)throw new Error(s.message);if(r.length===0)return;const n=r.map(o=>({session_id:e,user_id:t,exercise_label:o.exercise_label,source_item_id:o.source_item_id??null,split_times:o.split_times??[],tempo:o.tempo??null,stroke_count:o.stroke_count??[],notes:o.notes??null})),{error:i}=await a.from("swim_exercise_logs").insert(n);if(i)throw new Error(i.message)}async function Qt(e,t){if(!c())return;const r={updated_at:new Date().toISOString()};t.exercise_label!==void 0&&(r.exercise_label=t.exercise_label),t.split_times!==void 0&&(r.split_times=t.split_times),t.tempo!==void 0&&(r.tempo=t.tempo),t.stroke_count!==void 0&&(r.stroke_count=t.stroke_count),t.notes!==void 0&&(r.notes=t.notes);const{error:s}=await a.from("swim_exercise_logs").update(r).eq("id",e);if(s)throw new Error(s.message)}async function Zt(e){if(!c())return;const{error:t}=await a.from("swim_exercise_logs").delete().eq("id",e);if(t)throw new Error(t.message)}function ae(e){return{id:String(e.id),session_id:Number(e.session_id),user_id:String(e.user_id),exercise_label:String(e.exercise_label??""),source_item_id:e.source_item_id!=null?Number(e.source_item_id):null,split_times:Array.isArray(e.split_times)?e.split_times:[],tempo:e.tempo!=null?Number(e.tempo):null,stroke_count:Array.isArray(e.stroke_count)?e.stroke_count:[],notes:e.notes!=null?String(e.notes):null,created_at:String(e.created_at??""),updated_at:String(e.updated_at??"")}}async function er(){if(!c())return[];const{data:e,error:t}=await a.from("groups").select("id, name, is_active, parent_group_id, created_by, created_at").eq("is_temporary",!0).is("parent_group_id",null).order("created_at",{ascending:!1});if(t)throw new Error(t.message);if(!e?.length)return[];const r=e.map(u=>u.id),{data:s}=await a.from("groups").select("parent_group_id").eq("is_temporary",!0).in("parent_group_id",r),n=new Map;(s??[]).forEach(u=>{n.set(u.parent_group_id,(n.get(u.parent_group_id)??0)+1)});const{data:i}=await a.from("group_members").select("group_id").in("group_id",r),o=new Map;return(i??[]).forEach(u=>{o.set(u.group_id,(o.get(u.group_id)??0)+1)}),e.map(u=>({id:N(u.id,0),name:u.name,is_active:u.is_active??!0,parent_group_id:u.parent_group_id??null,member_count:o.get(u.id)??0,subgroup_count:n.get(u.id)??0,created_at:u.created_at??"",created_by:u.created_by??0}))}async function tr(e){if(!c())return null;const{data:t,error:r}=await a.from("groups").select("id, name, is_active").eq("id",e).eq("is_temporary",!0).single();if(r||!t)return null;const{data:s}=await a.from("group_members").select("user_id, users!inner(display_name)").eq("group_id",e),n=(s??[]).map(m=>m.user_id),{data:i}=n.length?await a.from("group_members").select("user_id, group_id, groups!inner(name, is_temporary)").in("user_id",n).eq("groups.is_temporary",!1):{data:[]},o=new Map;(i??[]).forEach(m=>{o.has(m.user_id)||o.set(m.user_id,m.groups?.name??null)});const u=(s??[]).map(m=>({user_id:m.user_id,display_name:m.users?.display_name??"",permanent_group_label:o.get(m.user_id)??null})),{data:d}=await a.from("groups").select("id, name").eq("parent_group_id",e).eq("is_temporary",!0),l=await Promise.all((d??[]).map(async m=>{const{data:S}=await a.from("group_members").select("user_id, users!inner(display_name)").eq("group_id",m.id);return{id:m.id,name:m.name,members:(S??[]).map(f=>({user_id:f.user_id,display_name:f.users?.display_name??""}))}}));return{id:t.id,name:t.name,is_active:t.is_active,members:u,subgroups:l}}async function rr(e){if(!c())throw new Error("Supabase required");if(e.member_user_ids.length>0){const{data:n}=await a.from("group_members").select("user_id, group_id, groups!inner(is_temporary, is_active, parent_group_id)").in("user_id",e.member_user_ids).eq("groups.is_temporary",!0).eq("groups.is_active",!0),i=(n??[]).filter(o=>{const u=o.groups;return!(e.parent_group_id&&(o.group_id===e.parent_group_id||u.parent_group_id===e.parent_group_id))});if(i.length>0){const o=[...new Set(i.map(u=>u.user_id))];throw new Error(`Nageurs déjà dans un groupe temporaire actif: IDs ${o.join(", ")}`)}}if(e.parent_group_id&&e.member_user_ids.length>0){const{data:n}=await a.from("group_members").select("user_id").eq("group_id",e.parent_group_id),i=new Set((n??[]).map(u=>u.user_id)),o=e.member_user_ids.filter(u=>!i.has(u));if(o.length>0)throw new Error(`Nageurs non membres du groupe parent: IDs ${o.join(", ")}`)}const{data:t,error:r}=await a.from("groups").insert({name:e.name.trim(),is_temporary:!0,is_active:!0,parent_group_id:e.parent_group_id??null}).select("id").single();if(r)throw new Error(r.message);const s=t.id;if(e.member_user_ids.length>0){const n=e.member_user_ids.map(o=>({group_id:s,user_id:o})),{error:i}=await a.from("group_members").insert(n);if(i)throw new Error(i.message)}return{id:s}}async function sr(e,t){if(!c())throw new Error("Supabase required");if(!t.length)return;const{data:r}=await a.from("group_members").select("user_id, group_id, groups!inner(is_temporary, is_active, parent_group_id)").in("user_id",t).eq("groups.is_temporary",!0).eq("groups.is_active",!0),s=(r??[]).filter(o=>!(o.group_id===e||o.groups.parent_group_id===e));if(s.length>0){const o=[...new Set(s.map(u=>u.user_id))];throw new Error(`Nageurs déjà dans un groupe temporaire actif: IDs ${o.join(", ")}`)}const n=t.map(o=>({group_id:e,user_id:o})),{error:i}=await a.from("group_members").insert(n);if(i)throw new Error(i.message)}async function nr(e,t){if(!c())throw new Error("Supabase required");const{data:r}=await a.from("groups").select("id").eq("parent_group_id",e).eq("is_temporary",!0),s=[e,...(r??[]).map(i=>i.id)],{error:n}=await a.from("group_members").delete().eq("user_id",t).in("group_id",s);if(n)throw new Error(n.message)}async function ar(e){if(!c())throw new Error("Supabase required");const{error:t}=await a.from("groups").update({is_active:!1}).or(`id.eq.${e},parent_group_id.eq.${e}`).eq("is_temporary",!0);if(t)throw new Error(t.message)}async function ir(e){if(!c())throw new Error("Supabase required");const{data:t}=await a.from("group_members").select("user_id").eq("group_id",e),r=(t??[]).map(n=>n.user_id);if(r.length>0){const{data:n}=await a.from("group_members").select("user_id, groups!inner(is_temporary, is_active)").in("user_id",r).eq("groups.is_temporary",!0).eq("groups.is_active",!0);if(n&&n.length>0)throw new Error("Certains nageurs sont déjà dans un autre groupe temporaire actif.")}const{error:s}=await a.from("groups").update({is_active:!0}).or(`id.eq.${e},parent_group_id.eq.${e}`).eq("is_temporary",!0);if(s)throw new Error(s.message)}async function or(e){if(!c())throw new Error("Supabase required");const{data:t}=await a.from("groups").select("is_active").eq("id",e).single();if(t?.is_active)throw new Error("Impossible de supprimer un groupe temporaire actif. Désactivez-le d'abord.");await a.from("groups").delete().eq("parent_group_id",e).eq("is_temporary",!0);const{error:r}=await a.from("groups").delete().eq("id",e).eq("is_temporary",!0);if(r)throw new Error(r.message)}async function cr(){if(!c())return[];const{data:e,error:t}=await a.from("competitions").select("*").order("date",{ascending:!0});if(t)throw new Error(t.message);return e??[]}async function ur(e){if(!c())throw new Error("Supabase not available");const{data:{user:t}}=await a.auth.getUser(),{data:r,error:s}=await a.from("competitions").insert({...e,created_by:t?.id}).select().single();if(s)throw new Error(s.message);return r}async function dr(e,t){if(!c())throw new Error("Supabase not available");const{data:r,error:s}=await a.from("competitions").update(t).eq("id",e).select().single();if(s)throw new Error(s.message);return r}async function lr(e){if(!c())throw new Error("Supabase not available");const{error:t}=await a.from("competitions").delete().eq("id",e);if(t)throw new Error(t.message)}async function mr(e){if(!c())return[];const{data:t,error:r}=await a.from("competition_assignments").select("*").eq("competition_id",e);if(r)throw new Error(r.message);return t??[]}async function _r(e,t){if(!c())return;const{error:r}=await a.from("competition_assignments").delete().eq("competition_id",e);if(r)throw new Error(r.message);if(t.length>0){const s=t.map(i=>({competition_id:e,athlete_id:i})),{error:n}=await a.from("competition_assignments").insert(s);if(n)throw new Error(n.message)}}async function fr(e){if(!c())return[];let t=a.from("competition_assignments").select("competition_id");e&&(t=t.eq("athlete_id",e));const{data:r,error:s}=await t;if(s)throw new Error(s.message);return(r??[]).map(n=>n.competition_id)}async function ie(e){if(!c())return[];let t=a.from("objectives").select("*, competitions(name, date)").order("created_at",{ascending:!1});e&&(t=t.eq("athlete_id",e));const{data:r,error:s}=await t;if(s)throw new Error(s.message);return(r??[]).map(n=>({id:n.id,athlete_id:n.athlete_id,competition_id:n.competition_id,event_code:n.event_code,pool_length:n.pool_length,target_time_seconds:n.target_time_seconds!=null?Number(n.target_time_seconds):null,text:n.text,created_by:n.created_by,created_at:n.created_at,competition_name:n.competitions?.name??null,competition_date:n.competitions?.date??null}))}async function gr(){if(!c())return[];const{data:{user:e}}=await a.auth.getUser();return e?ie(e.id):[]}async function pr(e){if(!c())throw new Error("Supabase not available");const{data:{user:t}}=await a.auth.getUser(),{data:r,error:s}=await a.from("objectives").insert({...e,created_by:t?.id}).select().single();if(s)throw new Error(s.message);return r}async function wr(e,t){if(!c())throw new Error("Supabase not available");const{data:r,error:s}=await a.from("objectives").update(t).eq("id",e).select().single();if(s)throw new Error(s.message);return r}async function hr(e){if(!c())throw new Error("Supabase not available");const{error:t}=await a.from("objectives").delete().eq("id",e);if(t)throw new Error(t.message)}async function Sr(){if(!c())return new Map;const{data:e,error:t}=await a.rpc("get_objectives_counts_by_user");if(t)throw new Error(t.message);const r=new Map;for(const s of e??[])r.set(s.user_id,Number(s.objectives_count));return r}async function yr(e){if(!c())return[];let t=a.from("planned_absences").select("*");e?.userId&&(t=t.eq("user_id",e.userId)),e?.from&&(t=t.gte("date",e.from)),e?.to&&(t=t.lte("date",e.to));const{data:r,error:s}=await t.order("date",{ascending:!0});if(s)throw new Error(s.message);return r??[]}async function Er(){if(!c())return[];const{data:e,error:t}=await a.from("planned_absences").select("*").order("date",{ascending:!0});if(t)throw new Error(t.message);return e??[]}async function br(e,t){if(!c())throw new Error("Supabase not available");const{data:{session:r}}=await a.auth.getSession(),s=r?.user?.app_metadata?.app_user_id;if(!s)throw new Error("User ID not found");const{data:n,error:i}=await a.from("planned_absences").upsert({user_id:s,date:e,reason:t??null},{onConflict:"user_id,date"}).select().single();if(i)throw new Error(i.message);return n}async function vr(e){if(!c())return;const{data:{session:t}}=await a.auth.getSession(),r=t?.user?.app_metadata?.app_user_id;if(!r)return;const{error:s}=await a.from("planned_absences").delete().eq("user_id",r).eq("date",e);if(s)throw new Error(s.message)}async function Ir(e){if(!c())return[];let t=a.from("training_cycles").select("*, start_comp:competitions!start_competition_id(name, date), end_comp:competitions!end_competition_id(name, date)").order("created_at",{ascending:!1});e?.athleteId&&(t=t.eq("athlete_id",e.athleteId)),e?.groupId&&(t=t.eq("group_id",e.groupId));const{data:r,error:s}=await t;if(s)throw new Error(s.message);return(r??[]).map(n=>({id:n.id,group_id:n.group_id,athlete_id:n.athlete_id,start_competition_id:n.start_competition_id,end_competition_id:n.end_competition_id,start_date:n.start_date,name:n.name,notes:n.notes,created_by:n.created_by,created_at:n.created_at,start_competition_name:n.start_comp?.name??null,start_competition_date:n.start_comp?.date??null,end_competition_name:n.end_comp?.name??null,end_competition_date:n.end_comp?.date??null}))}async function Tr(e){if(!c())throw new Error("Supabase not available");const{data:{user:t}}=await a.auth.getUser(),{data:r,error:s}=await a.from("training_cycles").insert({...e,created_by:t?.id}).select().single();if(s)throw new Error(s.message);return r}async function Nr(e,t){if(!c())throw new Error("Supabase not available");const{data:r,error:s}=await a.from("training_cycles").update(t).eq("id",e).select().single();if(s)throw new Error(s.message);return r}async function qr(e){if(!c())throw new Error("Supabase not available");const{error:t}=await a.from("training_cycles").delete().eq("id",e);if(t)throw new Error(t.message)}async function xr(e){if(!c())return[];const{data:t,error:r}=await a.from("training_weeks").select("*").eq("cycle_id",e).order("week_start",{ascending:!0});if(r)throw new Error(r.message);return t??[]}async function Cr(e){if(!c())throw new Error("Supabase not available");const{data:t,error:r}=await a.from("training_weeks").upsert(e,{onConflict:"cycle_id,week_start"}).select().single();if(r)throw new Error(r.message);return t}async function Rr(e){if(!c())throw new Error("Supabase not available");if(e.length===0)return[];const{data:t,error:r}=await a.from("training_weeks").upsert(e,{onConflict:"cycle_id,week_start"}).select();if(r)throw new Error(r.message);return t??[]}async function Ar(e){if(!c())throw new Error("Supabase not available");const{error:t}=await a.from("training_weeks").delete().eq("id",e);if(t)throw new Error(t.message)}async function Or(e){if(!c())return[];const{data:t,error:r}=await a.from("interviews").select("*").eq("athlete_id",e).order("date",{ascending:!1});if(r)throw new Error(r.message);return t??[]}async function Dr(){if(!c())return[];const{data:{user:e}}=await a.auth.getUser();if(!e)return[];const t=e.app_metadata?.app_user_id;if(!t)return[];const{data:r,error:s}=await a.from("interviews").select("*").eq("athlete_id",t).order("date",{ascending:!1});if(s)throw new Error(s.message);return r??[]}async function Mr(e){if(!c())throw new Error("Supabase not available");const{data:{user:t}}=await a.auth.getUser(),{data:r,error:s}=await a.from("interviews").insert({athlete_id:e.athlete_id,date:e.date??new Date().toISOString().slice(0,10),current_cycle_id:e.current_cycle_id??null,status:"draft_athlete",created_by:t?.id}).select().single();if(s)throw new Error(s.message);return r}async function kr(e,t){if(!c())throw new Error("Supabase not available");const{data:r,error:s}=await a.from("interviews").update(t).eq("id",e).eq("status","draft_athlete").select().single();if(s)throw new Error(s.message);return r}async function Ur(e){if(!c())throw new Error("Supabase not available");const{error:t}=await a.rpc("submit_interview_to_coach",{p_interview_id:e});if(t)throw new Error(t.message)}async function Gr(e,t){if(!c())throw new Error("Supabase not available");const{data:r,error:s}=await a.from("interviews").update(t).eq("id",e).eq("status","draft_coach").select().single();if(s)throw new Error(s.message);return r}async function Fr(e){if(!c())throw new Error("Supabase not available");const{data:t,error:r}=await a.from("interviews").update({status:"sent",sent_at:new Date().toISOString()}).eq("id",e).eq("status","draft_coach").select().single();if(r)throw new Error(r.message);return t}async function Pr(e){if(!c())throw new Error("Supabase not available");const{error:t}=await a.rpc("sign_interview",{p_interview_id:e});if(t)throw new Error(t.message)}async function Hr(e,t,r){if(!c())return null;let s=a.from("interviews").select("*").eq("athlete_id",e).eq("status","signed").lte("date",t).order("date",{ascending:!1}).limit(1);r&&(s=s.neq("id",r));const{data:n,error:i}=await s.maybeSingle();if(i)throw new Error(i.message);return n??null}async function Lr(e){if(!c())throw new Error("Supabase not available");const{error:t}=await a.from("interviews").delete().eq("id",e);if(t)throw new Error(t.message)}async function P(){if(!c())return[];const{data:e,error:t}=await a.from("training_slots").select("*").eq("is_active",!0).order("day_of_week").order("start_time");if(t)throw new Error(t.message);if(!e||e.length===0)return[];const r=e.map(o=>o.id),{data:s,error:n}=await a.from("training_slot_assignments").select("*, groups:group_id(name), coach:coach_id(display_name)").in("slot_id",r);if(n)throw new Error(n.message);const i=new Map;for(const o of s??[]){const u={id:o.id,slot_id:o.slot_id,group_id:o.group_id,group_name:o.groups?.name??"?",coach_id:o.coach_id,coach_name:o.coach?.display_name??"?",lane_count:o.lane_count},d=i.get(o.slot_id)??[];d.push(u),i.set(o.slot_id,d)}return e.map(o=>({id:o.id,day_of_week:o.day_of_week,start_time:o.start_time,end_time:o.end_time,location:o.location,is_active:o.is_active,created_by:o.created_by,created_at:o.created_at,assignments:i.get(o.id)??[]}))}async function jr(e){return(await P()).filter(r=>r.assignments.some(s=>s.group_id===e))}async function $r(e){if(!c())throw new Error("Supabase not available");const{data:t,error:r}=await a.from("training_slots").insert({day_of_week:e.day_of_week,start_time:e.start_time,end_time:e.end_time,location:e.location}).select().single();if(r)throw new Error(r.message);const s=e.assignments.map(i=>({slot_id:t.id,group_id:i.group_id,coach_id:i.coach_id,lane_count:i.lane_count}));if(s.length>0){const{error:i}=await a.from("training_slot_assignments").insert(s);if(i)throw new Error(i.message)}return(await P()).find(i=>i.id===t.id)}async function Br(e,t){if(!c())throw new Error("Supabase not available");const{error:r}=await a.from("training_slots").update({day_of_week:t.day_of_week,start_time:t.start_time,end_time:t.end_time,location:t.location}).eq("id",e);if(r)throw new Error(r.message);const{error:s}=await a.from("training_slot_assignments").delete().eq("slot_id",e);if(s)throw new Error(s.message);const n=t.assignments.map(o=>({slot_id:e,group_id:o.group_id,coach_id:o.coach_id,lane_count:o.lane_count}));if(n.length>0){const{error:o}=await a.from("training_slot_assignments").insert(n);if(o)throw new Error(o.message)}return(await P()).find(o=>o.id===e)}async function Wr(e){if(!c())return;const{error:t}=await a.from("training_slots").update({is_active:!1}).eq("id",e);if(t)throw new Error(t.message)}async function zr(e){if(!c())return[];let t=a.from("training_slot_overrides").select("*").order("override_date",{ascending:!0});e?.slotId&&(t=t.eq("slot_id",e.slotId)),e?.fromDate&&(t=t.gte("override_date",e.fromDate));const{data:r,error:s}=await t;if(s)throw new Error(s.message);return r??[]}async function Xr(e){if(!c())throw new Error("Supabase not available");const{data:t,error:r}=await a.from("training_slot_overrides").upsert({slot_id:e.slot_id,override_date:e.override_date,status:e.status,new_start_time:e.new_start_time??null,new_end_time:e.new_end_time??null,new_location:e.new_location??null,reason:e.reason??null},{onConflict:"slot_id,override_date"}).select().single();if(r)throw new Error(r.message);return t}async function Yr(e){if(!c())return;const{error:t}=await a.from("training_slot_overrides").delete().eq("id",e);if(t)throw new Error(t.message)}async function oe(e){if(!c())return[];const{data:t,error:r}=await a.from("swimmer_training_slots").select("*").eq("user_id",e).eq("is_active",!0).order("day_of_week").order("start_time");if(r)throw new Error(r.message);return t??[]}async function Vr(e){if(!c())return!1;const{count:t,error:r}=await a.from("swimmer_training_slots").select("id",{count:"exact",head:!0}).eq("user_id",e).eq("is_active",!0);if(r)throw new Error(r.message);return(t??0)>0}async function ce(e,t,r){if(!c())throw new Error("Supabase not available");const{data:s,error:n}=await a.from("training_slot_assignments").select("id, slot_id, training_slots!inner(day_of_week, start_time, end_time, location, is_active)").eq("group_id",t);if(n)throw new Error(n.message);const i=(s??[]).filter(u=>u.training_slots?.is_active).map(u=>({user_id:e,source_assignment_id:u.id,day_of_week:u.training_slots.day_of_week,start_time:u.training_slots.start_time,end_time:u.training_slots.end_time,location:u.training_slots.location,created_by:r}));if(i.length===0)return[];const{error:o}=await a.from("swimmer_training_slots").insert(i);if(o)throw new Error(o.message);return oe(e)}async function Jr(e,t){if(!c())throw new Error("Supabase not available");const{data:r,error:s}=await a.from("swimmer_training_slots").insert({user_id:e.user_id,source_assignment_id:e.source_assignment_id??null,day_of_week:e.day_of_week,start_time:e.start_time,end_time:e.end_time,location:e.location,created_by:t}).select().single();if(s)throw new Error(s.message);return r}async function Kr(e,t){if(!c())throw new Error("Supabase not available");const{data:r,error:s}=await a.from("swimmer_training_slots").update(t).eq("id",e).select().single();if(s)throw new Error(s.message);return r}async function Qr(e){if(!c())return;const{error:t}=await a.from("swimmer_training_slots").update({is_active:!1}).eq("id",e);if(t)throw new Error(t.message)}async function Zr(e,t,r){if(!c())throw new Error("Supabase not available");const{error:s}=await a.from("swimmer_training_slots").update({is_active:!1}).eq("user_id",e).eq("is_active",!0);if(s)throw new Error(s.message);return ce(e,t,r)}async function es(e){if(!c())return[];const{data:t,error:r}=await a.from("swimmer_training_slots").select("user_id, id").eq("source_assignment_id",e).eq("is_active",!0);if(r)throw new Error(r.message);return(t??[]).map(s=>({user_id:s.user_id,slot_id:s.id}))}const ss={async getCapabilities(){return c()?{mode:"supabase",version:null,timesheet:{available:!0},messaging:{available:!0}}:{mode:"local",version:null,timesheet:{available:!0},messaging:{available:!0}}},async syncFfnSwimRecords(e){if(!c())throw new Error("Supabase not configured");const{data:t,error:r}=await a.functions.invoke("ffn-sync",{body:{athlete_id:e.athleteId??null,athlete_name:e.athleteName??null,iuf:e.iuf}});if(r)throw new Error(r.message);return t??{inserted:0,updated:0,skipped:0}},async syncSession(e){if(c()){const n=ye(e),{data:i,error:o}=await a.from("dim_sessions").insert(n).select("id").single();if(o)throw new Error(o.message);return{status:"ok",sessionId:i.id}}await q(300);const t=this._get(_.SESSIONS)||[],r=Date.now(),s={...e,id:r,created_at:new Date().toISOString()};return this._save(_.SESSIONS,[...t,s]),{status:"ok",sessionId:r}},async ensureSwimSession(e){if(!c())throw new Error("Supabase required");let t=a.from("dim_sessions").select("id").eq("session_date",e.date).eq("time_slot",e.slot);e.athleteId?t=t.eq("athlete_id",Number(e.athleteId)):t=t.eq("athlete_name",e.athleteName);const{data:r}=await t.maybeSingle();if(r?.id)return r.id;const s={athlete_name:e.athleteName,session_date:e.date,time_slot:e.slot,distance:0,duration:0,rpe:5,performance:5,engagement:5,fatigue:5};e.athleteId&&(s.athlete_id=Number(e.athleteId));const{data:n,error:i}=await a.from("dim_sessions").insert(s).select("id").single();if(i)throw new Error(i.message);return n.id},async getSessions(e,t){const r=t!=null&&String(t)!=="";if(c()){let n=a.from("dim_sessions").select("*").order("session_date",{ascending:!1});r?n=n.eq("athlete_id",Number(t)):n=n.eq("athlete_name",e);const{data:i,error:o}=await n;if(o)throw new Error(o.message);return(i??[]).map(Ee).filter(u=>!!u)}return await q(200),(this._get(_.SESSIONS)||[]).filter(n=>r&&n.athlete_id?String(n.athlete_id)===String(t):n.athlete_name.toLowerCase()===e.toLowerCase()).map(n=>({...n,effort:D(n.effort)??n.effort,feeling:D(n.feeling)??n.feeling,rpe:D(n.rpe??null),performance:D(n.performance??null),engagement:D(n.engagement??null),fatigue:D(n.fatigue??null)})).sort((n,i)=>new Date(i.date).getTime()-new Date(n.date).getTime())},async updateSession(e){if(c()){const n={athlete_name:e.athlete_name,session_date:e.date,time_slot:e.slot,distance:e.distance,duration:e.duration,rpe:k(e.effort),performance:k(e.performance??e.feeling),engagement:k(e.engagement??e.feeling),fatigue:k(e.feeling),comments:e.comments},{error:i}=await a.from("dim_sessions").update(n).eq("id",e.id);if(i)throw new Error(i.message);return{status:"updated"}}await q(200);const t=this._get(_.SESSIONS)||[],r=t.findIndex(n=>n.id===e.id);if(r===-1)return{status:"missing"};const s=[...t];return s[r]={...s[r],...e},this._save(_.SESSIONS,s),{status:"updated"}},async deleteSession(e){if(c()){const{error:s}=await a.from("dim_sessions").delete().eq("id",e);if(s)throw new Error(s.message);return{status:"deleted"}}await q(200);const r=(this._get(_.SESSIONS)||[]).filter(s=>s.id!==e);return this._save(_.SESSIONS,r),{status:"deleted"}},async seedDemoData(){const e=[{id:1,nom_exercice:"Squat",description:"Flexion des jambes",exercise_type:"strength"},{id:2,nom_exercice:"Développé Couché",description:"Poussée horizontale",exercise_type:"strength"},{id:3,nom_exercice:"Tractions",description:"Tirage vertical",exercise_type:"strength"},{id:4,nom_exercice:"Rotations Élastique",description:"Coiffe des rotateurs",exercise_type:"warmup"}];this._save(_.EXERCISES,e);const t={id:101,title:"Full Body A",description:"Séance globale",cycle:"Endurance",items:[{exercise_id:4,exercise_name:"Rotations Élastique",category:"warmup",order_index:0,sets:2,reps:15,rest_seconds:30,percent_1rm:0},{exercise_id:1,exercise_name:"Squat",category:"strength",order_index:1,sets:4,reps:10,rest_seconds:90,percent_1rm:70},{exercise_id:2,exercise_name:"Développé Couché",category:"strength",order_index:2,sets:4,reps:10,rest_seconds:90,percent_1rm:70}]};this._save(_.STRENGTH_SESSIONS,[t]);const r={id:201,name:"VMA 100",description:"Travail de vitesse",created_by:1,items:[{label:"Échauffement 4N",distance:400,intensity:"Souple",notes:"Progressif"},{label:"Corps NL",distance:1e3,intensity:"Max",notes:"10x100 départ 1:30"}]};this._save(_.SWIM_SESSIONS,[r]);const s=new Date().toISOString().split("T")[0];return await this.assignments_create({session_id:101,assignment_type:"strength",target_athlete:"Camille",assigned_date:s}),{status:"seeded"}},_get(e){const t=localStorage.getItem(e);return t?JSON.parse(t):null},_save(e,t){localStorage.setItem(e,JSON.stringify(t))},resetCache(){Object.values(_).forEach(e=>localStorage.removeItem(e)),window.location.reload()},async getHallOfFame(e){return Rt(e)},async getClubRecords(e){return At(e)},async getClubRecordSwimmers(){return Ot()},async createClubRecordSwimmer(e){return Dt(e)},async updateClubRecordSwimmer(e,t){return Mt(e,t)},async updateClubRecordSwimmerForUser(e,t){return kt(e,t)},async importClubRecords(){return Ut()},async getImportLogs(e){return Gt(e)},async importSingleSwimmer(e,t){return Ft(e,t)},async getSwimRecords(e){return Pt(e)},async upsertSwimRecord(e){return Ht(e)},async getSwimmerPerformances(e){return Lt(e)},async importSwimmerPerformances(e){return jt(e)},async recalculateClubRecords(){return $t()},async getClubRanking(e){return Wt(e)},async syncClubRecordSwimmersFromUsers(){return Bt()},async mergeClubRecordSwimmers(e,t){return Xt(e,t)},async getAppSettings(e){return zt(e)},async updateAppSettings(e,t){return Yt(e,t)},async getExercises(){return at()},async createExercise(e){return it(e)},async updateExercise(e){return ot(e)},async deleteExercise(e){return ct(e)},async getStrengthSessions(){return z()},async createStrengthSession(e){return ut(e)},async updateStrengthSession(e){return ne(e)},async persistStrengthSessionOrder(e){return dt(e)},async deleteStrengthSession(e){return lt(e)},async startStrengthRun(e){return mt(e)},async logStrengthSet(e){return _t(e)},async updateStrengthRun(e){return ft(e)},async deleteStrengthRun(e){return gt(e)},async saveStrengthRun(e){return pt(e)},async getStrengthHistory(e,t){return wt(e,t)},async getStrengthHistoryAggregate(e,t){return ht(e,t)},async get1RM(e){return G(e)},async update1RM(e){return F(e)},async updateExerciseNote(e){return St(e)},async getStrengthFolders(e){return yt(e)},async createStrengthFolder(e,t){return Et(e,t)},async renameStrengthFolder(e,t){return bt(e,t)},async deleteStrengthFolder(e){return vt(e)},async moveToFolder(e,t,r){return It(e,t,r)},async getSwimExerciseLogs(e){return Vt(e)},async getSwimExerciseLogsHistory(e,t){return Jt(e,t)},async saveSwimExerciseLogs(e,t,r){return Kt(e,t,r)},async updateSwimExerciseLog(e,t){return Qt(e,t)},async deleteSwimExerciseLog(e){return Zt(e)},async getSwimCatalog(){return B()},async createSwimSession(e){return Se(e)},async deleteSwimSession(e){return he(e)},async archiveSwimSession(e,t){return we(e,t)},async moveSwimSession(e,t){return pe(e,t)},async migrateLocalStorageArchive(e){return ge(e)},async generateShareToken(e){return fe(e)},async getSharedSession(e){return _e(e)},async getAssignmentsForCoach(){return Tt()},async getCoachAssignments(e){return Ct(e)},async getAssignments(e,t,r){return Nt(e,t,r)},async assignments_create(e){const t=ue.getState().userId;return qt(e,t)},async assignments_delete(e){return xt(e)},async getNotifications(e){return Je(e)},async notifications_send(e){return Ke(e)},async markNotificationRead(e){return Qe(e)},async notifications_list(e){return Ze(e)},async notifications_mark_read(e){return et(e)},async listTimesheetShifts(e){return Fe(e)},async listTimesheetLocations(){return Pe()},async createTimesheetLocation(e){return He(e)},async deleteTimesheetLocation(e){return Le(e)},async listTimesheetCoaches(){return je()},async createTimesheetShift(e){return $e(e)},async updateTimesheetShift(e){return Be(e)},async deleteTimesheetShift(e){return We(e)},async listTimesheetGroupLabels(){return ze()},async createTimesheetGroupLabel(e){return Xe(e)},async deleteTimesheetGroupLabel(e){return Ye(e)},async listPermanentGroupsForTimesheet(){return Ve()},async getTemporaryGroups(){return er()},async getTemporaryGroupDetail(e){return tr(e)},async createTemporaryGroup(e){return rr(e)},async addTemporaryGroupMembers(e,t){return sr(e,t)},async removeTemporaryGroupMember(e,t){return nr(e,t)},async deactivateTemporaryGroup(e){return ar(e)},async reactivateTemporaryGroup(e){return ir(e)},async deleteTemporaryGroup(e){return or(e)},async getCompetitions(){return cr()},async createCompetition(e){return ur(e)},async updateCompetition(e,t){return dr(e,t)},async deleteCompetition(e){return lr(e)},async getCompetitionAssignments(e){return mr(e)},async setCompetitionAssignments(e,t){return _r(e,t)},async getMyCompetitionIds(e){return fr(e)},async getObjectives(e){return ie(e)},async getAthleteObjectives(){return gr()},async createObjective(e){return pr(e)},async updateObjective(e,t){return wr(e,t)},async deleteObjective(e){return hr(e)},async getObjectivesCountsByUser(){return Sr()},async getPlannedAbsences(e){return yr(e)},async getMyPlannedAbsences(){return Er()},async setPlannedAbsence(e,t){return br(e,t)},async removePlannedAbsence(e){return vr(e)},async getTrainingCycles(e){return Ir(e)},async createTrainingCycle(e){return Tr(e)},async updateTrainingCycle(e,t){return Nr(e,t)},async deleteTrainingCycle(e){return qr(e)},async getTrainingWeeks(e){return xr(e)},async upsertTrainingWeek(e){return Cr(e)},async bulkUpsertTrainingWeeks(e){return Rr(e)},async deleteTrainingWeek(e){return Ar(e)},async getInterviews(e){return Or(e)},async getMyInterviews(){return Dr()},async createInterview(e){return Mr(e)},async updateInterviewAthleteSections(e,t){return kr(e,t)},async submitInterviewToCoach(e){return Ur(e)},async updateInterviewCoachSections(e,t){return Gr(e,t)},async sendInterviewToAthlete(e){return Fr(e)},async signInterview(e){return Pr(e)},async deleteInterview(e){return Lr(e)},async getPreviousInterview(e,t,r){return Hr(e,t,r)},async getProfile(e){return be(e)},async updateProfile(e){return ve(e)},async getAthletes(){return Ie()},async getGroups(){return Te()},async getUpcomingBirthdays(e){return Ne(e)},async listUsers(e){return qe(e)},async createCoach(e){return xe(e)},async updateUserRole(e){return Ce(e)},async disableUser(e){return Re(e)},async getPendingApprovals(){return Ae()},async approveUser(e){return Oe(e)},async rejectUser(e){return De(e)},async authPasswordUpdate(e){return Me(e)},async uploadAvatar(e){return ke(e)},async deleteAvatar(e){return Ue(e)},async getRecentSessionsAllAthletes(e){return Ge(e)},async getTrainingSlots(){return P()},async getTrainingSlotsForGroup(e){return jr(e)},async createTrainingSlot(e){return $r(e)},async updateTrainingSlot(e,t){return Br(e,t)},async deleteTrainingSlot(e){return Wr(e)},async getSlotOverrides(e){return zr(e)},async createSlotOverride(e){return Xr(e)},async deleteSlotOverride(e){return Yr(e)},async getSwimmerSlots(e){return oe(e)},async hasCustomSlots(e){return Vr(e)},async initSwimmerSlots(e,t,r){return ce(e,t,r)},async createSwimmerSlot(e,t){return Jr(e,t)},async updateSwimmerSlot(e,t){return Kr(e,t)},async deleteSwimmerSlot(e){return Qr(e)},async resetSwimmerSlots(e,t,r){return Zr(e,t,r)},async getSwimmersAffectedBySlot(e){return es(e)}};export{ss as a};
