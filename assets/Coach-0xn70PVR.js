const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/StrengthCatalog-BJVY5krE.js","assets/vendor-query-BiSH4r2z.js","assets/vendor-react-BzrpNAyj.js","assets/api-D6mwtGMC.js","assets/index-G6xNGEF7.js","assets/vendor-supabase-6k692oZB.js","assets/index-BBPTVqDo.css","assets/swim-D1OtUUOK.js","assets/index-BKQZJ1D1.js","assets/index-BZbn4__8.js","assets/select-B4bAlGFw.js","assets/chevron-down-9D2dahvL.js","assets/check-B1-q00B1.js","assets/chevron-up-DsGz6nP6.js","assets/CalendarGrid-CiIDce7r.js","assets/chevron-left-CHwDJB8o.js","assets/chevron-right-DnD6nZzw.js","assets/textarea-CiFDBeFZ.js","assets/dialog-f2J4u1eV.js","assets/index-BsDsQmas.js","assets/checkbox-CUPoBeQ9.js","assets/alert-dialog-qZIV0uRt.js","assets/tabs-DKSXhvW-.js","assets/SessionListView-npEROaSc.js","assets/play-W99Ip2FY.js","assets/save-Dd3rjJdZ.js","assets/circle-alert-GQtRNHFx.js","assets/pencil-BiUiftXD.js","assets/trash-2-FR86GZhx.js","assets/drawer-Bx9xr3Am.js","assets/search-OrDZkDMv.js","assets/plus-IFj-Ub_d.js","assets/loader-circle-C0HxHWa0.js","assets/pen-CuEi08ib.js","assets/SwimCatalog-Q2UQkADH.js","assets/SwimSessionTimeline-B4da8k2r.js","assets/swimConsultationUtils-DIwXx_1i.js","assets/timer-DESFXquw.js","assets/eye-CRRiQOL9.js","assets/clock-CjS3ghtg.js","assets/format-B9mPVj_w.js","assets/share-2-BLRq6m4W.js"])))=>i.map(i=>d[i]);
import{c as le,B as M,d as W,C as Me,i as De,k as Ae,l as Te,g as Fe,L as $,I as ie,W as He,D as Ye,R as is,U as Se,m as ls,n as os,T as qe,s as cs,u as Ie,b as ds,P as Ke,o as us,_ as We}from"./index-G6xNGEF7.js";import{j as e,r as i,u as B,c as oe,d as I}from"./vendor-query-BiSH4r2z.js";import{a as D}from"./api-D6mwtGMC.js";import{B as H}from"./badge-D8lRjXdL.js";import{T as Ee,a as X}from"./toggle-group-DEy3BsGj.js";import{S as Z,a as ee,b as se,c as te,d as V}from"./select-B4bAlGFw.js";import{a as ms,b as xs,P as ps}from"./CalendarGrid-CiIDce7r.js";import{S as ve,a as ye,b as be,c as Ne,d as Oe}from"./sheet-CxKYOCdJ.js";import{T as Je}from"./trash-2-FR86GZhx.js";import{C as hs}from"./checkbox-CUPoBeQ9.js";import{S as gs}from"./separator-jX_urcil.js";import{A as ue,a as me,b as xe,c as pe,d as he,e as ge,f as je,g as fe}from"./alert-dialog-qZIV0uRt.js";import{C as js,a as fs,b as vs}from"./collapsible-CXbjPdo2.js";import{P as ae}from"./plus-IFj-Ub_d.js";import{U as ys,a as bs}from"./user-plus-Ds12lOW-.js";import{C as Ns}from"./chevron-down-9D2dahvL.js";import{T as Xe}from"./textarea-CiFDBeFZ.js";import{S as ws}from"./switch-BMQW8mpy.js";import{M as Ss}from"./map-pin-Cz5zwIBP.js";import{T as ze}from"./target-C-NbClqT.js";import"./vendor-react-BzrpNAyj.js";import"./vendor-supabase-6k692oZB.js";import"./swim-D1OtUUOK.js";import"./index-BKQZJ1D1.js";import"./index-BZbn4__8.js";import"./check-B1-q00B1.js";import"./chevron-up-DsGz6nP6.js";import"./chevron-left-CHwDJB8o.js";import"./chevron-right-DnD6nZzw.js";import"./index-BsDsQmas.js";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cs=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],we=le("arrow-left",Cs);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _s=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 18h.01",key:"lrp35t"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M16 18h.01",key:"kzsmim"}]],Le=le("calendar-days",_s);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ks=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]],Ms=le("external-link",ks);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ds=[["path",{d:"M2 9.5a5.5 5.5 0 0 1 9.591-3.676.56.56 0 0 0 .818 0A5.49 5.49 0 0 1 22 9.5c0 2.29-1.5 4-3 5.5l-5.492 5.313a2 2 0 0 1-3 .019L5 15c-1.5-1.5-3-3.2-3-5.5",key:"mvr1a0"}],["path",{d:"M3.22 13H9.5l.5-1 2 4.5 2-7 1.5 3.5h5.27",key:"auskq0"}]],As=le("heart-pulse",Ds);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ts=[["path",{d:"m22 7-8.991 5.727a2 2 0 0 1-2.009 0L2 7",key:"132q7q"}],["rect",{x:"2",y:"4",width:"20",height:"16",rx:"2",key:"izxlao"}]],Pe=le("mail",Ts);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fs=[["path",{d:"M18 21a8 8 0 0 0-16 0",key:"3ypg7q"}],["circle",{cx:"10",cy:"8",r:"5",key:"o932ke"}],["path",{d:"M22 20c0-3.37-2-6.5-4-8a5 5 0 0 0-.45-8.3",key:"10s06x"}]],Ze=le("users-round",Fs),ne=({title:s,description:n,onBack:r,actions:a})=>e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs(M,{variant:"ghost",size:"sm",className:"-ml-2",onClick:r,children:[e.jsx(we,{className:"mr-2 h-4 w-4"}),"Retour"]}),e.jsx("h2",{className:"text-2xl font-display font-semibold uppercase italic text-primary",children:s}),n?e.jsx("p",{className:"text-sm text-muted-foreground",children:n}):null]}),a?e.jsx("div",{className:"flex items-center gap-2",children:a}):null]}),qs=({onBack:s,athletes:n,groups:r,athletesLoading:a})=>{const{toast:l}=W(),[g,f]=i.useState(""),[c,m]=i.useState(""),x=i.useMemo(()=>n.filter(t=>t.id&&t.email).map(t=>({value:`user:${t.id}`,label:t.group_label?`${t.display_name} · ${t.group_label}`:t.display_name,email:t.email})),[n]),h=i.useMemo(()=>r.map(t=>({value:`group:${t.id}`,label:t.name,id:t.id})),[r]),o=()=>{if(!c)return[];if(c.startsWith("user:")){const t=x.find(u=>u.value===c);return t?[t.email]:[]}if(c.startsWith("group:")){const t=Number(c.split(":")[1]);return n.filter(u=>u.group_id===t&&u.email).map(u=>u.email)}return[]},j=()=>{const t=o();if(!t.length){l({title:"Aucune adresse email",description:"Aucun nageur avec une adresse email dans cette sélection."});return}const u=new URLSearchParams;u.set("bcc",t.join(",")),g.trim()&&u.set("subject",g.trim()),window.location.href=`mailto:?${u.toString()}`},y=o();return e.jsxs("div",{className:"space-y-6 pb-24",children:[e.jsx(ne,{title:"Contacter par email",description:"Ouvre votre application mail avec les destinataires en CCI.",onBack:s}),e.jsxs(Me,{className:"border-l-4 border-l-primary",children:[e.jsxs(De,{children:[e.jsx(Ae,{children:"Destinataire"}),e.jsx(Te,{children:"Sélectionnez un nageur ou un groupe."})]}),e.jsxs(Fe,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx($,{children:"Destinataire"}),e.jsxs(Z,{value:c,onValueChange:m,children:[e.jsx(ee,{children:e.jsx(se,{placeholder:a?"Chargement...":"Choisir un nageur ou un groupe"})}),e.jsxs(te,{children:[h.length?e.jsxs(e.Fragment,{children:[e.jsx(V,{value:"section-group",disabled:!0,children:"Groupes"}),h.map(t=>e.jsx(V,{value:t.value,children:t.label},t.value))]}):null,x.length?e.jsxs(e.Fragment,{children:[e.jsx(V,{value:"section-athlete",disabled:!0,children:"Nageurs"}),x.map(t=>e.jsx(V,{value:t.value,children:t.label},t.value))]}):null]})]})]}),c&&y.length>0?e.jsxs("p",{className:"text-xs text-muted-foreground",children:[y.length," adresse",y.length>1?"s":""," email",y.length>1?" (envoi en CCI)":""]}):null,c&&y.length===0?e.jsx("p",{className:"text-xs text-destructive",children:"Aucune adresse email disponible pour cette sélection."}):null]})]}),e.jsxs(Me,{children:[e.jsxs(De,{children:[e.jsx(Ae,{children:"Objet"}),e.jsx(Te,{children:"Optionnel — pré-rempli dans votre application mail."})]}),e.jsx(Fe,{children:e.jsx(ie,{value:g,onChange:t=>f(t.target.value),placeholder:"Objet du mail…"})})]}),e.jsx("div",{className:"sticky bottom-0 z-10 -mx-4 border-t bg-background/95 p-4 backdrop-blur sm:static sm:mx-0 sm:border-0 sm:p-0",children:e.jsxs(M,{className:"w-full sm:w-auto",onClick:j,disabled:!c||y.length===0,children:[e.jsx(Pe,{className:"mr-2 h-4 w-4"}),"Ouvrir dans l'app mail",e.jsx(Ms,{className:"ml-2 h-3 w-3"})]})})]})};function Ge(s){return String(s).padStart(2,"0")}function re(s){return`${s.getFullYear()}-${Ge(s.getMonth()+1)}-${Ge(s.getDate())}`}function Ce(s){return new Date(s.getFullYear(),s.getMonth(),1)}function Be(s,n){const r=new Date(s);return r.setDate(r.getDate()+n),r}function zs(s){return(s.getDay()+6)%7}function _e(s){if(!s)return"AM";const n=s.toLowerCase();return n==="evening"||n.includes("soir")||n==="pm"?"PM":"AM"}const Ls=[{key:"swim-morning",label:"Nage — Matin",type:"swim",scheduledSlot:"morning"},{key:"swim-evening",label:"Nage — Soir",type:"swim",scheduledSlot:"evening"},{key:"strength",label:"Musculation",type:"strength",scheduledSlot:null}];function Es({groupId:s,userId:n,enabled:r}){const a=i.useMemo(()=>new Date,[]),[l,g]=i.useState(()=>Ce(new Date)),[f,c]=i.useState(()=>re(new Date)),[m,x]=i.useState(null),[h,o]=i.useState(!1),j=i.useMemo(()=>Ce(l),[l]),y=i.useMemo(()=>{const _=zs(j),A=Be(j,-_),F=[];for(let d=0;d<42;d++)F.push(Be(A,d));return F},[j]),t=i.useMemo(()=>{const _=re(y[0]),A=re(y[y.length-1]);return{from:_,to:A}},[y]),u=!!(s||n),{data:C=[],isLoading:v}=B({queryKey:["coach-calendar-assignments",s,n,t.from,t.to],queryFn:()=>D.getCoachAssignments({groupId:s??null,userId:n??null,from:t.from,to:t.to}),enabled:u}),w=i.useMemo(()=>{const _=new Map;for(const A of C){const F=A.scheduledDate?.slice(0,10);F&&(_.has(F)||_.set(F,[]),_.get(F).push(A))}return _},[C]),O=i.useMemo(()=>{const _={};for(const A of y){const F=re(A),d=w.get(F)??[],E=d.some(R=>_e(R.scheduledSlot)==="AM"),P=d.some(R=>_e(R.scheduledSlot)==="PM"),N=(E?1:0)+(P?1:0),K=[{slotKey:"AM",expected:E,completed:E,absent:!1},{slotKey:"PM",expected:P,completed:P,absent:!1}];_[F]={completed:N,total:N,slots:K}}return _},[y,w]),L=i.useMemo(()=>{const[_,A,F]=f.split("-").map(Number);return new Date(_,A-1,F)},[f]),k=i.useMemo(()=>w.get(f)??[],[w,f]),q=i.useMemo(()=>{const _=k;return Ls.map(A=>{const F=_.filter(P=>A.type!==P.type?!1:A.type==="swim"?_e(P.scheduledSlot)===(A.scheduledSlot==="morning"?"AM":"PM"):!0),d=F.find(P=>P.targetType==="user"),E=F.find(P=>P.targetType==="group");return{...A,assignment:d??E??null}})},[k]),T=i.useMemo(()=>{const _={};for(const A of y){const F=re(A),d=w.get(F)??[];_[F]=d.some(E=>E.type==="strength")}return _},[y,w]),b=O[f]??{completed:0,total:0,slots:[{slotKey:"AM",expected:!1,completed:!1,absent:!1},{slotKey:"PM",expected:!1,completed:!1,absent:!1}]},p=i.useCallback(()=>{g(_=>new Date(_.getFullYear(),_.getMonth()-1,1))},[]),S=i.useCallback(()=>{g(_=>new Date(_.getFullYear(),_.getMonth()+1,1))},[]),Q=i.useCallback(()=>{g(Ce(new Date)),c(re(new Date))},[]),Y=i.useCallback(_=>{c(_),o(!0)},[]);return{today:a,monthCursor:l,selectedISO:f,selectedDayIndex:m,drawerOpen:h,gridDates:y,completionByISO:O,selectedDate:L,selectedDayStatus:b,assignmentsForSelectedDay:k,slotsForSelectedDay:q,hasStrengthByISO:T,isLoading:v,hasFilter:u,setSelectedISO:c,setSelectedDayIndex:x,setDrawerOpen:o,prevMonth:p,nextMonth:S,jumpToday:Q,openDay:Y}}function Os(s){const[n,r,a]=s.split("-").map(Number);return new Date(n,r-1,a).toLocaleDateString("fr-FR",{weekday:"long",day:"numeric",month:"long"})}function Ps({onBack:s,athletes:n,groups:r,swimSessions:a,strengthSessions:l}){const[g,f]=i.useState("group"),[c,m]=i.useState(""),[x,h]=i.useState(""),o=g==="group"&&c?Number(c):null,j=g==="user"&&x?Number(x):null,{today:y,monthCursor:t,selectedISO:u,selectedDayIndex:C,drawerOpen:v,gridDates:w,completionByISO:O,selectedDayStatus:L,slotsForSelectedDay:k,hasStrengthByISO:q,hasFilter:T,setSelectedISO:b,setSelectedDayIndex:p,setDrawerOpen:S,prevMonth:Q,nextMonth:Y,jumpToday:_,openDay:A}=Es({groupId:o,userId:j,enabled:!0}),F=oe(),d=I({mutationFn:N=>D.assignments_create(N),onSuccess:()=>{F.invalidateQueries({queryKey:["coach-calendar-assignments"]})}}),E=I({mutationFn:N=>D.assignments_delete(N),onSuccess:()=>{F.invalidateQueries({queryKey:["coach-calendar-assignments"]})}}),P=(N,K)=>{let R=K;if(N.key==="ArrowLeft"&&(R=Math.max(0,K-1)),N.key==="ArrowRight"&&(R=Math.min(w.length-1,K+1)),N.key==="ArrowUp"&&(R=Math.max(0,K-7)),N.key==="ArrowDown"&&(R=Math.min(w.length-1,K+7)),R!==K){N.preventDefault(),p(R);const U=de=>String(de).padStart(2,"0"),G=w[R],ce=`${G.getFullYear()}-${U(G.getMonth()+1)}-${U(G.getDate())}`;b(ce)}if(N.key==="Enter"||N.key===" "){N.preventDefault();const U=de=>String(de).padStart(2,"0"),G=w[K],ce=`${G.getFullYear()}-${U(G.getMonth()+1)}-${U(G.getDate())}`;A(ce)}};return e.jsxs("div",{className:"space-y-4",children:[e.jsx(ne,{title:"Calendrier",description:"Vue mensuelle des assignations",onBack:s}),e.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center",children:[e.jsxs(Ee,{type:"single",value:g,onValueChange:N=>{(N==="group"||N==="user")&&f(N)},className:"shrink-0",children:[e.jsx(X,{value:"group",className:"text-xs px-3",children:"Groupe"}),e.jsx(X,{value:"user",className:"text-xs px-3",children:"Nageur"})]}),g==="group"?e.jsxs(Z,{value:c,onValueChange:m,children:[e.jsx(ee,{className:"w-full sm:w-56",children:e.jsx(se,{placeholder:"Choisir un groupe"})}),e.jsx(te,{children:r.map(N=>e.jsx(V,{value:String(N.id),children:N.name},String(N.id)))})]}):e.jsxs(Z,{value:x,onValueChange:h,children:[e.jsx(ee,{className:"w-full sm:w-56",children:e.jsx(se,{placeholder:"Choisir un nageur"})}),e.jsx(te,{children:n.filter(N=>N.id!=null).map(N=>e.jsxs(V,{value:String(N.id),children:[N.display_name,N.group_label?` · ${N.group_label}`:""]},String(N.id)))})]})]}),T?e.jsxs("div",{className:"rounded-2xl border bg-card shadow-sm",children:[e.jsx(ms,{monthCursor:t,selectedDayStatus:L,onPrevMonth:Q,onNextMonth:Y,onJumpToday:_}),e.jsx(xs,{monthCursor:t,gridDates:w,completionByISO:O,strengthByISO:q,selectedISO:u,selectedDayIndex:C,today:y,onDayClick:A,onKeyDown:P})]}):e.jsx("div",{className:"py-12 text-center text-sm text-muted-foreground",children:"Sélectionnez un groupe ou un nageur pour afficher le calendrier."}),e.jsx(ve,{open:v,onOpenChange:S,children:e.jsxs(ye,{side:"bottom",className:"max-h-[70vh] overflow-y-auto rounded-t-2xl",children:[e.jsxs(be,{className:"pb-3",children:[e.jsx(Ne,{className:"capitalize text-left",children:Os(u)}),e.jsx(Oe,{className:"sr-only",children:"Gérer les assignations pour cette journée"})]}),e.jsx("div",{className:"space-y-3",children:k.map(N=>{const K=N.assignment?.targetType==="group",R=g==="user";return e.jsx($s,{slot:N,swimSessions:a,strengthSessions:l,isGroupAssignment:K&&R,onAssign:U=>{d.mutate({assignment_type:N.type,session_id:U,scheduled_date:u,scheduled_slot:N.scheduledSlot??void 0,target_group_id:o,target_user_id:j})},onDelete:U=>{E.mutate(U)},onReplace:(U,G)=>{K&&R?d.mutate({assignment_type:N.type,session_id:G,scheduled_date:u,scheduled_slot:N.scheduledSlot??void 0,target_user_id:j}):E.mutate(U,{onSuccess:()=>{d.mutate({assignment_type:N.type,session_id:G,scheduled_date:u,scheduled_slot:N.scheduledSlot??void 0,target_group_id:o,target_user_id:j})}})},isPending:d.isPending||E.isPending},N.key)})})]})})]})}function $s({slot:s,swimSessions:n,strengthSessions:r,isGroupAssignment:a,onAssign:l,onDelete:g,onReplace:f,isPending:c}){const[m,x]=i.useState(!1),h=s.type==="swim",o=h?(n??[]).map(t=>({id:t.id,label:t.name})):(r??[]).map(t=>({id:t.id,label:t.title})),j=s.assignment!==null,y=t=>{const u=Number(t);u&&(j&&m?(f(s.assignment.id,u),x(!1)):l(u))};return e.jsxs("div",{className:"rounded-xl border p-3 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[h?e.jsx(He,{className:"h-4 w-4 text-blue-500 shrink-0"}):e.jsx(Ye,{className:"h-4 w-4 text-orange-500 shrink-0"}),e.jsx("span",{className:"text-xs font-semibold text-muted-foreground uppercase tracking-wide",children:s.label})]}),j&&!m?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("p",{className:"text-sm font-semibold truncate flex-1",children:[s.assignment.title,a&&e.jsx("span",{className:"ml-1.5 text-[10px] font-medium text-muted-foreground bg-muted px-1.5 py-0.5 rounded-full align-middle",children:"Groupe"})]}),e.jsx(M,{type:"button",size:"icon",variant:"ghost",className:"h-7 w-7 shrink-0",disabled:c,onClick:()=>x(!0),title:a?"Personnaliser":"Changer",children:e.jsx(is,{className:"h-3.5 w-3.5"})}),!a&&e.jsx(M,{type:"button",size:"icon",variant:"ghost",className:"h-7 w-7 shrink-0 text-destructive hover:text-destructive",disabled:c,onClick:()=>g(s.assignment.id),title:"Supprimer",children:e.jsx(Je,{className:"h-3.5 w-3.5"})})]}):e.jsxs(Z,{value:"",onValueChange:y,disabled:c||o.length===0,children:[e.jsx(ee,{className:"h-9 text-xs",children:e.jsx(se,{placeholder:m?a?"Personnaliser pour ce nageur":"Choisir le remplacement":"Choisir une séance"})}),e.jsx(te,{children:o.map(t=>e.jsx(V,{value:String(t.id),children:t.label},t.id))})]}),m?e.jsx("button",{type:"button",className:"text-xs text-muted-foreground hover:text-foreground",onClick:()=>x(!1),children:"Annuler"}):null]})}const es=({athletes:s,selected:n,onToggle:r,filterToUserIds:a})=>{const[l,g]=i.useState(""),f=i.useMemo(()=>{let m=s.filter(x=>x.id!=null);if(a&&(m=m.filter(x=>a.has(x.id))),l.trim()){const x=l.toLowerCase();m=m.filter(h=>h.display_name.toLowerCase().includes(x))}return m},[s,a,l]),c=i.useMemo(()=>{const m=new Map;for(const x of f){const h=x.group_label||"Sans groupe";m.has(h)||m.set(h,[]),m.get(h).push(x)}return[...m.entries()].sort(([x],[h])=>x.localeCompare(h,"fr"))},[f]);return e.jsxs("div",{className:"space-y-3",children:[e.jsx(ie,{placeholder:"Rechercher un nageur...",value:l,onChange:m=>g(m.target.value)}),e.jsxs("div",{className:"max-h-[50vh] overflow-y-auto space-y-3",children:[c.map(([m,x])=>e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-semibold uppercase tracking-wider text-muted-foreground mb-1.5",children:m}),e.jsx("div",{className:"space-y-1",children:x.map(h=>e.jsxs("label",{className:"flex items-center gap-2.5 rounded-lg border px-3 py-2 cursor-pointer hover:bg-muted/50 transition-colors",children:[e.jsx(hs,{checked:n.has(h.id),onCheckedChange:()=>r(h.id)}),e.jsx("span",{className:"text-sm",children:h.display_name})]},h.id))})]},m)),c.length===0&&e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"Aucun nageur trouvé."})]}),n.size>0&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:[n.size," nageur",n.size>1?"s":""," ","sélectionné",n.size>1?"s":""]})]})},ss=({open:s,onOpenChange:n,athletes:r,parentGroupId:a,parentMembers:l,onCreated:g})=>{const{toast:f}=W(),[c,m]=i.useState(""),[x,h]=i.useState(new Set),o=t=>{h(u=>{const C=new Set(u);return C.has(t)?C.delete(t):C.add(t),C})},j=I({mutationFn:()=>D.createTemporaryGroup({name:c.trim(),member_user_ids:[...x],parent_group_id:a??void 0}),onSuccess:()=>{f({title:"Groupe créé",description:`Le groupe "${c.trim()}" a été créé avec ${x.size} nageur${x.size>1?"s":""}.`}),m(""),h(new Set),n(!1),g()},onError:t=>{f({title:"Erreur",description:t.message,variant:"destructive"})}}),y=()=>{if(!c.trim()){f({title:"Nom requis",description:"Veuillez saisir un nom pour le groupe.",variant:"destructive"});return}j.mutate()};return e.jsx(ve,{open:s,onOpenChange:n,children:e.jsxs(ye,{side:"right",className:"w-full sm:max-w-md overflow-y-auto",children:[e.jsxs(be,{children:[e.jsx(Ne,{children:a?"Créer un sous-groupe":"Créer un groupe"}),e.jsx(Oe,{children:a?"Sélectionnez des nageurs du groupe parent pour ce sous-groupe.":"Créez un groupe temporaire (stage, compétition) avec des nageurs de différents groupes."})]}),e.jsxs("div",{className:"mt-6 space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx($,{htmlFor:"group-name",children:"Nom du groupe"}),e.jsx(ie,{id:"group-name",placeholder:"Ex : Stage Pâques 2026",value:c,onChange:t=>m(t.target.value)})]}),e.jsx(gs,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsx($,{children:"Nageurs"}),e.jsx(es,{athletes:r,selected:x,onToggle:o,filterToUserIds:l??null})]}),e.jsx(M,{className:"w-full",onClick:y,disabled:j.isPending||!c.trim(),children:j.isPending?"Création...":"Créer le groupe"})]})]})})},Rs=({open:s,onOpenChange:n,groupId:r,athletes:a,existingMemberIds:l,onAdded:g})=>{const{toast:f}=W(),[c,m]=i.useState(new Set),x=i.useMemo(()=>a.filter(j=>j.id!=null&&!l.has(j.id)),[a,l]),h=j=>{m(y=>{const t=new Set(y);return t.has(j)?t.delete(j):t.add(j),t})},o=I({mutationFn:()=>D.addTemporaryGroupMembers(r,[...c]),onSuccess:()=>{f({title:"Nageurs ajoutés",description:`${c.size} nageur${c.size>1?"s":""} ajouté${c.size>1?"s":""}.`}),m(new Set),n(!1),g()},onError:j=>{f({title:"Erreur",description:j.message,variant:"destructive"})}});return e.jsx(ve,{open:s,onOpenChange:n,children:e.jsxs(ye,{side:"right",className:"w-full sm:max-w-md overflow-y-auto",children:[e.jsxs(be,{children:[e.jsx(Ne,{children:"Ajouter des nageurs"}),e.jsx(Oe,{children:"Sélectionnez les nageurs à ajouter au groupe."})]}),e.jsxs("div",{className:"mt-6 space-y-4",children:[e.jsx(es,{athletes:x,selected:c,onToggle:h}),e.jsx(M,{className:"w-full",onClick:()=>o.mutate(),disabled:o.isPending||c.size===0,children:o.isPending?"Ajout...":`Ajouter ${c.size} nageur${c.size>1?"s":""}`})]})]})})},Is=({groupId:s,athletes:n,onBack:r})=>{const{toast:a}=W(),l=oe(),[g,f]=i.useState(!1),[c,m]=i.useState(!1),[x,h]=i.useState(null),{data:o,isLoading:j}=B({queryKey:["temp-group-detail",s],queryFn:()=>D.getTemporaryGroupDetail(s)}),y=I({mutationFn:v=>D.removeTemporaryGroupMember(s,v),onSuccess:()=>{a({title:"Nageur retiré"}),l.invalidateQueries({queryKey:["temp-group-detail",s]}),l.invalidateQueries({queryKey:["temp-groups"]})},onError:v=>{a({title:"Erreur",description:v.message,variant:"destructive"})}}),t=()=>{l.invalidateQueries({queryKey:["temp-group-detail",s]}),l.invalidateQueries({queryKey:["temp-groups"]})},u=i.useMemo(()=>new Set((o?.members??[]).map(v=>v.user_id)),[o]),C=i.useMemo(()=>new Set((o?.members??[]).map(v=>v.user_id)),[o]);return j?e.jsxs("div",{className:"space-y-4",children:[e.jsxs(M,{variant:"ghost",size:"sm",className:"-ml-2",onClick:r,children:[e.jsx(we,{className:"mr-2 h-4 w-4"}),"Retour aux groupes"]}),e.jsx("div",{className:"space-y-2",children:[1,2,3].map(v=>e.jsx("div",{className:"rounded-xl border p-3 animate-pulse motion-reduce:animate-none",children:e.jsx("div",{className:"h-4 w-32 rounded bg-muted"})},v))})]}):o?e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs(M,{variant:"ghost",size:"sm",className:"-ml-2",onClick:r,children:[e.jsx(we,{className:"mr-2 h-4 w-4"}),"Retour aux groupes"]}),e.jsx("h2",{className:"text-2xl font-display font-semibold uppercase italic text-primary",children:o.name}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(H,{variant:o.is_active?"default":"secondary",children:o.is_active?"Actif":"Terminé"}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:[o.members.length," membre",o.members.length!==1?"s":""]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-xs font-semibold uppercase tracking-[0.15em] text-muted-foreground",children:"Membres"}),o.is_active&&e.jsxs(M,{size:"sm",variant:"outline",onClick:()=>f(!0),children:[e.jsx(ys,{className:"mr-1.5 h-3.5 w-3.5"}),"Ajouter"]})]}),o.members.length===0?e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"Aucun membre dans ce groupe."}):e.jsx("div",{className:"space-y-1.5",children:o.members.map(v=>e.jsxs("div",{className:"flex items-center gap-3 rounded-xl border bg-card p-3",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-sm font-semibold truncate",children:v.display_name}),v.permanent_group_label&&e.jsx(H,{variant:"secondary",className:"text-[10px] px-1.5 py-0 mt-0.5",children:v.permanent_group_label})]}),o.is_active&&e.jsx(M,{size:"icon",variant:"ghost",className:"h-8 w-8 text-muted-foreground hover:text-destructive",onClick:()=>h({userId:v.user_id,name:v.display_name}),title:"Retirer du groupe",children:e.jsx(bs,{className:"h-4 w-4"})})]},v.user_id))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-xs font-semibold uppercase tracking-[0.15em] text-muted-foreground",children:"Sous-groupes"}),o.is_active&&e.jsxs(M,{size:"sm",variant:"outline",onClick:()=>m(!0),children:[e.jsx(ae,{className:"mr-1.5 h-3.5 w-3.5"}),"Sous-groupe"]})]}),o.subgroups.length===0?e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"Aucun sous-groupe."}):e.jsx("div",{className:"space-y-2",children:o.subgroups.map(v=>e.jsxs(js,{children:[e.jsxs(fs,{className:"flex w-full items-center justify-between rounded-xl border bg-card p-3 text-left hover:bg-muted/50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ze,{className:"h-4 w-4 text-primary"}),e.jsx("span",{className:"text-sm font-semibold",children:v.name}),e.jsx(H,{variant:"secondary",className:"text-[10px] px-1.5 py-0",children:v.members.length})]}),e.jsx(Ns,{className:"h-4 w-4 text-muted-foreground transition-transform [[data-state=open]_&]:rotate-180"})]}),e.jsx(vs,{children:e.jsxs("div",{className:"ml-4 mt-1 space-y-1",children:[v.members.map(w=>e.jsx("div",{className:"flex items-center gap-2 rounded-lg border px-3 py-2",children:e.jsx("span",{className:"text-sm",children:w.display_name})},w.user_id)),v.members.length===0&&e.jsx("p",{className:"text-xs text-muted-foreground py-2",children:"Aucun membre."})]})})]},v.id))})]}),e.jsx(Rs,{open:g,onOpenChange:f,groupId:s,athletes:n,existingMemberIds:u,onAdded:t}),e.jsx(ss,{open:c,onOpenChange:m,athletes:n,parentGroupId:s,parentMembers:C,onCreated:t}),e.jsx(ue,{open:!!x,onOpenChange:v=>{v||h(null)},children:e.jsxs(me,{children:[e.jsxs(xe,{children:[e.jsx(pe,{children:"Retirer du groupe"}),e.jsxs(he,{children:["Voulez-vous retirer ",x?.name," de ce groupe ?",o.subgroups.length>0?" Le nageur sera aussi retiré des sous-groupes.":""]})]}),e.jsxs(ge,{children:[e.jsx(je,{children:"Annuler"}),e.jsx(fe,{onClick:()=>{x&&(y.mutate(x.userId),h(null))},className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Retirer"})]})]})})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs(M,{variant:"ghost",size:"sm",className:"-ml-2",onClick:r,children:[e.jsx(we,{className:"mr-2 h-4 w-4"}),"Retour aux groupes"]}),e.jsx("p",{className:"text-sm text-muted-foreground text-center py-8",children:"Groupe introuvable."})]})},Ve=({group:s,onManage:n,onDeactivate:r,onReactivate:a,onDelete:l})=>{const g=new Date(s.created_at).toLocaleDateString("fr-FR",{day:"numeric",month:"short",year:"numeric"});return e.jsxs("div",{className:"rounded-xl border bg-card p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-sm font-bold truncate",children:s.name}),e.jsxs("div",{className:"flex items-center gap-2 mt-1 flex-wrap",children:[e.jsxs("span",{className:"text-xs text-muted-foreground",children:[s.member_count," membre",s.member_count!==1?"s":""]}),s.subgroup_count>0&&e.jsxs("span",{className:"text-xs text-muted-foreground",children:[s.subgroup_count," sous-groupe",s.subgroup_count!==1?"s":""]}),e.jsx("span",{className:"text-xs text-muted-foreground",children:g})]})]}),e.jsx(H,{variant:s.is_active?"default":"secondary",children:s.is_active?"Actif":"Terminé"})]}),e.jsx("div",{className:"flex items-center gap-2 flex-wrap",children:s.is_active?e.jsxs(e.Fragment,{children:[e.jsxs(M,{size:"sm",variant:"outline",onClick:()=>n(s.id),children:[e.jsx(ls,{className:"mr-1.5 h-3.5 w-3.5"}),"Gérer"]}),e.jsxs(M,{size:"sm",variant:"outline",onClick:()=>r(s.id),children:[e.jsx(ps,{className:"mr-1.5 h-3.5 w-3.5"}),"Terminer"]})]}):e.jsxs(e.Fragment,{children:[e.jsxs(M,{size:"sm",variant:"outline",onClick:()=>a(s.id),children:[e.jsx(os,{className:"mr-1.5 h-3.5 w-3.5"}),"Réactiver"]}),e.jsxs(M,{size:"sm",variant:"outline",className:"text-destructive hover:text-destructive",onClick:()=>l(s.id),children:[e.jsx(Je,{className:"mr-1.5 h-3.5 w-3.5"}),"Supprimer"]})]})})]})},Ks=({onBack:s,athletes:n,athletesLoading:r})=>{const{toast:a}=W(),l=oe(),[g,f]=i.useState("list"),[c,m]=i.useState(null),[x,h]=i.useState(!1),[o,j]=i.useState(null),[y,t]=i.useState(null),{data:u=[],isLoading:C}=B({queryKey:["temp-groups"],queryFn:()=>D.getTemporaryGroups()}),v=i.useMemo(()=>u.filter(b=>b.is_active),[u]),w=i.useMemo(()=>u.filter(b=>!b.is_active),[u]),O=I({mutationFn:b=>D.deactivateTemporaryGroup(b),onSuccess:()=>{a({title:"Groupe terminé"}),l.invalidateQueries({queryKey:["temp-groups"]})},onError:b=>{a({title:"Erreur",description:b.message,variant:"destructive"})}}),L=I({mutationFn:b=>D.reactivateTemporaryGroup(b),onSuccess:()=>{a({title:"Groupe réactivé"}),l.invalidateQueries({queryKey:["temp-groups"]})},onError:b=>{a({title:"Erreur",description:b.message,variant:"destructive"})}}),k=I({mutationFn:b=>D.deleteTemporaryGroup(b),onSuccess:()=>{a({title:"Groupe supprimé"}),l.invalidateQueries({queryKey:["temp-groups"]})},onError:b=>{a({title:"Erreur",description:b.message,variant:"destructive"})}}),q=b=>{m(b),f("detail")},T=()=>{m(null),f("list"),l.invalidateQueries({queryKey:["temp-groups"]})};return g==="detail"&&c!=null?e.jsx(Is,{groupId:c,athletes:n,onBack:T}):e.jsxs("div",{className:"space-y-6 pb-24",children:[e.jsx(ne,{title:"Groupes temporaires",description:"Créez et gérez des groupes pour les stages, compétitions ou événements.",onBack:s,actions:e.jsxs(M,{size:"sm",onClick:()=>h(!0),children:[e.jsx(ae,{className:"mr-1.5 h-3.5 w-3.5"}),"Créer un groupe"]})}),C||r?e.jsx("div",{className:"space-y-2",children:[1,2,3].map(b=>e.jsx("div",{className:"rounded-xl border p-4 animate-pulse motion-reduce:animate-none",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-4 w-40 rounded bg-muted"}),e.jsx("div",{className:"ml-auto h-6 w-16 rounded bg-muted"})]})},b))}):u.length===0?e.jsxs("div",{className:"text-center py-12 space-y-3",children:[e.jsx(Se,{className:"h-10 w-10 text-muted-foreground mx-auto"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Aucun groupe temporaire pour le moment."}),e.jsxs(M,{variant:"outline",size:"sm",onClick:()=>h(!0),children:[e.jsx(ae,{className:"mr-1.5 h-3.5 w-3.5"}),"Créer le premier groupe"]})]}):e.jsxs(e.Fragment,{children:[v.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h3",{className:"text-xs font-semibold uppercase tracking-[0.15em] text-muted-foreground",children:["Actifs (",v.length,")"]}),v.map(b=>e.jsx(Ve,{group:b,onManage:q,onDeactivate:p=>j(p),onReactivate:p=>L.mutate(p),onDelete:p=>t(p)},b.id))]}),w.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h3",{className:"text-xs font-semibold uppercase tracking-[0.15em] text-muted-foreground",children:["Terminés (",w.length,")"]}),w.map(b=>e.jsx(Ve,{group:b,onManage:q,onDeactivate:p=>j(p),onReactivate:p=>L.mutate(p),onDelete:p=>t(p)},b.id))]})]}),e.jsx(ss,{open:x,onOpenChange:h,athletes:n,onCreated:()=>{l.invalidateQueries({queryKey:["temp-groups"]})}}),e.jsx(ue,{open:o!=null,onOpenChange:b=>{b||j(null)},children:e.jsxs(me,{children:[e.jsxs(xe,{children:[e.jsx(pe,{children:"Terminer le groupe"}),e.jsx(he,{children:"Voulez-vous marquer ce groupe comme terminé ? Les sous-groupes seront aussi désactivés. Vous pourrez le réactiver plus tard si nécessaire."})]}),e.jsxs(ge,{children:[e.jsx(je,{children:"Annuler"}),e.jsx(fe,{onClick:()=>{o!=null&&(O.mutate(o),j(null))},children:"Terminer"})]})]})}),e.jsx(ue,{open:y!=null,onOpenChange:b=>{b||t(null)},children:e.jsxs(me,{children:[e.jsxs(xe,{children:[e.jsx(pe,{children:"Supprimer le groupe"}),e.jsx(he,{children:"Cette action est irréversible. Le groupe et tous ses sous-groupes seront supprimés définitivement."})]}),e.jsxs(ge,{children:[e.jsx(je,{children:"Annuler"}),e.jsx(fe,{onClick:()=>{y!=null&&(k.mutate(y),t(null))},className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Supprimer"})]})]})})]})};function ke(s){return new Date(s+"T00:00:00").toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric"})}function Gs(s){const n=new Date;n.setHours(0,0,0,0);const r=new Date(s+"T00:00:00");return Math.ceil((r.getTime()-n.getTime())/(1e3*60*60*24))}const Bs=({open:s,onOpenChange:n,competition:r})=>{const{toast:a}=W(),l=oe(),g=!!r,[f,c]=i.useState(""),[m,x]=i.useState(""),[h,o]=i.useState(""),[j,y]=i.useState(!1),[t,u]=i.useState(""),[C,v]=i.useState(""),[w,O]=i.useState(!1),L=S=>{S&&(r?(c(r.name),x(r.date),o(r.end_date??""),y(!!r.end_date),u(r.location??""),v(r.description??"")):(c(""),x(""),o(""),y(!1),u(""),v(""))),n(S)},k=I({mutationFn:S=>D.createCompetition(S),onSuccess:()=>{a({title:"Competition creee"}),l.invalidateQueries({queryKey:["competitions"]}),n(!1)},onError:S=>{a({title:"Erreur",description:S.message,variant:"destructive"})}}),q=I({mutationFn:S=>D.updateCompetition(r.id,S),onSuccess:()=>{a({title:"Competition mise a jour"}),l.invalidateQueries({queryKey:["competitions"]}),n(!1)},onError:S=>{a({title:"Erreur",description:S.message,variant:"destructive"})}}),T=I({mutationFn:()=>D.deleteCompetition(r.id),onSuccess:()=>{a({title:"Competition supprimee"}),l.invalidateQueries({queryKey:["competitions"]}),n(!1)},onError:S=>{a({title:"Erreur",description:S.message,variant:"destructive"})}}),b=()=>{if(!f.trim()){a({title:"Nom requis",description:"Veuillez saisir un nom pour la competition.",variant:"destructive"});return}if(!m){a({title:"Date requise",description:"Veuillez saisir une date.",variant:"destructive"});return}const S={name:f.trim(),date:m,end_date:j&&h?h:null,location:t.trim()||null,description:C.trim()||null};g?q.mutate(S):k.mutate(S)},p=k.isPending||q.isPending||T.isPending;return e.jsxs(e.Fragment,{children:[e.jsx(ve,{open:s,onOpenChange:L,children:e.jsxs(ye,{side:"right",className:"w-full sm:max-w-md overflow-y-auto",children:[e.jsx(be,{children:e.jsx(Ne,{children:g?"Modifier la competition":"Nouvelle competition"})}),e.jsxs("div",{className:"mt-6 space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx($,{htmlFor:"comp-name",children:"Nom *"}),e.jsx(ie,{id:"comp-name",placeholder:"Ex : Championnats Regionaux",value:f,onChange:S=>c(S.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx($,{htmlFor:"comp-date",children:"Date *"}),e.jsx("input",{id:"comp-date",type:"date",value:m,onChange:S=>x(S.target.value),className:"flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx($,{htmlFor:"comp-multiday",children:"Multi-jours"}),e.jsx(ws,{id:"comp-multiday",checked:j,onCheckedChange:y})]}),j&&e.jsxs("div",{className:"space-y-2",children:[e.jsx($,{htmlFor:"comp-end-date",children:"Date de fin"}),e.jsx("input",{id:"comp-end-date",type:"date",value:h,onChange:S=>o(S.target.value),min:m||void 0,className:"flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx($,{htmlFor:"comp-location",children:"Lieu"}),e.jsx(ie,{id:"comp-location",placeholder:"Ex : Piscine de Strasbourg",value:t,onChange:S=>u(S.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx($,{htmlFor:"comp-description",children:"Description"}),e.jsx(Xe,{id:"comp-description",placeholder:"Notes, informations complementaires...",value:C,onChange:S=>v(S.target.value),rows:3})]}),e.jsxs("div",{className:"space-y-2 pt-2",children:[e.jsx(M,{className:"w-full",onClick:b,disabled:p||!f.trim()||!m,children:p?"Enregistrement...":g?"Enregistrer":"Creer"}),g&&e.jsx(M,{variant:"outline",className:"w-full text-destructive hover:text-destructive",onClick:()=>O(!0),disabled:p,children:"Supprimer cette competition"})]})]})]})}),e.jsx(ue,{open:w,onOpenChange:O,children:e.jsxs(me,{children:[e.jsxs(xe,{children:[e.jsx(pe,{children:"Supprimer la competition"}),e.jsxs(he,{children:["Cette action est irreversible. La competition «"," ",r?.name," » sera supprimee definitivement."]})]}),e.jsxs(ge,{children:[e.jsx(je,{children:"Annuler"}),e.jsx(fe,{onClick:()=>{T.mutate(),O(!1)},className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Supprimer"})]})]})})]})},Vs=({competition:s,onEdit:n})=>{const r=Gs(s.date),a=r<0,l=r>=0,g=s.end_date?`du ${ke(s.date)} au ${ke(s.end_date)}`:ke(s.date);return e.jsxs("button",{type:"button",className:`w-full text-left rounded-xl border bg-card p-3 space-y-1 transition-colors hover:bg-muted/50 ${a?"opacity-60":""}`,onClick:()=>n(s),children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-sm font-semibold truncate",children:s.name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:g})]}),e.jsxs("div",{className:"flex items-center gap-1.5 shrink-0",children:[l&&e.jsxs(H,{variant:"outline",className:"border-orange-300 text-orange-600 dark:text-orange-400 text-[10px] px-1.5 py-0",children:["J-",r]}),a&&e.jsx(H,{variant:"secondary",className:"text-[10px] px-1.5 py-0",children:"Passee"})]})]}),s.location&&e.jsxs("div",{className:"flex items-center gap-1 text-xs text-muted-foreground",children:[e.jsx(Ss,{className:"h-3 w-3 shrink-0"}),e.jsx("span",{className:"truncate",children:s.location})]})]})},Qs=({onBack:s})=>{const[n,r]=i.useState(!1),[a,l]=i.useState(null),{data:g=[],isLoading:f}=B({queryKey:["competitions"],queryFn:()=>D.getCompetitions()}),c=i.useMemo(()=>{const o=new Date;o.setHours(0,0,0,0);const j=o.getTime(),y=[],t=[];for(const u of g)new Date(u.date+"T00:00:00").getTime()>=j?y.push(u):t.push(u);return y.sort((u,C)=>new Date(u.date+"T00:00:00").getTime()-new Date(C.date+"T00:00:00").getTime()),t.sort((u,C)=>new Date(C.date+"T00:00:00").getTime()-new Date(u.date+"T00:00:00").getTime()),[...y,...t]},[g]),m=()=>{l(null),r(!0)},x=o=>{l(o),r(!0)},h=g.length===0?"Gerez les competitions du club.":`${g.length} competition${g.length>1?"s":""}`;return e.jsxs("div",{className:"space-y-6 pb-24",children:[e.jsx(ne,{title:"Competitions",description:h,onBack:s,actions:e.jsxs(M,{variant:"outline",size:"sm",onClick:m,children:[e.jsx(ae,{className:"mr-1.5 h-3.5 w-3.5"}),"Ajouter"]})}),f?e.jsx("div",{className:"space-y-2",children:[1,2,3].map(o=>e.jsx("div",{className:"rounded-xl border p-3 animate-pulse motion-reduce:animate-none",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-4 w-40 rounded bg-muted"}),e.jsx("div",{className:"ml-auto h-5 w-12 rounded bg-muted"})]})},o))}):c.length===0?e.jsxs("div",{className:"text-center py-12 space-y-3",children:[e.jsx(qe,{className:"h-10 w-10 text-muted-foreground mx-auto"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Aucune competition creee."}),e.jsxs(M,{variant:"outline",size:"sm",onClick:m,children:[e.jsx(ae,{className:"mr-1.5 h-3.5 w-3.5"}),"Creer la premiere competition"]})]}):e.jsx("div",{className:"space-y-2",children:c.map(o=>e.jsx(Vs,{competition:o,onEdit:x},o.id))}),e.jsx(Bs,{open:n,onOpenChange:r,competition:a})]})},Us=["50NL","100NL","200NL","400NL","800NL","1500NL","50DOS","100DOS","200DOS","50BR","100BR","200BR","50PAP","100PAP","200PAP","200QN","400QN"];function ts(s){const n=s.match(/^(\d+)(NL|DOS|BR|PAP|QN)$/);if(!n)return s;const r={NL:"Nage Libre",DOS:"Dos",BR:"Brasse",PAP:"Papillon",QN:"4 Nages"};return`${n[1]}m ${r[n[2]]||n[2]}`}function ns(s){const n=Math.floor(s/60),r=s%60,a=Math.floor(r),l=Math.round((r-a)*100);return`${n}:${String(a).padStart(2,"0")}:${String(l).padStart(2,"0")}`}function Qe(s){const n=s.match(/^(\d+):(\d{2})[.::](\d{2})$/);return n?parseInt(n[1])*60+parseInt(n[2])+parseInt(n[3])/100:null}async function Hs(s){const{data:n,error:r}=await cs.rpc("get_auth_uid_for_user",{p_user_id:s});return r?(console.error("[objectives] Failed to resolve auth UUID:",r.message),null):n}const Ys=({open:s,onOpenChange:n,objective:r,athleteName:a,athleteAuthId:l,competitions:g})=>{const{toast:f}=W(),c=oe(),m=!!r,[x,h]=i.useState("chrono"),[o,j]=i.useState(""),[y,t]=i.useState("25"),[u,C]=i.useState(""),[v,w]=i.useState(""),[O,L]=i.useState(""),[k,q]=i.useState(!1),T=d=>{if(d)if(r){const E=!!r.event_code,P=!!r.text;h(E&&P?"both":P?"texte":"chrono"),j(r.event_code??""),t(String(r.pool_length??25)),C(r.target_time_seconds!=null?ns(r.target_time_seconds):""),w(r.text??""),L(r.competition_id??"")}else h("chrono"),j(""),t("25"),C(""),w(""),L("");n(d)},b=I({mutationFn:d=>D.createObjective(d),onSuccess:()=>{f({title:"Objectif cree"}),c.invalidateQueries({queryKey:["objectives"]}),n(!1)},onError:d=>{f({title:"Erreur",description:d.message,variant:"destructive"})}}),p=I({mutationFn:d=>D.updateObjective(r.id,d),onSuccess:()=>{f({title:"Objectif mis a jour"}),c.invalidateQueries({queryKey:["objectives"]}),n(!1)},onError:d=>{f({title:"Erreur",description:d.message,variant:"destructive"})}}),S=I({mutationFn:()=>D.deleteObjective(r.id),onSuccess:()=>{f({title:"Objectif supprime"}),c.invalidateQueries({queryKey:["objectives"]}),n(!1)},onError:d=>{f({title:"Erreur",description:d.message,variant:"destructive"})}}),Q=x==="chrono"||x==="both",Y=x==="texte"||x==="both",_=()=>{if(Q&&!o){f({title:"Epreuve requise",description:"Veuillez selectionner une epreuve.",variant:"destructive"});return}if(Q&&u&&Qe(u)===null){f({title:"Format invalide",description:"Le temps doit être au format m:ss:cc (ex: 1:05:30)",variant:"destructive"});return}if(Y&&!v.trim()){f({title:"Texte requis",description:"Veuillez saisir un objectif texte.",variant:"destructive"});return}const d={athlete_id:l,competition_id:O&&O!=="none"?O:null,event_code:Q?o:null,pool_length:Q?Number(y):null,target_time_seconds:Q&&u?Qe(u):null,text:Y?v.trim():null};m?p.mutate(d):b.mutate(d)},A=b.isPending||p.isPending||S.isPending,F=i.useMemo(()=>{const d=new Date;return d.setHours(0,0,0,0),g.filter(E=>new Date(E.date+"T00:00:00").getTime()>=d.getTime())},[g]);return e.jsxs(e.Fragment,{children:[e.jsx(ve,{open:s,onOpenChange:T,children:e.jsxs(ye,{side:"right",className:"w-full sm:max-w-md overflow-y-auto",children:[e.jsx(be,{children:e.jsx(Ne,{children:m?"Modifier l'objectif":"Nouvel objectif"})}),e.jsxs("div",{className:"mt-6 space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx($,{children:"Nageur"}),e.jsx("p",{className:"text-sm font-medium",children:a})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx($,{children:"Type d'objectif"}),e.jsxs(Ee,{type:"single",variant:"outline",value:x,onValueChange:d=>{d&&h(d)},className:"justify-start",children:[e.jsx(X,{value:"chrono",className:"text-xs",children:"Chrono"}),e.jsx(X,{value:"texte",className:"text-xs",children:"Texte"}),e.jsx(X,{value:"both",className:"text-xs",children:"Les deux"})]})]}),Q&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx($,{children:"Epreuve *"}),e.jsxs(Z,{value:o,onValueChange:j,children:[e.jsx(ee,{children:e.jsx(se,{placeholder:"Choisir une epreuve"})}),e.jsx(te,{children:Us.map(d=>e.jsx(V,{value:d,children:ts(d)},d))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx($,{children:"Bassin"}),e.jsxs(Z,{value:y,onValueChange:t,children:[e.jsx(ee,{children:e.jsx(se,{})}),e.jsxs(te,{children:[e.jsx(V,{value:"25",children:"25m"}),e.jsx(V,{value:"50",children:"50m"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx($,{children:"Temps cible (min:sec:centièmes)"}),e.jsx(ie,{placeholder:"Ex : 1:05:30",value:u,onChange:d=>C(d.target.value)})]})]}),Y&&e.jsxs("div",{className:"space-y-2",children:[e.jsx($,{children:"Objectif texte *"}),e.jsx(Xe,{placeholder:"Ex : Ameliorer la coulée de dos",value:v,onChange:d=>w(d.target.value),rows:3})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx($,{children:"Lier a une competition"}),e.jsxs(Z,{value:O,onValueChange:L,children:[e.jsx(ee,{children:e.jsx(se,{placeholder:"Aucune"})}),e.jsxs(te,{children:[e.jsx(V,{value:"none",children:"Aucune"}),F.map(d=>e.jsxs(V,{value:d.id,children:[d.name," (",d.date,")"]},d.id))]})]})]}),e.jsxs("div",{className:"space-y-2 pt-2",children:[e.jsx(M,{className:"w-full",onClick:_,disabled:A,children:A?"Enregistrement...":m?"Enregistrer":"Creer"}),m&&e.jsx(M,{variant:"outline",className:"w-full text-destructive hover:text-destructive",onClick:()=>q(!0),disabled:A,children:"Supprimer cet objectif"})]})]})]})}),e.jsx(ue,{open:k,onOpenChange:q,children:e.jsxs(me,{children:[e.jsxs(xe,{children:[e.jsx(pe,{children:"Supprimer l'objectif"}),e.jsx(he,{children:"Cette action est irreversible. L'objectif sera supprime definitivement."})]}),e.jsxs(ge,{children:[e.jsx(je,{children:"Annuler"}),e.jsx(fe,{onClick:()=>{S.mutate(),q(!1)},className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Supprimer"})]})]})})]})},Ws=({objective:s,onEdit:n})=>{const r=!!s.event_code,a=!!s.text;return e.jsxs("button",{type:"button",className:"w-full text-left rounded-xl border bg-card p-3 space-y-1.5 transition-colors hover:bg-muted/50",onClick:()=>n(s),children:[r&&e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"text-sm font-semibold",children:ts(s.event_code)}),s.pool_length&&e.jsxs(H,{variant:"secondary",className:"text-[10px] px-1.5 py-0",children:[s.pool_length,"m"]}),s.target_time_seconds!=null&&e.jsx(H,{variant:"outline",className:"text-[10px] px-1.5 py-0 font-mono",children:ns(s.target_time_seconds)})]}),a&&e.jsx("p",{className:"text-sm text-muted-foreground line-clamp-2",children:s.text}),s.competition_name&&e.jsx(H,{variant:"outline",className:"border-orange-300 text-orange-600 dark:text-orange-400 text-[10px] px-1.5 py-0",children:s.competition_name})]})},Js=({onBack:s,athletes:n,athletesLoading:r})=>{const{toast:a}=W(),[l,g]=i.useState(""),[f,c]=i.useState(!1),[m,x]=i.useState(null),h=i.useMemo(()=>l?n.find(k=>k.id!=null&&String(k.id)===l)??null:null,[n,l]),{data:o,isLoading:j}=B({queryKey:["auth-uid",l],queryFn:()=>Hs(Number(l)),enabled:!!l}),{data:y=[]}=B({queryKey:["competitions"],queryFn:()=>D.getCompetitions()}),{data:t=[],isLoading:u}=B({queryKey:["objectives",o],queryFn:()=>D.getObjectives(o),enabled:!!o}),C=i.useMemo(()=>{const k=n.filter(T=>T.id!=null),q=new Map;for(const T of k){const b=T.group_label||"Sans groupe";q.has(b)||q.set(b,[]),q.get(b).push(T)}return[...q.entries()].sort(([T],[b])=>T.localeCompare(b,"fr"))},[n]),v=()=>{if(!o){a({title:"Nageur requis",description:"Veuillez selectionner un nageur.",variant:"destructive"});return}x(null),c(!0)},w=k=>{x(k),c(!0)},O=r||!!l&&j,L=!!o&&!j;return e.jsxs("div",{className:"space-y-6 pb-24",children:[e.jsx(ne,{title:"Objectifs",description:"Definissez des objectifs chrono ou texte pour chaque nageur.",onBack:s,actions:e.jsxs(M,{variant:"outline",size:"sm",onClick:v,disabled:!o,children:[e.jsx(ae,{className:"mr-1.5 h-3.5 w-3.5"}),"Ajouter"]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx($,{children:"Nageur"}),e.jsxs(Z,{value:l,onValueChange:g,children:[e.jsx(ee,{children:e.jsx(se,{placeholder:"Selectionner un nageur"})}),e.jsx(te,{children:C.map(([k,q])=>e.jsxs("div",{children:[e.jsx("div",{className:"px-2 py-1.5 text-xs font-semibold uppercase tracking-wider text-muted-foreground",children:k}),q.map(T=>e.jsx(V,{value:String(T.id),children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:T.display_name}),T.group_label&&e.jsx(H,{variant:"secondary",className:"text-[10px] px-1.5 py-0",children:T.group_label})]})},T.id))]},k))})]})]}),!l&&e.jsxs("div",{className:"text-center py-12 space-y-3",children:[e.jsx(ze,{className:"h-10 w-10 text-muted-foreground mx-auto"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Selectionnez un nageur pour voir et gerer ses objectifs."})]}),O&&l&&e.jsx("div",{className:"space-y-2",children:[1,2,3].map(k=>e.jsx("div",{className:"rounded-xl border p-3 animate-pulse motion-reduce:animate-none",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-4 w-40 rounded bg-muted"}),e.jsx("div",{className:"ml-auto h-5 w-12 rounded bg-muted"})]})},k))}),L&&u&&e.jsx("div",{className:"space-y-2",children:[1,2].map(k=>e.jsx("div",{className:"rounded-xl border p-3 animate-pulse motion-reduce:animate-none",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-4 w-32 rounded bg-muted"}),e.jsx("div",{className:"ml-auto h-5 w-16 rounded bg-muted"})]})},k))}),L&&!u&&t.length===0&&e.jsxs("div",{className:"text-center py-12 space-y-3",children:[e.jsx(ze,{className:"h-10 w-10 text-muted-foreground mx-auto"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Aucun objectif defini pour ",h?.display_name,"."]}),e.jsxs(M,{variant:"outline",size:"sm",onClick:v,children:[e.jsx(ae,{className:"mr-1.5 h-3.5 w-3.5"}),"Creer le premier objectif"]})]}),L&&!u&&t.length>0&&e.jsx("div",{className:"space-y-2",children:t.map(k=>e.jsx(Ws,{objective:k,onEdit:w},k.id))}),o&&h&&e.jsx(Ys,{open:f,onOpenChange:c,objective:m,athleteName:h.display_name,athleteAuthId:o,competitions:y})]})},Xs=i.lazy(()=>We(()=>import("./StrengthCatalog-BJVY5krE.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33]))),Zs=i.lazy(()=>We(()=>import("./SwimCatalog-Q2UQkADH.js"),__vite__mapDeps([34,1,2,3,4,5,6,7,18,19,9,10,11,12,13,21,16,35,36,37,38,39,23,15,24,25,26,27,28,17,31,40,30,41]))),et=({onNavigate:s,onOpenRecordsAdmin:n,onOpenRecordsClub:r,athletes:a,athletesLoading:l,upcomingBirthdays:g,birthdaysLoading:f,kpiLoading:c,kpiPeriod:m,onKpiPeriodChange:x,fatigueAlerts:h,mostLoadedAthlete:o,swimSessionCount:j,strengthSessionCount:y})=>{const t=new Date().getHours(),u=t<12?"Bonjour":t<18?"Bon après-midi":"Bonsoir",C=new Date().toLocaleDateString("fr-FR",{weekday:"long",day:"numeric",month:"long"}),v=h.length>0;return e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-display font-bold uppercase italic",children:[u,", ",e.jsx("span",{className:"text-primary",children:"Coach"})]}),e.jsx("p",{className:"text-sm text-muted-foreground capitalize",children:C})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h2",{className:"text-xs font-semibold uppercase tracking-[0.15em] text-muted-foreground",children:["Signaux · ",m,"j"]}),e.jsxs(Ee,{type:"single",size:"sm",variant:"outline",value:String(m),onValueChange:w=>{w&&x(Number(w))},children:[e.jsx(X,{value:"7",className:"h-7 px-2 text-xs","aria-label":"7 jours",children:"7j"}),e.jsx(X,{value:"30",className:"h-7 px-2 text-xs","aria-label":"30 jours",children:"30j"}),e.jsx(X,{value:"365",className:"h-7 px-2 text-xs","aria-label":"1 an",children:"1an"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:`rounded-xl border p-3 ${v?"border-destructive/30 bg-destructive/5":"bg-muted/30"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-[11px] text-muted-foreground",children:"Fatigue 5/5"}),e.jsx(As,{className:`h-3.5 w-3.5 ${v?"text-destructive":"text-muted-foreground"}`})]}),e.jsx("p",{className:"text-xl font-bold tabular-nums",children:c?"–":h.length}),e.jsx("p",{className:"text-[11px] text-muted-foreground truncate",children:c?"Chargement…":v?h.slice(0,2).map(w=>w.athleteName.split(" ")[0]).join(", "):"Aucune alerte"})]}),e.jsxs("div",{className:"rounded-xl border bg-muted/30 p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-[11px] text-muted-foreground",children:"Plus chargé"}),e.jsx(Se,{className:"h-3.5 w-3.5 text-muted-foreground"})]}),e.jsx("p",{className:"text-xl font-bold truncate",children:c?"–":o?.athleteName?.split(" ")[0]??"–"}),e.jsx("p",{className:"text-[11px] text-muted-foreground",children:c?"Calcul…":o?`Charge ${Math.round(o.loadScore)}`:"Pas de données"})]})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs("button",{type:"button",onClick:()=>s("calendar"),className:"flex items-center gap-1.5 rounded-full bg-primary text-primary-foreground px-3.5 py-2 text-sm font-semibold active:opacity-80 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",children:[e.jsx(Le,{className:"h-3.5 w-3.5"}),"Assigner"]}),e.jsxs("button",{type:"button",onClick:()=>s("messaging"),className:"flex items-center gap-1.5 rounded-full border px-3.5 py-2 text-sm font-semibold active:bg-muted focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",children:[e.jsx(Pe,{className:"h-3.5 w-3.5"}),"Email"]}),e.jsxs("button",{type:"button",onClick:()=>s("groups"),className:"flex items-center gap-1.5 rounded-full border px-3.5 py-2 text-sm font-semibold active:bg-muted focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",children:[e.jsx(Ze,{className:"h-3.5 w-3.5"}),"Groupes"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("button",{type:"button",onClick:()=>s("swim"),className:"rounded-xl border bg-card p-4 text-left shadow-sm active:bg-muted/50 transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",children:[e.jsx(He,{className:"h-5 w-5 text-primary mb-2"}),e.jsx("p",{className:"text-sm font-bold",children:"Natation"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:j!=null?`${j} séance${j!==1?"s":""}`:"Bibliothèque"})]}),e.jsxs("button",{type:"button",onClick:()=>s("strength"),className:"rounded-xl border bg-card p-4 text-left shadow-sm active:bg-muted/50 transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",children:[e.jsx(Ye,{className:"h-5 w-5 text-primary mb-2"}),e.jsx("p",{className:"text-sm font-bold",children:"Musculation"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:y!=null?`${y} séance${y!==1?"s":""}`:"Bibliothèque"})]}),e.jsxs("button",{type:"button",onClick:()=>s("swimmers"),className:"rounded-xl border bg-card p-4 text-left shadow-sm active:bg-muted/50 transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",children:[e.jsx(Se,{className:"h-5 w-5 text-primary mb-2"}),e.jsx("p",{className:"text-sm font-bold",children:"Nageurs"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:l?"Chargement…":`${a.length} nageur${a.length!==1?"s":""}`})]}),e.jsxs("button",{type:"button",onClick:n,className:"rounded-xl border bg-card p-4 text-left shadow-sm active:bg-muted/50 transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",children:[e.jsx(qe,{className:"h-5 w-5 text-primary mb-2"}),e.jsx("p",{className:"text-sm font-bold",children:"Records club"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Import & administration"})]}),e.jsxs("button",{type:"button",onClick:()=>s("competitions"),className:"rounded-xl border bg-card p-4 text-left shadow-sm active:bg-muted/50 transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",children:[e.jsx(qe,{className:"h-5 w-5 text-amber-500 mb-2"}),e.jsx("p",{className:"text-sm font-bold",children:"Compétitions"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Échéances & calendrier"})]}),e.jsxs("button",{type:"button",onClick:()=>s("objectives"),className:"rounded-xl border bg-card p-4 text-left shadow-sm active:bg-muted/50 transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",children:[e.jsx(ze,{className:"h-5 w-5 text-primary mb-2"}),e.jsx("p",{className:"text-sm font-bold",children:"Objectifs"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Temps cibles & objectifs"})]})]}),e.jsx("button",{type:"button",onClick:r,className:"w-full text-center text-sm text-primary font-semibold py-1 active:opacity-70 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring rounded",children:"Voir les records du club"}),!f&&g&&g.length>0?e.jsxs("div",{className:"space-y-2",children:[e.jsx("h2",{className:"text-xs font-semibold uppercase tracking-[0.15em] text-muted-foreground",children:"Anniversaires"}),e.jsx("div",{className:"space-y-1.5",children:g.slice(0,3).map(w=>e.jsxs("div",{className:"flex items-center justify-between gap-2 rounded-lg border px-3 py-2",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("span",{className:"text-sm font-medium truncate block",children:w.display_name}),e.jsx("span",{className:"text-[11px] text-muted-foreground",children:st(w.next_birthday)})]}),e.jsxs("span",{className:"text-xs font-bold text-primary shrink-0",children:["J-",w.days_until]})]},w.id))})]}):null]})},st=s=>{if(!s)return"-";const n=new Date(s);return Number.isNaN(n.getTime())?s:n.toLocaleDateString("fr-FR")},Ue=s=>s.toISOString().split("T")[0],tt=s=>new Date(s.completed_at||s.started_at||s.date||s.created_at||0).getTime(),nt=s=>{if(!s.length)return null;const n=s.reduce((a,l)=>a+l,0)/s.length,r=Math.min(5,Math.max(1,Math.round(n/10*5)));return{average:n,rating:r}};function zt(){const s=Ie(p=>p.role),n=Ie(p=>p.setSelectedAthlete),[,r]=ds(),[a,l]=i.useState("home"),[g,f]=i.useState(7);i.useEffect(()=>{const p=()=>l("home");return window.addEventListener("nav:reset",p),()=>window.removeEventListener("nav:reset",p)},[]);const c=s==="coach"||s==="admin",m=a==="home"||a==="calendar",x=a==="home"||a==="messaging"||a==="swimmers"||a==="calendar"||a==="groups"||a==="objectives",h=a==="messaging"||a==="calendar"||a==="groups",o=a==="home"||a==="swimmers",{data:j}=B({queryKey:["swim_catalog"],queryFn:()=>D.getSwimCatalog(),enabled:c&&m}),{data:y}=B({queryKey:["strength_catalog"],queryFn:()=>D.getStrengthSessions(),enabled:c&&m}),{data:t=[],isLoading:u}=B({queryKey:["athletes"],queryFn:()=>D.getAthletes(),enabled:c&&x}),C=i.useMemo(()=>t.slice(0,5),[t]),{data:v=[]}=B({queryKey:["groups"],queryFn:()=>D.getGroups(),enabled:c&&h}),w=B({queryKey:["upcoming-birthdays"],queryFn:()=>D.getUpcomingBirthdays({days:30}),enabled:c&&o}),O=w.data,L=B({queryKey:["coach-kpis",g,C.map(p=>p.id??p.display_name)],enabled:c&&a==="home"&&C.length>0,queryFn:async()=>{const p=g,S=new Date;S.setDate(S.getDate()-p);const Q=Ue(S),Y=Ue(new Date),_=await Promise.all(C.map(async d=>{const[E,P]=await Promise.all([D.getSessions(d.display_name,d.id),D.getStrengthHistory(d.display_name,{athleteId:d.id,limit:50,from:Q,to:Y})]),N=E.filter(z=>new Date(z.date).getTime()>=S.getTime()),K=N.map(z=>z.fatigue??z.feeling).filter(z=>Number.isFinite(z)),R=N.reduce((z,J)=>z+(Number(J.duration)||0)*(Number(J.effort)||0),0),G=(P?.runs??[]).filter(z=>tt(z)>=S.getTime()),ce=G.map(z=>z.fatigue??z.feeling??z.rpe).filter(z=>Number.isFinite(Number(z))).map(z=>Number(z)),de=G.reduce((z,J)=>{const $e=Number(J.feeling??J.rpe??0),Re=Number(J.duration??0);if(Re>0&&$e>0)return z+Re*$e;const rs=Array.isArray(J.logs)?J.logs.length:0;return z+rs*5},0),as=nt([...K,...ce]);return{athleteName:d.display_name,loadScore:R+de,fatigueRating:as}})),A=_.filter(d=>d.fatigueRating?.rating===5).map(d=>({athleteName:d.athleteName,rating:d.fatigueRating?.rating??0})),F=_.filter(d=>d.loadScore>0).sort((d,E)=>E.loadScore-d.loadScore)[0];return{fatigueAlerts:A,mostLoadedAthlete:F??null}}}),k=p=>{n({id:p.id??null,name:p.display_name}),r("/progress")},{toast:q}=W(),T=oe(),b=I({mutationFn:async p=>{const S=await D.importSingleSwimmer(p.iuf,p.name);return await D.recalculateClubRecords(),S},onSuccess:p=>{q({title:"Import terminé",description:`${p.total_found} trouvées, ${p.new_imported} nouvelles.`}),T.invalidateQueries({queryKey:["club-records"]})},onError:p=>{q({title:"Erreur import",description:p.message,variant:"destructive"})}});return c?e.jsxs("div",{className:"space-y-6",children:[a==="home"?e.jsx(et,{onNavigate:l,onOpenRecordsAdmin:()=>r("/records-admin"),onOpenRecordsClub:()=>r("/records-club"),athletes:t,athletesLoading:u,upcomingBirthdays:O,birthdaysLoading:w.isLoading,kpiLoading:L.isLoading,kpiPeriod:g,onKpiPeriodChange:f,fatigueAlerts:L.data?.fatigueAlerts??[],mostLoadedAthlete:L.data?.mostLoadedAthlete??null,swimSessionCount:j?.length,strengthSessionCount:y?.length}):null,a==="swim"?e.jsxs("div",{className:"space-y-6",children:[e.jsx(ne,{title:"Bibliothèque natation",description:"Accédez aux séances et aux templates natation.",onBack:()=>l("home"),actions:e.jsxs(M,{variant:"outline",size:"sm",onClick:()=>l("calendar"),children:[e.jsx(Le,{className:"mr-1.5 h-3.5 w-3.5"}),"Assigner"]})}),e.jsx(i.Suspense,{fallback:e.jsx(Ke,{}),children:e.jsx(Zs,{})})]}):null,a==="strength"?e.jsxs("div",{className:"space-y-6",children:[e.jsx(ne,{title:"Bibliothèque musculation",description:"Consultez et créez des séances musculation.",onBack:()=>l("home"),actions:e.jsxs(M,{variant:"outline",size:"sm",onClick:()=>l("calendar"),children:[e.jsx(Le,{className:"mr-1.5 h-3.5 w-3.5"}),"Assigner"]})}),e.jsx(i.Suspense,{fallback:e.jsx(Ke,{}),children:e.jsx(Xs,{})})]}):null,a==="swimmers"?e.jsxs("div",{className:"space-y-4",children:[e.jsx(ne,{title:"Nageurs",description:u?"Chargement…":`${t.length} nageur${t.length!==1?"s":""} inscrit${t.length!==1?"s":""}`,onBack:()=>l("home"),actions:e.jsxs(M,{variant:"outline",size:"sm",onClick:()=>l("messaging"),children:[e.jsx(Pe,{className:"mr-1.5 h-3.5 w-3.5"}),"Email"]})}),u?e.jsx("div",{className:"space-y-2",children:[1,2,3,4,5].map(p=>e.jsx("div",{className:"rounded-xl border p-3 animate-pulse motion-reduce:animate-none",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-4 w-32 rounded bg-muted"}),e.jsx("div",{className:"ml-auto h-8 w-16 rounded bg-muted"})]})},p))}):t.length?e.jsx("div",{className:"space-y-2",children:t.map(p=>e.jsxs("div",{className:"flex items-center gap-3 rounded-xl border bg-card p-3",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-sm font-semibold truncate",children:p.display_name}),e.jsxs("div",{className:"flex items-center gap-2 mt-0.5",children:[p.group_label?e.jsx(H,{variant:"secondary",className:"text-[10px] px-1.5 py-0",children:p.group_label}):null,p.ffn_iuf?e.jsx("span",{className:"text-[10px] font-mono text-muted-foreground",children:p.ffn_iuf}):null]})]}),e.jsxs("div",{className:"flex items-center gap-1 shrink-0",children:[p.ffn_iuf?e.jsx(M,{size:"icon",variant:"ghost",className:"h-8 w-8",disabled:b.isPending,onClick:()=>b.mutate({iuf:p.ffn_iuf,name:p.display_name}),title:"Importer performances FFN",children:e.jsx(us,{className:"h-4 w-4"})}):null,e.jsx(M,{size:"sm",variant:"outline",onClick:()=>k(p),children:"Fiche"})]})]},p.id??p.display_name))}):e.jsx("p",{className:"text-sm text-muted-foreground text-center py-8",children:"Aucun nageur disponible."})]}):null,a==="messaging"?e.jsx(qs,{onBack:()=>l("home"),athletes:t,groups:v,athletesLoading:u}):null,a==="calendar"?e.jsx(Ps,{onBack:()=>l("home"),athletes:t,groups:v,swimSessions:j,strengthSessions:y}):null,a==="groups"?e.jsx(Ks,{onBack:()=>l("home"),athletes:t,groups:v,athletesLoading:u}):null,a==="competitions"?e.jsx(Qs,{onBack:()=>l("home")}):null,a==="objectives"?e.jsx(Js,{onBack:()=>l("home"),athletes:t,athletesLoading:u}):null]}):e.jsx("div",{className:"flex items-center justify-center min-h-[60vh] animate-in fade-in motion-reduce:animate-none",children:e.jsxs(Me,{className:"w-full max-w-sm shadow-xl border-t-4 border-t-primary",children:[e.jsxs(De,{children:[e.jsxs(Ae,{className:"flex items-center gap-2 uppercase italic",children:[e.jsx(Se,{className:"h-5 w-5 text-primary"}),"Accès Coach"]}),e.jsx(Te,{children:"Cette section est réservée aux coachs et administrateurs."})]}),e.jsx(Fe,{children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"Connectez-vous avec un compte autorisé pour accéder aux outils de gestion."})})]})})}export{zt as default};
