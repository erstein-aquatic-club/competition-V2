import{r as m,u as S,e as St,j as e}from"./vendor-query-DyA9aSKS.js";import{a as j}from"./api-DgHNrwix.js";import{c as wt}from"./date-DrpgLmFD.js";import{u as K,T as Ct,B as de,C as Fe,e as $e,f as Dt}from"./index-DEw8lXrn.js";import{S as Ke,a as Ie,b as Ee,c as qe,d as Ve}from"./sheet-DDucIX1O.js";import{T as Pt,a as At,b as ce,c as U,d as Tt,e as I}from"./table-DalWEWpY.js";import{T as Lt,a as Mt,b as Be,c as He}from"./tabs-wFWituNE.js";import{C as kt,a as Ot,b as Rt}from"./collapsible-Dd1xq-gT.js";import{s as Je}from"./score-CwBbkHfb.js";import{i as _t}from"./swim-BadMaWRd.js";import{g as Ft}from"./design-tokens-CKgCpdH6.js";import{b as q}from"./animations-CrcLFysI.js";import{I as $t}from"./InlineBanner-mxHriW89.js";import{P as Kt}from"./PageHeader-BWdT6OVz.js";import{s as me,a as D,e as It,f as A}from"./vendor-date-B8Mnp-Vt.js";import{C as Et}from"./chart-column-DSb1zrzg.js";import{S as ze}from"./sliders-horizontal-D4jt2W6h.js";import{m as k}from"./vendor-motion-CMsaQ8FX.js";import{a as T,A as We,X as E,T as L,b as Qe,P as qt,d as Vt,C as Bt,L as Ge,B as Ue,Y as ue,e as ge,f as Ht,g as zt}from"./vendor-charts-BrQ8X25f.js";import{T as Wt}from"./trending-down-103ZgH0f.js";import{C as Qt}from"./chevron-down-3Nhh0smy.js";import"./vendor-react-BzrpNAyj.js";import"./vendor-supabase-DFPLkPj_.js";import"./index-Mlw1bK_H.js";import"./index-BE3EncBH.js";import"./index-C74tTsj8.js";import"./index-C9wGSa99.js";import"./chevron-left-CtHJ-HcN.js";function Y({label:x,value:u,max:g,invert:i=!1}){const v=u!==null?Math.min(100,u/g*100):0,w=Je(u??null,{invert:i})??"hsl(var(--muted-foreground))";return e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"w-28 shrink-0 text-xs text-muted-foreground truncate",children:x}),e.jsx("div",{className:"relative h-2 flex-1 rounded-full bg-muted overflow-hidden",children:e.jsx(k.div,{className:"absolute inset-y-0 left-0 rounded-full",style:{backgroundColor:w},initial:{width:0},animate:{width:`${v}%`},transition:{duration:.6,ease:"easeOut"}})}),e.jsx("span",{className:"w-10 text-right text-sm font-mono font-semibold tabular-nums",children:u!==null?u.toFixed(1):"-"})]})}function Ye({value:x,unit:u,label:g,trend:i,trendLabel:v}){return e.jsxs(k.div,{className:"flex flex-col items-center gap-0.5 py-2",variants:q,initial:"hidden",animate:"visible",children:[e.jsxs("div",{className:"flex items-baseline gap-1",children:[e.jsx("span",{className:"text-4xl font-mono font-bold tracking-tight",children:x}),u&&e.jsx("span",{className:"text-lg font-mono text-muted-foreground",children:u})]}),e.jsx("span",{className:"text-sm text-muted-foreground",children:g}),i!=null&&e.jsxs("span",{className:`inline-flex items-center gap-1 rounded-full px-2 py-0.5 text-xs font-medium ${i>=0?"bg-emerald-500/10 text-emerald-600":"bg-red-500/10 text-red-600"}`,children:[i>=0?e.jsx(Dt,{className:"h-3 w-3"}):e.jsx(Wt,{className:"h-3 w-3"}),i>=0?"+":"",i.toFixed(0),"%",v?` ${v}`:""]})]})}function M({value:x,label:u,colored:g,colorValue:i,invert:v}){const w="rounded-full px-3 py-1 text-sm font-mono";if(g&&i!==null&&i!==void 0){const d=Je(i,{invert:v})??"hsl(var(--muted-foreground))";return e.jsx("span",{className:w,style:{backgroundColor:d,color:Ft(d)},children:x})}return e.jsxs("span",{className:`${w} bg-muted text-muted-foreground`,children:[x,u?` ${u}`:""]})}function xe(){return e.jsx("div",{className:"space-y-3 animate-pulse motion-reduce:animate-none",children:e.jsx("div",{className:"h-[180px] w-full rounded-xl bg-muted"})})}function he({title:x,children:u}){const[g,i]=m.useState(!1);return e.jsxs(kt,{open:g,onOpenChange:i,children:[e.jsxs(Ot,{className:"flex w-full items-center justify-between rounded-lg bg-muted/50 px-4 py-3 text-sm font-semibold hover:bg-muted transition-colors",children:[x,e.jsx(Qt,{className:`h-4 w-4 text-muted-foreground transition-transform duration-200 ${g?"rotate-180":""}`})]}),e.jsx(Rt,{className:"pt-4 animate-in fade-in slide-in-from-top-2 motion-reduce:animate-none",children:u})]})}const J={borderRadius:"8px",border:"none",boxShadow:"0 4px 12px rgba(0,0,0,0.1)"},X=[{value:7,label:"7j"},{value:30,label:"30j"},{value:365,label:"1 an"}];function Ss(){const x=K(t=>t.user),u=K(t=>t.userId),g=K(t=>t.role),i=K(t=>t.selectedAthleteId),v=K(t=>t.selectedAthleteName),w=(g==="coach"||g==="admin")&&(i!==null||!!v),d=w?v:x,h=w?i:u,f=h??d,[Z]=m.useState("all"),[fe]=m.useState(""),[pe]=m.useState(""),[N,je]=m.useState(30),[p,ve]=m.useState(30),[Xe,ee]=m.useState(!1),[Ze,te]=m.useState(!1);m.useEffect(()=>{const t=()=>{je(30),ve(30)};return window.addEventListener("nav:reset",t),()=>window.removeEventListener("nav:reset",t)},[]);const{data:se=[]}=S({queryKey:["competitions"],queryFn:()=>j.getCompetitions()}),{data:V}=S({queryKey:["my-competition-ids",f],queryFn:()=>j.getMyCompetitionIds(h)}),{data:ye}=S({queryKey:["assignments",f],queryFn:()=>j.getAssignments(d,h),enabled:!!d}),{data:be=[]}=S({queryKey:["planned-absences",f],queryFn:()=>h?j.getPlannedAbsences({userId:h}):j.getMyPlannedAbsences()}),Ne=m.useMemo(()=>new Set(be.map(t=>t.date)),[be]),{data:P,isLoading:et}=S({queryKey:["sessions",f],queryFn:()=>j.getSessions(d,h),enabled:!!d}),O=St({queryKey:["strength_history",f,"progress",Z,fe,pe],queryFn:({pageParam:t=0})=>j.getStrengthHistory(d,{athleteId:h,limit:10,offset:t,order:"desc",status:Z==="all"?void 0:Z,from:fe||void 0,to:pe||void 0}),enabled:!!d,getNextPageParam:t=>{const s=t.pagination.offset+t.pagination.limit;return s<t.pagination.total?s:void 0},initialPageParam:0}),Se=O.data?.pages.flatMap(t=>t.runs)??[],B=me(D(new Date,p)).toISOString(),H=It(new Date).toISOString(),we=me(D(new Date,p*2)).toISOString(),Ce=me(D(new Date,p)).toISOString(),{data:De,isLoading:tt}=S({queryKey:["strength_history_summary",f,"progress",p,B,H],queryFn:()=>j.getStrengthHistory(d,{athleteId:h,limit:200,order:"desc",from:B,to:H}),enabled:!!d}),{data:st,isLoading:at}=S({queryKey:["strength_history_aggregate",f,"progress",p,B,H],queryFn:()=>j.getStrengthHistoryAggregate(d,{athleteId:h,period:"day",limit:200,order:"asc",from:B,to:H}),enabled:!!d}),{data:nt}=S({queryKey:["strength_history_aggregate_prev",f,"progress",p,we,Ce],queryFn:()=>j.getStrengthHistoryAggregate(d,{athleteId:h,period:"day",limit:200,order:"asc",from:we,to:Ce}),enabled:!!d}),Pe=tt||at,ae=De?.runs??[],rt=De?.exercise_summary??[],R=st?.periods??[],ot=nt?.periods??[],Ae=m.useMemo(()=>!V||V.length===0?se:se.filter(t=>V.includes(t.id)),[se,V]),y=m.useMemo(()=>{const t=new Date().toISOString().slice(0,10);return Ae.filter(s=>s.date.slice(0,10)>=t).sort((s,n)=>s.date.localeCompare(n.date))[0]??null},[Ae]),ne=m.useMemo(()=>{if(!y)return null;const t=new Date;t.setHours(0,0,0,0);const s=new Date(y.date.slice(0,10)+"T00:00:00");return Math.round((s.getTime()-t.getTime())/(1e3*60*60*24))},[y]),Te=m.useMemo(()=>{const t=`swim-dashboard-v2:${f}:presenceDefaults`;try{const n=window.localStorage.getItem(t);if(n)return JSON.parse(n)}catch{}const s={};for(let n=0;n<7;n++)s[n]={AM:!0,PM:!0};return s},[f]),z=m.useMemo(()=>y?wt({compDate:y.date.slice(0,10),assignments:ye,absenceDates:Ne,presenceDefaults:Te}):null,[y,ye,Ne,Te]),it=t=>{if(!P)return[];const s=D(new Date,t),n=P.filter(a=>new Date(a.date)>=s).reverse(),l=new Map;return n.forEach(a=>{const r=A(new Date(a.date),"dd/MM");l.has(r)||l.set(r,{date:r,distance:0,effort:0,rpe:0,performance:0,engagement:0,fatigue:0,count:0,rpeCount:0,performanceCount:0,engagementCount:0,fatigueCount:0});const o=l.get(r);o.distance+=a.distance,o.effort+=a.effort,o.count+=1,a.rpe!==null&&a.rpe!==void 0&&(o.rpe+=a.rpe,o.rpeCount+=1),a.performance!==null&&a.performance!==void 0&&(o.performance+=a.performance,o.performanceCount+=1),a.engagement!==null&&a.engagement!==void 0&&(o.engagement+=a.engagement,o.engagementCount+=1),a.fatigue!==null&&a.fatigue!==void 0&&(o.fatigue+=a.fatigue,o.fatigueCount+=1)}),Array.from(l.values()).map(a=>({...a,effort:Math.round(a.effort/a.count*10)/10,rpe:a.rpeCount?Math.round(a.rpe/a.rpeCount*10)/10:null,performance:a.performanceCount?Math.round(a.performance/a.performanceCount*10)/10:null,engagement:a.engagementCount?Math.round(a.engagement/a.engagementCount*10)/10:null,fatigue:a.fatigueCount?Math.round(a.fatigue/a.fatigueCount*10)/10:null}))},_=P?P.filter(t=>new Date(t.date)>=D(new Date,N)):[],F=_.length,c=_.reduce((t,s)=>(t.distance+=s.distance,t.duration+=s.duration,s.rpe!==null&&s.rpe!==void 0&&(t.rpeSum+=s.rpe,t.rpeCount+=1),s.performance!==null&&s.performance!==void 0&&(t.performanceSum+=s.performance,t.performanceCount+=1),s.engagement!==null&&s.engagement!==void 0&&(t.engagementSum+=s.engagement,t.engagementCount+=1),s.fatigue!==null&&s.fatigue!==void 0&&(t.fatigueSum+=s.fatigue,t.fatigueCount+=1),t),{distance:0,duration:0,rpeSum:0,rpeCount:0,performanceSum:0,performanceCount:0,engagementSum:0,engagementCount:0,fatigueSum:0,fatigueCount:0}),lt=c.rpeCount?c.rpeSum/c.rpeCount:null,dt=c.performanceCount?c.performanceSum/c.performanceCount:null,ct=c.engagementCount?c.engagementSum/c.engagementCount:null,mt=c.fatigueCount?c.fatigueSum/c.fatigueCount:null,ut=F?c.duration/F:0,gt=F?c.distance/F:0,Le=it(N),xt=P?((t,s,n,l)=>{const a=new Date,r=D(a,n*2),o=D(a,n),$=s.filter(C=>{const b=new Date(C.date);return b>=r&&b<o}).reduce((C,b)=>C+(b.distance??0),0);return $===0?null:(t-$)/$*100})(c.distance,P,N):null,re=["NL","DOS","BR","PAP","QN"],Me={NL:"NL",DOS:"Dos",BR:"Brasse",PAP:"Pap",QN:"4N"},ke={NL:"hsl(210, 80%, 55%)",DOS:"hsl(160, 60%, 45%)",BR:"hsl(35, 85%, 55%)",PAP:"hsl(280, 60%, 55%)",QN:"hsl(340, 70%, 55%)"},W=m.useMemo(()=>{if(!_.length)return{pie:[],daily:[],hasData:!1};const t={NL:0,DOS:0,BR:0,PAP:0,QN:0};let s=!1;const n=new Map;for(const r of _){const o=r.stroke_distances;if(!o)continue;const G=A(new Date(r.date),"dd/MM");n.has(G)||n.set(G,{NL:0,DOS:0,BR:0,PAP:0,QN:0});const $=n.get(G);for(const C of re){const b=o[C];b&&b>0&&(t[C]+=b,$[C]+=b,s=!0)}}const l=re.filter(r=>t[r]>0).map(r=>({name:Me[r],value:t[r],fill:ke[r]})),a=Array.from(n.entries()).map(([r,o])=>({date:r,...o}));return{pie:l,daily:a,hasData:s}},[_]),oe=t=>{const n=(Array.isArray(t?.logs)?t.logs:[]).map(r=>r?.rpe!==null&&r?.rpe!==void 0?Number(r.rpe):null).filter(r=>r!==null&&Number.isFinite(r));if(n.length>0)return n.reduce((r,o)=>r+o,0)/n.length;const l=t?.feeling??t?.rpe??null,a=l!=null?Number(l):null;return a!==null&&Number.isFinite(a)?a:null},ht=t=>t==null||Number.isNaN(t)?"-":t.toFixed(1),Oe=[...ae].sort((t,s)=>{const n=new Date(t.started_at||t.date||t.created_at||0).getTime(),l=new Date(s.started_at||s.date||s.created_at||0).getTime();return n-l}).map(t=>({date:A(new Date(t.started_at||t.date||t.created_at||new Date),"dd/MM"),feeling:oe(t)})),Re=R.map(t=>({date:t.period,label:A(new Date(t.period),"dd/MM"),tonnage:Math.round(t.tonnage??0),volume:Math.round(t.volume??0)})),ft=R.reduce((t,s)=>t+(s.tonnage??0),0),pt=R.reduce((t,s)=>t+(s.volume??0),0),jt=ae.length,ie=ae.map(t=>oe(t)).filter(t=>t!==null&&Number.isFinite(t)),Q=ie.length?ie.reduce((t,s)=>t+s,0)/ie.length:null,le=[...rt].map(t=>({exerciseId:Number(t.exercise_id),name:t.exercise_name||`Exercice ${t.exercise_id}`,totalSets:Number(t.total_sets??0),totalReps:Number(t.total_reps??0),totalVolume:Number(t.total_volume??0),maxWeight:t.max_weight!==null&&t.max_weight!==void 0?Number(t.max_weight):null,lastPerformedAt:t.last_performed_at??null})).sort((t,s)=>s.totalVolume-t.totalVolume),vt=(()=>{if(!R.length)return null;const t=R.reduce((n,l)=>n+(l.tonnage??0),0),s=ot.reduce((n,l)=>n+(l.tonnage??0),0);return s===0?null:(t-s)/s*100})(),_e=le.slice(0,8),yt=X.find(t=>t.value===N)?.label??`${N}j`,bt=X.find(t=>t.value===p)?.label??`${p}j`,Nt=t=>{if(!t)return"-";const s=new Date(t);return Number.isNaN(s.getTime())?"-":A(s,"dd/MM/yyyy")};return e.jsxs("div",{className:"space-y-4 pb-4",children:[e.jsx(Kt,{title:"Progression",icon:e.jsx(Et,{className:"h-3.5 w-3.5"})}),e.jsx($t,{variant:"amber",icon:e.jsx(Ct,{}),label:y?.name,badge:ne===0?"Aujourd'hui":`J-${ne}`,sublabel:y?.location,subbadge:z!=null&&z>0?`${z} séance${z>1?"s":""}`:void 0,visible:!!y&&ne!=null}),e.jsxs(Lt,{defaultValue:"swim",className:"w-full",children:[e.jsxs(Mt,{className:"grid w-full max-w-[280px] grid-cols-2",children:[e.jsx(Be,{value:"swim",children:"Natation"}),e.jsx(Be,{value:"strength",children:"Musculation"})]}),e.jsxs(He,{value:"swim",className:"space-y-4 mt-4",children:[e.jsx("div",{className:"rounded-2xl border border-border/70 bg-card/90 px-4 py-3 shadow-sm",children:e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-[11px] font-semibold uppercase tracking-[0.22em] text-muted-foreground",children:"Période active"}),e.jsxs("p",{className:"mt-1 text-sm font-semibold text-foreground",children:["Natation sur ",yt]})]}),e.jsxs(de,{type:"button",variant:"outline",size:"sm",onClick:()=>ee(!0),className:"gap-1.5 border-primary/20 text-primary hover:bg-primary/5",children:[e.jsx(ze,{className:"h-3.5 w-3.5"}),"Période"]})]})}),e.jsx(Ke,{open:Xe,onOpenChange:ee,children:e.jsxs(Ie,{side:"bottom",className:"max-h-[70vh] overflow-y-auto rounded-t-3xl",children:[e.jsxs(Ee,{className:"text-left",children:[e.jsx(qe,{children:"Filtrer la progression natation"}),e.jsx(Ve,{children:"Change la fenêtre d'analyse sans charger la vue avec des contrôles permanents."})]}),e.jsx("div",{className:"grid grid-cols-2 gap-3 pt-5",children:X.map(t=>e.jsxs("button",{type:"button",onClick:()=>{je(t.value),ee(!1)},className:`rounded-2xl border px-4 py-4 text-left transition-colors ${N===t.value?"border-primary bg-primary/5 text-primary":"border-border hover:border-primary/30"}`,children:[e.jsx("div",{className:"text-sm font-semibold",children:t.label}),e.jsxs("div",{className:"mt-1 text-xs text-muted-foreground",children:["Tendances et ressentis sur ",t.label]})]},t.value))})]})}),e.jsx(Ye,{value:(c.distance/1e3).toFixed(1),unit:"km",label:`volume sur ${N} jours`,trend:xt,trendLabel:"vs période préc."}),e.jsxs("div",{className:"flex flex-wrap items-center justify-center gap-2",children:[e.jsx(M,{value:`${F} séances`}),e.jsx(M,{value:`${Math.round(gt).toLocaleString()}m moy`}),e.jsx(M,{value:`${Math.round(ut)}min moy`})]}),e.jsx(k.div,{variants:q,initial:"hidden",animate:"visible",children:e.jsx(Fe,{className:"border-0 shadow-none bg-transparent",children:e.jsx($e,{className:"p-0 h-[140px] w-full",children:et?e.jsx(xe,{}):Le.length===0?e.jsx("div",{className:"flex h-full items-center justify-center text-sm text-muted-foreground",children:"Aucune donnée disponible."}):e.jsx(T,{width:"100%",height:"100%",children:e.jsxs(We,{data:Le,children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"swimVolumeGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"0%",stopColor:"hsl(var(--primary))",stopOpacity:.3}),e.jsx("stop",{offset:"100%",stopColor:"hsl(var(--primary))",stopOpacity:0})]})}),e.jsx(E,{dataKey:"date",fontSize:10,tickLine:!1,axisLine:!1}),e.jsx(L,{contentStyle:J,formatter:t=>[`${t.toLocaleString()}m`,"Volume"]}),e.jsx(Qe,{type:"monotone",dataKey:"distance",stroke:"hsl(var(--primary))",strokeWidth:2,fill:"url(#swimVolumeGradient)",dot:!1,activeDot:{r:5,strokeWidth:2}})]})})})})}),e.jsxs(k.div,{className:"space-y-3",variants:q,initial:"hidden",animate:"visible",children:[e.jsx("h3",{className:"text-xs font-semibold uppercase tracking-wider text-muted-foreground",children:"Ressentis moyens"}),e.jsx(Y,{label:"Difficulté",value:lt,max:5,invert:!0}),e.jsx(Y,{label:"Performance",value:dt,max:5}),e.jsx(Y,{label:"Engagement",value:ct,max:5}),e.jsx(Y,{label:"Fatigue",value:mt,max:5,invert:!0})]}),W.hasData&&e.jsx(he,{title:`Répartition par nage (${N}j)`,children:e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsx("div",{className:"h-[280px] w-full",children:e.jsx(T,{width:"100%",height:"100%",children:e.jsxs(qt,{children:[e.jsx(Vt,{data:W.pie,dataKey:"value",nameKey:"name",cx:"50%",cy:"50%",outerRadius:90,label:({name:t,percent:s})=>`${t} ${(s*100).toFixed(0)}%`,children:W.pie.map((t,s)=>e.jsx(Bt,{fill:t.fill},`pie-${s}`))}),e.jsx(L,{formatter:t=>[`${t.toLocaleString()}m`,"Distance"]}),e.jsx(Ge,{})]})})}),e.jsx("div",{className:"h-[280px] w-full",children:e.jsx(T,{width:"100%",height:"100%",children:e.jsxs(Ue,{data:W.daily,children:[e.jsx(E,{dataKey:"date",fontSize:10,tickLine:!1,axisLine:!1}),e.jsx(ue,{fontSize:10,tickLine:!1,axisLine:!1}),e.jsx(L,{}),re.map(t=>e.jsx(ge,{dataKey:t,stackId:"strokes",name:Me[t],fill:ke[t],radius:0},t)),e.jsx(Ge,{})]})})})]})})]}),e.jsxs(He,{value:"strength",className:"space-y-4 mt-4",children:[e.jsx("div",{className:"rounded-2xl border border-border/70 bg-card/90 px-4 py-3 shadow-sm",children:e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-[11px] font-semibold uppercase tracking-[0.22em] text-muted-foreground",children:"Période active"}),e.jsxs("p",{className:"mt-1 text-sm font-semibold text-foreground",children:["Musculation sur ",bt]})]}),e.jsxs(de,{type:"button",variant:"outline",size:"sm",onClick:()=>te(!0),className:"gap-1.5 border-primary/20 text-primary hover:bg-primary/5",children:[e.jsx(ze,{className:"h-3.5 w-3.5"}),"Période"]})]})}),e.jsx(Ke,{open:Ze,onOpenChange:te,children:e.jsxs(Ie,{side:"bottom",className:"max-h-[70vh] overflow-y-auto rounded-t-3xl",children:[e.jsxs(Ee,{className:"text-left",children:[e.jsx(qe,{children:"Filtrer la progression musculation"}),e.jsx(Ve,{children:"Ajuste la période analysée pour le tonnage, le volume et le ressenti."})]}),e.jsx("div",{className:"grid grid-cols-2 gap-3 pt-5",children:X.map(t=>e.jsxs("button",{type:"button",onClick:()=>{ve(t.value),te(!1)},className:`rounded-2xl border px-4 py-4 text-left transition-colors ${p===t.value?"border-primary bg-primary/5 text-primary":"border-border hover:border-primary/30"}`,children:[e.jsx("div",{className:"text-sm font-semibold",children:t.label}),e.jsxs("div",{className:"mt-1 text-xs text-muted-foreground",children:["Analyse du travail sur ",t.label]})]},t.value))})]})}),e.jsx(Ye,{value:Math.round(ft).toLocaleString(),unit:"kg",label:`tonnage sur ${p} jours`,trend:vt,trendLabel:"vs période préc."}),e.jsxs("div",{className:"flex flex-wrap items-center justify-center gap-2",children:[e.jsx(M,{value:`${jt} séances`}),e.jsx(M,{value:`${Math.round(pt).toLocaleString()} reps`}),e.jsx(M,{value:`RPE ${Q!==null?Q.toFixed(1):"-"}/10`,colored:!0,colorValue:Q!==null?Q/2:null,invert:!0})]}),e.jsx(k.div,{variants:q,initial:"hidden",animate:"visible",children:e.jsx(Fe,{className:"border-0 shadow-none bg-transparent",children:e.jsx($e,{className:"p-0 h-[140px] w-full",children:Pe?e.jsx(xe,{}):Re.length===0?e.jsx("div",{className:"flex h-full items-center justify-center text-sm text-muted-foreground",children:"Aucune donnée disponible."}):e.jsx(T,{width:"100%",height:"100%",children:e.jsxs(Ht,{data:Re,children:[e.jsx(E,{dataKey:"label",fontSize:10,tickLine:!1,axisLine:!1}),e.jsx(L,{contentStyle:J}),e.jsx(ge,{dataKey:"tonnage",name:"Tonnage (kg)",fill:"hsl(var(--primary))",radius:[4,4,0,0],opacity:.7}),e.jsx(zt,{type:"monotone",dataKey:"volume",name:"Volume (reps)",stroke:"hsl(var(--accent))",strokeWidth:2,dot:!1})]})})})})}),e.jsxs(k.div,{variants:q,initial:"hidden",animate:"visible",children:[e.jsx("h3",{className:"text-xs font-semibold uppercase tracking-wider text-muted-foreground mb-3",children:"Ressenti par séance"}),e.jsx("div",{className:"h-[130px] w-full",children:Pe?e.jsx(xe,{}):Oe.length===0?e.jsx("div",{className:"flex h-full items-center justify-center text-sm text-muted-foreground",children:"Aucune donnée disponible."}):e.jsx(T,{width:"100%",height:"100%",children:e.jsxs(We,{data:Oe,children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"strengthFeelingGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"0%",stopColor:"hsl(var(--foreground))",stopOpacity:.15}),e.jsx("stop",{offset:"100%",stopColor:"hsl(var(--foreground))",stopOpacity:0})]})}),e.jsx(E,{dataKey:"date",fontSize:10,tickLine:!1,axisLine:!1}),e.jsx(ue,{domain:[0,10],hide:!0}),e.jsx(L,{contentStyle:J,formatter:t=>[t!==null?t.toFixed(1):"-","RPE"]}),e.jsx(Qe,{type:"monotone",dataKey:"feeling",stroke:"hsl(var(--foreground))",strokeWidth:2,fill:"url(#strengthFeelingGradient)",dot:{r:4,fill:"hsl(var(--background))",stroke:"hsl(var(--foreground))",strokeWidth:2},activeDot:{r:6}})]})})})]}),e.jsx(he,{title:"Détail par exercice",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"h-[220px] w-full",children:_e.length===0?e.jsx("div",{className:"flex h-full items-center justify-center text-sm text-muted-foreground",children:"Aucun exercice enregistré."}):e.jsx(T,{width:"100%",height:"100%",children:e.jsxs(Ue,{data:_e,layout:"vertical",children:[e.jsx(E,{type:"number",fontSize:10,tickLine:!1,axisLine:!1}),e.jsx(ue,{type:"category",dataKey:"name",fontSize:10,tickLine:!1,axisLine:!1,width:100}),e.jsx(L,{contentStyle:J,formatter:t=>[`${t.toLocaleString()} kg`,"Volume"]}),e.jsx(ge,{dataKey:"totalVolume",fill:"hsl(var(--primary))",radius:[0,4,4,0]})]})})}),e.jsx("div",{className:"w-full overflow-x-auto",children:e.jsxs(Pt,{children:[e.jsx(At,{children:e.jsxs(ce,{children:[e.jsx(U,{children:"Exercice"}),e.jsx(U,{className:"text-right",children:"Volume"}),e.jsx(U,{className:"text-right",children:"Max"}),e.jsx(U,{className:"text-right",children:"Dernier"})]})}),e.jsx(Tt,{children:le.length===0?e.jsx(ce,{children:e.jsx(I,{colSpan:4,className:"text-center text-sm text-muted-foreground",children:"Aucun exercice enregistré."})}):le.map(t=>e.jsxs(ce,{children:[e.jsx(I,{className:"font-medium text-sm",children:t.name}),e.jsxs(I,{className:"text-right font-mono text-sm",children:[t.totalVolume.toLocaleString()," kg"]}),e.jsx(I,{className:"text-right font-mono text-sm",children:t.maxWeight!==null?_t(t.maxWeight)?"PDC":`${t.maxWeight} kg`:"-"}),e.jsx(I,{className:"text-right text-xs text-muted-foreground",children:Nt(t.lastPerformedAt)})]},t.exerciseId))})]})})]})}),e.jsx(he,{title:"Historique récent",children:e.jsxs("div",{className:"space-y-3",children:[Se.length===0&&e.jsx("div",{className:"text-center text-sm text-muted-foreground py-6",children:"Aucun historique disponible."}),Se.map(t=>e.jsxs("div",{className:"flex items-center justify-between border-b border-border/40 pb-2 last:border-b-0 last:pb-0",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold",children:A(new Date(t.started_at||t.date||t.created_at||new Date),"dd/MM/yyyy")}),e.jsx("div",{className:"text-xs text-muted-foreground",children:t.status||"Séance"})]}),e.jsxs("div",{className:"text-sm font-mono font-semibold",children:[ht(oe(t)),"/10"]})]},t.id)),O.hasNextPage&&e.jsx(de,{variant:"outline",size:"sm",className:"w-full",onClick:()=>O.fetchNextPage(),disabled:O.isFetchingNextPage,children:O.isFetchingNextPage?"Chargement...":"Charger plus"})]})})]})]})]})}export{Y as ProgressBar,Ss as default};
