import{r,u as F,j as e,c as ye,d as V,f as bt}from"./vendor-query-DyA9aSKS.js";import{b as yt,B as K,P as he,w as Le,d as ve,L as U,I as ee,s as Be,X as vt,v as Nt,u as it,f as Ct,t as wt,$ as _t,a as St}from"./index-O16scsGl.js";import{a as p}from"./api-BqRQTNHo.js";import{T as kt,a as Tt,b as _e,c as Se}from"./tabs-DcxrwIod.js";import{B as Y}from"./badge-BWmgQcpX.js";import{C as ct,a as lt,b as ot}from"./collapsible-D9rtlTgu.js";import{C as Ke,w as dt,a as ut,M as $e,S as Ye,G as mt,b as Dt,c as Et}from"./weekTypeColor-DNo7s7Zj.js";import{T as Ve}from"./textarea-DPPOvlnw.js";import{S as pe,a as ge,b as je,c as fe,d as Z}from"./select-CIupFAp1.js";import{T as qt,a as Pe}from"./toggle-group-zId1MbDF.js";import{S as qe,a as Fe,b as Ae,c as Me,d as Xe}from"./sheet-BVjFRx5x.js";import{A as ie,a as ce,b as le,c as oe,d as de,e as ue,f as me,g as xe}from"./alert-dialog-3hjNm7W9.js";import{f as Ft,F as At,e as Mt,p as Ze}from"./objectiveHelpers-DC7i01Ud.js";import{a as Pt,O as We}from"./ObjectiveCard-BgKFoCf-.js";import{t as Re}from"./date-DrpgLmFD.js";import{C as Ot}from"./copy-Bgkd_ALU.js";import{T as Ie}from"./trash-2-CWLTF99L.js";import{C as Lt}from"./index-Cs8y90i4.js";import{P as Kt}from"./pencil-CGWmd8-S.js";import{S as $t,b as Wt,c as Rt}from"./smsUtils-BaILrNuO.js";import{C as zt}from"./chevron-up-Cx_lvk3V.js";import{C as Qt}from"./chevron-down-CtGdB8yM.js";import{C as ze}from"./clock-DG3BsbJz.js";import{C as xt}from"./chevron-right-Bz19ZUVk.js";import{T as Ut}from"./trophy-DNtLz_jw.js";import{M as Bt}from"./map-pin-s6SbXGX1.js";import{A as Vt}from"./arrow-left-CdEQiqf9.js";import"./vendor-react-BzrpNAyj.js";import"./vendor-charts-BrQ8X25f.js";import"./vendor-supabase-DFPLkPj_.js";import"./vendor-motion-lao-Njgm.js";import"./swim--0w5uie8.js";import"./index-CAuyrQPe.js";import"./index-CgT1NBnm.js";import"./chart-column-CSE4A6QD.js";import"./index-DCX2sNhR.js";import"./index-C2Zyn6WL.js";import"./vendor-date-B8Mnp-Vt.js";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const It=[["path",{d:"M9 17H7A5 5 0 0 1 7 7h2",key:"8i5ue5"}],["path",{d:"M15 7h2a5 5 0 1 1 0 10h-2",key:"1b9ql8"}],["line",{x1:"8",x2:"16",y1:"12",y2:"12",key:"1jonct"}]],Ht=yt("link-2",It);async function Gt(t){const{data:s,error:n}=await Be.rpc("get_auth_uid_for_user",{p_user_id:t});return n?(console.error("[objectives-tab] Failed to resolve auth UUID:",n.message),null):s}const Jt=({open:t,onOpenChange:s,objective:n,athleteName:a,athleteAuthId:o,competitions:x})=>{const{toast:c}=ve(),v=ye(),w=!!n,[m,h]=r.useState("chrono"),[y,N]=r.useState(""),[S,f]=r.useState("25"),[T,M]=r.useState(""),[E,q]=r.useState(""),[_,B]=r.useState(""),[R,I]=r.useState(!1);r.useEffect(()=>{if(t)if(n){const l=!!n.event_code,z=!!n.text;h(l&&z?"both":z?"texte":"chrono"),N(n.event_code??""),f(String(n.pool_length??25)),M(n.target_time_seconds!=null?Ft(n.target_time_seconds):""),q(n.text??""),B(n.competition_id??"")}else h("chrono"),N(""),f("25"),M(""),q(""),B("")},[t,n]);const u=V({mutationFn:l=>p.createObjective(l),onSuccess:()=>{c({title:"Objectif crÃ©Ã©"}),v.invalidateQueries({queryKey:["objectives",o]}),s(!1)},onError:l=>{c({title:"Erreur",description:l.message,variant:"destructive"})}}),g=V({mutationFn:l=>p.updateObjective(n.id,l),onSuccess:()=>{c({title:"Objectif mis Ã  jour"}),v.invalidateQueries({queryKey:["objectives",o]}),s(!1)},onError:l=>{c({title:"Erreur",description:l.message,variant:"destructive"})}}),b=V({mutationFn:()=>p.deleteObjective(n.id),onSuccess:()=>{c({title:"Objectif supprimÃ©"}),v.invalidateQueries({queryKey:["objectives",o]}),s(!1)},onError:l=>{c({title:"Erreur",description:l.message,variant:"destructive"})}}),O=m==="chrono"||m==="both",Q=m==="texte"||m==="both",A=()=>{if(O&&!y){c({title:"Ã‰preuve requise",description:"Veuillez sÃ©lectionner une Ã©preuve.",variant:"destructive"});return}if(O&&T&&Ze(T)===null){c({title:"Format invalide",description:"Le temps doit Ãªtre au format m:ss:cc (ex: 1:05:30)",variant:"destructive"});return}if(Q&&!E.trim()){c({title:"Texte requis",description:"Veuillez saisir un objectif texte.",variant:"destructive"});return}const l={athlete_id:o,competition_id:_&&_!=="none"?_:null,event_code:O?y:null,pool_length:O?Number(S):null,target_time_seconds:O&&T?Ze(T):null,text:Q?E.trim():null};w?g.mutate(l):u.mutate(l)},P=u.isPending||g.isPending||b.isPending,C=r.useMemo(()=>{const l=new Date;return l.setHours(0,0,0,0),x.filter(z=>new Date(z.date+"T00:00:00").getTime()>=l.getTime())},[x]);return e.jsxs(e.Fragment,{children:[e.jsx(qe,{open:t,onOpenChange:s,children:e.jsxs(Fe,{side:"right",className:"w-full sm:max-w-md overflow-y-auto",children:[e.jsx(Ae,{children:e.jsx(Me,{children:w?"Modifier l'objectif":"Nouvel objectif"})}),e.jsxs("div",{className:"mt-6 space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(U,{children:"Nageur"}),e.jsx("p",{className:"text-sm font-medium",children:a})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(U,{children:"Type d'objectif"}),e.jsxs(qt,{type:"single",variant:"outline",value:m,onValueChange:l=>{l&&h(l)},className:"justify-start",children:[e.jsx(Pe,{value:"chrono",className:"text-xs",children:"Chrono"}),e.jsx(Pe,{value:"texte",className:"text-xs",children:"Texte"}),e.jsx(Pe,{value:"both",className:"text-xs",children:"Les deux"})]})]}),O&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(U,{children:"Ã‰preuve *"}),e.jsxs(pe,{value:y,onValueChange:N,children:[e.jsx(ge,{children:e.jsx(je,{placeholder:"Choisir une Ã©preuve"})}),e.jsx(fe,{children:At.map(l=>e.jsx(Z,{value:l,children:Mt(l)},l))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(U,{children:"Bassin"}),e.jsxs(pe,{value:S,onValueChange:f,children:[e.jsx(ge,{children:e.jsx(je,{})}),e.jsxs(fe,{children:[e.jsx(Z,{value:"25",children:"25m"}),e.jsx(Z,{value:"50",children:"50m"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(U,{children:"Temps cible (min:sec:centiÃ¨mes)"}),e.jsx(ee,{placeholder:"Ex : 1:05:30",value:T,onChange:l=>M(l.target.value)})]})]}),Q&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(U,{children:"Objectif texte *"}),e.jsx(Ve,{placeholder:"Ex : AmÃ©liorer la coulÃ©e de dos",value:E,onChange:l=>q(l.target.value),rows:3})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(U,{children:"Lier Ã  une compÃ©tition"}),e.jsxs(pe,{value:_,onValueChange:B,children:[e.jsx(ge,{children:e.jsx(je,{placeholder:"Aucune"})}),e.jsxs(fe,{children:[e.jsx(Z,{value:"none",children:"Aucune"}),C.map(l=>e.jsxs(Z,{value:l.id,children:[l.name," (",l.date,")"]},l.id))]})]})]}),e.jsxs("div",{className:"space-y-2 pt-2",children:[e.jsx(K,{className:"w-full",onClick:A,disabled:P,children:P?"Enregistrement...":w?"Enregistrer":"CrÃ©er"}),w&&e.jsx(K,{variant:"outline",className:"w-full text-destructive hover:text-destructive",onClick:()=>I(!0),disabled:P,children:"Supprimer cet objectif"})]})]})]})}),e.jsx(ie,{open:R,onOpenChange:I,children:e.jsxs(ce,{children:[e.jsxs(le,{children:[e.jsx(oe,{children:"Supprimer l'objectif"}),e.jsx(de,{children:"Cette action est irrÃ©versible. L'objectif sera supprimÃ© dÃ©finitivement."})]}),e.jsxs(ue,{children:[e.jsx(me,{children:"Annuler"}),e.jsx(xe,{onClick:()=>{b.mutate(),I(!1)},className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Supprimer"})]})]})})]})},Yt=({athleteId:t,athleteName:s})=>{const[n,a]=r.useState(!1),[o,x]=r.useState(null),{data:c,isLoading:v}=F({queryKey:["auth-uid",t],queryFn:()=>Gt(t),enabled:!!t}),{data:w=[]}=F({queryKey:["competitions"],queryFn:()=>p.getCompetitions()}),{data:m=[],isLoading:h}=F({queryKey:["objectives",c],queryFn:()=>p.getObjectives(c),enabled:!!c}),{data:y}=F({queryKey:["profile",t],queryFn:()=>p.getProfile({userId:t}),enabled:!!t}),N=y?.ffn_iuf??null,S=r.useMemo(()=>{const _=new Date;return _.setDate(_.getDate()-360),_.toISOString().slice(0,10)},[]),{data:f=[]}=F({queryKey:["swimmer-performances-recent",N],queryFn:()=>p.getSwimmerPerformances({iuf:N,fromDate:S}),enabled:!!N}),T=()=>{x(null),a(!0)},M=_=>{x(_),a(!0)},E=v,q=!!c&&!v;return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex justify-end",children:e.jsxs(K,{variant:"outline",size:"sm",onClick:T,disabled:!c,children:[e.jsx(he,{className:"mr-1.5 h-3.5 w-3.5"}),"Ajouter un objectif"]})}),E&&e.jsx("div",{className:"space-y-2",children:[1,2,3].map(_=>e.jsx("div",{className:"rounded-xl border p-3 animate-pulse motion-reduce:animate-none",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-4 w-40 rounded bg-muted"}),e.jsx("div",{className:"ml-auto h-5 w-12 rounded bg-muted"})]})},_))}),q&&h&&e.jsx("div",{className:"space-y-2",children:[1,2].map(_=>e.jsx("div",{className:"rounded-xl border p-3 animate-pulse motion-reduce:animate-none",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-4 w-32 rounded bg-muted"}),e.jsx("div",{className:"ml-auto h-5 w-16 rounded bg-muted"})]})},_))}),q&&!h&&m.length===0&&e.jsxs("div",{className:"text-center py-12 space-y-3",children:[e.jsx(Le,{className:"h-10 w-10 text-muted-foreground mx-auto"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Aucun objectif dÃ©fini pour ",s,"."]}),e.jsxs(K,{variant:"outline",size:"sm",onClick:T,children:[e.jsx(he,{className:"mr-1.5 h-3.5 w-3.5"}),"CrÃ©er le premier objectif"]})]}),q&&!h&&m.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(Pt,{children:m.map(_=>e.jsx(We,{objective:_,performances:f,onClick:()=>M(_)},_.id))}),e.jsx("p",{className:"text-[10px] text-muted-foreground/60 italic text-center pt-1",children:"Les temps Â« Actuel Â» correspondent Ã  la meilleure performance des 360 derniers jours sur l'Ã©preuve."})]}),c&&e.jsx(Jt,{open:n,onOpenChange:a,objective:o,athleteName:s,athleteAuthId:c,competitions:w})]})},Qe="__today__";function Ue(t,s){const n=[],a=new Date(t+"T00:00:00"),o=new Date(s+"T00:00:00"),x=new Date(a),c=x.getDay(),v=c===0?1:c===1?0:8-c;for(x.setDate(x.getDate()+v);x<=o;)n.push(x.toISOString().split("T")[0]),x.setDate(x.getDate()+7);return n}function Ce(t){return new Date(t+"T00:00:00").toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric"})}function ke(t){return new Date(t+"T00:00:00").toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit"})}function Xt(t){const s=new Date(t+"T00:00:00");return s.setDate(s.getDate()+6),s.toISOString().split("T")[0]}function Zt(t){const s=new Date;s.setHours(0,0,0,0);const n=new Date(t+"T00:00:00"),a=new Date(t+"T00:00:00");return a.setDate(a.getDate()+6),s>=n&&s<=a}const es=({athleteId:t})=>{const{toast:s}=ve(),n=ye(),[a,o]=r.useState(null),[x,c]=r.useState(null),[v,w]=r.useState(""),[m,h]=r.useState(""),[y,N]=r.useState(!1),[S,f]=r.useState(!1),[T,M]=r.useState(!1),[E,q]=r.useState(""),[_,B]=r.useState(""),[R,I]=r.useState(""),{data:u=[]}=F({queryKey:["athletes"],queryFn:()=>p.getAthletes()}),g=r.useMemo(()=>u.find(W=>W.id===t)?.group_id??null,[u,t]),{data:b=[],isLoading:O}=F({queryKey:["training-cycles","athlete",t],queryFn:()=>p.getTrainingCycles({athleteId:t})}),{data:Q=[],isLoading:A}=F({queryKey:["training-cycles","group",g],queryFn:()=>p.getTrainingCycles({groupId:g}),enabled:g!=null}),P=b.length===0&&Q.length>0,C=b.length>0?b:Q;r.useEffect(()=>{C.length>0&&(!a||!C.find(i=>i.id===a))&&o(C[0].id)},[C,a]);const l=C.find(i=>i.id===a)??null,{data:z=[],isLoading:d}=F({queryKey:["training-weeks",a],queryFn:()=>p.getTrainingWeeks(a),enabled:!!a}),{data:j=[]}=F({queryKey:["competitions"],queryFn:()=>p.getCompetitions()}),D=r.useMemo(()=>[...j].sort((i,W)=>i.date.localeCompare(W.date)),[j]),L=r.useMemo(()=>{const i=new Set;return z.forEach(W=>{W.week_type&&i.add(W.week_type)}),Array.from(i).sort()},[z]),$=l?.start_competition_date??l?.start_date??null,k=r.useMemo(()=>{if(!l)return[];const i=$,W=l.end_competition_date;return!i||!W?[]:Ue(i,W)},[l,$]),te=r.useMemo(()=>{const i=new Map;return z.forEach(W=>i.set(W.week_start,W)),i},[z]),se=O||A,ne=V({mutationFn:async i=>{const W=await p.createTrainingCycle(i),H=i.start_date??j.find(J=>J.id===i.start_competition_id)?.date,G=j.find(J=>J.id===i.end_competition_id);if(H&&G){const J=Ue(H,G.date);J.length>0&&await p.bulkUpsertTrainingWeeks(J.map(Ne=>({cycle_id:W.id,week_start:Ne})))}return W},onSuccess:i=>{s({title:"Cycle cree"}),o(i.id),N(!1),q(""),B(""),I(""),n.invalidateQueries({queryKey:["training-cycles"]}),n.invalidateQueries({queryKey:["training-weeks",i.id]})},onError:i=>{s({title:"Erreur",description:i.message,variant:"destructive"})}}),ae=V({mutationFn:i=>p.deleteTrainingCycle(i),onSuccess:()=>{s({title:"Cycle supprime"}),o(null),f(!1),n.invalidateQueries({queryKey:["training-cycles"]})},onError:i=>{s({title:"Erreur",description:i.message,variant:"destructive"})}}),He=V({mutationFn:i=>p.upsertTrainingWeek(i),onSuccess:()=>{c(null),n.invalidateQueries({queryKey:["training-weeks",a]})},onError:i=>{s({title:"Erreur",description:i.message,variant:"destructive"})}}),Ge=V({mutationFn:async()=>{for(const i of Q){const W=await p.createTrainingCycle({athlete_id:t,group_id:null,start_competition_id:i.start_competition_id,end_competition_id:i.end_competition_id,name:i.name,notes:i.notes}),H=await p.getTrainingWeeks(i.id);H.length>0&&await p.bulkUpsertTrainingWeeks(H.map(G=>({cycle_id:W.id,week_start:G.week_start,week_type:G.week_type,notes:G.notes})))}},onSuccess:()=>{s({title:"Planification personnalisee"}),M(!1),o(null),n.invalidateQueries({queryKey:["training-cycles"]})},onError:i=>{s({title:"Erreur",description:i.message,variant:"destructive"})}}),Je=()=>{if(!E.trim()){s({title:"Nom requis",variant:"destructive"});return}if(!_||!R){s({title:"Dates requises",description:"Choisis un debut et une fin.",variant:"destructive"});return}const i=_===Qe,W=i?Re(new Date):null,H=i?null:j.find(Ne=>Ne.id===_),G=j.find(Ne=>Ne.id===R),J=i?W:H?.date;if(J&&G&&G.date<=J){s({title:"Dates invalides",description:"La fin doit etre apres le debut.",variant:"destructive"});return}ne.mutate({athlete_id:t,group_id:null,start_competition_id:i?null:_,end_competition_id:R,start_date:W,name:E.trim()})},pt=i=>{c(i.id),w(i.week_type??""),h(i.notes??"")},gt=i=>{c(`new:${i}`),w(""),h("")},jt=(i,W)=>{a&&He.mutate({cycle_id:a,week_start:i,week_type:v.trim()||null,notes:m.trim()||null})},ft=()=>{c(null)};return!se&&C.length===0?e.jsxs("div",{className:"text-center py-12 space-y-3",children:[e.jsx(Ke,{className:"h-10 w-10 text-muted-foreground mx-auto"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Aucun cycle pour ce nageur."}),e.jsxs(K,{variant:"outline",size:"sm",onClick:()=>N(!0),children:[e.jsx(he,{className:"mr-1.5 h-3.5 w-3.5"}),"Nouveau cycle"]}),e.jsx(et,{open:y,onOpenChange:N,competitions:D,name:E,setName:q,startId:_,setStartId:B,endId:R,setEndId:I,onSubmit:Je,isPending:ne.isPending})]}):se?e.jsx("div",{className:"space-y-3",children:[1,2,3].map(i=>e.jsx("div",{className:"rounded-xl border p-3 animate-pulse motion-reduce:animate-none",children:e.jsx("div",{className:"h-4 w-48 rounded bg-muted"})},i))}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[C.length>1?e.jsxs(pe,{value:a??"",onValueChange:o,children:[e.jsx(ge,{className:"w-auto min-w-[180px] h-8 text-sm",children:e.jsx(je,{placeholder:"Choisir un cycle"})}),e.jsx(fe,{children:C.map(i=>e.jsx(Z,{value:i.id,children:i.name},i.id))})]}):l?e.jsx("span",{className:"text-sm font-semibold",children:l.name}):null,P&&e.jsx(Y,{variant:"secondary",className:"text-[10px] px-1.5 py-0",children:"Planif. groupe"}),e.jsx("div",{className:"flex-1"}),P&&e.jsxs(K,{variant:"outline",size:"sm",className:"text-xs h-10",onClick:()=>M(!0),children:[e.jsx(Ot,{className:"mr-1 h-3 w-3"}),"Personnaliser"]}),e.jsxs(K,{variant:"outline",size:"sm",className:"text-xs h-10",onClick:()=>N(!0),children:[e.jsx(he,{className:"mr-1 h-3 w-3"}),"Nouveau"]}),l&&!P&&e.jsx(K,{variant:"ghost",size:"sm",className:"text-xs h-10 w-10 text-destructive hover:text-destructive",onClick:()=>f(!0),children:e.jsx(Ie,{className:"h-3 w-3"})})]}),l&&e.jsxs("div",{className:"space-y-0",children:[e.jsxs("div",{className:"flex items-center gap-2 py-2 px-1",children:[e.jsx("span",{className:"text-base","aria-hidden":"true",children:l.start_competition_id?"ðŸŠ":"ðŸ“…"}),e.jsx("span",{className:"text-sm font-medium",children:l.start_competition_id?l.start_competition_name??"Competition":"Debut du cycle"}),$&&e.jsxs("span",{className:"text-xs text-muted-foreground",children:["(",Ce($),")"]})]}),e.jsx("div",{className:"relative ml-3 border-l-2 border-border pl-4 space-y-1",children:d?e.jsx("div",{className:"py-4",children:e.jsx("div",{className:"h-4 w-32 rounded bg-muted animate-pulse motion-reduce:animate-none"})}):k.map((i,W)=>{const H=te.get(i),G=Zt(i),J=x===(H?.id??`new:${i}`);return e.jsx(ts,{monday:i,weekNumber:W+1,week:H,isCurrent:G,isEditing:J,isGroupPlan:P,editWeekType:v,setEditWeekType:w,editWeekNotes:m,setEditWeekNotes:h,existingWeekTypes:L,onStartEdit:()=>H?pt(H):gt(i),onSave:()=>jt(i),onCancel:ft,isSaving:He.isPending},i)})}),e.jsxs("div",{className:"flex items-center gap-2 py-2 px-1",children:[e.jsx("span",{className:"text-base","aria-hidden":"true",children:"ðŸŽ¯"}),e.jsx("span",{className:"text-sm font-medium",children:l.end_competition_name??"Competition"}),l.end_competition_date&&e.jsxs("span",{className:"text-xs text-muted-foreground",children:["(",Ce(l.end_competition_date),")"]})]})]}),e.jsx(et,{open:y,onOpenChange:N,competitions:D,name:E,setName:q,startId:_,setStartId:B,endId:R,setEndId:I,onSubmit:Je,isPending:ne.isPending}),e.jsx(ie,{open:S,onOpenChange:f,children:e.jsxs(ce,{children:[e.jsxs(le,{children:[e.jsx(oe,{children:"Supprimer le cycle"}),e.jsx(de,{children:"Le cycle et ses semaines seront supprimes."})]}),e.jsxs(ue,{children:[e.jsx(me,{children:"Annuler"}),e.jsx(xe,{onClick:()=>a&&ae.mutate(a),className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Supprimer"})]})]})}),e.jsx(ie,{open:T,onOpenChange:M,children:e.jsxs(ce,{children:[e.jsxs(le,{children:[e.jsx(oe,{children:"Personnaliser la planification"}),e.jsx(de,{children:"Copie le plan du groupe pour ce nageur. Tu pourras ensuite l'ajuster."})]}),e.jsxs(ue,{children:[e.jsx(me,{children:"Annuler"}),e.jsx(xe,{onClick:()=>Ge.mutate(),children:Ge.isPending?"Copie...":"Personnaliser"})]})]})})]})},ts=({monday:t,weekNumber:s,week:n,isCurrent:a,isEditing:o,isGroupPlan:x,editWeekType:c,setEditWeekType:v,editWeekNotes:w,setEditWeekNotes:m,existingWeekTypes:h,onStartEdit:y,onSave:N,onCancel:S,isSaving:f})=>{const T=Xt(t),M=`week-types-${t}`;return o?e.jsxs("div",{className:`rounded-lg border bg-card p-3 space-y-2 ${a?"ring-2 ring-primary":""}`,children:[e.jsxs("div",{className:"text-xs font-medium text-muted-foreground",children:["Sem. ",s," (",ke(t)," - ",ke(T),")"]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(U,{className:"text-xs",children:"Type de semaine"}),e.jsx(ee,{className:"h-7 text-sm",placeholder:"Ex : Foncier, Affutage",list:M,value:c,onChange:E=>v(E.target.value)}),e.jsx("datalist",{id:M,children:h.map(E=>e.jsx("option",{value:E},E))})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(U,{className:"text-xs",children:"Notes"}),e.jsx(Ve,{className:"text-sm min-h-[48px]",placeholder:"Note optionnelle",rows:2,value:w,onChange:E=>m(E.target.value)})]}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsxs(K,{variant:"ghost",size:"sm",className:"h-10 text-xs",onClick:S,children:[e.jsx(vt,{className:"mr-1 h-3 w-3"}),"Annuler"]}),e.jsxs(K,{size:"sm",className:"h-10 text-xs",onClick:N,disabled:f,children:[e.jsx(Lt,{className:"mr-1 h-3 w-3"}),f?"...":"Enregistrer"]})]})]}):e.jsxs("button",{type:"button",className:`w-full text-left rounded-lg border bg-card px-3 py-2 flex items-center gap-2 transition-colors ${x?"cursor-default":"hover:bg-muted/50"} ${a?"ring-2 ring-primary":""}`,onClick:x?void 0:y,disabled:x,children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs("span",{className:"text-xs font-medium text-muted-foreground whitespace-nowrap",children:["Sem. ",s]}),e.jsxs("span",{className:"text-[10px] text-muted-foreground/70 whitespace-nowrap",children:["(",ke(t)," - ",ke(T),")"]}),n?.week_type&&e.jsx(Y,{className:"text-[10px] px-1.5 py-0 border-0",style:{backgroundColor:ut(n.week_type),color:dt(n.week_type)},children:n.week_type})]}),n?.notes&&e.jsx("p",{className:"text-xs text-muted-foreground mt-0.5 line-clamp-1",children:n.notes})]}),!x&&e.jsx(Kt,{className:"h-3 w-3 text-muted-foreground/40 shrink-0"})]})},et=({open:t,onOpenChange:s,competitions:n,name:a,setName:o,startId:x,setStartId:c,endId:v,setEndId:w,onSubmit:m,isPending:h})=>(r.useEffect(()=>{t&&(o(""),c(""),w(""))},[t]),e.jsx(qe,{open:t,onOpenChange:s,children:e.jsxs(Fe,{side:"right",className:"w-full sm:max-w-md overflow-y-auto",children:[e.jsx(Ae,{children:e.jsx(Me,{children:"Nouveau cycle"})}),e.jsxs("div",{className:"mt-6 space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(U,{children:"Nom du cycle *"}),e.jsx(ee,{placeholder:"Ex : Preparation hiver",value:a,onChange:y=>o(y.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(U,{children:"Date de debut *"}),e.jsxs(pe,{value:x,onValueChange:c,children:[e.jsx(ge,{children:e.jsx(je,{placeholder:"Choisir..."})}),e.jsxs(fe,{children:[e.jsxs(Z,{value:Qe,children:["Aujourd'hui (",Ce(Re(new Date)),")"]}),n.map(y=>e.jsxs(Z,{value:y.id,children:[y.name," (",Ce(y.date),")"]},y.id))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(U,{children:"Competition de fin *"}),e.jsxs(pe,{value:v,onValueChange:w,children:[e.jsx(ge,{children:e.jsx(je,{placeholder:"Choisir..."})}),e.jsx(fe,{children:n.map(y=>e.jsxs(Z,{value:y.id,children:[y.name," (",Ce(y.date),")"]},y.id))})]})]}),x&&v&&(()=>{const N=x===Qe?Re(new Date):n.find(f=>f.id===x)?.date,S=n.find(f=>f.id===v);if(N&&S&&S.date>N){const f=Ue(N,S.date).length;return e.jsxs("p",{className:"text-xs text-muted-foreground",children:[f," semaine",f>1?"s":""," seront generees."]})}return null})(),e.jsx(K,{className:"w-full",onClick:m,disabled:h,children:h?"Creation...":"Creer le cycle"})]})]})}));function we(t){return new Date(t+"T12:00:00").toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric"})}function Te(t){return new Date(t+"T00:00:00").toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit"})}function ss(t){const s=new Date(t+"T00:00:00");return s.setDate(s.getDate()+6),s.toISOString().split("T")[0]}function ns(t){const s=new Date;s.setHours(0,0,0,0);const n=new Date(t+"T00:00:00"),a=new Date(t+"T00:00:00");return a.setDate(a.getDate()+6),s>=n&&s<=a}function Oe(t,s){const n=[],a=new Date(t+"T00:00:00"),o=new Date(s+"T00:00:00"),x=new Date(a),c=x.getDay(),v=c===0?1:c===1?0:8-c;for(x.setDate(x.getDate()+v);x<=o;)n.push(x.toISOString().split("T")[0]),x.setDate(x.getDate()+7);return n}function tt(t,s){const n=new Date(t+"T00:00:00"),a=new Date(s+"T00:00:00");return Math.round((a.getTime()-n.getTime())/(1e3*60*60*24))}const as={draft_athlete:{label:"En attente nageur",variant:"secondary",className:"bg-amber-100 text-amber-800 dark:bg-amber-900/40 dark:text-amber-300 border-amber-200 dark:border-amber-800"},draft_coach:{label:"PrÃ©paration coach",variant:"secondary",className:"bg-blue-100 text-blue-800 dark:bg-blue-900/40 dark:text-blue-300 border-blue-200 dark:border-blue-800"},sent:{label:"EnvoyÃ©",variant:"secondary",className:"bg-green-100 text-green-800 dark:bg-green-900/40 dark:text-green-300 border-green-200 dark:border-green-800"},signed:{label:"SignÃ©",variant:"secondary",className:"bg-slate-100 text-slate-600 dark:bg-slate-800/40 dark:text-slate-300 border-slate-200 dark:border-slate-700"}};function rs(t){const s=as[t];return e.jsx(Y,{variant:s.variant,className:`text-[10px] px-1.5 py-0 ${s.className}`,children:s.label})}async function is(t){const{data:s,error:n}=await Be.rpc("get_auth_uid_for_user",{p_user_id:t});return n?(console.error("[interviews-tab] Failed to resolve auth UUID:",n.message),null):s}const re=({label:t,text:s})=>e.jsxs("div",{className:"border-l-4 border-blue-400 rounded-r-lg bg-blue-50/50 dark:bg-blue-950/20 p-3 space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(Nt,{className:"h-3.5 w-3.5 text-blue-500"}),e.jsx("p",{className:"text-xs font-bold uppercase tracking-widest text-muted-foreground",children:t})]}),e.jsx("p",{className:"text-sm whitespace-pre-wrap",children:s?.trim()||e.jsx("span",{className:"italic text-muted-foreground",children:"Non renseignÃ©"})})]}),De=({label:t,text:s})=>e.jsxs("div",{className:"border-l-4 border-amber-400 rounded-r-lg bg-amber-50/50 dark:bg-amber-950/20 p-3 space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(mt,{className:"h-3.5 w-3.5 text-amber-500"}),e.jsx("p",{className:"text-xs font-bold uppercase tracking-widest text-muted-foreground",children:t})]}),e.jsx("p",{className:"text-sm whitespace-pre-wrap",children:s?.trim()||e.jsx("span",{className:"italic text-muted-foreground",children:"Non renseignÃ©"})})]}),Ee=({label:t,value:s,onChange:n,onBlur:a,placeholder:o,rows:x=3})=>e.jsxs("div",{className:"border-l-4 border-amber-400 rounded-r-lg bg-amber-50/50 dark:bg-amber-950/20 p-3 space-y-1.5",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(mt,{className:"h-3.5 w-3.5 text-amber-500"}),e.jsx("p",{className:"text-xs font-bold uppercase tracking-widest text-muted-foreground",children:t})]}),e.jsx(Ve,{className:"bg-white dark:bg-background",placeholder:o,value:s,onChange:c=>n(c.target.value),onBlur:a,rows:x})]}),X=({label:t})=>e.jsxs("div",{className:"flex items-center gap-2 pt-3",children:[e.jsx("div",{className:"h-px flex-1 bg-border"}),e.jsx("span",{className:"text-xs font-bold uppercase tracking-widest text-muted-foreground",children:t}),e.jsx("div",{className:"h-px flex-1 bg-border"})]}),st=({prevInterview:t,commitmentReview:s})=>{const[n,a]=r.useState(!1);return e.jsxs(ct,{open:n,onOpenChange:a,children:[e.jsx(lt,{asChild:!0,children:e.jsxs("button",{type:"button",className:"w-full flex items-center gap-2 rounded-xl border bg-muted/30 px-3 py-2.5 text-left transition-colors hover:bg-muted/50",children:[e.jsx(xt,{className:`h-3.5 w-3.5 text-muted-foreground shrink-0 transition-transform ${n?"rotate-90":""}`}),e.jsx("span",{className:"text-xs font-bold uppercase tracking-widest text-muted-foreground",children:"Rappel engagements prÃ©cÃ©dents"}),e.jsx(Y,{variant:"secondary",className:"text-[10px] px-1.5 py-0 ml-auto",children:we(t.date)})]})}),e.jsx(ot,{children:e.jsxs("div",{className:"rounded-b-xl border border-t-0 bg-muted/30 px-3 pb-3 space-y-2",children:[t.athlete_commitments&&e.jsxs("div",{className:"border-l-4 border-blue-400 rounded-r-lg bg-blue-50/50 dark:bg-blue-950/20 p-2",children:[e.jsx("p",{className:"text-[10px] font-semibold text-muted-foreground",children:"Engagements nageur"}),e.jsx("p",{className:"text-xs whitespace-pre-wrap",children:t.athlete_commitments})]}),t.coach_actions&&e.jsxs("div",{className:"border-l-4 border-amber-400 rounded-r-lg bg-amber-50/50 dark:bg-amber-950/20 p-2",children:[e.jsx("p",{className:"text-[10px] font-semibold text-muted-foreground",children:"Actions coach"}),e.jsx("p",{className:"text-xs whitespace-pre-wrap",children:t.coach_actions})]}),s&&e.jsxs("div",{className:"border-l-4 border-blue-400 rounded-r-lg bg-blue-50/80 dark:bg-blue-950/30 p-2",children:[e.jsx("p",{className:"text-[10px] font-semibold text-muted-foreground",children:"Bilan du nageur"}),e.jsx("p",{className:"text-xs whitespace-pre-wrap",children:s})]})]})})]})},nt=({athleteId:t,interviewDate:s})=>{const{toast:n}=ve(),a=ye(),{data:o=[]}=F({queryKey:["competitions"],queryFn:()=>p.getCompetitions()}),{data:x=[]}=F({queryKey:["my-competition-ids",t],queryFn:()=>p.getMyCompetitionIds(t)}),c=r.useMemo(()=>{const u=new Set(x);return o.filter(g=>u.has(g.id)).sort((g,b)=>g.date.localeCompare(b.date))},[o,x]),v=r.useMemo(()=>c.filter(u=>u.date>=s),[c,s]),{data:w=[]}=F({queryKey:["training-cycles","athlete",t],queryFn:()=>p.getTrainingCycles({athleteId:t})}),m=r.useMemo(()=>{const u=new Map;return w.slice().sort((g,b)=>(g.end_competition_date??"").localeCompare(b.end_competition_date??"")).forEach(g=>{g.end_competition_id&&!u.has(g.end_competition_id)&&u.set(g.end_competition_id,g)}),u},[w]),h=r.useMemo(()=>{const u=new Set;return v.map(g=>m.get(g.id)??null).filter(g=>!g||u.has(g.id)?!1:(u.add(g.id),!0))},[v,m]),y=bt({queries:h.map(u=>({queryKey:["training-weeks",u.id],queryFn:()=>p.getTrainingWeeks(u.id),enabled:!!u.id}))}),[N,S]=r.useState(null),[f,T]=r.useState(""),M=r.useMemo(()=>{const u=new Map;return h.forEach((g,b)=>{u.set(g.id,y[b]?.data??[])}),u},[h,y]),E=r.useMemo(()=>{const u=new Set;return M.forEach(g=>{g.forEach(b=>{b.week_type&&u.add(b.week_type)})}),Array.from(u).sort()},[M]),q=v[0]??null,_=r.useMemo(()=>new Date().toISOString().split("T")[0],[]),B=q?tt(_,q.date):null,R=V({mutationFn:async u=>{const g=c.find(C=>C.id===u);if(!g)throw new Error("Pas de compÃ©tition");const b=c.findIndex(C=>C.id===u),O=b>0?c[b-1]:null,Q=O?.date??s,A=await p.createTrainingCycle({athlete_id:t,group_id:null,start_competition_id:O?.id??null,start_date:O?null:s,end_competition_id:g.id,name:`PrÃ©paration ${g.name}`}),P=Oe(Q,g.date);return P.length>0&&await p.bulkUpsertTrainingWeeks(P.map(C=>({cycle_id:A.id,week_start:C}))),A},onSuccess:()=>{n({title:"Planification crÃ©Ã©e"}),a.invalidateQueries({queryKey:["training-cycles"]}),a.invalidateQueries({queryKey:["training-weeks"]})},onError:u=>{n({title:"Erreur",description:u.message,variant:"destructive"})}}),I=V({mutationFn:u=>p.upsertTrainingWeek(u),onSuccess:()=>{S(null),a.invalidateQueries({queryKey:["training-weeks"]})},onError:u=>{n({title:"Erreur",description:u.message,variant:"destructive"})}});return q?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"rounded-xl border bg-muted/20 p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm flex-wrap",children:[e.jsx(Ut,{className:"h-4 w-4 text-amber-500 shrink-0"}),e.jsxs("span",{className:"font-medium",children:[v.length," Ã©chÃ©ance",v.length>1?"s":""," Ã  planifier"]}),B!=null&&e.jsxs(Y,{variant:"secondary",className:"text-[10px]",children:["prochaine J-",B]})]}),e.jsx("p",{className:"mt-1 text-xs text-muted-foreground",children:"Une carte par compÃ©tition cible pour construire et piloter plusieurs macrocycles Ã  l'avance."})]}),e.jsx("div",{className:"space-y-3",children:v.map((u,g)=>{const b=m.get(u.id)??null,O=b?M.get(b.id)??[]:[],Q=new Map(O.map(j=>[j.week_start,j])),A=b?.start_date??b?.start_competition_date??s,P=A>s?A:s,C=b?Oe(P,u.date):[],l=b?Oe(A,u.date):[],z=Math.max(l.length-C.length,0),d=tt(_,u.date);return e.jsxs("div",{className:"rounded-xl border bg-card shadow-sm overflow-hidden",children:[e.jsxs("div",{className:"border-b border-border bg-muted/20 px-3 py-2.5",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"text-sm font-semibold",children:u.name}),g===0&&e.jsx(Y,{className:"text-[10px] bg-primary/10 text-primary border-primary/20",children:"PrioritÃ©"}),e.jsx(Y,{variant:"secondary",className:"text-[10px]",children:we(u.date)}),e.jsxs(Y,{variant:"outline",className:"text-[10px]",children:["J-",d]})]}),b?e.jsxs("div",{className:"mt-1 flex items-center gap-2 flex-wrap text-xs text-muted-foreground",children:[e.jsx("span",{className:"font-medium text-foreground",children:b.name}),b.start_competition_name&&e.jsxs("span",{children:["depuis ",b.start_competition_name]}),e.jsxs("span",{children:[l.length," sem."]}),z>0&&e.jsxs("span",{children:[z," dÃ©jÃ  passÃ©es"]})]}):e.jsx("p",{className:"mt-1 text-xs text-muted-foreground",children:"Aucun macrocycle crÃ©Ã© pour cette Ã©chÃ©ance."})]}),b?C.length===0?e.jsx("div",{className:"px-3 py-3 text-xs text-muted-foreground italic",children:"Aucune semaine future Ã  afficher sur ce macrocycle."}):e.jsx("div",{className:"px-3 py-3",children:e.jsx("div",{className:"relative ml-2 border-l-2 border-border pl-3 space-y-1.5",children:C.map((j,D)=>{const L=Q.get(j),$=ns(j),k=ss(j),te=`${b.id}:${j}`,se=N===te,ne=`inline-week-${b.id}-${j}`;return se?e.jsxs("div",{className:`rounded-lg border bg-card p-2 space-y-1.5 ${$?"ring-2 ring-primary":""}`,children:[e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Sem. ",z+D+1," (",Te(j)," - ",Te(k),")"]}),e.jsx(ee,{className:"h-7 text-sm",placeholder:"Foncier, Techni., AffÃ»tage...",list:ne,value:f,onChange:ae=>T(ae.target.value)}),e.jsx("datalist",{id:ne,children:E.map(ae=>e.jsx("option",{value:ae},ae))}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx(K,{variant:"ghost",size:"sm",className:"h-6 text-xs px-2",onClick:()=>S(null),children:"Annuler"}),e.jsx(K,{size:"sm",className:"h-6 text-xs px-2",onClick:()=>{I.mutate({cycle_id:b.id,week_start:j,week_type:f.trim()||null,notes:L?.notes??null})},disabled:I.isPending,children:"OK"})]})]},j):e.jsxs("button",{type:"button",className:`w-full text-left rounded-lg border bg-card px-2.5 py-2 text-xs transition-colors hover:bg-muted/50 ${$?"ring-2 ring-primary bg-primary/5":""}`,onClick:()=>{S(te),T(L?.week_type??"")},children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:`h-2 w-2 rounded-full shrink-0 ${$?"bg-primary":L?.week_type?"bg-muted-foreground/40":"bg-muted-foreground/20"}`}),e.jsxs("span",{className:"text-muted-foreground whitespace-nowrap",children:["Sem. ",z+D+1]}),e.jsxs("span",{className:"text-muted-foreground/70 whitespace-nowrap",children:[Te(j)," - ",Te(k)]}),L?.week_type&&e.jsx(Y,{className:"text-[10px] px-1.5 py-0 border-0 ml-auto",style:{backgroundColor:ut(L.week_type),color:dt(L.week_type)},children:L.week_type})]}),L?.notes&&e.jsx("p",{className:"mt-1 pl-4 text-[11px] text-muted-foreground line-clamp-2",children:L.notes})]},j)})})}):e.jsxs("div",{className:"px-3 py-3 space-y-2",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"CrÃ©ez un macrocycle dÃ©diÃ© pour donner de la visibilitÃ© long terme sur cette cible."}),e.jsx(K,{variant:"outline",size:"sm",className:"w-full text-xs",onClick:()=>R.mutate(u.id),disabled:R.isPending,children:R.isPending?"CrÃ©ation...":"CrÃ©er ce macrocycle"})]})]},u.id)})})]}):e.jsx("div",{className:"text-center py-4",children:e.jsx("p",{className:"text-xs text-muted-foreground italic",children:"Aucune compÃ©tition assignÃ©e Ã  venir â€” planification non disponible."})})},cs=({interview:t,athleteId:s,athleteName:n,athletePhone:a,objectives:o,performances:x})=>{const{toast:c}=ve(),v=ye(),[w,m]=r.useState(!1),[h,y]=r.useState(t.coach_comment_successes??""),[N,S]=r.useState(t.coach_comment_difficulties??""),[f,T]=r.useState(t.coach_comment_goals??""),M=t.coach_review??"",E=t.coach_objectives??"",[q,_]=r.useState(t.coach_actions??""),[B,R]=r.useState(!1),[I,u]=r.useState(!1),[g,b]=r.useState(!1),O=r.useRef(!1),{data:Q}=F({queryKey:["previous-interview",s,t.date,t.id],queryFn:()=>p.getPreviousInterview(s,t.date,t.id),enabled:!!t.date}),A=r.useCallback(()=>({coach_comment_successes:h.trim()||null,coach_comment_difficulties:N.trim()||null,coach_comment_goals:f.trim()||null,coach_review:M.trim()||null,coach_objectives:E.trim()||null,coach_actions:q.trim()||null}),[q,N,f,h,E,M]),P=r.useCallback(()=>{const k=A();return(t.coach_comment_successes??null)!==k.coach_comment_successes||(t.coach_comment_difficulties??null)!==k.coach_comment_difficulties||(t.coach_comment_goals??null)!==k.coach_comment_goals||(t.coach_review??null)!==k.coach_review||(t.coach_objectives??null)!==k.coach_objectives||(t.coach_actions??null)!==k.coach_actions},[A,t]),C=V({mutationFn:k=>p.updateInterviewCoachSections(t.id,k),onSuccess:()=>{v.invalidateQueries({queryKey:["interviews",s]})},onError:k=>{c({title:"Erreur",description:k.message,variant:"destructive"})}}),l=V({mutationFn:async()=>(await p.updateInterviewCoachSections(t.id,A()),p.sendInterviewToAthlete(t.id)),onSuccess:()=>{c({title:"Entretien envoyÃ© au nageur"}),v.invalidateQueries({queryKey:["interviews",s]}),b(!0)},onError:k=>{c({title:"Erreur",description:k.message,variant:"destructive"})}}),z=()=>{if(!a)return;const te=`Bonjour ${n.split(" ")[0]}, ton entretien est disponible. Consulte-le ici : https://erstein-aquatic-club.github.io/competition/#/profile`,se=Wt([a],te);Rt()?window.location.href=se:navigator.clipboard.writeText(`${a}
${te}`).then(()=>{c({title:"CopiÃ©",description:"NumÃ©ro et message copiÃ©s dans le presse-papiers."})}).catch(()=>{c({title:"Erreur",description:"Impossible de copier.",variant:"destructive"})}),b(!1)},d=V({mutationFn:()=>p.deleteInterview(t.id),onSuccess:()=>{c({title:"Entretien supprimÃ©"}),v.invalidateQueries({queryKey:["interviews",s]})},onError:k=>{c({title:"Erreur",description:k.message,variant:"destructive"})}}),j=C.isPending||l.isPending||d.isPending,D=t.status,L=D==="draft_athlete"?"border-amber-300 dark:border-amber-700 border-l-4":D==="draft_coach"?"border-blue-300 dark:border-blue-700 border-l-4":D==="sent"?"border-emerald-300 dark:border-emerald-700 border-l-4":"",$=r.useCallback(()=>{D!=="draft_coach"||O.current||j||!P()||(O.current=!0,C.mutate(A()),window.setTimeout(()=>{O.current=!1},500))},[A,P,j,C,D]);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:`rounded-xl border bg-card shadow-sm ${L}`,children:[e.jsxs("button",{type:"button",className:"w-full flex items-center justify-between p-4 text-left",onClick:()=>m(k=>!k),children:[e.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[e.jsx("span",{className:"text-sm font-semibold",children:we(t.date)}),rs(D),D==="signed"&&t.signed_at&&e.jsxs("span",{className:"text-xs text-muted-foreground",children:["le ",we(t.signed_at.slice(0,10))]})]}),w?e.jsx(zt,{className:"h-4 w-4 text-muted-foreground shrink-0"}):e.jsx(Qt,{className:"h-4 w-4 text-muted-foreground shrink-0"})]}),w&&e.jsxs("div",{className:"px-4 pb-4 space-y-5",children:[D==="draft_athlete"&&e.jsxs("div",{className:"rounded-xl border border-dashed border-amber-300 bg-amber-50/50 dark:bg-amber-950/20 p-6 text-center space-y-2",children:[e.jsx(ze,{className:"h-8 w-8 mx-auto text-amber-500"}),e.jsx("p",{className:"text-sm font-medium",children:"En attente de la prÃ©paration du nageur"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Le contenu n'est pas encore visible. Le nageur doit d'abord remplir ses sections."})]}),D==="draft_coach"&&e.jsxs(e.Fragment,{children:[Q&&e.jsx(st,{prevInterview:Q,commitmentReview:t.athlete_commitment_review}),e.jsx(X,{label:"RÃ©ussites"}),e.jsx(re,{label:"Nageur",text:t.athlete_successes}),e.jsx(Ee,{label:"Coach",value:h,onChange:y,onBlur:$,placeholder:"Votre commentaire sur les rÃ©ussites..."}),e.jsx(X,{label:"DifficultÃ©s"}),e.jsx(re,{label:"Nageur",text:t.athlete_difficulties}),e.jsx(Ee,{label:"Coach",value:N,onChange:S,onBlur:$,placeholder:"Votre commentaire sur les difficultÃ©s..."}),e.jsx(X,{label:"Objectifs"}),o.length>0&&e.jsx("div",{className:"space-y-1.5",children:o.map(k=>e.jsx(We,{objective:k,performances:x,compact:!0},k.id))}),e.jsx(re,{label:"Nageur",text:t.athlete_goals}),e.jsx(Ee,{label:"Coach",value:f,onChange:T,onBlur:$,placeholder:"Objectifs complÃ©mentaires, commentaires..."}),e.jsx(X,{label:"Planification"}),e.jsx(nt,{athleteId:s,interviewDate:t.date}),e.jsx(X,{label:"Engagements & Actions"}),e.jsxs("div",{className:"rounded-xl bg-card border shadow-sm p-4 space-y-3",children:[e.jsx(re,{label:"Engagements du nageur",text:t.athlete_commitments}),e.jsx(Ee,{label:"Actions du coach",value:q,onChange:_,onBlur:$,placeholder:"Actions concrÃ¨tes, points de suivi..."})]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:C.isPending?"Sauvegarde...":"Sauvegarde automatique a la sortie d'un champ."})]}),(D==="sent"||D==="signed")&&e.jsxs(e.Fragment,{children:[Q&&e.jsx(st,{prevInterview:Q,commitmentReview:t.athlete_commitment_review}),e.jsx(X,{label:"RÃ©ussites"}),e.jsx(re,{label:"Nageur",text:t.athlete_successes}),e.jsx(De,{label:"Coach",text:t.coach_comment_successes||t.coach_review}),e.jsx(X,{label:"DifficultÃ©s"}),e.jsx(re,{label:"Nageur",text:t.athlete_difficulties}),e.jsx(De,{label:"Coach",text:t.coach_comment_difficulties}),e.jsx(X,{label:"Objectifs"}),o.length>0&&e.jsx("div",{className:"space-y-1.5",children:o.map(k=>e.jsx(We,{objective:k,performances:x,compact:!0},k.id))}),e.jsx(re,{label:"Nageur",text:t.athlete_goals}),e.jsx(De,{label:"Coach",text:t.coach_comment_goals||t.coach_objectives}),e.jsx(X,{label:"Planification"}),e.jsx(nt,{athleteId:s,interviewDate:t.date}),e.jsx(X,{label:"Engagements & Actions"}),e.jsxs("div",{className:"rounded-xl bg-card border shadow-sm p-4 space-y-3",children:[e.jsx(re,{label:"Engagements du nageur",text:t.athlete_commitments}),e.jsx(De,{label:"Actions du coach",text:t.coach_actions})]})]}),e.jsxs("div",{className:"space-y-2 pt-2 border-t",children:[D==="draft_coach"&&e.jsxs(K,{className:"w-full",onClick:()=>u(!0),disabled:j,children:[e.jsx(Ye,{className:"mr-1.5 h-3.5 w-3.5"}),"Envoyer au nageur"]}),e.jsxs(K,{variant:"outline",className:"w-full text-destructive hover:text-destructive",onClick:()=>R(!0),disabled:j,children:[e.jsx(Ie,{className:"mr-1.5 h-3.5 w-3.5"}),"Supprimer"]})]})]})]}),e.jsx(ie,{open:B,onOpenChange:R,children:e.jsxs(ce,{children:[e.jsxs(le,{children:[e.jsx(oe,{children:"Supprimer l'entretien"}),e.jsxs(de,{children:["Cette action est irrÃ©versible. L'entretien du ",t.date?we(t.date):""," sera supprimÃ© dÃ©finitivement."]})]}),e.jsxs(ue,{children:[e.jsx(me,{children:"Annuler"}),e.jsx(xe,{onClick:()=>{d.mutate(),R(!1)},className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Supprimer"})]})]})}),e.jsx(ie,{open:I,onOpenChange:u,children:e.jsxs(ce,{children:[e.jsxs(le,{children:[e.jsx(oe,{children:"Envoyer au nageur"}),e.jsx(de,{children:"L'entretien sera envoyÃ© au nageur pour consultation. Les sections coach seront enregistrÃ©es automatiquement."})]}),e.jsxs(ue,{children:[e.jsx(me,{children:"Annuler"}),e.jsxs(xe,{onClick:()=>{l.mutate(),u(!1)},children:[e.jsx(Ye,{className:"mr-1.5 h-3.5 w-3.5"}),"Envoyer"]})]})]})}),e.jsx(ie,{open:g,onOpenChange:b,children:e.jsxs(ce,{children:[e.jsxs(le,{children:[e.jsx(oe,{children:"Entretien envoyÃ©"}),e.jsx(de,{children:a?e.jsxs(e.Fragment,{children:["L'entretien a bien Ã©tÃ© envoyÃ© Ã  ",e.jsx("strong",{children:n}),". Voulez-vous le notifier par SMS ?"]}):e.jsxs(e.Fragment,{children:["L'entretien a bien Ã©tÃ© envoyÃ© Ã  ",e.jsx("strong",{children:n}),". Aucun numÃ©ro de tÃ©lÃ©phone enregistrÃ© pour ce nageur."]})})]}),e.jsxs(ue,{children:[e.jsx(me,{children:"Plus tard"}),e.jsxs(xe,{onClick:z,disabled:!a,children:[e.jsx($t,{className:"mr-1.5 h-3.5 w-3.5"}),"Envoyer le SMS"]})]})]})})]})},ls=({athleteId:t,athleteName:s})=>{const{toast:n}=ve(),a=ye(),{data:o}=F({queryKey:["auth-uid",t],queryFn:()=>is(t),enabled:!!t}),{data:x=[]}=F({queryKey:["objectives",o],queryFn:()=>p.getObjectives(o),enabled:!!o}),{data:c}=F({queryKey:["athlete-profile",t],queryFn:()=>p.getProfile({userId:t}),enabled:!!t}),v=c?.ffn_iuf??null,w=c?.phone??null,m=r.useMemo(()=>{const f=new Date;return f.setDate(f.getDate()-360),f.toISOString().slice(0,10)},[]),{data:h=[]}=F({queryKey:["swimmer-performances-recent",v],queryFn:()=>p.getSwimmerPerformances({iuf:v,fromDate:m}),enabled:!!v}),{data:y=[],isLoading:N}=F({queryKey:["interviews",t],queryFn:()=>p.getInterviews(t),enabled:!!t}),S=V({mutationFn:()=>p.createInterview({athlete_id:t}),onSuccess:()=>{n({title:"Entretien crÃ©Ã©"}),a.invalidateQueries({queryKey:["interviews",t]})},onError:f=>{n({title:"Erreur",description:f.message,variant:"destructive"})}});return N?e.jsx("div",{className:"space-y-2",children:[1,2,3].map(f=>e.jsx("div",{className:"rounded-xl border p-3 animate-pulse motion-reduce:animate-none",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-4 w-24 rounded bg-muted"}),e.jsx("div",{className:"ml-auto h-5 w-20 rounded bg-muted"})]})},f))}):y.length===0?e.jsxs("div",{className:"text-center py-12 space-y-3",children:[e.jsx($e,{className:"h-10 w-10 text-muted-foreground mx-auto"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Aucun entretien pour ",s,"."]}),e.jsxs(K,{variant:"outline",size:"sm",onClick:()=>S.mutate(),disabled:S.isPending,children:[e.jsx(he,{className:"mr-1.5 h-3.5 w-3.5"}),S.isPending?"CrÃ©ation...":"Nouvel entretien"]})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"text-sm font-semibold",children:"Entretiens"}),e.jsx(Y,{variant:"secondary",className:"text-[10px] px-1.5 py-0",children:y.length})]}),e.jsxs(K,{variant:"outline",size:"sm",onClick:()=>S.mutate(),disabled:S.isPending,children:[e.jsx(he,{className:"mr-1.5 h-3.5 w-3.5"}),S.isPending?"CrÃ©ation...":"Nouvel entretien"]})]}),e.jsx("div",{className:"space-y-2",children:y.map(f=>e.jsx(cs,{interview:f,athleteId:t,athleteName:s,athletePhone:w,objectives:x,performances:h},f.id))})]})},ht=["Lundi","Mardi","Mercredi","Jeudi","Vendredi","Samedi","Dimanche"],os=["Lun","Mar","Mer","Jeu","Ven","Sam","Dim"];function be(t){const[s,n]=t.split(":").map(Number);return s*60+n}function ds(t,s){const n=be(s)-be(t),a=Math.floor(n/60),o=n%60;return a===0?`${o}min`:o===0?`${a}h`:`${a}h${String(o).padStart(2,"0")}`}function at(t){const s=t.toLowerCase();return s.includes("piscine")||s.includes("bassin")||!s.includes("salle")&&!s.includes("muscu")&&!s.includes("ppg")&&!s.includes("gym")}function us({athleteId:t,athleteName:s,groupId:n}){const{userId:a}=it(),{toast:o}=ve(),x=ye(),{data:c,isLoading:v}=F({queryKey:["swimmer-slots",t],queryFn:()=>p.getSwimmerSlots(t)}),{data:w}=F({queryKey:["swimmer-slots-exists",t],queryFn:()=>p.hasCustomSlots(t)}),{data:m=[]}=F({queryKey:["training-slots","group",n],queryFn:()=>p.getTrainingSlotsForGroup(n)}),h=w===!0,y=h?c??[]:[],N=()=>{x.invalidateQueries({queryKey:["swimmer-slots",t]}),x.invalidateQueries({queryKey:["swimmer-slots-exists",t]})},S=V({mutationFn:()=>p.initSwimmerSlots(t,n,a),onSuccess:()=>{N(),o({title:"Planning personnalisÃ© crÃ©Ã©"})},onError:d=>o({title:"Erreur",description:d.message,variant:"destructive"})}),f=V({mutationFn:()=>p.resetSwimmerSlots(t,n,a),onSuccess:()=>{N(),o({title:"Planning rÃ©initialisÃ©"})},onError:d=>o({title:"Erreur",description:d.message,variant:"destructive"})}),T=V({mutationFn:d=>p.deleteSwimmerSlot(d),onSuccess:()=>{N(),o({title:"CrÃ©neau supprimÃ©"})}}),M=V({mutationFn:d=>p.createSwimmerSlot(d,a),onSuccess:()=>{N(),o({title:"CrÃ©neau ajoutÃ©"})},onError:d=>o({title:"Erreur",description:d.message,variant:"destructive"})}),E=V({mutationFn:({slotId:d,input:j})=>p.updateSwimmerSlot(d,j),onSuccess:()=>{N(),o({title:"CrÃ©neau modifiÃ©"})},onError:d=>o({title:"Erreur",description:d.message,variant:"destructive"})}),[q,_]=r.useState(null),[B,R]=r.useState(!1),[I,u]=r.useState(!1),[g,b]=r.useState(null),[O,Q]=r.useState(()=>{const d=new Date().getDay();return d===0?7:d}),A=r.useMemo(()=>{const d=h?y:m,j=new Map;for(const D of d){const L=j.get(D.day_of_week)??[];L.push(D),j.set(D.day_of_week,L)}for(const D of j.values())D.sort((L,$)=>L.start_time.localeCompare($.start_time));return j},[h,y,m]),P=r.useMemo(()=>{let d=22,j=6;return A.forEach(D=>{for(const L of D){const $=Math.floor(be(L.start_time)/60),k=Math.ceil(be(L.end_time)/60);$<d&&(d=$),k>j&&(j=k)}}),d>=j?{start:6,end:22}:{start:Math.max(0,d),end:Math.min(24,j)}},[A]),C=(P.end-P.start)*60,l=(()=>{const d=new Date().getDay();return d===0?7:d})(),z=A.get(O)??[];return v?e.jsx("div",{className:"space-y-3",children:Array.from({length:5}).map((d,j)=>e.jsx(Ct,{className:"h-14 rounded-lg"},j))}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between gap-2",children:h?e.jsxs(e.Fragment,{children:[e.jsxs(K,{size:"sm",variant:"outline",onClick:()=>R(!0),children:[e.jsx(he,{className:"h-3.5 w-3.5 mr-1"}),"Ajouter"]}),e.jsxs(K,{size:"sm",variant:"ghost",onClick:()=>u(!0),children:[e.jsx(wt,{className:"h-3.5 w-3.5 mr-1"}),"RÃ©initialiser"]})]}):e.jsxs(K,{size:"sm",onClick:()=>S.mutate(),disabled:S.isPending,children:[e.jsx(he,{className:"h-3.5 w-3.5 mr-1"}),"Personnaliser le planning"]})}),!h&&m.length>0&&e.jsx("div",{className:"rounded-lg border border-blue-200 bg-blue-50 dark:border-blue-800 dark:bg-blue-950/30 px-3 py-2 text-sm text-blue-700 dark:text-blue-300",children:"HÃ©rite du planning du groupe. Cliquez sur Â« Personnaliser Â» pour ajuster."}),e.jsx("div",{className:"grid grid-cols-7 gap-0 rounded-xl border border-border bg-card overflow-hidden",children:[1,2,3,4,5,6,7].map(d=>{const j=d===l,D=d===O,L=A.get(d)??[];return e.jsxs("button",{type:"button",className:`flex flex-col items-center py-2 transition-colors relative ${D?"bg-primary/8":"hover:bg-muted/50 active:bg-muted"}`,onClick:()=>Q(d),children:[e.jsx("span",{className:`text-[10px] font-semibold uppercase tracking-wider ${j?"text-primary":"text-muted-foreground"}`,children:os[d-1]}),e.jsx("span",{className:`text-xs font-bold tabular-nums mt-0.5 h-7 w-7 flex items-center justify-center rounded-full ${j?"bg-primary text-primary-foreground":D?"text-foreground":"text-foreground/80"}`,children:L.length||"Â·"}),e.jsx("div",{className:"w-full px-1 mt-1.5 h-8 relative",children:L.map($=>{const k=be($.start_time)-P.start*60,te=be($.end_time)-P.start*60,se=Math.max(0,k/C*100),ne=Math.max(8,(te-k)/C*100),ae=at($.location);return e.jsx("div",{className:`absolute left-1 right-1 rounded-sm ${ae?"bg-blue-500/40":"bg-amber-400/50"}`,style:{top:`${se}%`,height:`${ne}%`,minHeight:"3px"}},$.id)})}),D&&e.jsx("div",{className:"absolute bottom-0 left-2 right-2 h-0.5 rounded-full bg-primary"})]},d)})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-sm font-semibold text-foreground px-0.5",children:ht[O-1]}),z.length===0?e.jsx("div",{className:"rounded-xl border border-dashed border-border/60 bg-muted/20 py-8 text-center",children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"Aucun crÃ©neau"})}):e.jsx("div",{className:"space-y-2",children:z.map(d=>{const j=at(d.location);return e.jsx("button",{type:"button",className:"w-full text-left rounded-xl border border-border bg-card transition-all active:scale-[0.98] hover:border-border/80",onClick:()=>h?_(d):void 0,children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:`w-1 rounded-l-xl flex-shrink-0 ${j?"bg-blue-500":"bg-amber-400"}`}),e.jsxs("div",{className:"flex-1 px-3 py-2.5 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-sm font-bold tabular-nums text-foreground",children:[d.start_time.slice(0,5)," â€“ ",d.end_time.slice(0,5)]}),e.jsx("span",{className:`text-xs tabular-nums px-1.5 py-0.5 rounded-md font-medium ${j?"bg-blue-500/10 text-blue-600 dark:text-blue-400":"bg-amber-400/10 text-amber-600 dark:text-amber-400"}`,children:ds(d.start_time,d.end_time)})]}),h&&d.source_assignment_id&&e.jsx(Ht,{className:"h-3.5 w-3.5 text-blue-500 flex-shrink-0"})]}),e.jsxs("div",{className:"flex items-center gap-1.5 mt-1",children:[e.jsx(Bt,{className:"h-3 w-3 text-muted-foreground flex-shrink-0"}),e.jsx("span",{className:"text-xs text-muted-foreground truncate",children:d.location})]})]})]})},d.id)})})]}),e.jsx(ie,{open:I,onOpenChange:u,children:e.jsxs(ce,{children:[e.jsxs(le,{children:[e.jsx(oe,{children:"RÃ©initialiser le planning ?"}),e.jsx(de,{children:"Tous les crÃ©neaux personnalisÃ©s seront supprimÃ©s et remplacÃ©s par ceux du groupe."})]}),e.jsxs(ue,{children:[e.jsx(me,{children:"Annuler"}),e.jsx(xe,{onClick:()=>{f.mutate(),u(!1)},children:"RÃ©initialiser"})]})]})}),e.jsx(ie,{open:!!g,onOpenChange:()=>b(null),children:e.jsxs(ce,{children:[e.jsxs(le,{children:[e.jsx(oe,{children:"Supprimer ce crÃ©neau ?"}),e.jsx(de,{children:"Le crÃ©neau sera retirÃ© du planning personnel."})]}),e.jsxs(ue,{children:[e.jsx(me,{children:"Annuler"}),e.jsx(xe,{onClick:()=>{g&&T.mutate(g),b(null)},className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Supprimer"})]})]})}),e.jsx(qe,{open:!!q,onOpenChange:d=>!d&&_(null),children:e.jsxs(Fe,{side:"bottom",className:"max-h-[80vh]",children:[e.jsxs(Ae,{children:[e.jsx(Me,{children:"Modifier le crÃ©neau"}),e.jsx(Xe,{children:"Ajustez les horaires ou le lieu"})]}),q&&e.jsx(ms,{slot:q,onSave:d=>{E.mutate({slotId:q.id,input:d}),_(null)},onDelete:()=>{b(q.id),_(null)},isPending:E.isPending})]})}),e.jsx(qe,{open:B,onOpenChange:R,children:e.jsxs(Fe,{side:"bottom",className:"max-h-[80vh]",children:[e.jsxs(Ae,{children:[e.jsx(Me,{children:"Ajouter un crÃ©neau"}),e.jsx(Xe,{children:"Nouveau crÃ©neau personnalisÃ©"})]}),e.jsx(xs,{onSave:d=>{M.mutate({...d,user_id:t}),R(!1)},isPending:M.isPending})]})})]})}function ms({slot:t,onSave:s,onDelete:n,isPending:a}){const[o,x]=r.useState(t.start_time.slice(0,5)),[c,v]=r.useState(t.end_time.slice(0,5)),[w,m]=r.useState(t.location);return e.jsxs("div",{className:"space-y-4 pt-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(U,{children:"DÃ©but"}),e.jsx(ee,{type:"time",value:o,onChange:h=>x(h.target.value)})]}),e.jsxs("div",{children:[e.jsx(U,{children:"Fin"}),e.jsx(ee,{type:"time",value:c,onChange:h=>v(h.target.value)})]})]}),e.jsxs("div",{children:[e.jsx(U,{children:"Lieu"}),e.jsx(ee,{value:w,onChange:h=>m(h.target.value)})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(K,{className:"flex-1",onClick:()=>s({start_time:o,end_time:c,location:w}),disabled:a,children:"Enregistrer"}),e.jsx(K,{variant:"destructive",size:"icon",onClick:n,children:e.jsx(Ie,{className:"h-4 w-4"})})]})]})}function xs({onSave:t,isPending:s}){const[n,a]=r.useState("1"),[o,x]=r.useState("08:00"),[c,v]=r.useState("10:00"),[w,m]=r.useState("");return e.jsxs("div",{className:"space-y-4 pt-4",children:[e.jsxs("div",{children:[e.jsx(U,{children:"Jour"}),e.jsxs(pe,{value:n,onValueChange:a,children:[e.jsx(ge,{children:e.jsx(je,{})}),e.jsx(fe,{children:ht.map((h,y)=>e.jsx(Z,{value:String(y+1),children:h},y+1))})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(U,{children:"DÃ©but"}),e.jsx(ee,{type:"time",value:o,onChange:h=>x(h.target.value)})]}),e.jsxs("div",{children:[e.jsx(U,{children:"Fin"}),e.jsx(ee,{type:"time",value:c,onChange:h=>v(h.target.value)})]})]}),e.jsxs("div",{children:[e.jsx(U,{children:"Lieu"}),e.jsx(ee,{value:w,onChange:h=>m(h.target.value),placeholder:"Piscine, Salle..."})]}),e.jsx(K,{className:"w-full",onClick:()=>t({day_of_week:Number(n),start_time:o,end_time:c,location:w}),disabled:s||!w,children:"Ajouter"})]})}function rt(t){const s=Math.floor((Date.now()-new Date(t).getTime())/864e5);return s===0?"aujourd'hui":s===1?"hier":s<0?`dans ${-s}j`:`il y a ${s}j`}async function hs(t){const{data:s,error:n}=await Be.rpc("get_auth_uid_for_user",{p_user_id:t});return n?null:s}function Zs({athleteId:t,athleteName:s,onBack:n}={}){const[,a]=_t("/coach/swimmer/:id"),[,o]=St(),{selectedAthleteId:x,selectedAthleteName:c}=it(),[v,w]=r.useState("resume"),m=t??(a?.id?Number(a.id):x),h=s??c,{data:y}=F({queryKey:["profile",m],queryFn:()=>p.getProfile({userId:m}),enabled:m!=null}),N=300*1e3,{data:S}=F({queryKey:["sessions",m],queryFn:()=>p.getSessions(h??"",m),enabled:!!m,staleTime:N}),{data:f}=F({queryKey:["interviews",m],queryFn:()=>p.getInterviews(m),enabled:!!m,staleTime:N}),{data:T}=F({queryKey:["training-cycles",m],queryFn:()=>p.getTrainingCycles({athleteId:m}),enabled:!!m,staleTime:N}),{data:M}=F({queryKey:["auth-uid",m],queryFn:()=>hs(m),enabled:!!m,staleTime:N}),{data:E}=F({queryKey:["objectives",M],queryFn:()=>p.getObjectives(M),enabled:!!M,staleTime:N}),q=S?.[0]?.date??null,_=r.useMemo(()=>{if(!S||S.length===0)return null;const P=S.slice(0,7).map(C=>C.engagement).filter(C=>C!=null&&Number.isFinite(C));return P.length===0?null:P.reduce((C,l)=>C+l,0)/P.length},[S]),B=f?.length??0,R=f?.[0]?.date??null,I=r.useMemo(()=>{if(!T||T.length===0)return null;const A=new Date().toISOString().slice(0,10);return T.find(C=>{const l=C.start_date??C.start_competition_date??"",z=C.end_competition_date??"";return l<=A&&z>=A})?.name??T[0]?.name??null},[T]),u=E?.length??0,g=y?.display_name??h??"Nageur",b=y?.avatar_url??null,O=y?.group_label??null,Q=n??(()=>o("/coach?section=swimmers"));return m?e.jsxs("div",{className:"mx-auto max-w-3xl px-4 py-4 space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{type:"button",onClick:Q,className:"h-9 w-9 rounded-xl border border-border bg-card flex items-center justify-center hover:bg-muted transition","aria-label":"Retour",children:e.jsx(Vt,{className:"h-4 w-4"})}),b?e.jsx("img",{src:b,alt:"",className:"h-10 w-10 rounded-full object-cover border border-border"}):e.jsx("div",{className:"h-10 w-10 rounded-full bg-primary/10 flex items-center justify-center text-sm font-bold text-primary",children:g.charAt(0).toUpperCase()}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h1",{className:"text-lg font-bold truncate",children:g}),O&&e.jsx(Y,{variant:"secondary",className:"text-[10px] px-1.5 py-0",children:O})]})]}),e.jsxs(kt,{value:v,onValueChange:A=>w(A),children:[e.jsxs(Tt,{className:"grid h-auto w-full grid-cols-2 gap-2 bg-transparent p-0",children:[e.jsx(_e,{value:"resume",className:"rounded-xl border bg-card px-3 py-2 text-xs data-[state=active]:border-primary data-[state=active]:bg-primary/5",children:"RÃ©sumÃ©"}),e.jsx(_e,{value:"suivi",className:"rounded-xl border bg-card px-3 py-2 text-xs data-[state=active]:border-primary data-[state=active]:bg-primary/5",children:"Suivi"}),e.jsx(_e,{value:"echanges",className:"rounded-xl border bg-card px-3 py-2 text-xs data-[state=active]:border-primary data-[state=active]:bg-primary/5",children:"Ã‰changes"}),e.jsx(_e,{value:"planif",className:"rounded-xl border bg-card px-3 py-2 text-xs data-[state=active]:border-primary data-[state=active]:bg-primary/5",children:"Planif"})]}),e.jsx(Se,{value:"resume",className:"mt-4 space-y-3",children:e.jsxs("div",{className:"rounded-2xl border bg-card p-4",children:[e.jsx("p",{className:"text-sm font-semibold",children:"Vue rapide"}),e.jsxs("p",{className:"mt-1 text-sm text-muted-foreground",children:["AccÃ¨s direct au suivi, aux entretiens et Ã  la planification de ",g,"."]}),e.jsxs("div",{className:"mt-3 grid grid-cols-2 gap-2",children:[e.jsxs("button",{type:"button",onClick:()=>w("suivi"),className:"rounded-xl border px-3 py-3 text-left active:bg-muted",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ze,{className:"h-4 w-4 text-blue-500"}),e.jsx("span",{className:"text-sm font-medium",children:"Suivi"})]}),e.jsx("p",{className:"mt-1.5 text-xs text-muted-foreground truncate",children:S===void 0?"...":q?`Dernier : ${rt(q)}`:"Aucun ressenti"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:S===void 0?"":_!=null?`Engagement moy. : ${_.toFixed(1)}/5`:"â€”"})]}),e.jsxs("button",{type:"button",onClick:()=>w("echanges"),className:"rounded-xl border px-3 py-3 text-left active:bg-muted",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($e,{className:"h-4 w-4 text-violet-500"}),e.jsx("span",{className:"text-sm font-medium",children:"Ã‰changes"})]}),e.jsx("p",{className:"mt-1.5 text-xs text-muted-foreground truncate",children:f===void 0?"...":B>0?`${B} entretien${B>1?"s":""}`:"Aucun entretien"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:f===void 0?"":R?`Dernier : ${rt(R)}`:"â€”"})]}),e.jsxs("button",{type:"button",onClick:()=>w("planif"),className:"rounded-xl border px-3 py-3 text-left active:bg-muted",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ke,{className:"h-4 w-4 text-emerald-500"}),e.jsx("span",{className:"text-sm font-medium",children:"Planif"})]}),e.jsx("p",{className:"mt-1.5 text-xs text-muted-foreground truncate",children:T===void 0?"...":I||"Aucun cycle"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:T===void 0?"":T.length>0?`${T.length} cycle${T.length>1?"s":""}`:"â€”"})]}),e.jsxs("button",{type:"button",onClick:()=>w("suivi"),className:"rounded-xl border px-3 py-3 text-left active:bg-muted",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Le,{className:"h-4 w-4 text-amber-500"}),e.jsx("span",{className:"text-sm font-medium",children:"Objectifs"})]}),e.jsx("p",{className:"mt-1.5 text-xs text-muted-foreground truncate",children:E===void 0?"...":u>0?`${u} objectif${u>1?"s":""}`:"Aucun objectif"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:E===void 0?"":"â€”"})]})]})]})}),e.jsxs(Se,{value:"suivi",className:"mt-4 space-y-4",children:[e.jsxs("section",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Le,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("h2",{className:"text-sm font-semibold",children:"Objectifs"})]}),e.jsx(Yt,{athleteId:m,athleteName:g})]}),e.jsxs("section",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ze,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("h2",{className:"text-sm font-semibold",children:"Ressentis"})]}),e.jsx(Dt,{athleteId:m,athleteName:g,showProgressAction:!1})]})]}),e.jsxs(Se,{value:"echanges",className:"mt-4 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($e,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("h2",{className:"text-sm font-semibold",children:"Entretiens"})]}),e.jsx(ls,{athleteId:m,athleteName:g})]}),e.jsxs(Se,{value:"planif",className:"mt-4 space-y-4",children:[e.jsxs(ct,{defaultOpen:!0,children:[e.jsx(lt,{asChild:!0,children:e.jsxs("button",{type:"button",className:"w-full flex items-center gap-2 group",children:[e.jsx(Et,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("h2",{className:"text-sm font-semibold",children:"CrÃ©neaux"}),e.jsx(xt,{className:"ml-auto h-4 w-4 text-muted-foreground transition-transform group-data-[state=open]:rotate-90"})]})}),e.jsx(ot,{className:"mt-2",children:e.jsx(us,{athleteId:m,athleteName:g,groupId:y?.group_id??0})})]}),e.jsxs("section",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ke,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("h2",{className:"text-sm font-semibold",children:"Cycle"})]}),e.jsx(es,{athleteId:m})]})]})]})]}):e.jsxs("div",{className:"p-4 text-center text-muted-foreground",children:[e.jsx("p",{children:"Aucun nageur sÃ©lectionnÃ©."}),e.jsx("button",{type:"button",onClick:Q,className:"mt-2 text-primary underline",children:"Retour au dashboard"})]})}export{Zs as default};
