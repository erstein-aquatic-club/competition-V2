import{r as c,u as y,j as e}from"./vendor-query-DyA9aSKS.js";import{a as v}from"./api-DkdW7Bwu.js";import{B as k}from"./badge-D7Go0W_F.js";import{C as _}from"./Coach-CHsUoLEw.js";import"./vendor-react-BzrpNAyj.js";import"./index-CKZ3W3VD.js";import"./vendor-charts-BrQ8X25f.js";import"./vendor-supabase-DFPLkPj_.js";import"./vendor-motion-CMsaQ8FX.js";import"./swim-7gNOY-DV.js";import"./toggle-group-DeeT96Gc.js";import"./index-C6LAdOsV.js";import"./index-r-SCp2VC.js";import"./target-AYZZV_Pz.js";import"./bell-ring-JoeUjDic.js";import"./clock-BKW4knzI.js";function w(n){if(n.length===0)return null;const d=n[0],x=d.effort,p=d.fatigue,a=d.performance,m=d.engagement,o=[];return x!=null&&o.push((11-x)/2),p!=null&&o.push((11-p)/2),a!=null&&o.push(a/2),m!=null&&o.push(m/2),o.length===0?null:Math.round(o.reduce((f,g)=>f+g,0)/o.length*10)/10}function C(n){return n==null?{label:"—",className:"bg-muted text-muted-foreground"}:n>=3.5?{label:`${n.toFixed(1)}`,className:"bg-emerald-100 text-emerald-800 dark:bg-emerald-900/30 dark:text-emerald-400"}:n>=2.5?{label:`${n.toFixed(1)}`,className:"bg-amber-100 text-amber-800 dark:bg-amber-900/30 dark:text-amber-400"}:{label:`${n.toFixed(1)}`,className:"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400"}}function H({athletes:n,athletesLoading:d,onBack:x,onOpenAthlete:p}){const[a,m]=c.useState(null),[o,f]=c.useState("name"),{data:g=[]}=y({queryKey:["recent-sessions-all",30],queryFn:()=>v.getRecentSessionsAllAthletes(30),enabled:n.length>0,staleTime:300*1e3}),{data:b}=y({queryKey:["objectives-counts-by-user"],queryFn:()=>v.getObjectivesCountsByUser(),enabled:n.length>0,staleTime:300*1e3}),h=c.useMemo(()=>{const t=new Map;return n.forEach(s=>{s.group_id&&s.group_label&&t.set(s.group_id,s.group_label)}),Array.from(t.entries()).map(([s,r])=>({id:s,name:r})).sort((s,r)=>s.name.localeCompare(r.name,"fr"))},[n]),i=c.useMemo(()=>{const t=new Map,s=new Map;for(const r of g){if(r.athlete_id==null)continue;const l=s.get(r.athlete_id)??[];l.push(r),s.set(r.athlete_id,l)}for(const r of n){if(r.id==null)continue;const l=s.get(r.id)??[],u=w(l),N=l.length>0?l[0].session_date:null;t.set(r.id,{forme:u,lastSessionDate:N,sessionsCount30d:l.length,assiduity:null,objectivesTotal:b?.get(r.id)??0,objectivesAchieved:0})}return t},[n,g,b]),j=c.useMemo(()=>{let t=[...n];switch(a!=null&&(t=t.filter(s=>s.group_id===a)),o){case"forme":t.sort((s,r)=>{const l=s.id!=null?i.get(s.id)?.forme??99:99,u=r.id!=null?i.get(r.id)?.forme??99:99;return l-u});break;case"assiduity":t.sort((s,r)=>{const l=s.id!=null?i.get(s.id)?.sessionsCount30d??99:99,u=r.id!=null?i.get(r.id)?.sessionsCount30d??99:99;return l-u});break;default:t.sort((s,r)=>s.display_name.localeCompare(r.display_name,"fr"))}return t},[n,a,o,i]);return e.jsxs("div",{className:"space-y-4",children:[e.jsx(_,{title:"Nageurs",description:d?"Chargement…":`${n.length} nageur${n.length!==1?"s":""}`,onBack:x}),h.length>1&&e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{type:"button",onClick:()=>m(null),className:`rounded-full px-3 py-1 text-xs font-medium border transition ${a==null?"bg-foreground text-background border-foreground":"bg-card text-foreground border-border hover:bg-muted"}`,children:"Tous"}),h.map(t=>e.jsx("button",{type:"button",onClick:()=>m(a===t.id?null:t.id),className:`rounded-full px-3 py-1 text-xs font-medium border transition ${a===t.id?"bg-foreground text-background border-foreground":"bg-card text-foreground border-border hover:bg-muted"}`,children:t.name},t.id))]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"Trier :"}),[{key:"name",label:"Nom"},{key:"forme",label:"Forme"},{key:"assiduity",label:"Activité"}].map(t=>e.jsx("button",{type:"button",onClick:()=>f(t.key),className:`rounded-full px-2.5 py-0.5 text-xs font-medium border transition ${o===t.key?"bg-primary/10 text-primary border-primary/30":"bg-card text-muted-foreground border-border hover:bg-muted"}`,children:t.label},t.key))]}),d?e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3",children:[1,2,3,4,5,6].map(t=>e.jsxs("div",{className:"rounded-2xl border bg-card p-4 animate-pulse motion-reduce:animate-none",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-muted"}),e.jsxs("div",{className:"space-y-1.5 flex-1",children:[e.jsx("div",{className:"h-4 w-24 rounded bg-muted"}),e.jsx("div",{className:"h-3 w-16 rounded bg-muted"})]})]}),e.jsxs("div",{className:"mt-3 space-y-2",children:[e.jsx("div",{className:"h-3 w-full rounded bg-muted"}),e.jsx("div",{className:"h-3 w-2/3 rounded bg-muted"})]})]},t))}):j.length===0?e.jsx("p",{className:"text-sm text-muted-foreground text-center py-8",children:a!=null?"Aucun nageur dans ce groupe.":"Aucun nageur disponible."}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3",children:j.map(t=>{const s=t.id!=null?i.get(t.id):null,r=C(s?.forme??null);return e.jsxs("button",{type:"button",onClick:()=>p(t),className:"rounded-2xl border bg-card p-4 text-left hover:shadow-md hover:border-primary/20 transition-all",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[t.avatar_url?e.jsx("img",{src:t.avatar_url,alt:"",className:"h-10 w-10 rounded-full object-cover border border-border"}):e.jsx("div",{className:"h-10 w-10 rounded-full bg-primary/10 flex items-center justify-center text-sm font-bold text-primary",children:t.display_name.charAt(0).toUpperCase()}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-sm font-semibold truncate",children:t.display_name}),t.group_label&&e.jsx(k,{variant:"secondary",className:"text-[10px] px-1.5 py-0 mt-0.5",children:t.group_label})]})]}),e.jsxs("div",{className:"mt-3 grid grid-cols-3 gap-2",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-[10px] font-medium text-muted-foreground mb-1",children:"Forme"}),e.jsx("span",{className:`inline-block rounded-full px-2 py-0.5 text-xs font-semibold ${r.className}`,children:r.label})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-[10px] font-medium text-muted-foreground mb-1",children:"30j"}),e.jsx("span",{className:"text-sm font-bold text-foreground",children:s?.sessionsCount30d??0}),e.jsx("span",{className:"text-[10px] text-muted-foreground ml-0.5",children:"séances"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-[10px] font-medium text-muted-foreground mb-1",children:"Objectifs"}),e.jsx("span",{className:"text-sm font-bold text-foreground",children:s?.objectivesTotal??0})]})]}),s?.lastSessionDate&&e.jsxs("div",{className:"mt-2 text-[10px] text-muted-foreground",children:["Dernier ressenti : ",new Date(s.lastSessionDate).toLocaleDateString("fr-FR",{day:"numeric",month:"short"})]})]},t.id??t.display_name)})})]})}export{H as default};
