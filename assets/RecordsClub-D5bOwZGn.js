const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/export-records-pdf-Bc87oR8z.js","assets/index-BnsSVa73.js","assets/vendor-query-DyA9aSKS.js","assets/vendor-react-BzrpNAyj.js","assets/vendor-charts-BrQ8X25f.js","assets/vendor-supabase-DFPLkPj_.js","assets/vendor-motion-lao-Njgm.js","assets/index-DZj4lOyq.css"])))=>i.map(i=>d[i]);
import{_ as G,B,y as z,c as f}from"./index-BnsSVa73.js";import{r as u,u as P,j as e}from"./vendor-query-DyA9aSKS.js";import{a as C}from"./api-qDVaGRDA.js";import{S as J,a as Q,b as X,c as W,d as Z}from"./select-KxnQ8SVy.js";import{P as ee}from"./PageHeader-D6LjMho-.js";import{T as S}from"./trophy-Cvqfm5OP.js";import{C as te}from"./circle-alert-D8okCd3n.js";import{C as $}from"./chevron-up-CYNX1Mme.js";import{C as se}from"./chevron-down-BD0bKDKk.js";import{C as ae}from"./chevron-right-DsKr1luY.js";import"./vendor-react-BzrpNAyj.js";import"./vendor-charts-BrQ8X25f.js";import"./vendor-supabase-DFPLkPj_.js";import"./vendor-motion-lao-Njgm.js";import"./swim-PRbalu5T.js";import"./index-CzIfaFpG.js";import"./index-BK6XozKS.js";import"./index-DCX2sNhR.js";import"./check-eeOlFj6f.js";import"./chevron-left-WCowTkaR.js";const ne=[{key:"25",label:"25m"},{key:"50",label:"50m"}],le=[{key:"M",label:"G"},{key:"F",label:"F"}],re=[{key:"ALL",label:"Tous les âges"},{key:"8",label:"≤ 8 ans"},{key:"9",label:"9 ans"},{key:"10",label:"10 ans"},{key:"11",label:"11 ans"},{key:"12",label:"12 ans"},{key:"13",label:"13 ans"},{key:"14",label:"14 ans"},{key:"15",label:"15 ans"},{key:"16",label:"16 ans"},{key:"17",label:"≥ 17 ans"}],ie=[{key:"FREE",label:"Nage Libre",events:[{id:"50_FREE",label:"50 NL"},{id:"100_FREE",label:"100 NL"},{id:"200_FREE",label:"200 NL"},{id:"400_FREE",label:"400 NL"},{id:"800_FREE",label:"800 NL"},{id:"1500_FREE",label:"1500 NL"}]},{key:"BACK",label:"Dos",events:[{id:"50_BACK",label:"50 Dos"},{id:"100_BACK",label:"100 Dos"},{id:"200_BACK",label:"200 Dos"}]},{key:"BREAST",label:"Brasse",events:[{id:"50_BREAST",label:"50 Br"},{id:"100_BREAST",label:"100 Br"},{id:"200_BREAST",label:"200 Br"}]},{key:"FLY",label:"Papillon",events:[{id:"50_FLY",label:"50 Pap"},{id:"100_FLY",label:"100 Pap"},{id:"200_FLY",label:"200 Pap"}]},{key:"IM",label:"4 Nages",events:[{id:"100_IM",label:"100 4N"},{id:"200_IM",label:"200 4N"},{id:"400_IM",label:"400 4N"}]}],R=t=>{if(!t&&t!==0)return"-";const n=Math.round(t/10),i=n%100,o=Math.floor(n/100),m=o%60,l=Math.floor(o/60),d=x=>String(x).padStart(2,"0");return l>0?`${l}:${d(m)}.${d(i)}`:`${m}.${d(i)}`},b=t=>{if(!t)return"";const n=new Date(t);return Number.isNaN(n.getTime())?"":String(n.getFullYear())},oe=t=>{if(!t)return null;const n=new Date(t);return Number.isNaN(n.getTime())?null:n.toLocaleDateString("fr-FR")+" à "+n.toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"})},j=t=>t===8?"≤8":t===17?"≥17":String(t);function M({options:t,value:n,onChange:i}){return e.jsx("div",{className:"inline-flex rounded-lg border bg-muted p-0.5",children:t.map(o=>e.jsx("button",{type:"button",onClick:()=>i(o.key),className:f("rounded-md px-3 py-1.5 text-sm font-medium transition-colors",n===o.key?"bg-background text-foreground shadow-sm":"text-muted-foreground hover:text-foreground"),children:o.label},o.key))})}function Pe(){const[t,n]=u.useState("50"),[i,o]=u.useState("M"),[m,l]=u.useState("17"),[d,x]=u.useState(null),[a,c]=u.useState(null),[p,_]=u.useState(!1),N=m==="ALL"?null:Number(m),k=u.useCallback(s=>{n(s),x(null),c(null)},[]),I=u.useCallback(s=>{o(s),x(null),c(null)},[]),K=u.useCallback(s=>{l(s),x(null),c(null)},[]),{data:A}=P({queryKey:["last-import"],queryFn:()=>C.getImportLogs({limit:1})}),{data:L=[],isLoading:F,error:y,refetch:D}=P({queryKey:["club-records",t,i,m],queryFn:()=>C.getClubRecords({pool_m:Number(t),sex:i,age:N})}),w=u.useMemo(()=>d?N!==null?`${d}__${t}__${i}__${m}`:a:null,[d,N,a,t,i,m]),{data:O,isFetching:q}=P({queryKey:["club-ranking",w],queryFn:()=>{if(!w)return[];const s=w.split("__");return C.getClubRanking({event_code:s[0],pool_m:Number(s[1]),sex:s[2],age:Number(s[3])})},enabled:!!w}),v=u.useMemo(()=>{const s=new Map;for(const r of L){const g=s.get(r.event_code)??[];g.push(r),s.set(r.event_code,g)}for(const r of s.values())r.sort((g,h)=>g.age-h.age);return s},[L]),Y=u.useMemo(()=>{const s=new Map;for(const[r,g]of v){let h=g[0];for(const E of g)E.time_ms<h.time_ms&&(h=E);s.set(r,h)}return s},[v]),H=u.useCallback(s=>{x(r=>(c(null),r===s?null:s))},[]),V=u.useCallback(s=>{const r=`${s.event_code}__${t}__${i}__${s.age}`;c(g=>g===r?null:r)},[t,i]),U=u.useCallback(async()=>{_(!0);try{const s=await C.getClubRecords({}),{exportRecordsPdf:r}=await G(async()=>{const{exportRecordsPdf:g}=await import("./export-records-pdf-Bc87oR8z.js").then(h=>h.e);return{exportRecordsPdf:g}},__vite__mapDeps([0,1,2,3,4,5,6,7]));await r(s)}catch{}finally{_(!1)}},[]),T=u.useMemo(()=>ie.map(s=>({...s,activeEvents:s.events.filter(r=>v.has(r.id))})).filter(s=>s.activeEvents.length>0),[v]);return e.jsxs("div",{className:"space-y-3",children:[e.jsx(ee,{title:"Records du club",subtitle:A?.[0]?.status==="success"?`MAJ : ${oe(A[0].completed_at??A[0].started_at)??"-"}`:void 0,icon:e.jsx(S,{className:"h-3.5 w-3.5"}),backHref:"/hall-of-fame",backLabel:"Retour aux classements",action:e.jsxs(B,{variant:"outline",size:"sm",onClick:U,disabled:p,className:"border-primary/20 text-primary hover:bg-primary/5",children:[e.jsx(z,{className:"h-4 w-4 mr-1"}),p?"...":"PDF"]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(M,{options:ne,value:t,onChange:k}),e.jsx(M,{options:le,value:i,onChange:I}),e.jsx("div",{className:"ml-auto w-36",children:e.jsxs(J,{value:m,onValueChange:K,children:[e.jsx(Q,{className:"h-8 text-xs",children:e.jsx(X,{})}),e.jsx(W,{children:re.map(s=>e.jsx(Z,{value:s.key,children:s.label},s.key))})]})})]}),F&&e.jsx("div",{className:"space-y-2 pt-2",children:[1,2,3,4,5].map(s=>e.jsx("div",{className:"h-14 w-full rounded-xl bg-muted animate-pulse motion-reduce:animate-none"},s))}),y&&e.jsxs("div",{className:"flex flex-col items-center justify-center p-8 text-center",children:[e.jsx(te,{className:"h-12 w-12 text-destructive mb-4"}),e.jsx("h3",{className:"font-semibold",children:"Impossible de charger les données"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:y instanceof Error?y.message:"Une erreur s'est produite"}),e.jsx(B,{onClick:()=>D(),className:"mt-4",children:"Réessayer"})]}),!F&&!y&&L.length===0&&e.jsx("p",{className:"py-8 text-center text-sm text-muted-foreground",children:"Aucun record pour ces filtres."}),!F&&!y&&T.length>0&&e.jsx("div",{className:"space-y-5 pb-4",children:T.map(s=>e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"h-4 w-1 rounded-full bg-primary"}),e.jsx("h2",{className:"text-xs font-display font-bold uppercase tracking-wider text-muted-foreground",children:s.label}),e.jsx("div",{className:"flex-1 h-px bg-border"})]}),e.jsx("div",{className:"space-y-1.5",children:s.activeEvents.map(r=>{const g=Y.get(r.id),h=v.get(r.id)??[],E=d===r.id;return e.jsx(me,{eventLabel:r.label,bestRecord:g,ageRecords:h,isExpanded:E,isAllAges:N===null,onToggle:()=>H(r.id),onAgeRowTap:V,expandedAgeKey:a,rankingData:O,rankingLoading:q,pool:t,sex:i},r.id)})})]},s.key))})]})}function me({eventLabel:t,bestRecord:n,ageRecords:i,isExpanded:o,isAllAges:m,onToggle:l,onAgeRowTap:d,expandedAgeKey:x,rankingData:a,rankingLoading:c,pool:p,sex:_}){return e.jsxs("div",{className:f("rounded-xl border overflow-hidden transition-colors",o?"border-primary/25 shadow-sm":"border-border"),children:[e.jsx("button",{type:"button",onClick:l,className:"w-full text-left px-3.5 py-3 hover:bg-muted/50 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx("span",{className:"text-sm font-semibold text-foreground",children:t}),e.jsxs("div",{className:"flex items-center gap-2.5",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("span",{className:"font-mono text-primary font-bold tabular-nums text-[15px] leading-none",children:R(n.time_ms)}),e.jsxs("div",{className:"flex items-center justify-end gap-1 mt-0.5",children:[e.jsx("span",{className:"text-[11px] text-muted-foreground truncate max-w-[120px]",children:n.athlete_name}),m&&e.jsxs("span",{className:"text-[10px] text-muted-foreground/60",children:[j(n.original_age??n.age),"a"]}),b(n.record_date)&&e.jsxs("span",{className:"text-[10px] text-muted-foreground/60",children:["(",b(n.record_date),")"]})]})]}),o?e.jsx($,{className:"h-4 w-4 text-muted-foreground shrink-0"}):e.jsx(se,{className:"h-4 w-4 text-muted-foreground shrink-0"})]})]})}),o&&e.jsx("div",{className:"border-t border-border",children:m?e.jsx(de,{records:i,bestTime:n.time_ms,onAgeRowTap:d,expandedAgeKey:x,rankingData:a,rankingLoading:c,pool:p,sex:_}):e.jsx(ue,{record:n,eventLabel:t,rankingData:a,rankingLoading:c})})]})}function de({records:t,bestTime:n,onAgeRowTap:i,expandedAgeKey:o,rankingData:m,rankingLoading:l,pool:d,sex:x}){return e.jsx("div",{className:"divide-y divide-border/50",children:t.map(a=>{const c=a.time_ms===n,p=`${a.event_code}__${d}__${x}__${a.age}`,_=o===p,N=a.original_age!=null&&a.original_age!==a.age,k=a.original_age?j(a.original_age):null;return e.jsxs("div",{children:[e.jsxs("button",{type:"button",onClick:()=>i(a),className:f("w-full text-left px-3.5 py-2 flex items-center gap-2.5 hover:bg-muted/40 transition-colors",c&&"bg-primary/[0.03]"),children:[e.jsxs("span",{className:f("text-[11px] font-semibold w-7 text-center shrink-0 tabular-nums",c?"text-primary":"text-muted-foreground"),children:[j(a.age),"a"]}),e.jsx("span",{className:f("font-mono tabular-nums text-sm shrink-0",c?"text-primary font-bold":"text-foreground font-medium"),children:R(a.time_ms)}),e.jsxs("span",{className:"text-xs text-muted-foreground flex-1 truncate",children:[a.athlete_name,N&&k&&e.jsxs("span",{className:"ml-1 opacity-70",children:["(",k,"a)"]})]}),b(a.record_date)&&e.jsx("span",{className:"text-[10px] text-muted-foreground shrink-0",children:b(a.record_date)}),c&&e.jsx(S,{className:"h-3 w-3 text-rank-gold shrink-0"}),_?e.jsx($,{className:"h-3 w-3 text-muted-foreground shrink-0"}):e.jsx(ae,{className:"h-3 w-3 text-muted-foreground shrink-0"})]}),_&&e.jsx(ce,{record:a,rankingData:m,rankingLoading:l})]},a.age)})})}function ce({record:t,rankingData:n,rankingLoading:i}){const o=t.original_age!=null&&t.original_age!==t.age,m=u.useMemo(()=>{const l=n??[];return o?[{id:-1,athlete_name:t.athlete_name,swimmer_iuf:t.swimmer_iuf??null,sex:t.sex,pool_m:t.pool_m,event_code:t.event_code,event_label:t.event_label,age:t.original_age??t.age,actual_age:t.original_age??t.age,time_ms:t.time_ms,record_date:t.record_date},...l]:l},[n,t,o]);return e.jsxs("div",{className:"bg-muted/30 px-3.5 py-2 ml-7 border-l-2 border-primary/20",children:[e.jsxs("p",{className:"text-[10px] font-semibold uppercase tracking-wider text-muted-foreground mb-1.5",children:["Classement (",j(t.age)," ans)"]}),i?e.jsx("div",{className:"space-y-1.5",children:[1,2,3].map(l=>e.jsx("div",{className:"h-4 w-full rounded bg-muted animate-pulse motion-reduce:animate-none"},l))}):m.length===0?e.jsx("p",{className:"text-xs text-muted-foreground",children:"Aucune donnée."}):e.jsx("div",{className:"space-y-0.5",children:m.map((l,d)=>{const x=d===0&&o&&l.id===-1;return e.jsxs("div",{className:f("flex items-center gap-2 text-xs py-0.5",d===0&&"font-semibold text-primary"),children:[e.jsx("span",{className:"w-4 text-center shrink-0 text-[10px]",children:d===0?e.jsx(S,{className:"inline h-3 w-3 text-rank-gold"}):d+1}),e.jsx("span",{className:"font-mono tabular-nums w-14 shrink-0 text-[11px]",children:R(l.time_ms)}),e.jsxs("span",{className:"flex-1 truncate text-[11px]",children:[l.athlete_name,x&&e.jsx("span",{className:"ml-1 text-[9px] font-normal text-muted-foreground",children:"(record)"})]}),b(l.record_date)&&e.jsx("span",{className:"text-[10px] text-muted-foreground shrink-0",children:b(l.record_date)})]},l.id===-1?"record-holder":l.id)})})]})}function ue({record:t,eventLabel:n,rankingData:i,rankingLoading:o}){const m=t.original_age!=null&&t.original_age!==t.age,l=t.original_age?j(t.original_age):null,d=j(t.age),x=u.useMemo(()=>{const a=i??[];return m?[{id:-1,athlete_name:t.athlete_name,swimmer_iuf:t.swimmer_iuf??null,sex:t.sex,pool_m:t.pool_m,event_code:t.event_code,event_label:t.event_label,age:t.original_age??t.age,actual_age:t.original_age??t.age,time_ms:t.time_ms,record_date:t.record_date},...a]:a},[i,t,m]);return e.jsxs("div",{className:"bg-muted/20 px-3.5 py-2.5",children:[e.jsxs("p",{className:"text-[10px] font-semibold uppercase tracking-wider text-muted-foreground mb-2",children:["Classement — ",n," (",d," ans)"]}),o?e.jsx("div",{className:"space-y-1.5",children:[1,2,3].map(a=>e.jsx("div",{className:"h-5 w-full rounded bg-muted animate-pulse motion-reduce:animate-none"},a))}):x.length===0?e.jsx("p",{className:"text-xs text-muted-foreground",children:"Aucune donnée de classement."}):e.jsx("div",{className:"space-y-0.5",children:x.map((a,c)=>{const p=c===0&&m&&a.id===-1;return e.jsxs("div",{className:f("flex items-center gap-2 text-xs py-1 rounded-md px-1",c===0&&"font-semibold text-primary",p&&"bg-primary/5"),children:[e.jsx("span",{className:"w-5 text-center shrink-0",children:c===0?e.jsx(S,{className:"inline h-3 w-3 text-rank-gold"}):c+1}),e.jsx("span",{className:"font-mono tabular-nums w-16 shrink-0",children:R(a.time_ms)}),e.jsxs("span",{className:"flex-1 truncate",children:[a.athlete_name,p&&l&&e.jsxs("span",{className:"ml-1 text-[10px] font-normal text-muted-foreground",children:["(record ",l,"a)"]})]}),e.jsxs("span",{className:"text-muted-foreground shrink-0",children:[a.actual_age??a.age,"a"]}),b(a.record_date)&&e.jsx("span",{className:"text-[10px] text-muted-foreground shrink-0",children:b(a.record_date)})]},a.id===-1?"record-holder":a.id)})})]})}export{Pe as default};
