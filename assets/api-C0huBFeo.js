import{s as i,u as de}from"./index-DWyToiXM.js";import{b as v,c as L,n as $,d as N,e as D,f as k,h as c,l as h,S as m,j as q,k as I,m as ue,o as V,p as Y,q as J,v as le,i as j,r as K,t as _e,u as Q,w as B,a as me,g as ge,x as fe,y as pe,z as we,A as he,C as ye}from"./swim-_ed_mrF4.js";const W=e=>({id:N(e.id),numero_exercice:v(e.numero_exercice??e.numero),nom_exercice:e.nom_exercice??e.name??"",description:e.description??null,illustration_gif:e.illustration_gif??null,exercise_type:$(e.exercise_type??e.type??(e.is_warmup?"warmup":"strength")),warmup_reps:v(e.warmup_reps),warmup_duration:v(e.warmup_duration),Nb_series_endurance:v(e.Nb_series_endurance),Nb_reps_endurance:v(e.Nb_reps_endurance),pct_1rm_endurance:L(e.pct_1rm_endurance),recup_endurance:v(e.recup_endurance),recup_exercices_endurance:v(e.recup_exercices_endurance),Nb_series_hypertrophie:v(e.Nb_series_hypertrophie),Nb_reps_hypertrophie:v(e.Nb_reps_hypertrophie),pct_1rm_hypertrophie:L(e.pct_1rm_hypertrophie),recup_hypertrophie:v(e.recup_hypertrophie),recup_exercices_hypertrophie:v(e.recup_exercices_hypertrophie),Nb_series_force:v(e.Nb_series_force),Nb_reps_force:v(e.Nb_reps_force),pct_1rm_force:L(e.pct_1rm_force),recup_force:v(e.recup_force),recup_exercices_force:v(e.recup_exercices_force)}),Se=e=>{const t={athlete_name:e.athlete_name,session_date:e.date,time_slot:e.slot,distance:e.distance,duration:e.duration,rpe:k(e.effort),performance:k(e.performance??e.feeling),engagement:k(e.engagement??e.feeling),fatigue:k(e.feeling),comments:e.comments};return e.athlete_id!==null&&e.athlete_id!==void 0&&String(e.athlete_id)!==""&&(t.athlete_id=e.athlete_id),e.stroke_distances&&(t.stroke_distances=e.stroke_distances),t},Ee=e=>{if(!e)return null;const t=String(e.athlete_name||"").trim(),r=String(e.session_date||e.date||"").trim();if(!t||!r)return null;const s=D(v(e.rpe??e.effort)),n=D(v(e.performance??e.feeling)),a=D(v(e.engagement??e.feeling)),o=D(v(e.fatigue??e.feeling)),d=s??3,u=D(v(e.performance??e.engagement??e.fatigue??e.feeling))??3;return{id:N(e.id,Date.now()),athlete_id:e.athlete_id?N(e.athlete_id):void 0,athlete_name:t,date:r,slot:String(e.time_slot||e.slot||""),effort:d,feeling:u,rpe:s,performance:n,engagement:a,fatigue:o,distance:N(e.distance,0),duration:N(e.duration,0),comments:e.comments||"",stroke_distances:e.stroke_distances??null,created_at:e.created_at||e.updated_at||new Date().toISOString()}};async function be(e){if(!c())return null;let t=i.from("user_profiles").select("*");e.userId?t=t.eq("user_id",e.userId):e.displayName&&(t=t.eq("display_name",e.displayName));const{data:r,error:s}=await t.maybeSingle();if(s)throw new Error(s.message);return r?{id:r.user_id??null,display_name:r.display_name??null,email:r.email??null,birthdate:r.birthdate??null,group_id:v(r.group_id)??null,group_label:r.group_label??null,objectives:r.objectives??null,bio:r.bio??null,avatar_url:r.avatar_url??null,ffn_iuf:r.ffn_iuf??null,phone:r.phone??null,neurotype_result:r.neurotype_result??null}:null}async function ve(e){if(!c())return{status:"skipped"};const t=e.userId;if(!t)return{status:"skipped"};const r=e.profile.ffn_iuf?.trim()||null;if(r){const{data:n,error:a}=await i.from("club_record_swimmers").select("id").eq("iuf",r).eq("source_type","manual");if(a)throw new Error(a.message);if(n&&n.length>0){const o=n.map(u=>u.id),{error:d}=await i.from("club_record_swimmers").delete().in("id",o);if(d)throw new Error(d.message)}}const{error:s}=await i.from("user_profiles").upsert({user_id:t,...e.profile},{onConflict:"user_id"});if(s)throw new Error(s.message);if(e.profile.display_name){const{error:n}=await i.from("users").update({display_name:e.profile.display_name}).eq("id",t);if(n)throw new Error(n.message)}return{status:"updated"}}async function Ie(){if(!c()){const u=new Map,l=(w,b)=>{const T=String(w??"").trim();if(!T)return;const x=b!=null?v(b):null,C=x!==null?`id:${x}`:`name:${T.toLowerCase()}`;u.has(C)||u.set(C,{id:x,display_name:T})};return(h(m.SESSIONS)??[]).forEach(w=>l(w.athlete_name,w.athlete_id)),(h(m.STRENGTH_RUNS)??[]).forEach(w=>l(w.athlete_name,w.athlete_id)),(h(m.ASSIGNMENTS)??[]).forEach(w=>l(w.target_athlete,w.target_user_id)),Array.from(u.values()).sort((w,b)=>w.display_name.localeCompare(b.display_name,"fr"))}const{data:e,error:t}=await i.from("groups").select("id, name");if(t)throw new Error(t.message);const{data:r}=await i.from("user_profiles").select("user_id, ffn_iuf, avatar_url"),s=new Map((r??[]).map(u=>[u.user_id,u]));if(!e?.length){const{data:u,error:l}=await i.from("users").select("id, display_name, email").eq("role","athlete").eq("is_active",!0);if(l)throw new Error(l.message);return(u??[]).map(_=>({id:_.id,display_name:_.display_name,email:_.email??null,ffn_iuf:s.get(_.id)?.ffn_iuf??null,avatar_url:s.get(_.id)?.avatar_url??null})).filter(_=>_.display_name).sort((_,y)=>_.display_name.localeCompare(y.display_name,"fr"))}const{data:n,error:a}=await i.from("group_members").select("user_id, group_id, users!inner(display_name, role, email), groups!inner(is_temporary)").eq("users.role","athlete").eq("groups.is_temporary",!1);if(a)throw new Error(a.message);const o=new Map(e.map(u=>[u.id,u.name])),d=new Map;return(n??[]).forEach(u=>{const l=u.user_id;d.has(l)||d.set(l,{id:l,display_name:u.users?.display_name??"",email:u.users?.email??null,group_id:u.group_id??null,group_label:o.get(u.group_id)??null,ffn_iuf:s.get(l)?.ffn_iuf??null,avatar_url:s.get(l)?.avatar_url??null})}),Array.from(d.values()).filter(u=>u.display_name).sort((u,l)=>u.display_name.localeCompare(l.display_name,"fr"))}async function Te(){if(!c())return[];const{data:e,error:t}=await i.from("groups").select("id, name, description, is_temporary, is_active, parent_group_id");if(t)throw new Error(t.message);return(e??[]).filter(r=>r.is_temporary?r.is_active===!0:!0).map(r=>({id:N(r.id,0),name:String(r.name??`Groupe ${r.id??""}`).trim(),member_count:null,is_temporary:r.is_temporary??!1,is_active:r.is_active??!0,parent_group_id:r.parent_group_id??null})).filter(r=>r.id>0&&r.name).sort((r,s)=>r.is_temporary&&!s.is_temporary?-1:!r.is_temporary&&s.is_temporary?1:r.name.localeCompare(s.name,"fr"))}async function Ne(e){if(!c())return[];const t=e?.days??30,{data:r,error:s}=await i.rpc("get_upcoming_birthdays",{p_days:t});if(s)throw new Error(s.message);return Array.isArray(r)?r:[]}async function qe(e){if(!c())return[];let t=i.from("users").select("id, display_name, role, email, is_active");e?.role&&(t=t.eq("role",e.role)),e?.includeInactive||(t=t.eq("is_active",!0));const{data:r,error:s}=await t.order("display_name");if(s)throw new Error(s.message);return(r??[]).map(n=>({id:n.id,display_name:n.display_name??"",role:n.role??"",email:n.email??null,is_active:n.is_active??null,group_label:null}))}async function xe(e){if(!c())return{status:"skipped",user:null,initialPassword:null};const{data:t,error:r}=await i.functions.invoke("admin-user",{body:{action:"create_coach",display_name:e.display_name,email:e.email,password:e.password}});if(r)throw new Error(r.message);return{status:"created",user:t?.user??null,initialPassword:t?.initial_password??null}}async function Ce(e){if(!c())return{status:"skipped"};const{error:t}=await i.functions.invoke("admin-user",{body:{action:"update_role",user_id:e.userId,role:e.role}});if(t)throw new Error(t.message);return{status:"updated"}}async function Ae(e){if(!c())return{status:"skipped"};const{error:t}=await i.functions.invoke("admin-user",{body:{action:"disable_user",user_id:e.userId}});if(t)throw new Error(t.message);return{status:"disabled"}}async function Re(){if(!c())return[];const{data:e,error:t}=await i.from("user_profiles").select("user_id, display_name, email, users!user_profiles_user_id_fkey(created_at)").eq("is_approved",!1);if(t)throw new Error(t.message);return(e??[]).map(r=>({user_id:r.user_id,display_name:r.display_name,email:r.email,created_at:r.users?.created_at??new Date().toISOString()}))}async function Oe(e){if(!c())return;const{error:t}=await i.from("user_profiles").update({is_approved:!0,approved_at:new Date().toISOString()}).eq("user_id",e);if(t)throw new Error(t.message)}async function De(e){if(!c())return;const{error:t}=await i.from("users").delete().eq("id",e);if(t)throw new Error(t.message)}async function Me(e){if(!c())return{status:"skipped"};const{data:{user:t}}=await i.auth.getUser();if(!e.userId||e.userId===t?.user_metadata?.app_user_id){const{error:s}=await i.auth.updateUser({password:e.password});if(s)throw new Error(s.message);return{status:"updated"}}const{error:r}=await i.functions.invoke("admin-user",{body:{action:"update_password",user_id:e.userId,password:e.password}});if(r)throw new Error(r.message);return{status:"updated"}}async function ke(e){if(!c())throw new Error("Supabase non disponible");const t=`${e.userId}.${e.extension}`,{error:r}=await i.storage.from("avatars").upload(t,e.blob,{contentType:e.mimeType,upsert:!0});if(r)throw new Error(r.message);const{data:s}=i.storage.from("avatars").getPublicUrl(t),n=`${s.publicUrl}?t=${Date.now()}`,{error:a}=await i.from("user_profiles").update({avatar_url:n}).eq("user_id",e.userId);if(a)throw new Error(a.message);return n}async function Ue(e){if(!c())return;const{error:t}=await i.storage.from("avatars").remove([`${e}.webp`,`${e}.jpg`]);if(t)throw new Error(t.message);const{error:r}=await i.from("user_profiles").update({avatar_url:null}).eq("user_id",e);if(r)throw new Error(r.message)}async function Ge(e=30){if(!c())return[];const t=new Date;t.setDate(t.getDate()-e);const r=t.toISOString().slice(0,10),{data:s,error:n}=await i.from("dim_sessions").select("athlete_id, athlete_name, session_date, rpe, performance, engagement, fatigue").gte("session_date",r).order("session_date",{ascending:!1});if(n)throw new Error(n.message);return(s??[]).map(a=>({athlete_id:a.athlete_id?N(a.athlete_id):null,athlete_name:String(a.athlete_name??""),session_date:String(a.session_date??""),effort:v(a.rpe),performance:v(a.performance),engagement:v(a.engagement),fatigue:v(a.fatigue)}))}const Z=["Piscine","Compétition"];async function Fe(e){if(c()){let r=i.from("timesheet_shifts").select("*").order("shift_date",{ascending:!1});e?.coachId&&(r=r.eq("coach_id",e.coachId)),e?.from&&(r=r.gte("shift_date",e.from)),e?.to&&(r=r.lte("shift_date",e.to));const{data:s,error:n}=await r;if(n)throw new Error(n.message);const a=s??[];if(a.length===0)return a;const o=a.map(l=>l.id),{data:d}=await i.from("timesheet_shift_groups").select("shift_id, group_name").in("shift_id",o),u=new Map;for(const l of d??[]){const _=u.get(l.shift_id)??[];_.push(l.group_name),u.set(l.shift_id,_)}return a.map(l=>({...l,group_names:u.get(l.id)??[]}))}return await q(200),(h(m.TIMESHEET_SHIFTS)||[]).filter(r=>!(e?.coachId&&r.coach_id!==e.coachId||e?.from&&r.shift_date<e.from||e?.to&&r.shift_date>e.to)).sort((r,s)=>r.shift_date!==s.shift_date?r.shift_date<s.shift_date?1:-1:r.start_time<s.start_time?1:-1)}async function Pe(){if(c()){const{data:s,error:n}=await i.from("timesheet_locations").select("*").order("name");if(n)throw new Error(n.message);return s??[]}await q(120);const e=h(m.TIMESHEET_LOCATIONS);if(Array.isArray(e)&&e.length)return e;const t=new Date().toISOString(),r=Z.map((s,n)=>({id:n+1,name:s,created_at:t,updated_at:t}));return I(m.TIMESHEET_LOCATIONS,r),r}async function He(e){if(c()){const{error:u}=await i.from("timesheet_locations").insert({name:e.name.trim()});if(u)throw new Error(u.message);return{status:"created"}}await q(120);const t=e.name.trim();if(!t)throw new Error("Missing location name");const r=h(m.TIMESHEET_LOCATIONS),s=new Date().toISOString(),n=Array.isArray(r)&&r.length?r:Z.map((u,l)=>({id:l+1,name:u,created_at:s,updated_at:s}));if(n.some(u=>u.name.toLowerCase()===t.toLowerCase()))return{status:"exists"};const o=new Date().toISOString(),d={id:Date.now(),name:t,created_at:o,updated_at:o};return I(m.TIMESHEET_LOCATIONS,[...n,d]),{status:"created"}}async function Le(e){if(c()){const{error:s}=await i.from("timesheet_locations").delete().eq("id",e.id);if(s)throw new Error(s.message);return{status:"deleted"}}await q(120);const r=(h(m.TIMESHEET_LOCATIONS)||[]).filter(s=>s.id!==e.id);return I(m.TIMESHEET_LOCATIONS,r),{status:"deleted"}}async function je(){if(c()){const{data:e,error:t}=await i.from("users").select("id, display_name").eq("role","coach").eq("is_active",!0);if(t)throw new Error(t.message);return(e??[]).map(r=>({id:r.id,display_name:r.display_name}))}return[]}async function $e(e){if(c()){const{data:s,error:n}=await i.from("timesheet_shifts").insert({coach_id:e.coach_id,shift_date:e.shift_date,start_time:e.start_time,end_time:e.end_time??null,location:e.location??null,is_travel:e.is_travel}).select("id").single();if(n)throw new Error(n.message);return e.group_names?.length&&await ee(s.id,e.group_names),{status:"created"}}await q(200);const t=h(m.TIMESHEET_SHIFTS)||[],r={...e,id:Date.now(),created_at:new Date().toISOString()};return I(m.TIMESHEET_SHIFTS,[...t,r]),{status:"created"}}async function Be(e){if(c()){const{id:n,group_names:a,...o}=e,{error:d}=await i.from("timesheet_shifts").update(o).eq("id",n);if(d)throw new Error(d.message);return a!==void 0&&await ee(n,a??[]),{status:"updated"}}await q(200);const t=h(m.TIMESHEET_SHIFTS)||[],r=t.findIndex(n=>n.id===e.id);if(r===-1)return{status:"missing"};const s=[...t];return s[r]={...s[r],...e,updated_at:new Date().toISOString()},I(m.TIMESHEET_SHIFTS,s),{status:"updated"}}async function We(e){if(c()){const{error:s}=await i.from("timesheet_shifts").delete().eq("id",e.id);if(s)throw new Error(s.message);return{status:"deleted"}}await q(200);const r=(h(m.TIMESHEET_SHIFTS)||[]).filter(s=>s.id!==e.id);return I(m.TIMESHEET_SHIFTS,r),{status:"deleted"}}async function ze(){if(c()){const{data:e,error:t}=await i.from("timesheet_group_labels").select("*").order("name");if(t)throw new Error(t.message);return e??[]}return await q(120),h("timesheet_group_labels")||[]}async function Xe(e){if(c()){const{error:a}=await i.from("timesheet_group_labels").insert({name:e.name.trim()});if(a)throw new Error(a.message);return{status:"created"}}await q(120);const t=e.name.trim();if(!t)throw new Error("Missing label name");const r=h("timesheet_group_labels")||[];if(r.some(a=>a.name.toLowerCase()===t.toLowerCase()))return{status:"exists"};const n={id:Date.now(),name:t,created_at:new Date().toISOString()};return I("timesheet_group_labels",[...r,n]),{status:"created"}}async function Ve(e){if(c()){const{error:r}=await i.from("timesheet_group_labels").delete().eq("id",e.id);if(r)throw new Error(r.message);return{status:"deleted"}}await q(120);const t=h("timesheet_group_labels")||[];return I("timesheet_group_labels",t.filter(r=>r.id!==e.id)),{status:"deleted"}}async function ee(e,t){if(c()){const{error:r}=await i.from("timesheet_shift_groups").delete().eq("shift_id",e);if(r)throw new Error(r.message);if(t.length>0){const s=t.map(a=>({shift_id:e,group_name:a})),{error:n}=await i.from("timesheet_shift_groups").insert(s);if(n)throw new Error(n.message)}return{status:"updated"}}return{status:"noop"}}async function Ye(){if(c()){const{data:e,error:t}=await i.from("groups").select("id, name").eq("is_temporary",!1).eq("is_active",!0).order("name");if(t)throw new Error(t.message);return e??[]}return[]}async function Je(e){return await q(200),(h(m.NOTIFICATIONS)||[]).filter(r=>r.target_athlete===e||r.target_athlete==="All").reverse()}async function Ke(e){if(c()){const{data:n,error:a}=await i.from("notifications").insert({title:e.title,body:e.body??null,type:e.type}).select("id").single();if(a)throw new Error(a.message);if(n&&e.targets.length>0){const{error:o}=await i.from("notification_targets").insert(e.targets.map(d=>({notification_id:n.id,target_user_id:d.target_user_id??null,target_group_id:d.target_group_id??null})));if(o)throw new Error(o.message)}return{status:"sent"}}const t=h(m.NOTIFICATIONS)||[],r={sender:"Coach",title:e.title,message:e.body||"",type:e.type},s=e.targets.map((n,a)=>({...r,id:Date.now()+a,read:!1,date:new Date().toISOString(),sender_id:null,sender_email:null,target_user_id:n.target_user_id??null,target_group_id:n.target_group_id??null}));return I(m.NOTIFICATIONS,[...t,...s]),{status:"sent"}}async function Qe(e){const r=(h(m.NOTIFICATIONS)||[]).map(s=>s.id===e?{...s,read:!0}:s);I(m.NOTIFICATIONS,r)}async function Ze(e){const t=e.limit??20,r=Number.isFinite(t)?Math.min(Math.max(Number(t),1),200):20,s=e.offset??0,n=Number.isFinite(s)?Math.max(Number(s),0):0,a=e.order==="asc"?"asc":"desc";if(c()){const g=await ue(e.targetUserId??null),w=[];if(e.targetUserId&&w.push(`target_user_id.eq.${e.targetUserId}`),g.forEach(f=>w.push(`target_group_id.eq.${f}`)),!w.length)return{notifications:[],pagination:{limit:r,offset:n,total:0}};let b=i.from("notification_targets").select("*, notifications!inner(*)").or(w.join(",")).order("notifications(created_at)",{ascending:a==="asc"});e.status==="read"?b=b.not("read_at","is",null):e.status==="unread"&&(b=b.is("read_at",null)),e.type&&(b=b.eq("notifications.type",e.type)),e.from&&(b=b.gte("notifications.created_at",e.from)),e.to&&(b=b.lte("notifications.created_at",e.to+"T23:59:59"));const{data:T,error:x}=await b;if(x)throw new Error(x.message);const C=(T??[]).map(f=>{const E=f.notifications||{};return{id:N(f.id,Date.now()),notification_id:v(E.id)??null,target_id:v(f.id)??void 0,target_user_id:v(f.target_user_id)??null,sender_id:v(E.created_by)??null,sender_email:null,target_group_id:v(f.target_group_id)??null,target_group_name:null,sender_name:null,sender_role:null,counterparty_id:null,counterparty_name:null,counterparty_role:null,sender:E.created_by?"Coach":"Système",title:String(E.title||""),message:String(E.body||""),type:String(E.type||"message"),read:!!f.read_at,date:E.created_at||new Date().toISOString(),metadata:E.metadata&&typeof E.metadata=="object"?E.metadata:null}}),p=C.length;return{notifications:C.slice(n,n+r),pagination:{limit:r,offset:n,total:p}}}await q(200);const u=(h(m.NOTIFICATIONS)||[]).filter(g=>!(e.targetUserId&&g.target_user_id!==e.targetUserId||e.targetAthleteName&&!(g.target_athlete===e.targetAthleteName||g.target_athlete==="All")||e.type&&g.type!==e.type||e.status==="read"&&!g.read||e.status==="unread"&&g.read)).sort((g,w)=>{const b=new Date(g.date||g.created_at||0).getTime(),T=new Date(w.date||w.created_at||0).getTime();return a==="asc"?b-T:T-b}),l=u.length;return{notifications:u.slice(n,n+r).map(g=>({id:N(g.id,Date.now()),notification_id:v(g.notification_id)??null,target_user_id:v(g.target_user_id)??null,sender_id:v(g.sender_id)??null,sender_email:g.sender_email?String(g.sender_email):null,sender:String(g.sender||"Coach"),title:String(g.title||""),message:String(g.message||""),type:String(g.type||"message"),read:!!g.read,date:g.date||new Date().toISOString(),metadata:g.metadata&&typeof g.metadata=="object"?g.metadata:null,related_id:g.related_id??void 0})),pagination:{limit:r,offset:n,total:l}}}async function et(e){const t=e.targetId??e.id;if(!t)throw new Error("Missing target id");if(c()){const{error:n}=await i.from("notification_targets").update({read_at:new Date().toISOString()}).eq("id",t);if(n)throw new Error(n.message);return}const s=(h(m.NOTIFICATIONS)||[]).map(n=>n.id===t?{...n,read:!0}:n);I(m.NOTIFICATIONS,s)}const te=e=>{const t=Y(e?.cycle??e?.cycle_type),s=(Array.isArray(e?.items)?e.items:[]).map((a,o)=>J(a,o,t));le(s);const n=s.sort((a,o)=>a.order_index-o.order_index).map(a=>({ordre:a.order_index,exercise_id:a.exercise_id,cycle_type:a.cycle_type,sets:a.sets,reps:a.reps,pct_1rm:a.percent_1rm,rest_series_s:a.rest_seconds,notes:a.notes}));return{cycle:t,normalizedItems:s,itemsPayload:n}},re=(e,t,r)=>e.map(s=>({session_id:t,ordre:s.ordre,exercise_id:s.exercise_id,block:"main",cycle_type:s.cycle_type??r,sets:s.sets,reps:s.reps,pct_1rm:s.pct_1rm,rest_series_s:s.rest_series_s,notes:s.notes})),tt=(e,t)=>({id:t,assignment_id:e.assignment_id,athlete_id:e.athlete_id??null,athlete_name:e.athleteName??null,session_id:e.session_id??null,cycle_type:e.cycle_type??null,status:"in_progress",progress_pct:e.progress_pct??0,started_at:new Date().toISOString(),logs:[]}),rt=e=>({run_id:e.run_id,exercise_id:e.exercise_id,set_index:e.set_index??null,reps:e.reps??null,weight:e.weight??null,pct_1rm_suggested:e.pct_1rm_suggested??null,rest_seconds:e.rest_seconds??null,rpe:e.rpe??null,notes:e.notes??null,completed_at:new Date().toISOString()}),st=(e,t)=>e.map((r,s)=>({run_id:t,exercise_id:r.exercise_id,set_index:r.set_index??r.set_number??s,reps:r.reps??null,weight:r.weight??null,rpe:r.rpe??null,notes:r.notes??null,completed_at:new Date().toISOString()})),nt=e=>{const t={};return e.progress_pct!==void 0&&(t.progress_pct=e.progress_pct),e.status&&(t.status=e.status),e.status==="completed"&&(t.completed_at=new Date().toISOString()),e.fatigue!==void 0&&(t.raw_payload={fatigue:e.fatigue,comments:e.comments}),t},se=(e,t)=>e.map(r=>{const s=t.find(n=>n.id===r.exercise_id);return{...r,exercise_name:s?.nom_exercice,category:s?.exercise_type}}),X=e=>{const t=new Map;for(const r of e){const s=V(Number(r.weight),Number(r.reps));if(!s)continue;const n=Number(r.exercise_id);if(!Number.isFinite(n))continue;const a=t.get(n)??0;s>a&&t.set(n,s)}return t};async function it(){if(c()){const{data:r,error:s}=await i.from("dim_exercices").select("*");if(s)throw new Error(s.message);return(r??[]).map(_e)}const e=h(m.EXERCISES)||[];return(Array.isArray(e)?e:[]).map(r=>W(r))}async function at(e){const t=$(e.exercise_type);if(c()){const n=K({...e,exercise_type:t}),{error:a}=await i.from("dim_exercices").insert(n);if(a)throw new Error(a.message);return{status:"created"}}const r=h(m.EXERCISES)||[],s=W({...e,exercise_type:t,id:Date.now()});return I(m.EXERCISES,[...r,s]),{status:"created"}}async function ot(e){const t=$(e.exercise_type);if(c()){const o=K({...e,exercise_type:t}),{error:d}=await i.from("dim_exercices").update(o).eq("id",e.id);if(d)throw new Error(d.message);return{status:"updated"}}const r=h(m.EXERCISES)||[],s=r.findIndex(o=>o.id===e.id);if(s===-1)throw new Error("Exercice introuvable");const n=W({...r[s],...e,exercise_type:t}),a=[...r];return a[s]=n,I(m.EXERCISES,a),{status:"updated"}}async function ct(e){if(c()){const{error:a}=await i.from("dim_exercices").delete().eq("id",e);if(a)throw new Error(a.message);return{status:"deleted"}}const r=(h(m.EXERCISES)||[]).filter(a=>a.id!==e);I(m.EXERCISES,r);const n=(h(m.STRENGTH_SESSIONS)||[]).map(a=>({...a,items:Array.isArray(a.items)?a.items.filter(o=>o.exercise_id!==e):a.items}));return I(m.STRENGTH_SESSIONS,n),{status:"deleted"}}async function z(){if(c()){const{data:e,error:t}=await i.from("strength_sessions").select("*, strength_session_items(*, dim_exercices(nom_exercice, exercise_type))").order("created_at",{ascending:!1});if(t)throw new Error(t.message);return(e??[]).map(r=>{const s=Array.isArray(r.strength_session_items)?r.strength_session_items:[],n=Y(s[0]?.cycle_type);return{id:N(r.id,Date.now()),title:String(r.name||""),description:r.description??"",cycle:n,folder_id:v(r.folder_id),items:s.sort((a,o)=>(a.ordre??0)-(o.ordre??0)).map((a,o)=>({...J(a,o,n),exercise_name:a.dim_exercices?.nom_exercice??void 0,category:a.dim_exercices?.exercise_type??void 0}))}})}return h(m.STRENGTH_SESSIONS)||[]}async function dt(e){const{cycle:t,normalizedItems:r,itemsPayload:s}=te(e);if(c()){const{data:d,error:u}=await i.from("strength_sessions").insert({name:e?.title??e?.name??"",description:e?.description??"",folder_id:e?.folder_id??null}).select("id").single();if(u)throw new Error(u.message);const l=d.id;if(s.length>0){const{error:_}=await i.from("strength_session_items").insert(re(s,l,t));if(_)throw new Error(_.message)}return{status:"created",id:l}}const n=h(m.STRENGTH_SESSIONS)||[],a=Date.now(),o=se(r,h(m.EXERCISES)||[]);return I(m.STRENGTH_SESSIONS,[...n,{...e,title:e?.title??e?.name??"",cycle:t,items:o,id:a}]),{status:"created",id:a}}async function ne(e){if(!e?.id)throw new Error("Session id manquant");const{cycle:t,normalizedItems:r,itemsPayload:s}=te(e);if(c()){const l=re(s,e.id,t).map(({session_id:y,...g})=>({ordre:g.ordre,exercise_id:g.exercise_id,block:g.block??"main",cycle_type:g.cycle_type??"normal",sets:g.sets??null,reps:g.reps??null,pct_1rm:g.pct_1rm??null,rest_series_s:g.rest_series_s??null,rest_exercise_s:null,notes:g.notes??null,raw_payload:null})),{error:_}=await i.rpc("update_strength_session_atomic",{p_session_id:e.id,p_name:e?.title??e?.name??"",p_description:e?.description??"",p_folder_id:e?.folder_id??null,p_items:l});if(_)throw new Error(_.message);return{status:"updated"}}const n=h(m.STRENGTH_SESSIONS)||[],a=n.findIndex(l=>l.id===e.id);if(a===-1)throw new Error("Séance introuvable");const o=se(r,h(m.EXERCISES)||[]),d={...n[a],...e,title:e?.title??e?.name??"",cycle:t,items:o},u=[...n];return u[a]=d,I(m.STRENGTH_SESSIONS,u),{status:"updated"}}async function ut(e){return ne(e)}async function lt(e){if(c()){const{error:s}=await i.from("strength_sessions").delete().eq("id",e);if(s)throw new Error(s.message);return{status:"deleted"}}const r=(h(m.STRENGTH_SESSIONS)||[]).filter(s=>s.id!==e);return I(m.STRENGTH_SESSIONS,r),{status:"deleted"}}async function _t(e){if(c()){const{data:n,error:a}=await i.from("strength_session_runs").insert({assignment_id:e.assignment_id??null,athlete_id:e.athlete_id??null,session_id:e.session_id??null,status:"in_progress",progress_pct:e.progress_pct??0,started_at:new Date().toISOString()}).select("id").single();if(a)throw new Error(a.message);return e.assignment_id&&await i.from("session_assignments").update({status:"in_progress"}).eq("id",e.assignment_id),{run_id:n.id}}const t=h(m.STRENGTH_RUNS)||[],r=Date.now(),s=tt(e,r);if(I(m.STRENGTH_RUNS,[...t,s]),e.assignment_id){const a=(h(m.ASSIGNMENTS)||[]).map(o=>o.id===e.assignment_id?{...o,status:"in_progress"}:o);I(m.ASSIGNMENTS,a)}return{run_id:r}}async function mt(e){const t=async y=>{if(j(e.weight))return null;const g=V(Number(e.weight),Number(e.reps));if(!g)return null;const w=y?.athleteId??null,b=y?.athleteName??null;if(w===null&&!b)return null;const T=await G({athleteName:b,athleteId:w}),C=new Map((T||[]).map(p=>[p.exercise_id,Number(p.weight??0)])).get(e.exercise_id)??0;return g<=C||c()&&(w==null||w==="")?null:(await F({athlete_id:w??void 0,athlete_name:b??void 0,exercise_id:e.exercise_id,one_rm:g}),g)},r=y=>{const g=e.athlete_id??e.athleteId??null,w=e.athlete_name??e.athleteName??null;if(g!==null||w)return{athleteId:g,athleteName:w};if(!y)return{athleteId:null,athleteName:null};const b=y.find(T=>T.id===e.run_id);return{athleteId:b?.athlete_id??null,athleteName:b?.athlete_name??null}};if(c()){const{error:y}=await i.from("strength_set_logs").insert(rt(e));if(y)throw new Error(y.message);const g=r(),w=await t(g);return{status:"ok",one_rm_updated:!!w,one_rm:w??void 0}}const s=h(m.STRENGTH_RUNS)||[],n=s.findIndex(y=>y.id===e.run_id),a=n>=0?s[n]:{id:e.run_id,logs:[]},o=[...a.logs||[],{...e,completed_at:new Date().toISOString()}],d={...a,logs:o},u=n>=0?[...s.slice(0,n),d,...s.slice(n+1)]:[...s,d];I(m.STRENGTH_RUNS,u);const l=r(u),_=await t(l);return{status:"ok",one_rm_updated:!!_,one_rm:_??void 0}}async function gt(e){if(c()){const d=nt(e),{error:u}=await i.from("strength_session_runs").update(d).eq("id",e.run_id);if(u)throw new Error(u.message);return e.status==="completed"&&e.assignment_id&&await i.from("session_assignments").update({status:"completed"}).eq("id",e.assignment_id),{status:"ok"}}const t=h(m.STRENGTH_RUNS)||[],r=t.findIndex(d=>d.id===e.run_id),s=new Date().toISOString(),n=r>=0?t[r]:{id:e.run_id,started_at:s},a={...n,...e,id:e.run_id,updated_at:s};if(e.status==="completed"&&!a.completed_at&&(a.completed_at=s),e.status==="completed"){const d=e.assignment_id??n.assignment_id;if(d){const l=(h(m.ASSIGNMENTS)||[]).map(_=>_.id===d?{..._,status:"completed"}:_);I(m.ASSIGNMENTS,l)}}const o=r>=0?[...t.slice(0,r),a,...t.slice(r+1)]:[...t,a];return I(m.STRENGTH_RUNS,o),{status:"ok"}}async function ft(e){if(c()){const{error:n}=await i.from("strength_session_runs").delete().eq("id",e);if(n)throw new Error(n.message);return{status:"deleted",source:"remote"}}const t=h(m.STRENGTH_RUNS)||[],r=t.find(n=>n.id===e),s=t.filter(n=>n.id!==e);if(I(m.STRENGTH_RUNS,s),r?.assignment_id){const a=(h(m.ASSIGNMENTS)||[]).map(o=>o.id===r.assignment_id?{...o,status:"assigned"}:o);I(m.ASSIGNMENTS,a)}return{status:"deleted",source:"local"}}async function pt(e){if(c()){let o=e.run_id;if(!o){const{data:u,error:l}=await i.from("strength_session_runs").insert({assignment_id:e.assignment_id??null,athlete_id:e.athlete_id??null,status:"in_progress",progress_pct:e.progress_pct??0,started_at:new Date().toISOString()}).select("id").single();if(l)throw new Error(l.message);o=u.id}if(o&&Array.isArray(e.logs)&&e.logs.length>0){const{error:u}=await i.from("strength_set_logs").insert(st(e.logs,o));if(u)throw new Error(u.message)}const d=X(Array.isArray(e.logs)?e.logs:[]);if(d.size>0){const u=e.athlete_id??null,l=e.athlete_name??null;if(u!=null&&u!==""){const _=await G({athleteName:l,athleteId:u}),y=new Map((_||[]).map(g=>[g.exercise_id,Number(g.weight??0)]));await Promise.all(Array.from(d.entries()).filter(([g,w])=>w>(y.get(g)??0)).map(([g,w])=>F({athlete_id:u??void 0,athlete_name:l??void 0,exercise_id:g,one_rm:w})))}}return o&&await i.from("strength_session_runs").update({progress_pct:e.progress_pct??100,status:"completed",completed_at:new Date().toISOString()}).eq("id",o),e.assignment_id&&await i.from("session_assignments").update({status:"completed"}).eq("id",e.assignment_id),{status:"ok",run_id:o??null}}const t=h(m.STRENGTH_RUNS)||[],r=e.run_id??Date.now(),s=t.find(o=>o.id===r)||{},n={...s,...e,id:r,status:"completed",started_at:s.started_at??e.started_at??e.date??new Date().toISOString(),completed_at:new Date().toISOString()};if(I(m.STRENGTH_RUNS,[...t.filter(o=>o.id!==r),n]),e.assignment_id){const d=(h(m.ASSIGNMENTS)||[]).map(u=>u.id===e.assignment_id?{...u,status:"completed"}:u);I(m.ASSIGNMENTS,d)}const a=X(Array.isArray(e.logs)?e.logs:[]);if(a.size>0){const o=e.athlete_id??null,d=e.athlete_name??null,u=await G({athleteName:d,athleteId:o}),l=new Map((u||[]).map(_=>[_.exercise_id,Number(_.weight??0)]));await Promise.all(Array.from(a.entries()).filter(([_,y])=>y>(l.get(_)??0)).map(([_,y])=>F({athlete_id:o??void 0,athlete_name:d??void 0,exercise_id:_,one_rm:y})))}return{status:"ok",run_id:r}}async function wt(e,t){const r=t?.limit??50,s=Number.isFinite(r)?Math.min(Math.max(Number(r),1),200):50,n=t?.offset??0,a=Number.isFinite(n)?Math.max(Number(n),0):0,o=t?.order==="asc"?"asc":"desc",d=t?.athleteId,u=d!=null&&d!=="";if(c()){let p=i.from("strength_session_runs").select("*, strength_set_logs(*)").order("started_at",{ascending:o==="asc"}).range(a,a+s-1);u&&(p=p.eq("athlete_id",Number(d))),t?.status&&(p=p.eq("status",t.status)),t?.from&&(p=p.gte("started_at",t.from)),t?.to&&(p=p.lte("started_at",t.to+"T23:59:59"));const{data:S,error:f,count:E}=await p;if(f)throw new Error(f.message);return{runs:S??[],pagination:{limit:s,offset:a,total:E??(S??[]).length},exercise_summary:[]}}const y=(h(m.STRENGTH_RUNS)||[]).filter(p=>{if(u&&String(p.athlete_id)!==String(d)||!u&&e&&p.athlete_name!==e||t?.status&&p.status!==t.status)return!1;if(t?.from||t?.to){const S=new Date(p.date||p.started_at||p.created_at||0).getTime();if(t?.from){const f=new Date(t.from).getTime();if(Number.isFinite(f)&&S<f)return!1}if(t?.to){const f=new Date(t.to);f.setHours(23,59,59,999);const E=f.getTime();if(Number.isFinite(E)&&S>E)return!1}}return!0}).sort((p,S)=>{const f=new Date(p.date||p.started_at||p.created_at||0).getTime(),E=new Date(S.date||S.started_at||S.created_at||0).getTime();return o==="asc"?f-E:E-f}),g=h(m.EXERCISES)||[],w=new Map((Array.isArray(g)?g:[]).map(p=>[N(p.id),p.nom_exercice||p.name||`Exercice ${p.id}`])),b=new Map;y.forEach(p=>{(p.logs||[]).forEach(S=>{const f=N(S.exercise_id);if(!f)return;const E=b.get(f)||{exercise_id:f,exercise_name:w.get(f)||`Exercice ${f}`,total_sets:0,total_reps:0,total_volume:0,max_weight:null,last_performed_at:null},R=Number(S.reps??0)||0,A=S.weight,O=j(A)?0:Number(A??0)||0;E.total_sets+=1,E.total_reps+=R,E.total_volume+=R*O,j(A)||(E.max_weight=Math.max(E.max_weight??0,O)||E.max_weight);const M=S.completed_at||p.completed_at||p.started_at||null;if(M){const U=new Date(M).getTime(),H=E.last_performed_at?new Date(E.last_performed_at).getTime():0;(!E.last_performed_at||U>H)&&(E.last_performed_at=M)}b.set(f,E)})});const T=y.length,x=y.slice(a,a+s),C=Array.from(b.values()).sort((p,S)=>S.total_volume-p.total_volume);return{runs:x,pagination:{limit:s,offset:a,total:T},exercise_summary:C}}async function ht(e,t){const r=t?.limit??200,s=Number.isFinite(r)?Math.min(Math.max(Number(r),1),200):200,n=t?.offset??0,a=Number.isFinite(n)?Math.max(Number(n),0):0,o=t?.order==="asc"?"asc":"desc",d=t?.athleteId,u=d!=null&&d!=="",l=t?.period??"day";if(c()){const S={p_period:l};u&&(S.p_athlete_id=Number(d)),t?.from&&(S.p_from=t.from),t?.to&&(S.p_to=t.to);const{data:f,error:E}=await i.rpc("get_strength_history_aggregate",S);if(E)throw new Error(E.message);const R=Array.isArray(f)?f:[];return{periods:R,pagination:{limit:s,offset:a,total:R.length}}}const y=(h(m.STRENGTH_RUNS)||[]).filter(S=>u?S.athlete_id?String(S.athlete_id)===String(d):!1:S.athlete_name===e),g=t?.from?new Date(t.from):null,w=t?.to?new Date(t.to):null,b=new Map,T=S=>{if(l==="month")return`${S.getUTCFullYear()}-${String(S.getUTCMonth()+1).padStart(2,"0")}`;if(l==="week"){const f=new Date(Date.UTC(S.getUTCFullYear(),S.getUTCMonth(),S.getUTCDate())),E=f.getUTCDay()||7;f.setUTCDate(f.getUTCDate()+4-E);const R=new Date(Date.UTC(f.getUTCFullYear(),0,1)),A=Math.ceil(((f.getTime()-R.getTime())/864e5+1)/7);return`${f.getUTCFullYear()}-W${String(A).padStart(2,"0")}`}return S.toISOString().split("T")[0]};y.forEach(S=>{(Array.isArray(S.logs)?S.logs:[]).forEach(E=>{const R=E.completed_at||S.started_at||S.date||S.created_at;if(!R)return;const A=new Date(R);if(Number.isNaN(A.getTime())||g&&A<g||w&&A>w)return;const O=T(A),M=b.get(O)||{period:O,tonnage:0,volume:0},U=Number(E.reps)||0,H=Number(E.weight)||0;M.volume+=U,M.tonnage+=U*H,b.set(O,M)})});const x=Array.from(b.values()).sort((S,f)=>o==="asc"?S.period.localeCompare(f.period):f.period.localeCompare(S.period)),C=x.length;return{periods:x.slice(a,a+s),pagination:{limit:s,offset:a,total:C}}}async function G(e){const t=typeof e=="string"?e:e?.athleteName??null,r=typeof e=="string"?null:e?.athleteId??null;if(c()){let n=i.from("one_rm_records").select("*");r!=null&&String(r)!==""&&(n=n.eq("athlete_id",Number(r)));const{data:a,error:o}=await n;if(o)throw new Error(o.message);return(a??[]).map(d=>({id:v(d.id),athlete_id:v(d.athlete_id),exercise_id:N(d.exercise_id),weight:Number(d.one_rm??0),recorded_at:d.recorded_at??null,notes:d.notes??null}))}return(h(m.ONE_RM)||[]).filter(n=>n.athlete_name===t)}async function F(e){if(c()){const n=e.athlete_id??e.athleteId,a=e.one_rm??e.weight;if(n==null||n===""||a===null||a===void 0)throw new Error("athlete_id et one_rm sont requis");const o={athlete_id:Number(n),exercise_id:e.exercise_id,one_rm:a,recorded_at:new Date().toISOString()};e.notes!==void 0&&(o.notes=e.notes);const{error:d}=await i.from("one_rm_records").upsert(o,{onConflict:"athlete_id,exercise_id"});if(d)throw new Error(d.message);return{status:"ok"}}const t=h(m.ONE_RM)||[],r=e.athlete_name??e.athleteName,s=t.filter(n=>!(n.athlete_name===r&&n.exercise_id===e.exercise_id));return I(m.ONE_RM,[...s,{...e,athlete_name:r,id:Date.now(),date:new Date().toISOString()}]),{status:"ok"}}async function yt(e){if(c()){const{data:s,error:n}=await i.from("one_rm_records").update({notes:e.notes}).eq("athlete_id",Number(e.athlete_id)).eq("exercise_id",e.exercise_id).select("id");if(n)throw new Error(n.message);if(!s||s.length===0){const{error:a}=await i.from("one_rm_records").insert({athlete_id:Number(e.athlete_id),exercise_id:e.exercise_id,notes:e.notes,one_rm:0,recorded_at:new Date().toISOString()});if(a)throw new Error(a.message)}return{status:"ok"}}const t=h(m.ONE_RM)||[],r=t.findIndex(s=>String(s.athlete_id)===String(e.athlete_id)&&s.exercise_id===e.exercise_id);return r>=0?t[r].notes=e.notes:t.push({athlete_id:Number(e.athlete_id),exercise_id:e.exercise_id,one_rm:0,notes:e.notes,id:Date.now(),date:new Date().toISOString()}),I(m.ONE_RM,t),{status:"ok"}}async function St(e){if(c()){const{data:t,error:r}=await i.from("strength_folders").select("*").eq("type",e).order("sort_order",{ascending:!0});if(r)throw new Error(r.message);return(t??[]).map(s=>({id:N(s.id),name:String(s.name||""),type:s.type,sort_order:N(s.sort_order)}))}return[]}async function Et(e,t){if(!c())throw new Error("Supabase requis");const{data:r,error:s}=await i.from("strength_folders").insert({name:e,type:t}).select("*").single();if(s)throw new Error(s.message);return{id:N(r.id),name:String(r.name),type:r.type,sort_order:N(r.sort_order)}}async function bt(e,t){if(!c())throw new Error("Supabase requis");const{error:r}=await i.from("strength_folders").update({name:t}).eq("id",e);if(r)throw new Error(r.message)}async function vt(e){if(!c())throw new Error("Supabase requis");const{error:t}=await i.from("strength_folders").delete().eq("id",e);if(t)throw new Error(t.message)}async function It(e,t,r){if(!c())throw new Error("Supabase requis");const{error:s}=await i.from(r).update({folder_id:t}).eq("id",e);if(s)throw new Error(s.message)}async function Tt(){return c()?null:(await q(100),h(m.ASSIGNMENTS)||[])}async function Nt(e,t,r){if(c()){const{permanentGroupIds:n,temporaryGroupIds:a,hasActiveTemporary:o}=await Q(t??null),d=[];if(t!=null&&d.push(`target_user_id.eq.${t}`),(o?a:n).forEach(p=>d.push(`target_group_id.eq.${p}`)),!d.length)return[];let l=i.from("session_assignments").select("*").or(d.join(","));r?.assignmentType&&(l=l.eq("assignment_type",r.assignmentType)),r?.status?l=l.eq("status",r.status):l=l.neq("status","completed");const{data:_,error:y}=await l;if(y)throw new Error(y.message);if(!_?.length)return[];const[g,w]=await Promise.all([B(),z()]),b=new Map(g.map(p=>[p.id,p])),T=new Map(w.map(p=>[p.id,p])),x=_.map(p=>{const S=p.assignment_type==="strength"?"strength":"swim",f=v(S==="swim"?p.swim_catalog_id:p.strength_session_id)??0,E=p.scheduled_date||p.created_at||"",R=String(p.status||"assigned"),A=S==="swim"?b.get(f):void 0,O=S==="strength"?T.get(f):void 0,M={id:N(p.id,Date.now()),session_id:f,session_type:S,title:S==="swim"?A?.name??"Séance natation":O?.title??"Séance musculation",description:A?.description??O?.description??"",assigned_date:E||new Date().toISOString(),assigned_slot:p.scheduled_slot??null,status:R,items:O?.items??A?.items};return S==="strength"&&(M.cycle=O?.cycle??"endurance"),M}),C=new Map(x.map(p=>[p.id,p]));return Array.from(C.values())}return await q(200),(h(m.ASSIGNMENTS)||[]).filter(n=>!(t!=null&&String(t)!==""&&String(n.target_user_id)===String(t)||n.target_athlete===e)||r?.assignmentType&&n.session_type!==r.assignmentType?!1:r?.status?n.status===r.status:n.status!=="completed")}async function qt(e,t){const r=e.assignment_type??e.session_type;if(!r)return{status:"error"};const s=e.scheduled_date??e.assigned_date??new Date().toISOString();if(c()){const u={assignment_type:r,scheduled_date:s,scheduled_slot:e.scheduled_slot??null,assigned_by:t??null,status:"assigned"};r==="swim"?u.swim_catalog_id=e.session_id:u.strength_session_id=e.session_id,e.target_user_id!==null&&e.target_user_id!==void 0?u.target_user_id=e.target_user_id:e.target_group_id!==null&&e.target_group_id!==void 0&&(u.target_group_id=e.target_group_id);const{data:l,error:_}=await i.from("session_assignments").insert(u).select("id").single();if(_)throw new Error(_.message);const{data:y,error:g}=await i.from("notifications").insert({title:"Nouvelle séance assignée",body:`Séance prévue le ${s}.`,type:"assignment"}).select("id").single();if(!g&&y){const w={notification_id:y.id};e.target_user_id&&(w.target_user_id=e.target_user_id),e.target_group_id&&(w.target_group_id=e.target_group_id),await i.from("notification_targets").insert(w)}return{status:"assigned"}}let n;if(r==="swim"?n=(h(m.SWIM_SESSIONS)||[]).find(u=>u.id===e.session_id):n=(h(m.STRENGTH_SESSIONS)||[]).find(u=>u.id===e.session_id),!n)return{status:"error"};const a={id:Date.now(),session_id:e.session_id,session_type:r,target_athlete:e.target_athlete??"",target_user_id:e.target_user_id??null,target_group_id:e.target_group_id??null,assigned_date:s,title:n.name??n.title,description:n.description,items:n.items,status:"assigned"},o=h(m.ASSIGNMENTS)||[];I(m.ASSIGNMENTS,[...o,a]);const d=h(m.NOTIFICATIONS)||[];return I(m.NOTIFICATIONS,[...d,{id:Date.now()+1,sender:"Coach",target_athlete:e.target_athlete,target_user_id:e.target_user_id??null,target_group_id:e.target_group_id??null,title:"Nouvelle séance assignée",message:`Séance ${n.title??n.name} prévue le ${s}.`,type:"assignment",related_id:a.id,read:!1,date:new Date().toISOString()}]),{status:"assigned"}}async function xt(e){if(c()){const{error:s}=await i.from("session_assignments").delete().eq("id",e);if(s)throw new Error(s.message);return{status:"deleted"}}const r=(h(m.ASSIGNMENTS)||[]).filter(s=>s.id!==e);return I(m.ASSIGNMENTS,r),{status:"deleted"}}async function Ct(e){if(!c())return[];let t=i.from("session_assignments").select("*").gte("scheduled_date",e.from).lte("scheduled_date",e.to);if(e.groupId)t=t.eq("target_group_id",e.groupId);else if(e.userId){const{permanentGroupIds:u,temporaryGroupIds:l,hasActiveTemporary:_}=await Q(e.userId),y=[`target_user_id.eq.${e.userId}`];(_?l:u).forEach(w=>y.push(`target_group_id.eq.${w}`)),t=t.or(y.join(","))}else return[];const{data:r,error:s}=await t;if(s)throw new Error(s.message);if(!r?.length)return[];const[n,a]=await Promise.all([B(),z()]),o=new Map(n.map(u=>[u.id,u])),d=new Map(a.map(u=>[u.id,u]));return r.map(u=>{const l=u.assignment_type==="strength"?"strength":"swim",_=v(l==="swim"?u.swim_catalog_id:u.strength_session_id)??0,y=l==="swim"?o.get(_):void 0,g=l==="strength"?d.get(_):void 0;return{id:N(u.id,0),title:l==="swim"?y?.name??"Séance natation":g?.title??"Séance musculation",type:l,scheduledDate:u.scheduled_date??"",scheduledSlot:u.scheduled_slot??null,targetLabel:"",targetType:u.target_group_id?"group":"user",status:u.status??"assigned"}})}function cs(e){return parseInt(e.split(":")[0],10)<13?"morning":"evening"}async function At(e){if(!c())return{created:0};const t=e.groupIds.map(n=>({assignment_type:"swim",swim_catalog_id:e.swimCatalogId,target_group_id:n,scheduled_date:e.scheduledDate,scheduled_slot:e.scheduledSlot,training_slot_id:e.trainingSlotId,visible_from:e.visibleFrom,assigned_by:e.assignedBy,status:"assigned"})),{data:r,error:s}=await i.from("session_assignments").insert(t).select("id");if(s)throw new Error(s.message);return{created:r?.length??0}}async function Rt(e){if(!c())return[];const{data:t,error:r}=await i.from("session_assignments").select(`
      id, swim_catalog_id, training_slot_id, target_group_id,
      scheduled_date, scheduled_slot, visible_from, notified_at, status,
      swim_sessions_catalog(name)
    `).gte("scheduled_date",e.from).lte("scheduled_date",e.to).not("training_slot_id","is",null).order("scheduled_date");if(r)throw new Error(r.message);return(t??[]).map(s=>({id:s.id,swim_catalog_id:s.swim_catalog_id,training_slot_id:s.training_slot_id,target_group_id:s.target_group_id,scheduled_date:s.scheduled_date,scheduled_slot:s.scheduled_slot,visible_from:s.visible_from,notified_at:s.notified_at,status:s.status,session_name:s.swim_sessions_catalog?.name??null,session_distance:null}))}async function Ot(e){if(!c())return;const{error:t}=await i.from("session_assignments").update({visible_from:e.visibleFrom}).eq("training_slot_id",e.trainingSlotId).eq("scheduled_date",e.scheduledDate);if(t)throw new Error(t.message)}async function Dt(e){if(!c())return;const{error:t}=await i.from("session_assignments").delete().eq("training_slot_id",e.trainingSlotId).eq("scheduled_date",e.scheduledDate);if(t)throw new Error(t.message)}async function Mt(e){if(c()){const l=e?{from_date:e}:{},{data:_,error:y}=await i.rpc("get_hall_of_fame",l);if(!y&&_){const g=Array.isArray(_)?_:[],w=[...g].map(f=>({athlete_name:f.athlete_name,total_distance:Number(f.total_distance??0),avatar_url:f.avatar_url??null})).sort((f,E)=>E.total_distance-f.total_distance).slice(0,5),b=[...g].map(f=>({athlete_name:f.athlete_name,avg_effort:Number(f.avg_performance??f.avg_engagement??0),avatar_url:f.avatar_url??null})).sort((f,E)=>E.avg_effort-f.avg_effort).slice(0,5),T=[...g].map(f=>({athlete_name:f.athlete_name,avg_engagement:Number(f.avg_engagement??0),avatar_url:f.avatar_url??null})).sort((f,E)=>E.avg_engagement-f.avg_engagement).slice(0,5);let x=[];const C=e?{from_date:e}:{},{data:p,error:S}=await i.rpc("get_hall_of_fame_strength",C);return!S&&p&&(x=(Array.isArray(p)?p:[]).map(f=>({athlete_name:f.athlete_name??"Inconnu",total_volume:Number(f.total_volume??0),total_reps:Number(f.total_reps??0),total_sets:Number(f.total_sets??0),max_weight:Number(f.max_weight??0),avatar_url:f.avatar_url??null}))),{distance:w,performance:b,engagement:T,strength:x}}}await q(300);const t=h(m.SESSIONS)||[],r=h(m.STRENGTH_RUNS)||[],s=e?t.filter(l=>l.session_date>=e||l.date>=e):t,n=e?r.filter(l=>(l.started_at??l.date??"")>=e):r,a=new Map;s.forEach(l=>{a.has(l.athlete_name)||a.set(l.athlete_name,{distance:0,effortSum:0,count:0,engagementSum:0,engagementCount:0});const _=a.get(l.athlete_name);_.distance+=l.distance,_.effortSum+=l.effort,_.count+=1,l.engagement!==null&&l.engagement!==void 0&&Number.isFinite(l.engagement)&&(_.engagementSum+=l.engagement,_.engagementCount+=1)});const o=Array.from(a.entries()).map(([l,_])=>({athlete_name:l,total_distance:_.distance,avg_effort:_.effortSum/_.count,avg_engagement:_.engagementCount?_.engagementSum/_.engagementCount:0})),d=new Map;n.forEach(l=>{d.has(l.athlete_name)||d.set(l.athlete_name,{volume:0,reps:0,sets:0,maxWeight:0});const _=d.get(l.athlete_name);l.logs&&l.logs.forEach(y=>{const g=Number(y.reps??0),w=Number(y.weight??0);_.volume+=g*w,_.reps+=g,_.sets+=1,w>_.maxWeight&&(_.maxWeight=w)})});const u=Array.from(d.entries()).map(([l,_])=>({athlete_name:l,total_volume:_.volume,total_reps:_.reps,total_sets:_.sets,max_weight:_.maxWeight}));return{distance:[...o].sort((l,_)=>_.total_distance-l.total_distance).slice(0,5),performance:[...o].sort((l,_)=>_.avg_effort-l.avg_effort).slice(0,5),engagement:[...o].sort((l,_)=>_.avg_engagement-l.avg_engagement).slice(0,5),strength:[...u].sort((l,_)=>_.total_volume-l.total_volume).slice(0,5)}}async function kt(e){if(!c())return[];let t=i.from("club_records").select("*");e.pool_m&&(t=t.eq("pool_m",e.pool_m)),e.sex&&(t=t.eq("sex",e.sex)),e.age&&(t=t.eq("age",e.age)),e.event_code&&(t=t.eq("event_code",e.event_code));const{data:r,error:s}=await t;if(s)throw new Error(s.message);return r??[]}async function Ut(){if(!c())return[];const{data:e,error:t}=await i.from("club_record_swimmers").select("*");if(t)throw new Error(t.message);return(e??[]).map(r=>({...r,is_active:r.is_active?1:0}))}async function Gt(e){if(!c())return null;const t=e.iuf?.trim()||null;if(t){const{data:n,error:a}=await i.from("club_record_swimmers").select("id, display_name, source_type").eq("iuf",t).limit(1);if(a)throw new Error(a.message);if(n&&n.length>0){const o=n[0],d=o.source_type==="user"?"inscrit":"déjà ajouté";throw new Error(`Un nageur avec cet IUF existe déjà : ${o.display_name} (${d})`)}}const{data:r,error:s}=await i.from("club_record_swimmers").insert({source_type:"manual",display_name:e.display_name,iuf:t,sex:e.sex??null,birthdate:e.birthdate??null,is_active:e.is_active!==!1}).select().single();if(s)throw new Error(s.message);return r?{...r,is_active:r.is_active?1:0}:null}async function Ft(e,t){if(!c())return null;let r;if(t.iuf!==void 0&&(r=typeof t.iuf=="string"&&t.iuf.trim()||null,r)){const{data:o,error:d}=await i.from("club_record_swimmers").select("id, display_name, source_type").eq("iuf",r).neq("id",e).limit(1);if(d)throw new Error(d.message);if(o&&o.length>0){const u=o[0],l=u.source_type==="user"?"inscrit":"déjà ajouté";throw new Error(`Un nageur avec cet IUF existe déjà : ${u.display_name} (${l})`)}}const s={};t.iuf!==void 0&&(s.iuf=r??null),t.is_active!==void 0&&(s.is_active=t.is_active),t.sex!==void 0&&(s.sex=t.sex),t.birthdate!==void 0&&(s.birthdate=t.birthdate);const{data:n,error:a}=await i.from("club_record_swimmers").update(s).eq("id",e).select().single();if(a)throw new Error(a.message);return n?{...n,is_active:n.is_active?1:0}:null}async function Pt(e,t){if(!c())return null;const r={};t.iuf!==void 0&&(r.iuf=t.iuf),t.is_active!==void 0&&(r.is_active=t.is_active),t.sex!==void 0&&(r.sex=t.sex),t.birthdate!==void 0&&(r.birthdate=t.birthdate);const{data:s,error:n}=await i.from("club_record_swimmers").update(r).eq("user_id",e).eq("source_type","user").select().single();if(n)throw new Error(n.message);return s?{...s,is_active:s.is_active?1:0}:null}async function Ht(){if(!c())return null;const{data:e,error:t}=await i.functions.invoke("import-club-records");if(t){const r=e?.error??t.message;throw new Error(String(r))}return e}async function Lt(e){if(!c())return[];let t=i.from("import_logs").select("*").order("started_at",{ascending:!1});e?.swimmerIuf&&(t=t.eq("swimmer_iuf",e.swimmerIuf)),e?.limit&&(t=t.limit(e.limit));const{data:r,error:s}=await t;if(s)throw new Error(s.message);return r??[]}async function jt(e,t){if(!c())throw new Error("Supabase not configured");const{data:r,error:s}=await i.functions.invoke("ffn-performances",{body:{swimmer_iuf:e,swimmer_name:t??null}});if(s){const n=r?.error??s.message;throw new Error(String(n))}return r??{total_found:0,new_imported:0,already_existed:0}}async function $t(e){if(c()){const s=e.recordType==="comp"?"swim_records_comp":"swim_records";let n=i.from(s).select("*").order("record_date",{ascending:!1});e.athleteId&&(n=n.eq("athlete_id",e.athleteId)),s==="swim_records"&&(n=n.eq("record_type","training"));const{data:a,error:o}=await n;if(o)throw new Error(o.message);const d=a??[];return{records:d,pagination:{limit:d.length,offset:0,total:d.length}}}const r=(h(m.SWIM_RECORDS)||[]).filter(s=>e.athleteId?s.athlete_id===e.athleteId:e.athleteName?s.athlete_name===e.athleteName:!1);return{records:r,pagination:{limit:r.length,offset:0,total:r.length}}}async function Bt(e){if(c()){const s={athlete_id:e.athlete_id??null,event_name:e.event_name,pool_length:e.pool_length??null,time_seconds:e.time_seconds??null,record_date:e.record_date??null,notes:e.notes??null};if(e.id){const{error:n}=await i.from("swim_records").update(s).eq("id",e.id);if(n)throw new Error(n.message)}else{const{error:n}=await i.from("swim_records").insert(s);if(n)throw new Error(n.message)}return{status:"ok"}}const t=h(m.SWIM_RECORDS)||[];if(e.id){const s=t.map(n=>n.id===e.id?{...n,...e,athlete_id:e.athlete_id??n.athlete_id}:n);return I(m.SWIM_RECORDS,s),{status:"ok"}}const r={...e,id:Date.now(),athlete_id:e.athlete_id??-1,athlete_name:e.athleteName??null};return I(m.SWIM_RECORDS,[...t,r]),{status:"created"}}async function Wt(e){if(!c())return[];let t=i.from("swimmer_performances").select("*").order("competition_date",{ascending:!1});e.userId&&(t=t.eq("user_id",e.userId)),e.iuf&&(t=t.eq("swimmer_iuf",e.iuf)),e.eventCode&&(t=t.eq("event_code",e.eventCode)),e.poolLength&&(t=t.eq("pool_length",e.poolLength)),e.fromDate&&(t=t.gte("competition_date",e.fromDate)),e.toDate&&(t=t.lte("competition_date",e.toDate)),e.limit&&(t=t.limit(e.limit));const{data:r,error:s}=await t;if(s)throw new Error(s.message);return r??[]}async function zt(e){if(!c())throw new Error("Supabase not configured");const{data:t,error:r}=await i.functions.invoke("ffn-performances",{body:{swimmer_iuf:e.iuf,user_id:e.userId??null}});if(r){const s=t?.error??r.message;throw new Error(String(s))}return t??{total_found:0,new_imported:0,already_existed:0}}async function Xt(){if(!c())return null;const{data:e,error:t}=await i.functions.invoke("import-club-records",{body:{mode:"recalculate"}});if(t){const r=e?.error??t.message;throw new Error(String(r))}return e}async function Vt(){if(!c())return;const{data:e,error:t}=await i.from("users").select("id, display_name, role, birthdate").eq("role","athlete").eq("is_active",!0);if(t)throw new Error(t.message);if(!e||e.length===0)return;const{data:r}=await i.from("club_record_swimmers").select("id, user_id, iuf, sex, birthdate, display_name").eq("source_type","user"),s=new Map((r??[]).map(o=>[o.user_id,o])),{data:n}=await i.from("user_profiles").select("user_id, ffn_iuf, birthdate, sex"),a=new Map((n??[]).map(o=>[o.user_id,o]));for(const o of e){const d=a.get(o.id),u=d?.ffn_iuf??null,l=d?.sex??null,_=d?.birthdate??o.birthdate??null,y=s.get(o.id);if(!y)await i.from("club_record_swimmers").insert({source_type:"user",user_id:o.id,display_name:o.display_name,iuf:u,sex:l,birthdate:_,is_active:!0});else{const g={};u&&u!==y.iuf&&(g.iuf=u),l&&l!==y.sex&&(g.sex=l),_&&_!==y.birthdate&&(g.birthdate=_),o.display_name&&o.display_name!==y.display_name&&(g.display_name=o.display_name),Object.keys(g).length>0&&await i.from("club_record_swimmers").update(g).eq("id",y.id)}}}async function Yt(e){if(!c())return[];let t=i.from("club_performances").select("*").eq("event_code",e.event_code).eq("pool_m",e.pool_m).eq("sex",e.sex).order("time_ms",{ascending:!0});e.age!=null&&(t=t.eq("age",e.age));const{data:r,error:s}=await t;if(s)throw new Error(s.message);return r??[]}async function Jt(e){if(!c())return null;const{data:t,error:r}=await i.from("app_settings").select("value").eq("key",e).single();return r?null:t?.value??null}async function Kt(e,t){if(!c())throw new Error("Supabase not configured");const{data:r,error:s}=await i.rpc("merge_club_record_swimmers",{p_manual_id:e,p_user_swimmer_id:t});if(s)throw new Error(s.message);return r}async function Qt(e,t){if(!c())return;const{error:r}=await i.from("app_settings").upsert({key:e,value:t,updated_at:new Date().toISOString()},{onConflict:"key"});if(r)throw new Error(r.message)}async function Zt(e){if(!c())return[];const{data:t,error:r}=await i.from("swim_exercise_logs").select("*").eq("session_id",e).order("created_at",{ascending:!0});if(r)throw new Error(r.message);return(t??[]).map(ie)}async function er(e,t=50){if(!c())return[];const{data:r,error:s}=await i.from("swim_exercise_logs").select("*").eq("user_id",e).order("created_at",{ascending:!1}).limit(t);if(s)throw new Error(s.message);return(r??[]).map(ie)}async function tr(e,t,r){if(!c())return;const{error:s}=await i.from("swim_exercise_logs").delete().eq("session_id",e).eq("user_id",t);if(s)throw new Error(s.message);if(r.length===0)return;const n=r.map(o=>({session_id:e,user_id:t,exercise_label:o.exercise_label,source_item_id:o.source_item_id??null,split_times:o.split_times??[],tempo:o.tempo??null,stroke_count:o.stroke_count??[],notes:o.notes??null})),{error:a}=await i.from("swim_exercise_logs").insert(n);if(a)throw new Error(a.message)}async function rr(e,t){if(!c())return;const r={updated_at:new Date().toISOString()};t.exercise_label!==void 0&&(r.exercise_label=t.exercise_label),t.split_times!==void 0&&(r.split_times=t.split_times),t.tempo!==void 0&&(r.tempo=t.tempo),t.stroke_count!==void 0&&(r.stroke_count=t.stroke_count),t.notes!==void 0&&(r.notes=t.notes);const{error:s}=await i.from("swim_exercise_logs").update(r).eq("id",e);if(s)throw new Error(s.message)}async function sr(e){if(!c())return;const{error:t}=await i.from("swim_exercise_logs").delete().eq("id",e);if(t)throw new Error(t.message)}function ie(e){return{id:String(e.id),session_id:Number(e.session_id),user_id:String(e.user_id),exercise_label:String(e.exercise_label??""),source_item_id:e.source_item_id!=null?Number(e.source_item_id):null,split_times:Array.isArray(e.split_times)?e.split_times:[],tempo:e.tempo!=null?Number(e.tempo):null,stroke_count:Array.isArray(e.stroke_count)?e.stroke_count:[],notes:e.notes!=null?String(e.notes):null,created_at:String(e.created_at??""),updated_at:String(e.updated_at??"")}}async function nr(){if(!c())return[];const{data:e,error:t}=await i.from("groups").select("id, name, is_active, parent_group_id, created_by, created_at").eq("is_temporary",!0).is("parent_group_id",null).order("created_at",{ascending:!1});if(t)throw new Error(t.message);if(!e?.length)return[];const r=e.map(d=>d.id),{data:s}=await i.from("groups").select("parent_group_id").eq("is_temporary",!0).in("parent_group_id",r),n=new Map;(s??[]).forEach(d=>{n.set(d.parent_group_id,(n.get(d.parent_group_id)??0)+1)});const{data:a}=await i.from("group_members").select("group_id").in("group_id",r),o=new Map;return(a??[]).forEach(d=>{o.set(d.group_id,(o.get(d.group_id)??0)+1)}),e.map(d=>({id:N(d.id,0),name:d.name,is_active:d.is_active??!0,parent_group_id:d.parent_group_id??null,member_count:o.get(d.id)??0,subgroup_count:n.get(d.id)??0,created_at:d.created_at??"",created_by:d.created_by??0}))}async function ir(e){if(!c())return null;const{data:t,error:r}=await i.from("groups").select("id, name, is_active").eq("id",e).eq("is_temporary",!0).single();if(r||!t)return null;const{data:s}=await i.from("group_members").select("user_id, users!inner(display_name)").eq("group_id",e),n=(s??[]).map(_=>_.user_id),{data:a}=n.length?await i.from("group_members").select("user_id, group_id, groups!inner(name, is_temporary)").in("user_id",n).eq("groups.is_temporary",!1):{data:[]},o=new Map;(a??[]).forEach(_=>{o.has(_.user_id)||o.set(_.user_id,_.groups?.name??null)});const d=(s??[]).map(_=>({user_id:_.user_id,display_name:_.users?.display_name??"",permanent_group_label:o.get(_.user_id)??null})),{data:u}=await i.from("groups").select("id, name").eq("parent_group_id",e).eq("is_temporary",!0),l=await Promise.all((u??[]).map(async _=>{const{data:y}=await i.from("group_members").select("user_id, users!inner(display_name)").eq("group_id",_.id);return{id:_.id,name:_.name,members:(y??[]).map(g=>({user_id:g.user_id,display_name:g.users?.display_name??""}))}}));return{id:t.id,name:t.name,is_active:t.is_active,members:d,subgroups:l}}async function ar(e){if(!c())throw new Error("Supabase required");if(e.member_user_ids.length>0){const{data:n}=await i.from("group_members").select("user_id, group_id, groups!inner(is_temporary, is_active, parent_group_id)").in("user_id",e.member_user_ids).eq("groups.is_temporary",!0).eq("groups.is_active",!0),a=(n??[]).filter(o=>{const d=o.groups;return!(e.parent_group_id&&(o.group_id===e.parent_group_id||d.parent_group_id===e.parent_group_id))});if(a.length>0){const o=[...new Set(a.map(d=>d.user_id))];throw new Error(`Nageurs déjà dans un groupe temporaire actif: IDs ${o.join(", ")}`)}}if(e.parent_group_id&&e.member_user_ids.length>0){const{data:n}=await i.from("group_members").select("user_id").eq("group_id",e.parent_group_id),a=new Set((n??[]).map(d=>d.user_id)),o=e.member_user_ids.filter(d=>!a.has(d));if(o.length>0)throw new Error(`Nageurs non membres du groupe parent: IDs ${o.join(", ")}`)}const{data:t,error:r}=await i.from("groups").insert({name:e.name.trim(),is_temporary:!0,is_active:!0,parent_group_id:e.parent_group_id??null}).select("id").single();if(r)throw new Error(r.message);const s=t.id;if(e.member_user_ids.length>0){const n=e.member_user_ids.map(o=>({group_id:s,user_id:o})),{error:a}=await i.from("group_members").insert(n);if(a)throw new Error(a.message)}return{id:s}}async function or(e,t){if(!c())throw new Error("Supabase required");if(!t.length)return;const{data:r}=await i.from("group_members").select("user_id, group_id, groups!inner(is_temporary, is_active, parent_group_id)").in("user_id",t).eq("groups.is_temporary",!0).eq("groups.is_active",!0),s=(r??[]).filter(o=>!(o.group_id===e||o.groups.parent_group_id===e));if(s.length>0){const o=[...new Set(s.map(d=>d.user_id))];throw new Error(`Nageurs déjà dans un groupe temporaire actif: IDs ${o.join(", ")}`)}const n=t.map(o=>({group_id:e,user_id:o})),{error:a}=await i.from("group_members").insert(n);if(a)throw new Error(a.message)}async function cr(e,t){if(!c())throw new Error("Supabase required");const{data:r}=await i.from("groups").select("id").eq("parent_group_id",e).eq("is_temporary",!0),s=[e,...(r??[]).map(a=>a.id)],{error:n}=await i.from("group_members").delete().eq("user_id",t).in("group_id",s);if(n)throw new Error(n.message)}async function dr(e){if(!c())throw new Error("Supabase required");const{error:t}=await i.from("groups").update({is_active:!1}).or(`id.eq.${e},parent_group_id.eq.${e}`).eq("is_temporary",!0);if(t)throw new Error(t.message)}async function ur(e){if(!c())throw new Error("Supabase required");const{data:t}=await i.from("group_members").select("user_id").eq("group_id",e),r=(t??[]).map(n=>n.user_id);if(r.length>0){const{data:n}=await i.from("group_members").select("user_id, groups!inner(is_temporary, is_active)").in("user_id",r).eq("groups.is_temporary",!0).eq("groups.is_active",!0);if(n&&n.length>0)throw new Error("Certains nageurs sont déjà dans un autre groupe temporaire actif.")}const{error:s}=await i.from("groups").update({is_active:!0}).or(`id.eq.${e},parent_group_id.eq.${e}`).eq("is_temporary",!0);if(s)throw new Error(s.message)}async function lr(e){if(!c())throw new Error("Supabase required");const{data:t}=await i.from("groups").select("is_active").eq("id",e).single();if(t?.is_active)throw new Error("Impossible de supprimer un groupe temporaire actif. Désactivez-le d'abord.");await i.from("groups").delete().eq("parent_group_id",e).eq("is_temporary",!0);const{error:r}=await i.from("groups").delete().eq("id",e).eq("is_temporary",!0);if(r)throw new Error(r.message)}async function _r(){if(!c())return[];const{data:e,error:t}=await i.from("competitions").select("*").order("date",{ascending:!0});if(t)throw new Error(t.message);return e??[]}async function mr(e){if(!c())throw new Error("Supabase not available");const{data:{user:t}}=await i.auth.getUser(),{data:r,error:s}=await i.from("competitions").insert({...e,created_by:t?.id}).select().single();if(s)throw new Error(s.message);return r}async function gr(e,t){if(!c())throw new Error("Supabase not available");const{data:r,error:s}=await i.from("competitions").update(t).eq("id",e).select().single();if(s)throw new Error(s.message);return r}async function fr(e){if(!c())throw new Error("Supabase not available");const{error:t}=await i.from("competitions").delete().eq("id",e);if(t)throw new Error(t.message)}async function pr(e){if(!c())return[];const{data:t,error:r}=await i.from("competition_assignments").select("*").eq("competition_id",e);if(r)throw new Error(r.message);return t??[]}async function wr(e,t){if(!c())return;const{error:r}=await i.from("competition_assignments").delete().eq("competition_id",e);if(r)throw new Error(r.message);if(t.length>0){const s=t.map(a=>({competition_id:e,athlete_id:a})),{error:n}=await i.from("competition_assignments").insert(s);if(n)throw new Error(n.message)}}async function hr(e){if(!c())return[];let t=i.from("competition_assignments").select("competition_id");e&&(t=t.eq("athlete_id",e));const{data:r,error:s}=await t;if(s)throw new Error(s.message);return(r??[]).map(n=>n.competition_id)}async function ae(e){if(!c())return[];let t=i.from("objectives").select("*, competitions(name, date)").order("created_at",{ascending:!1});e&&(t=t.eq("athlete_id",e));const{data:r,error:s}=await t;if(s)throw new Error(s.message);return(r??[]).map(n=>({id:n.id,athlete_id:n.athlete_id,competition_id:n.competition_id,event_code:n.event_code,pool_length:n.pool_length,target_time_seconds:n.target_time_seconds!=null?Number(n.target_time_seconds):null,text:n.text,created_by:n.created_by,created_at:n.created_at,competition_name:n.competitions?.name??null,competition_date:n.competitions?.date??null}))}async function yr(){if(!c())return[];const{data:{user:e}}=await i.auth.getUser();return e?ae(e.id):[]}async function Sr(e){if(!c())throw new Error("Supabase not available");const{data:{user:t}}=await i.auth.getUser(),{data:r,error:s}=await i.from("objectives").insert({...e,created_by:t?.id}).select().single();if(s)throw new Error(s.message);return r}async function Er(e,t){if(!c())throw new Error("Supabase not available");const{data:r,error:s}=await i.from("objectives").update(t).eq("id",e).select().single();if(s)throw new Error(s.message);return r}async function br(e){if(!c())throw new Error("Supabase not available");const{error:t}=await i.from("objectives").delete().eq("id",e);if(t)throw new Error(t.message)}async function vr(){if(!c())return new Map;const{data:e,error:t}=await i.rpc("get_objectives_counts_by_user");if(t)throw new Error(t.message);const r=new Map;for(const s of e??[])r.set(s.user_id,Number(s.objectives_count));return r}async function Ir(e){if(!c())return[];let t=i.from("planned_absences").select("*");e?.userId&&(t=t.eq("user_id",e.userId)),e?.from&&(t=t.gte("date",e.from)),e?.to&&(t=t.lte("date",e.to));const{data:r,error:s}=await t.order("date",{ascending:!0});if(s)throw new Error(s.message);return r??[]}async function Tr(){if(!c())return[];const{data:e,error:t}=await i.from("planned_absences").select("*").order("date",{ascending:!0});if(t)throw new Error(t.message);return e??[]}async function Nr(e,t){if(!c())throw new Error("Supabase not available");const{data:{session:r}}=await i.auth.getSession(),s=r?.user?.app_metadata?.app_user_id;if(!s)throw new Error("User ID not found");const{data:n,error:a}=await i.from("planned_absences").upsert({user_id:s,date:e,reason:t??null},{onConflict:"user_id,date"}).select().single();if(a)throw new Error(a.message);return n}async function qr(e){if(!c())return;const{data:{session:t}}=await i.auth.getSession(),r=t?.user?.app_metadata?.app_user_id;if(!r)return;const{error:s}=await i.from("planned_absences").delete().eq("user_id",r).eq("date",e);if(s)throw new Error(s.message)}async function xr(e){if(!c())return[];let t=i.from("training_cycles").select("*, start_comp:competitions!start_competition_id(name, date), end_comp:competitions!end_competition_id(name, date)").order("created_at",{ascending:!1});e?.athleteId&&(t=t.eq("athlete_id",e.athleteId)),e?.groupId&&(t=t.eq("group_id",e.groupId));const{data:r,error:s}=await t;if(s)throw new Error(s.message);return(r??[]).map(n=>({id:n.id,group_id:n.group_id,athlete_id:n.athlete_id,start_competition_id:n.start_competition_id,end_competition_id:n.end_competition_id,start_date:n.start_date,name:n.name,notes:n.notes,created_by:n.created_by,created_at:n.created_at,start_competition_name:n.start_comp?.name??null,start_competition_date:n.start_comp?.date??null,end_competition_name:n.end_comp?.name??null,end_competition_date:n.end_comp?.date??null}))}async function Cr(e){if(!c())throw new Error("Supabase not available");const{data:{user:t}}=await i.auth.getUser(),{data:r,error:s}=await i.from("training_cycles").insert({...e,created_by:t?.id}).select().single();if(s)throw new Error(s.message);return r}async function Ar(e,t){if(!c())throw new Error("Supabase not available");const{data:r,error:s}=await i.from("training_cycles").update(t).eq("id",e).select().single();if(s)throw new Error(s.message);return r}async function Rr(e){if(!c())throw new Error("Supabase not available");const{error:t}=await i.from("training_cycles").delete().eq("id",e);if(t)throw new Error(t.message)}async function Or(e){if(!c())return[];const{data:t,error:r}=await i.from("training_weeks").select("*").eq("cycle_id",e).order("week_start",{ascending:!0});if(r)throw new Error(r.message);return t??[]}async function Dr(e){if(!c())throw new Error("Supabase not available");const{data:t,error:r}=await i.from("training_weeks").upsert(e,{onConflict:"cycle_id,week_start"}).select().single();if(r)throw new Error(r.message);return t}async function Mr(e){if(!c())throw new Error("Supabase not available");if(e.length===0)return[];const{data:t,error:r}=await i.from("training_weeks").upsert(e,{onConflict:"cycle_id,week_start"}).select();if(r)throw new Error(r.message);return t??[]}async function kr(e){if(!c())throw new Error("Supabase not available");const{error:t}=await i.from("training_weeks").delete().eq("id",e);if(t)throw new Error(t.message)}async function Ur(e){if(!c())return[];const{data:t,error:r}=await i.from("interviews").select("*").eq("athlete_id",e).order("date",{ascending:!1});if(r)throw new Error(r.message);return t??[]}async function Gr(){if(!c())return[];const{data:{user:e}}=await i.auth.getUser();if(!e)return[];const t=e.app_metadata?.app_user_id;if(!t)return[];const{data:r,error:s}=await i.from("interviews").select("*").eq("athlete_id",t).order("date",{ascending:!1});if(s)throw new Error(s.message);return r??[]}async function Fr(e){if(!c())throw new Error("Supabase not available");const{data:{user:t}}=await i.auth.getUser(),{data:r,error:s}=await i.from("interviews").insert({athlete_id:e.athlete_id,date:e.date??new Date().toISOString().slice(0,10),current_cycle_id:e.current_cycle_id??null,status:"draft_athlete",created_by:t?.id}).select().single();if(s)throw new Error(s.message);return r}async function Pr(e,t){if(!c())throw new Error("Supabase not available");const{data:r,error:s}=await i.from("interviews").update(t).eq("id",e).eq("status","draft_athlete").select().single();if(s)throw new Error(s.message);return r}async function Hr(e){if(!c())throw new Error("Supabase not available");const{error:t}=await i.rpc("submit_interview_to_coach",{p_interview_id:e});if(t)throw new Error(t.message)}async function Lr(e,t){if(!c())throw new Error("Supabase not available");const{data:r,error:s}=await i.from("interviews").update(t).eq("id",e).eq("status","draft_coach").select().single();if(s)throw new Error(s.message);return r}async function jr(e){if(!c())throw new Error("Supabase not available");const{data:t,error:r}=await i.from("interviews").update({status:"sent",sent_at:new Date().toISOString()}).eq("id",e).eq("status","draft_coach").select().single();if(r)throw new Error(r.message);return t}async function $r(e){if(!c())throw new Error("Supabase not available");const{error:t}=await i.rpc("sign_interview",{p_interview_id:e});if(t)throw new Error(t.message)}async function Br(e,t,r){if(!c())return null;let s=i.from("interviews").select("*").eq("athlete_id",e).eq("status","signed").lte("date",t).order("date",{ascending:!1}).limit(1);r&&(s=s.neq("id",r));const{data:n,error:a}=await s.maybeSingle();if(a)throw new Error(a.message);return n??null}async function Wr(e){if(!c())throw new Error("Supabase not available");const{error:t}=await i.from("interviews").delete().eq("id",e);if(t)throw new Error(t.message)}async function zr(){if(!c())return[];const{data:e,error:t}=await i.from("interviews").select("*, athlete:users!athlete_id(display_name)").neq("status","signed").order("date",{ascending:!0});if(t)throw new Error(t.message);return(e??[]).map(r=>({...r,athlete_name:r.athlete?.display_name??"?",athlete:void 0}))}async function P(){if(!c())return[];const{data:e,error:t}=await i.from("training_slots").select("*").eq("is_active",!0).order("day_of_week").order("start_time");if(t)throw new Error(t.message);if(!e||e.length===0)return[];const r=e.map(o=>o.id),{data:s,error:n}=await i.from("training_slot_assignments").select("*, groups:group_id(name), coach:coach_id(display_name)").in("slot_id",r);if(n)throw new Error(n.message);const a=new Map;for(const o of s??[]){const d={id:o.id,slot_id:o.slot_id,group_id:o.group_id,group_name:o.groups?.name??"?",coach_id:o.coach_id,coach_name:o.coach?.display_name??"?",lane_count:o.lane_count},u=a.get(o.slot_id)??[];u.push(d),a.set(o.slot_id,u)}return e.map(o=>({id:o.id,day_of_week:o.day_of_week,start_time:o.start_time,end_time:o.end_time,location:o.location,is_active:o.is_active,created_by:o.created_by,created_at:o.created_at,assignments:a.get(o.id)??[]}))}async function Xr(e){return(await P()).filter(r=>r.assignments.some(s=>s.group_id===e))}async function Vr(e){if(!c())throw new Error("Supabase not available");const{data:t,error:r}=await i.from("training_slots").insert({day_of_week:e.day_of_week,start_time:e.start_time,end_time:e.end_time,location:e.location}).select().single();if(r)throw new Error(r.message);const s=e.assignments.map(a=>({slot_id:t.id,group_id:a.group_id,coach_id:a.coach_id,lane_count:a.lane_count}));if(s.length>0){const{error:a}=await i.from("training_slot_assignments").insert(s);if(a)throw new Error(a.message)}return(await P()).find(a=>a.id===t.id)}async function Yr(e,t){if(!c())throw new Error("Supabase not available");const{error:r}=await i.from("training_slots").update({day_of_week:t.day_of_week,start_time:t.start_time,end_time:t.end_time,location:t.location}).eq("id",e);if(r)throw new Error(r.message);const{error:s}=await i.from("training_slot_assignments").delete().eq("slot_id",e);if(s)throw new Error(s.message);const n=t.assignments.map(o=>({slot_id:e,group_id:o.group_id,coach_id:o.coach_id,lane_count:o.lane_count}));if(n.length>0){const{error:o}=await i.from("training_slot_assignments").insert(n);if(o)throw new Error(o.message)}return(await P()).find(o=>o.id===e)}async function Jr(e){if(!c())return;const{error:t}=await i.from("training_slots").update({is_active:!1}).eq("id",e);if(t)throw new Error(t.message)}async function Kr(e){if(!c())return[];let t=i.from("training_slot_overrides").select("*").order("override_date",{ascending:!0});e?.slotId&&(t=t.eq("slot_id",e.slotId)),e?.fromDate&&(t=t.gte("override_date",e.fromDate));const{data:r,error:s}=await t;if(s)throw new Error(s.message);return r??[]}async function Qr(e){if(!c())throw new Error("Supabase not available");const{data:t,error:r}=await i.from("training_slot_overrides").upsert({slot_id:e.slot_id,override_date:e.override_date,status:e.status,new_start_time:e.new_start_time??null,new_end_time:e.new_end_time??null,new_location:e.new_location??null,reason:e.reason??null},{onConflict:"slot_id,override_date"}).select().single();if(r)throw new Error(r.message);return t}async function Zr(e){if(!c())return;const{error:t}=await i.from("training_slot_overrides").delete().eq("id",e);if(t)throw new Error(t.message)}async function oe(e){if(!c())return[];const{data:t,error:r}=await i.from("swimmer_training_slots").select("*").eq("user_id",e).eq("is_active",!0).order("day_of_week").order("start_time");if(r)throw new Error(r.message);return t??[]}async function es(e){if(!c())return!1;const{count:t,error:r}=await i.from("swimmer_training_slots").select("id",{count:"exact",head:!0}).eq("user_id",e).eq("is_active",!0);if(r)throw new Error(r.message);return(t??0)>0}async function ce(e,t,r){if(!c())throw new Error("Supabase not available");const{data:s,error:n}=await i.from("training_slot_assignments").select("id, slot_id, training_slots!inner(day_of_week, start_time, end_time, location, is_active)").eq("group_id",t);if(n)throw new Error(n.message);const a=(s??[]).filter(d=>d.training_slots?.is_active).map(d=>({user_id:e,source_assignment_id:d.id,day_of_week:d.training_slots.day_of_week,start_time:d.training_slots.start_time,end_time:d.training_slots.end_time,location:d.training_slots.location,created_by:r}));if(a.length===0)return[];const{error:o}=await i.from("swimmer_training_slots").insert(a);if(o)throw new Error(o.message);return oe(e)}async function ts(e,t){if(!c())throw new Error("Supabase not available");const{data:r,error:s}=await i.from("swimmer_training_slots").insert({user_id:e.user_id,source_assignment_id:e.source_assignment_id??null,day_of_week:e.day_of_week,start_time:e.start_time,end_time:e.end_time,location:e.location,created_by:t}).select().single();if(s)throw new Error(s.message);return r}async function rs(e,t){if(!c())throw new Error("Supabase not available");const{data:r,error:s}=await i.from("swimmer_training_slots").update(t).eq("id",e).select().single();if(s)throw new Error(s.message);return r}async function ss(e){if(!c())return;const{error:t}=await i.from("swimmer_training_slots").update({is_active:!1}).eq("id",e);if(t)throw new Error(t.message)}async function ns(e,t,r){if(!c())throw new Error("Supabase not available");const{error:s}=await i.from("swimmer_training_slots").update({is_active:!1}).eq("user_id",e).eq("is_active",!0);if(s)throw new Error(s.message);return ce(e,t,r)}async function is(e){if(!c())return[];const{data:t,error:r}=await i.from("swimmer_training_slots").select("user_id, id").eq("source_assignment_id",e).eq("is_active",!0);if(r)throw new Error(r.message);return(t??[]).map(s=>({user_id:s.user_id,slot_id:s.id}))}const ds={async getCapabilities(){return c()?{mode:"supabase",version:null,timesheet:{available:!0},messaging:{available:!0}}:{mode:"local",version:null,timesheet:{available:!0},messaging:{available:!0}}},async syncSession(e){if(c()){const n=Se(e),{data:a,error:o}=await i.from("dim_sessions").insert(n).select("id").single();if(o)throw new Error(o.message);return{status:"ok",sessionId:a.id}}await q(300);const t=this._get(m.SESSIONS)||[],r=Date.now(),s={...e,id:r,created_at:new Date().toISOString()};return this._save(m.SESSIONS,[...t,s]),{status:"ok",sessionId:r}},async ensureSwimSession(e){if(!c())throw new Error("Supabase required");let t=i.from("dim_sessions").select("id").eq("session_date",e.date).eq("time_slot",e.slot);e.athleteId?t=t.eq("athlete_id",Number(e.athleteId)):t=t.eq("athlete_name",e.athleteName);const{data:r}=await t.maybeSingle();if(r?.id)return r.id;const s={athlete_name:e.athleteName,session_date:e.date,time_slot:e.slot,distance:0,duration:0,rpe:5,performance:5,engagement:5,fatigue:5};e.athleteId&&(s.athlete_id=Number(e.athleteId));const{data:n,error:a}=await i.from("dim_sessions").insert(s).select("id").single();if(a)throw new Error(a.message);return n.id},async getSessions(e,t){const r=t!=null&&String(t)!=="";if(c()){let n=i.from("dim_sessions").select("*").order("session_date",{ascending:!1});r?n=n.eq("athlete_id",Number(t)):n=n.eq("athlete_name",e);const{data:a,error:o}=await n;if(o)throw new Error(o.message);return(a??[]).map(Ee).filter(d=>!!d)}return await q(200),(this._get(m.SESSIONS)||[]).filter(n=>r&&n.athlete_id?String(n.athlete_id)===String(t):n.athlete_name.toLowerCase()===e.toLowerCase()).map(n=>({...n,effort:D(n.effort)??n.effort,feeling:D(n.feeling)??n.feeling,rpe:D(n.rpe??null),performance:D(n.performance??null),engagement:D(n.engagement??null),fatigue:D(n.fatigue??null)})).sort((n,a)=>new Date(a.date).getTime()-new Date(n.date).getTime())},async updateSession(e){if(c()){const n={athlete_name:e.athlete_name,session_date:e.date,time_slot:e.slot,distance:e.distance,duration:e.duration,rpe:k(e.effort),performance:k(e.performance??e.feeling),engagement:k(e.engagement??e.feeling),fatigue:k(e.feeling),comments:e.comments},{error:a}=await i.from("dim_sessions").update(n).eq("id",e.id);if(a)throw new Error(a.message);return{status:"updated"}}await q(200);const t=this._get(m.SESSIONS)||[],r=t.findIndex(n=>n.id===e.id);if(r===-1)return{status:"missing"};const s=[...t];return s[r]={...s[r],...e},this._save(m.SESSIONS,s),{status:"updated"}},async deleteSession(e){if(c()){const{error:s}=await i.from("dim_sessions").delete().eq("id",e);if(s)throw new Error(s.message);return{status:"deleted"}}await q(200);const r=(this._get(m.SESSIONS)||[]).filter(s=>s.id!==e);return this._save(m.SESSIONS,r),{status:"deleted"}},async seedDemoData(){const e=[{id:1,nom_exercice:"Squat",description:"Flexion des jambes",exercise_type:"strength"},{id:2,nom_exercice:"Développé Couché",description:"Poussée horizontale",exercise_type:"strength"},{id:3,nom_exercice:"Tractions",description:"Tirage vertical",exercise_type:"strength"},{id:4,nom_exercice:"Rotations Élastique",description:"Coiffe des rotateurs",exercise_type:"warmup"}];this._save(m.EXERCISES,e);const t={id:101,title:"Full Body A",description:"Séance globale",cycle:"Endurance",items:[{exercise_id:4,exercise_name:"Rotations Élastique",category:"warmup",order_index:0,sets:2,reps:15,rest_seconds:30,percent_1rm:0},{exercise_id:1,exercise_name:"Squat",category:"strength",order_index:1,sets:4,reps:10,rest_seconds:90,percent_1rm:70},{exercise_id:2,exercise_name:"Développé Couché",category:"strength",order_index:2,sets:4,reps:10,rest_seconds:90,percent_1rm:70}]};this._save(m.STRENGTH_SESSIONS,[t]);const r={id:201,name:"VMA 100",description:"Travail de vitesse",created_by:1,items:[{label:"Échauffement 4N",distance:400,intensity:"Souple",notes:"Progressif"},{label:"Corps NL",distance:1e3,intensity:"Max",notes:"10x100 départ 1:30"}]};this._save(m.SWIM_SESSIONS,[r]);const s=new Date().toISOString().split("T")[0];return await this.assignments_create({session_id:101,assignment_type:"strength",target_athlete:"Camille",assigned_date:s}),{status:"seeded"}},_get(e){const t=localStorage.getItem(e);return t?JSON.parse(t):null},_save(e,t){localStorage.setItem(e,JSON.stringify(t))},resetCache(){Object.values(m).forEach(e=>localStorage.removeItem(e)),window.location.reload()},async getHallOfFame(e){return Mt(e)},async getClubRecords(e){return kt(e)},async getClubRecordSwimmers(){return Ut()},async createClubRecordSwimmer(e){return Gt(e)},async updateClubRecordSwimmer(e,t){return Ft(e,t)},async updateClubRecordSwimmerForUser(e,t){return Pt(e,t)},async importClubRecords(){return Ht()},async getImportLogs(e){return Lt(e)},async importSingleSwimmer(e,t){return jt(e,t)},async getSwimRecords(e){return $t(e)},async upsertSwimRecord(e){return Bt(e)},async getSwimmerPerformances(e){return Wt(e)},async importSwimmerPerformances(e){return zt(e)},async recalculateClubRecords(){return Xt()},async getClubRanking(e){return Yt(e)},async syncClubRecordSwimmersFromUsers(){return Vt()},async mergeClubRecordSwimmers(e,t){return Kt(e,t)},async getAppSettings(e){return Jt(e)},async updateAppSettings(e,t){return Qt(e,t)},async getExercises(){return it()},async createExercise(e){return at(e)},async updateExercise(e){return ot(e)},async deleteExercise(e){return ct(e)},async getStrengthSessions(){return z()},async createStrengthSession(e){return dt(e)},async updateStrengthSession(e){return ne(e)},async persistStrengthSessionOrder(e){return ut(e)},async deleteStrengthSession(e){return lt(e)},async startStrengthRun(e){return _t(e)},async logStrengthSet(e){return mt(e)},async updateStrengthRun(e){return gt(e)},async deleteStrengthRun(e){return ft(e)},async saveStrengthRun(e){return pt(e)},async getStrengthHistory(e,t){return wt(e,t)},async getStrengthHistoryAggregate(e,t){return ht(e,t)},async get1RM(e){return G(e)},async update1RM(e){return F(e)},async updateExerciseNote(e){return yt(e)},async getStrengthFolders(e){return St(e)},async createStrengthFolder(e,t){return Et(e,t)},async renameStrengthFolder(e,t){return bt(e,t)},async deleteStrengthFolder(e){return vt(e)},async moveToFolder(e,t,r){return It(e,t,r)},async getSwimExerciseLogs(e){return Zt(e)},async getSwimExerciseLogsHistory(e,t){return er(e,t)},async saveSwimExerciseLogs(e,t,r){return tr(e,t,r)},async updateSwimExerciseLog(e,t){return rr(e,t)},async deleteSwimExerciseLog(e){return sr(e)},async getSwimCatalog(){return B()},async createSwimSession(e){return ye(e)},async deleteSwimSession(e){return he(e)},async archiveSwimSession(e,t){return we(e,t)},async moveSwimSession(e,t){return pe(e,t)},async migrateLocalStorageArchive(e){return fe(e)},async generateShareToken(e){return ge(e)},async getSharedSession(e){return me(e)},async getAssignmentsForCoach(){return Tt()},async getCoachAssignments(e){return Ct(e)},async getAssignments(e,t,r){return Nt(e,t,r)},async assignments_create(e){const t=de.getState().userId;return qt(e,t)},async assignments_delete(e){return xt(e)},async bulkCreateSlotAssignments(e){return At(e)},async getSlotAssignments(e){return Rt(e)},async updateSlotVisibility(e){return Ot(e)},async deleteSlotAssignments(e){return Dt(e)},async getNotifications(e){return Je(e)},async notifications_send(e){return Ke(e)},async markNotificationRead(e){return Qe(e)},async notifications_list(e){return Ze(e)},async notifications_mark_read(e){return et(e)},async listTimesheetShifts(e){return Fe(e)},async listTimesheetLocations(){return Pe()},async createTimesheetLocation(e){return He(e)},async deleteTimesheetLocation(e){return Le(e)},async listTimesheetCoaches(){return je()},async createTimesheetShift(e){return $e(e)},async updateTimesheetShift(e){return Be(e)},async deleteTimesheetShift(e){return We(e)},async listTimesheetGroupLabels(){return ze()},async createTimesheetGroupLabel(e){return Xe(e)},async deleteTimesheetGroupLabel(e){return Ve(e)},async listPermanentGroupsForTimesheet(){return Ye()},async getTemporaryGroups(){return nr()},async getTemporaryGroupDetail(e){return ir(e)},async createTemporaryGroup(e){return ar(e)},async addTemporaryGroupMembers(e,t){return or(e,t)},async removeTemporaryGroupMember(e,t){return cr(e,t)},async deactivateTemporaryGroup(e){return dr(e)},async reactivateTemporaryGroup(e){return ur(e)},async deleteTemporaryGroup(e){return lr(e)},async getCompetitions(){return _r()},async createCompetition(e){return mr(e)},async updateCompetition(e,t){return gr(e,t)},async deleteCompetition(e){return fr(e)},async getCompetitionAssignments(e){return pr(e)},async setCompetitionAssignments(e,t){return wr(e,t)},async getMyCompetitionIds(e){return hr(e)},async getObjectives(e){return ae(e)},async getAthleteObjectives(){return yr()},async createObjective(e){return Sr(e)},async updateObjective(e,t){return Er(e,t)},async deleteObjective(e){return br(e)},async getObjectivesCountsByUser(){return vr()},async getPlannedAbsences(e){return Ir(e)},async getMyPlannedAbsences(){return Tr()},async setPlannedAbsence(e,t){return Nr(e,t)},async removePlannedAbsence(e){return qr(e)},async getTrainingCycles(e){return xr(e)},async createTrainingCycle(e){return Cr(e)},async updateTrainingCycle(e,t){return Ar(e,t)},async deleteTrainingCycle(e){return Rr(e)},async getTrainingWeeks(e){return Or(e)},async upsertTrainingWeek(e){return Dr(e)},async bulkUpsertTrainingWeeks(e){return Mr(e)},async deleteTrainingWeek(e){return kr(e)},async getInterviews(e){return Ur(e)},async getMyInterviews(){return Gr()},async createInterview(e){return Fr(e)},async updateInterviewAthleteSections(e,t){return Pr(e,t)},async submitInterviewToCoach(e){return Hr(e)},async updateInterviewCoachSections(e,t){return Lr(e,t)},async sendInterviewToAthlete(e){return jr(e)},async signInterview(e){return $r(e)},async deleteInterview(e){return Wr(e)},async getPreviousInterview(e,t,r){return Br(e,t,r)},async getAllPendingInterviews(){return zr()},async getProfile(e){return be(e)},async updateProfile(e){return ve(e)},async getAthletes(){return Ie()},async getGroups(){return Te()},async getUpcomingBirthdays(e){return Ne(e)},async listUsers(e){return qe(e)},async createCoach(e){return xe(e)},async updateUserRole(e){return Ce(e)},async disableUser(e){return Ae(e)},async getPendingApprovals(){return Re()},async approveUser(e){return Oe(e)},async rejectUser(e){return De(e)},async authPasswordUpdate(e){return Me(e)},async uploadAvatar(e){return ke(e)},async deleteAvatar(e){return Ue(e)},async getRecentSessionsAllAthletes(e){return Ge(e)},async getTrainingSlots(){return P()},async getTrainingSlotsForGroup(e){return Xr(e)},async createTrainingSlot(e){return Vr(e)},async updateTrainingSlot(e,t){return Yr(e,t)},async deleteTrainingSlot(e){return Jr(e)},async getSlotOverrides(e){return Kr(e)},async createSlotOverride(e){return Qr(e)},async deleteSlotOverride(e){return Zr(e)},async getSwimmerSlots(e){return oe(e)},async hasCustomSlots(e){return es(e)},async initSwimmerSlots(e,t,r){return ce(e,t,r)},async createSwimmerSlot(e,t){return ts(e,t)},async updateSwimmerSlot(e,t){return rs(e,t)},async deleteSwimmerSlot(e){return ss(e)},async resetSwimmerSlots(e,t,r){return ns(e,t,r)},async getSwimmersAffectedBySlot(e){return is(e)}};export{ds as a,xr as b,P as c,Rt as d,Kr as e,Dt as f,zr as g,At as h,cs as i,Ot as u};
