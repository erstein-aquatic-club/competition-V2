import{r as d,b as Ls,h as Os,m as He,n as Ts,j as e,d as We,o as qs,l as Q,u as he,I as zs,t as Us,E as Ks}from"./vendor-ui-DJQMR4VV.js";import{b as Vs,u as Re,c as M}from"./vendor-query-BT4y-huw.js";import{i as Xe,c as fe,j as Bs,h as D,L as x,I as S,B as N,S as E,C as $,b as se,g as G,d as ke,f as Qs,s as De}from"./index-DNODqqqp.js";import{u as Hs,S as re,a as ae,b as te,c as ie,d as F}from"./select-gPcOlEEO.js";import{C as Ws}from"./circle-CHVnxJMF.js";import{T as ne}from"./textarea-Jeq8J0o1.js";import{D as ce,a as le,b as oe,c as de}from"./dialog-DTymDxcY.js";import{C as Ie}from"./checkbox-vNLvXeB7.js";import{A as Fe,a as Ae,b as Me,c as Pe,d as $e,e as Ge,f as Le,g as Oe}from"./alert-dialog-DniiFp6-.js";import{T as Xs,a as Ys,b as Js,c as Zs}from"./tabs-B2a6YTOZ.js";import{L as Te}from"./loader-circle-DSY_Sw-R.js";import{S as ue}from"./save-BLtvUHxS.js";import{C as er}from"./circle-alert-0p_Ck6v_.js";import{P as V}from"./plus-kykhVVIe.js";import{T as me,G as sr}from"./trash-2-DPsDWArt.js";import{E as rr}from"./eye-DTTEs5Xc.js";import{P as qe}from"./pen-DcVtNRrO.js";import"./vendor-react-BzrpNAyj.js";import"./vendor-charts-Db4xOvcx.js";import"./vendor-supabase-D7B1G6YZ.js";import"./chevron-up-BGIoZ6nf.js";import"./check-CPgcghXC.js";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ar=[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]],tr=Xe("funnel",ar);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ir=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],ze=Xe("upload",ir);function pe(a,i,{checkForDefaultPrevented:t=!0}={}){return function(n){if(a?.(n),t===!1||!n.defaultPrevented)return i?.(n)}}var nr=Ls[" useInsertionEffect ".trim().toString()]||Os;function cr({prop:a,defaultProp:i,onChange:t=()=>{},caller:l}){const[n,o,p]=lr({defaultProp:i,onChange:t}),h=a!==void 0,_=h?a:n;{const y=d.useRef(a!==void 0);d.useEffect(()=>{const j=y.current;j!==h&&console.warn(`${l} is changing from ${j?"controlled":"uncontrolled"} to ${h?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),y.current=h},[h,l])}const u=d.useCallback(y=>{if(h){const j=or(y)?y(a):y;j!==a&&p.current?.(j)}else o(y)},[h,a,o,p]);return[_,u]}function lr({defaultProp:a,onChange:i}){const[t,l]=d.useState(a),n=d.useRef(t),o=d.useRef(i);return nr(()=>{o.current=i},[i]),d.useEffect(()=>{n.current!==t&&(o.current?.(t),n.current=t)},[t,n]),[t,l,o]}function or(a){return typeof a=="function"}var je="Radio",[dr,Ye]=We(je),[ur,mr]=dr(je),Je=d.forwardRef((a,i)=>{const{__scopeRadio:t,name:l,checked:n=!1,required:o,disabled:p,value:h="on",onCheck:_,form:u,...y}=a,[j,m]=d.useState(null),f=he(i,I=>m(I)),w=d.useRef(!1),k=j?u||!!j.closest("form"):!0;return e.jsxs(ur,{scope:t,checked:n,disabled:p,children:[e.jsx(Q.button,{type:"button",role:"radio","aria-checked":n,"data-state":rs(n),"data-disabled":p?"":void 0,disabled:p,value:h,...y,ref:f,onClick:pe(a.onClick,I=>{n||_?.(),k&&(w.current=I.isPropagationStopped(),w.current||I.stopPropagation())})}),k&&e.jsx(ss,{control:j,bubbles:!w.current,name:l,value:h,checked:n,required:o,disabled:p,form:u,style:{transform:"translateX(-100%)"}})]})});Je.displayName=je;var Ze="RadioIndicator",es=d.forwardRef((a,i)=>{const{__scopeRadio:t,forceMount:l,...n}=a,o=mr(Ze,t);return e.jsx(Us,{present:l||o.checked,children:e.jsx(Q.span,{"data-state":rs(o.checked),"data-disabled":o.disabled?"":void 0,...n,ref:i})})});es.displayName=Ze;var pr="RadioBubbleInput",ss=d.forwardRef(({__scopeRadio:a,control:i,checked:t,bubbles:l=!0,...n},o)=>{const p=d.useRef(null),h=he(p,o),_=Hs(t),u=Ks(i);return d.useEffect(()=>{const y=p.current;if(!y)return;const j=window.HTMLInputElement.prototype,f=Object.getOwnPropertyDescriptor(j,"checked").set;if(_!==t&&f){const w=new Event("click",{bubbles:l});f.call(y,t),y.dispatchEvent(w)}},[_,t,l]),e.jsx(Q.input,{type:"radio","aria-hidden":!0,defaultChecked:t,...n,tabIndex:-1,ref:h,style:{...n.style,...u,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});ss.displayName=pr;function rs(a){return a?"checked":"unchecked"}var xr=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],H="RadioGroup",[hr]=We(H,[He,Ye]),as=He(),ts=Ye(),[fr,jr]=hr(H),is=d.forwardRef((a,i)=>{const{__scopeRadioGroup:t,name:l,defaultValue:n,value:o,required:p=!1,disabled:h=!1,orientation:_,dir:u,loop:y=!0,onValueChange:j,...m}=a,f=as(t),w=Ts(u),[k,I]=cr({prop:o,defaultProp:n??null,onChange:j,caller:H});return e.jsx(fr,{scope:t,name:l,required:p,disabled:h,value:k,onValueChange:I,children:e.jsx(qs,{asChild:!0,...f,orientation:_,dir:w,loop:y,children:e.jsx(Q.div,{role:"radiogroup","aria-required":p,"aria-orientation":_,"data-disabled":h?"":void 0,dir:w,...m,ref:i})})})});is.displayName=H;var ns="RadioGroupItem",cs=d.forwardRef((a,i)=>{const{__scopeRadioGroup:t,disabled:l,...n}=a,o=jr(ns,t),p=o.disabled||l,h=as(t),_=ts(t),u=d.useRef(null),y=he(i,u),j=o.value===n.value,m=d.useRef(!1);return d.useEffect(()=>{const f=k=>{xr.includes(k.key)&&(m.current=!0)},w=()=>m.current=!1;return document.addEventListener("keydown",f),document.addEventListener("keyup",w),()=>{document.removeEventListener("keydown",f),document.removeEventListener("keyup",w)}},[]),e.jsx(zs,{asChild:!0,...h,focusable:!p,active:j,children:e.jsx(Je,{disabled:p,required:o.required,checked:j,..._,...n,name:o.name,ref:y,onCheck:()=>o.onValueChange(n.value),onKeyDown:pe(f=>{f.key==="Enter"&&f.preventDefault()}),onFocus:pe(n.onFocus,()=>{m.current&&u.current?.click()})})})});cs.displayName=ns;var gr="RadioGroupIndicator",ls=d.forwardRef((a,i)=>{const{__scopeRadioGroup:t,...l}=a,n=ts(t);return e.jsx(es,{...n,...l,ref:i})});ls.displayName=gr;var os=is,ds=cs,vr=ls;const us=d.forwardRef(({className:a,...i},t)=>e.jsx(os,{className:fe("grid gap-2",a),...i,ref:t}));us.displayName=os.displayName;const xe=d.forwardRef(({className:a,...i},t)=>e.jsx(ds,{ref:t,className:fe("aspect-square h-4 w-4 rounded-full border border-primary text-primary shadow focus:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",a),...i,children:e.jsx(vr,{className:"flex items-center justify-center",children:e.jsx(Ws,{className:"h-3.5 w-3.5 fill-primary"})})}));xe.displayName=ds.displayName;const Ue=[{key:"endurance",label:"Endurance",fieldSuffix:"endurance"},{key:"hypertrophie",label:"Hypertrophie",fieldSuffix:"hypertrophie"},{key:"force",label:"Force",fieldSuffix:"force"}],Ke=a=>a==="endurance"||a==="hypertrophie"||a==="force"?a:"endurance",Ve=({exercise:a,onChange:i,disabled:t=!1})=>e.jsxs(Xs,{defaultValue:"endurance",className:"w-full",children:[e.jsx(Ys,{className:"grid w-full grid-cols-3",children:Ue.map(l=>e.jsx(Js,{value:l.key,children:l.label},l.key))}),Ue.map(l=>{const n=`pct_1rm_${l.fieldSuffix}`,o=`Nb_series_${l.fieldSuffix}`,p=`Nb_reps_${l.fieldSuffix}`,h=`recup_${l.fieldSuffix}`,_=`recup_exercices_${l.fieldSuffix}`;return e.jsxs(Zs,{value:l.key,className:`space-y-3 rounded-lg border p-3 ${t?"opacity-60":""}`,children:[e.jsx("p",{className:"text-sm font-semibold",children:l.label}),e.jsxs("div",{className:"grid gap-3 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{children:"% 1RM"}),e.jsx(S,{type:"number",value:a[n]??"",disabled:t,onChange:u=>i({[n]:u.target.value===""?null:Number(u.target.value)})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{children:"Nb séries"}),e.jsx(S,{type:"number",value:a[o]??"",disabled:t,onChange:u=>i({[o]:u.target.value===""?null:Number(u.target.value)})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{children:"Nb reps"}),e.jsx(S,{type:"number",value:a[p]??"",disabled:t,onChange:u=>i({[p]:u.target.value===""?null:Number(u.target.value)})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{children:"Récup. séries (s)"}),e.jsx(S,{type:"number",value:a[h]??"",disabled:t,onChange:u=>i({[h]:u.target.value===""?null:Number(u.target.value)})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{children:"Récup. exercices (s)"}),e.jsx(S,{type:"number",value:a[_]??"",disabled:t,onChange:u=>i({[_]:u.target.value===""?null:Number(u.target.value)})})]})]})]},l.key)})]}),yr={pct_1rm_endurance:60,pct_1rm_hypertrophie:75,pct_1rm_force:85,Nb_series_endurance:4,Nb_series_hypertrophie:3,Nb_series_force:3,Nb_reps_endurance:16,Nb_reps_hypertrophie:8,Nb_reps_force:3,recup_endurance:120,recup_hypertrophie:200,recup_force:300,recup_exercices_endurance:300,recup_exercices_hypertrophie:400,recup_exercices_force:500},B=a=>{const i=Number(a);return Number.isFinite(i)?i:0},Be=(a,i,t,l)=>{const n=i==="force"?"force":i==="hypertrophie"?"hypertrophie":"endurance",o=`Nb_series_${n}`,p=`Nb_reps_${n}`,h=`pct_1rm_${n}`,_=`recup_${n}`;return{exercise_id:a.id,order_index:t,sets:B(a[o]),reps:B(a[p]),rest_seconds:B(a[_]),percent_1rm:B(a[h]),cycle_type:i,notes:l?.notes??""}},Nr=()=>({nom_exercice:"",description:null,illustration_gif:null,exercise_type:"strength",warmup_reps:null,warmup_duration:null,...yr}),Qe=({exercise:a,warmupMode:i,onChange:t,onWarmupModeChange:l,idPrefix:n})=>e.jsxs("div",{className:"space-y-3 rounded-lg border p-3",children:[e.jsx("p",{className:"text-sm font-semibold",children:"Paramètres d’échauffement"}),e.jsxs(us,{value:i,onValueChange:o=>{l(o==="duration"?"duration":"reps"),t(o==="duration"?{warmup_reps:null,warmup_duration:a.warmup_duration??0}:{warmup_duration:null,warmup_reps:a.warmup_reps??0})},className:"grid gap-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(xe,{value:"reps",id:`${n}-warmup-reps`}),e.jsx(x,{htmlFor:`${n}-warmup-reps`,children:"Nombre de répétitions"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(xe,{value:"duration",id:`${n}-warmup-duration`}),e.jsx(x,{htmlFor:`${n}-warmup-duration`,children:"Durée (secondes)"})]})]}),i==="duration"?e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{children:"Durée (s)"}),e.jsx(S,{type:"number",value:a.warmup_duration??"",onChange:o=>t({warmup_duration:o.target.value===""?null:Number(o.target.value)})})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{children:"Nombre de répétitions"}),e.jsx(S,{type:"number",value:a.warmup_reps??"",onChange:o=>t({warmup_reps:o.target.value===""?null:Number(o.target.value)})})]})]});function Vr(){const{toast:a}=Bs(),i=Vs(),[t,l]=d.useState(!1),[n,o]=d.useState(null),[p,h]=d.useState("all"),[_,u]=d.useState(!1),[y,j]=d.useState(!1),[m,f]=d.useState(null),[w,k]=d.useState(null),[I,ge]=d.useState(!1),[O,W]=d.useState(null),[T,X]=d.useState(null),[q,Y]=d.useState(null),[ms,z]=d.useState(null),[ps,xs]=d.useState("reps"),[hs,ve]=d.useState("reps"),[U,ye]=d.useState(!1),Ne=async(s,r)=>{if(s.size>10485760){a({title:"Fichier trop volumineux",description:"La taille maximale est de 10 Mo.",variant:"destructive"});return}ye(!0);try{const g=s.name.split(".").pop()??"gif",C=`exercises/${Date.now()}-${Math.random().toString(36).slice(2)}.${g}`,{error:K}=await De.storage.from("exercise-gifs").upload(C,s,{upsert:!1});if(K)throw K;const{data:Gs}=De.storage.from("exercise-gifs").getPublicUrl(C);r(Gs.publicUrl),a({title:"Image uploadée"})}catch(g){const C=g instanceof Error?g.message:"Réessayez.";a({title:"Erreur d'upload",description:C,variant:"destructive"})}finally{ye(!1)}},[v,R]=d.useState({title:"",description:"",cycle:"endurance",items:[]}),[b,A]=d.useState({...Nr()});d.useEffect(()=>{m&&ve(m.warmup_duration!=null?"duration":"reps")},[m]);const{data:P,isLoading:fs,error:J,refetch:js}=Re({queryKey:["exercises"],queryFn:()=>D.getExercises()}),{data:gs,isLoading:vs,error:Z,refetch:ys}=Re({queryKey:["strength_catalog"],queryFn:()=>D.getStrengthSessions()}),Ns=d.useMemo(()=>new Map((P??[]).map(s=>[s.id,s])),[P]),_s=M({mutationFn:s=>D.createExercise(s),onSuccess:()=>{i.invalidateQueries({queryKey:["exercises"]}),u(!1),a({title:"Exercice ajouté"})}}),ws=M({mutationFn:s=>D.createStrengthSession(s),onSuccess:()=>{i.invalidateQueries({queryKey:["strength_catalog"]}),l(!1),R({title:"",description:"",cycle:"endurance",items:[]}),a({title:"Séance créée avec succès"})}}),bs=M({mutationFn:s=>D.updateExercise(s),onSuccess:()=>{i.invalidateQueries({queryKey:["exercises"]}),i.invalidateQueries({queryKey:["strength_catalog"]}),j(!1),f(null),a({title:"Exercice mis à jour"})}}),Cs=M({mutationFn:s=>D.deleteExercise(s),onSuccess:()=>{i.invalidateQueries({queryKey:["exercises"]}),i.invalidateQueries({queryKey:["strength_catalog"]}),X(null),a({title:"Exercice supprimé"})}}),Ss=M({mutationFn:s=>D.deleteStrengthSession(s),onSuccess:()=>{i.invalidateQueries({queryKey:["strength_catalog"]}),W(null),a({title:"Séance supprimée"})}}),Es=M({mutationFn:s=>D.updateStrengthSession(s),onSuccess:()=>{i.invalidateQueries({queryKey:["strength_catalog"]}),l(!1),o(null),R({title:"",description:"",cycle:"endurance",items:[]}),a({title:"Séance mise à jour"})}}),Rs=M({mutationFn:s=>D.persistStrengthSessionOrder(s)}),ks=()=>{l(!1),o(null),R({title:"",description:"",cycle:"endurance",items:[]})},Ds=s=>{o(s.id),R({title:s.title??"",description:s.description??"",cycle:Ke(s.cycle),items:s.items?.map(r=>({exercise_id:r.exercise_id,order_index:r.order_index??0,sets:r.sets,reps:r.reps,rest_seconds:r.rest_seconds,percent_1rm:r.percent_1rm,cycle_type:r.cycle_type,notes:r.notes??""}))??[]}),l(!0)},Is=s=>{f(s),j(!0)},Fs=()=>{const s={...v,items:ee(v.items)};n?Es.mutate({...s,id:n}):ws.mutate(s)},ee=s=>s.map((r,c)=>({...r,order_index:c})),As=()=>{const s=P?.[0];R(r=>({...r,items:[...r.items,s?Be(s,r.cycle,r.items.length):{exercise_id:1,order_index:r.items.length,sets:0,reps:0,rest_seconds:0,percent_1rm:0}]}))},L=(s,r,c)=>{const g=[...v.items];if(r==="exercise_id"){const C=P?.find(K=>K.id===c);C?g[s]=Be(C,v.cycle,g[s].order_index??s,g[s]):g[s]={...g[s],exercise_id:Number(c)}}else g[s]={...g[s],[r]:c};R({...v,items:g})},Ms=s=>{const r=ee(v.items.filter((c,g)=>g!==s));R({...v,items:r})},Ps=(s,r)=>{if(s===r)return;const c=[...v.items],[g]=c.splice(s,1);c.splice(r,0,g);const C=ee(c);R({...v,items:C}),n&&Rs.mutate({id:n,title:v.title,description:v.description,cycle:v.cycle,items:C})},$s=new Set(v.items.map(s=>s.exercise_id)),_e=P?.filter(s=>p==="all"||$s.has(s.id)?!0:s.exercise_type===p)??[],we=e.jsx(ce,{open:y,onOpenChange:j,children:e.jsxs(le,{className:"sm:max-w-3xl max-h-[85vh] overflow-y-auto pb-safe",children:[e.jsx(oe,{children:e.jsx(de,{children:"Modifier l’exercice"})}),m&&e.jsxs("div",{className:"space-y-4",children:[m.exercise_type==="warmup"?e.jsx(Qe,{exercise:m,warmupMode:hs,onChange:s=>f(r=>r&&{...r,...s}),onWarmupModeChange:ve,idPrefix:"edit"}):null,e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{children:"Nom"}),e.jsx(S,{value:m.nom_exercice,onChange:s=>f({...m,nom_exercice:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{children:"Description"}),e.jsx(ne,{value:m.description??"",onChange:s=>f({...m,description:s.target.value===""?null:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{children:"Illustration (GIF)"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(S,{value:m.illustration_gif??"",onChange:s=>f({...m,illustration_gif:s.target.value===""?null:s.target.value}),placeholder:"https://...",className:"flex-1"}),e.jsx(N,{type:"button",variant:"outline",size:"icon",disabled:U,onClick:()=>{const s=document.createElement("input");s.type="file",s.accept="image/*,.gif",s.onchange=r=>{const c=r.target.files?.[0];c&&Ne(c,g=>f(C=>C&&{...C,illustration_gif:g}))},s.click()},"aria-label":"Uploader une image",children:U?e.jsx(Te,{className:"h-4 w-4 animate-spin"}):e.jsx(ze,{className:"h-4 w-4"})})]}),m.illustration_gif&&e.jsx("img",{src:m.illustration_gif,alt:"Aperçu",className:"mt-2 h-20 w-20 rounded-lg object-cover border"})]}),m.exercise_type!=="warmup"?e.jsx(Ve,{exercise:m,onChange:s=>f(r=>r&&{...r,...s})}):null,e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ie,{id:"warmup-flag-edit",checked:m.exercise_type==="warmup",onCheckedChange:s=>f({...m,exercise_type:s===!0?"warmup":"strength"})}),e.jsx(x,{htmlFor:"warmup-flag-edit",children:"Exercice d’échauffement (warmup)"})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(N,{variant:"outline",onClick:()=>{j(!1),f(null)},children:"Annuler"}),e.jsxs(N,{onClick:()=>{m?.id&&bs.mutate(m)},disabled:!m.nom_exercice.trim(),children:[e.jsx(ue,{className:"mr-2 h-4 w-4"})," Enregistrer"]})]})]})]})}),be=e.jsx(ce,{open:_,onOpenChange:u,children:e.jsxs(le,{className:"sm:max-w-3xl max-h-[85vh] overflow-y-auto pb-safe",children:[e.jsx(oe,{children:e.jsx(de,{children:"Créer un exercice"})}),e.jsxs("div",{className:"space-y-4",children:[b.exercise_type==="warmup"?e.jsx(Qe,{exercise:b,warmupMode:ps,onChange:s=>A(r=>({...r,...s})),onWarmupModeChange:xs,idPrefix:"create"}):null,e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{children:"Nom"}),e.jsx(S,{value:b.nom_exercice,onChange:s=>A({...b,nom_exercice:s.target.value}),placeholder:"ex: Rotations Élastique"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{children:"Description"}),e.jsx(ne,{value:b.description??"",onChange:s=>A({...b,description:s.target.value===""?null:s.target.value}),placeholder:"Détails, consignes..."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{children:"Illustration (GIF)"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(S,{value:b.illustration_gif??"",onChange:s=>A({...b,illustration_gif:s.target.value===""?null:s.target.value}),placeholder:"https://...",className:"flex-1"}),e.jsx(N,{type:"button",variant:"outline",size:"icon",disabled:U,onClick:()=>{const s=document.createElement("input");s.type="file",s.accept="image/*,.gif",s.onchange=r=>{const c=r.target.files?.[0];c&&Ne(c,g=>A(C=>({...C,illustration_gif:g})))},s.click()},"aria-label":"Uploader une image",children:U?e.jsx(Te,{className:"h-4 w-4 animate-spin"}):e.jsx(ze,{className:"h-4 w-4"})})]}),b.illustration_gif&&e.jsx("img",{src:b.illustration_gif,alt:"Aperçu",className:"mt-2 h-20 w-20 rounded-lg object-cover border"})]}),b.exercise_type!=="warmup"?e.jsx(Ve,{exercise:b,onChange:s=>A(r=>({...r,...s}))}):null,e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ie,{id:"warmup-flag",checked:b.exercise_type==="warmup",onCheckedChange:s=>A({...b,exercise_type:s===!0?"warmup":"strength"})}),e.jsx(x,{htmlFor:"warmup-flag",children:"Exercice d’échauffement (warmup)"})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(N,{variant:"outline",onClick:()=>u(!1),children:"Annuler"}),e.jsxs(N,{onClick:()=>_s.mutate(b),disabled:!b.nom_exercice.trim(),children:[e.jsx(ue,{className:"mr-2 h-4 w-4"})," Enregistrer"]})]})]})]})}),Ce=e.jsx(ce,{open:I,onOpenChange:s=>{ge(s),s||k(null)},children:e.jsxs(le,{className:"sm:max-w-3xl",children:[e.jsx(oe,{children:e.jsx(de,{children:"Détails de la séance"})}),w&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-lg font-semibold",children:w.title}),e.jsx("p",{className:"text-sm text-muted-foreground",children:w.description||"—"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Cycle : ",w.cycle]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm font-semibold",children:"Exercices"}),e.jsx("div",{className:"space-y-2",children:(w.items??[]).slice().sort((s,r)=>(s.order_index??0)-(r.order_index??0)).map((s,r)=>{const c=Ns.get(s.exercise_id);return e.jsxs("div",{className:"rounded-md border px-3 py-2 text-sm",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("span",{className:"font-medium",children:[r+1,". ",c?.nom_exercice??s.exercise_name??"Exercice"]}),e.jsx("span",{className:"text-xs text-muted-foreground",children:c?.exercise_type==="warmup"||s.category==="warmup"?"Échauffement":"Travail"})]}),e.jsxs("div",{className:"mt-1 text-xs text-muted-foreground",children:[s.sets," séries • ",s.reps," reps • ",s.percent_1rm,"% 1RM • ",s.rest_seconds,"s"]})]},`${s.exercise_id}-${r}`)})})]})]})]})}),Se=e.jsx(Fe,{open:!!O,onOpenChange:s=>{s||W(null)},children:e.jsxs(Ae,{children:[e.jsxs(Me,{children:[e.jsx(Pe,{children:"Supprimer la séance ?"}),e.jsxs($e,{children:['Cette action est définitive. La séance "',O?.title,'" sera supprimée.']})]}),e.jsxs(Ge,{children:[e.jsx(Le,{children:"Annuler"}),e.jsx(Oe,{onClick:()=>{O?.id&&Ss.mutate(O.id)},children:"Supprimer"})]})]})}),Ee=e.jsx(Fe,{open:!!T,onOpenChange:s=>{s||X(null)},children:e.jsxs(Ae,{children:[e.jsxs(Me,{children:[e.jsx(Pe,{children:"Supprimer l’exercice ?"}),e.jsxs($e,{children:['Cette action est définitive. L’exercice "',T?.nom_exercice,'" sera supprimé.']})]}),e.jsxs(Ge,{children:[e.jsx(Le,{children:"Annuler"}),e.jsx(Oe,{onClick:()=>{T?.id&&Cs.mutate(T.id)},children:"Supprimer"})]})]})});return fs||vs?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(E,{className:"h-7 w-64"}),e.jsx(E,{className:"h-10 w-24"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(E,{className:"h-6 w-48"}),e.jsx("div",{className:"grid gap-4 md:grid-cols-2",children:Array.from({length:4}).map((s,r)=>e.jsxs($,{children:[e.jsxs(se,{children:[e.jsx(E,{className:"h-6 w-3/4"}),e.jsx(E,{className:"h-4 w-1/2 mt-2"})]}),e.jsx(G,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(E,{className:"h-10 w-10"}),e.jsx(E,{className:"h-10 w-10"}),e.jsx(E,{className:"h-10 w-10"})]})})]},`skeleton-session-${r}`))})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(E,{className:"h-6 w-48"}),e.jsx(E,{className:"h-10 w-48"})]}),e.jsx("div",{className:"grid gap-3 md:grid-cols-2",children:Array.from({length:6}).map((s,r)=>e.jsx($,{children:e.jsxs(G,{className:"flex flex-col gap-3 py-4 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(E,{className:"h-14 w-14 rounded-md"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{className:"h-5 w-32"}),e.jsx(E,{className:"h-4 w-24"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(E,{className:"h-10 w-10"}),e.jsx(E,{className:"h-10 w-10"})]})]})},`skeleton-exercise-${r}`))})]})]}):J||Z?e.jsxs("div",{className:"flex flex-col items-center justify-center p-8 text-center",children:[e.jsx(er,{className:"h-12 w-12 text-destructive mb-4"}),e.jsx("h3",{className:"font-semibold",children:"Impossible de charger les données"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:J instanceof Error?J.message:Z instanceof Error?Z.message:"Une erreur s'est produite"}),e.jsx(N,{onClick:()=>{js(),ys()},className:"mt-4",children:"Réessayer"})]}):t?e.jsxs("div",{className:"space-y-6 animate-in slide-in-from-bottom-4",children:[be,we,Ce,Se,Ee,e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-bold uppercase",children:n?"Modifier Séance Muscu":"Nouvelle Séance Muscu"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(N,{variant:"outline",onClick:ks,children:"Annuler"}),e.jsxs(N,{onClick:Fs,children:[e.jsx(ue,{className:"mr-2 h-4 w-4"})," Enregistrer"]})]})]}),e.jsxs($,{children:[e.jsx(se,{children:e.jsx(ke,{children:"Informations Générales"})}),e.jsxs(G,{className:"space-y-4",children:[e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{children:"Titre"}),e.jsx(S,{value:v.title,onChange:s=>R({...v,title:s.target.value}),placeholder:"ex: Full Body A"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{children:"Cycle"}),e.jsxs(re,{value:v.cycle,onValueChange:s=>R({...v,cycle:Ke(s)}),children:[e.jsx(ae,{children:e.jsx(te,{})}),e.jsxs(ie,{children:[e.jsx(F,{value:"endurance",children:"Endurance"}),e.jsx(F,{value:"hypertrophie",children:"Hypertrophie"}),e.jsx(F,{value:"force",children:"Force"})]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{children:"Description"}),e.jsx(ne,{value:v.description,onChange:s=>R({...v,description:s.target.value})})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-bold",children:"Exercices"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(N,{size:"sm",variant:"outline",onClick:()=>u(!0),children:[e.jsx(V,{className:"mr-2 h-4 w-4"})," Nouvel exercice"]}),e.jsxs(N,{size:"sm",onClick:As,children:[e.jsx(V,{className:"mr-2 h-4 w-4"})," Ajouter"]})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-[220px_1fr] items-end",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(x,{className:"flex items-center gap-2",children:[e.jsx(tr,{className:"h-4 w-4"})," Filtre exercices"]}),e.jsxs(re,{value:p,onValueChange:s=>h(s),children:[e.jsx(ae,{children:e.jsx(te,{})}),e.jsxs(ie,{children:[e.jsx(F,{value:"all",children:"Tous"}),e.jsx(F,{value:"strength",children:"Séries de travail"}),e.jsx(F,{value:"warmup",children:"Échauffement"})]})]})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Les exercices marqués warmup sont affichés dans les séances avec le badge « Échauffement »."})]}),v.items.map((s,r)=>e.jsxs($,{className:fe("relative transition-all",ms===r&&q!==null&&q!==r&&"ring-2 ring-primary bg-accent/30"),onDragOver:c=>c.preventDefault(),onDragEnter:()=>z(r),onDragLeave:()=>z(c=>c===r?null:c),onDrop:()=>{q!==null&&(Ps(q,r),Y(null),z(null))},children:[e.jsx(N,{variant:"ghost",size:"icon",className:"absolute top-2 right-2 text-destructive",onClick:()=>Ms(r),"aria-label":"Supprimer l'exercice",children:e.jsx(me,{className:"h-4 w-4"})}),e.jsxs(G,{className:"pt-6 grid md:grid-cols-12 gap-4 items-end",children:[e.jsx("div",{className:"md:col-span-1 flex items-center justify-center",children:e.jsx("button",{type:"button",className:"cursor-grab rounded-md border p-1 text-muted-foreground hover:text-foreground",draggable:!0,onDragStart:()=>Y(r),onDragEnd:()=>{Y(null),z(null)},"aria-label":"Réordonner",children:e.jsx(sr,{className:"h-4 w-4"})})}),e.jsxs("div",{className:"md:col-span-3 space-y-2",children:[e.jsx(x,{children:"Exercice"}),e.jsxs(re,{value:s.exercise_id.toString(),onValueChange:c=>L(r,"exercise_id",parseInt(c)),children:[e.jsx(ae,{children:e.jsx(te,{})}),e.jsx(ie,{children:_e.length?_e.map(c=>e.jsxs(F,{value:c.id.toString(),children:[c.nom_exercice,c.exercise_type==="warmup"?" • Échauffement":""]},c.id)):e.jsx(F,{value:"no-exercise",disabled:!0,children:"Aucun exercice disponible"})})]})]}),e.jsxs("div",{className:"md:col-span-2 space-y-2",children:[e.jsx(x,{children:"Séries"}),e.jsx(S,{type:"number",value:s.sets===0?"":s.sets,onChange:c=>L(r,"sets",c.target.value===""?0:Number(c.target.value))})]}),e.jsxs("div",{className:"md:col-span-2 space-y-2",children:[e.jsx(x,{children:"Reps"}),e.jsx(S,{type:"number",value:s.reps===0?"":s.reps,onChange:c=>L(r,"reps",c.target.value===""?0:Number(c.target.value))})]}),e.jsxs("div",{className:"md:col-span-2 space-y-2",children:[e.jsx(x,{children:"% 1RM"}),e.jsx(S,{type:"number",value:s.percent_1rm===0?"":s.percent_1rm,onChange:c=>L(r,"percent_1rm",c.target.value===""?0:Number(c.target.value))})]}),e.jsxs("div",{className:"md:col-span-2 space-y-2",children:[e.jsx(x,{children:"Repos (s)"}),e.jsx(S,{type:"number",value:s.rest_seconds===0?"":s.rest_seconds,onChange:c=>L(r,"rest_seconds",c.target.value===""?0:Number(c.target.value))})]})]})]},`${s.exercise_id}-${r}`))]})]}):e.jsxs("div",{className:"space-y-4",children:[be,we,Ce,Se,Ee,e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"font-bold text-lg",children:"Catalogue Séances Musculation"}),e.jsxs(N,{onClick:()=>{o(null),R({title:"",description:"",cycle:"endurance",items:[]}),l(!0)},children:[e.jsx(V,{className:"mr-2 h-4 w-4"})," Créer"]})]}),e.jsx("div",{className:"grid gap-4 md:grid-cols-2",children:gs?.map(s=>e.jsxs($,{children:[e.jsxs(se,{children:[e.jsx(ke,{children:s.title}),e.jsxs(Qs,{children:[s.items?.length||0," exercices • ",s.cycle]})]}),e.jsx(G,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(N,{variant:"outline",size:"icon","aria-label":"Voir détails",onClick:()=>{k(s),ge(!0)},children:e.jsx(rr,{className:"h-4 w-4"})}),e.jsx(N,{variant:"secondary",size:"icon","aria-label":"Modifier",onClick:()=>Ds(s),children:e.jsx(qe,{className:"h-4 w-4"})}),e.jsx(N,{variant:"destructive",size:"icon","aria-label":"Supprimer",onClick:()=>W(s),children:e.jsx(me,{className:"h-4 w-4"})})]})})]},s.id))}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-bold text-lg",children:"Catalogue Exercices"}),e.jsxs(N,{variant:"outline",onClick:()=>u(!0),children:[e.jsx(V,{className:"mr-2 h-4 w-4"})," Ajouter un exercice"]})]}),e.jsx("div",{className:"grid gap-3 md:grid-cols-2",children:P?.map(s=>e.jsx($,{children:e.jsxs(G,{className:"flex flex-col gap-3 py-4 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[s.illustration_gif?e.jsx("img",{src:s.illustration_gif,alt:`Illustration ${s.nom_exercice}`,className:"h-14 w-14 rounded-md object-cover",loading:"lazy",decoding:"async"}):null,e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:s.nom_exercice}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.exercise_type==="warmup"?"Échauffement":"Séries de travail"})]})]}),e.jsxs("div",{className:"flex w-full gap-2 sm:w-auto",children:[e.jsx(N,{variant:"outline",size:"icon","aria-label":"Modifier",onClick:()=>Is(s),children:e.jsx(qe,{className:"h-4 w-4"})}),e.jsx(N,{variant:"destructive",size:"icon","aria-label":"Supprimer",onClick:()=>X(s),children:e.jsx(me,{className:"h-4 w-4"})})]})]})},s.id))})]})]})}export{Be as createStrengthItemFromExercise,Vr as default};
