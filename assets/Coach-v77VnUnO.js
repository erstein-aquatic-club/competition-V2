const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/StrengthCatalog-BP9T7bSs.js","assets/vendor-query-Dcze6zAc.js","assets/vendor-react-BzrpNAyj.js","assets/api-DxIZTvQf.js","assets/index-CnzL3BTT.js","assets/vendor-supabase-DFPLkPj_.js","assets/index-DyXjbFls.css","assets/swim-DM3-wCjO.js","assets/textarea-CP7YhtqS.js","assets/dialog-tQJsUh4Y.js","assets/index-oVYhaKSV.js","assets/index-D9VO3YHf.js","assets/checkbox-BFPngTT6.js","assets/select-CQylETYu.js","assets/index-COLZ1OS3.js","assets/chevron-down-CbOB1ZnN.js","assets/chevron-up-CI2O0Z4e.js","assets/alert-dialog-BtscKph9.js","assets/tabs-B0xsmQrZ.js","assets/index-DqqFb_g2.js","assets/SessionListView-Dg53O3u3.js","assets/chevron-left-C4ImbcEg.js","assets/play-w6iO_Iqg.js","assets/save-BUrwpExN.js","assets/chevron-right-Dw6lkJno.js","assets/CalendarGrid-BFIb4LJP.js","assets/circle-alert-Bnmf6_fH.js","assets/pencil-BA1cyk7v.js","assets/share-2-UkwjxigU.js","assets/trash-2-DxcT7Nwo.js","assets/drawer-B69Kt4u0.js","assets/plus-CDQjg2oT.js","assets/loader-circle-CSRocK0S.js","assets/search-B5VVd6dg.js","assets/pen-BnCmJPoM.js","assets/toggle-group-8aw5MI1i.js","assets/objectiveHelpers-BXB1iFaO.js","assets/badge-MgpyKS4G.js","assets/copy-DI2romvw.js","assets/sheet-UdWxF58G.js","assets/InlineBanner-QDunnMrJ.js","assets/separator-okv1NY9k.js","assets/collapsible-aCP1D4dl.js","assets/user-plus-cpJt8uzw.js","assets/clock-TTEhupg6.js","assets/map-pin-qXD7UvM6.js","assets/SwimCatalog-DTa1EeOd.js","assets/SwimSessionTimeline-Clnnzl5U.js","assets/SwimTimeInput-o0oPUpUL.js","assets/timer-D0yEsO44.js","assets/eye-DVMo7RuP.js","assets/sparkles-WxD_HS59.js","assets/date-NdbyDBh_.js","assets/format-B9mPVj_w.js"])))=>i.map(i=>d[i]);
import{c as Le,B as K,d as ue,C as Ve,i as Be,k as Ue,l as He,g as Qe,L as Q,I as pe,n as Ae,o as Jt,p as Xt,R as un,q as kt,r as Se,t as Ye,P as ce,v as Zt,w as Mt,x as mn,y as pn,z as hn,E as xn,a as ne,X as It,s as es,W as ts,D as ss,G as gn,U as nt,H as fn,J as vn,T as ft,K as jn,M as Dt,u as Tt,b as bn,N as Ot,_ as ns}from"./index-CnzL3BTT.js";import{j as e,r,u as W,R as rs,c as ve,d as ee}from"./vendor-query-Dcze6zAc.js";import{a as $}from"./api-DxIZTvQf.js";import{T as ot,a as me}from"./toggle-group-8aw5MI1i.js";import{A as tt,M as as,T as vt,e as os,f as is,F as yn,p as $t}from"./objectiveHelpers-BXB1iFaO.js";import{B as re}from"./badge-MgpyKS4G.js";import{S as ae,a as oe,b as ie,c as le,d as X,u as Nn}from"./select-CQylETYu.js";import{T as At}from"./textarea-CP7YhtqS.js";import{h as wn,R as Sn,u as Cn,F as _n,C as qt}from"./index-D9VO3YHf.js";import{R as kn,P as Mn,O as Dn,C as An}from"./index-oVYhaKSV.js";import"./dialog-tQJsUh4Y.js";import{S as En}from"./search-B5VVd6dg.js";import{C as Rn}from"./copy-DI2romvw.js";import{a as Pn,b as Fn,P as In,C as Tn}from"./CalendarGrid-BFIb4LJP.js";import{S as je,a as be,b as ye,c as Ne,d as ze}from"./sheet-UdWxF58G.js";import{I as On}from"./InlineBanner-QDunnMrJ.js";import{C as $n}from"./circle-alert-Bnmf6_fH.js";import{T as it}from"./trash-2-DxcT7Nwo.js";import{C as ls}from"./checkbox-BFPngTT6.js";import{S as cs}from"./separator-okv1NY9k.js";import{A as Ee,a as Re,b as Pe,c as Fe,d as Ie,e as Te,f as Oe,g as $e}from"./alert-dialog-BtscKph9.js";import{C as qn,a as Ln,b as zn}from"./collapsible-aCP1D4dl.js";import{P as he}from"./plus-CDQjg2oT.js";import{U as Kn,a as Gn}from"./user-plus-cpJt8uzw.js";import{C as ds}from"./chevron-down-CbOB1ZnN.js";import{c as us,R as Vn,I as Bn}from"./index-DqqFb_g2.js";import{u as Un}from"./index-COLZ1OS3.js";import{C as Hn}from"./chevron-left-C4ImbcEg.js";import{C as ms}from"./chevron-right-Dw6lkJno.js";import{C as ps}from"./clock-TTEhupg6.js";import{M as Et}from"./map-pin-qXD7UvM6.js";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qn=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 18h.01",key:"lrp35t"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M16 18h.01",key:"kzsmim"}]],jt=Le("calendar-days",Qn);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wn=[["path",{d:"m7 15 5 5 5-5",key:"1hf1tw"}],["path",{d:"m7 9 5-5 5 5",key:"sgt6xg"}]],Yn=Le("chevrons-up-down",Wn);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jn=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]],hs=Le("external-link",Jn);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xn=[["path",{d:"M2 9.5a5.5 5.5 0 0 1 9.591-3.676.56.56 0 0 0 .818 0A5.49 5.49 0 0 1 22 9.5c0 2.29-1.5 4-3 5.5l-5.492 5.313a2 2 0 0 1-3 .019L5 15c-1.5-1.5-3-3.2-3-5.5",key:"mvr1a0"}],["path",{d:"M3.22 13H9.5l.5-1 2 4.5 2-7 1.5 3.5h5.27",key:"auskq0"}]],Zn=Le("heart-pulse",Xn);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const er=[["path",{d:"m22 7-8.991 5.727a2 2 0 0 1-2.009 0L2 7",key:"132q7q"}],["rect",{x:"2",y:"4",width:"20",height:"16",rx:"2",key:"izxlao"}]],xs=Le("mail",er);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tr=[["path",{d:"M18 21a8 8 0 0 0-16 0",key:"3ypg7q"}],["circle",{cx:"10",cy:"8",r:"5",key:"o932ke"}],["path",{d:"M22 20c0-3.37-2-6.5-4-8a5 5 0 0 0-.45-8.3",key:"10s06x"}]],gs=Le("users-round",tr),xe=({title:t,description:n,onBack:s,actions:o})=>e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs(K,{variant:"ghost",size:"sm",className:"-ml-2",onClick:s,children:[e.jsx(tt,{className:"mr-2 h-4 w-4"}),"Retour"]}),e.jsx("h2",{className:"text-2xl font-display font-semibold uppercase italic text-primary",children:t}),n?e.jsx("p",{className:"text-sm text-muted-foreground",children:n}):null]}),o?e.jsx("div",{className:"flex items-center gap-2",children:o}):null]});function sr(t){if(t.length===0)return null;const n=t[0],s=n.effort,o=n.fatigue,a=n.performance,l=n.engagement,d=[];return s!=null&&d.push((11-s)/2),o!=null&&d.push((11-o)/2),a!=null&&d.push(a/2),l!=null&&d.push(l/2),d.length===0?null:Math.round(d.reduce((i,x)=>i+x,0)/d.length*10)/10}function nr(t){return t==null?{label:"—",className:"bg-muted text-muted-foreground"}:t>=3.5?{label:`${t.toFixed(1)}`,className:"bg-emerald-100 text-emerald-800 dark:bg-emerald-900/30 dark:text-emerald-400"}:t>=2.5?{label:`${t.toFixed(1)}`,className:"bg-amber-100 text-amber-800 dark:bg-amber-900/30 dark:text-amber-400"}:{label:`${t.toFixed(1)}`,className:"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400"}}function rr({athletes:t,athletesLoading:n,onBack:s,onOpenAthlete:o}){const[a,l]=r.useState(null),[d,i]=r.useState("name"),{data:x=[]}=W({queryKey:["recent-sessions-all",30],queryFn:()=>$.getRecentSessionsAllAthletes(30),enabled:t.length>0,staleTime:300*1e3}),{data:m}=W({queryKey:["objectives-counts-by-user"],queryFn:()=>$.getObjectivesCountsByUser(),enabled:t.length>0,staleTime:300*1e3}),u=r.useMemo(()=>{const h=new Map;return t.forEach(c=>{c.group_id&&c.group_label&&h.set(c.group_id,c.group_label)}),Array.from(h.entries()).map(([c,v])=>({id:c,name:v})).sort((c,v)=>c.name.localeCompare(v.name,"fr"))},[t]),p=r.useMemo(()=>{const h=new Map,c=new Map;for(const v of x){if(v.athlete_id==null)continue;const S=c.get(v.athlete_id)??[];S.push(v),c.set(v.athlete_id,S)}for(const v of t){if(v.id==null)continue;const S=c.get(v.id)??[],b=sr(S),y=S.length>0?S[0].session_date:null;h.set(v.id,{forme:b,lastSessionDate:y,sessionsCount30d:S.length,assiduity:null,objectivesTotal:m?.get(v.id)??0,objectivesAchieved:0})}return h},[t,x,m]),f=r.useMemo(()=>{let h=[...t];switch(a!=null&&(h=h.filter(c=>c.group_id===a)),d){case"forme":h.sort((c,v)=>{const S=c.id!=null?p.get(c.id)?.forme??99:99,b=v.id!=null?p.get(v.id)?.forme??99:99;return S-b});break;case"assiduity":h.sort((c,v)=>{const S=c.id!=null?p.get(c.id)?.sessionsCount30d??99:99,b=v.id!=null?p.get(v.id)?.sessionsCount30d??99:99;return S-b});break;default:h.sort((c,v)=>c.display_name.localeCompare(v.display_name,"fr"))}return h},[t,a,d,p]);return e.jsxs("div",{className:"space-y-4",children:[e.jsx(xe,{title:"Nageurs",description:n?"Chargement…":`${t.length} nageur${t.length!==1?"s":""}`,onBack:s}),u.length>1&&e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{type:"button",onClick:()=>l(null),className:`rounded-full px-3 py-1 text-xs font-medium border transition ${a==null?"bg-foreground text-background border-foreground":"bg-card text-foreground border-border hover:bg-muted"}`,children:"Tous"}),u.map(h=>e.jsx("button",{type:"button",onClick:()=>l(a===h.id?null:h.id),className:`rounded-full px-3 py-1 text-xs font-medium border transition ${a===h.id?"bg-foreground text-background border-foreground":"bg-card text-foreground border-border hover:bg-muted"}`,children:h.name},h.id))]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"Trier :"}),[{key:"name",label:"Nom"},{key:"forme",label:"Forme"},{key:"assiduity",label:"Activité"}].map(h=>e.jsx("button",{type:"button",onClick:()=>i(h.key),className:`rounded-full px-2.5 py-0.5 text-xs font-medium border transition ${d===h.key?"bg-primary/10 text-primary border-primary/30":"bg-card text-muted-foreground border-border hover:bg-muted"}`,children:h.label},h.key))]}),n?e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3",children:[1,2,3,4,5,6].map(h=>e.jsxs("div",{className:"rounded-2xl border bg-card p-4 animate-pulse motion-reduce:animate-none",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-muted"}),e.jsxs("div",{className:"space-y-1.5 flex-1",children:[e.jsx("div",{className:"h-4 w-24 rounded bg-muted"}),e.jsx("div",{className:"h-3 w-16 rounded bg-muted"})]})]}),e.jsxs("div",{className:"mt-3 space-y-2",children:[e.jsx("div",{className:"h-3 w-full rounded bg-muted"}),e.jsx("div",{className:"h-3 w-2/3 rounded bg-muted"})]})]},h))}):f.length===0?e.jsx("p",{className:"text-sm text-muted-foreground text-center py-8",children:a!=null?"Aucun nageur dans ce groupe.":"Aucun nageur disponible."}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3",children:f.map(h=>{const c=h.id!=null?p.get(h.id):null,v=nr(c?.forme??null);return e.jsxs("button",{type:"button",onClick:()=>o(h),className:"rounded-2xl border bg-card p-4 text-left hover:shadow-md hover:border-primary/20 transition-all",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[h.avatar_url?e.jsx("img",{src:h.avatar_url,alt:"",className:"h-10 w-10 rounded-full object-cover border border-border"}):e.jsx("div",{className:"h-10 w-10 rounded-full bg-primary/10 flex items-center justify-center text-sm font-bold text-primary",children:h.display_name.charAt(0).toUpperCase()}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-sm font-semibold truncate",children:h.display_name}),h.group_label&&e.jsx(re,{variant:"secondary",className:"text-[10px] px-1.5 py-0 mt-0.5",children:h.group_label})]})]}),e.jsxs("div",{className:"mt-3 grid grid-cols-3 gap-2",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-[10px] font-medium text-muted-foreground mb-1",children:"Forme"}),e.jsx("span",{className:`inline-block rounded-full px-2 py-0.5 text-xs font-semibold ${v.className}`,children:v.label})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-[10px] font-medium text-muted-foreground mb-1",children:"30j"}),e.jsx("span",{className:"text-sm font-bold text-foreground",children:c?.sessionsCount30d??0}),e.jsx("span",{className:"text-[10px] text-muted-foreground ml-0.5",children:"séances"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-[10px] font-medium text-muted-foreground mb-1",children:"Objectifs"}),e.jsx("span",{className:"text-sm font-bold text-foreground",children:c?.objectivesTotal??0})]})]}),c?.lastSessionDate&&e.jsxs("div",{className:"mt-2 text-[10px] text-muted-foreground",children:["Dernier ressenti : ",new Date(c.lastSessionDate).toLocaleDateString("fr-FR",{day:"numeric",month:"short"})]})]},h.id??h.display_name)})})]})}const ar=({onBack:t,athletes:n,groups:s,athletesLoading:o})=>{const{toast:a}=ue(),[l,d]=r.useState(""),[i,x]=r.useState(""),m=r.useMemo(()=>n.filter(c=>c.id&&c.email).map(c=>({value:`user:${c.id}`,label:c.group_label?`${c.display_name} · ${c.group_label}`:c.display_name,email:c.email})),[n]),u=r.useMemo(()=>s.map(c=>({value:`group:${c.id}`,label:c.name,id:c.id})),[s]),p=()=>{if(!i)return[];if(i.startsWith("user:")){const c=m.find(v=>v.value===i);return c?[c.email]:[]}if(i.startsWith("group:")){const c=Number(i.split(":")[1]);return n.filter(v=>v.group_id===c&&v.email).map(v=>v.email)}return[]},f=()=>{const c=p();if(!c.length){a({title:"Aucune adresse email",description:"Aucun nageur avec une adresse email dans cette sélection."});return}const v=new URLSearchParams;v.set("bcc",c.join(",")),l.trim()&&v.set("subject",l.trim()),window.location.href=`mailto:?${v.toString()}`},h=p();return e.jsxs("div",{className:"space-y-6 pb-24",children:[e.jsx(xe,{title:"Contacter par email",description:"Ouvre votre application mail avec les destinataires en CCI.",onBack:t}),e.jsxs(Ve,{className:"border-l-4 border-l-primary",children:[e.jsxs(Be,{children:[e.jsx(Ue,{children:"Destinataire"}),e.jsx(He,{children:"Sélectionnez un nageur ou un groupe."})]}),e.jsxs(Qe,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(Q,{children:"Destinataire"}),e.jsxs(ae,{value:i,onValueChange:x,children:[e.jsx(oe,{children:e.jsx(ie,{placeholder:o?"Chargement...":"Choisir un nageur ou un groupe"})}),e.jsxs(le,{children:[u.length?e.jsxs(e.Fragment,{children:[e.jsx(X,{value:"section-group",disabled:!0,children:"Groupes"}),u.map(c=>e.jsx(X,{value:c.value,children:c.label},c.value))]}):null,m.length?e.jsxs(e.Fragment,{children:[e.jsx(X,{value:"section-athlete",disabled:!0,children:"Nageurs"}),m.map(c=>e.jsx(X,{value:c.value,children:c.label},c.value))]}):null]})]})]}),i&&h.length>0?e.jsxs("p",{className:"text-xs text-muted-foreground",children:[h.length," adresse",h.length>1?"s":""," email",h.length>1?" (envoi en CCI)":""]}):null,i&&h.length===0?e.jsx("p",{className:"text-xs text-destructive",children:"Aucune adresse email disponible pour cette sélection."}):null]})]}),e.jsxs(Ve,{children:[e.jsxs(Be,{children:[e.jsx(Ue,{children:"Objet"}),e.jsx(He,{children:"Optionnel — pré-rempli dans votre application mail."})]}),e.jsx(Qe,{children:e.jsx(pe,{value:l,onChange:c=>d(c.target.value),placeholder:"Objet du mail…"})})]}),e.jsx("div",{className:"sticky bottom-0 z-10 -mx-4 border-t bg-background/95 p-4 backdrop-blur sm:static sm:mx-0 sm:border-0 sm:p-0",children:e.jsxs(K,{className:"w-full sm:w-auto",onClick:f,disabled:!i||h.length===0,children:[e.jsx(xs,{className:"mr-2 h-4 w-4"}),"Ouvrir dans l'app mail",e.jsx(hs,{className:"ml-2 h-3 w-3"})]})})]})};function Ge(t,n,{checkForDefaultPrevented:s=!0}={}){return function(a){if(t?.(a),s===!1||!a.defaultPrevented)return n?.(a)}}function or(t){const n=ir(t),s=r.forwardRef((o,a)=>{const{children:l,...d}=o,i=r.Children.toArray(l),x=i.find(cr);if(x){const m=x.props.children,u=i.map(p=>p===x?r.Children.count(m)>1?r.Children.only(null):r.isValidElement(m)?m.props.children:null:p);return e.jsx(n,{...d,ref:a,children:r.isValidElement(m)?r.cloneElement(m,void 0,u):null})}return e.jsx(n,{...d,ref:a,children:l})});return s.displayName=`${t}.Slot`,s}function ir(t){const n=r.forwardRef((s,o)=>{const{children:a,...l}=s;if(r.isValidElement(a)){const d=ur(a),i=dr(l,a.props);return a.type!==r.Fragment&&(i.ref=o?Ae(o,d):d),r.cloneElement(a,i)}return r.Children.count(a)>1?r.Children.only(null):null});return n.displayName=`${t}.SlotClone`,n}var lr=Symbol("radix.slottable");function cr(t){return r.isValidElement(t)&&typeof t.type=="function"&&"__radixId"in t.type&&t.type.__radixId===lr}function dr(t,n){const s={...n};for(const o in n){const a=t[o],l=n[o];/^on[A-Z]/.test(o)?a&&l?s[o]=(...i)=>{const x=l(...i);return a(...i),x}:a&&(s[o]=a):o==="style"?s[o]={...a,...l}:o==="className"&&(s[o]=[a,l].filter(Boolean).join(" "))}return{...t,...s}}function ur(t){let n=Object.getOwnPropertyDescriptor(t.props,"ref")?.get,s=n&&"isReactWarning"in n&&n.isReactWarning;return s?t.ref:(n=Object.getOwnPropertyDescriptor(t,"ref")?.get,s=n&&"isReactWarning"in n&&n.isReactWarning,s?t.props.ref:t.props.ref||t.ref)}var mr=rs[" useInsertionEffect ".trim().toString()]||Jt;function pr({prop:t,defaultProp:n,onChange:s=()=>{},caller:o}){const[a,l,d]=hr({defaultProp:n,onChange:s}),i=t!==void 0,x=i?t:a;{const u=r.useRef(t!==void 0);r.useEffect(()=>{const p=u.current;p!==i&&console.warn(`${o} is changing from ${p?"controlled":"uncontrolled"} to ${i?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),u.current=i},[i,o])}const m=r.useCallback(u=>{if(i){const p=xr(u)?u(t):u;p!==t&&d.current?.(p)}else l(u)},[i,t,l,d]);return[x,m]}function hr({defaultProp:t,onChange:n}){const[s,o]=r.useState(t),a=r.useRef(s),l=r.useRef(n);return mr(()=>{l.current=n},[n]),r.useEffect(()=>{a.current!==s&&(l.current?.(s),a.current=s)},[s,a]),[s,o,l]}function xr(t){return typeof t=="function"}var lt="Popover",[fs]=kt(lt,[Xt]),Je=Xt(),[gr,we]=fs(lt),vs=t=>{const{__scopePopover:n,children:s,open:o,defaultOpen:a,onOpenChange:l,modal:d=!1}=t,i=Je(n),x=r.useRef(null),[m,u]=r.useState(!1),[p,f]=pr({prop:o,defaultProp:a??!1,onChange:l,caller:lt});return e.jsx(un,{...i,children:e.jsx(gr,{scope:n,contentId:Se(),triggerRef:x,open:p,onOpenChange:f,onOpenToggle:r.useCallback(()=>f(h=>!h),[f]),hasCustomAnchor:m,onCustomAnchorAdd:r.useCallback(()=>u(!0),[]),onCustomAnchorRemove:r.useCallback(()=>u(!1),[]),modal:d,children:s})})};vs.displayName=lt;var js="PopoverAnchor",fr=r.forwardRef((t,n)=>{const{__scopePopover:s,...o}=t,a=we(js,s),l=Je(s),{onCustomAnchorAdd:d,onCustomAnchorRemove:i}=a;return r.useEffect(()=>(d(),()=>i()),[d,i]),e.jsx(Zt,{...l,...o,ref:n})});fr.displayName=js;var bs="PopoverTrigger",ys=r.forwardRef((t,n)=>{const{__scopePopover:s,...o}=t,a=we(bs,s),l=Je(s),d=Ye(n,a.triggerRef),i=e.jsx(ce.button,{type:"button","aria-haspopup":"dialog","aria-expanded":a.open,"aria-controls":a.contentId,"data-state":_s(a.open),...o,ref:d,onClick:Ge(t.onClick,a.onOpenToggle)});return a.hasCustomAnchor?i:e.jsx(Zt,{asChild:!0,...l,children:i})});ys.displayName=bs;var Rt="PopoverPortal",[vr,jr]=fs(Rt,{forceMount:void 0}),Ns=t=>{const{__scopePopover:n,forceMount:s,children:o,container:a}=t,l=we(Rt,n);return e.jsx(vr,{scope:n,forceMount:s,children:e.jsx(Mt,{present:s||l.open,children:e.jsx(mn,{asChild:!0,container:a,children:o})})})};Ns.displayName=Rt;var qe="PopoverContent",ws=r.forwardRef((t,n)=>{const s=jr(qe,t.__scopePopover),{forceMount:o=s.forceMount,...a}=t,l=we(qe,t.__scopePopover);return e.jsx(Mt,{present:o||l.open,children:l.modal?e.jsx(yr,{...a,ref:n}):e.jsx(Nr,{...a,ref:n})})});ws.displayName=qe;var br=or("PopoverContent.RemoveScroll"),yr=r.forwardRef((t,n)=>{const s=we(qe,t.__scopePopover),o=r.useRef(null),a=Ye(n,o),l=r.useRef(!1);return r.useEffect(()=>{const d=o.current;if(d)return wn(d)},[]),e.jsx(Sn,{as:br,allowPinchZoom:!0,children:e.jsx(Ss,{...t,ref:a,trapFocus:s.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:Ge(t.onCloseAutoFocus,d=>{d.preventDefault(),l.current||s.triggerRef.current?.focus()}),onPointerDownOutside:Ge(t.onPointerDownOutside,d=>{const i=d.detail.originalEvent,x=i.button===0&&i.ctrlKey===!0,m=i.button===2||x;l.current=m},{checkForDefaultPrevented:!1}),onFocusOutside:Ge(t.onFocusOutside,d=>d.preventDefault(),{checkForDefaultPrevented:!1})})})}),Nr=r.forwardRef((t,n)=>{const s=we(qe,t.__scopePopover),o=r.useRef(!1),a=r.useRef(!1);return e.jsx(Ss,{...t,ref:n,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:l=>{t.onCloseAutoFocus?.(l),l.defaultPrevented||(o.current||s.triggerRef.current?.focus(),l.preventDefault()),o.current=!1,a.current=!1},onInteractOutside:l=>{t.onInteractOutside?.(l),l.defaultPrevented||(o.current=!0,l.detail.originalEvent.type==="pointerdown"&&(a.current=!0));const d=l.target;s.triggerRef.current?.contains(d)&&l.preventDefault(),l.detail.originalEvent.type==="focusin"&&a.current&&l.preventDefault()}})}),Ss=r.forwardRef((t,n)=>{const{__scopePopover:s,trapFocus:o,onOpenAutoFocus:a,onCloseAutoFocus:l,disableOutsidePointerEvents:d,onEscapeKeyDown:i,onPointerDownOutside:x,onFocusOutside:m,onInteractOutside:u,...p}=t,f=we(qe,s),h=Je(s);return Cn(),e.jsx(_n,{asChild:!0,loop:!0,trapped:o,onMountAutoFocus:a,onUnmountAutoFocus:l,children:e.jsx(pn,{asChild:!0,disableOutsidePointerEvents:d,onInteractOutside:u,onEscapeKeyDown:i,onPointerDownOutside:x,onFocusOutside:m,onDismiss:()=>f.onOpenChange(!1),children:e.jsx(hn,{"data-state":_s(f.open),role:"dialog",id:f.contentId,...h,...p,ref:n,style:{...p.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}})})})}),Cs="PopoverClose",wr=r.forwardRef((t,n)=>{const{__scopePopover:s,...o}=t,a=we(Cs,s);return e.jsx(ce.button,{type:"button",...o,ref:n,onClick:Ge(t.onClick,()=>a.onOpenChange(!1))})});wr.displayName=Cs;var Sr="PopoverArrow",Cr=r.forwardRef((t,n)=>{const{__scopePopover:s,...o}=t,a=Je(s);return e.jsx(xn,{...a,...o,ref:n})});Cr.displayName=Sr;function _s(t){return t?"open":"closed"}var _r=vs,kr=ys,Mr=Ns,ks=ws;const Dr=_r,Ar=kr,Ms=r.forwardRef(({className:t,align:n="center",sideOffset:s=4,...o},a)=>e.jsx(Mr,{children:e.jsx(ks,{ref:a,align:n,sideOffset:s,className:ne("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-popover-content-transform-origin]",t),...o})}));Ms.displayName=ks.displayName;var Lt=1,Er=.9,Rr=.8,Pr=.17,ut=.1,mt=.999,Fr=.9999,Ir=.99,Tr=/[\\\/_+.#"@\[\(\{&]/,Or=/[\\\/_+.#"@\[\(\{&]/g,$r=/[\s-]/,Ds=/[\s-]/g;function bt(t,n,s,o,a,l,d){if(l===n.length)return a===t.length?Lt:Ir;var i=`${a},${l}`;if(d[i]!==void 0)return d[i];for(var x=o.charAt(l),m=s.indexOf(x,a),u=0,p,f,h,c;m>=0;)p=bt(t,n,s,o,m+1,l+1,d),p>u&&(m===a?p*=Lt:Tr.test(t.charAt(m-1))?(p*=Rr,h=t.slice(a,m-1).match(Or),h&&a>0&&(p*=Math.pow(mt,h.length))):$r.test(t.charAt(m-1))?(p*=Er,c=t.slice(a,m-1).match(Ds),c&&a>0&&(p*=Math.pow(mt,c.length))):(p*=Pr,a>0&&(p*=Math.pow(mt,m-a))),t.charAt(m)!==n.charAt(l)&&(p*=Fr)),(p<ut&&s.charAt(m-1)===o.charAt(l+1)||o.charAt(l+1)===o.charAt(l)&&s.charAt(m-1)!==o.charAt(l))&&(f=bt(t,n,s,o,m+1,l+2,d),f*ut>p&&(p=f*ut)),p>u&&(u=p),m=s.indexOf(x,m+1);return d[i]=u,u}function zt(t){return t.toLowerCase().replace(Ds," ")}function qr(t,n,s){return t=s&&s.length>0?`${t+" "+s.join(" ")}`:t,bt(t,n,zt(t),zt(n),0,0,{})}var Ke='[cmdk-group=""]',pt='[cmdk-group-items=""]',Lr='[cmdk-group-heading=""]',As='[cmdk-item=""]',Kt=`${As}:not([aria-disabled="true"])`,yt="cmdk-item-select",Me="data-value",zr=(t,n,s)=>qr(t,n,s),Es=r.createContext(void 0),Xe=()=>r.useContext(Es),Rs=r.createContext(void 0),Pt=()=>r.useContext(Rs),Ps=r.createContext(void 0),Fs=r.forwardRef((t,n)=>{let s=De(()=>{var j,R;return{search:"",value:(R=(j=t.value)!=null?j:t.defaultValue)!=null?R:"",selectedItemId:void 0,filtered:{count:0,items:new Map,groups:new Set}}}),o=De(()=>new Set),a=De(()=>new Map),l=De(()=>new Map),d=De(()=>new Set),i=Is(t),{label:x,children:m,value:u,onValueChange:p,filter:f,shouldFilter:h,loop:c,disablePointerSelection:v=!1,vimBindings:S=!0,...b}=t,y=Se(),F=Se(),G=Se(),I=r.useRef(null),k=Xr();Ce(()=>{if(u!==void 0){let j=u.trim();s.current.value=j,E.emit()}},[u]),Ce(()=>{k(6,z)},[]);let E=r.useMemo(()=>({subscribe:j=>(d.current.add(j),()=>d.current.delete(j)),snapshot:()=>s.current,setState:(j,R,_)=>{var M,V,H,te;if(!Object.is(s.current[j],R)){if(s.current[j]=R,j==="search")B(),T(),k(1,q);else if(j==="value"){if(document.activeElement.hasAttribute("cmdk-input")||document.activeElement.hasAttribute("cmdk-root")){let se=document.getElementById(G);se?se.focus():(M=document.getElementById(y))==null||M.focus()}if(k(7,()=>{var se;s.current.selectedItemId=(se=w())==null?void 0:se.id,E.emit()}),_||k(5,z),((V=i.current)==null?void 0:V.value)!==void 0){let se=R??"";(te=(H=i.current).onValueChange)==null||te.call(H,se);return}}E.emit()}},emit:()=>{d.current.forEach(j=>j())}}),[]),A=r.useMemo(()=>({value:(j,R,_)=>{var M;R!==((M=l.current.get(j))==null?void 0:M.value)&&(l.current.set(j,{value:R,keywords:_}),s.current.filtered.items.set(j,N(R,_)),k(2,()=>{T(),E.emit()}))},item:(j,R)=>(o.current.add(j),R&&(a.current.has(R)?a.current.get(R).add(j):a.current.set(R,new Set([j]))),k(3,()=>{B(),T(),s.current.value||q(),E.emit()}),()=>{l.current.delete(j),o.current.delete(j),s.current.filtered.items.delete(j);let _=w();k(4,()=>{B(),_?.getAttribute("id")===j&&q(),E.emit()})}),group:j=>(a.current.has(j)||a.current.set(j,new Set),()=>{l.current.delete(j),a.current.delete(j)}),filter:()=>i.current.shouldFilter,label:x||t["aria-label"],getDisablePointerSelection:()=>i.current.disablePointerSelection,listId:y,inputId:G,labelId:F,listInnerRef:I}),[]);function N(j,R){var _,M;let V=(M=(_=i.current)==null?void 0:_.filter)!=null?M:zr;return j?V(j,s.current.search,R):0}function T(){if(!s.current.search||i.current.shouldFilter===!1)return;let j=s.current.filtered.items,R=[];s.current.filtered.groups.forEach(M=>{let V=a.current.get(M),H=0;V.forEach(te=>{let se=j.get(te);H=Math.max(se,H)}),R.push([M,H])});let _=I.current;g().sort((M,V)=>{var H,te;let se=M.getAttribute("id"),_e=V.getAttribute("id");return((H=j.get(_e))!=null?H:0)-((te=j.get(se))!=null?te:0)}).forEach(M=>{let V=M.closest(pt);V?V.appendChild(M.parentElement===V?M:M.closest(`${pt} > *`)):_.appendChild(M.parentElement===_?M:M.closest(`${pt} > *`))}),R.sort((M,V)=>V[1]-M[1]).forEach(M=>{var V;let H=(V=I.current)==null?void 0:V.querySelector(`${Ke}[${Me}="${encodeURIComponent(M[0])}"]`);H?.parentElement.appendChild(H)})}function q(){let j=g().find(_=>_.getAttribute("aria-disabled")!=="true"),R=j?.getAttribute(Me);E.setState("value",R||void 0)}function B(){var j,R,_,M;if(!s.current.search||i.current.shouldFilter===!1){s.current.filtered.count=o.current.size;return}s.current.filtered.groups=new Set;let V=0;for(let H of o.current){let te=(R=(j=l.current.get(H))==null?void 0:j.value)!=null?R:"",se=(M=(_=l.current.get(H))==null?void 0:_.keywords)!=null?M:[],_e=N(te,se);s.current.filtered.items.set(H,_e),_e>0&&V++}for(let[H,te]of a.current)for(let se of te)if(s.current.filtered.items.get(se)>0){s.current.filtered.groups.add(H);break}s.current.filtered.count=V}function z(){var j,R,_;let M=w();M&&(((j=M.parentElement)==null?void 0:j.firstChild)===M&&((_=(R=M.closest(Ke))==null?void 0:R.querySelector(Lr))==null||_.scrollIntoView({block:"nearest"})),M.scrollIntoView({block:"nearest"}))}function w(){var j;return(j=I.current)==null?void 0:j.querySelector(`${As}[aria-selected="true"]`)}function g(){var j;return Array.from(((j=I.current)==null?void 0:j.querySelectorAll(Kt))||[])}function C(j){let R=g()[j];R&&E.setState("value",R.getAttribute(Me))}function L(j){var R;let _=w(),M=g(),V=M.findIndex(te=>te===_),H=M[V+j];(R=i.current)!=null&&R.loop&&(H=V+j<0?M[M.length-1]:V+j===M.length?M[0]:M[V+j]),H&&E.setState("value",H.getAttribute(Me))}function U(j){let R=w(),_=R?.closest(Ke),M;for(;_&&!M;)_=j>0?Yr(_,Ke):Jr(_,Ke),M=_?.querySelector(Kt);M?E.setState("value",M.getAttribute(Me)):L(j)}let Z=()=>C(g().length-1),P=j=>{j.preventDefault(),j.metaKey?Z():j.altKey?U(1):L(1)},J=j=>{j.preventDefault(),j.metaKey?C(0):j.altKey?U(-1):L(-1)};return r.createElement(ce.div,{ref:n,tabIndex:-1,...b,"cmdk-root":"",onKeyDown:j=>{var R;(R=b.onKeyDown)==null||R.call(b,j);let _=j.nativeEvent.isComposing||j.keyCode===229;if(!(j.defaultPrevented||_))switch(j.key){case"n":case"j":{S&&j.ctrlKey&&P(j);break}case"ArrowDown":{P(j);break}case"p":case"k":{S&&j.ctrlKey&&J(j);break}case"ArrowUp":{J(j);break}case"Home":{j.preventDefault(),C(0);break}case"End":{j.preventDefault(),Z();break}case"Enter":{j.preventDefault();let M=w();if(M){let V=new Event(yt);M.dispatchEvent(V)}}}}},r.createElement("label",{"cmdk-label":"",htmlFor:A.inputId,id:A.labelId,style:ea},x),ct(t,j=>r.createElement(Rs.Provider,{value:E},r.createElement(Es.Provider,{value:A},j))))}),Kr=r.forwardRef((t,n)=>{var s,o;let a=Se(),l=r.useRef(null),d=r.useContext(Ps),i=Xe(),x=Is(t),m=(o=(s=x.current)==null?void 0:s.forceMount)!=null?o:d?.forceMount;Ce(()=>{if(!m)return i.item(a,d?.id)},[m]);let u=Ts(a,l,[t.value,t.children,l],t.keywords),p=Pt(),f=fe(k=>k.value&&k.value===u.current),h=fe(k=>m||i.filter()===!1?!0:k.search?k.filtered.items.get(a)>0:!0);r.useEffect(()=>{let k=l.current;if(!(!k||t.disabled))return k.addEventListener(yt,c),()=>k.removeEventListener(yt,c)},[h,t.onSelect,t.disabled]);function c(){var k,E;v(),(E=(k=x.current).onSelect)==null||E.call(k,u.current)}function v(){p.setState("value",u.current,!0)}if(!h)return null;let{disabled:S,value:b,onSelect:y,forceMount:F,keywords:G,...I}=t;return r.createElement(ce.div,{ref:Ae(l,n),...I,id:a,"cmdk-item":"",role:"option","aria-disabled":!!S,"aria-selected":!!f,"data-disabled":!!S,"data-selected":!!f,onPointerMove:S||i.getDisablePointerSelection()?void 0:v,onClick:S?void 0:c},t.children)}),Gr=r.forwardRef((t,n)=>{let{heading:s,children:o,forceMount:a,...l}=t,d=Se(),i=r.useRef(null),x=r.useRef(null),m=Se(),u=Xe(),p=fe(h=>a||u.filter()===!1?!0:h.search?h.filtered.groups.has(d):!0);Ce(()=>u.group(d),[]),Ts(d,i,[t.value,t.heading,x]);let f=r.useMemo(()=>({id:d,forceMount:a}),[a]);return r.createElement(ce.div,{ref:Ae(i,n),...l,"cmdk-group":"",role:"presentation",hidden:p?void 0:!0},s&&r.createElement("div",{ref:x,"cmdk-group-heading":"","aria-hidden":!0,id:m},s),ct(t,h=>r.createElement("div",{"cmdk-group-items":"",role:"group","aria-labelledby":s?m:void 0},r.createElement(Ps.Provider,{value:f},h))))}),Vr=r.forwardRef((t,n)=>{let{alwaysRender:s,...o}=t,a=r.useRef(null),l=fe(d=>!d.search);return!s&&!l?null:r.createElement(ce.div,{ref:Ae(a,n),...o,"cmdk-separator":"",role:"separator"})}),Br=r.forwardRef((t,n)=>{let{onValueChange:s,...o}=t,a=t.value!=null,l=Pt(),d=fe(m=>m.search),i=fe(m=>m.selectedItemId),x=Xe();return r.useEffect(()=>{t.value!=null&&l.setState("search",t.value)},[t.value]),r.createElement(ce.input,{ref:n,...o,"cmdk-input":"",autoComplete:"off",autoCorrect:"off",spellCheck:!1,"aria-autocomplete":"list",role:"combobox","aria-expanded":!0,"aria-controls":x.listId,"aria-labelledby":x.labelId,"aria-activedescendant":i,id:x.inputId,type:"text",value:a?t.value:d,onChange:m=>{a||l.setState("search",m.target.value),s?.(m.target.value)}})}),Ur=r.forwardRef((t,n)=>{let{children:s,label:o="Suggestions",...a}=t,l=r.useRef(null),d=r.useRef(null),i=fe(m=>m.selectedItemId),x=Xe();return r.useEffect(()=>{if(d.current&&l.current){let m=d.current,u=l.current,p,f=new ResizeObserver(()=>{p=requestAnimationFrame(()=>{let h=m.offsetHeight;u.style.setProperty("--cmdk-list-height",h.toFixed(1)+"px")})});return f.observe(m),()=>{cancelAnimationFrame(p),f.unobserve(m)}}},[]),r.createElement(ce.div,{ref:Ae(l,n),...a,"cmdk-list":"",role:"listbox",tabIndex:-1,"aria-activedescendant":i,"aria-label":o,id:x.listId},ct(t,m=>r.createElement("div",{ref:Ae(d,x.listInnerRef),"cmdk-list-sizer":""},m)))}),Hr=r.forwardRef((t,n)=>{let{open:s,onOpenChange:o,overlayClassName:a,contentClassName:l,container:d,...i}=t;return r.createElement(kn,{open:s,onOpenChange:o},r.createElement(Mn,{container:d},r.createElement(Dn,{"cmdk-overlay":"",className:a}),r.createElement(An,{"aria-label":t.label,"cmdk-dialog":"",className:l},r.createElement(Fs,{ref:n,...i}))))}),Qr=r.forwardRef((t,n)=>fe(s=>s.filtered.count===0)?r.createElement(ce.div,{ref:n,...t,"cmdk-empty":"",role:"presentation"}):null),Wr=r.forwardRef((t,n)=>{let{progress:s,children:o,label:a="Loading...",...l}=t;return r.createElement(ce.div,{ref:n,...l,"cmdk-loading":"",role:"progressbar","aria-valuenow":s,"aria-valuemin":0,"aria-valuemax":100,"aria-label":a},ct(t,d=>r.createElement("div",{"aria-hidden":!0},d)))}),de=Object.assign(Fs,{List:Ur,Item:Kr,Input:Br,Group:Gr,Separator:Vr,Dialog:Hr,Empty:Qr,Loading:Wr});function Yr(t,n){let s=t.nextElementSibling;for(;s;){if(s.matches(n))return s;s=s.nextElementSibling}}function Jr(t,n){let s=t.previousElementSibling;for(;s;){if(s.matches(n))return s;s=s.previousElementSibling}}function Is(t){let n=r.useRef(t);return Ce(()=>{n.current=t}),n}var Ce=typeof window>"u"?r.useEffect:r.useLayoutEffect;function De(t){let n=r.useRef();return n.current===void 0&&(n.current=t()),n}function fe(t){let n=Pt(),s=()=>t(n.snapshot());return r.useSyncExternalStore(n.subscribe,s,s)}function Ts(t,n,s,o=[]){let a=r.useRef(),l=Xe();return Ce(()=>{var d;let i=(()=>{var m;for(let u of s){if(typeof u=="string")return u.trim();if(typeof u=="object"&&"current"in u)return u.current?(m=u.current.textContent)==null?void 0:m.trim():a.current}})(),x=o.map(m=>m.trim());l.value(t,i,x),(d=n.current)==null||d.setAttribute(Me,i),a.current=i}),a}var Xr=()=>{let[t,n]=r.useState(),s=De(()=>new Map);return Ce(()=>{s.current.forEach(o=>o()),s.current=new Map},[t]),(o,a)=>{s.current.set(o,a),n({})}};function Zr(t){let n=t.type;return typeof n=="function"?n(t.props):"render"in n?n.render(t.props):t}function ct({asChild:t,children:n},s){return t&&r.isValidElement(n)?r.cloneElement(Zr(n),{ref:n.ref},s(n.props.children)):s(n)}var ea={position:"absolute",width:"1px",height:"1px",padding:"0",margin:"-1px",overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",borderWidth:"0"};const Os=r.forwardRef(({className:t,...n},s)=>e.jsx(de,{ref:s,className:ne("flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground",t),...n}));Os.displayName=de.displayName;const $s=r.forwardRef(({className:t,...n},s)=>e.jsxs("div",{className:"flex items-center border-b px-3","cmdk-input-wrapper":"",children:[e.jsx(En,{className:"mr-2 h-4 w-4 shrink-0 opacity-50"}),e.jsx(de.Input,{ref:s,className:ne("flex h-10 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50",t),...n})]}));$s.displayName=de.Input.displayName;const qs=r.forwardRef(({className:t,...n},s)=>e.jsx(de.List,{ref:s,className:ne("max-h-[300px] overflow-y-auto overflow-x-hidden",t),...n}));qs.displayName=de.List.displayName;const Ls=r.forwardRef((t,n)=>e.jsx(de.Empty,{ref:n,className:"py-6 text-center text-sm",...t}));Ls.displayName=de.Empty.displayName;const Nt=r.forwardRef(({className:t,...n},s)=>e.jsx(de.Group,{ref:s,className:ne("overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground",t),...n}));Nt.displayName=de.Group.displayName;const ta=r.forwardRef(({className:t,...n},s)=>e.jsx(de.Separator,{ref:s,className:ne("-mx-1 h-px bg-border",t),...n}));ta.displayName=de.Separator.displayName;const wt=r.forwardRef(({className:t,...n},s)=>e.jsx(de.Item,{ref:s,className:ne("relative flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected=true]:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",t),...n}));wt.displayName=de.Item.displayName;const sa=({onBack:t,athletes:n,groups:s,athletesLoading:o})=>{const{toast:a}=ue(),[l,d]=r.useState(""),[i,x]=r.useState(new Set),[m,u]=r.useState(new Set),[p,f]=r.useState(!1),{data:h}=W({queryKey:["athlete-phones"],queryFn:async()=>{const{data:N}=await es.from("user_profiles").select("user_id, phone").not("phone","is",null);return new Map((N??[]).map(T=>[T.user_id,T.phone]))}}),c=r.useMemo(()=>n.filter(N=>N.id!=null).map(N=>({id:N.id,display_name:N.display_name,group_id:N.group_id??null,group_label:N.group_label??null})),[n]),v=N=>{x(T=>{const q=new Set(T);return q.has(N)?q.delete(N):q.add(N),q})},S=N=>{u(T=>{const q=new Set(T);return q.has(N)?q.delete(N):q.add(N),q})},b=()=>{x(new Set),u(new Set)},{selectedPhones:y,selectedTotal:F,missingCount:G}=r.useMemo(()=>{if(!h)return{selectedPhones:[],selectedTotal:0,missingCount:0};const N=new Set;for(const B of i)for(const z of c)z.group_id===B&&N.add(z.id);for(const B of m)N.add(B);const T=N.size,q=[];for(const B of N){const z=h.get(B);z&&z.trim().length>0&&q.push(z)}return{selectedPhones:q,selectedTotal:T,missingCount:T-q.length}},[i,m,c,h]),I=i.size+m.size,k=r.useMemo(()=>{const N=[];return i.size>0&&N.push(`${i.size} groupe${i.size>1?"s":""}`),m.size>0&&N.push(`${m.size} nageur${m.size>1?"s":""}`),N.join(", ")},[i.size,m.size]),E=()=>{if(y.length===0){a({title:"Aucun numéro",description:"Aucun nageur avec un numéro de téléphone dans cette sélection.",variant:"destructive"});return}if(/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)){const T=l.trim()?encodeURIComponent(l.trim()):"",q=/iPhone|iPad|iPod/i.test(navigator.userAgent);let B;if(q){const z=y.join(",");B=T?`sms:/open?addresses=${z}&body=${T}`:`sms:/open?addresses=${z}`}else B=T?`sms:${y.join(",")}?body=${T}`:`sms:${y.join(",")}`;window.location.href=B}else navigator.clipboard.writeText(y.join(", ")).then(()=>{a({title:"Numéros copiés",description:`${y.length} numéro${y.length>1?"s":""} copié${y.length>1?"s":""} dans le presse-papiers.`})}).catch(()=>{a({title:"Erreur",description:"Impossible de copier les numéros.",variant:"destructive"})})},A=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent);return e.jsxs("div",{className:"space-y-6 pb-24",children:[e.jsx(xe,{title:"Envoyer un SMS",description:"Ouvre votre application SMS ou copie les numéros.",onBack:t}),e.jsxs(Ve,{className:"border-l-4 border-l-primary",children:[e.jsxs(Be,{children:[e.jsx(Ue,{children:"Destinataires"}),e.jsx(He,{children:"Sélectionnez des groupes et/ou des nageurs."})]}),e.jsxs(Qe,{className:"space-y-3",children:[e.jsx(Q,{children:"Destinataires"}),e.jsxs(Dr,{open:p,onOpenChange:f,children:[e.jsx(Ar,{asChild:!0,children:e.jsxs(K,{variant:"outline",role:"combobox","aria-expanded":p,className:"w-full justify-between font-normal",children:[e.jsx("span",{className:"truncate",children:I>0?k:o?"Chargement...":"Choisir des destinataires"}),e.jsx(Yn,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),e.jsx(Ms,{className:"w-[var(--radix-popover-trigger-width)] p-0",align:"start",children:e.jsxs(Os,{children:[e.jsx($s,{placeholder:"Rechercher..."}),e.jsxs(qs,{children:[e.jsx(Ls,{children:"Aucun résultat."}),s.length>0&&e.jsx(Nt,{heading:"Groupes",children:s.map(N=>e.jsxs(wt,{value:`groupe ${N.name}`,onSelect:()=>v(N.id),children:[e.jsx(qt,{className:ne("mr-2 h-4 w-4",i.has(N.id)?"opacity-100":"opacity-0")}),N.name]},`group:${N.id}`))}),c.length>0&&e.jsx(Nt,{heading:"Nageurs",children:c.map(N=>e.jsxs(wt,{value:`nageur ${N.display_name} ${N.group_label??""}`,onSelect:()=>S(N.id),children:[e.jsx(qt,{className:ne("mr-2 h-4 w-4",m.has(N.id)?"opacity-100":"opacity-0")}),e.jsx("span",{className:"truncate",children:N.display_name}),N.group_label&&e.jsx("span",{className:"ml-auto text-xs text-muted-foreground",children:N.group_label})]},`user:${N.id}`))})]})]})})]}),I>0&&e.jsxs("div",{className:"flex flex-wrap items-center gap-1.5",children:[[...i].map(N=>{const T=s.find(q=>q.id===N);return T?e.jsxs(re,{variant:"secondary",className:"gap-1 pr-1",children:[T.name,e.jsx("button",{type:"button",onClick:()=>v(N),className:"ml-0.5 rounded-full p-0.5 hover:bg-muted",children:e.jsx(It,{className:"h-3 w-3"})})]},`g:${N}`):null}),[...m].map(N=>{const T=c.find(q=>q.id===N);return T?e.jsxs(re,{variant:"outline",className:"gap-1 pr-1",children:[T.display_name,e.jsx("button",{type:"button",onClick:()=>S(N),className:"ml-0.5 rounded-full p-0.5 hover:bg-muted",children:e.jsx(It,{className:"h-3 w-3"})})]},`u:${N}`):null}),I>1&&e.jsx("button",{type:"button",onClick:b,className:"text-xs text-muted-foreground underline hover:text-foreground",children:"Tout effacer"})]}),I>0&&y.length>0&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:[y.length," numéro",y.length>1?"s":""," trouvé",y.length>1?"s":"",G>0&&e.jsxs("span",{className:"text-destructive",children:[" · ",G," sans téléphone"]})]}),I>0&&y.length===0&&e.jsx("p",{className:"text-xs text-destructive",children:"Aucun numéro de téléphone disponible pour cette sélection."})]})]}),e.jsxs(Ve,{children:[e.jsxs(Be,{children:[e.jsx(Ue,{children:"Message"}),e.jsx(He,{children:"Optionnel — pré-rempli dans votre application SMS."})]}),e.jsx(Qe,{children:e.jsx(At,{value:l,onChange:N=>d(N.target.value),placeholder:"Contenu du SMS…",rows:3})})]}),e.jsx("div",{className:"sticky bottom-0 z-10 -mx-4 border-t bg-background/95 p-4 backdrop-blur sm:static sm:mx-0 sm:border-0 sm:p-0",children:e.jsx(K,{className:"w-full sm:w-auto",onClick:E,disabled:I===0||y.length===0,children:A?e.jsxs(e.Fragment,{children:[e.jsx(as,{className:"mr-2 h-4 w-4"}),"Ouvrir dans l'app SMS",e.jsx(hs,{className:"ml-2 h-3 w-3"})]}):e.jsxs(e.Fragment,{children:[e.jsx(Rn,{className:"mr-2 h-4 w-4"}),"Copier les numéros"]})})})]})};function Gt(t){return String(t).padStart(2,"0")}function ke(t){return`${t.getFullYear()}-${Gt(t.getMonth()+1)}-${Gt(t.getDate())}`}function ht(t){return new Date(t.getFullYear(),t.getMonth(),1)}function Vt(t,n){const s=new Date(t);return s.setDate(s.getDate()+n),s}function na(t){return(t.getDay()+6)%7}function xt(t){if(!t)return"AM";const n=t.toLowerCase();return n==="evening"||n.includes("soir")||n==="pm"?"PM":"AM"}const ra=[{key:"swim-morning",label:"Nage — Matin",type:"swim",scheduledSlot:"morning"},{key:"swim-evening",label:"Nage — Soir",type:"swim",scheduledSlot:"evening"},{key:"strength",label:"Musculation",type:"strength",scheduledSlot:null}];function aa({groupId:t,userId:n,enabled:s}){const o=r.useMemo(()=>new Date,[]),[a,l]=r.useState(()=>ht(new Date)),[d,i]=r.useState(()=>ke(new Date)),[x,m]=r.useState(null),[u,p]=r.useState(!1),f=r.useMemo(()=>ht(a),[a]),h=r.useMemo(()=>{const g=na(f),C=Vt(f,-g),L=[];for(let U=0;U<42;U++)L.push(Vt(C,U));return L},[f]),c=r.useMemo(()=>{const g=ke(h[0]),C=ke(h[h.length-1]);return{from:g,to:C}},[h]),v=!!(t||n),{data:S=[],isLoading:b}=W({queryKey:["coach-calendar-assignments",t,n,c.from,c.to],queryFn:()=>$.getCoachAssignments({groupId:t??null,userId:n??null,from:c.from,to:c.to}),enabled:v}),y=r.useMemo(()=>{const g=new Map;for(const C of S){const L=C.scheduledDate?.slice(0,10);L&&(g.has(L)||g.set(L,[]),g.get(L).push(C))}return g},[S]),F=r.useMemo(()=>{const g={};for(const C of h){const L=ke(C),U=y.get(L)??[],Z=U.some(R=>xt(R.scheduledSlot)==="AM"),P=U.some(R=>xt(R.scheduledSlot)==="PM"),J=(Z?1:0)+(P?1:0),j=[{slotKey:"AM",expected:Z,completed:Z,absent:!1},{slotKey:"PM",expected:P,completed:P,absent:!1}];g[L]={completed:J,total:J,slots:j}}return g},[h,y]),G=r.useMemo(()=>{const[g,C,L]=d.split("-").map(Number);return new Date(g,C-1,L)},[d]),I=r.useMemo(()=>y.get(d)??[],[y,d]),k=r.useMemo(()=>{const g=I;return ra.map(C=>{const L=g.filter(P=>C.type!==P.type?!1:C.type==="swim"?xt(P.scheduledSlot)===(C.scheduledSlot==="morning"?"AM":"PM"):!0),U=L.find(P=>P.targetType==="user"),Z=L.find(P=>P.targetType==="group");return{...C,assignment:U??Z??null}})},[I]),{data:E=[]}=W({queryKey:["planned-absences-coach",n,c.from,c.to],queryFn:()=>$.getPlannedAbsences({userId:n,from:c.from,to:c.to}),enabled:!!n}),A=r.useMemo(()=>new Set(E.map(g=>g.date)),[E]),N=r.useMemo(()=>{const g={};for(const C of h){const L=ke(C),U=y.get(L)??[];g[L]=U.some(Z=>Z.type==="strength")}return g},[h,y]),T=F[d]??{completed:0,total:0,slots:[{slotKey:"AM",expected:!1,completed:!1,absent:!1},{slotKey:"PM",expected:!1,completed:!1,absent:!1}]},q=r.useCallback(()=>{l(g=>new Date(g.getFullYear(),g.getMonth()-1,1))},[]),B=r.useCallback(()=>{l(g=>new Date(g.getFullYear(),g.getMonth()+1,1))},[]),z=r.useCallback(()=>{l(ht(new Date)),i(ke(new Date))},[]),w=r.useCallback(g=>{i(g),p(!0)},[]);return{today:o,monthCursor:a,selectedISO:d,selectedDayIndex:x,drawerOpen:u,gridDates:h,completionByISO:F,selectedDate:G,selectedDayStatus:T,assignmentsForSelectedDay:I,slotsForSelectedDay:k,hasStrengthByISO:N,absenceDates:A,isLoading:b,hasFilter:v,setSelectedISO:i,setSelectedDayIndex:m,setDrawerOpen:p,prevMonth:q,nextMonth:B,jumpToday:z,openDay:w}}function oa(t){const[n,s,o]=t.split("-").map(Number);return new Date(n,s-1,o).toLocaleDateString("fr-FR",{weekday:"long",day:"numeric",month:"long"})}function ia({onBack:t,athletes:n,groups:s,swimSessions:o,strengthSessions:a}){const[l,d]=r.useState("group"),[i,x]=r.useState(""),[m,u]=r.useState(""),p=l==="group"&&i?Number(i):null,f=l==="user"&&m?Number(m):null,{today:h,monthCursor:c,selectedISO:v,selectedDayIndex:S,drawerOpen:b,gridDates:y,completionByISO:F,selectedDayStatus:G,slotsForSelectedDay:I,hasStrengthByISO:k,absenceDates:E,hasFilter:A,setSelectedISO:N,setSelectedDayIndex:T,setDrawerOpen:q,prevMonth:B,nextMonth:z,jumpToday:w,openDay:g}=aa({groupId:p,userId:f,enabled:!0}),C=ve(),L=ee({mutationFn:P=>$.assignments_create(P),onSuccess:()=>{C.invalidateQueries({queryKey:["coach-calendar-assignments"]})}}),U=ee({mutationFn:P=>$.assignments_delete(P),onSuccess:()=>{C.invalidateQueries({queryKey:["coach-calendar-assignments"]})}}),Z=(P,J)=>{let j=J;if(P.key==="ArrowLeft"&&(j=Math.max(0,J-1)),P.key==="ArrowRight"&&(j=Math.min(y.length-1,J+1)),P.key==="ArrowUp"&&(j=Math.max(0,J-7)),P.key==="ArrowDown"&&(j=Math.min(y.length-1,J+7)),j!==J){P.preventDefault(),T(j);const R=V=>String(V).padStart(2,"0"),_=y[j],M=`${_.getFullYear()}-${R(_.getMonth()+1)}-${R(_.getDate())}`;N(M)}if(P.key==="Enter"||P.key===" "){P.preventDefault();const R=V=>String(V).padStart(2,"0"),_=y[J],M=`${_.getFullYear()}-${R(_.getMonth()+1)}-${R(_.getDate())}`;g(M)}};return e.jsxs("div",{className:"space-y-4",children:[e.jsx(xe,{title:"Calendrier",description:"Vue mensuelle des assignations",onBack:t}),e.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center",children:[e.jsxs(ot,{type:"single",value:l,onValueChange:P=>{(P==="group"||P==="user")&&d(P)},className:"shrink-0",children:[e.jsx(me,{value:"group",className:"text-xs px-3",children:"Groupe"}),e.jsx(me,{value:"user",className:"text-xs px-3",children:"Nageur"})]}),l==="group"?e.jsxs(ae,{value:i,onValueChange:x,children:[e.jsx(oe,{className:"w-full sm:w-56",children:e.jsx(ie,{placeholder:"Choisir un groupe"})}),e.jsx(le,{children:s.map(P=>e.jsx(X,{value:String(P.id),children:P.name},String(P.id)))})]}):e.jsxs(ae,{value:m,onValueChange:u,children:[e.jsx(oe,{className:"w-full sm:w-56",children:e.jsx(ie,{placeholder:"Choisir un nageur"})}),e.jsx(le,{children:n.filter(P=>P.id!=null).map(P=>e.jsxs(X,{value:String(P.id),children:[P.display_name,P.group_label?` · ${P.group_label}`:""]},String(P.id)))})]})]}),A?e.jsxs("div",{className:"rounded-2xl border bg-card shadow-sm",children:[e.jsx(Pn,{monthCursor:c,selectedDayStatus:G,onPrevMonth:B,onNextMonth:z,onJumpToday:w}),e.jsx(Fn,{monthCursor:c,gridDates:y,completionByISO:F,strengthByISO:k,absenceDates:E,selectedISO:v,selectedDayIndex:S,today:h,onDayClick:g,onKeyDown:Z})]}):e.jsx("div",{className:"py-12 text-center text-sm text-muted-foreground",children:"Sélectionnez un groupe ou un nageur pour afficher le calendrier."}),e.jsx(je,{open:b,onOpenChange:q,children:e.jsxs(be,{side:"bottom",className:"max-h-[70vh] overflow-y-auto rounded-t-2xl",children:[e.jsxs(ye,{className:"pb-3",children:[e.jsx(Ne,{className:"capitalize text-left",children:oa(v)}),e.jsx(ze,{className:"sr-only",children:"Gérer les assignations pour cette journée"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(On,{variant:"red",icon:e.jsx($n,{}),label:"Absence prévue",visible:E.has(v),animate:!1}),I.map(P=>{const J=P.assignment?.targetType==="group",j=l==="user";return e.jsx(la,{slot:P,swimSessions:o,strengthSessions:a,isGroupAssignment:J&&j,onAssign:R=>{L.mutate({assignment_type:P.type,session_id:R,scheduled_date:v,scheduled_slot:P.scheduledSlot??void 0,target_group_id:p,target_user_id:f})},onDelete:R=>{U.mutate(R)},onReplace:(R,_)=>{J&&j?L.mutate({assignment_type:P.type,session_id:_,scheduled_date:v,scheduled_slot:P.scheduledSlot??void 0,target_user_id:f}):U.mutate(R,{onSuccess:()=>{L.mutate({assignment_type:P.type,session_id:_,scheduled_date:v,scheduled_slot:P.scheduledSlot??void 0,target_group_id:p,target_user_id:f})}})},isPending:L.isPending||U.isPending},P.key)})]})]})})]})}function la({slot:t,swimSessions:n,strengthSessions:s,isGroupAssignment:o,onAssign:a,onDelete:l,onReplace:d,isPending:i}){const[x,m]=r.useState(!1),u=t.type==="swim",p=u?(n??[]).map(c=>({id:c.id,label:c.name})):(s??[]).map(c=>({id:c.id,label:c.title})),f=t.assignment!==null,h=c=>{const v=Number(c);v&&(f&&x?(d(t.assignment.id,v),m(!1)):a(v))};return e.jsxs("div",{className:"rounded-xl border p-3 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[u?e.jsx(ts,{className:"h-4 w-4 text-blue-500 shrink-0"}):e.jsx(ss,{className:"h-4 w-4 text-orange-500 shrink-0"}),e.jsx("span",{className:"text-xs font-semibold text-muted-foreground uppercase tracking-wide",children:t.label})]}),f&&!x?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("p",{className:"text-sm font-semibold truncate flex-1",children:[t.assignment.title,o&&e.jsx("span",{className:"ml-1.5 text-[10px] font-medium text-muted-foreground bg-muted px-1.5 py-0.5 rounded-full align-middle",children:"Groupe"})]}),e.jsx(K,{type:"button",size:"icon",variant:"ghost",className:"h-7 w-7 shrink-0",disabled:i,onClick:()=>m(!0),title:o?"Personnaliser":"Changer",children:e.jsx(gn,{className:"h-3.5 w-3.5"})}),!o&&e.jsx(K,{type:"button",size:"icon",variant:"ghost",className:"h-7 w-7 shrink-0 text-destructive hover:text-destructive",disabled:i,onClick:()=>l(t.assignment.id),title:"Supprimer",children:e.jsx(it,{className:"h-3.5 w-3.5"})})]}):e.jsxs(ae,{value:"",onValueChange:h,disabled:i||p.length===0,children:[e.jsx(oe,{className:"h-9 text-xs",children:e.jsx(ie,{placeholder:x?o?"Personnaliser pour ce nageur":"Choisir le remplacement":"Choisir une séance"})}),e.jsx(le,{children:p.map(c=>e.jsx(X,{value:String(c.id),children:c.label},c.id))})]}),x?e.jsx("button",{type:"button",className:"text-xs text-muted-foreground hover:text-foreground",onClick:()=>m(!1),children:"Annuler"}):null]})}const zs=({athletes:t,selected:n,onToggle:s,filterToUserIds:o})=>{const[a,l]=r.useState(""),d=r.useMemo(()=>{let x=t.filter(m=>m.id!=null);if(o&&(x=x.filter(m=>o.has(m.id))),a.trim()){const m=a.toLowerCase();x=x.filter(u=>u.display_name.toLowerCase().includes(m))}return x},[t,o,a]),i=r.useMemo(()=>{const x=new Map;for(const m of d){const u=m.group_label||"Sans groupe";x.has(u)||x.set(u,[]),x.get(u).push(m)}return[...x.entries()].sort(([m],[u])=>m.localeCompare(u,"fr"))},[d]);return e.jsxs("div",{className:"space-y-3",children:[e.jsx(pe,{placeholder:"Rechercher un nageur...",value:a,onChange:x=>l(x.target.value)}),e.jsxs("div",{className:"max-h-[50vh] overflow-y-auto space-y-3",children:[i.map(([x,m])=>e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-semibold uppercase tracking-wider text-muted-foreground mb-1.5",children:x}),e.jsx("div",{className:"space-y-1",children:m.map(u=>e.jsxs("label",{className:"flex items-center gap-2.5 rounded-lg border px-3 py-2 cursor-pointer hover:bg-muted/50 transition-colors",children:[e.jsx(ls,{checked:n.has(u.id),onCheckedChange:()=>s(u.id)}),e.jsx("span",{className:"text-sm",children:u.display_name})]},u.id))})]},x)),i.length===0&&e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"Aucun nageur trouvé."})]}),n.size>0&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:[n.size," nageur",n.size>1?"s":""," ","sélectionné",n.size>1?"s":""]})]})},Ks=({open:t,onOpenChange:n,athletes:s,parentGroupId:o,parentMembers:a,onCreated:l})=>{const{toast:d}=ue(),[i,x]=r.useState(""),[m,u]=r.useState(new Set),p=c=>{u(v=>{const S=new Set(v);return S.has(c)?S.delete(c):S.add(c),S})},f=ee({mutationFn:()=>$.createTemporaryGroup({name:i.trim(),member_user_ids:[...m],parent_group_id:o??void 0}),onSuccess:()=>{d({title:"Groupe créé",description:`Le groupe "${i.trim()}" a été créé avec ${m.size} nageur${m.size>1?"s":""}.`}),x(""),u(new Set),n(!1),l()},onError:c=>{d({title:"Erreur",description:c.message,variant:"destructive"})}}),h=()=>{if(!i.trim()){d({title:"Nom requis",description:"Veuillez saisir un nom pour le groupe.",variant:"destructive"});return}f.mutate()};return e.jsx(je,{open:t,onOpenChange:n,children:e.jsxs(be,{side:"right",className:"w-full sm:max-w-md overflow-y-auto",children:[e.jsxs(ye,{children:[e.jsx(Ne,{children:o?"Créer un sous-groupe":"Créer un groupe"}),e.jsx(ze,{children:o?"Sélectionnez des nageurs du groupe parent pour ce sous-groupe.":"Créez un groupe temporaire (stage, compétition) avec des nageurs de différents groupes."})]}),e.jsxs("div",{className:"mt-6 space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(Q,{htmlFor:"group-name",children:"Nom du groupe"}),e.jsx(pe,{id:"group-name",placeholder:"Ex : Stage Pâques 2026",value:i,onChange:c=>x(c.target.value)})]}),e.jsx(cs,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Q,{children:"Nageurs"}),e.jsx(zs,{athletes:s,selected:m,onToggle:p,filterToUserIds:a??null})]}),e.jsx(K,{className:"w-full",onClick:h,disabled:f.isPending||!i.trim(),children:f.isPending?"Création...":"Créer le groupe"})]})]})})},ca=({open:t,onOpenChange:n,groupId:s,athletes:o,existingMemberIds:a,onAdded:l})=>{const{toast:d}=ue(),[i,x]=r.useState(new Set),m=r.useMemo(()=>o.filter(f=>f.id!=null&&!a.has(f.id)),[o,a]),u=f=>{x(h=>{const c=new Set(h);return c.has(f)?c.delete(f):c.add(f),c})},p=ee({mutationFn:()=>$.addTemporaryGroupMembers(s,[...i]),onSuccess:()=>{d({title:"Nageurs ajoutés",description:`${i.size} nageur${i.size>1?"s":""} ajouté${i.size>1?"s":""}.`}),x(new Set),n(!1),l()},onError:f=>{d({title:"Erreur",description:f.message,variant:"destructive"})}});return e.jsx(je,{open:t,onOpenChange:n,children:e.jsxs(be,{side:"right",className:"w-full sm:max-w-md overflow-y-auto",children:[e.jsxs(ye,{children:[e.jsx(Ne,{children:"Ajouter des nageurs"}),e.jsx(ze,{children:"Sélectionnez les nageurs à ajouter au groupe."})]}),e.jsxs("div",{className:"mt-6 space-y-4",children:[e.jsx(zs,{athletes:m,selected:i,onToggle:u}),e.jsx(K,{className:"w-full",onClick:()=>p.mutate(),disabled:p.isPending||i.size===0,children:p.isPending?"Ajout...":`Ajouter ${i.size} nageur${i.size>1?"s":""}`})]})]})})},da=({groupId:t,athletes:n,onBack:s})=>{const{toast:o}=ue(),a=ve(),[l,d]=r.useState(!1),[i,x]=r.useState(!1),[m,u]=r.useState(null),{data:p,isLoading:f}=W({queryKey:["temp-group-detail",t],queryFn:()=>$.getTemporaryGroupDetail(t)}),h=ee({mutationFn:b=>$.removeTemporaryGroupMember(t,b),onSuccess:()=>{o({title:"Nageur retiré"}),a.invalidateQueries({queryKey:["temp-group-detail",t]}),a.invalidateQueries({queryKey:["temp-groups"]})},onError:b=>{o({title:"Erreur",description:b.message,variant:"destructive"})}}),c=()=>{a.invalidateQueries({queryKey:["temp-group-detail",t]}),a.invalidateQueries({queryKey:["temp-groups"]})},v=r.useMemo(()=>new Set((p?.members??[]).map(b=>b.user_id)),[p]),S=r.useMemo(()=>new Set((p?.members??[]).map(b=>b.user_id)),[p]);return f?e.jsxs("div",{className:"space-y-4",children:[e.jsxs(K,{variant:"ghost",size:"sm",className:"-ml-2",onClick:s,children:[e.jsx(tt,{className:"mr-2 h-4 w-4"}),"Retour aux groupes"]}),e.jsx("div",{className:"space-y-2",children:[1,2,3].map(b=>e.jsx("div",{className:"rounded-xl border p-3 animate-pulse motion-reduce:animate-none",children:e.jsx("div",{className:"h-4 w-32 rounded bg-muted"})},b))})]}):p?e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs(K,{variant:"ghost",size:"sm",className:"-ml-2",onClick:s,children:[e.jsx(tt,{className:"mr-2 h-4 w-4"}),"Retour aux groupes"]}),e.jsx("h2",{className:"text-2xl font-display font-semibold uppercase italic text-primary",children:p.name}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(re,{variant:p.is_active?"default":"secondary",children:p.is_active?"Actif":"Terminé"}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:[p.members.length," membre",p.members.length!==1?"s":""]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-xs font-semibold uppercase tracking-[0.15em] text-muted-foreground",children:"Membres"}),p.is_active&&e.jsxs(K,{size:"sm",variant:"outline",onClick:()=>d(!0),children:[e.jsx(Kn,{className:"mr-1.5 h-3.5 w-3.5"}),"Ajouter"]})]}),p.members.length===0?e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"Aucun membre dans ce groupe."}):e.jsx("div",{className:"space-y-1.5",children:p.members.map(b=>e.jsxs("div",{className:"flex items-center gap-3 rounded-xl border bg-card p-3",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-sm font-semibold truncate",children:b.display_name}),b.permanent_group_label&&e.jsx(re,{variant:"secondary",className:"text-[10px] px-1.5 py-0 mt-0.5",children:b.permanent_group_label})]}),p.is_active&&e.jsx(K,{size:"icon",variant:"ghost",className:"h-8 w-8 text-muted-foreground hover:text-destructive",onClick:()=>u({userId:b.user_id,name:b.display_name}),title:"Retirer du groupe",children:e.jsx(Gn,{className:"h-4 w-4"})})]},b.user_id))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-xs font-semibold uppercase tracking-[0.15em] text-muted-foreground",children:"Sous-groupes"}),p.is_active&&e.jsxs(K,{size:"sm",variant:"outline",onClick:()=>x(!0),children:[e.jsx(he,{className:"mr-1.5 h-3.5 w-3.5"}),"Sous-groupe"]})]}),p.subgroups.length===0?e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"Aucun sous-groupe."}):e.jsx("div",{className:"space-y-2",children:p.subgroups.map(b=>e.jsxs(qn,{children:[e.jsxs(Ln,{className:"flex w-full items-center justify-between rounded-xl border bg-card p-3 text-left hover:bg-muted/50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(gs,{className:"h-4 w-4 text-primary"}),e.jsx("span",{className:"text-sm font-semibold",children:b.name}),e.jsx(re,{variant:"secondary",className:"text-[10px] px-1.5 py-0",children:b.members.length})]}),e.jsx(ds,{className:"h-4 w-4 text-muted-foreground transition-transform [[data-state=open]_&]:rotate-180"})]}),e.jsx(zn,{children:e.jsxs("div",{className:"ml-4 mt-1 space-y-1",children:[b.members.map(y=>e.jsx("div",{className:"flex items-center gap-2 rounded-lg border px-3 py-2",children:e.jsx("span",{className:"text-sm",children:y.display_name})},y.user_id)),b.members.length===0&&e.jsx("p",{className:"text-xs text-muted-foreground py-2",children:"Aucun membre."})]})})]},b.id))})]}),e.jsx(ca,{open:l,onOpenChange:d,groupId:t,athletes:n,existingMemberIds:v,onAdded:c}),e.jsx(Ks,{open:i,onOpenChange:x,athletes:n,parentGroupId:t,parentMembers:S,onCreated:c}),e.jsx(Ee,{open:!!m,onOpenChange:b=>{b||u(null)},children:e.jsxs(Re,{children:[e.jsxs(Pe,{children:[e.jsx(Fe,{children:"Retirer du groupe"}),e.jsxs(Ie,{children:["Voulez-vous retirer ",m?.name," de ce groupe ?",p.subgroups.length>0?" Le nageur sera aussi retiré des sous-groupes.":""]})]}),e.jsxs(Te,{children:[e.jsx(Oe,{children:"Annuler"}),e.jsx($e,{onClick:()=>{m&&(h.mutate(m.userId),u(null))},className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Retirer"})]})]})})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs(K,{variant:"ghost",size:"sm",className:"-ml-2",onClick:s,children:[e.jsx(tt,{className:"mr-2 h-4 w-4"}),"Retour aux groupes"]}),e.jsx("p",{className:"text-sm text-muted-foreground text-center py-8",children:"Groupe introuvable."})]})},Bt=({group:t,onManage:n,onDeactivate:s,onReactivate:o,onDelete:a})=>{const l=new Date(t.created_at).toLocaleDateString("fr-FR",{day:"numeric",month:"short",year:"numeric"});return e.jsxs("div",{className:"rounded-xl border bg-card p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-sm font-bold truncate",children:t.name}),e.jsxs("div",{className:"flex items-center gap-2 mt-1 flex-wrap",children:[e.jsxs("span",{className:"text-xs text-muted-foreground",children:[t.member_count," membre",t.member_count!==1?"s":""]}),t.subgroup_count>0&&e.jsxs("span",{className:"text-xs text-muted-foreground",children:[t.subgroup_count," sous-groupe",t.subgroup_count!==1?"s":""]}),e.jsx("span",{className:"text-xs text-muted-foreground",children:l})]})]}),e.jsx(re,{variant:t.is_active?"default":"secondary",children:t.is_active?"Actif":"Terminé"})]}),e.jsx("div",{className:"flex items-center gap-2 flex-wrap",children:t.is_active?e.jsxs(e.Fragment,{children:[e.jsxs(K,{size:"sm",variant:"outline",onClick:()=>n(t.id),children:[e.jsx(fn,{className:"mr-1.5 h-3.5 w-3.5"}),"Gérer"]}),e.jsxs(K,{size:"sm",variant:"outline",onClick:()=>s(t.id),children:[e.jsx(In,{className:"mr-1.5 h-3.5 w-3.5"}),"Terminer"]})]}):e.jsxs(e.Fragment,{children:[e.jsxs(K,{size:"sm",variant:"outline",onClick:()=>o(t.id),children:[e.jsx(vn,{className:"mr-1.5 h-3.5 w-3.5"}),"Réactiver"]}),e.jsxs(K,{size:"sm",variant:"outline",className:"text-destructive hover:text-destructive",onClick:()=>a(t.id),children:[e.jsx(it,{className:"mr-1.5 h-3.5 w-3.5"}),"Supprimer"]})]})})]})},ua=({onBack:t,athletes:n,athletesLoading:s})=>{const{toast:o}=ue(),a=ve(),[l,d]=r.useState("list"),[i,x]=r.useState(null),[m,u]=r.useState(!1),[p,f]=r.useState(null),[h,c]=r.useState(null),{data:v=[],isLoading:S}=W({queryKey:["temp-groups"],queryFn:()=>$.getTemporaryGroups()}),b=r.useMemo(()=>v.filter(A=>A.is_active),[v]),y=r.useMemo(()=>v.filter(A=>!A.is_active),[v]),F=ee({mutationFn:A=>$.deactivateTemporaryGroup(A),onSuccess:()=>{o({title:"Groupe terminé"}),a.invalidateQueries({queryKey:["temp-groups"]})},onError:A=>{o({title:"Erreur",description:A.message,variant:"destructive"})}}),G=ee({mutationFn:A=>$.reactivateTemporaryGroup(A),onSuccess:()=>{o({title:"Groupe réactivé"}),a.invalidateQueries({queryKey:["temp-groups"]})},onError:A=>{o({title:"Erreur",description:A.message,variant:"destructive"})}}),I=ee({mutationFn:A=>$.deleteTemporaryGroup(A),onSuccess:()=>{o({title:"Groupe supprimé"}),a.invalidateQueries({queryKey:["temp-groups"]})},onError:A=>{o({title:"Erreur",description:A.message,variant:"destructive"})}}),k=A=>{x(A),d("detail")},E=()=>{x(null),d("list"),a.invalidateQueries({queryKey:["temp-groups"]})};return l==="detail"&&i!=null?e.jsx(da,{groupId:i,athletes:n,onBack:E}):e.jsxs("div",{className:"space-y-6 pb-24",children:[e.jsx(xe,{title:"Groupes temporaires",description:"Créez et gérez des groupes pour les stages, compétitions ou événements.",onBack:t,actions:e.jsxs(K,{size:"sm",onClick:()=>u(!0),children:[e.jsx(he,{className:"mr-1.5 h-3.5 w-3.5"}),"Créer un groupe"]})}),S||s?e.jsx("div",{className:"space-y-2",children:[1,2,3].map(A=>e.jsx("div",{className:"rounded-xl border p-4 animate-pulse motion-reduce:animate-none",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-4 w-40 rounded bg-muted"}),e.jsx("div",{className:"ml-auto h-6 w-16 rounded bg-muted"})]})},A))}):v.length===0?e.jsxs("div",{className:"text-center py-12 space-y-3",children:[e.jsx(nt,{className:"h-10 w-10 text-muted-foreground mx-auto"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Aucun groupe temporaire pour le moment."}),e.jsxs(K,{variant:"outline",size:"sm",onClick:()=>u(!0),children:[e.jsx(he,{className:"mr-1.5 h-3.5 w-3.5"}),"Créer le premier groupe"]})]}):e.jsxs(e.Fragment,{children:[b.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h3",{className:"text-xs font-semibold uppercase tracking-[0.15em] text-muted-foreground",children:["Actifs (",b.length,")"]}),b.map(A=>e.jsx(Bt,{group:A,onManage:k,onDeactivate:N=>f(N),onReactivate:N=>G.mutate(N),onDelete:N=>c(N)},A.id))]}),y.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h3",{className:"text-xs font-semibold uppercase tracking-[0.15em] text-muted-foreground",children:["Terminés (",y.length,")"]}),y.map(A=>e.jsx(Bt,{group:A,onManage:k,onDeactivate:N=>f(N),onReactivate:N=>G.mutate(N),onDelete:N=>c(N)},A.id))]})]}),e.jsx(Ks,{open:m,onOpenChange:u,athletes:n,onCreated:()=>{a.invalidateQueries({queryKey:["temp-groups"]})}}),e.jsx(Ee,{open:p!=null,onOpenChange:A=>{A||f(null)},children:e.jsxs(Re,{children:[e.jsxs(Pe,{children:[e.jsx(Fe,{children:"Terminer le groupe"}),e.jsx(Ie,{children:"Voulez-vous marquer ce groupe comme terminé ? Les sous-groupes seront aussi désactivés. Vous pourrez le réactiver plus tard si nécessaire."})]}),e.jsxs(Te,{children:[e.jsx(Oe,{children:"Annuler"}),e.jsx($e,{onClick:()=>{p!=null&&(F.mutate(p),f(null))},children:"Terminer"})]})]})}),e.jsx(Ee,{open:h!=null,onOpenChange:A=>{A||c(null)},children:e.jsxs(Re,{children:[e.jsxs(Pe,{children:[e.jsx(Fe,{children:"Supprimer le groupe"}),e.jsx(Ie,{children:"Cette action est irréversible. Le groupe et tous ses sous-groupes seront supprimés définitivement."})]}),e.jsxs(Te,{children:[e.jsx(Oe,{children:"Annuler"}),e.jsx($e,{onClick:()=>{h!=null&&(I.mutate(h),c(null))},className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Supprimer"})]})]})})]})};function ma(t){const n=new Date;n.setHours(0,0,0,0);const s=new Date(t+"T00:00:00");return Math.ceil((s.getTime()-n.getTime())/(1e3*60*60*24))}function pa(t){return`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")}`}function Ze(t,n){return Math.max(0,Math.round((new Date(n+"T00:00:00").getTime()-new Date(t+"T00:00:00").getTime())/6048e5))}const ha=7,xa=20,ga=72;function et(t){return Math.min(ga,Math.max(xa,t*ha))}const fa=({open:t,onOpenChange:n,competition:s})=>{const{toast:o}=ue(),a=ve(),l=!!s,[d,i]=r.useState(""),[x,m]=r.useState(""),[u,p]=r.useState(""),[f,h]=r.useState(""),[c,v]=r.useState(""),[S,b]=r.useState(!1),[y,F]=r.useState(new Set),{data:G=[]}=W({queryKey:["athletes"],queryFn:()=>$.getAthletes()}),{data:I=[]}=W({queryKey:["groups"],queryFn:()=>$.getGroups()}),{data:k}=W({queryKey:["competition-assignments",s?.id],queryFn:()=>$.getCompetitionAssignments(s.id),enabled:!!s?.id});r.useEffect(()=>{t&&(s?(i(s.name),m(s.date),p(s.end_date??s.date??""),h(s.location??""),v(s.description??""),k&&F(new Set(k.map(w=>w.athlete_id)))):(i(""),m(""),p(""),h(""),v(""),F(new Set)))},[t,s,k]);const E=ee({mutationFn:w=>$.createCompetition(w),onSuccess:async w=>{if(y.size>0)try{await $.setCompetitionAssignments(w.id,Array.from(y))}catch(g){console.warn("[EAC] Failed to save competition assignments:",g)}o({title:"Competition creee"}),a.invalidateQueries({queryKey:["competitions"]}),a.invalidateQueries({queryKey:["competition-assignments"]}),n(!1)},onError:w=>{o({title:"Erreur",description:w.message,variant:"destructive"})}}),A=ee({mutationFn:w=>$.updateCompetition(s.id,w),onSuccess:async()=>{try{await $.setCompetitionAssignments(s.id,Array.from(y))}catch(w){console.warn("[EAC] Failed to save competition assignments:",w)}o({title:"Competition mise a jour"}),a.invalidateQueries({queryKey:["competitions"]}),a.invalidateQueries({queryKey:["competition-assignments"]}),n(!1)},onError:w=>{o({title:"Erreur",description:w.message,variant:"destructive"})}}),N=ee({mutationFn:()=>$.deleteCompetition(s.id),onSuccess:()=>{o({title:"Competition supprimee"}),a.invalidateQueries({queryKey:["competitions"]}),n(!1)},onError:w=>{o({title:"Erreur",description:w.message,variant:"destructive"})}}),T=()=>{if(!d.trim()){o({title:"Nom requis",description:"Veuillez saisir un nom pour la competition.",variant:"destructive"});return}if(!x){o({title:"Date requise",description:"Veuillez saisir une date.",variant:"destructive"});return}const w={name:d.trim(),date:x,end_date:u||x||null,location:f.trim()||null,description:c.trim()||null};l?A.mutate(w):E.mutate(w)},q=E.isPending||A.isPending||N.isPending,B="flex h-9 w-full rounded-lg border border-input bg-transparent px-3 py-1 text-sm shadow-sm transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring",z=w=>{m(w),(!u||u<w)&&p(w)};return e.jsxs(e.Fragment,{children:[e.jsx(je,{open:t,onOpenChange:n,children:e.jsxs(be,{side:"right",className:"w-full sm:max-w-md overflow-y-auto",children:[e.jsx(ye,{children:e.jsx(Ne,{children:l?"Modifier":"Nouvelle compétition"})}),e.jsxs("div",{className:"mt-5 space-y-5",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(Q,{htmlFor:"comp-name",className:"text-[11px] font-semibold uppercase tracking-wider text-muted-foreground",children:"Nom"}),e.jsx(pe,{id:"comp-name",placeholder:"Ex : Championnats Régionaux",value:d,onChange:w=>i(w.target.value),className:"text-[15px] font-medium"})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("span",{className:"text-[11px] font-semibold uppercase tracking-wider text-muted-foreground",children:"Dates"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{htmlFor:"comp-date",className:"text-[10px] text-muted-foreground/60 pl-0.5",children:"Début"}),e.jsx("input",{id:"comp-date",type:"date",value:x,onChange:w=>z(w.target.value),className:B})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{htmlFor:"comp-end-date",className:"text-[10px] text-muted-foreground/60 pl-0.5",children:"Fin"}),e.jsx("input",{id:"comp-end-date",type:"date",value:u,onChange:w=>p(w.target.value),min:x||void 0,className:B})]})]})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(Q,{htmlFor:"comp-location",className:"text-[11px] font-semibold uppercase tracking-wider text-muted-foreground",children:"Lieu"}),e.jsx(pe,{id:"comp-location",placeholder:"Ex : Piscine de Strasbourg",value:f,onChange:w=>h(w.target.value)})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(Q,{htmlFor:"comp-description",className:"text-[11px] font-semibold uppercase tracking-wider text-muted-foreground",children:"Notes"}),e.jsx(At,{id:"comp-description",placeholder:"Informations complémentaires...",value:c,onChange:w=>v(w.target.value),rows:2,className:"resize-none"})]}),e.jsx("div",{className:"border-t border-border/40"}),e.jsxs("div",{className:"space-y-2.5",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-[11px] font-semibold uppercase tracking-wider text-muted-foreground",children:"Nageurs"}),e.jsxs("span",{className:"text-[10px] tabular-nums text-muted-foreground/50",children:[y.size," sélectionné",y.size>1?"s":""]})]}),e.jsxs(ae,{value:"",onValueChange:w=>{const g=G.filter(C=>C.group_id===Number(w));F(C=>{const L=new Set(C);return g.forEach(U=>{U.id!=null&&L.add(U.id)}),L})},children:[e.jsx(oe,{className:"h-8 text-xs",children:e.jsx(ie,{placeholder:"Ajouter un groupe..."})}),e.jsx(le,{children:I.filter(w=>!w.is_temporary).map(w=>e.jsx(X,{value:String(w.id),children:w.name},w.id))})]}),e.jsx("div",{className:"max-h-44 overflow-y-auto rounded-lg border p-1.5 space-y-0.5",children:G.map(w=>{if(w.id==null)return null;const g=y.has(w.id);return e.jsxs("label",{className:ne("flex items-center gap-2 py-1 px-1.5 rounded-md cursor-pointer transition-colors",g?"bg-primary/5":"hover:bg-muted/50"),children:[e.jsx(ls,{checked:g,onCheckedChange:C=>{F(L=>{const U=new Set(L);return C?U.add(w.id):U.delete(w.id),U})}}),e.jsx("span",{className:"text-[13px]",children:w.display_name}),w.group_label&&e.jsx("span",{className:"text-[10px] text-muted-foreground/50 ml-auto",children:w.group_label})]},w.id)})})]}),e.jsxs("div",{className:"space-y-3 pt-1",children:[e.jsx(K,{className:"w-full",onClick:T,disabled:q||!d.trim()||!x||!u,children:q?"Enregistrement...":l?"Enregistrer":"Créer la compétition"}),l&&e.jsx("button",{type:"button",className:"w-full text-center text-[11px] text-destructive/50 hover:text-destructive py-1.5 transition-colors",onClick:()=>b(!0),disabled:q,children:"Supprimer cette compétition"})]})]})]})}),e.jsx(Ee,{open:S,onOpenChange:b,children:e.jsxs(Re,{children:[e.jsxs(Pe,{children:[e.jsx(Fe,{children:"Supprimer la compétition"}),e.jsxs(Ie,{children:["Cette action est irréversible. La compétition «"," ",s?.name," » sera supprimée définitivement."]})]}),e.jsxs(Te,{children:[e.jsx(Oe,{children:"Annuler"}),e.jsx($e,{onClick:()=>{N.mutate(),b(!1)},className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Supprimer"})]})]})})]})},va=({competitions:t,onEdit:n})=>{const[s,o]=r.useState(!1),{items:a,todayIdx:l}=r.useMemo(()=>{const u=[...t].sort((b,y)=>b.date.localeCompare(y.date)),p=new Date;p.setHours(0,0,0,0);const f=pa(p),h=[];let c="",v="",S=!1;for(const b of u){const y=b.date<f,F=ma(b.date),G=b.date.slice(0,7),I=G!==v,k=new Date(b.date+"T00:00:00").toLocaleDateString("fr-FR",{month:"short"}).replace(".","").toUpperCase();if(!S&&!y){if(c){const A=Ze(c,f);A>=1&&h.push({kind:"gap",weeks:A,height:et(A)})}h.push({kind:"today"}),S=!0;const E=Ze(f,b.date);E>=1&&h.push({kind:"gap",weeks:E,height:et(E)})}else if(c){const E=Ze(c,b.date);E>=1&&h.push({kind:"gap",weeks:E,height:et(E)})}h.push({kind:"comp",comp:b,isPast:y,days:F,isNewMonth:I,monthLabel:k}),c=b.end_date||b.date,v=G}if(!S){if(c){const b=Ze(c,f);b>=1&&h.push({kind:"gap",weeks:b,height:et(b)})}h.push({kind:"today"})}return{items:h,todayIdx:h.findIndex(b=>b.kind==="today")}},[t]);if(t.length===0)return null;const d=l>0?a.slice(0,l):[],i=l>=0?a.slice(l):a,x=d.filter(u=>u.kind==="comp").length,m=(u,p)=>{if(u.kind==="gap")return e.jsx("div",{className:"relative",style:{height:u.height},children:u.weeks>=2&&e.jsxs("span",{className:"absolute left-[-0.8rem] -translate-x-1/2 top-1/2 -translate-y-1/2 text-[9px] tabular-nums font-medium text-muted-foreground/30 bg-background px-1 select-none",children:[u.weeks,"s"]})},`g${p}`);if(u.kind==="today")return e.jsxs("div",{className:"relative flex items-center h-7 -ml-14",children:[e.jsx("div",{className:"absolute left-0 right-0 h-[2px] bg-emerald-500/60"}),e.jsx("span",{className:"relative text-[10px] font-bold tracking-widest text-emerald-600 dark:text-emerald-400 bg-background pl-2 pr-1.5 select-none",children:"AUJOURD'HUI"})]},"today");const{comp:f,isPast:h,days:c,isNewMonth:v,monthLabel:S}=u,b=(()=>{const y=new Date(f.date+"T00:00:00");if(!f.end_date||f.end_date===f.date)return y.toLocaleDateString("fr-FR",{day:"numeric",month:"short"}).replace(".","");const F=new Date(f.end_date+"T00:00:00"),G=F.toLocaleDateString("fr-FR",{day:"numeric",month:"short"}).replace(".","");return y.getMonth()===F.getMonth()?`${y.getDate()}–${G}`:`${y.toLocaleDateString("fr-FR",{day:"numeric",month:"short"}).replace(".","")} → ${G}`})();return e.jsxs("button",{type:"button",className:ne("relative w-full flex items-start text-left py-1.5 group transition-opacity",h?"opacity-40 hover:opacity-70":"hover:opacity-80"),onClick:()=>n(f),children:[v&&e.jsx("span",{className:"absolute left-[-3.25rem] top-[3px] w-[2rem] text-[10px] font-bold uppercase tracking-widest text-muted-foreground/50 text-right select-none",children:S}),e.jsx("div",{className:ne("absolute left-[-0.8rem] top-[5px] h-[10px] w-[10px] rounded-full -translate-x-1/2 z-10 border-2 border-background transition-transform group-hover:scale-150",h?"bg-muted-foreground/30":"bg-amber-500 shadow-[0_0_6px_rgba(245,158,11,0.4)]")}),e.jsxs("div",{className:"min-w-0 flex-1 pl-1",children:[e.jsxs("div",{className:"flex items-center gap-1.5 min-w-0",children:[e.jsx("span",{className:ne("text-[13px] font-semibold truncate flex-1 min-w-0",h?"text-muted-foreground":"text-foreground"),children:f.name}),!h&&c>=0&&e.jsxs("span",{className:"text-[10px] font-bold tabular-nums shrink-0 px-1.5 py-0.5 rounded-full bg-amber-100 text-amber-700 dark:bg-amber-900/30 dark:text-amber-400",children:["J-",c]})]}),e.jsxs("p",{className:ne("text-[11px] truncate",h?"text-muted-foreground/60":"text-muted-foreground"),children:[b,f.location&&f.location!=="??"&&` · ${f.location}`]})]})]},f.id)};return e.jsxs("div",{className:"relative pl-14",children:[e.jsx("div",{className:"absolute left-[2.625rem] top-1 bottom-1 w-[2px] rounded-full bg-gradient-to-b from-border/10 via-border/40 to-border/10"}),x>0&&e.jsxs("button",{type:"button",className:"relative flex items-center gap-1.5 py-2 text-[11px] font-medium text-muted-foreground/50 hover:text-muted-foreground transition-colors select-none",onClick:()=>o(u=>!u),children:[e.jsx(ds,{className:ne("h-3 w-3 shrink-0 transition-transform",s&&"rotate-180")}),e.jsxs("span",{children:["Passées (",x,")"]})]}),s&&d.map((u,p)=>m(u,p)),i.map((u,p)=>m(u,d.length+p))]})},ja=({onBack:t})=>{const[n,s]=r.useState(!1),[o,a]=r.useState(null),{data:l=[],isLoading:d}=W({queryKey:["competitions"],queryFn:()=>$.getCompetitions()}),i=()=>{a(null),s(!0)},x=u=>{a(u),s(!0)},m=l.length===0?"Gerez les competitions du club.":`${l.length} competition${l.length>1?"s":""}`;return e.jsxs("div",{className:"space-y-6 pb-24",children:[e.jsx(xe,{title:"Competitions",description:m,onBack:t,actions:e.jsxs(K,{variant:"outline",size:"sm",onClick:i,children:[e.jsx(he,{className:"mr-1.5 h-3.5 w-3.5"}),"Ajouter"]})}),d?e.jsx("div",{className:"space-y-2",children:[1,2,3].map(u=>e.jsx("div",{className:"rounded-xl border p-3 animate-pulse motion-reduce:animate-none",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-4 w-40 rounded bg-muted"}),e.jsx("div",{className:"ml-auto h-5 w-12 rounded bg-muted"})]})},u))}):l.length===0?e.jsxs("div",{className:"text-center py-12 space-y-3",children:[e.jsx(ft,{className:"h-10 w-10 text-muted-foreground mx-auto"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Aucune competition creee."}),e.jsxs(K,{variant:"outline",size:"sm",onClick:i,children:[e.jsx(he,{className:"mr-1.5 h-3.5 w-3.5"}),"Creer la premiere competition"]})]}):e.jsx(va,{competitions:l,onEdit:x}),e.jsx(fa,{open:n,onOpenChange:s,competition:o})]})};async function ba(t){const{data:n,error:s}=await es.rpc("get_auth_uid_for_user",{p_user_id:t});return s?(console.error("[objectives] Failed to resolve auth UUID:",s.message),null):n}const ya=({open:t,onOpenChange:n,objective:s,athleteName:o,athleteAuthId:a,competitions:l})=>{const{toast:d}=ue(),i=ve(),x=!!s,[m,u]=r.useState("chrono"),[p,f]=r.useState(""),[h,c]=r.useState("25"),[v,S]=r.useState(""),[b,y]=r.useState(""),[F,G]=r.useState(""),[I,k]=r.useState(!1);r.useEffect(()=>{if(t)if(s){const g=!!s.event_code,C=!!s.text;u(g&&C?"both":C?"texte":"chrono"),f(s.event_code??""),c(String(s.pool_length??25)),S(s.target_time_seconds!=null?is(s.target_time_seconds):""),y(s.text??""),G(s.competition_id??"")}else u("chrono"),f(""),c("25"),S(""),y(""),G("")},[t,s]);const E=ee({mutationFn:g=>$.createObjective(g),onSuccess:()=>{d({title:"Objectif cree"}),i.invalidateQueries({queryKey:["objectives"]}),n(!1)},onError:g=>{d({title:"Erreur",description:g.message,variant:"destructive"})}}),A=ee({mutationFn:g=>$.updateObjective(s.id,g),onSuccess:()=>{d({title:"Objectif mis a jour"}),i.invalidateQueries({queryKey:["objectives"]}),n(!1)},onError:g=>{d({title:"Erreur",description:g.message,variant:"destructive"})}}),N=ee({mutationFn:()=>$.deleteObjective(s.id),onSuccess:()=>{d({title:"Objectif supprime"}),i.invalidateQueries({queryKey:["objectives"]}),n(!1)},onError:g=>{d({title:"Erreur",description:g.message,variant:"destructive"})}}),T=m==="chrono"||m==="both",q=m==="texte"||m==="both",B=()=>{if(T&&!p){d({title:"Epreuve requise",description:"Veuillez selectionner une epreuve.",variant:"destructive"});return}if(T&&v&&$t(v)===null){d({title:"Format invalide",description:"Le temps doit être au format m:ss:cc (ex: 1:05:30)",variant:"destructive"});return}if(q&&!b.trim()){d({title:"Texte requis",description:"Veuillez saisir un objectif texte.",variant:"destructive"});return}const g={athlete_id:a,competition_id:F&&F!=="none"?F:null,event_code:T?p:null,pool_length:T?Number(h):null,target_time_seconds:T&&v?$t(v):null,text:q?b.trim():null};x?A.mutate(g):E.mutate(g)},z=E.isPending||A.isPending||N.isPending,w=r.useMemo(()=>{const g=new Date;return g.setHours(0,0,0,0),l.filter(C=>new Date(C.date+"T00:00:00").getTime()>=g.getTime())},[l]);return e.jsxs(e.Fragment,{children:[e.jsx(je,{open:t,onOpenChange:n,children:e.jsxs(be,{side:"right",className:"w-full sm:max-w-md overflow-y-auto",children:[e.jsx(ye,{children:e.jsx(Ne,{children:x?"Modifier l'objectif":"Nouvel objectif"})}),e.jsxs("div",{className:"mt-6 space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(Q,{children:"Nageur"}),e.jsx("p",{className:"text-sm font-medium",children:o})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Q,{children:"Type d'objectif"}),e.jsxs(ot,{type:"single",variant:"outline",value:m,onValueChange:g=>{g&&u(g)},className:"justify-start",children:[e.jsx(me,{value:"chrono",className:"text-xs",children:"Chrono"}),e.jsx(me,{value:"texte",className:"text-xs",children:"Texte"}),e.jsx(me,{value:"both",className:"text-xs",children:"Les deux"})]})]}),T&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(Q,{children:"Epreuve *"}),e.jsxs(ae,{value:p,onValueChange:f,children:[e.jsx(oe,{children:e.jsx(ie,{placeholder:"Choisir une epreuve"})}),e.jsx(le,{children:yn.map(g=>e.jsx(X,{value:g,children:os(g)},g))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Q,{children:"Bassin"}),e.jsxs(ae,{value:h,onValueChange:c,children:[e.jsx(oe,{children:e.jsx(ie,{})}),e.jsxs(le,{children:[e.jsx(X,{value:"25",children:"25m"}),e.jsx(X,{value:"50",children:"50m"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Q,{children:"Temps cible (min:sec:centièmes)"}),e.jsx(pe,{placeholder:"Ex : 1:05:30",value:v,onChange:g=>S(g.target.value)})]})]}),q&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(Q,{children:"Objectif texte *"}),e.jsx(At,{placeholder:"Ex : Ameliorer la coulée de dos",value:b,onChange:g=>y(g.target.value),rows:3})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Q,{children:"Lier a une competition"}),e.jsxs(ae,{value:F,onValueChange:G,children:[e.jsx(oe,{children:e.jsx(ie,{placeholder:"Aucune"})}),e.jsxs(le,{children:[e.jsx(X,{value:"none",children:"Aucune"}),w.map(g=>e.jsxs(X,{value:g.id,children:[g.name," (",g.date,")"]},g.id))]})]})]}),e.jsxs("div",{className:"space-y-2 pt-2",children:[e.jsx(K,{className:"w-full",onClick:B,disabled:z,children:z?"Enregistrement...":x?"Enregistrer":"Creer"}),x&&e.jsx(K,{variant:"outline",className:"w-full text-destructive hover:text-destructive",onClick:()=>k(!0),disabled:z,children:"Supprimer cet objectif"})]})]})]})}),e.jsx(Ee,{open:I,onOpenChange:k,children:e.jsxs(Re,{children:[e.jsxs(Pe,{children:[e.jsx(Fe,{children:"Supprimer l'objectif"}),e.jsx(Ie,{children:"Cette action est irreversible. L'objectif sera supprime definitivement."})]}),e.jsxs(Te,{children:[e.jsx(Oe,{children:"Annuler"}),e.jsx($e,{onClick:()=>{N.mutate(),k(!1)},className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Supprimer"})]})]})})]})},Na=({objective:t,onEdit:n})=>{const s=!!t.event_code,o=!!t.text;return e.jsxs("button",{type:"button",className:"w-full text-left rounded-xl border bg-card p-3 space-y-1.5 transition-colors hover:bg-muted/50",onClick:()=>n(t),children:[s&&e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"text-sm font-semibold",children:os(t.event_code)}),t.pool_length&&e.jsxs(re,{variant:"secondary",className:"text-[10px] px-1.5 py-0",children:[t.pool_length,"m"]}),t.target_time_seconds!=null&&e.jsx(re,{variant:"outline",className:"text-[10px] px-1.5 py-0 font-mono",children:is(t.target_time_seconds)})]}),o&&e.jsx("p",{className:"text-sm text-muted-foreground line-clamp-2",children:t.text}),t.competition_name&&e.jsx(re,{variant:"outline",className:"border-orange-300 text-orange-600 dark:text-orange-400 text-[10px] px-1.5 py-0",children:t.competition_name})]})},wa=({onBack:t,athletes:n,athletesLoading:s})=>{const{toast:o}=ue(),[a,l]=r.useState(""),[d,i]=r.useState(!1),[x,m]=r.useState(null),u=r.useMemo(()=>a?n.find(I=>I.id!=null&&String(I.id)===a)??null:null,[n,a]),{data:p,isLoading:f}=W({queryKey:["auth-uid",a],queryFn:()=>ba(Number(a)),enabled:!!a}),{data:h=[]}=W({queryKey:["competitions"],queryFn:()=>$.getCompetitions()}),{data:c=[],isLoading:v}=W({queryKey:["objectives",p],queryFn:()=>$.getObjectives(p),enabled:!!p}),S=r.useMemo(()=>{const I=n.filter(E=>E.id!=null),k=new Map;for(const E of I){const A=E.group_label||"Sans groupe";k.has(A)||k.set(A,[]),k.get(A).push(E)}return[...k.entries()].sort(([E],[A])=>E.localeCompare(A,"fr"))},[n]),b=()=>{if(!p){o({title:"Nageur requis",description:"Veuillez selectionner un nageur.",variant:"destructive"});return}m(null),i(!0)},y=I=>{m(I),i(!0)},F=s||!!a&&f,G=!!p&&!f;return e.jsxs("div",{className:"space-y-6 pb-24",children:[e.jsx(xe,{title:"Objectifs",description:"Definissez des objectifs chrono ou texte pour chaque nageur.",onBack:t,actions:e.jsxs(K,{variant:"outline",size:"sm",onClick:b,disabled:!p,children:[e.jsx(he,{className:"mr-1.5 h-3.5 w-3.5"}),"Ajouter"]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Q,{children:"Nageur"}),e.jsxs(ae,{value:a,onValueChange:l,children:[e.jsx(oe,{children:e.jsx(ie,{placeholder:"Selectionner un nageur"})}),e.jsx(le,{children:S.map(([I,k])=>e.jsxs("div",{children:[e.jsx("div",{className:"px-2 py-1.5 text-xs font-semibold uppercase tracking-wider text-muted-foreground",children:I}),k.map(E=>e.jsx(X,{value:String(E.id),children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:E.display_name}),E.group_label&&e.jsx(re,{variant:"secondary",className:"text-[10px] px-1.5 py-0",children:E.group_label})]})},E.id))]},I))})]})]}),!a&&e.jsxs("div",{className:"text-center py-12 space-y-3",children:[e.jsx(vt,{className:"h-10 w-10 text-muted-foreground mx-auto"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Selectionnez un nageur pour voir et gerer ses objectifs."})]}),F&&a&&e.jsx("div",{className:"space-y-2",children:[1,2,3].map(I=>e.jsx("div",{className:"rounded-xl border p-3 animate-pulse motion-reduce:animate-none",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-4 w-40 rounded bg-muted"}),e.jsx("div",{className:"ml-auto h-5 w-12 rounded bg-muted"})]})},I))}),G&&v&&e.jsx("div",{className:"space-y-2",children:[1,2].map(I=>e.jsx("div",{className:"rounded-xl border p-3 animate-pulse motion-reduce:animate-none",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-4 w-32 rounded bg-muted"}),e.jsx("div",{className:"ml-auto h-5 w-16 rounded bg-muted"})]})},I))}),G&&!v&&c.length===0&&e.jsxs("div",{className:"text-center py-12 space-y-3",children:[e.jsx(vt,{className:"h-10 w-10 text-muted-foreground mx-auto"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Aucun objectif defini pour ",u?.display_name,"."]}),e.jsxs(K,{variant:"outline",size:"sm",onClick:b,children:[e.jsx(he,{className:"mr-1.5 h-3.5 w-3.5"}),"Creer le premier objectif"]})]}),G&&!v&&c.length>0&&e.jsx("div",{className:"space-y-2",children:c.map(I=>e.jsx(Na,{objective:I,onEdit:y},I.id))}),p&&u&&e.jsx(ya,{open:d,onOpenChange:i,objective:x,athleteName:u.display_name,athleteAuthId:p,competitions:h})]})};function St(t,n,{checkForDefaultPrevented:s=!0}={}){return function(a){if(t?.(a),s===!1||!a.defaultPrevented)return n?.(a)}}var Sa=rs[" useInsertionEffect ".trim().toString()]||Jt;function Ca({prop:t,defaultProp:n,onChange:s=()=>{},caller:o}){const[a,l,d]=_a({defaultProp:n,onChange:s}),i=t!==void 0,x=i?t:a;{const u=r.useRef(t!==void 0);r.useEffect(()=>{const p=u.current;p!==i&&console.warn(`${o} is changing from ${p?"controlled":"uncontrolled"} to ${i?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),u.current=i},[i,o])}const m=r.useCallback(u=>{if(i){const p=ka(u)?u(t):u;p!==t&&d.current?.(p)}else l(u)},[i,t,l,d]);return[x,m]}function _a({defaultProp:t,onChange:n}){const[s,o]=r.useState(t),a=r.useRef(s),l=r.useRef(n);return Sa(()=>{l.current=n},[n]),r.useEffect(()=>{a.current!==s&&(l.current?.(s),a.current=s)},[s,a]),[s,o,l]}function ka(t){return typeof t=="function"}var Ft="Radio",[Ma,Gs]=kt(Ft),[Da,Aa]=Ma(Ft),Vs=r.forwardRef((t,n)=>{const{__scopeRadio:s,name:o,checked:a=!1,required:l,disabled:d,value:i="on",onCheck:x,form:m,...u}=t,[p,f]=r.useState(null),h=Ye(n,S=>f(S)),c=r.useRef(!1),v=p?m||!!p.closest("form"):!0;return e.jsxs(Da,{scope:s,checked:a,disabled:d,children:[e.jsx(ce.button,{type:"button",role:"radio","aria-checked":a,"data-state":Qs(a),"data-disabled":d?"":void 0,disabled:d,value:i,...u,ref:h,onClick:St(t.onClick,S=>{a||x?.(),v&&(c.current=S.isPropagationStopped(),c.current||S.stopPropagation())})}),v&&e.jsx(Hs,{control:p,bubbles:!c.current,name:o,value:i,checked:a,required:l,disabled:d,form:m,style:{transform:"translateX(-100%)"}})]})});Vs.displayName=Ft;var Bs="RadioIndicator",Us=r.forwardRef((t,n)=>{const{__scopeRadio:s,forceMount:o,...a}=t,l=Aa(Bs,s);return e.jsx(Mt,{present:o||l.checked,children:e.jsx(ce.span,{"data-state":Qs(l.checked),"data-disabled":l.disabled?"":void 0,...a,ref:n})})});Us.displayName=Bs;var Ea="RadioBubbleInput",Hs=r.forwardRef(({__scopeRadio:t,control:n,checked:s,bubbles:o=!0,...a},l)=>{const d=r.useRef(null),i=Ye(d,l),x=Nn(s),m=jn(n);return r.useEffect(()=>{const u=d.current;if(!u)return;const p=window.HTMLInputElement.prototype,h=Object.getOwnPropertyDescriptor(p,"checked").set;if(x!==s&&h){const c=new Event("click",{bubbles:o});h.call(u,s),u.dispatchEvent(c)}},[x,s,o]),e.jsx(ce.input,{type:"radio","aria-hidden":!0,defaultChecked:s,...a,tabIndex:-1,ref:i,style:{...a.style,...m,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});Hs.displayName=Ea;function Qs(t){return t?"checked":"unchecked"}var Ra=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],dt="RadioGroup",[Pa]=kt(dt,[us,Gs]),Ws=us(),Ys=Gs(),[Fa,Ia]=Pa(dt),Js=r.forwardRef((t,n)=>{const{__scopeRadioGroup:s,name:o,defaultValue:a,value:l,required:d=!1,disabled:i=!1,orientation:x,dir:m,loop:u=!0,onValueChange:p,...f}=t,h=Ws(s),c=Un(m),[v,S]=Ca({prop:l,defaultProp:a??null,onChange:p,caller:dt});return e.jsx(Fa,{scope:s,name:o,required:d,disabled:i,value:v,onValueChange:S,children:e.jsx(Vn,{asChild:!0,...h,orientation:x,dir:c,loop:u,children:e.jsx(ce.div,{role:"radiogroup","aria-required":d,"aria-orientation":x,"data-disabled":i?"":void 0,dir:c,...f,ref:n})})})});Js.displayName=dt;var Xs="RadioGroupItem",Zs=r.forwardRef((t,n)=>{const{__scopeRadioGroup:s,disabled:o,...a}=t,l=Ia(Xs,s),d=l.disabled||o,i=Ws(s),x=Ys(s),m=r.useRef(null),u=Ye(n,m),p=l.value===a.value,f=r.useRef(!1);return r.useEffect(()=>{const h=v=>{Ra.includes(v.key)&&(f.current=!0)},c=()=>f.current=!1;return document.addEventListener("keydown",h),document.addEventListener("keyup",c),()=>{document.removeEventListener("keydown",h),document.removeEventListener("keyup",c)}},[]),e.jsx(Bn,{asChild:!0,...i,focusable:!d,active:p,children:e.jsx(Vs,{disabled:d,required:l.required,checked:p,...x,...a,name:l.name,ref:u,onCheck:()=>l.onValueChange(a.value),onKeyDown:St(h=>{h.key==="Enter"&&h.preventDefault()}),onFocus:St(a.onFocus,()=>{f.current&&m.current?.click()})})})});Zs.displayName=Xs;var Ta="RadioGroupIndicator",en=r.forwardRef((t,n)=>{const{__scopeRadioGroup:s,...o}=t,a=Ys(s);return e.jsx(Us,{...a,...o,ref:n})});en.displayName=Ta;var tn=Js,sn=Zs,Oa=en;const nn=r.forwardRef(({className:t,...n},s)=>e.jsx(tn,{className:ne("grid gap-2",t),...n,ref:s}));nn.displayName=tn.displayName;const Ct=r.forwardRef(({className:t,...n},s)=>e.jsx(sn,{ref:s,className:ne("aspect-square h-4 w-4 rounded-full border border-primary text-primary shadow focus:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",t),...n,children:e.jsx(Oa,{className:"flex items-center justify-center",children:e.jsx(Tn,{className:"h-3.5 w-3.5 fill-primary"})})}));Ct.displayName=sn.displayName;const rt=["Lundi","Mardi","Mercredi","Jeudi","Vendredi","Samedi","Dimanche"],$a=["L","M","M","J","V","S","D"],We=6,qa=22,rn=qa-We,at=40,Ut=rn*at,Ht=Array.from({length:rn+1},(t,n)=>We+n);function ge(t){return t.slice(0,5)}function Qt(){return new Date().toISOString().slice(0,10)}function La(t){const[n,s]=t.split(":").map(Number);return n*60+s}function _t(t){return(La(t)-We*60)/60*at}function za(t,n){return _t(n)-_t(t)}function Wt(t){const n=new Date(t),s=n.getDay(),o=s===0?-6:1-s;return n.setDate(n.getDate()+o),n.setHours(0,0,0,0),n}function Ka(t){const n=new Date(t);n.setHours(0,0,0,0),n.setDate(n.getDate()+3-(n.getDay()+6)%7);const s=new Date(n.getFullYear(),0,4);return 1+Math.round(((n.getTime()-s.getTime())/864e5-3+(s.getDay()+6)%7)/7)}function gt(t){return t.toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit"})}function st(t){const n=s=>String(s).padStart(2,"0");return`${t.getFullYear()}-${n(t.getMonth()+1)}-${n(t.getDate())}`}function Ga(){const t=new Date().getDay();return t===0?7:t}function an(t){const n=t.toLowerCase();return n.includes("piscine")||n.includes("bassin")||!n.includes("salle")&&!n.includes("muscu")&&!n.includes("ppg")&&!n.includes("gym")}const Va=({open:t,onOpenChange:n,slot:s,groups:o,coaches:a})=>{const{toast:l}=ue(),d=ve(),i=!!s,[x,m]=r.useState("1"),[u,p]=r.useState(""),[f,h]=r.useState(""),[c,v]=r.useState(""),[S,b]=r.useState([]),[y,F]=r.useState(1),[G,I]=r.useState(!1);r.useEffect(()=>{if(t)if(s){m(String(s.day_of_week)),p(ge(s.start_time)),h(ge(s.end_time)),v(s.location);const g=s.assignments.map((C,L)=>({key:L,group_id:String(C.group_id),coach_id:String(C.coach_id),lane_count:C.lane_count!=null?String(C.lane_count):""}));b(g),F(g.length)}else m("1"),p(""),h(""),v(""),b([]),F(1)},[t,s]);const k=()=>{b(g=>[...g,{key:y,group_id:"",coach_id:"",lane_count:""}]),F(g=>g+1)},E=g=>{b(C=>C.filter(L=>L.key!==g))},A=(g,C,L)=>{b(U=>U.map(Z=>Z.key===g?{...Z,[C]:L}:Z))},N=()=>!u||!f?(l({title:"Horaires requis",description:"Veuillez saisir les heures de debut et fin.",variant:"destructive"}),null):c.trim()?{day_of_week:Number(x),start_time:u,end_time:f,location:c.trim(),assignments:S.filter(g=>g.group_id&&g.coach_id).map(g=>({group_id:Number(g.group_id),coach_id:Number(g.coach_id),lane_count:g.lane_count?Number(g.lane_count):null}))}:(l({title:"Lieu requis",description:"Veuillez saisir un lieu.",variant:"destructive"}),null),T=ee({mutationFn:g=>$.createTrainingSlot(g),onSuccess:()=>{l({title:"Creneau cree"}),d.invalidateQueries({queryKey:["training-slots"]}),n(!1)},onError:g=>{l({title:"Erreur",description:g.message,variant:"destructive"})}}),q=ee({mutationFn:g=>$.updateTrainingSlot(s.id,g),onSuccess:()=>{l({title:"Creneau mis a jour"}),d.invalidateQueries({queryKey:["training-slots"]}),n(!1)},onError:g=>{l({title:"Erreur",description:g.message,variant:"destructive"})}}),B=ee({mutationFn:()=>$.deleteTrainingSlot(s.id),onSuccess:()=>{l({title:"Creneau supprime"}),d.invalidateQueries({queryKey:["training-slots"]}),n(!1)},onError:g=>{l({title:"Erreur",description:g.message,variant:"destructive"})}}),z=()=>{const g=N();g&&(i?q.mutate(g):T.mutate(g))},w=T.isPending||q.isPending||B.isPending;return e.jsxs(e.Fragment,{children:[e.jsx(je,{open:t,onOpenChange:n,children:e.jsxs(be,{side:"right",className:"w-full sm:max-w-md overflow-y-auto",children:[e.jsxs(ye,{children:[e.jsx(Ne,{children:i?"Modifier le creneau":"Nouveau creneau"}),e.jsx(ze,{children:i?"Modifiez les details de ce creneau.":"Definissez un nouveau creneau hebdomadaire."})]}),e.jsxs("div",{className:"mt-6 space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(Q,{children:"Jour de la semaine *"}),e.jsxs(ae,{value:x,onValueChange:m,children:[e.jsx(oe,{children:e.jsx(ie,{})}),e.jsx(le,{children:rt.map((g,C)=>e.jsx(X,{value:String(C+1),children:g},C+1))})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(Q,{htmlFor:"slot-start",children:"Debut *"}),e.jsx("input",{id:"slot-start",type:"time",value:u,onChange:g=>p(g.target.value),className:"flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-sm transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Q,{htmlFor:"slot-end",children:"Fin *"}),e.jsx("input",{id:"slot-end",type:"time",value:f,onChange:g=>h(g.target.value),className:"flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-sm transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Q,{htmlFor:"slot-location",children:"Lieu *"}),e.jsx(pe,{id:"slot-location",placeholder:"Ex : Piscine Erstein",value:c,onChange:g=>v(g.target.value)})]}),e.jsx(cs,{}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(Q,{children:"Groupes & Coachs"}),e.jsxs(K,{type:"button",variant:"outline",size:"sm",onClick:k,children:[e.jsx(he,{className:"mr-1 h-3.5 w-3.5"}),"Ajouter"]})]}),S.length===0&&e.jsx("p",{className:"text-xs text-muted-foreground text-center py-2",children:"Aucun groupe assigne."}),S.map(g=>e.jsx("div",{className:"rounded-lg border p-3 space-y-2",children:e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs(ae,{value:g.group_id,onValueChange:C=>A(g.key,"group_id",C),children:[e.jsx(oe,{className:"h-8 text-xs",children:e.jsx(ie,{placeholder:"Groupe..."})}),e.jsx(le,{children:o.map(C=>e.jsx(X,{value:String(C.id),children:C.name},C.id))})]}),e.jsxs(ae,{value:g.coach_id,onValueChange:C=>A(g.key,"coach_id",C),children:[e.jsx(oe,{className:"h-8 text-xs",children:e.jsx(ie,{placeholder:"Coach..."})}),e.jsx(le,{children:a.map(C=>e.jsx(X,{value:String(C.id),children:C.display_name},C.id))})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(pe,{type:"number",min:0,placeholder:"Lignes d'eau",value:g.lane_count,onChange:C=>A(g.key,"lane_count",C.target.value),className:"h-8 text-xs flex-1"}),e.jsx(K,{type:"button",variant:"ghost",size:"icon",className:"h-8 w-8 text-muted-foreground hover:text-destructive shrink-0",onClick:()=>E(g.key),children:e.jsx(it,{className:"h-3.5 w-3.5"})})]})]})},g.key))]}),e.jsxs("div",{className:"space-y-2 pt-2",children:[e.jsx(K,{className:"w-full",onClick:z,disabled:w||!u||!f||!c.trim(),children:w?"Enregistrement...":i?"Enregistrer":"Creer"}),i&&e.jsx(K,{variant:"outline",className:"w-full text-destructive hover:text-destructive",onClick:()=>I(!0),disabled:w,children:"Supprimer ce creneau"})]})]})]})}),e.jsx(Ee,{open:G,onOpenChange:I,children:e.jsxs(Re,{children:[e.jsxs(Pe,{children:[e.jsx(Fe,{children:"Supprimer le creneau"}),e.jsx(Ie,{children:"Ce creneau sera desactive. Les exceptions associees resteront en base mais ne seront plus visibles."})]}),e.jsxs(Te,{children:[e.jsx(Oe,{children:"Annuler"}),e.jsx($e,{onClick:()=>{B.mutate(),I(!1)},className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Supprimer"})]})]})})]})},Ba=({open:t,onOpenChange:n,slot:s})=>{const{toast:o}=ue(),a=ve(),[l,d]=r.useState(""),[i,x]=r.useState("cancelled"),[m,u]=r.useState(""),[p,f]=r.useState(""),[h,c]=r.useState(""),[v,S]=r.useState("");r.useEffect(()=>{t&&(d(""),x("cancelled"),u(s?ge(s.start_time):""),f(s?ge(s.end_time):""),c(s?.location??""),S(""))},[t,s]);const b=ee({mutationFn:F=>$.createSlotOverride(F),onSuccess:()=>{o({title:"Exception enregistree"}),a.invalidateQueries({queryKey:["training-slot-overrides"]}),a.invalidateQueries({queryKey:["training-slots"]}),n(!1)},onError:F=>{o({title:"Erreur",description:F.message,variant:"destructive"})}}),y=()=>{if(!s)return;if(!l){o({title:"Date requise",description:"Veuillez saisir la date de l'exception.",variant:"destructive"});return}const F={slot_id:s.id,override_date:l,status:i,new_start_time:i==="modified"&&m||null,new_end_time:i==="modified"&&p||null,new_location:i==="modified"&&h.trim()?h.trim():null,reason:v.trim()||null};b.mutate(F)};return e.jsx(je,{open:t,onOpenChange:n,children:e.jsxs(be,{side:"right",className:"w-full sm:max-w-md overflow-y-auto",children:[e.jsxs(ye,{children:[e.jsx(Ne,{children:"Exception"}),e.jsx(ze,{children:"Annulez ou modifiez ce creneau pour une date precise."})]}),e.jsxs("div",{className:"mt-6 space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(Q,{htmlFor:"override-date",children:"Date *"}),e.jsx("input",{id:"override-date",type:"date",value:l,onChange:F=>d(F.target.value),className:"flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-sm transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Q,{children:"Type"}),e.jsxs(nn,{value:i,onValueChange:F=>x(F),className:"flex gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ct,{value:"cancelled",id:"ovr-cancelled"}),e.jsx(Q,{htmlFor:"ovr-cancelled",className:"font-normal",children:"Annule"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ct,{value:"modified",id:"ovr-modified"}),e.jsx(Q,{htmlFor:"ovr-modified",className:"font-normal",children:"Modifie"})]})]})]}),i==="modified"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(Q,{htmlFor:"ovr-start",children:"Nouvel horaire debut"}),e.jsx("input",{id:"ovr-start",type:"time",value:m,onChange:F=>u(F.target.value),className:"flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-sm transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Q,{htmlFor:"ovr-end",children:"Nouvel horaire fin"}),e.jsx("input",{id:"ovr-end",type:"time",value:p,onChange:F=>f(F.target.value),className:"flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-sm transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Q,{htmlFor:"ovr-location",children:"Nouveau lieu"}),e.jsx(pe,{id:"ovr-location",value:h,onChange:F=>c(F.target.value)})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Q,{htmlFor:"ovr-reason",children:"Motif"}),e.jsx(pe,{id:"ovr-reason",placeholder:"Ex : Vacances scolaires",value:v,onChange:F=>S(F.target.value)})]}),e.jsx(K,{className:"w-full",onClick:y,disabled:b.isPending||!l,children:b.isPending?"Enregistrement...":"Enregistrer"})]})]})})},Ua=({slot:t,hasOverrides:n,cancelled:s=!1,onSelect:o})=>{const a=_t(t.start_time),l=za(t.start_time,t.end_time),d=l<50,i=an(t.location),x=s?"bg-muted/50 border-muted-foreground/20 opacity-50 line-through":i?"bg-blue-500/15 border-blue-400/40 hover:bg-blue-500/25":"bg-amber-400/15 border-amber-400/40 hover:bg-amber-400/25",m=i?"text-blue-500":"text-amber-500";return e.jsx("button",{type:"button",className:`absolute left-0.5 right-0.5 rounded-md border px-1.5 py-0.5 text-left overflow-hidden cursor-pointer transition-colors ${x}`,style:{top:a,height:l,minHeight:24},onClick:()=>o(t),title:`${ge(t.start_time)}–${ge(t.end_time)} · ${t.location}`,children:e.jsxs("div",{className:`flex flex-col gap-0.5 ${d?"flex-row items-center":""}`,children:[e.jsxs("div",{className:"flex items-center gap-1 min-w-0",children:[e.jsx(Et,{className:`h-2.5 w-2.5 shrink-0 ${m}`}),e.jsx("span",{className:"text-[10px] font-medium text-foreground truncate",children:t.location}),n&&!s&&e.jsx(Dt,{className:"h-2.5 w-2.5 text-orange-500 shrink-0"})]}),!d&&t.assignments.length>0&&e.jsx("div",{className:"flex flex-wrap gap-0.5",children:t.assignments.map(u=>e.jsx(re,{variant:"secondary",className:"text-[9px] px-1 py-0 leading-tight",children:u.group_name},u.id))}),!d&&l>=70&&t.assignments.length>0&&e.jsx("span",{className:"text-[9px] text-muted-foreground truncate",children:[...new Set(t.assignments.map(u=>u.coach_name))].join(", ")})]})})},Ha=({slot:t,open:n,onOpenChange:s,overrides:o,onEdit:a,onOverride:l,onDeleteOverride:d})=>t?e.jsx(je,{open:n,onOpenChange:s,children:e.jsxs(be,{side:"bottom",className:"max-h-[60vh] overflow-y-auto rounded-t-2xl",children:[e.jsxs(ye,{className:"pb-2",children:[e.jsxs(Ne,{className:"text-left text-base",children:[rt[t.day_of_week-1]," · ",ge(t.start_time),"–",ge(t.end_time)]}),e.jsx(ze,{className:"sr-only",children:"Details du creneau"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-sm text-muted-foreground",children:[e.jsx(Et,{className:"h-3.5 w-3.5 shrink-0"}),t.location]}),t.assignments.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1.5",children:t.assignments.map(i=>e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(re,{variant:"secondary",className:"text-xs px-2 py-0.5",children:i.group_name}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[i.coach_name,i.lane_count!=null&&` · ${i.lane_count} ligne${i.lane_count>1?"s":""}`]})]},i.id))}),o.length>0&&e.jsxs("div",{className:"space-y-1.5 pt-1 border-t border-dashed",children:[e.jsx("span",{className:"text-xs font-semibold text-muted-foreground uppercase tracking-wider",children:"Exceptions"}),o.map(i=>e.jsxs("div",{className:"flex items-center gap-1.5 text-xs",children:[e.jsx(Dt,{className:"h-3 w-3 text-orange-500 shrink-0"}),e.jsx("span",{className:"text-muted-foreground",children:new Date(i.override_date+"T00:00:00").toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit"})}),e.jsx(re,{variant:i.status==="cancelled"?"destructive":"outline",className:"text-[10px] px-1 py-0",children:i.status==="cancelled"?"Annule":"Modifie"}),i.reason&&e.jsx("span",{className:"text-muted-foreground truncate flex-1",children:i.reason}),e.jsx(K,{variant:"ghost",size:"icon",className:"h-6 w-6 ml-auto shrink-0 text-muted-foreground hover:text-destructive",onClick:()=>d(i.id),children:e.jsx(it,{className:"h-3 w-3"})})]},i.id))]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx(K,{variant:"outline",size:"sm",className:"flex-1",onClick:a,children:"Modifier"}),e.jsx(K,{variant:"outline",size:"sm",className:"flex-1",onClick:l,children:"Exception"})]})]})]})}):null,Qa=({selectedDay:t,onSelectDay:n,weekDates:s,todayIso:o})=>e.jsx("div",{className:"flex items-center justify-between gap-1 px-1",children:s.map((a,l)=>{const d=l+1,i=d===t,x=st(a)===o;return e.jsxs("button",{type:"button",className:`flex flex-col items-center justify-center rounded-xl py-1.5 flex-1 min-w-0 transition-all active:scale-95 ${i?"bg-primary text-primary-foreground shadow-sm":"text-muted-foreground hover:bg-muted"}`,onClick:()=>n(d),children:[e.jsx("span",{className:"text-[10px] font-semibold uppercase",children:$a[l]}),e.jsx("span",{className:`text-sm font-bold leading-tight ${i?"":"text-foreground"}`,children:a.getDate()}),x&&!i&&e.jsx("span",{className:"h-1 w-1 rounded-full bg-primary mt-0.5"}),x&&i&&e.jsx("span",{className:"h-1 w-1 rounded-full bg-primary-foreground mt-0.5"}),!x&&e.jsx("span",{className:"h-1 mt-0.5"})]},d)})}),Wa=({slot:t,cancelled:n,hasOverrides:s,onSelect:o})=>{const a=an(t.location),l=n?"border-l-muted-foreground/30":a?"border-l-blue-500":"border-l-amber-500";return e.jsx("button",{type:"button",className:`w-full text-left rounded-xl border bg-card p-3 border-l-[3px] ${l} transition-all active:scale-[0.98] hover:shadow-md ${n?"opacity-50":""}`,onClick:()=>o(t),children:e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"min-w-0 flex-1 space-y-1.5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:`text-sm font-bold tabular-nums ${n?"line-through":""}`,children:[ge(t.start_time)," – ",ge(t.end_time)]}),s&&!n&&e.jsx(Dt,{className:"h-3 w-3 text-orange-500 shrink-0"}),n&&e.jsx(re,{variant:"destructive",className:"text-[9px] px-1.5 py-0",children:"Annule"})]}),e.jsxs("div",{className:"flex items-center gap-1 text-xs text-muted-foreground",children:[e.jsx(Et,{className:`h-3 w-3 shrink-0 ${a?"text-blue-500":"text-amber-500"}`}),e.jsx("span",{className:"truncate",children:t.location})]}),t.assignments.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1",children:t.assignments.map(d=>e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(re,{variant:"secondary",className:"text-[10px] px-1.5 py-0",children:d.group_name}),e.jsx("span",{className:"text-[10px] text-muted-foreground",children:d.coach_name})]},d.id))})]}),e.jsx(ms,{className:"h-4 w-4 text-muted-foreground/40 shrink-0 mt-0.5"})]})})},Ya=({onBack:t,groups:n})=>{const{toast:s}=ue(),o=ve(),[a,l]=r.useState(!1),[d,i]=r.useState(null),[x,m]=r.useState(null),[u,p]=r.useState(!1),[f,h]=r.useState(null),[c,v]=r.useState(!1),[S,b]=r.useState(()=>Ga()),[y,F]=r.useState(()=>Wt(new Date)),G=r.useMemo(()=>Ka(y),[y]),I=r.useMemo(()=>{const D=new Date(y);return D.setDate(D.getDate()+6),D},[y]),k=r.useMemo(()=>Array.from({length:7},(D,O)=>{const Y=new Date(y);return Y.setDate(Y.getDate()+O),Y}),[y]),E=()=>F(D=>{const O=new Date(D);return O.setDate(O.getDate()-7),O}),A=()=>F(D=>{const O=new Date(D);return O.setDate(O.getDate()+7),O}),N=()=>F(Wt(new Date)),[T,q]=r.useState("group"),[B,z]=r.useState("all"),[w,g]=r.useState("all"),{data:C=[],isLoading:L}=W({queryKey:["training-slots"],queryFn:()=>$.getTrainingSlots()}),{data:U=[]}=W({queryKey:["training-slot-overrides"],queryFn:()=>$.getSlotOverrides()}),{data:Z=[]}=W({queryKey:["users","coaches"],queryFn:()=>$.listUsers({role:"coach"})}),P=r.useMemo(()=>{if(T==="coach"&&B!=="all"){const D=Number(B);return C.filter(O=>O.assignments.some(Y=>Y.coach_id===D))}if(T==="group"&&w!=="all"){const D=Number(w);return C.filter(O=>O.assignments.some(Y=>Y.group_id===D))}return C},[C,T,B,w]),J=r.useMemo(()=>{const D=new Map;for(let O=1;O<=7;O++)D.set(O,[]);for(const O of P)D.get(O.day_of_week).push(O);for(const O of D.values())O.sort((Y,dn)=>Y.start_time.localeCompare(dn.start_time));return D},[P]),j=st(y),R=st(I),_=r.useMemo(()=>U.filter(D=>D.override_date>=j&&D.override_date<=R),[U,j,R]),M=r.useMemo(()=>{const D=new Map;for(const O of _){const Y=D.get(O.slot_id)??[];Y.push(O),D.set(O.slot_id,Y)}return D},[_]),V=r.useMemo(()=>{const D=new Set;for(const O of _)O.status==="cancelled"&&D.add(O.slot_id);return D},[_]),H=ee({mutationFn:D=>$.deleteSlotOverride(D),onSuccess:()=>{s({title:"Exception supprimee"}),o.invalidateQueries({queryKey:["training-slot-overrides"]})},onError:D=>{s({title:"Erreur",description:D.message,variant:"destructive"})}}),te=()=>{i(null),l(!0)},se=D=>{h(D),v(!0)},_e=()=>{f&&(v(!1),i(f),l(!0))},on=()=>{f&&(v(!1),m(f),p(!0))},ln=Z.map(D=>({id:D.id,display_name:D.display_name})),cn=C.length===0?"Planning hebdomadaire des entrainements.":`${C.length} creneau${C.length>1?"x":""}`;return e.jsxs("div",{className:"space-y-4 pb-24",children:[e.jsx(xe,{title:"Creneaux",description:cn,onBack:t,actions:e.jsxs(K,{variant:"outline",size:"sm",onClick:te,children:[e.jsx(he,{className:"mr-1.5 h-3.5 w-3.5"}),"Nouveau"]})}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx(K,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:E,children:e.jsx(Hn,{className:"h-4 w-4"})}),e.jsxs("button",{type:"button",className:"flex items-center gap-2 rounded-lg border bg-card px-3 py-1.5 text-sm font-semibold hover:bg-muted/50 transition-colors",onClick:N,title:"Revenir a cette semaine",children:[e.jsxs("span",{className:"text-primary",children:["S",G]}),e.jsxs("span",{className:"text-muted-foreground text-xs font-normal",children:[gt(y)," – ",gt(I)]})]}),e.jsx(K,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:A,children:e.jsx(ms,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center",children:[e.jsxs(ot,{type:"single",value:T,onValueChange:D=>{(D==="coach"||D==="group")&&q(D)},className:"shrink-0",children:[e.jsx(me,{value:"group",className:"text-xs px-3",children:"Groupe"}),e.jsx(me,{value:"coach",className:"text-xs px-3",children:"Coach"})]}),T==="group"?e.jsxs(ae,{value:w,onValueChange:g,children:[e.jsx(oe,{className:"w-full sm:w-56",children:e.jsx(ie,{placeholder:"Tous les groupes"})}),e.jsxs(le,{children:[e.jsx(X,{value:"all",children:"Tous les groupes"}),n.map(D=>e.jsx(X,{value:String(D.id),children:D.name},D.id))]})]}):e.jsxs(ae,{value:B,onValueChange:z,children:[e.jsx(oe,{className:"w-full sm:w-56",children:e.jsx(ie,{placeholder:"Tous les coachs"})}),e.jsxs(le,{children:[e.jsx(X,{value:"all",children:"Tous les coachs"}),Z.map(D=>e.jsx(X,{value:String(D.id),children:D.display_name},D.id))]})]})]})]}),L?e.jsx("div",{className:"grid grid-cols-7 gap-2",children:Array.from({length:7},(D,O)=>e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-4 w-12 rounded bg-muted animate-pulse motion-reduce:animate-none"}),e.jsx("div",{className:"h-40 rounded-lg bg-muted animate-pulse motion-reduce:animate-none"})]},O))}):C.length===0?e.jsxs("div",{className:"text-center py-12 space-y-3",children:[e.jsx(ps,{className:"h-10 w-10 text-muted-foreground mx-auto"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Aucun creneau defini."}),e.jsxs(K,{variant:"outline",size:"sm",onClick:te,children:[e.jsx(he,{className:"mr-1.5 h-3.5 w-3.5"}),"Creer le premier creneau"]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"sm:hidden space-y-3",children:[e.jsx(Qa,{selectedDay:S,onSelectDay:b,weekDates:k,todayIso:Qt()}),(()=>{const D=J.get(S)??[];return D.length===0?e.jsxs("p",{className:"text-center text-sm text-muted-foreground py-8",children:["Aucun créneau ",rt[S-1].toLowerCase(),"."]}):e.jsx("div",{className:"space-y-2",children:D.map(O=>e.jsx(Wa,{slot:O,cancelled:V.has(O.id),hasOverrides:(M.get(O.id)??[]).length>0,onSelect:se},O.id))})})()]}),e.jsx("div",{className:"hidden sm:block overflow-x-auto -mx-4 px-4",children:e.jsxs("div",{className:"grid",style:{minWidth:"760px",gridTemplateColumns:"2rem repeat(7, 1fr)"},children:[e.jsx("div",{})," ",k.map((D,O)=>{const Y=st(D)===Qt();return e.jsxs("div",{className:"text-center pb-1.5",children:[e.jsx("span",{className:"text-[10px] font-semibold uppercase tracking-[0.15em] text-muted-foreground",children:rt[O]}),e.jsx("br",{}),e.jsx("span",{className:`text-[10px] ${Y?"text-primary font-bold":"text-muted-foreground/60"}`,children:gt(D)})]},O)}),e.jsx("div",{className:"relative",style:{height:Ut},children:Ht.map(D=>e.jsxs("span",{className:"absolute right-1 text-[9px] text-muted-foreground/70 leading-none -translate-y-1/2",style:{top:(D-We)*at},children:[D,"h"]},D))}),Array.from({length:7},(D,O)=>O+1).map(D=>{const O=J.get(D)??[];return e.jsxs("div",{className:"relative border-l border-border/40",style:{height:Ut},children:[Ht.map(Y=>e.jsx("div",{className:"absolute left-0 right-0 border-t border-border/20",style:{top:(Y-We)*at}},Y)),O.map(Y=>e.jsx(Ua,{slot:Y,hasOverrides:(M.get(Y.id)??[]).length>0,cancelled:V.has(Y.id),onSelect:se},Y.id))]},D)})]})})]}),e.jsx(Ha,{slot:f,open:c,onOpenChange:v,overrides:f?M.get(f.id)??[]:[],onEdit:_e,onOverride:on,onDeleteOverride:D=>H.mutate(D)}),e.jsx(Va,{open:a,onOpenChange:l,slot:d,groups:n,coaches:ln}),e.jsx(Ba,{open:u,onOpenChange:p,slot:x})]})},Ja=r.lazy(()=>ns(()=>import("./StrengthCatalog-BP9T7bSs.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45]))),Xa=r.lazy(()=>ns(()=>import("./SwimCatalog-DTa1EeOd.js"),__vite__mapDeps([46,1,2,3,4,5,6,7,9,10,11,17,24,47,48,16,49,50,15,44,20,21,22,23,14,19,25,26,27,28,29,8,13,38,51,31,52,53,33]))),Za=({onNavigate:t,onOpenRecordsAdmin:n,onOpenRecordsClub:s,athletes:o,athletesLoading:a,upcomingBirthdays:l,birthdaysLoading:d,kpiLoading:i,kpiPeriod:x,onKpiPeriodChange:m,fatigueAlerts:u,mostLoadedAthlete:p,swimSessionCount:f,strengthSessionCount:h})=>{const c=new Date().getHours(),v=c<12?"Bonjour":c<18?"Bon après-midi":"Bonsoir",S=new Date().toLocaleDateString("fr-FR",{weekday:"long",day:"numeric",month:"long"}),b=u.length>0;return e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-display font-bold uppercase italic",children:[v,", ",e.jsx("span",{className:"text-primary",children:"Coach"})]}),e.jsx("p",{className:"text-sm text-muted-foreground capitalize",children:S})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h2",{className:"text-xs font-semibold uppercase tracking-[0.15em] text-muted-foreground",children:["Signaux · ",x,"j"]}),e.jsxs(ot,{type:"single",size:"sm",variant:"outline",value:String(x),onValueChange:y=>{y&&m(Number(y))},children:[e.jsx(me,{value:"7",className:"h-7 px-2 text-xs","aria-label":"7 jours",children:"7j"}),e.jsx(me,{value:"30",className:"h-7 px-2 text-xs","aria-label":"30 jours",children:"30j"}),e.jsx(me,{value:"365",className:"h-7 px-2 text-xs","aria-label":"1 an",children:"1an"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:`rounded-xl border p-3 ${b?"border-destructive/30 bg-destructive/5":"bg-muted/30"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-[11px] text-muted-foreground",children:"Fatigue 5/5"}),e.jsx(Zn,{className:`h-3.5 w-3.5 ${b?"text-destructive":"text-muted-foreground"}`})]}),e.jsx("p",{className:"text-xl font-bold tabular-nums",children:i?"–":u.length}),e.jsx("p",{className:"text-[11px] text-muted-foreground truncate",children:i?"Chargement…":b?u.slice(0,2).map(y=>y.athleteName.split(" ")[0]).join(", "):"Aucune alerte"})]}),e.jsxs("div",{className:"rounded-xl border bg-muted/30 p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-[11px] text-muted-foreground",children:"Plus chargé"}),e.jsx(nt,{className:"h-3.5 w-3.5 text-muted-foreground"})]}),e.jsx("p",{className:"text-xl font-bold truncate",children:i?"–":p?.athleteName?.split(" ")[0]??"–"}),e.jsx("p",{className:"text-[11px] text-muted-foreground",children:i?"Calcul…":p?`Charge ${Math.round(p.loadScore)}`:"Pas de données"})]})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs("button",{type:"button",onClick:()=>t("calendar"),className:"flex items-center gap-1.5 rounded-full bg-primary text-primary-foreground px-3.5 py-2 text-sm font-semibold active:opacity-80 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",children:[e.jsx(jt,{className:"h-3.5 w-3.5"}),"Assigner"]}),e.jsxs("button",{type:"button",onClick:()=>t("messaging"),className:"flex items-center gap-1.5 rounded-full border px-3.5 py-2 text-sm font-semibold active:bg-muted focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",children:[e.jsx(xs,{className:"h-3.5 w-3.5"}),"Email"]}),e.jsxs("button",{type:"button",onClick:()=>t("sms"),className:"flex items-center gap-1.5 rounded-full border px-3.5 py-2 text-sm font-semibold active:bg-muted focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",children:[e.jsx(as,{className:"h-3.5 w-3.5"}),"SMS"]}),e.jsxs("button",{type:"button",onClick:()=>t("groups"),className:"flex items-center gap-1.5 rounded-full border px-3.5 py-2 text-sm font-semibold active:bg-muted focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",children:[e.jsx(gs,{className:"h-3.5 w-3.5"}),"Groupes"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("button",{type:"button",onClick:()=>t("swim"),className:"rounded-xl border bg-card p-4 text-left shadow-sm active:bg-muted/50 transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",children:[e.jsx(ts,{className:"h-5 w-5 text-primary mb-2"}),e.jsx("p",{className:"text-sm font-bold",children:"Natation"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:f!=null?`${f} séance${f!==1?"s":""}`:"Bibliothèque"})]}),e.jsxs("button",{type:"button",onClick:()=>t("strength"),className:"rounded-xl border bg-card p-4 text-left shadow-sm active:bg-muted/50 transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",children:[e.jsx(ss,{className:"h-5 w-5 text-primary mb-2"}),e.jsx("p",{className:"text-sm font-bold",children:"Musculation"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:h!=null?`${h} séance${h!==1?"s":""}`:"Bibliothèque"})]}),e.jsxs("button",{type:"button",onClick:()=>t("swimmers"),className:"rounded-xl border bg-card p-4 text-left shadow-sm active:bg-muted/50 transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",children:[e.jsx(nt,{className:"h-5 w-5 text-primary mb-2"}),e.jsx("p",{className:"text-sm font-bold",children:"Nageurs"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:a?"Chargement…":`${o.length} nageur${o.length!==1?"s":""}`})]}),e.jsxs("button",{type:"button",onClick:n,className:"rounded-xl border bg-card p-4 text-left shadow-sm active:bg-muted/50 transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",children:[e.jsx(ft,{className:"h-5 w-5 text-primary mb-2"}),e.jsx("p",{className:"text-sm font-bold",children:"Records club"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Import & administration"})]}),e.jsxs("button",{type:"button",onClick:()=>t("competitions"),className:"rounded-xl border bg-card p-4 text-left shadow-sm active:bg-muted/50 transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",children:[e.jsx(ft,{className:"h-5 w-5 text-amber-500 mb-2"}),e.jsx("p",{className:"text-sm font-bold",children:"Compétitions"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Échéances & calendrier"})]}),e.jsxs("button",{type:"button",onClick:()=>t("objectives"),className:"rounded-xl border bg-card p-4 text-left shadow-sm active:bg-muted/50 transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",children:[e.jsx(vt,{className:"h-5 w-5 text-primary mb-2"}),e.jsx("p",{className:"text-sm font-bold",children:"Objectifs"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Temps cibles & objectifs"})]}),e.jsxs("button",{type:"button",onClick:()=>t("training-slots"),className:"rounded-xl border bg-card p-4 text-left shadow-sm active:bg-muted/50 transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",children:[e.jsx(ps,{className:"h-5 w-5 text-primary mb-2"}),e.jsx("p",{className:"text-sm font-bold",children:"Creneaux"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Planning hebdo"})]})]}),e.jsx("button",{type:"button",onClick:s,className:"w-full text-center text-sm text-primary font-semibold py-1 active:opacity-70 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring rounded",children:"Voir les records du club"}),!d&&l&&l.length>0?e.jsxs("div",{className:"space-y-2",children:[e.jsx("h2",{className:"text-xs font-semibold uppercase tracking-[0.15em] text-muted-foreground",children:"Anniversaires"}),e.jsx("div",{className:"space-y-1.5",children:l.slice(0,3).map(y=>e.jsxs("div",{className:"flex items-center justify-between gap-2 rounded-lg border px-3 py-2",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("span",{className:"text-sm font-medium truncate block",children:y.display_name}),e.jsx("span",{className:"text-[11px] text-muted-foreground",children:eo(y.next_birthday)})]}),e.jsxs("span",{className:"text-xs font-bold text-primary shrink-0",children:["J-",y.days_until]})]},y.id))})]}):null]})},eo=t=>{if(!t)return"-";const n=new Date(t);return Number.isNaN(n.getTime())?t:n.toLocaleDateString("fr-FR")},Yt=t=>t.toISOString().split("T")[0],to=t=>new Date(t.completed_at||t.started_at||t.date||t.created_at||0).getTime(),so=t=>{if(!t.length)return null;const n=t.reduce((o,a)=>o+a,0)/t.length,s=Math.min(5,Math.max(1,Math.round(n/10*5)));return{average:n,rating:s}};function no(){const t=Tt(k=>k.role),n=Tt(k=>k.setSelectedAthlete),[,s]=bn(),[o,a]=r.useState(()=>window.location.hash.match(/[?&]section=([^&]+)/)?.[1]||"home"),[l,d]=r.useState(7);r.useEffect(()=>{const k=()=>a("home");return window.addEventListener("nav:reset",k),()=>window.removeEventListener("nav:reset",k)},[]);const i=t==="coach"||t==="admin",x=o==="home"||o==="calendar",m=o==="home"||o==="messaging"||o==="sms"||o==="swimmers"||o==="calendar"||o==="groups"||o==="objectives",u=o==="messaging"||o==="sms"||o==="calendar"||o==="groups"||o==="training-slots",p=o==="home"||o==="swimmers",{data:f}=W({queryKey:["swim_catalog"],queryFn:()=>$.getSwimCatalog(),enabled:i&&x}),{data:h}=W({queryKey:["strength_catalog"],queryFn:()=>$.getStrengthSessions(),enabled:i&&x}),{data:c=[],isLoading:v}=W({queryKey:["athletes"],queryFn:()=>$.getAthletes(),enabled:i&&m}),S=r.useMemo(()=>c.slice(0,5),[c]),{data:b=[]}=W({queryKey:["groups"],queryFn:()=>$.getGroups(),enabled:i&&u}),y=W({queryKey:["upcoming-birthdays"],queryFn:()=>$.getUpcomingBirthdays({days:30}),enabled:i&&p}),F=y.data,G=W({queryKey:["coach-kpis",l,S.map(k=>k.id??k.display_name)],enabled:i&&o==="home"&&S.length>0,queryFn:async()=>{const k=l,E=new Date;E.setDate(E.getDate()-k);const A=Yt(E),N=Yt(new Date),T=await Promise.all(S.map(async z=>{const[w,g]=await Promise.all([$.getSessions(z.display_name,z.id),$.getStrengthHistory(z.display_name,{athleteId:z.id,limit:50,from:A,to:N})]),C=w.filter(_=>new Date(_.date).getTime()>=E.getTime()),L=C.map(_=>_.fatigue??_.feeling).filter(_=>Number.isFinite(_)),U=C.reduce((_,M)=>_+(Number(M.duration)||0)*(Number(M.effort)||0),0),P=(g?.runs??[]).filter(_=>to(_)>=E.getTime()),J=P.map(_=>_.fatigue??_.feeling??_.rpe).filter(_=>Number.isFinite(Number(_))).map(_=>Number(_)),j=P.reduce((_,M)=>{const V=Number(M.feeling??M.rpe??0),H=Number(M.duration??0);if(H>0&&V>0)return _+H*V;const te=Array.isArray(M.logs)?M.logs.length:0;return _+te*5},0),R=so([...L,...J]);return{athleteName:z.display_name,loadScore:U+j,fatigueRating:R}})),q=T.filter(z=>z.fatigueRating?.rating===5).map(z=>({athleteName:z.athleteName,rating:z.fatigueRating?.rating??0})),B=T.filter(z=>z.loadScore>0).sort((z,w)=>w.loadScore-z.loadScore)[0];return{fatigueAlerts:q,mostLoadedAthlete:B??null}}}),I=k=>{n({id:k.id??null,name:k.display_name}),s(k.id!=null?`/coach/swimmer/${k.id}`:"/progress")};return ue(),i?e.jsxs("div",{className:"space-y-6",children:[o==="home"?e.jsx(Za,{onNavigate:a,onOpenRecordsAdmin:()=>s("/records-admin"),onOpenRecordsClub:()=>s("/records-club"),athletes:c,athletesLoading:v,upcomingBirthdays:F,birthdaysLoading:y.isLoading,kpiLoading:G.isLoading,kpiPeriod:l,onKpiPeriodChange:d,fatigueAlerts:G.data?.fatigueAlerts??[],mostLoadedAthlete:G.data?.mostLoadedAthlete??null,swimSessionCount:f?.length,strengthSessionCount:h?.length}):null,o==="swim"?e.jsxs("div",{className:"space-y-6",children:[e.jsx(xe,{title:"Bibliothèque natation",description:"Accédez aux séances et aux templates natation.",onBack:()=>a("home"),actions:e.jsxs(K,{variant:"outline",size:"sm",onClick:()=>a("calendar"),children:[e.jsx(jt,{className:"mr-1.5 h-3.5 w-3.5"}),"Assigner"]})}),e.jsx(r.Suspense,{fallback:e.jsx(Ot,{}),children:e.jsx(Xa,{})})]}):null,o==="strength"?e.jsxs("div",{className:"space-y-6",children:[e.jsx(xe,{title:"Bibliothèque musculation",description:"Consultez et créez des séances musculation.",onBack:()=>a("home"),actions:e.jsxs(K,{variant:"outline",size:"sm",onClick:()=>a("calendar"),children:[e.jsx(jt,{className:"mr-1.5 h-3.5 w-3.5"}),"Assigner"]})}),e.jsx(r.Suspense,{fallback:e.jsx(Ot,{}),children:e.jsx(Ja,{})})]}):null,o==="swimmers"?e.jsx(rr,{athletes:c,athletesLoading:v,onBack:()=>a("home"),onOpenAthlete:I}):null,o==="messaging"?e.jsx(ar,{onBack:()=>a("home"),athletes:c,groups:b,athletesLoading:v}):null,o==="sms"?e.jsx(sa,{onBack:()=>a("home"),athletes:c,groups:b,athletesLoading:v}):null,o==="calendar"?e.jsx(ia,{onBack:()=>a("home"),athletes:c,groups:b,swimSessions:f,strengthSessions:h}):null,o==="groups"?e.jsx(ua,{onBack:()=>a("home"),athletes:c,groups:b,athletesLoading:v}):null,o==="competitions"?e.jsx(ja,{onBack:()=>a("home")}):null,o==="objectives"?e.jsx(wa,{onBack:()=>a("home"),athletes:c,athletesLoading:v}):null,o==="training-slots"?e.jsx(Ya,{onBack:()=>a("home"),groups:b}):null]}):e.jsx("div",{className:"flex items-center justify-center min-h-[60vh] animate-in fade-in motion-reduce:animate-none",children:e.jsxs(Ve,{className:"w-full max-w-sm shadow-xl border-t-4 border-t-primary",children:[e.jsxs(Be,{children:[e.jsxs(Ue,{className:"flex items-center gap-2 uppercase italic",children:[e.jsx(nt,{className:"h-5 w-5 text-primary"}),"Accès Coach"]}),e.jsx(He,{children:"Cette section est réservée aux coachs et administrateurs."})]}),e.jsx(Qe,{children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"Connectez-vous avec un compte autorisé pour accéder aux outils de gestion."})})]})})}const To=Object.freeze(Object.defineProperty({__proto__:null,default:no},Symbol.toStringTag,{value:"Module"}));export{Os as C,Dr as P,nn as R,$s as a,qs as b,Ls as c,Nt as d,wt as e,Ar as f,Ms as g,Ct as h,To as i};
