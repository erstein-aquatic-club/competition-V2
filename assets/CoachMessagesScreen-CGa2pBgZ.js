import{r as l,j as e}from"./vendor-query-DyA9aSKS.js";import{d as O,C as p,h,j as x,k as j,e as g,L as w,I as y,B as k}from"./index-CaymzWPA.js";import{S as E,a as I,b as M,c as _,d as i}from"./select-B-gc7FGF.js";import{C as $,M as L}from"./Coach-BdQunFx2.js";import{E as T}from"./external-link-pZBm0Y-t.js";import"./vendor-react-BzrpNAyj.js";import"./vendor-charts-BrQ8X25f.js";import"./vendor-supabase-DFPLkPj_.js";import"./vendor-motion-CMsaQ8FX.js";import"./index-C9Jeqwy0.js";import"./index-DhR7K6_b.js";import"./index-DCX2sNhR.js";import"./chevron-down-D3XCJ4j6.js";import"./chevron-up-7dJD_DgF.js";import"./api-C8FUMEvA.js";import"./swim-j4S41wyf.js";import"./toggle-group-ayAOR5xH.js";import"./index-C2Zanesf.js";import"./target-CfxLb7jJ.js";import"./clock-95sJ0HTE.js";const se=({onBack:b,athletes:n,groups:m,athletesLoading:v})=>{const{toast:C}=O(),[o,f]=l.useState(""),[a,S]=l.useState(""),c=l.useMemo(()=>n.filter(s=>s.id&&s.email).map(s=>({value:`user:${s.id}`,label:s.group_label?`${s.display_name} · ${s.group_label}`:s.display_name,email:s.email})),[n]),u=l.useMemo(()=>m.map(s=>({value:`group:${s.id}`,label:s.name,id:s.id})),[m]),d=()=>{if(!a)return[];if(a.startsWith("user:")){const s=c.find(t=>t.value===a);return s?[s.email]:[]}if(a.startsWith("group:")){const s=Number(a.split(":")[1]);return n.filter(t=>t.group_id===s&&t.email).map(t=>t.email)}return[]},N=()=>{const s=d();if(!s.length){C({title:"Aucune adresse email",description:"Aucun nageur avec une adresse email dans cette sélection."});return}const t=new URLSearchParams;t.set("bcc",s.join(",")),o.trim()&&t.set("subject",o.trim()),window.location.href=`mailto:?${t.toString()}`},r=d();return e.jsxs("div",{className:"space-y-6 pb-24",children:[e.jsx($,{title:"Contacter par email",description:"Ouvre votre application mail avec les destinataires en CCI.",onBack:b}),e.jsxs(p,{className:"border-l-4 border-l-primary",children:[e.jsxs(h,{children:[e.jsx(x,{children:"Destinataire"}),e.jsx(j,{children:"Sélectionnez un nageur ou un groupe."})]}),e.jsxs(g,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{children:"Destinataire"}),e.jsxs(E,{value:a,onValueChange:S,children:[e.jsx(I,{children:e.jsx(M,{placeholder:v?"Chargement...":"Choisir un nageur ou un groupe"})}),e.jsxs(_,{children:[u.length?e.jsxs(e.Fragment,{children:[e.jsx(i,{value:"section-group",disabled:!0,children:"Groupes"}),u.map(s=>e.jsx(i,{value:s.value,children:s.label},s.value))]}):null,c.length?e.jsxs(e.Fragment,{children:[e.jsx(i,{value:"section-athlete",disabled:!0,children:"Nageurs"}),c.map(s=>e.jsx(i,{value:s.value,children:s.label},s.value))]}):null]})]})]}),a&&r.length>0?e.jsxs("p",{className:"text-xs text-muted-foreground",children:[r.length," adresse",r.length>1?"s":""," email",r.length>1?" (envoi en CCI)":""]}):null,a&&r.length===0?e.jsx("p",{className:"text-xs text-destructive",children:"Aucune adresse email disponible pour cette sélection."}):null]})]}),e.jsxs(p,{children:[e.jsxs(h,{children:[e.jsx(x,{children:"Objet"}),e.jsx(j,{children:"Optionnel — pré-rempli dans votre application mail."})]}),e.jsx(g,{children:e.jsx(y,{value:o,onChange:s=>f(s.target.value),placeholder:"Objet du mail…"})})]}),e.jsx("div",{className:"sticky bottom-0 z-10 -mx-4 border-t bg-background/95 p-4 backdrop-blur sm:static sm:mx-0 sm:border-0 sm:p-0",children:e.jsxs(k,{className:"w-full sm:w-auto",onClick:N,disabled:!a||r.length===0,children:[e.jsx(L,{className:"mr-2 h-4 w-4"}),"Ouvrir dans l'app mail",e.jsx(T,{className:"ml-2 h-3 w-3"})]})})]})};export{se as default};
