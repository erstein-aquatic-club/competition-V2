import{c as V,u as Y,d as B,R as Q,j as e,r as g}from"./vendor-query-DyA9aSKS.js";import{b as Z,F as $,X as ee,P as D,u as te,s as se,f as F,B as X,d as ne}from"./index-Cc5GnU4d.js";import{a as L}from"./api-DwyuCtAl.js";import{A as K,S as G,H as z,f as M,p as H,E as J}from"./SwimTimeInput-DhbL5szl.js";import{e as q,s as re,S as oe,F as ae}from"./objectiveHelpers-DC7i01Ud.js";import{P as I}from"./PageHeader-FJx52Jzz.js";import{C as ie}from"./chevron-right-Bg27ksfI.js";import{C as le}from"./chevron-down-C_46x42c.js";import{C as ce}from"./index-4FTywvqr.js";import{T as R}from"./trash-2-tDfdySvr.js";import{T as U}from"./timer-CNGkwNb_.js";import{P as de}from"./pencil-DZ05niTQ.js";import{D as me,a as ue,b as xe,c as pe}from"./dialog-CuLmacFX.js";import"./vendor-react-BzrpNAyj.js";import"./vendor-charts-BrQ8X25f.js";import"./vendor-supabase-DFPLkPj_.js";import"./vendor-motion-lao-Njgm.js";import"./swim-BJev65MH.js";import"./chevron-left-e5VS8sk8.js";import"./index-BEy7WBTi.js";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const he=[["path",{d:"M7 16.3c2.2 0 4-1.83 4-4.05 0-1.16-.57-2.26-1.71-3.19S7.29 6.75 7 5.3c-.29 1.45-1.14 2.84-2.29 3.76S3 11.1 3 12.25c0 2.22 1.8 4.05 4 4.05z",key:"1ptgy4"}],["path",{d:"M12.56 6.6A10.97 10.97 0 0 0 14 3.02c.5 2.5 2 4.9 4 6.5s3 3.5 3 5.5a6.98 6.98 0 0 1-11.91 4.97",key:"1sl1rz"}]],fe=Z("droplets",he);function O(...s){return s.filter(Boolean).join(" ")}function W(s){try{return new Date(s).toLocaleDateString("fr-FR",{weekday:"short",day:"numeric",month:"short"})}catch{return s}}function ge(s){return J.find(d=>d.value===s)?.label??s}function be({userId:s,expanded:d,onToggle:N,standalone:y}){const b=V(),{data:l,isLoading:j}=Y({queryKey:["swim-exercise-logs-history",s],queryFn:()=>L.getSwimExerciseLogsHistory(s,200),enabled:!!s&&d}),m=B({mutationFn:({logId:a,patch:i})=>L.updateSwimExerciseLog(a,i),onSuccess:()=>{b.invalidateQueries({queryKey:["swim-exercise-logs-history",s]})}}),h=B({mutationFn:a=>L.deleteSwimExerciseLog(a),onSuccess:()=>{b.invalidateQueries({queryKey:["swim-exercise-logs-history",s]})}}),k=Q.useMemo(()=>{if(!l?.length)return[];const a=new Map;for(const i of l){const x=(i.created_at??"").slice(0,10);a.has(x)||a.set(x,[]),a.get(x).push(i)}return Array.from(a.entries()).map(([i,x])=>({date:i,entries:x}))},[l]),v=Q.useMemo(()=>{if(!l?.length)return[];const a=new Map,i=[];for(const u of l){if(!u.event_code){i.push(u);continue}const p=`${u.event_code}__${u.pool_length??""}`;a.has(p)||a.set(p,[]),a.get(p).push(u)}const x=Array.from(a.entries()).map(([u,p])=>{const[w,E]=u.split("__"),_=E?Number(E):null;return{eventCode:w,pool:_,entries:p,label:`${q(w)}${_?` — ${_}m`:""}`}});return x.sort((u,p)=>u.label.localeCompare(p.label)),i.length>0&&x.push({eventCode:"",pool:null,entries:i,label:"Non classées"}),x},[l]),S=a=>e.jsx(Ne,{log:a,showEventBadge:!y,onSave:i=>m.mutate({logId:a.id,patch:i}),onDelete:()=>h.mutate(a.id),saving:m.isPending},a.id);if(y&&d)return e.jsxs("div",{className:"space-y-3",children:[j&&e.jsx("div",{className:"text-sm text-muted-foreground text-center py-4",children:"Chargement..."}),!j&&v.length===0&&e.jsx("div",{className:"text-sm text-muted-foreground text-center py-8",children:"Aucune note technique enregistrée."}),v.map(({eventCode:a,label:i,entries:x})=>{const u=a?re(a):null,p=u?oe[u]:"";return e.jsx(je,{label:i,borderColor:p,entries:x,renderEntry:S},i)})]});const C=d?e.jsxs("div",{className:"mt-2 space-y-3 rounded-2xl border border-border/60 bg-card/60 p-2",children:[j&&e.jsx("div",{className:"text-sm text-muted-foreground text-center py-4",children:"Chargement..."}),!j&&k.length===0&&e.jsx("div",{className:"text-sm text-muted-foreground text-center py-4",children:"Aucune note technique enregistrée."}),k.map(({date:a,entries:i})=>e.jsxs("div",{className:"rounded-2xl border border-border overflow-hidden",children:[e.jsx("div",{className:"bg-muted/50 px-3 py-2 text-xs font-semibold text-muted-foreground",children:W(a)}),e.jsx("div",{className:"divide-y divide-border",children:i.map(S)})]},a))]}):null;return y?C:e.jsxs("div",{className:"mt-6",children:[e.jsxs("button",{type:"button",onClick:N,className:"flex w-full items-center justify-between rounded-2xl border border-dashed border-border/80 bg-background px-3 py-2.5 text-left transition hover:bg-muted/40",children:[e.jsxs("span",{className:"flex min-w-0 items-center gap-2",children:[e.jsx("span",{className:"flex h-8 w-8 shrink-0 items-center justify-center rounded-xl bg-muted text-muted-foreground",children:e.jsx($,{className:"h-4 w-4"})}),e.jsxs("span",{className:"min-w-0",children:[e.jsx("span",{className:"block truncate text-sm font-semibold text-foreground",children:"Notes techniques"}),e.jsx("span",{className:"block truncate text-[11px] text-muted-foreground",children:"Repères détaillés, consultation optionnelle"})]})]}),e.jsx(ie,{className:O("h-4 w-4 transition-transform",d&&"rotate-90")})]}),C]})}function je({label:s,borderColor:d,entries:N,renderEntry:y}){const[b,l]=g.useState(!0);return e.jsxs("div",{className:O("rounded-2xl border border-border overflow-hidden",d&&`border-l-[3px] ${d}`),children:[e.jsxs("button",{type:"button",onClick:()=>l(j=>!j),className:"flex w-full items-center justify-between bg-muted/50 px-3 py-2 text-left",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(fe,{className:"h-3.5 w-3.5 text-muted-foreground"}),e.jsx("span",{className:"text-xs font-semibold text-foreground",children:s}),e.jsxs("span",{className:"text-[10px] text-muted-foreground",children:[N.length," entrée",N.length>1?"s":""]})]}),e.jsx(le,{className:O("h-3.5 w-3.5 text-muted-foreground transition-transform",!b&&"-rotate-90")})]}),b&&e.jsx("div",{className:"divide-y divide-border",children:N.map(y)})]})}function Ne({log:s,showEventBadge:d,onSave:N,onDelete:y,saving:b}){const[l,j]=g.useState(!1),[m,h]=g.useState({notes:s.notes??"",tempo:s.tempo,split_times:s.split_times,stroke_count:s.stroke_count}),[k,v]=g.useState([]),S=()=>{h({notes:s.notes??"",tempo:s.tempo,split_times:[...s.split_times],stroke_count:[...s.stroke_count]}),v(s.split_times.map(n=>M(n.time_seconds))),j(!0)},C=()=>j(!1),a=()=>{N({notes:m.notes.trim()||null,tempo:m.tempo,split_times:m.split_times,stroke_count:m.stroke_count}),j(!1)},i=()=>{h(n=>({...n,split_times:[...n.split_times,{rep:n.split_times.length+1,time_seconds:0}]})),v(n=>[...n,""])},x=(n,o)=>{v(t=>t.map((r,c)=>c===n?o:r))},u=n=>{const o=H(k[n]),t=M(o);v(r=>r.map((c,f)=>f===n?t:c)),h(r=>({...r,split_times:r.split_times.map((c,f)=>f===n?{...c,time_seconds:o}:c)}))},p=n=>{h(o=>({...o,split_times:o.split_times.filter((t,r)=>r!==n).map((t,r)=>({...t,rep:r+1}))})),v(o=>o.filter((t,r)=>r!==n))},w=()=>{h(n=>({...n,stroke_count:[...n.stroke_count,{rep:n.stroke_count.length+1,count:0}]}))},E=(n,o)=>{h(t=>({...t,stroke_count:t.stroke_count.map((r,c)=>c===n?{...r,count:o}:r)}))},_=n=>{h(o=>({...o,stroke_count:o.stroke_count.filter((t,r)=>r!==n).map((t,r)=>({...t,rep:r+1}))}))};if(l)return e.jsxs("div",{className:"px-3 py-2.5 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-semibold text-foreground",children:s.exercise_label}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{type:"button",onClick:a,disabled:b,className:"p-1.5 rounded-lg text-primary hover:bg-primary/10 transition","aria-label":"Enregistrer",children:e.jsx(ce,{className:"h-4 w-4"})}),e.jsx("button",{type:"button",onClick:C,className:"p-1.5 rounded-lg text-muted-foreground hover:bg-muted transition","aria-label":"Annuler",children:e.jsx(ee,{className:"h-4 w-4"})}),e.jsx("button",{type:"button",onClick:y,className:"p-1.5 rounded-lg text-muted-foreground hover:text-destructive hover:bg-destructive/10 transition","aria-label":"Supprimer",children:e.jsx(R,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-xs font-medium text-muted-foreground min-w-[80px]",children:[e.jsx(K,{className:"h-3.5 w-3.5"}),"Tempo"]}),e.jsx("input",{type:"number",inputMode:"decimal",step:"0.1",min:0,value:m.tempo??"",onChange:n=>h(o=>({...o,tempo:n.target.value?Number(n.target.value):null})),placeholder:"coups/min",className:"w-24 rounded-xl border border-border bg-background px-2 py-1.5 text-sm text-center outline-none focus:ring-2 focus:ring-foreground/10"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-xs font-medium text-muted-foreground",children:[e.jsx(U,{className:"h-3.5 w-3.5"}),"Temps"]}),e.jsxs("button",{type:"button",onClick:i,className:"inline-flex items-center gap-1 text-xs text-primary hover:text-primary/80 transition",children:[e.jsx(D,{className:"h-3 w-3"}),"Rep"]})]}),m.split_times.length>0&&e.jsx("div",{className:"mt-1.5 flex flex-wrap gap-1.5",children:m.split_times.map((n,o)=>e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"text-[10px] text-muted-foreground w-4 text-right",children:n.rep}),e.jsx(G,{value:k[o]??"",onChange:t=>x(o,t),onBlur:()=>u(o),size:"compact"}),e.jsx("button",{type:"button",onClick:()=>p(o),className:"p-0.5 text-muted-foreground hover:text-destructive transition",children:e.jsx(R,{className:"h-3 w-3"})})]},o))})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-xs font-medium text-muted-foreground",children:[e.jsx(z,{className:"h-3.5 w-3.5"}),"Coups de bras"]}),e.jsxs("button",{type:"button",onClick:w,className:"inline-flex items-center gap-1 text-xs text-primary hover:text-primary/80 transition",children:[e.jsx(D,{className:"h-3 w-3"}),"Rep"]})]}),m.stroke_count.length>0&&e.jsx("div",{className:"mt-1.5 flex flex-wrap gap-1.5",children:m.stroke_count.map((n,o)=>e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"text-[10px] text-muted-foreground w-4 text-right",children:n.rep}),e.jsx("input",{type:"number",inputMode:"numeric",min:0,value:n.count||"",onChange:t=>E(o,Number(t.target.value)||0),placeholder:"nb",className:"w-14 rounded-lg border border-border bg-background px-1.5 py-1 text-xs text-center outline-none focus:ring-2 focus:ring-foreground/10"}),e.jsx("button",{type:"button",onClick:()=>_(o),className:"p-0.5 text-muted-foreground hover:text-destructive transition",children:e.jsx(R,{className:"h-3 w-3"})})]},o))})]}),e.jsx("textarea",{value:m.notes,onChange:n=>h(o=>({...o,notes:n.target.value})),placeholder:"Notes libres...",rows:2,className:"w-full resize-none rounded-xl border border-border bg-background px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-foreground/10"})]});const A=s.equipment?.length>0&&!(s.equipment.length===1&&s.equipment[0]==="aucun");return e.jsxs("div",{className:"px-3 py-2.5 space-y-1.5 group",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[e.jsx("div",{className:"text-sm font-semibold text-foreground truncate",children:s.exercise_label}),d&&s.event_code&&e.jsxs("span",{className:"shrink-0 rounded-md bg-primary/10 px-1.5 py-0.5 text-[10px] font-medium text-primary",children:[q(s.event_code),s.pool_length?` ${s.pool_length}m`:""]})]}),e.jsx("button",{type:"button",onClick:S,className:"p-1.5 rounded-lg text-muted-foreground hover:bg-muted transition","aria-label":"Modifier",children:e.jsx(de,{className:"h-3.5 w-3.5"})})]}),e.jsxs("div",{className:"flex flex-wrap gap-1",children:[A&&s.equipment.filter(n=>n!=="aucun").map(n=>e.jsx("span",{className:"rounded-md bg-muted px-1.5 py-0.5 text-[10px] text-muted-foreground",children:ge(n)},n)),e.jsx("span",{className:"rounded-md bg-muted/50 px-1.5 py-0.5 text-[10px] text-muted-foreground",children:W((s.created_at??"").slice(0,10))})]}),e.jsxs("div",{className:"flex flex-wrap gap-x-4 gap-y-1 text-xs text-muted-foreground",children:[s.tempo!=null&&e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx(K,{className:"h-3 w-3"}),s.tempo," c/min"]}),s.split_times.length>0&&e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx(U,{className:"h-3 w-3"}),s.split_times.map(n=>M(n.time_seconds)||"—").join(" / ")]}),s.stroke_count.length>0&&e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx(z,{className:"h-3 w-3"}),s.stroke_count.map(n=>n.count).join(" / ")," cps"]})]}),s.notes&&e.jsx("div",{className:"text-xs text-foreground/70 italic",children:s.notes})]})}function Qe(){const s=te(l=>l.user),[d,N]=g.useState(null),[y,b]=g.useState(!1);return g.useEffect(()=>{se.auth.getSession().then(({data:l})=>{N(l.session?.user?.id??null)})},[s]),d?e.jsxs("div",{className:"mx-auto max-w-lg px-4 pb-24",children:[e.jsx(I,{title:"Notes techniques",icon:e.jsx($,{className:"h-3.5 w-3.5"}),backHref:"/",action:e.jsxs(X,{size:"sm",onClick:()=>b(!0),className:"h-8 rounded-xl px-2.5 text-xs font-semibold",children:[e.jsx(D,{className:"mr-1 h-3.5 w-3.5"}),"Ajouter"]})}),e.jsx("div",{className:"mt-2",children:e.jsx(be,{userId:d,expanded:!0,onToggle:()=>{},standalone:!0})}),e.jsx(ve,{open:y,onOpenChange:b,userId:d})]}):e.jsxs("div",{className:"mx-auto max-w-lg px-4",children:[e.jsx(I,{title:"Notes techniques",icon:e.jsx($,{className:"h-3.5 w-3.5"}),backHref:"/"}),e.jsxs("div",{className:"mt-4 space-y-3",children:[e.jsx(F,{className:"h-16 rounded-2xl"}),e.jsx(F,{className:"h-16 rounded-2xl"}),e.jsx(F,{className:"h-16 rounded-2xl"})]})]})}function ve({open:s,onOpenChange:d,userId:N}){const y=V(),{toast:b}=ne(),[l,j]=g.useState(""),[m,h]=g.useState(null),[k,v]=g.useState(["aucun"]),[S,C]=g.useState(""),[a,i]=g.useState(null),[x,u]=g.useState(""),[p,w]=g.useState([""]),E=()=>{j(""),h(null),v(["aucun"]),C(""),i(null),u(""),w([""])},_=B({mutationFn:()=>{const t=p.map((r,c)=>({rep:c+1,time_seconds:H(r)})).filter(r=>r.time_seconds>0);return L.createStandaloneSwimLog(N,{exercise_label:S.trim()||(l?q(l):"Note"),event_code:l||null,pool_length:m,equipment:k,tempo:a,split_times:t,stroke_count:[],notes:x.trim()||null})},onSuccess:()=>{y.invalidateQueries({queryKey:["swim-exercise-logs-history",N]}),b({title:"Note enregistrée"}),E(),d(!1)},onError:()=>{b({title:"Erreur",description:"Impossible d'enregistrer.",variant:"destructive"})}}),A=t=>{if(t==="aucun"){v(["aucun"]);return}v(r=>{const c=r.filter(f=>f!=="aucun");if(c.includes(t)){const f=c.filter(T=>T!==t);return f.length===0?["aucun"]:f}return[...c,t]})},n=()=>w(t=>[...t,""]),o=t=>w(r=>r.filter((c,f)=>f!==t));return e.jsx(me,{open:s,onOpenChange:d,children:e.jsxs(ue,{className:"max-w-sm rounded-2xl max-h-[85vh] overflow-y-auto",children:[e.jsx(xe,{children:e.jsx(pe,{children:"Nouvelle note technique"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-muted-foreground",children:"Épreuve"}),e.jsxs("select",{value:l,onChange:t=>j(t.target.value),className:"mt-1 w-full rounded-xl border border-border bg-background px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-foreground/10",children:[e.jsx("option",{value:"",children:"— Aucune —"}),ae.map(t=>e.jsx("option",{value:t,children:q(t)},t))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-muted-foreground",children:"Bassin"}),e.jsx("div",{className:"mt-1 flex gap-2",children:[25,50].map(t=>e.jsxs("button",{type:"button",onClick:()=>h(m===t?null:t),className:`flex-1 rounded-xl border px-3 py-2 text-sm font-medium transition ${m===t?"border-primary bg-primary/10 text-primary":"border-border text-muted-foreground hover:bg-muted"}`,children:[t,"m"]},t))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-muted-foreground",children:"Équipement"}),e.jsx("div",{className:"mt-1 flex flex-wrap gap-1.5",children:J.map(t=>{const r=k.includes(t.value);return e.jsx("button",{type:"button",onClick:()=>A(t.value),className:`rounded-lg border px-2.5 py-1 text-xs font-medium transition ${r?"border-primary/30 bg-primary/10 text-primary":"border-border text-muted-foreground hover:bg-muted"}`,children:t.label},t.value)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-muted-foreground",children:"Exercice (optionnel)"}),e.jsx("input",{value:S,onChange:t=>C(t.target.value),placeholder:l?q(l):"Ex: 6x50m NL",className:"mt-1 w-full rounded-xl border border-border bg-background px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-foreground/10"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{className:"text-xs font-medium text-muted-foreground",children:"Temps (par rep)"}),e.jsxs("button",{type:"button",onClick:n,className:"text-xs text-primary hover:text-primary/80",children:[e.jsx(D,{className:"inline h-3 w-3 mr-0.5"}),"Rep"]})]}),e.jsx("div",{className:"mt-1.5 flex flex-wrap gap-1.5",children:p.map((t,r)=>e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"text-[10px] text-muted-foreground w-4 text-right",children:r+1}),e.jsx(G,{value:t,onChange:c=>w(f=>f.map((T,P)=>P===r?c:T)),onBlur:()=>{const c=H(p[r]);w(f=>f.map((T,P)=>P===r?M(c):T))},size:"compact"}),p.length>1&&e.jsx("button",{type:"button",onClick:()=>o(r),className:"p-0.5 text-muted-foreground hover:text-destructive",children:"×"})]},r))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-muted-foreground",children:"Tempo (coups/min)"}),e.jsx("input",{type:"number",inputMode:"decimal",step:"0.1",min:0,value:a??"",onChange:t=>i(t.target.value?Number(t.target.value):null),placeholder:"—",className:"mt-1 w-24 rounded-xl border border-border bg-background px-3 py-2 text-sm text-center outline-none focus:ring-2 focus:ring-foreground/10"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-muted-foreground",children:"Notes"}),e.jsx("textarea",{value:x,onChange:t=>u(t.target.value),placeholder:"Observations, sensations...",rows:2,className:"mt-1 w-full resize-none rounded-xl border border-border bg-background px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-foreground/10"})]}),e.jsx(X,{onClick:()=>_.mutate(),disabled:_.isPending,className:"w-full rounded-xl",children:_.isPending?"Enregistrement...":"Enregistrer"})]})]})})}export{Qe as default};
