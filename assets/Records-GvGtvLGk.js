import{c as ct,r as x,u as q,d as z,j as e}from"./vendor-query-BiSH4r2z.js";import{u as mt,d as ut,W,B as b,T as ie,D as xt,y as Ce,N as pt,C as H,g as X,L as E,I,X as G}from"./index-D21zkpbC.js";import{a as w}from"./api-CE0JwZnL.js";import{T as ht}from"./objectiveHelpers-DvB5nHwm.js";import{T as ft,a as gt,b as ke,c as Ee}from"./tabs-imL4kGY2.js";import{S as jt,a as vt,b as Nt,c as bt,d as Fe}from"./select-BDVJHu-u.js";import{shouldShowRecords as yt}from"./Profile-9S5iHVkT.js";import{c as wt,f as Ie,s as ae,l as oe}from"./animations-CrcLFysI.js";import{C as St}from"./circle-alert-kSOOfvHp.js";import{C as _t}from"./clock-B3Jc9i4b.js";import{m as S}from"./proxy-Dh0N-Z8G.js";import{C as J}from"./index-B7NULjVP.js";import{P as Re}from"./pen-C91q_pBc.js";import{C as Me}from"./chevron-down-B9KYzToD.js";import{r as Ct,X as Te,Y as Le,s as kt,R as Et,T as Ft}from"./generateCategoricalChart-B4ctzhP0.js";import{L as Pe}from"./Line-CZmc-GTd.js";import{C as It}from"./CartesianGrid-BjFBVnYq.js";import{S as Rt}from"./sticky-note-B8rsfSO7.js";import"./vendor-react-BzrpNAyj.js";import"./vendor-supabase-DFPLkPj_.js";import"./swim-AK5GMIA_.js";import"./index-D-Sonxm0.js";import"./index-DejncLAm.js";import"./index-BxvjkzuI.js";import"./chevron-up-DXa5mQOn.js";import"./avatar-BkUakdlG.js";import"./badge-DxONnCjA.js";import"./alert-dialog-Cl5P0Nqq.js";import"./index-Cx9dIHsg.js";import"./dialog-BV9yVWIG.js";import"./types-Ca14D1uM.js";import"./toggle-group-3FPyxtwo.js";import"./plus-Do5sTMCK.js";import"./trash-2-gzhMtEZ9.js";import"./flame-DRKrVJaT.js";import"./index-nhvT0Lb1.js";import"./save-DZhy8MjK.js";import"./design-tokens-CKgCpdH6.js";var Mt=Ct({chartName:"LineChart",GraphicalChild:Pe,axisComponents:[{axisType:"xAxis",AxisComp:Te},{axisType:"yAxis",AxisComp:Le}],formatAxisMap:kt});const F=(...o)=>o.filter(Boolean).join(" ");function Y(o){if(!o)return"—";const a=new Date(o);return Number.isNaN(a.getTime())?o:a.toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"2-digit"})}function D(o){if(o==null)return"—";const a=Math.round(Math.max(0,o*1e3)),g=Math.floor(a/6e4),p=Math.floor(a%6e4/1e3),v=Math.floor(a%1e3/10);return g>0?`${g}:${String(p).padStart(2,"0")}.${String(v).padStart(2,"0")}`:`${p}.${String(v).padStart(2,"0")}`}function Tt(o){const a=o.trim();if(!a)return null;if(a.includes(":")){const[p,v]=a.split(":"),y=Number(p);if(!Number.isFinite(y)||y<0)return null;const R=v.replace(",","."),C=Number(R);return!Number.isFinite(C)||C<0?null:y*60+C}const g=Number(a.replace(",","."));return!Number.isFinite(g)||g<0?null:g}function Lt(o){if(!o)return null;const a=o.match(/FFN\s*\((\d+)\s*pts\)/i);if(!a)return null;const g=Number(a[1]);return Number.isFinite(g)?g:null}function Pt({value:o,placeholder:a,onSave:g,onCancel:p,inputMode:v="decimal",hint:y}){const[R,C]=x.useState(o);return x.useEffect(()=>{C(o)},[o]),e.jsx("div",{className:"w-full",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(I,{value:R,onChange:d=>C(d.target.value),placeholder:a,inputMode:v,className:"h-10 rounded-xl",autoFocus:!0}),y?e.jsx("div",{className:"mt-1 text-xs text-muted-foreground",children:y}):null]}),e.jsx(b,{type:"button",onClick:()=>g(R),className:"h-10 w-10 p-0 rounded-xl","aria-label":"Valider",children:e.jsx(J,{className:"h-5 w-5"})}),e.jsx(b,{type:"button",variant:"outline",onClick:p,className:"h-10 w-10 p-0 rounded-xl","aria-label":"Annuler",children:e.jsx(G,{className:"h-5 w-5"})})]})})}const _=()=>e.jsx("div",{className:"h-10 rounded-xl bg-muted animate-pulse motion-reduce:animate-none"});function bs(){const{user:o,userId:a,role:g}=mt(),{toast:p}=ut(),v=ct(),y={id:null,event_name:"",pool_length:"",time_seconds:"",record_date:"",notes:""},[R,C]=x.useState(()=>{const t=window.location.hash,s=t.indexOf("?");return s>=0&&new URLSearchParams(t.substring(s)).get("tab")==="1rm"?"1rm":"swim"}),[d,N]=x.useState(y),[m,Ae]=x.useState("training"),[P,$e]=x.useState(25),[le,K]=x.useState(null),[qe,de]=x.useState(null),[ze,ce]=x.useState(""),[De,Ke]=x.useState(null),[Qe,A]=x.useState(null),[me,M]=x.useState(""),[Q,Oe]=x.useState(25),[O,Be]=x.useState(null),[Ve,ue]=x.useState(!1),T=yt(g);x.useEffect(()=>{window.scrollTo({top:0,left:0,behavior:"auto"})},[]);const xe=t=>{const s=t?.pool_length??t?.poolLength??t?.poolLen??t?.pool;if(s==null)return null;if(typeof s=="number")return s===25||s===50?s:null;const i=String(s).match(/\b(25|50)\b/);if(!i)return null;const r=Number(i[1]);return r===25||r===50?r:null},Z=q({queryKey:["1rm",o,a],queryFn:()=>w.get1RM({athleteName:o,athleteId:a}),enabled:!!o&&T}),ee=q({queryKey:["exercises"],queryFn:()=>w.getExercises(),enabled:T}),te=q({queryKey:["swim-records",a,o],queryFn:()=>w.getSwimRecords({athleteId:a??void 0,athleteName:o??void 0}),enabled:!!o&&T}),L=q({queryKey:["profile",a],queryFn:()=>w.getProfile({userId:a??void 0}),enabled:!!a&&T}),k=String(L.data?.ffn_iuf??"").trim(),pe=Z.error||ee.error||te.error||L.error,Ue=()=>{Z.refetch(),ee.refetch(),te.refetch(),L.refetch()},se=q({queryKey:["swimmer-performances",a,k,Q],queryFn:()=>w.getSwimmerPerformances({userId:a??void 0,iuf:k||void 0,poolLength:Q}),enabled:!!k&&T&&m==="history"}),{data:ne,isLoading:We,isError:He}=se,B=z({mutationFn:()=>{if(!k)throw new Error("IUF FFN manquant. Ajoutez-le dans votre profil.");return w.importSwimmerPerformances({iuf:k,userId:a??void 0})},onSuccess:t=>{v.invalidateQueries({queryKey:["swimmer-performances"]}),p({title:"Import terminé",description:`${t.total_found} trouvée(s), ${t.new_imported} importée(s), ${t.already_existed} déjà existante(s)`}),ue(!0),setTimeout(()=>ue(!1),2e3)},onError:t=>{p({title:"Import impossible",description:String(t?.message||t),variant:"destructive"})}}),V=x.useMemo(()=>{if(!ne?.length)return[];const t=new Map;for(const r of ne){const n=t.get(r.event_code)??[];n.push(r),t.set(r.event_code,n)}const s=r=>r.toLowerCase().replace(/\./g,"").replace(/\s+/g," ").trim(),l=r=>{const n=s(r);return n.includes("nl")||n.includes("nage libre")?0:n.includes("dos")?1:n.includes("bra")||n.includes("brasse")?2:n.includes("pap")||n.includes("papillon")?3:n.includes("4n")||n.includes("4 n")||n.includes("4 nages")?4:99},i=r=>{const n=r.match(/^(\d+)/);return n?Number(n[1]):1/0};return[...t.entries()].map(([r,n])=>{const u=[...n].sort((f,c)=>(c.competition_date??"").localeCompare(f.competition_date??"")),h=u.reduce((f,c)=>c.time_seconds<f.time_seconds?c:f,u[0]);return{eventCode:r,performances:u,bestTime:h.time_seconds,bestId:h.id}}).sort((r,n)=>{const u=l(r.eventCode),h=l(n.eventCode);return u!==h?u-h:i(r.eventCode)-i(n.eventCode)})},[ne]),he=x.useMemo(()=>{if(!O)return[];const t=V.find(s=>s.eventCode===O);return t?[...t.performances].filter(s=>s.competition_date).sort((s,l)=>(s.competition_date??"").localeCompare(l.competition_date??"")).map(s=>({date:Y(s.competition_date),time:s.time_seconds,display:s.time_display??D(s.time_seconds)})):[]},[O,V]),{data:Xe,isLoading:Ye,isError:Ge}=Z,{data:Je,isLoading:Ze,isError:et}=ee,{data:fe,isLoading:tt,isFetching:At,isError:st,refetch:nt}=te,rt=()=>{nt()};x.useEffect(()=>{m==="comp"&&rt()},[m]);const ge=z({mutationFn:t=>w.update1RM({...t,athlete_id:a,athlete_name:o}),onSuccess:()=>{v.invalidateQueries({queryKey:["1rm"]}),p({title:"1RM mis à jour"})}}),je=z({mutationFn:t=>w.updateExerciseNote({athlete_id:a,exercise_id:t.exercise_id,notes:t.notes}),onSuccess:()=>{v.invalidateQueries({queryKey:["1rm"]}),p({title:"Note mise à jour"})}}),re=z({mutationFn:t=>w.upsertSwimRecord(t),onSuccess:()=>{v.invalidateQueries({queryKey:["swim-records"]}),N(y),K(null),p({title:"Record mis à jour"})}});z({mutationFn:t=>w.syncFfnSwimRecords({athleteId:a??void 0,athleteName:o??void 0,iuf:t}),onSuccess:t=>{v.invalidateQueries({queryKey:["swim-records"]}),p({title:"Synchro FFN terminée",description:`${t?.inserted??0} ajouté(s), ${t?.updated??0} mis à jour, ${t?.skipped??0} inchangé(s)`})},onError:t=>{p({title:"Synchro FFN impossible",description:String(t?.message||t),variant:"destructive"})}});const U=()=>{N(y),K(null)},it=t=>{const s=xe(t);N({id:t.id,event_name:t.event_name??"",pool_length:s?String(s):"",time_seconds:t.time_seconds!=null?D(Number(t.time_seconds)):"",record_date:t.record_date?String(t.record_date).split("T")[0]:"",notes:t.notes??""}),K(t.id)},ve=()=>{if(!d.event_name.trim()){p({title:"Nom d'épreuve requis",variant:"destructive"});return}if(!d.pool_length){p({title:"Bassin requis",variant:"destructive"});return}const t=Tt(d.time_seconds);if(t===null){p({title:"Temps invalide",description:"Ex: 1:02.34 ou 62.34",variant:"destructive"});return}re.mutate({id:d.id||null,athlete_id:a,athleteName:o,athlete_name:o,event_name:d.event_name,pool_length:parseInt(d.pool_length,10),time_seconds:t,record_date:d.record_date||null,notes:d.notes||null,record_type:m})},at=t=>{t.preventDefault(),ve()},Ne=x.useMemo(()=>(fe?.records??[]).filter(l=>{const i=xe(l);if(!i||i!==P)return!1;const r=String(l.record_type??"training");return m==="comp"?r==="comp":r==="training"}).sort((l,i)=>{const r=String(l.event_name??""),n=String(i.event_name??""),u=$=>String($??"").toLowerCase().replace(/\./g,"").replace(/\s+/g," ").trim(),h=$=>{const j=u($);return j.includes("nl")||j.includes("nage libre")?0:j.includes("dos")?1:j.includes("bra")||j.includes("brasse")?2:j.includes("pap")||j.includes("papillon")?3:j.includes("4n")||j.includes("4 n")||j.includes("4 nages")?4:99},f=$=>{const j=String($??"").match(/^(\d+)/);return j?Number(j[1]):Number.POSITIVE_INFINITY},c=h(r),we=h(n);if(c!==we)return c-we;const Se=f(r),_e=f(n);return Se!==_e?Se-_e:u(r).localeCompare(u(n),"fr")}),[fe,P,m]),be=()=>{N({...y,pool_length:String(P)}),K("add")},ot=t=>{Ae(t),U()},lt=(t,s)=>{de(t),ce(s!=null&&Number(s)>0?String(s):"")},ye=()=>{de(null),ce("")},dt=(t,s)=>{const l=Number(String(s??"").replace(",","."));if(!Number.isFinite(l)||l<=0){p({title:"Valeur invalide",description:"Entrez un nombre > 0",variant:"destructive"});return}ge.mutate({exercise_id:t,one_rm:l}),ye()};return T?pe?e.jsx("div",{className:"min-h-[100dvh]",children:e.jsxs("div",{className:"mx-auto max-w-lg px-4 pt-16 pb-10 text-center",children:[e.jsx(St,{className:"h-10 w-10 mx-auto text-destructive/60"}),e.jsx("p",{className:"mt-3 text-sm font-semibold",children:"Impossible de charger les données"}),e.jsx("p",{className:"mt-1 text-xs text-muted-foreground",children:pe.message}),e.jsx(b,{onClick:Ue,size:"sm",className:"mt-4 rounded-2xl",children:"Réessayer"})]})}):e.jsx("div",{className:"min-h-[100dvh]",children:e.jsxs("div",{className:"mx-auto max-w-lg",children:[e.jsx("div",{className:"sticky top-0 z-overlay backdrop-blur-md bg-background/90 border-b border-primary/15",children:e.jsxs("div",{className:"px-4 py-2.5 flex items-center gap-2.5",children:[e.jsx("div",{className:"flex items-center justify-center h-7 w-7 rounded-lg bg-primary text-primary-foreground",children:e.jsx(ie,{className:"h-3.5 w-3.5"})}),e.jsx("h1",{className:"text-lg font-display font-bold uppercase italic tracking-tight text-primary",children:"Mes Records"})]})}),e.jsx("div",{className:"px-3 pt-3",children:e.jsxs(ft,{value:R,onValueChange:t=>C(t),children:[e.jsxs(gt,{className:"w-full rounded-2xl bg-muted/50 border border-border p-1 flex",children:[e.jsxs(ke,{value:"swim","aria-label":"Records de natation",className:`flex-1 rounded-xl px-3 py-2 text-sm font-bold uppercase tracking-wide gap-1.5
                  data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm
                  data-[state=inactive]:text-muted-foreground`,children:[e.jsx(W,{className:"h-4 w-4"}),"Natation"]}),e.jsxs(ke,{value:"1rm","aria-label":"Records de musculation",className:`flex-1 rounded-xl px-3 py-2 text-sm font-bold uppercase tracking-wide gap-1.5
                  data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm
                  data-[state=inactive]:text-muted-foreground`,children:[e.jsx(xt,{className:"h-4 w-4"}),"Musculation"]})]}),R==="swim"?e.jsxs("div",{className:"mt-2.5 space-y-2",children:[e.jsx("div",{className:"flex rounded-xl bg-muted/20 border border-border/50 p-0.5",children:["training","comp","history"].map(t=>{const s=t==="training"?"Entraîn.":t==="comp"?"Compétition":"Historique",l=t==="training"?ie:t==="comp"?W:_t;return e.jsxs("button",{type:"button",onClick:()=>ot(t),className:F("flex-1 rounded-lg px-2 py-1.5 text-xs max-[360px]:text-[10px] font-bold transition inline-flex items-center justify-center gap-1 whitespace-nowrap",m===t?"bg-background text-foreground shadow-sm":"text-muted-foreground hover:text-foreground"),"aria-pressed":m===t,children:[e.jsx(l,{className:"h-3.5 w-3.5 max-[360px]:hidden"}),s]},t)})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"inline-flex rounded-xl border border-border bg-muted/30 p-0.5",children:[25,50].map(t=>e.jsxs("button",{type:"button",onClick:()=>{m==="history"?Oe(t):($e(t),U())},className:F("px-3 py-1 text-xs font-bold rounded-lg tabular-nums transition",(m==="history"?Q:P)===t?"bg-background text-foreground shadow-sm":"text-muted-foreground hover:text-foreground"),children:[t,"m"]},t))}),e.jsxs("div",{className:"flex items-center gap-2",children:[m==="training"&&e.jsx(b,{type:"button",size:"sm",onClick:be,className:"rounded-xl text-xs h-8 gap-1",children:"Ajouter"}),m==="comp"&&e.jsx("span",{className:"text-[10px] text-muted-foreground uppercase tracking-widest font-semibold",children:"Données FFN"}),m==="history"&&e.jsx(S.div,{variants:wt,animate:Ve?"visible":"hidden",children:e.jsxs(b,{type:"button",size:"sm",onClick:()=>B.mutate(),disabled:B.isPending||!k,className:"rounded-xl text-xs h-8 gap-1",children:[B.isPending?e.jsx(Ce,{className:"h-3 w-3 animate-spin"}):e.jsx(pt,{className:"h-3 w-3"}),B.isPending?"Import...":"Importer FFN"]})})]})]})]}):null,e.jsxs(Ee,{value:"swim",className:"mt-0",children:[m!=="history"?e.jsx(e.Fragment,{children:e.jsxs("div",{className:"mt-3",children:[m==="training"&&le==="add"?e.jsx(S.div,{variants:Ie,initial:"hidden",animate:"visible",className:"mb-3",children:e.jsx("form",{onSubmit:at,children:e.jsx(H,{className:"rounded-2xl",children:e.jsxs(X,{className:"p-3 space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"col-span-2",children:[e.jsx(E,{className:"text-xs mb-1.5 block",children:"Épreuve"}),e.jsx(I,{value:d.event_name,onChange:t=>N({...d,event_name:t.target.value}),placeholder:"Ex: 100 NL, 200 Dos",className:"h-9 rounded-lg"})]}),e.jsxs("div",{children:[e.jsx(E,{className:"text-xs mb-1.5 block",children:"Bassin"}),e.jsxs(jt,{value:d.pool_length,onValueChange:t=>N({...d,pool_length:t}),children:[e.jsx(vt,{className:"h-9 rounded-lg",children:e.jsx(Nt,{placeholder:"—"})}),e.jsxs(bt,{children:[e.jsx(Fe,{value:"25",children:"25m"}),e.jsx(Fe,{value:"50",children:"50m"})]})]})]}),e.jsxs("div",{children:[e.jsx(E,{className:"text-xs mb-1.5 block",children:"Temps"}),e.jsx(I,{value:d.time_seconds,inputMode:"decimal",placeholder:"1:02.34",onChange:t=>N({...d,time_seconds:t.target.value}),className:"h-9 rounded-lg"})]}),e.jsxs("div",{children:[e.jsx(E,{className:"text-xs mb-1.5 block",children:"Date"}),e.jsx(I,{type:"date",value:d.record_date,onChange:t=>N({...d,record_date:t.target.value}),className:"h-9 rounded-lg"})]}),e.jsxs("div",{children:[e.jsx(E,{className:"text-xs mb-1.5 block",children:"Notes"}),e.jsx(I,{value:d.notes,onChange:t=>N({...d,notes:t.target.value}),placeholder:"Optionnel",className:"h-9 rounded-lg"})]})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsxs(b,{type:"button",size:"sm",variant:"outline",onClick:U,className:"rounded-xl h-8 text-xs gap-1",children:[e.jsx(G,{className:"h-3 w-3"}),"Annuler"]}),e.jsxs(b,{type:"submit",size:"sm",disabled:re.isPending,className:"rounded-xl h-8 text-xs gap-1",children:[e.jsx(J,{className:"h-3 w-3"}),"Ajouter"]})]})]})})})}):null,e.jsx(H,{className:"w-full min-w-0 rounded-2xl",children:e.jsx(X,{className:"p-0",children:tt?e.jsxs("div",{className:"p-4 grid gap-3",children:[e.jsx(_,{}),e.jsx(_,{}),e.jsx(_,{})]}):st?e.jsx("div",{className:"mx-4 my-4 rounded-lg border border-destructive/20 bg-destructive/10 p-4 text-sm text-destructive",children:"Impossible de charger les records natation."}):Ne.length===0?e.jsxs("div",{className:"py-8 text-center",children:[e.jsx(W,{className:"h-8 w-8 mx-auto text-muted-foreground/30"}),e.jsxs("p",{className:"mt-2 text-sm text-muted-foreground",children:["Aucun record en ",P,"m"]}),m==="training"&&e.jsx(b,{type:"button",size:"sm",variant:"outline",onClick:be,className:"mt-3 rounded-xl text-xs h-8",children:"Ajouter un record"})]}):e.jsx(S.div,{className:"divide-y divide-border motion-reduce:animate-none",variants:ae,initial:"hidden",animate:"visible",children:Ne.map(t=>{const s=le===t.id,l=D(t.time_seconds),i=Y(t.record_date),r=(t.notes??"").trim(),n=t?.ffn_points??t?.ffnPoints??t?.points??t?.pts??null,u=n==null?NaN:Number(n),h=Number.isFinite(u)?u:Lt(t?.notes),f=(t?.meet??t?.meet_name??t?.meetName??t?.competition??"").trim?.()??"";return e.jsxs(S.div,{className:"px-3 py-2.5 motion-reduce:animate-none",variants:oe,children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("span",{className:"text-sm font-semibold truncate",children:t.event_name}),e.jsxs("div",{className:"flex items-center gap-2 shrink-0",children:[e.jsx("span",{className:"font-mono text-primary font-bold tabular-nums text-sm",children:l}),m==="training"&&e.jsx("button",{type:"button",onClick:()=>it(t),className:"inline-flex items-center justify-center h-8 w-8 rounded-xl text-muted-foreground hover:text-foreground hover:bg-muted/60 transition","aria-label":`Modifier ${t.event_name}`,children:e.jsx(Re,{className:"h-3.5 w-3.5"})})]})]}),e.jsxs("div",{className:"flex items-center gap-3 mt-0.5 text-xs text-muted-foreground",children:[m==="comp"&&h!=null&&e.jsxs("span",{className:"tabular-nums",children:[String(h)," pts"]}),e.jsx("span",{className:"tabular-nums",children:i}),m==="comp"&&f&&e.jsx("span",{className:"truncate",children:f}),m==="training"&&r&&e.jsx("span",{className:"truncate italic",children:r})]}),m==="training"&&s?e.jsx(S.div,{className:"mt-3",variants:Ie,initial:"hidden",animate:"visible",children:e.jsxs("div",{className:"rounded-2xl bg-muted/30 border border-border p-4 space-y-4",children:[e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(E,{children:"Temps"}),e.jsx(I,{value:d.time_seconds,inputMode:"decimal",placeholder:"1:02.34",onChange:c=>N({...d,time_seconds:c.target.value}),className:"rounded-xl"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Format: mm:ss.cc ou secondes"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(E,{children:"Date"}),e.jsx(I,{type:"date",value:d.record_date,onChange:c=>N({...d,record_date:c.target.value}),className:"rounded-xl"})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(E,{children:"Notes"}),e.jsx(ht,{value:d.notes,onChange:c=>N({...d,notes:c.target.value}),rows:2,className:"rounded-xl"})]}),e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsxs(b,{type:"button",size:"sm",variant:"outline",onClick:U,className:"rounded-2xl gap-2",children:[e.jsx(G,{className:"h-4 w-4"}),"Annuler"]}),e.jsxs(b,{type:"button",size:"sm",onClick:ve,disabled:re.isPending,className:"rounded-2xl gap-2",children:[e.jsx(J,{className:"h-4 w-4"}),"Enregistrer"]})]})]})}):null]},t.id)})})})})]})}):null,m==="history"?e.jsxs("div",{className:"mt-3 space-y-3",children:[L.isError?e.jsx("div",{className:"rounded-lg bg-destructive/10 border border-destructive/20 p-3 text-sm text-destructive",children:"Impossible de charger votre profil."}):null,!L.isError&&!k&&!L.isLoading?e.jsxs("div",{className:"rounded-lg bg-yellow-500/10 border border-yellow-500/20 p-3 text-xs text-yellow-700 dark:text-yellow-400",children:[e.jsx("p",{className:"font-semibold mb-0.5",children:"IUF FFN non renseigné"}),e.jsxs("p",{children:["Renseignez votre numéro IUF dans"," ",e.jsx("a",{href:"/#/profile",className:"underline font-medium hover:text-foreground",children:"votre profil"})," ","pour importer vos performances."]})]}):null,We?e.jsxs("div",{className:"grid gap-3",children:[e.jsx(_,{}),e.jsx(_,{}),e.jsx(_,{})]}):He?e.jsxs("div",{className:"rounded-lg border border-destructive/20 bg-destructive/10 p-4 text-sm text-destructive",children:[e.jsx("p",{className:"font-semibold",children:"Impossible de charger les performances"}),e.jsx("p",{className:"mt-1 text-xs",children:se.error instanceof Error?se.error.message:"Vérifiez votre connexion internet et réessayez."})]}):V.length===0?e.jsx("div",{className:"px-4 py-6 text-sm text-muted-foreground",children:k?'Aucune performance trouvée. Cliquez sur "Importer" pour récupérer vos données FFN.':"Ajoutez votre IUF FFN dans votre profil pour commencer."}):e.jsx(S.div,{className:"space-y-2 motion-reduce:animate-none",variants:ae,initial:"hidden",animate:"visible",children:V.map(t=>{const s=O===t.eventCode,l=()=>Be(s?null:t.eventCode);return e.jsx(S.div,{variants:oe,children:e.jsx(H,{className:"rounded-2xl",children:e.jsxs(X,{className:"p-0",children:[e.jsxs("button",{type:"button",onClick:l,className:"w-full flex items-center justify-between gap-2 px-3 py-3 text-left cursor-pointer",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[e.jsx(Me,{className:F("h-4 w-4 shrink-0 text-muted-foreground transition-transform",s&&"rotate-180")}),e.jsx("span",{className:"text-sm font-semibold truncate",children:t.eventCode})]}),e.jsxs("div",{className:"flex items-center gap-2 shrink-0",children:[e.jsx("span",{className:"font-mono text-primary font-bold tabular-nums text-sm",children:D(t.bestTime)}),e.jsx("span",{className:"inline-flex items-center justify-center h-5 min-w-5 px-1.5 rounded-full bg-muted text-xs font-semibold tabular-nums text-muted-foreground",children:t.performances.length})]})]}),s?e.jsxs("div",{className:"border-t border-border",children:[he.length>1?e.jsxs("div",{className:"px-2 pt-3 pb-1",children:[e.jsxs("div",{className:"text-xs text-muted-foreground mb-2 px-2",children:["Progression (",Q,"m)"]}),e.jsx(Et,{width:"100%",height:160,children:e.jsxs(Mt,{data:he,margin:{top:5,right:10,left:0,bottom:5},children:[e.jsx(It,{strokeDasharray:"3 3",className:"stroke-border"}),e.jsx(Te,{dataKey:"date",tick:{fontSize:10},className:"text-muted-foreground"}),e.jsx(Le,{domain:["auto","auto"],tick:{fontSize:10},className:"text-muted-foreground",reversed:!0,tickFormatter:i=>{const r=Math.floor(i/60),n=Math.floor(i%60),u=Math.round(i%1*100);return r>0?`${r}:${String(n).padStart(2,"0")}`:`${n}.${String(u).padStart(2,"0")}`}}),e.jsx(Ft,{formatter:i=>{const r=Math.floor(i/60),n=Math.floor(i%60),u=Math.round(i%1*100);return[r>0?`${r}:${String(n).padStart(2,"0")}.${String(u).padStart(2,"0")}`:`${n}.${String(u).padStart(2,"0")}`,"Temps"]},labelStyle:{fontSize:11},contentStyle:{borderRadius:12,fontSize:12}}),e.jsx(Pe,{type:"monotone",dataKey:"time",stroke:"hsl(var(--primary))",strokeWidth:2,dot:{r:3},activeDot:{r:5}})]})})]}):null,e.jsx("div",{className:"divide-y divide-border",children:t.performances.map(i=>{const r=i.id===t.bestId;return e.jsxs("div",{className:F("px-3 py-2.5",r&&"bg-primary/5"),children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex items-center gap-1.5 min-w-0",children:[r&&e.jsx(ie,{className:"h-3.5 w-3.5 text-primary shrink-0"}),e.jsx("span",{className:"text-xs text-muted-foreground tabular-nums",children:Y(i.competition_date)})]}),e.jsx("span",{className:F("font-mono tabular-nums text-sm shrink-0",r?"text-primary font-bold":"font-medium"),children:i.time_display??D(i.time_seconds)})]}),e.jsxs("div",{className:"flex items-center gap-3 mt-0.5 text-xs text-muted-foreground",children:[i.ffn_points!=null&&e.jsxs("span",{className:"tabular-nums",children:[String(i.ffn_points)," pts"]}),i.competition_name&&e.jsx("span",{className:"truncate",children:i.competition_name})]})]},i.id)})})]}):null]})})},t.eventCode)})})]}):null,e.jsx("div",{className:"h-6"})]}),e.jsxs(Ee,{value:"1rm",className:"mt-0",children:[e.jsx("div",{className:"mt-3",children:e.jsx(H,{className:"w-full min-w-0 rounded-2xl",children:e.jsxs(X,{className:"p-0",children:[Ye||Ze?e.jsxs("div",{className:"p-4 grid gap-3",children:[e.jsx(_,{}),e.jsx(_,{}),e.jsx(_,{})]}):Ge||et?e.jsx("div",{className:"p-4 text-sm text-muted-foreground",children:"Impossible de charger les records musculation."}):e.jsx(S.div,{className:"divide-y divide-border motion-reduce:animate-none",variants:ae,initial:"hidden",animate:"visible",children:Je?.filter(t=>t.exercise_type!=="warmup").map(t=>{const s=Xe?.find(c=>c.exercise_id===t.id),l=Number(s?.weight??0),i=l>0?`${l} kg`:"—",r=s?.recorded_at??s?.date??null,n=s?.notes??null,u=qe===t.id,h=De===t.id,f=Qe===t.id;return e.jsxs(S.div,{className:"px-3 py-2.5 motion-reduce:animate-none",variants:oe,children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("span",{className:"text-sm font-semibold truncate",children:t.nom_exercice}),e.jsxs("div",{className:"flex items-center gap-2 shrink-0",children:[e.jsx("span",{className:F("font-mono font-bold tabular-nums text-sm",l>0?"text-primary":"text-muted-foreground"),children:i}),!u&&e.jsx("button",{type:"button",onClick:()=>lt(t.id,s?.weight??null),className:"inline-flex items-center justify-center h-8 w-8 rounded-xl text-muted-foreground hover:text-foreground hover:bg-muted/60 transition","aria-label":`Modifier ${t.nom_exercice}`,children:e.jsx(Re,{className:"h-3.5 w-3.5"})})]})]}),e.jsxs("div",{className:"flex items-center justify-between mt-0.5",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground min-w-0",children:[e.jsx("span",{className:"tabular-nums shrink-0",children:Y(r)}),n&&!f?e.jsx("button",{type:"button",onClick:()=>{A(t.id),M(n??"")},className:"truncate italic hover:text-foreground transition text-left",title:"Modifier la note",children:n}):null]}),e.jsxs("div",{className:"flex items-center gap-1 shrink-0",children:[e.jsx("button",{type:"button",onClick:()=>{f?(A(null),M("")):(A(t.id),M(n??""))},className:F("inline-flex items-center justify-center h-7 w-7 rounded-lg transition",n?"text-primary hover:text-primary/80":"text-muted-foreground/40 hover:text-muted-foreground"),"aria-label":n?"Modifier la note":"Ajouter une note",children:e.jsx(Rt,{className:"h-3.5 w-3.5"})}),l>0&&!u?e.jsxs("button",{type:"button",onClick:()=>Ke(h?null:t.id),className:"inline-flex items-center gap-0.5 h-7 px-1.5 rounded-lg text-xs text-muted-foreground hover:text-foreground transition","aria-label":"Table des pourcentages",children:[e.jsx(Me,{className:F("h-3.5 w-3.5 transition-transform",h&&"rotate-180")}),e.jsx("span",{className:"text-[10px] font-bold",children:"%"})]}):null]})]}),u?e.jsx("div",{className:"mt-3",children:e.jsx(Pt,{value:ze,placeholder:"Ex: 100",inputMode:"decimal",hint:"Charge max (kg).",onCancel:ye,onSave:c=>dt(t.id,c)})}):null,f?e.jsx("div",{className:"mt-3",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(I,{value:me,onChange:c=>M(c.target.value),placeholder:"Machine n°3, cran 5...",className:"h-9 rounded-lg text-sm flex-1",autoFocus:!0}),e.jsx(b,{type:"button",size:"sm",onClick:()=>{const c=me.trim()||null;je.mutate({exercise_id:t.id,notes:c}),A(null),M("")},disabled:je.isPending,className:"rounded-lg h-9 w-9 p-0 shrink-0","aria-label":"Enregistrer",children:e.jsx(J,{className:"h-4 w-4"})}),e.jsx(b,{type:"button",size:"sm",variant:"outline",onClick:()=>{A(null),M("")},className:"rounded-lg h-9 w-9 p-0 shrink-0","aria-label":"Annuler",children:e.jsx(G,{className:"h-4 w-4"})})]})}):null,h&&l>0?e.jsx("div",{className:"mt-3 rounded-xl bg-muted/30 border border-border p-3",children:e.jsx("div",{className:"grid grid-cols-5 gap-2 text-center text-xs",children:[50,60,70,80,90].map(c=>e.jsxs("div",{className:"space-y-0.5",children:[e.jsxs("div",{className:"text-[10px] text-muted-foreground font-medium",children:[c,"%"]}),e.jsx("div",{className:"font-bold tabular-nums font-mono",children:Math.round(l*c/10)/10})]},c))})}):null]},t.id)})}),ge.isPending?e.jsxs("div",{className:"px-4 pb-4 text-xs text-muted-foreground flex items-center gap-2",children:[e.jsx(Ce,{className:"h-3 w-3 animate-spin"})," Mise à jour..."]}):null]})})}),e.jsx("div",{className:"h-6"})]})]})})]})}):e.jsx("div",{className:"min-h-[100dvh]",children:e.jsxs("div",{className:"mx-auto max-w-lg px-4 pt-16 pb-10 text-center",children:[e.jsx(W,{className:"h-10 w-10 mx-auto text-muted-foreground/30"}),e.jsx("p",{className:"mt-3 text-sm text-muted-foreground",children:"Cette page est réservée aux nageurs."})]})})}export{bs as default};
