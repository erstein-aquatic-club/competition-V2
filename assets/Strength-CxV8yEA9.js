import{R as d,T as jn,L as Nn,G as Sn,H as _n,J as Cn,r as f,O as Rn,j as e}from"./vendor-ui-CDk0TPZB.js";import{b as En,u as at,d as kn,c as it}from"./vendor-query-aL7hzhW6.js";import{h as tt,k as fe,i as Kt,D as Ye,B as F,C as Xe,b as Et,c as kt,d as Qt,f as Dt,L as et,o as Dn,X as yt,u as Tn,I as jt,g as Ee}from"./index-DpV54lvT.js";import{S as Yt,a as Xt,b as Gt,c as Jt,d as Mn}from"./sheet-xH8HZdfQ.js";import{S as Tt}from"./switch-DbjqQeGk.js";import{S as An,a as In,b as On,c as $n,d as pt}from"./select-DbHakkKm.js";import{T as Pn,a as Ln,b as $t,c as Pt}from"./tabs-B7CfkwX-.js";import{B as ut}from"./badge-6eP1_K7S.js";import{A as Fn,a as Hn,b as zn,c as Bn,d as qn,e as Vn,f as Un,g as Wn,P as Lt}from"./alert-dialog-DbNU1O3-.js";import{C as Ft}from"./check-C4YYt1vA.js";import{T as Kn}from"./timer-D-gHGXaJ.js";import{C as Mt,I as Qn}from"./info-jh94FZeA.js";import{S as Yn}from"./search-Bu-bHA1M.js";import{C as Ht}from"./chevron-left-otRumbAA.js";import{f as ht}from"./fr-CqUxEDd2.js";import{f as xt}from"./vendor-date-cQbdWov0.js";import"./vendor-react-BzrpNAyj.js";import"./vendor-charts-bGfQb4ap.js";import"./vendor-supabase-CgI36rMY.js";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xn=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],Gn=tt("calendar",Xn);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jn=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],Zn=tt("circle-check",Jn);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const er=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]],tr=tt("loader-circle",er);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nr=[["rect",{x:"14",y:"3",width:"5",height:"18",rx:"1",key:"kaeet6"}],["rect",{x:"5",y:"3",width:"5",height:"18",rx:"1",key:"1wsw3u"}]],rr=tt("pause",nr);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sr=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]],ar=tt("rotate-ccw",sr);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ir=[["path",{d:"M10 5H3",key:"1qgfaw"}],["path",{d:"M12 19H3",key:"yhmn1j"}],["path",{d:"M14 3v4",key:"1sua03"}],["path",{d:"M16 17v4",key:"1q0r14"}],["path",{d:"M21 12h-9",key:"1o4lsq"}],["path",{d:"M21 19h-5",key:"1rlt1p"}],["path",{d:"M21 5h-7",key:"1oszz2"}],["path",{d:"M8 10v4",key:"tgpxqk"}],["path",{d:"M8 12H3",key:"a7s4jb"}]],or=tt("sliders-horizontal",ir);function lr(t){if(typeof document>"u")return;let r=document.head||document.getElementsByTagName("head")[0],s=document.createElement("style");s.type="text/css",r.appendChild(s),s.styleSheet?s.styleSheet.cssText=t:s.appendChild(document.createTextNode(t))}const Zt=d.createContext({drawerRef:{current:null},overlayRef:{current:null},onPress:()=>{},onRelease:()=>{},onDrag:()=>{},onNestedDrag:()=>{},onNestedOpenChange:()=>{},onNestedRelease:()=>{},openProp:void 0,dismissible:!1,isOpen:!1,isDragging:!1,keyboardIsOpen:{current:!1},snapPointsOffset:null,snapPoints:null,handleOnly:!1,modal:!1,shouldFade:!1,activeSnapPoint:null,onOpenChange:()=>{},setActiveSnapPoint:()=>{},closeDrawer:()=>{},direction:"bottom",shouldAnimate:{current:!0},shouldScaleBackground:!1,setBackgroundColorOnScale:!0,noBodyStyles:!1,container:null,autoFocus:!1}),mt=()=>{const t=d.useContext(Zt);if(!t)throw new Error("useDrawerContext must be used within a Drawer.Root");return t};lr(`[data-vaul-drawer]{touch-action:none;will-change:transform;transition:transform .5s cubic-bezier(.32, .72, 0, 1);animation-duration:.5s;animation-timing-function:cubic-bezier(0.32,0.72,0,1)}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=bottom][data-state=open]{animation-name:slideFromBottom}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=bottom][data-state=closed]{animation-name:slideToBottom}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=top][data-state=open]{animation-name:slideFromTop}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=top][data-state=closed]{animation-name:slideToTop}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=left][data-state=open]{animation-name:slideFromLeft}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=left][data-state=closed]{animation-name:slideToLeft}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=right][data-state=open]{animation-name:slideFromRight}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=right][data-state=closed]{animation-name:slideToRight}[data-vaul-drawer][data-vaul-snap-points=true][data-vaul-drawer-direction=bottom]{transform:translate3d(0,var(--initial-transform,100%),0)}[data-vaul-drawer][data-vaul-snap-points=true][data-vaul-drawer-direction=top]{transform:translate3d(0,calc(var(--initial-transform,100%) * -1),0)}[data-vaul-drawer][data-vaul-snap-points=true][data-vaul-drawer-direction=left]{transform:translate3d(calc(var(--initial-transform,100%) * -1),0,0)}[data-vaul-drawer][data-vaul-snap-points=true][data-vaul-drawer-direction=right]{transform:translate3d(var(--initial-transform,100%),0,0)}[data-vaul-drawer][data-vaul-delayed-snap-points=true][data-vaul-drawer-direction=top]{transform:translate3d(0,var(--snap-point-height,0),0)}[data-vaul-drawer][data-vaul-delayed-snap-points=true][data-vaul-drawer-direction=bottom]{transform:translate3d(0,var(--snap-point-height,0),0)}[data-vaul-drawer][data-vaul-delayed-snap-points=true][data-vaul-drawer-direction=left]{transform:translate3d(var(--snap-point-height,0),0,0)}[data-vaul-drawer][data-vaul-delayed-snap-points=true][data-vaul-drawer-direction=right]{transform:translate3d(var(--snap-point-height,0),0,0)}[data-vaul-overlay][data-vaul-snap-points=false]{animation-duration:.5s;animation-timing-function:cubic-bezier(0.32,0.72,0,1)}[data-vaul-overlay][data-vaul-snap-points=false][data-state=open]{animation-name:fadeIn}[data-vaul-overlay][data-state=closed]{animation-name:fadeOut}[data-vaul-animate=false]{animation:none!important}[data-vaul-overlay][data-vaul-snap-points=true]{opacity:0;transition:opacity .5s cubic-bezier(.32, .72, 0, 1)}[data-vaul-overlay][data-vaul-snap-points=true]{opacity:1}[data-vaul-drawer]:not([data-vaul-custom-container=true])::after{content:'';position:absolute;background:inherit;background-color:inherit}[data-vaul-drawer][data-vaul-drawer-direction=top]::after{top:initial;bottom:100%;left:0;right:0;height:200%}[data-vaul-drawer][data-vaul-drawer-direction=bottom]::after{top:100%;bottom:initial;left:0;right:0;height:200%}[data-vaul-drawer][data-vaul-drawer-direction=left]::after{left:initial;right:100%;top:0;bottom:0;width:200%}[data-vaul-drawer][data-vaul-drawer-direction=right]::after{left:100%;right:initial;top:0;bottom:0;width:200%}[data-vaul-overlay][data-vaul-snap-points=true]:not([data-vaul-snap-points-overlay=true]):not(
[data-state=closed]
){opacity:0}[data-vaul-overlay][data-vaul-snap-points-overlay=true]{opacity:1}[data-vaul-handle]{display:block;position:relative;opacity:.7;background:#e2e2e4;margin-left:auto;margin-right:auto;height:5px;width:32px;border-radius:1rem;touch-action:pan-y}[data-vaul-handle]:active,[data-vaul-handle]:hover{opacity:1}[data-vaul-handle-hitarea]{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);width:max(100%,2.75rem);height:max(100%,2.75rem);touch-action:inherit}@media (hover:hover) and (pointer:fine){[data-vaul-drawer]{user-select:none}}@media (pointer:fine){[data-vaul-handle-hitarea]:{width:100%;height:100%}}@keyframes fadeIn{from{opacity:0}to{opacity:1}}@keyframes fadeOut{to{opacity:0}}@keyframes slideFromBottom{from{transform:translate3d(0,var(--initial-transform,100%),0)}to{transform:translate3d(0,0,0)}}@keyframes slideToBottom{to{transform:translate3d(0,var(--initial-transform,100%),0)}}@keyframes slideFromTop{from{transform:translate3d(0,calc(var(--initial-transform,100%) * -1),0)}to{transform:translate3d(0,0,0)}}@keyframes slideToTop{to{transform:translate3d(0,calc(var(--initial-transform,100%) * -1),0)}}@keyframes slideFromLeft{from{transform:translate3d(calc(var(--initial-transform,100%) * -1),0,0)}to{transform:translate3d(0,0,0)}}@keyframes slideToLeft{to{transform:translate3d(calc(var(--initial-transform,100%) * -1),0,0)}}@keyframes slideFromRight{from{transform:translate3d(var(--initial-transform,100%),0,0)}to{transform:translate3d(0,0,0)}}@keyframes slideToRight{to{transform:translate3d(var(--initial-transform,100%),0,0)}}`);function cr(){const t=navigator.userAgent;return typeof window<"u"&&(/Firefox/.test(t)&&/Mobile/.test(t)||/FxiOS/.test(t))}function dr(){return Ot(/^Mac/)}function ur(){return Ot(/^iPhone/)}function zt(){return/^((?!chrome|android).)*safari/i.test(navigator.userAgent)}function mr(){return Ot(/^iPad/)||dr()&&navigator.maxTouchPoints>1}function en(){return ur()||mr()}function Ot(t){return typeof window<"u"&&window.navigator!=null?t.test(window.navigator.platform):void 0}const fr=24,pr=typeof window<"u"?f.useLayoutEffect:f.useEffect;function Bt(...t){return(...r)=>{for(let s of t)typeof s=="function"&&s(...r)}}const Nt=typeof document<"u"&&window.visualViewport;function qt(t){let r=window.getComputedStyle(t);return/(auto|scroll)/.test(r.overflow+r.overflowX+r.overflowY)}function tn(t){for(qt(t)&&(t=t.parentElement);t&&!qt(t);)t=t.parentElement;return t||document.scrollingElement||document.documentElement}const hr=new Set(["checkbox","radio","range","color","file","image","button","submit","reset"]);let gt=0,St;function xr(t={}){let{isDisabled:r}=t;pr(()=>{if(!r)return gt++,gt===1&&en()&&(St=gr()),()=>{gt--,gt===0&&St?.()}},[r])}function gr(){let t,r=0,s=j=>{t=tn(j.target),!(t===document.documentElement&&t===document.body)&&(r=j.changedTouches[0].pageY)},i=j=>{if(!t||t===document.documentElement||t===document.body){j.preventDefault();return}let y=j.changedTouches[0].pageY,H=t.scrollTop,G=t.scrollHeight-t.clientHeight;G!==0&&((H<=0&&y>r||H>=G&&y<r)&&j.preventDefault(),r=y)},l=j=>{let y=j.target;At(y)&&y!==document.activeElement&&(j.preventDefault(),y.style.transform="translateY(-2000px)",y.focus(),requestAnimationFrame(()=>{y.style.transform=""}))},o=j=>{let y=j.target;At(y)&&(y.style.transform="translateY(-2000px)",requestAnimationFrame(()=>{y.style.transform="",Nt&&(Nt.height<window.innerHeight?requestAnimationFrame(()=>{Vt(y)}):Nt.addEventListener("resize",()=>Vt(y),{once:!0}))}))},x=()=>{window.scrollTo(0,0)},p=window.pageXOffset,m=window.pageYOffset,E=Bt(vr(document.documentElement,"paddingRight",`${window.innerWidth-document.documentElement.clientWidth}px`));window.scrollTo(0,0);let v=Bt(ot(document,"touchstart",s,{passive:!1,capture:!0}),ot(document,"touchmove",i,{passive:!1,capture:!0}),ot(document,"touchend",l,{passive:!1,capture:!0}),ot(document,"focus",o,!0),ot(window,"scroll",x));return()=>{E(),v(),window.scrollTo(p,m)}}function vr(t,r,s){let i=t.style[r];return t.style[r]=s,()=>{t.style[r]=i}}function ot(t,r,s,i){return t.addEventListener(r,s,i),()=>{t.removeEventListener(r,s,i)}}function Vt(t){let r=document.scrollingElement||document.documentElement;for(;t&&t!==r;){let s=tn(t);if(s!==document.documentElement&&s!==document.body&&s!==t){let i=s.getBoundingClientRect().top,l=t.getBoundingClientRect().top,o=t.getBoundingClientRect().bottom;const x=s.getBoundingClientRect().bottom+fr;o>x&&(s.scrollTop+=l-i)}t=s.parentElement}}function At(t){return t instanceof HTMLInputElement&&!hr.has(t.type)||t instanceof HTMLTextAreaElement||t instanceof HTMLElement&&t.isContentEditable}function yr(t,r){typeof t=="function"?t(r):t!=null&&(t.current=r)}function br(...t){return r=>t.forEach(s=>yr(s,r))}function nn(...t){return f.useCallback(br(...t),t)}const rn=new WeakMap;function se(t,r,s=!1){if(!t||!(t instanceof HTMLElement))return;let i={};Object.entries(r).forEach(([l,o])=>{if(l.startsWith("--")){t.style.setProperty(l,o);return}i[l]=t.style[l],t.style[l]=o}),!s&&rn.set(t,i)}function wr(t,r){if(!t||!(t instanceof HTMLElement))return;let s=rn.get(t);s&&(t.style[r]=s[r])}const ne=t=>{switch(t){case"top":case"bottom":return!0;case"left":case"right":return!1;default:return t}};function vt(t,r){if(!t)return null;const s=window.getComputedStyle(t),i=s.transform||s.webkitTransform||s.mozTransform;let l=i.match(/^matrix3d\((.+)\)$/);return l?parseFloat(l[1].split(", ")[ne(r)?13:12]):(l=i.match(/^matrix\((.+)\)$/),l?parseFloat(l[1].split(", ")[ne(r)?5:4]):null)}function jr(t){return 8*(Math.log(t+1)-2)}function _t(t,r){if(!t)return()=>{};const s=t.style.cssText;return Object.assign(t.style,r),()=>{t.style.cssText=s}}function Nr(...t){return(...r)=>{for(const s of t)typeof s=="function"&&s(...r)}}const Y={DURATION:.5,EASE:[.32,.72,0,1]},sn=.4,Sr=.25,_r=100,an=8,Ke=16,It=26,Ct="vaul-dragging";function on(t){const r=d.useRef(t);return d.useEffect(()=>{r.current=t}),d.useMemo(()=>(...s)=>r.current==null?void 0:r.current.call(r,...s),[])}function Cr({defaultProp:t,onChange:r}){const s=d.useState(t),[i]=s,l=d.useRef(i),o=on(r);return d.useEffect(()=>{l.current!==i&&(o(i),l.current=i)},[i,l,o]),s}function ln({prop:t,defaultProp:r,onChange:s=()=>{}}){const[i,l]=Cr({defaultProp:r,onChange:s}),o=t!==void 0,x=o?t:i,p=on(s),m=d.useCallback(E=>{if(o){const j=typeof E=="function"?E(t):E;j!==t&&p(j)}else l(E)},[o,t,l,p]);return[x,m]}function Rr({activeSnapPointProp:t,setActiveSnapPointProp:r,snapPoints:s,drawerRef:i,overlayRef:l,fadeFromIndex:o,onSnapPointChange:x,direction:p="bottom",container:m,snapToSequentialPoint:E}){const[v,j]=ln({prop:t,defaultProp:s?.[0],onChange:r}),[y,H]=d.useState(typeof window<"u"?{innerWidth:window.innerWidth,innerHeight:window.innerHeight}:void 0);d.useEffect(()=>{function C(){H({innerWidth:window.innerWidth,innerHeight:window.innerHeight})}return window.addEventListener("resize",C),()=>window.removeEventListener("resize",C)},[]);const G=d.useMemo(()=>v===s?.[s.length-1]||null,[s,v]),D=d.useMemo(()=>{var C;return(C=s?.findIndex(N=>N===v))!=null?C:null},[s,v]),L=s&&s.length>0&&(o||o===0)&&!Number.isNaN(o)&&s[o]===v||!s,b=d.useMemo(()=>{const C=m?{width:m.getBoundingClientRect().width,height:m.getBoundingClientRect().height}:typeof window<"u"?{width:window.innerWidth,height:window.innerHeight}:{width:0,height:0};var N;return(N=s?.map(M=>{const W=typeof M=="string";let B=0;if(W&&(B=parseInt(M,10)),ne(p)){const g=W?B:y?M*C.height:0;return y?p==="bottom"?C.height-g:-C.height+g:g}const J=W?B:y?M*C.width:0;return y?p==="right"?C.width-J:-C.width+J:J}))!=null?N:[]},[s,y,m]),A=d.useMemo(()=>D!==null?b?.[D]:null,[b,D]),O=d.useCallback(C=>{var N;const M=(N=b?.findIndex(W=>W===C))!=null?N:null;x(M),se(i.current,{transition:`transform ${Y.DURATION}s cubic-bezier(${Y.EASE.join(",")})`,transform:ne(p)?`translate3d(0, ${C}px, 0)`:`translate3d(${C}px, 0, 0)`}),b&&M!==b.length-1&&o!==void 0&&M!==o&&M<o?se(l.current,{transition:`opacity ${Y.DURATION}s cubic-bezier(${Y.EASE.join(",")})`,opacity:"0"}):se(l.current,{transition:`opacity ${Y.DURATION}s cubic-bezier(${Y.EASE.join(",")})`,opacity:"1"}),j(s?.[Math.max(M,0)])},[i.current,s,b,o,l,j]);d.useEffect(()=>{if(v||t){var C;const N=(C=s?.findIndex(M=>M===t||M===v))!=null?C:-1;b&&N!==-1&&typeof b[N]=="number"&&O(b[N])}},[v,t,s,b,O]);function w({draggedDistance:C,closeDrawer:N,velocity:M,dismissible:W}){if(o===void 0)return;const B=p==="bottom"||p==="right"?(A??0)-C:(A??0)+C,J=D===o-1,g=D===0,V=C>0;if(J&&se(l.current,{transition:`opacity ${Y.DURATION}s cubic-bezier(${Y.EASE.join(",")})`}),!E&&M>2&&!V){W?N():O(b[0]);return}if(!E&&M>2&&V&&b&&s){O(b[s.length-1]);return}const K=b?.reduce(($,oe)=>typeof $!="number"||typeof oe!="number"?$:Math.abs(oe-B)<Math.abs($-B)?oe:$),q=ne(p)?window.innerHeight:window.innerWidth;if(M>sn&&Math.abs(C)<q*.4){const $=V?1:-1;if($>0&&G&&s){O(b[s.length-1]);return}if(g&&$<0&&W&&N(),D===null)return;O(b[D+$]);return}O(K)}function ie({draggedDistance:C}){if(A===null)return;const N=p==="bottom"||p==="right"?A-C:A+C;(p==="bottom"||p==="right")&&N<b[b.length-1]||(p==="top"||p==="left")&&N>b[b.length-1]||se(i.current,{transform:ne(p)?`translate3d(0, ${N}px, 0)`:`translate3d(${N}px, 0, 0)`})}function pe(C,N){if(!s||typeof D!="number"||!b||o===void 0)return null;const M=D===o-1;if(D>=o&&N)return 0;if(M&&!N)return 1;if(!L&&!M)return null;const B=M?D+1:D-1,J=M?b[B]-b[B-1]:b[B+1]-b[B],g=C/Math.abs(J);return M?1-g:g}return{isLastSnapPoint:G,activeSnapPoint:v,shouldFade:L,getPercentageDragged:pe,setActiveSnapPoint:j,activeSnapPointIndex:D,onRelease:w,onDrag:ie,snapPointsOffset:b}}const Er=()=>()=>{};function kr(){const{direction:t,isOpen:r,shouldScaleBackground:s,setBackgroundColorOnScale:i,noBodyStyles:l}=mt(),o=d.useRef(null),x=f.useMemo(()=>document.body.style.backgroundColor,[]);function p(){return(window.innerWidth-It)/window.innerWidth}d.useEffect(()=>{if(r&&s){o.current&&clearTimeout(o.current);const m=document.querySelector("[data-vaul-drawer-wrapper]")||document.querySelector("[vaul-drawer-wrapper]");if(!m)return;Nr(i&&!l?_t(document.body,{background:"black"}):Er,_t(m,{transformOrigin:ne(t)?"top":"left",transitionProperty:"transform, border-radius",transitionDuration:`${Y.DURATION}s`,transitionTimingFunction:`cubic-bezier(${Y.EASE.join(",")})`}));const E=_t(m,{borderRadius:`${an}px`,overflow:"hidden",...ne(t)?{transform:`scale(${p()}) translate3d(0, calc(env(safe-area-inset-top) + 14px), 0)`}:{transform:`scale(${p()}) translate3d(calc(env(safe-area-inset-top) + 14px), 0, 0)`}});return()=>{E(),o.current=window.setTimeout(()=>{x?document.body.style.background=x:document.body.style.removeProperty("background")},Y.DURATION*1e3)}}},[r,s,x])}let lt=null;function Dr({isOpen:t,modal:r,nested:s,hasBeenOpened:i,preventScrollRestoration:l,noBodyStyles:o}){const[x,p]=d.useState(()=>typeof window<"u"?window.location.href:""),m=d.useRef(0),E=d.useCallback(()=>{if(zt()&&lt===null&&t&&!o){lt={position:document.body.style.position,top:document.body.style.top,left:document.body.style.left,height:document.body.style.height,right:"unset"};const{scrollX:j,innerHeight:y}=window;document.body.style.setProperty("position","fixed","important"),Object.assign(document.body.style,{top:`${-m.current}px`,left:`${-j}px`,right:"0px",height:"auto"}),window.setTimeout(()=>window.requestAnimationFrame(()=>{const H=y-window.innerHeight;H&&m.current>=y&&(document.body.style.top=`${-(m.current+H)}px`)}),300)}},[t]),v=d.useCallback(()=>{if(zt()&&lt!==null&&!o){const j=-parseInt(document.body.style.top,10),y=-parseInt(document.body.style.left,10);Object.assign(document.body.style,lt),window.requestAnimationFrame(()=>{if(l&&x!==window.location.href){p(window.location.href);return}window.scrollTo(y,j)}),lt=null}},[x]);return d.useEffect(()=>{function j(){m.current=window.scrollY}return j(),window.addEventListener("scroll",j),()=>{window.removeEventListener("scroll",j)}},[]),d.useEffect(()=>{if(r)return()=>{typeof document>"u"||document.querySelector("[data-vaul-drawer]")||v()}},[r,v]),d.useEffect(()=>{s||!i||(t?(!window.matchMedia("(display-mode: standalone)").matches&&E(),r||window.setTimeout(()=>{v()},500)):v())},[t,i,x,r,s,E,v]),{restorePositionSetting:v}}function Tr({open:t,onOpenChange:r,children:s,onDrag:i,onRelease:l,snapPoints:o,shouldScaleBackground:x=!1,setBackgroundColorOnScale:p=!0,closeThreshold:m=Sr,scrollLockTimeout:E=_r,dismissible:v=!0,handleOnly:j=!1,fadeFromIndex:y=o&&o.length-1,activeSnapPoint:H,setActiveSnapPoint:G,fixed:D,modal:L=!0,onClose:b,nested:A,noBodyStyles:O=!1,direction:w="bottom",defaultOpen:ie=!1,disablePreventScroll:pe=!0,snapToSequentialPoint:C=!1,preventScrollRestoration:N=!1,repositionInputs:M=!0,onAnimationEnd:W,container:B,autoFocus:J=!1}){var g,V;const[K=!1,q]=ln({defaultProp:ie,prop:t,onChange:u=>{r?.(u),!u&&!A&&ue(),setTimeout(()=>{W?.(u)},Y.DURATION*1e3),u&&!L&&typeof window<"u"&&window.requestAnimationFrame(()=>{document.body.style.pointerEvents="auto"}),u||(document.body.style.pointerEvents="auto")}}),[$,oe]=d.useState(!1),[Q,de]=d.useState(!1),[Fe,ke]=d.useState(!1),De=d.useRef(null),Ie=d.useRef(null),qe=d.useRef(null),He=d.useRef(null),he=d.useRef(null),z=d.useRef(!1),ge=d.useRef(null),je=d.useRef(0),ve=d.useRef(!1),Ge=d.useRef(!ie),X=d.useRef(0),h=d.useRef(null),Ve=d.useRef(((g=h.current)==null?void 0:g.getBoundingClientRect().height)||0),Ne=d.useRef(((V=h.current)==null?void 0:V.getBoundingClientRect().width)||0),le=d.useRef(0),Ue=d.useCallback(u=>{o&&u===Se.length-1&&(Ie.current=new Date)},[]),{activeSnapPoint:We,activeSnapPointIndex:ye,setActiveSnapPoint:ce,onRelease:nt,snapPointsOffset:Se,onDrag:ee,shouldFade:be,getPercentageDragged:P}=Rr({snapPoints:o,activeSnapPointProp:H,setActiveSnapPointProp:G,drawerRef:h,fadeFromIndex:y,overlayRef:De,onSnapPointChange:Ue,direction:w,container:B,snapToSequentialPoint:C});xr({isDisabled:!K||Q||!L||Fe||!$||!M||!pe});const{restorePositionSetting:ue}=Dr({isOpen:K,modal:L,nested:A??!1,hasBeenOpened:$,preventScrollRestoration:N,noBodyStyles:O});function Te(){return(window.innerWidth-It)/window.innerWidth}function Me(u){var S,k;!v&&!o||h.current&&!h.current.contains(u.target)||(Ve.current=((S=h.current)==null?void 0:S.getBoundingClientRect().height)||0,Ne.current=((k=h.current)==null?void 0:k.getBoundingClientRect().width)||0,de(!0),qe.current=new Date,en()&&window.addEventListener("touchend",()=>z.current=!1,{once:!0}),u.target.setPointerCapture(u.pointerId),je.current=ne(w)?u.pageY:u.pageX)}function xe(u,S){var k;let T=u;const U=(k=window.getSelection())==null?void 0:k.toString(),re=h.current?vt(h.current,w):null,Z=new Date;if(T.tagName==="SELECT"||T.hasAttribute("data-vaul-no-drag")||T.closest("[data-vaul-no-drag]"))return!1;if(w==="right"||w==="left")return!0;if(Ie.current&&Z.getTime()-Ie.current.getTime()<500)return!1;if(re!==null&&(w==="bottom"?re>0:re<0))return!0;if(U&&U.length>0)return!1;if(he.current&&Z.getTime()-he.current.getTime()<E&&re===0||S)return he.current=Z,!1;for(;T;){if(T.scrollHeight>T.clientHeight){if(T.scrollTop!==0)return he.current=new Date,!1;if(T.getAttribute("role")==="dialog")return!0}T=T.parentNode}return!0}function _e(u){if(h.current&&Q){const S=w==="bottom"||w==="right"?1:-1,k=(je.current-(ne(w)?u.pageY:u.pageX))*S,T=k>0,U=o&&!v&&!T;if(U&&ye===0)return;const re=Math.abs(k),Z=document.querySelector("[data-vaul-drawer-wrapper]"),me=w==="bottom"||w==="top"?Ve.current:Ne.current;let ae=re/me;const Ce=P(re,T);if(Ce!==null&&(ae=Ce),U&&ae>=1||!z.current&&!xe(u.target,T))return;if(h.current.classList.add(Ct),z.current=!0,se(h.current,{transition:"none"}),se(De.current,{transition:"none"}),o&&ee({draggedDistance:k}),T&&!o){const we=jr(k),Be=Math.min(we*-1,0)*S;se(h.current,{transform:ne(w)?`translate3d(0, ${Be}px, 0)`:`translate3d(${Be}px, 0, 0)`});return}const Re=1-ae;if((be||y&&ye===y-1)&&(i?.(u,ae),se(De.current,{opacity:`${Re}`,transition:"none"},!0)),Z&&De.current&&x){const we=Math.min(Te()+ae*(1-Te()),1),Be=8-ae*8,rt=Math.max(0,14-ae*14);se(Z,{borderRadius:`${Be}px`,transform:ne(w)?`scale(${we}) translate3d(0, ${rt}px, 0)`:`scale(${we}) translate3d(${rt}px, 0, 0)`,transition:"none"},!0)}if(!o){const we=re*S;se(h.current,{transform:ne(w)?`translate3d(0, ${we}px, 0)`:`translate3d(${we}px, 0, 0)`})}}}d.useEffect(()=>{window.requestAnimationFrame(()=>{Ge.current=!0})},[]),d.useEffect(()=>{var u;function S(){if(!h.current||!M)return;const k=document.activeElement;if(At(k)||ve.current){var T;const U=((T=window.visualViewport)==null?void 0:T.height)||0,re=window.innerHeight;let Z=re-U;const me=h.current.getBoundingClientRect().height||0,ae=me>re*.8;le.current||(le.current=me);const Ce=h.current.getBoundingClientRect().top;if(Math.abs(X.current-Z)>60&&(ve.current=!ve.current),o&&o.length>0&&Se&&ye){const Re=Se[ye]||0;Z+=Re}if(X.current=Z,me>U||ve.current){const Re=h.current.getBoundingClientRect().height;let we=Re;Re>U&&(we=U-(ae?Ce:It)),D?h.current.style.height=`${Re-Math.max(Z,0)}px`:h.current.style.height=`${Math.max(we,U-Ce)}px`}else cr()||(h.current.style.height=`${le.current}px`);o&&o.length>0&&!ve.current?h.current.style.bottom="0px":h.current.style.bottom=`${Math.max(Z,0)}px`}}return(u=window.visualViewport)==null||u.addEventListener("resize",S),()=>{var k;return(k=window.visualViewport)==null?void 0:k.removeEventListener("resize",S)}},[ye,o,Se]);function Ae(u){Je(),b?.(),u||q(!1),setTimeout(()=>{o&&ce(o[0])},Y.DURATION*1e3)}function ze(){if(!h.current)return;const u=document.querySelector("[data-vaul-drawer-wrapper]"),S=vt(h.current,w);se(h.current,{transform:"translate3d(0, 0, 0)",transition:`transform ${Y.DURATION}s cubic-bezier(${Y.EASE.join(",")})`}),se(De.current,{transition:`opacity ${Y.DURATION}s cubic-bezier(${Y.EASE.join(",")})`,opacity:"1"}),x&&S&&S>0&&K&&se(u,{borderRadius:`${an}px`,overflow:"hidden",...ne(w)?{transform:`scale(${Te()}) translate3d(0, calc(env(safe-area-inset-top) + 14px), 0)`,transformOrigin:"top"}:{transform:`scale(${Te()}) translate3d(calc(env(safe-area-inset-top) + 14px), 0, 0)`,transformOrigin:"left"},transitionProperty:"transform, border-radius",transitionDuration:`${Y.DURATION}s`,transitionTimingFunction:`cubic-bezier(${Y.EASE.join(",")})`},!0)}function Je(){!Q||!h.current||(h.current.classList.remove(Ct),z.current=!1,de(!1),He.current=new Date)}function Ze(u){if(!Q||!h.current)return;h.current.classList.remove(Ct),z.current=!1,de(!1),He.current=new Date;const S=vt(h.current,w);if(!u||!xe(u.target,!1)||!S||Number.isNaN(S)||qe.current===null)return;const k=He.current.getTime()-qe.current.getTime(),T=je.current-(ne(w)?u.pageY:u.pageX),U=Math.abs(T)/k;if(U>.05&&(ke(!0),setTimeout(()=>{ke(!1)},200)),o){nt({draggedDistance:T*(w==="bottom"||w==="right"?1:-1),closeDrawer:Ae,velocity:U,dismissible:v}),l?.(u,!0);return}if(w==="bottom"||w==="right"?T>0:T<0){ze(),l?.(u,!0);return}if(U>sn){Ae(),l?.(u,!1);return}var re;const Z=Math.min((re=h.current.getBoundingClientRect().height)!=null?re:0,window.innerHeight);var me;const ae=Math.min((me=h.current.getBoundingClientRect().width)!=null?me:0,window.innerWidth),Ce=w==="left"||w==="right";if(Math.abs(S)>=(Ce?ae:Z)*m){Ae(),l?.(u,!1);return}l?.(u,!0),ze()}d.useEffect(()=>(K&&(se(document.documentElement,{scrollBehavior:"auto"}),Ie.current=new Date),()=>{wr(document.documentElement,"scrollBehavior")}),[K]);function n(u){const S=u?(window.innerWidth-Ke)/window.innerWidth:1,k=u?-Ke:0;ge.current&&window.clearTimeout(ge.current),se(h.current,{transition:`transform ${Y.DURATION}s cubic-bezier(${Y.EASE.join(",")})`,transform:ne(w)?`scale(${S}) translate3d(0, ${k}px, 0)`:`scale(${S}) translate3d(${k}px, 0, 0)`}),!u&&h.current&&(ge.current=setTimeout(()=>{const T=vt(h.current,w);se(h.current,{transition:"none",transform:ne(w)?`translate3d(0, ${T}px, 0)`:`translate3d(${T}px, 0, 0)`})},500))}function c(u,S){if(S<0)return;const k=(window.innerWidth-Ke)/window.innerWidth,T=k+S*(1-k),U=-Ke+S*Ke;se(h.current,{transform:ne(w)?`scale(${T}) translate3d(0, ${U}px, 0)`:`scale(${T}) translate3d(${U}px, 0, 0)`,transition:"none"})}function I(u,S){const k=ne(w)?window.innerHeight:window.innerWidth,T=S?(k-Ke)/k:1,U=S?-Ke:0;S&&se(h.current,{transition:`transform ${Y.DURATION}s cubic-bezier(${Y.EASE.join(",")})`,transform:ne(w)?`scale(${T}) translate3d(0, ${U}px, 0)`:`scale(${T}) translate3d(${U}px, 0, 0)`})}return d.useEffect(()=>{L||window.requestAnimationFrame(()=>{document.body.style.pointerEvents="auto"})},[L]),d.createElement(Sn,{defaultOpen:ie,onOpenChange:u=>{!v&&!u||(u?oe(!0):Ae(!0),q(u))},open:K},d.createElement(Zt.Provider,{value:{activeSnapPoint:We,snapPoints:o,setActiveSnapPoint:ce,drawerRef:h,overlayRef:De,onOpenChange:r,onPress:Me,onRelease:Ze,onDrag:_e,dismissible:v,shouldAnimate:Ge,handleOnly:j,isOpen:K,isDragging:Q,shouldFade:be,closeDrawer:Ae,onNestedDrag:c,onNestedOpenChange:n,onNestedRelease:I,keyboardIsOpen:ve,modal:L,snapPointsOffset:Se,activeSnapPointIndex:ye,direction:w,shouldScaleBackground:x,setBackgroundColorOnScale:p,noBodyStyles:O,container:B,autoFocus:J}},s))}const cn=d.forwardRef(function({...t},r){const{overlayRef:s,snapPoints:i,onRelease:l,shouldFade:o,isOpen:x,modal:p,shouldAnimate:m}=mt(),E=nn(r,s),v=i&&i.length>0;if(!p)return null;const j=d.useCallback(y=>l(y),[l]);return d.createElement(Rn,{onMouseUp:j,ref:E,"data-vaul-overlay":"","data-vaul-snap-points":x&&v?"true":"false","data-vaul-snap-points-overlay":x&&o?"true":"false","data-vaul-animate":m?.current?"true":"false",...t})});cn.displayName="Drawer.Overlay";const dn=d.forwardRef(function({onPointerDownOutside:t,style:r,onOpenAutoFocus:s,...i},l){const{drawerRef:o,onPress:x,onRelease:p,onDrag:m,keyboardIsOpen:E,snapPointsOffset:v,activeSnapPointIndex:j,modal:y,isOpen:H,direction:G,snapPoints:D,container:L,handleOnly:b,shouldAnimate:A,autoFocus:O}=mt(),[w,ie]=d.useState(!1),pe=nn(l,o),C=d.useRef(null),N=d.useRef(null),M=d.useRef(!1),W=D&&D.length>0;kr();const B=(g,V,K=0)=>{if(M.current)return!0;const q=Math.abs(g.y),$=Math.abs(g.x),oe=$>q,Q=["bottom","right"].includes(V)?1:-1;if(V==="left"||V==="right"){if(!(g.x*Q<0)&&$>=0&&$<=K)return oe}else if(!(g.y*Q<0)&&q>=0&&q<=K)return!oe;return M.current=!0,!0};d.useEffect(()=>{W&&window.requestAnimationFrame(()=>{ie(!0)})},[]);function J(g){C.current=null,M.current=!1,p(g)}return d.createElement(Cn,{"data-vaul-drawer-direction":G,"data-vaul-drawer":"","data-vaul-delayed-snap-points":w?"true":"false","data-vaul-snap-points":H&&W?"true":"false","data-vaul-custom-container":L?"true":"false","data-vaul-animate":A?.current?"true":"false",...i,ref:pe,style:v&&v.length>0?{"--snap-point-height":`${v[j??0]}px`,...r}:r,onPointerDown:g=>{b||(i.onPointerDown==null||i.onPointerDown.call(i,g),C.current={x:g.pageX,y:g.pageY},x(g))},onOpenAutoFocus:g=>{s?.(g),O||g.preventDefault()},onPointerDownOutside:g=>{if(t?.(g),!y||g.defaultPrevented){g.preventDefault();return}E.current&&(E.current=!1)},onFocusOutside:g=>{if(!y){g.preventDefault();return}},onPointerMove:g=>{if(N.current=g,b||(i.onPointerMove==null||i.onPointerMove.call(i,g),!C.current))return;const V=g.pageY-C.current.y,K=g.pageX-C.current.x,q=g.pointerType==="touch"?10:2;B({x:K,y:V},G,q)?m(g):(Math.abs(K)>q||Math.abs(V)>q)&&(C.current=null)},onPointerUp:g=>{i.onPointerUp==null||i.onPointerUp.call(i,g),C.current=null,M.current=!1,p(g)},onPointerOut:g=>{i.onPointerOut==null||i.onPointerOut.call(i,g),J(N.current)},onContextMenu:g=>{i.onContextMenu==null||i.onContextMenu.call(i,g),N.current&&J(N.current)}})});dn.displayName="Drawer.Content";const Mr=250,Ar=120,Ir=d.forwardRef(function({preventCycle:t=!1,children:r,...s},i){const{closeDrawer:l,isDragging:o,snapPoints:x,activeSnapPoint:p,setActiveSnapPoint:m,dismissible:E,handleOnly:v,isOpen:j,onPress:y,onDrag:H}=mt(),G=d.useRef(null),D=d.useRef(!1);function L(){if(D.current){O();return}window.setTimeout(()=>{b()},Ar)}function b(){if(o||t||D.current){O();return}if(O(),!x||x.length===0){E||l();return}if(p===x[x.length-1]&&E){l();return}const ie=x.findIndex(C=>C===p);if(ie===-1)return;const pe=x[ie+1];m(pe)}function A(){G.current=window.setTimeout(()=>{D.current=!0},Mr)}function O(){G.current&&window.clearTimeout(G.current),D.current=!1}return d.createElement("div",{onClick:L,onPointerCancel:O,onPointerDown:w=>{v&&y(w),A()},onPointerMove:w=>{v&&H(w)},ref:i,"data-vaul-drawer-visible":j?"true":"false","data-vaul-handle":"","aria-hidden":"true",...s},d.createElement("span",{"data-vaul-handle-hitarea":"","aria-hidden":"true"},r))});Ir.displayName="Drawer.Handle";function Or(t){const r=mt(),{container:s=r.container,...i}=t;return d.createElement(_n,{container:s,...i})}const Le={Root:Tr,Content:dn,Overlay:cn,Portal:Or,Title:jn,Description:Nn},un=({shouldScaleBackground:t=!0,...r})=>e.jsx(Le.Root,{shouldScaleBackground:t,...r});un.displayName="Drawer";const $r=Le.Portal,mn=f.forwardRef(({className:t,...r},s)=>e.jsx(Le.Overlay,{ref:s,className:fe("fixed inset-0 z-50 bg-black/80",t),...r}));mn.displayName=Le.Overlay.displayName;const fn=f.forwardRef(({className:t,children:r,...s},i)=>e.jsxs($r,{children:[e.jsx(mn,{}),e.jsxs(Le.Content,{ref:i,className:fe("fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background",t),...s,children:[e.jsx("div",{className:"mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted"}),r]})]}));fn.displayName="DrawerContent";const pn=({className:t,...r})=>e.jsx("div",{className:fe("grid gap-1.5 p-4 text-center sm:text-left",t),...r});pn.displayName="DrawerHeader";const hn=f.forwardRef(({className:t,...r},s)=>e.jsx(Le.Title,{ref:s,className:fe("text-lg font-semibold leading-none tracking-tight",t),...r}));hn.displayName=Le.Title.displayName;const xn=f.forwardRef(({className:t,...r},s)=>e.jsx(Le.Description,{ref:s,className:fe("text-sm text-muted-foreground",t),...r}));xn.displayName=Le.Description.displayName;function gn({children:t,className:r,containerClassName:s}){return e.jsx("div",{role:"region","aria-label":"Actions",className:fe("fixed bottom-16 left-0 right-0 z-bar md:bottom-0 md:z-bar",r),children:e.jsx("div",{className:fe("mx-auto flex w-full max-w-md items-center justify-between gap-2 border-t bg-background px-4 py-3 shadow-[0_-2px_10px_rgba(0,0,0,0.1)]","md:supports-[padding:env(safe-area-inset-bottom)]:pb-[calc(env(safe-area-inset-bottom)+0.75rem)]",s),children:t})})}const Pr=[1,2,3,4,5];function Ut({value:t,onChange:r,className:s,disabled:i=!1,size:l="md",ariaLabel:o="Sélecteur d'échelle 1 à 5"}){const x=l==="sm"?"h-10 w-10 text-xs":"h-11 w-11 text-sm";return e.jsx("div",{className:fe("flex items-center gap-2",s),role:"group","aria-label":o,children:Pr.map(p=>{const m=t===p;return e.jsx("button",{type:"button",className:fe("flex items-center justify-center rounded-full border font-semibold transition",x,m?"border-primary bg-primary text-primary-foreground":"border-muted-foreground/30 bg-background text-foreground",i&&"opacity-60"),"aria-pressed":m,disabled:i,onClick:()=>{i||r?.(p)},children:p},p)})})}const bt=(t,r)=>{const s=Number(t?.set_index??t?.set_number??t?.setIndex??r);return!Number.isFinite(s)||s<=0?r:s},vn=(t=[],r,s)=>{if(!t.length)return 0;const i=Array.isArray(r)?r:[];if(i.length>0){const x=new Map;i.forEach((m,E)=>{if(!m?.exercise_id)return;const v=x.get(m.exercise_id)??[];v.push({...m,set_index:bt(m,E+1)}),x.set(m.exercise_id,v)});let p=t.length+1;for(let m=0;m<t.length;m+=1){const E=t[m];if((x.get(E.exercise_id)??[]).length<(E.sets??0)){p=m+1;break}}return p}const l=Number(s??0);if(!Number.isFinite(l)||l<=0)return 0;const o=Math.min(t.length,Math.max(0,Math.round(l/100*t.length)));return Math.min(t.length,o+1)},Pe=(t,r)=>{const s=Number(t);return!Number.isFinite(s)||s<=0?"—":r?`${s}${r}`:String(s)};function Lr({session:t,exercises:r,oneRMs:s,onFinish:i,onStart:l,onLogSets:o,onProgress:x,initialLogs:p,isFinishing:m,initialStep:E,onStepChange:v,initialInputOpen:j,initialSeriesOpen:y,onExitFocus:H}){const{toast:G}=Kt(),D=f.useRef(!1),[L,b]=f.useState(E??0),[A,O]=f.useState([]),[w,ie]=f.useState(0),[pe,C]=f.useState(!0),N=f.useRef(Date.now()),M=f.useRef(0),[W,B]=f.useState(0),[J,g]=f.useState(!1),[V,K]=f.useState(!1),q=f.useRef(0),$=f.useRef(0),[oe,Q]=f.useState(!0),[de,Fe]=f.useState(3),[ke,De]=f.useState(3),[Ie,qe]=f.useState(""),[He,he]=f.useState(!1),[z,ge]=f.useState(1),[je,ve]=f.useState(y??!1),[Ge,X]=f.useState(j??!1),[h,Ve]=f.useState("weight"),[Ne,le]=f.useState(""),[Ue,We]=f.useState(!1),[ye,ce]=f.useState(!1),[nt,Se]=f.useState(!1);f.useEffect(()=>{if(!pe)return;const a=()=>{ie(Math.floor((Date.now()-N.current)/1e3)+M.current)};a();const R=setInterval(a,1e3),te=()=>{document.visibilityState==="visible"&&a()};return document.addEventListener("visibilitychange",te),()=>{clearInterval(R),document.removeEventListener("visibilitychange",te)}},[pe]),f.useEffect(()=>{if(!Ue)return;const a=R=>{R.key==="Escape"&&We(!1)};return window.addEventListener("keydown",a),()=>window.removeEventListener("keydown",a)},[Ue]),f.useEffect(()=>{if(!J||V)return;const a=()=>{const _=Math.max(0,Math.ceil((q.current-Date.now())/1e3));B(_),_<=0&&(g(!1),K(!1))};a();const R=setInterval(a,1e3),te=()=>{document.visibilityState==="visible"&&a()};return document.addEventListener("visibilitychange",te),()=>{clearInterval(R),document.removeEventListener("visibilitychange",te)}},[J,V]);const ee=t.items||[],be=L-1,P=L>0&&L<=ee.length?ee[be]:null,ue=P?r.find(a=>a.id===P.exercise_id):null,Te=L<ee.length?ee[L]:null,Me=Te?r.find(a=>a.id===Te.exercise_id):null,xe=(()=>{const a=ue?.muscle_groups??ue?.muscles??ue?.muscleGroups??[];return Array.isArray(a)?a:[]})(),_e=P?.rest_seconds??0,Ae=ee.length?Math.min(100,Math.max(0,Math.round((L-1)/ee.length*100))):0,ze=Number(P?.percent_1rm),Je=Number.isFinite(ze)&&ze>0,Ze=Je&&s.find(a=>a.exercise_id===P?.exercise_id)?.weight||0,n=Je?Math.round(Ze*(ze/100)):0,[c,I]=f.useState({}),u=f.useMemo(()=>{const a=new Map;return A.forEach((R,te)=>{const _=bt(R,te+1);R.exercise_id&&a.set(`${R.exercise_id}-${_}`,R)}),a},[A]),S=P?`${P.exercise_id}-${z}`:null,k=S?u.get(S):null,T=k?.weight??c[z-1]?.weight??n,U=k?.reps??c[z-1]?.reps??P?.reps??"",re=()=>{if(typeof window>"u")return;const a=["#22c55e","#3b82f6","#f97316","#e11d48","#a855f7"],R=120;for(let te=0;te<R;te+=1){const _=document.createElement("div"),Oe=Math.random()*6+6;_.style.position="fixed",_.style.top="-10px",_.style.left=`${Math.random()*100}vw`,_.style.width=`${Oe}px`,_.style.height=`${Oe*.6}px`,_.style.backgroundColor=a[te%a.length],_.style.opacity="0.9",_.style.pointerEvents="none",_.style.zIndex="9999",_.style.borderRadius="2px",document.body.appendChild(_);const $e=(Math.random()-.5)*200,st=1200+Math.random()*800,ft=Math.random()*360;_.animate([{transform:"translate3d(0, 0, 0) rotate(0deg)",opacity:1},{transform:`translate3d(${$e}px, ${window.innerHeight+200}px, 0) rotate(${ft}deg)`,opacity:0}],{duration:st,easing:"ease-out"}).onfinish=()=>_.remove()}};f.useEffect(()=>{if(D.current){p&&O(p);return}if(!p){O(_=>_.length?[]:_),I(_=>Object.keys(_).length?{}:_);return}if(O(p),!p.length){I(_=>Object.keys(_).length?{}:_),b(_=>_===0?_:0);return}const a=t.items||[];if(!a.length)return;const R=new Map;p.forEach((_,Oe)=>{if(!_.exercise_id)return;const $e=R.get(_.exercise_id)??[];$e.push({..._,set_index:bt(_,Oe+1)}),R.set(_.exercise_id,$e)});const te=vn(a,p);if(te>0&&te<=a.length){const _=a[te-1],Oe=R.get(_.exercise_id)??[],$e=Oe.reduce((ft,wt,bn)=>{const wn=bt(wt,bn+1);return ft[wn-1]={reps:wt.reps??void 0,weight:wt.weight??void 0},ft},{});I($e);const st=Math.min(_.sets??1,Oe.length+1);ge(st)}else I({}),ge(1);b(_=>_===te?_:te)},[p,t.items]),f.useEffect(()=>{L<=ee.length||He||(re(),he(!0))},[L,ee.length,He]);const Z=a=>{b(a),v?.(a)},me=a=>{a<=0||(q.current=Date.now()+a*1e3,$.current=0,B(a),g(!0),K(!1))},ae=async()=>{window.scrollTo({top:0,behavior:"smooth"});const a=L+1;ge(1),I({}),Z(a);const R=Math.round(Math.min(a-1,ee.length)/ee.length*100);try{await x?.(R)}catch{G({title:"Erreur de sauvegarde",description:"Réessayez",variant:"destructive"})}},Ce=async()=>{if(!P)return;if(k){z>=P.sets?await ae():ge(R=>Math.min(P.sets,R+1));return}const a={exercise_id:P.exercise_id,set_number:z,reps:c[z-1]?.reps||P.reps,weight:c[z-1]?.weight||n};O(R=>[...R,a]),D.current=!0;try{await o?.([a])}catch{G({title:"Erreur de sauvegarde",description:"Réessayez",variant:"destructive"})}finally{D.current=!1}if(oe&&P.rest_seconds>0&&me(P.rest_seconds),z>=P.sets){await ae();return}ge(R=>Math.min(P.sets,R+1))},Re=a=>{Ve(a);const R=a==="weight"?c[z-1]?.weight??n??"":c[z-1]?.reps??P?.reps??"";le(R?String(R):""),X(!0)},we=()=>{if(!P)return;const a=Number(h==="weight"?Ne.replace(",","."):Ne);Number.isFinite(a)&&(I(R=>({...R,[z-1]:{...R[z-1],[h]:a}})),X(!1))},Be=a=>{le(R=>a==="."&&R.includes(".")?R:R+a)},rt=a=>{if(!P)return;Ve(a);const R=a==="weight"?c[z-1]?.weight??n??"":c[z-1]?.reps??P?.reps??"";le(R?String(R):"")};return L===0?e.jsxs("div",{className:"space-y-6 text-center py-8 animate-in zoom-in duration-300",children:[e.jsx("div",{className:"h-24 w-24 bg-primary/10 rounded-full flex items-center justify-center mx-auto animate-pulse",children:e.jsx(Ye,{className:"h-10 w-10 text-primary ml-1"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold font-display uppercase",children:t.title}),e.jsx("p",{className:"text-muted-foreground text-lg",children:t.description}),e.jsxs("div",{className:"flex gap-2 justify-center mt-4",children:[e.jsx(ut,{variant:"outline",className:"text-sm px-3 py-1",children:t.cycle}),e.jsxs(ut,{variant:"secondary",className:"text-sm px-3 py-1",children:[ee.length," Exercices"]})]})]}),e.jsx(F,{size:"lg",className:"w-full text-xl h-14 font-bold uppercase tracking-wider shadow-lg hover:scale-[1.02] transition-transform",disabled:ye,onClick:async()=>{ce(!0);try{await l?.(),Z(1)}finally{ce(!1)}},children:ye?e.jsxs(e.Fragment,{children:[e.jsx(tr,{className:"mr-2 h-5 w-5 animate-spin"}),"CHARGEMENT..."]}):"COMMENCER SÉANCE"})]}):L>ee.length?e.jsx("div",{className:"space-y-6 animate-in fade-in",children:e.jsxs(Xe,{className:"border-t-8 border-t-primary shadow-xl",children:[e.jsxs(Et,{className:"text-center pb-2",children:[e.jsx("div",{className:"mx-auto bg-primary/10 p-4 rounded-full w-fit mb-4",children:e.jsx(Zn,{className:"h-12 w-12 text-primary"})}),e.jsx(kt,{className:"text-3xl uppercase font-display italic",children:"Séance Terminée !"}),e.jsxs(Qt,{className:"text-lg",children:["Durée totale: ",Math.floor(w/60),"m ",w%60,"s"]})]}),e.jsxs(Dt,{className:"space-y-6 pt-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-center",children:[e.jsxs("div",{className:"bg-muted p-4 rounded-lg",children:[e.jsx("div",{className:"text-xs uppercase font-bold text-muted-foreground",children:"Volume"}),e.jsxs("div",{className:"text-2xl font-mono font-bold",children:[A.reduce((a,R)=>a+(Number(R.weight)||0)*(Number(R.reps)||0),0)," kg"]})]}),e.jsxs("div",{className:"bg-muted p-4 rounded-lg",children:[e.jsx("div",{className:"text-xs uppercase font-bold text-muted-foreground",children:"Séries"}),e.jsx("div",{className:"text-2xl font-mono font-bold",children:A.length})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(et,{className:"uppercase font-bold text-xs text-muted-foreground",children:"Difficulté de la séance"}),e.jsxs("div",{className:"flex items-center justify-between text-[11px] font-semibold text-muted-foreground",children:[e.jsx("span",{children:"Facile"}),e.jsx("span",{children:"Très dur"})]}),e.jsx(Ut,{value:de,onChange:Fe})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(et,{className:"uppercase font-bold text-xs text-muted-foreground",children:"Fatigue fin de séance"}),e.jsxs("div",{className:"flex items-center justify-between text-[11px] font-semibold text-muted-foreground",children:[e.jsx("span",{children:"Frais"}),e.jsx("span",{children:"Épuisé"})]}),e.jsx(Ut,{value:ke,onChange:De})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(et,{className:"uppercase font-bold text-xs text-muted-foreground",children:"Notes"}),e.jsx("textarea",{placeholder:"Sensations, douleurs...",value:Ie,onChange:a=>qe(a.target.value),rows:3,className:"flex w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 resize-none"})]})]}),e.jsx(Dn,{children:e.jsx(F,{className:"w-full h-14 text-lg font-bold uppercase",disabled:m,onClick:()=>{m||i({duration:Math.floor(w/60),feeling:de,fatigue:ke,comments:Ie,logs:A})},children:m?"ENREGISTREMENT...":"ENREGISTRER & FERMER"})})]})}):e.jsxs("div",{className:"space-y-6 pb-32",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{type:"button","aria-label":"Voir l’animation de l’exercice",onClick:()=>{ue?.illustration_gif&&We(!0)},className:"flex h-12 w-12 items-center justify-center overflow-hidden rounded-full border bg-card shadow-sm",children:ue?.illustration_gif?e.jsx("img",{src:ue.illustration_gif,alt:"",className:"h-full w-full object-cover",loading:"lazy",decoding:"async"}):e.jsx(Ye,{className:"h-5 w-5 text-muted-foreground"})}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs("span",{className:"rounded-full bg-muted px-3 py-1 text-xs font-semibold",children:["Ex ",L,"/",ee.length]}),e.jsxs("span",{className:"rounded-full bg-muted px-3 py-1 text-xs font-semibold",children:["S ",z,"/",Pe(P?.sets)]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"text-xs font-semibold text-muted-foreground",children:"Séance"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-2 w-28 overflow-hidden rounded-full bg-muted",children:e.jsx("div",{className:"h-full rounded-full bg-primary",style:{width:`${Ae}%`}})}),e.jsxs("div",{className:"text-sm font-semibold",children:[Ae,"%"]})]}),H?e.jsx(F,{variant:"ghost",size:"icon","aria-label":"Quitter le focus",onClick:()=>{A.length>0?Se(!0):H()},children:e.jsx(yt,{className:"h-4 w-4"})}):null]})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-semibold tracking-tight",children:ue?.nom_exercice??"Exercice"}),xe.length>0&&e.jsx("div",{className:"mt-3 flex flex-wrap gap-2",children:xe.map(a=>e.jsx("span",{className:"rounded-full bg-muted px-3 py-1 text-xs font-semibold text-muted-foreground",children:a},a))})]}),e.jsxs(Xe,{className:"rounded-3xl border bg-card p-4 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-base font-semibold",children:"Série en cours"}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(Tt,{checked:oe,onCheckedChange:Q}),"Auto repos"]})]}),e.jsxs("div",{className:"mt-4 rounded-2xl border bg-muted/20 p-4",children:[e.jsx("div",{className:"text-sm font-semibold",children:"En cours"}),e.jsxs("div",{className:"mt-2 text-lg font-semibold",children:["Série ",z,"/",Pe(P?.sets)," · Objectif"," ",Pe(P?.reps)," reps"]}),e.jsx("div",{className:"mt-2 text-sm text-muted-foreground",children:"Appuie sur une tuile pour saisir."})]}),e.jsxs("div",{className:"mt-4 grid grid-cols-2 gap-3",children:[e.jsxs("button",{type:"button",className:"group relative rounded-2xl border-2 border-primary/20 bg-gradient-to-br from-card to-muted/30 p-4 text-left shadow-sm transition-all active:scale-[0.98] hover:border-primary/40 hover:shadow-md",onClick:()=>Re("weight"),children:[e.jsx("div",{className:"text-[10px] font-bold uppercase tracking-wide text-muted-foreground",children:"Charge"}),e.jsxs("div",{className:"mt-1 flex items-baseline gap-0.5",children:[e.jsx("span",{className:"text-3xl font-bold tabular-nums tracking-tight",children:T||"—"}),e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"kg"})]})]}),e.jsxs("button",{type:"button",className:"group relative rounded-2xl border-2 border-primary/20 bg-gradient-to-br from-card to-muted/30 p-4 text-left shadow-sm transition-all active:scale-[0.98] hover:border-primary/40 hover:shadow-md",onClick:()=>Re("reps"),children:[e.jsx("div",{className:"text-[10px] font-bold uppercase tracking-wide text-muted-foreground",children:"Reps"}),e.jsxs("div",{className:"mt-1 flex items-baseline gap-0.5",children:[e.jsx("span",{className:"text-3xl font-bold tabular-nums tracking-tight",children:U||"—"}),e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"reps"})]})]})]}),e.jsxs("div",{className:"mt-4 rounded-2xl border bg-muted/10 p-4",children:[e.jsx("div",{className:"text-sm font-semibold",children:"Notes"}),e.jsx("div",{className:"mt-2 text-sm text-muted-foreground",children:P?.notes||ue?.description||"Aucune note spécifique."})]}),e.jsx(F,{type:"button",variant:"outline",className:"mt-4 w-full rounded-2xl",onClick:()=>ve(!0),children:"Voir les séries"})]}),!Ge&&!J?e.jsxs(gn,{className:"bottom-0 z-[60]",containerClassName:"gap-3 py-4",children:[e.jsxs(F,{className:"flex-1 min-w-0 h-12 rounded-xl text-sm font-bold shadow-lg active:scale-95 transition-transform",onClick:Ce,children:[e.jsx(Ft,{className:"mr-2 h-5 w-5"})," Valider série"]}),e.jsx(F,{type:"button",variant:"outline",className:"h-12 w-12 rounded-xl p-0 active:scale-95 transition-transform",onClick:()=>{_e<=0||me(_e)},"aria-label":"Démarrer le repos",children:e.jsx(Kn,{className:"h-5 w-5"})}),e.jsx(F,{type:"button",variant:"outline",className:"h-12 w-12 rounded-xl p-0 active:scale-95 transition-transform",onClick:()=>ae(),"aria-label":"Exercice suivant",children:e.jsx(Mt,{className:"h-5 w-5"})})]}):null,J&&e.jsxs("div",{className:"fixed inset-0 z-50 flex flex-col bg-background/95 pb-[env(safe-area-inset-bottom)]",children:[e.jsxs("div",{className:"flex items-start justify-between border-b px-6 py-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-semibold text-muted-foreground",children:"Timer"}),e.jsx("div",{className:"text-lg font-semibold",children:"Transition inter-exercice"}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Prochain exercice : ",Me?.nom_exercice??"À venir"]})]}),e.jsx(F,{variant:"ghost",size:"icon",onClick:()=>{g(!1),K(!1)},"aria-label":"Fermer le timer de repos",children:e.jsx(yt,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"flex flex-1 flex-col items-center justify-center gap-6 px-6 py-8",children:[e.jsxs(Xe,{className:"w-full max-w-sm rounded-3xl border p-6 shadow-sm",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Temps restant"}),e.jsxs("div",{className:"mt-2 text-5xl font-semibold tracking-tight",children:[Math.floor(W/60),":",String(W%60).padStart(2,"0")]}),e.jsx("div",{className:"mt-6 h-3 w-full overflow-hidden rounded-full bg-muted",children:e.jsx("div",{className:"h-full rounded-full bg-primary",style:{width:_e?`${W/_e*100}%`:"0%"}})}),e.jsxs("div",{className:"mt-6 flex flex-wrap gap-3",children:[e.jsx(F,{variant:"outline",className:"rounded-full",onClick:()=>{q.current+=15*1e3,V&&($.current+=15*1e3),B(a=>a+15)},children:"+15s"}),e.jsx(F,{variant:"outline",className:"rounded-full",onClick:()=>{q.current+=30*1e3,V&&($.current+=30*1e3),B(a=>a+30)},children:"+30s"}),e.jsx(F,{variant:"outline",className:"rounded-full",onClick:()=>{q.current=Math.max(Date.now(),q.current-15*1e3),V&&($.current=Math.max(0,$.current-15*1e3)),B(a=>Math.max(0,a-15))},children:"-15s"}),e.jsxs(F,{variant:"outline",className:"ml-auto rounded-full",onClick:()=>{q.current=Date.now()+_e*1e3,V&&($.current=_e*1e3),B(_e)},children:[e.jsx(ar,{className:"mr-2 h-4 w-4"}),"Reset"]})]})]}),e.jsxs("div",{className:"flex w-full max-w-sm flex-wrap gap-3",children:[e.jsxs(F,{className:"flex-1 rounded-full py-6 text-base font-semibold",onClick:()=>{K(a=>(a?q.current=Date.now()+$.current:$.current=Math.max(0,q.current-Date.now()),!a))},children:[e.jsx(rr,{className:"mr-2 h-4 w-4"})," ",V?"Reprendre":"Pause"]}),e.jsxs(F,{variant:"outline",className:"rounded-full px-6 py-6 text-base font-semibold",onClick:()=>{q.current=0,$.current=0,g(!1),B(0),K(!1)},children:["Passer ",e.jsx(Mt,{className:"ml-2 h-4 w-4"})]})]})]})]}),Ue&&ue?.illustration_gif&&e.jsx("div",{className:"fixed inset-0 z-50 bg-black/50",onClick:()=>We(!1),children:e.jsx("div",{className:"fixed inset-0 flex items-center justify-center p-4",onClick:a=>a.stopPropagation(),children:e.jsxs("div",{className:"relative",children:[e.jsx("button",{type:"button","aria-label":"Fermer",className:"absolute -right-3 -top-3 rounded-full bg-background p-2 shadow",onClick:()=>We(!1),children:e.jsx(yt,{className:"h-4 w-4"})}),e.jsx("img",{src:ue.illustration_gif,alt:"",className:"max-h-[80vh] w-auto max-w-[92vw] rounded-2xl",loading:"lazy"})]})})}),e.jsx(Yt,{open:je,onOpenChange:ve,children:e.jsxs(Xt,{side:"bottom",className:"max-h-[80vh] overflow-y-auto",children:[e.jsx(Gt,{children:e.jsx(Jt,{children:"Aperçu séance"})}),e.jsx("div",{className:"mt-4 space-y-4",children:ee.map((a,R)=>{const te=r.find($e=>$e.id===a.exercise_id),_=Array.from({length:a.sets}).filter(($e,st)=>u.get(`${a.exercise_id}-${st+1}`)).length,Oe=a.sets?Math.round(_/a.sets*100):0;return e.jsxs(Xe,{className:"rounded-3xl border bg-muted/10 p-4 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-base font-semibold",children:te?.nom_exercice??a.exercise_name}),e.jsxs("div",{className:"mt-1 text-sm text-muted-foreground",children:[Pe(a.sets),"x",Pe(a.reps)," ·"," ",a.percent_1rm?`${Pe(a.percent_1rm)} 1RM`:"—"]})]}),e.jsxs("div",{className:"rounded-full bg-muted px-3 py-1 text-sm font-semibold",children:[_,"/",Pe(a.sets)]})]}),e.jsx("div",{className:"mt-4 h-3 w-full overflow-hidden rounded-full bg-muted",children:e.jsx("div",{className:"h-full rounded-full bg-primary",style:{width:`${Oe}%`}})})]},`${a.exercise_id}-${R}`)})})]})}),e.jsx(un,{open:Ge,onOpenChange:X,children:e.jsx(fn,{className:"max-h-[90vh]",children:e.jsxs("div",{className:"mx-auto w-full max-w-md px-4 pb-8",children:[e.jsxs(pn,{className:"pb-2",children:[e.jsx(hn,{className:"text-center",children:h==="weight"?"Charge":"Répétitions"}),e.jsxs(xn,{className:"text-center",children:["Série ",z,"/",Pe(P?.sets)," · Objectif"," ",Pe(P?.reps)," reps"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-4",children:[e.jsxs("button",{type:"button",className:fe("rounded-xl border-2 p-4 text-center transition-all",h==="weight"?"border-primary bg-primary/10 shadow-sm":"border-muted bg-card hover:border-muted-foreground/30"),onClick:()=>rt("weight"),children:[e.jsx("div",{className:"text-xs font-semibold uppercase text-muted-foreground",children:"Charge"}),e.jsxs("div",{className:"mt-1 text-2xl font-bold tabular-nums",children:[h==="weight"?Ne||"—":String(c[z-1]?.weight??n??"—"),e.jsx("span",{className:"ml-1 text-base font-normal text-muted-foreground",children:"kg"})]})]}),e.jsxs("button",{type:"button",className:fe("rounded-xl border-2 p-4 text-center transition-all",h==="reps"?"border-primary bg-primary/10 shadow-sm":"border-muted bg-card hover:border-muted-foreground/30"),onClick:()=>rt("reps"),children:[e.jsx("div",{className:"text-xs font-semibold uppercase text-muted-foreground",children:"Reps"}),e.jsxs("div",{className:"mt-1 text-2xl font-bold tabular-nums",children:[h==="reps"?Ne||"—":String(c[z-1]?.reps??P?.reps??"—"),e.jsx("span",{className:"ml-1 text-base font-normal text-muted-foreground",children:"reps"})]})]})]}),h==="weight"&&n>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"text-xs font-semibold text-muted-foreground mb-2",children:"Suggestions"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:[n-10,n-5,n,n+5,n+10].filter(a=>a>0).map(a=>e.jsxs(F,{variant:Number(Ne)===a?"default":"outline",size:"sm",className:"rounded-full px-4 h-10 text-sm font-semibold",onClick:()=>le(String(a)),children:[a," kg"]},a))})]}),h==="reps"&&e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"text-xs font-semibold text-muted-foreground mb-2",children:"Suggestions"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:[6,8,10,12,15,20].map(a=>e.jsx(F,{variant:Number(Ne)===a?"default":"outline",size:"sm",className:"rounded-full px-4 h-10 text-sm font-semibold",onClick:()=>le(String(a)),children:a},a))})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 mb-4",children:[[1,2,3,4,5,6,7,8,9].map(a=>e.jsx(F,{variant:"outline",className:"h-14 text-xl font-semibold rounded-xl active:scale-95 transition-transform",onClick:()=>Be(String(a)),children:a},a)),e.jsx(F,{variant:"outline",className:"h-14 text-xl font-semibold rounded-xl active:scale-95 transition-transform",onClick:()=>Be("."),children:","}),e.jsx(F,{variant:"outline",className:"h-14 text-xl font-semibold rounded-xl active:scale-95 transition-transform",onClick:()=>Be("0"),children:"0"}),e.jsx(F,{variant:"outline",className:"h-14 text-xl font-semibold rounded-xl active:scale-95 transition-transform",onClick:()=>le(a=>a.slice(0,-1)),children:"⌫"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(F,{variant:"outline",className:"flex-1 h-14 text-base font-semibold rounded-xl",onClick:()=>le(""),children:"Effacer"}),e.jsxs(F,{className:"flex-1 h-14 text-base font-semibold rounded-xl",onClick:we,children:[e.jsx(Ft,{className:"mr-2 h-5 w-5"}),"Valider"]})]})]})})}),H&&e.jsx(Fn,{open:nt,onOpenChange:Se,children:e.jsxs(Hn,{children:[e.jsxs(zn,{children:[e.jsx(Bn,{children:"Quitter la séance ?"}),e.jsx(qn,{children:"Les séries enregistrées seront conservées."})]}),e.jsxs(Vn,{children:[e.jsx(Un,{children:"Annuler"}),e.jsx(Wn,{onClick:()=>{Se(!1),H()},children:"Quitter"})]})]})})]})}const Qe=t=>t==="endurance"||t==="hypertrophie"||t==="force"?t:"endurance",ct=t=>{const r=Number(t);return!Number.isFinite(r)||r<=0?null:r},Fr=(t,r)=>{if(!t)return{sets:null,reps:null,percent1rm:null,restSeries:null,restExercise:null};const s={endurance:{sets:t.Nb_series_endurance,reps:t.Nb_reps_endurance,percent1rm:t.pct_1rm_endurance,restSeries:t.recup_endurance,restExercise:t.recup_exercices_endurance},hypertrophie:{sets:t.Nb_series_hypertrophie,reps:t.Nb_reps_hypertrophie,percent1rm:t.pct_1rm_hypertrophie,restSeries:t.recup_hypertrophie,restExercise:t.recup_exercices_hypertrophie},force:{sets:t.Nb_series_force,reps:t.Nb_reps_force,percent1rm:t.pct_1rm_force,restSeries:t.recup_force,restExercise:t.recup_exercices_force}}[r];return{sets:ct(s.sets),reps:ct(s.reps),percent1rm:ct(s.percent1rm),restSeries:ct(s.restSeries),restExercise:ct(s.restExercise)}},dt=(t=[],r,s)=>zr(t,r).map(i=>{const l=Fr(s.get(i.exercise_id),r);return{...i,sets:l.sets??0,reps:l.reps??0,rest_seconds:l.restSeries??0,percent_1rm:l.percent1rm??0}}),Wt=t=>{const r=Number(t);return!Number.isFinite(r)||r<=0?"—":String(r)},Hr=t=>{const r=Number(t);return!Number.isFinite(r)||r<=0?"—":`${r}s`},yn=(t=[])=>{if(!t.length)return t;const r=t.map((i,l)=>{const o=Number(i.order_index);return{item:i,index:l,order:Number.isFinite(o)?o:null}});return r.some(i=>i.order!==null)?r.sort((i,l)=>i.order===null&&l.order===null?i.index-l.index:i.order===null?1:l.order===null?-1:i.order===l.order?i.index-l.index:i.order-l.order).map(i=>i.item):t},zr=(t=[],r)=>{const s=t.filter(l=>l.cycle_type===r),i=s.length?s:t;return yn(i)},Br=t=>{t.setActiveSession(null),t.setActiveAssignment(null),t.setActiveRunId(null),t.setActiveRunLogs(null),t.setActiveRunnerStep(0),t.setScreenMode("list")},qr=({runId:t,assignmentId:r,startedAt:s})=>({id:t,assignment_id:r??null,started_at:s,progress_pct:0,status:"in_progress",logs:[]}),Rt=t=>({runs:t?[t]:[],pagination:{limit:1,offset:0,total:t?1:0},exercise_summary:[]});function cs(){const{user:t,userId:r,role:s,selectedAthleteId:i,selectedAthleteName:l}=Tn(),{toast:o}=Kt(),x=En(),p="strength-preferences",[m,E]=f.useState(null),[v,j]=f.useState(null),[y,H]=f.useState(null),[G,D]=f.useState(null),[L,b]=f.useState(0),[A,O]=f.useState("list"),[w,ie]=f.useState({poolMode:!1,largeText:!1}),[pe,C]=f.useState(""),[N,M]=f.useState("endurance"),[W,B]=f.useState("all"),[J,g]=f.useState(""),[V,K]=f.useState(""),q=(s==="coach"||s==="admin")&&(i!==null||!!l),$=q?l:t,oe=q?i:r,Q=oe??$,de=f.useMemo(()=>`strength-focus-state-${Q??"anonymous"}`,[Q]),{poolMode:Fe,largeText:ke}=w;f.useEffect(()=>{if(typeof window>"u")return;const n=window.localStorage.getItem(p);if(n)try{const c=JSON.parse(n);ie(I=>({...I,...c??{}}))}catch{return}},[]),f.useEffect(()=>{typeof window>"u"||window.localStorage.setItem(p,JSON.stringify(w))},[p,w]),f.useEffect(()=>{if(!(typeof document>"u")){if(A==="focus")return document.body.dataset.focusMode="strength",()=>{document.body.dataset.focusMode==="strength"&&delete document.body.dataset.focusMode};document.body.dataset.focusMode==="strength"&&delete document.body.dataset.focusMode}},[A]),f.useEffect(()=>{if(typeof window>"u"||m)return;const n=window.localStorage.getItem(de);if(n)try{const c=JSON.parse(n),I=c?.screenMode==="focus"?"focus":c?.screenMode==="reader"?"reader":null;if(!I||!c?.session)return;E(c.session),j(c.assignment??null),H(typeof c.runId=="number"?c.runId:null),D(Array.isArray(c.runLogs)?c.runLogs:null),b(Number.isFinite(c.runnerStep)?c.runnerStep:0),c.cycleType&&M(Qe(c.cycleType)),O(I)}catch{return}},[m,de]),f.useEffect(()=>{if(typeof window>"u")return;if(!(A==="focus"||A==="reader")||!m){window.localStorage.removeItem(de);return}const c={screenMode:A,session:m,assignment:v,runId:y,runLogs:G,runnerStep:L,cycleType:N};window.localStorage.setItem(de,JSON.stringify(c))},[v,y,G,L,m,N,de,A]);const{data:De,isLoading:Ie}=at({queryKey:["assignments",t,"strength"],queryFn:()=>Ee.getAssignments(t,r,{assignmentType:"strength"}),enabled:!!t}),{data:qe,isLoading:He}=at({queryKey:["strength_catalog"],queryFn:()=>Ee.getStrengthSessions()}),{data:he}=at({queryKey:["exercises"],queryFn:()=>Ee.getExercises()}),z=Ie||He,{data:ge}=at({queryKey:["1rm",t,r],queryFn:()=>Ee.get1RM({athleteName:t,athleteId:r}),enabled:!!t}),je=kn({queryKey:["strength_history",Q,W,J,V],queryFn:({pageParam:n=0})=>Ee.getStrengthHistory($,{athleteId:oe,limit:10,offset:n,order:"desc",status:W==="all"?void 0:W,from:J||void 0,to:V||void 0}),enabled:!!$,getNextPageParam:n=>{const c=n.pagination.offset+n.pagination.limit;return c<n.pagination.total?c:void 0},initialPageParam:0}),ve=je.data?.pages.flatMap(n=>n.runs)??[],X=at({queryKey:["strength_run_in_progress",Q],queryFn:()=>Ee.getStrengthHistory($,{limit:1,offset:0,order:"desc",status:"in_progress",athleteId:oe}),enabled:!!$}).data?.runs?.[0]??null,h=X?.status==="completed"||(X?.progress_pct??0)>=100,Ve=it({mutationFn:n=>Ee.startStrengthRun(n),onSuccess:n=>{if(n?.run_id&&(H(n.run_id),D(c=>c??[]),Q)){const c=qr({runId:n.run_id,assignmentId:v?.id??null,startedAt:new Date().toISOString()});x.setQueryData(["strength_run_in_progress",Q],Rt(c))}x.invalidateQueries({queryKey:["assignments",t,"strength"]}),x.invalidateQueries({queryKey:["strength_run_in_progress",Q]}),x.invalidateQueries({queryKey:["strength_history"]})},onError:()=>{o({title:"Erreur",description:"Impossible de démarrer la séance.",variant:"destructive"})}}),Ne=it({mutationFn:n=>Ee.logStrengthSet(n),onSuccess:n=>{n?.one_rm_updated&&(x.invalidateQueries({queryKey:["1rm",t,r]}),o({title:"Nouveau 1RM détecté",description:"Ton record vient d'être mis à jour."}))},onError:()=>{o({title:"Erreur",description:"Impossible d'enregistrer une série.",variant:"destructive"})}}),le=it({mutationFn:n=>Ee.updateStrengthRun(n),onSuccess:(n,c)=>{x.invalidateQueries({queryKey:["strength_history"]}),c?.status==="completed"&&(Q&&x.setQueryData(["strength_run_in_progress",Q],Rt(null)),x.invalidateQueries({queryKey:["assignments",t]}),x.invalidateQueries({queryKey:["assignments",t,"strength"]}),x.invalidateQueries({queryKey:["1rm",t,r]}),j(null),H(null),E(null),D(null),O("list"),o({title:"Séance sauvegardée",description:"Bravo pour l'effort !"}))}});it({mutationFn:n=>Ee.startStrengthRun(n),onError:()=>{o({title:"Erreur",description:"Impossible de mettre à jour la séance.",variant:"destructive"})}});const Ue=(n,c)=>{const I=n.items??[],u=Qe(c??n.cycle??I.find(k=>k.cycle_type)?.cycle_type),S=dt(I,u,be);j(n),E({...n,title:n.title,description:n.description,cycle:u,items:S}),H(null),D(null),b(0),O("reader")},ye=(De?.filter(n=>n.session_type==="strength")||[]).filter(n=>n.status!=="completed"),ce=X?ye.find(n=>n.id===X.assignment_id):null,nt=!!ce?.items?.length&&!h,Se=ye.map(n=>({...n,session:{id:n.session_id,title:n.title,description:n.description,cycle:Qe(n.cycle),items:n.items??[]}})),ee=[{value:"endurance",label:"Endurance"},{value:"hypertrophie",label:"Hypertrophie"},{value:"force",label:"Force"}],be=f.useMemo(()=>he?new Map(he.map(n=>[n.id,n])):new Map,[he]),P=Se.map(n=>{const c=dt(n.items??[],N,be);return{key:`assignment-${n.id}`,title:n.title,description:n.description,type:"assignment",assignedDate:n.assigned_date,session:{id:n.session_id,title:n.title,description:n.description,cycle:Qe(n.cycle),items:c},assignment:n,exerciseCount:c.length}}),ue=(qe??[]).map(n=>{const c=dt(n.items??[],N,be);return{key:`catalog-${n.id}`,title:n.title,description:n.description,type:"catalog",session:{...n,items:c,cycle:N},exerciseCount:c.length}}),Te=pe.trim().toLowerCase(),Me=[...P,...ue].filter(n=>Te?`${n.title} ${n.description}`.toLowerCase().includes(Te):!0),xe=f.useMemo(()=>m?dt(m.items??[],N,be):[],[m,N,be]),_e=n=>{if((n.items??[]).length===0){o({title:"Séance vide",description:"Aucun exercice n'est disponible pour cette séance."});return}Ue(n,N),H(null),D(null)},Ae=n=>{const c=n.items??[],u=c.filter(k=>k.cycle_type===N).length>0?N:Qe(n.cycle??c.find(k=>k.cycle_type)?.cycle_type),S=dt(c,u,be);if(S.length===0){o({title:"Séance vide",description:"Aucun exercice n'est disponible pour cette séance."});return}E({...n,cycle:u,items:S}),j(null),H(null),D(null),b(0),O("reader")},ze=()=>{if(m){if(xe.length===0){o({title:"Séance vide",description:"Aucun exercice n'est disponible pour cette séance."});return}E({...m,cycle:N,items:xe}),b(0),O("focus")}},Je=()=>{Br({setActiveSession:E,setActiveAssignment:j,setActiveRunId:H,setActiveRunLogs:D,setActiveRunnerStep:b,setScreenMode:O})},Ze=it({mutationFn:n=>Ee.deleteStrengthRun(n),onSuccess:n=>{Je(),Q&&x.setQueryData(["strength_run_in_progress",Q],Rt(null)),x.invalidateQueries({queryKey:["strength_run_in_progress",Q]}),x.invalidateQueries({queryKey:["strength_history"]}),x.invalidateQueries({queryKey:["assignments",t,"strength"]});const c=n?.source==="local"?"Suppression locale : le serveur n'est pas disponible.":void 0;o({title:"Séance supprimée",description:c})},onError:()=>{o({title:"Erreur",description:"Impossible de supprimer la séance en cours.",variant:"destructive"})}});return e.jsx("div",{className:fe("space-y-4 md:space-y-6",Fe&&"dark bg-background text-foreground contrast-125",ke&&"text-lg leading-relaxed [&_.text-xs]:text-sm [&_.text-sm]:text-base"),children:A==="focus"&&m?he?e.jsx("div",{className:"animate-in fade-in motion-reduce:animate-none",children:e.jsx(Lr,{session:m,exercises:he,oneRMs:ge||[],initialLogs:G,initialStep:L,isFinishing:le.isPending,onStepChange:n=>b(n),onExitFocus:()=>O("reader"),onStart:async()=>{if(y)return;const n=v?.session_id??m?.id??null;if(!n){o({title:"Session manquante",description:"Impossible de démarrer sans session associée.",variant:"destructive"});return}const c={assignment_id:v?.id??null,athlete_id:r??null,athleteName:t??void 0,progress_pct:0,session_id:n,cycle_type:m?.cycle};try{const I=await Ve.mutateAsync(c);I?.run_id&&H(I.run_id)}catch{return}},onLogSets:async n=>{y&&(D(c=>[...c??[],...n]),await Promise.all(n.map((c,I)=>Ne.mutateAsync({run_id:y,exercise_id:c.exercise_id,set_index:c.set_number??I+1,reps:c.reps??null,weight:c.weight??null,athlete_id:r??null,athlete_name:t??null}))))},onProgress:async n=>{y&&await le.mutateAsync({run_id:y,progress_pct:n,status:"in_progress"})},onFinish:n=>{y&&le.mutate({assignment_id:v?.id??void 0,run_id:y,session_id:v?.session_id??m?.id??void 0,athlete_id:r??void 0,date:new Date().toISOString(),progress_pct:100,status:"completed",...n})}})}):e.jsxs("div",{className:"space-y-4 py-10",children:[e.jsx("div",{className:"mx-auto h-8 w-48 rounded-lg bg-muted animate-pulse motion-reduce:animate-none"}),e.jsx("div",{className:"mx-auto h-4 w-32 rounded-lg bg-muted animate-pulse motion-reduce:animate-none"}),e.jsx("div",{className:"space-y-3 pt-4",children:[1,2,3].map(n=>e.jsx("div",{className:"h-20 w-full rounded-xl bg-muted animate-pulse motion-reduce:animate-none"},n))})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-3xl font-display font-bold uppercase italic text-primary",children:"Musculation"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(F,{variant:"ghost",size:"sm","aria-label":"Informations sur le calcul du 1RM",onClick:()=>o({title:"Info",description:"Le 1RM est calculé automatiquement."}),className:"text-muted-foreground",children:[e.jsx(Ye,{className:"mr-2 h-4 w-4"})," Info 1RM"]}),e.jsx(F,{variant:"ghost",size:"icon",onClick:()=>O("settings"),className:"rounded-full border border-muted/50 text-muted-foreground","aria-label":"Paramètres",children:e.jsx(or,{className:"h-4 w-4"})})]})]}),e.jsxs(Pn,{defaultValue:"start",className:"w-full",children:[e.jsxs(Ln,{className:"grid w-full grid-cols-2",children:[e.jsx($t,{value:"start",children:"S'entraîner"}),e.jsx($t,{value:"history",children:"Historique"})]}),e.jsxs(Pt,{value:"start",className:"space-y-5 pt-4",children:[A==="list"&&z&&e.jsxs("div",{className:"space-y-5 pt-4",children:[e.jsx("div",{className:"flex justify-center gap-2",children:[1,2,3].map(n=>e.jsx("div",{className:"h-10 w-28 rounded-full bg-muted animate-pulse"},n))}),e.jsx("div",{className:"h-12 rounded-2xl bg-muted/30 animate-pulse"}),e.jsx("div",{className:"space-y-3",children:[1,2,3,4].map(n=>e.jsx("div",{className:"rounded-2xl border bg-card p-4 shadow-sm",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"h-12 w-12 shrink-0 rounded-xl bg-muted animate-pulse"}),e.jsxs("div",{className:"flex-1 min-w-0 space-y-2",children:[e.jsx("div",{className:"h-4 w-3/4 rounded bg-muted animate-pulse"}),e.jsx("div",{className:"h-3 w-1/2 rounded bg-muted animate-pulse"})]}),e.jsx("div",{className:"h-10 w-10 shrink-0 rounded-full bg-muted animate-pulse"})]})},n))})]}),A==="list"&&!z&&e.jsxs("div",{className:"space-y-5 animate-in fade-in motion-reduce:animate-none",children:[e.jsxs("p",{className:"text-center text-sm text-muted-foreground py-1",children:[Me.length," séance",Me.length>1?"s":""," disponible",Me.length>1?"s":""]}),e.jsx("div",{className:"flex justify-center gap-2",children:ee.map(n=>e.jsx("button",{type:"button",onClick:()=>M(Qe(n.value)),className:fe("px-5 py-2.5 rounded-full text-sm font-semibold transition-all active:scale-95",N===n.value?"bg-primary text-primary-foreground shadow-md":"bg-muted/50 text-muted-foreground hover:bg-muted"),children:n.label},n.value))}),e.jsxs("div",{className:"relative",children:[e.jsx(Yn,{className:"absolute left-4 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground pointer-events-none"}),e.jsx(jt,{placeholder:"Rechercher une séance...",className:"h-12 rounded-2xl bg-muted/30 pl-11 pr-4 border-0 shadow-sm focus-visible:ring-2",value:pe,onChange:n=>C(n.target.value),"aria-label":"Rechercher une séance"})]}),X&&e.jsxs("div",{className:"relative overflow-hidden rounded-2xl bg-gradient-to-br from-primary/10 via-primary/5 to-transparent border-2 border-primary/30 p-5",children:[e.jsx("div",{className:"absolute top-0 right-0 w-24 h-24 bg-primary/10 rounded-full blur-2xl -mr-8 -mt-8"}),e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsxs("span",{className:"relative flex h-3 w-3",children:[e.jsx("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-primary opacity-75"}),e.jsx("span",{className:"relative inline-flex rounded-full h-3 w-3 bg-primary"})]}),e.jsx("span",{className:"text-xs font-bold uppercase tracking-wider text-primary",children:h?"Complétée":"En cours"})]}),e.jsx("h3",{className:"text-xl font-bold tracking-tight mb-1",children:ce?.title??"Séance en cours"}),e.jsxs("p",{className:"text-sm text-muted-foreground mb-4",children:["Démarrée le ",xt(new Date(X.started_at||new Date),"dd MMMM",{locale:ht})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex justify-between text-xs font-semibold mb-1.5",children:[e.jsx("span",{className:"text-muted-foreground",children:"Progression"}),e.jsxs("span",{className:"text-primary",children:[Math.round(X.progress_pct??0),"%"]})]}),e.jsx("div",{className:"h-2 rounded-full bg-muted overflow-hidden",children:e.jsx("div",{className:"h-full rounded-full bg-primary transition-all duration-500",style:{width:`${X.progress_pct??0}%`}})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(F,{className:"flex-1 h-12 rounded-xl font-semibold",disabled:!nt,onClick:()=>{if(!ce)return;const n=ce.items??[],c=Qe(ce.cycle??n.find(S=>S.cycle_type)?.cycle_type),I=n.filter(S=>S.cycle_type===c),u=yn(I.length?I:n);j(ce),E({...ce,title:ce.title,description:ce.description,cycle:c,items:u}),H(X.id),D(X.logs??[]),b(vn(u,X.logs??[],X.progress_pct)),O("focus")},children:h?"Voir le résumé":"Reprendre"}),!h&&e.jsx(F,{variant:"outline",className:"h-12 w-12 rounded-xl p-0",disabled:Ze.isPending,onClick:()=>{!X||!window.confirm("Supprimer la séance en cours ?")||Ze.mutate(X.id)},"aria-label":"Supprimer la séance",children:e.jsx(yt,{className:"h-5 w-5"})})]})]})]}),!X&&Me.length>0&&e.jsxs("div",{className:"flex items-center gap-2 pt-2",children:[e.jsx(Ye,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-xs font-semibold uppercase tracking-wider text-muted-foreground",children:"Choisir une séance"})]}),Me.length>0?e.jsx("div",{className:"space-y-3",children:Me.map(n=>e.jsx("button",{type:"button",className:"group w-full rounded-2xl border bg-card p-4 text-left shadow-sm transition-all active:scale-[0.98] hover:shadow-md hover:border-primary/30",onClick:()=>{if(n.type==="assignment"){_e(n.assignment);return}Ae(n.session)},children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:fe("flex h-12 w-12 shrink-0 items-center justify-center rounded-xl",n.type==="assignment"?"bg-primary/10 text-primary":"bg-muted text-muted-foreground"),children:e.jsx(Ye,{className:"h-5 w-5"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-0.5",children:[n.type==="assignment"&&e.jsx("span",{className:"inline-flex items-center rounded-full bg-primary/10 px-2 py-0.5 text-[10px] font-bold uppercase text-primary",children:"Assignée"}),n.type==="assignment"&&n.assignedDate&&e.jsx("span",{className:"text-xs text-muted-foreground",children:xt(new Date(n.assignedDate),"dd MMM",{locale:ht})})]}),e.jsx("h3",{className:"font-semibold tracking-tight truncate",children:n.title}),e.jsxs("p",{className:"text-sm text-muted-foreground truncate",children:[n.exerciseCount," exercice",n.exerciseCount>1?"s":"",n.description?` · ${n.description}`:""]})]}),e.jsx("div",{className:"flex h-10 w-10 shrink-0 items-center justify-center rounded-full bg-muted/50 text-muted-foreground transition-colors group-hover:bg-primary group-hover:text-primary-foreground",children:e.jsx(Lt,{className:"h-4 w-4 ml-0.5"})})]})},n.key))}):e.jsxs("div",{className:"py-12 text-center",children:[e.jsx("div",{className:"mx-auto mb-4 flex h-16 w-16 items-center justify-center rounded-full bg-muted",children:e.jsx(Ye,{className:"h-7 w-7 text-muted-foreground"})}),e.jsx("h3",{className:"font-semibold",children:"Aucune séance"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Essayez un autre mot-clé ou changez de cycle."})]})]}),A==="settings"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[e.jsxs(F,{variant:"ghost",size:"sm",onClick:()=>O("list"),className:"gap-2",children:[e.jsx(Ht,{className:"h-4 w-4"}),"Retour"]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.3em] text-muted-foreground",children:"Préférences"}),e.jsx("h2",{className:"text-2xl font-display font-bold uppercase text-primary",children:"Paramètres"})]})]}),e.jsxs(Xe,{className:"border border-muted/60 shadow-sm",children:[e.jsxs(Et,{children:[e.jsx(kt,{className:"text-lg uppercase",children:"Lisibilité & contrastes"}),e.jsx(Qt,{children:"Ajuste l'écran pour rester lisible en bassin comme en extérieur."})]}),e.jsxs(Dt,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-4 rounded-lg border bg-muted/30 p-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm font-semibold uppercase",children:"Mode piscine"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Contraste renforcé et lisibilité optimisée."})]}),e.jsx(Tt,{checked:Fe,onCheckedChange:n=>ie(c=>({...c,poolMode:n}))})]}),e.jsxs("div",{className:"flex items-center justify-between gap-4 rounded-lg border bg-muted/30 p-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm font-semibold uppercase",children:"Texte grand"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Police plus large pour lire pendant l'effort."})]}),e.jsx(Tt,{checked:ke,onCheckedChange:n=>ie(c=>({...c,largeText:n}))})]})]})]}),e.jsx(Xe,{className:"border border-muted/60 shadow-sm",children:e.jsxs(Dt,{className:"space-y-3 pt-6",children:[e.jsxs("div",{className:"flex items-center gap-3 text-sm text-muted-foreground",children:[e.jsx(Qn,{className:"h-4 w-4"}),e.jsx("span",{children:"Les préférences sont enregistrées sur cet appareil."})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 text-xs font-semibold uppercase text-muted-foreground",children:[Fe&&e.jsx(ut,{variant:"secondary",children:"Mode piscine activé"}),ke&&e.jsx(ut,{variant:"secondary",children:"Texte grand activé"}),!Fe&&!ke&&e.jsx(ut,{variant:"outline",children:"Réglages par défaut"})]})]})})]}),A==="reader"&&m&&e.jsxs("div",{className:"space-y-5 animate-in fade-in motion-reduce:animate-none pb-40",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{type:"button",onClick:()=>O("list"),className:"flex h-10 w-10 items-center justify-center rounded-full bg-muted/50 text-muted-foreground transition-colors hover:bg-muted active:scale-95","aria-label":"Retour",children:e.jsx(Ht,{className:"h-5 w-5"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-xs font-semibold uppercase tracking-wider text-muted-foreground truncate",children:ee.find(n=>n.value===N)?.label}),e.jsx("h1",{className:"text-xl font-bold tracking-tight truncate",children:m.title})]})]}),e.jsxs("div",{className:"relative overflow-hidden rounded-2xl bg-gradient-to-br from-primary/10 via-primary/5 to-transparent border border-primary/20 p-5",children:[e.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-primary/10 rounded-full blur-3xl -mr-12 -mt-12"}),e.jsxs("div",{className:"relative space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[v&&e.jsxs("span",{className:"inline-flex items-center gap-1.5 rounded-full bg-primary/20 px-3 py-1 text-xs font-bold uppercase text-primary",children:[e.jsx("span",{className:"h-1.5 w-1.5 rounded-full bg-primary"}),"Assignée"]}),!v&&e.jsx("span",{className:"inline-flex items-center rounded-full bg-muted px-3 py-1 text-xs font-semibold text-muted-foreground",children:"Catalogue"}),v?.assigned_date&&e.jsxs("span",{className:"text-xs text-muted-foreground",children:["Prévue le ",xt(new Date(v.assigned_date),"dd MMM",{locale:ht})]})]}),m.description&&e.jsx("p",{className:"text-sm text-muted-foreground leading-relaxed",children:m.description}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex h-9 w-9 items-center justify-center rounded-xl bg-background/80",children:e.jsx(Ye,{className:"h-4 w-4 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-bold leading-none",children:xe.length}),e.jsx("p",{className:"text-[10px] uppercase text-muted-foreground font-semibold",children:"Exercices"})]})]}),e.jsx("div",{className:"h-8 w-px bg-border"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex h-9 w-9 items-center justify-center rounded-xl bg-background/80",children:e.jsx(Gn,{className:"h-4 w-4 text-muted-foreground"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-bold leading-none",children:ee.find(n=>n.value===N)?.label}),e.jsx("p",{className:"text-[10px] uppercase text-muted-foreground font-semibold",children:"Cycle"})]})]})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between gap-2 pt-1",children:[e.jsxs("span",{className:"text-xs font-semibold uppercase tracking-wider text-muted-foreground",children:[xe.length," exercice",xe.length>1?"s":""]}),e.jsx("div",{className:"flex-1 h-px bg-border"})]}),e.jsxs("div",{className:"space-y-2",children:[xe.map((n,c)=>{const I=be.get(n.exercise_id),u=Number(n.percent_1rm),S=Number.isFinite(u)&&u>0,k=S?ge?.find(Ce=>Ce.exercise_id===n.exercise_id)?.weight??0:0,T=S?Math.round(k*(u/100)):0,U=S?T>0?`${T} kg (${u}% 1RM)`:`${u}% 1RM`:null,re=n.notes?.trim(),Z=Wt(n.sets),me=Wt(n.reps),ae=Hr(n.rest_seconds);return e.jsxs(Yt,{children:[e.jsx(Mn,{asChild:!0,children:e.jsxs("button",{type:"button",className:"w-full flex items-center gap-3 rounded-xl border bg-card px-3 py-3 text-left transition-all active:scale-[0.98] hover:border-primary/50 hover:shadow-sm",children:[e.jsx("div",{className:"flex h-7 w-7 shrink-0 items-center justify-center rounded-full bg-primary text-xs font-bold text-primary-foreground",children:c+1}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsx("p",{className:"font-semibold text-sm truncate",children:I?.nom_exercice??n.exercise_name??"Exercice"})}),e.jsxs("div",{className:"flex items-center gap-2 shrink-0 text-xs font-medium text-muted-foreground",children:[e.jsxs("span",{className:"font-mono",children:[Z,"×",me]}),e.jsx("span",{className:"text-border",children:"|"}),e.jsx("span",{className:"font-mono",children:ae}),e.jsx(Mt,{className:"h-4 w-4 text-muted-foreground/50"})]})]})}),e.jsxs(Xt,{side:"bottom",className:"max-h-[90vh] overflow-y-auto rounded-t-3xl pb-8",children:[e.jsx(Gt,{className:"text-left pb-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex h-10 w-10 shrink-0 items-center justify-center rounded-full bg-primary text-sm font-bold text-primary-foreground",children:c+1}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx(Jt,{className:"text-xl leading-tight",children:I?.nom_exercice??n.exercise_name??"Exercice"}),I?.exercise_type&&e.jsx("p",{className:"text-sm text-muted-foreground mt-0.5",children:I.exercise_type})]})]})}),e.jsxs("div",{className:"space-y-4",children:[I?.illustration_gif&&e.jsx("div",{className:"rounded-xl overflow-hidden bg-muted/20 border aspect-video flex items-center justify-center",children:e.jsx("img",{src:I.illustration_gif,alt:I.nom_exercice??"Exercice",className:"w-full h-full max-h-36 object-contain",loading:"lazy",decoding:"async"})}),I?.description&&e.jsx("div",{className:"text-sm text-muted-foreground leading-relaxed",children:I.description}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:"rounded-xl bg-muted/40 p-3 text-center",children:[e.jsx("p",{className:"text-2xl font-bold leading-none",children:Z}),e.jsx("p",{className:"text-[10px] uppercase text-muted-foreground font-semibold mt-1",children:"Séries"})]}),e.jsxs("div",{className:"rounded-xl bg-muted/40 p-3 text-center",children:[e.jsx("p",{className:"text-2xl font-bold leading-none",children:me}),e.jsx("p",{className:"text-[10px] uppercase text-muted-foreground font-semibold mt-1",children:"Reps"})]}),e.jsxs("div",{className:"rounded-xl bg-muted/40 p-3 text-center",children:[e.jsx("p",{className:"text-lg font-bold leading-none",children:U??"—"}),e.jsx("p",{className:"text-[10px] uppercase text-muted-foreground font-semibold mt-1",children:"Charge"})]}),e.jsxs("div",{className:"rounded-xl bg-muted/40 p-3 text-center",children:[e.jsx("p",{className:"text-lg font-bold leading-none",children:ae}),e.jsx("p",{className:"text-[10px] uppercase text-muted-foreground font-semibold mt-1",children:"Repos"})]})]}),re&&e.jsxs("div",{className:"rounded-xl bg-primary/5 border border-primary/20 p-4",children:[e.jsx("div",{className:"text-[10px] uppercase text-primary font-semibold mb-1",children:"Notes coach"}),e.jsx("div",{className:"text-sm text-foreground",children:re})]})]})]})]},`${n.exercise_id}-${c}`)}),xe.length===0&&e.jsx("div",{className:"p-6 border-2 border-dashed rounded-xl text-center text-muted-foreground",children:"Aucun exercice disponible pour cette séance."})]}),e.jsx(gn,{children:e.jsxs(F,{className:"flex-1 h-14 rounded-xl font-bold text-base bg-primary hover:bg-primary/90 shadow-lg",onClick:ze,children:[e.jsx(Lt,{className:"h-5 w-5 mr-2"}),"Lancer la séance"]})})]})]}),e.jsxs(Pt,{value:"history",className:"space-y-4 pt-4",children:[e.jsxs("div",{className:"grid gap-3 md:grid-cols-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(et,{htmlFor:"strength-history-status",children:"Statut"}),e.jsxs(An,{value:W,onValueChange:B,children:[e.jsx(In,{id:"strength-history-status",children:e.jsx(On,{placeholder:"Tous"})}),e.jsxs($n,{children:[e.jsx(pt,{value:"all",children:"Tous"}),e.jsx(pt,{value:"in_progress",children:"En cours"}),e.jsx(pt,{value:"completed",children:"Terminé"}),e.jsx(pt,{value:"abandoned",children:"Abandonné"})]})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(et,{htmlFor:"strength-history-from",children:"Du"}),e.jsx(jt,{id:"strength-history-from",type:"date",value:J,onChange:n=>g(n.target.value)})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(et,{htmlFor:"strength-history-to",children:"Au"}),e.jsx(jt,{id:"strength-history-to",type:"date",value:V,onChange:n=>K(n.target.value)})]})]}),ve.map(n=>e.jsx(Xe,{className:"group hover:border-primary/50 transition-colors",children:e.jsxs(Et,{className:"pb-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx(kt,{className:"text-base font-bold uppercase",children:xt(new Date(n.started_at||n.date||n.created_at||new Date),"dd MMM yyyy",{locale:ht})}),e.jsxs("div",{className:"text-sm font-mono font-bold text-muted-foreground group-hover:text-primary",children:[n.duration??0," min"]})]}),e.jsxs("div",{className:"flex gap-2 text-xs font-bold text-muted-foreground",children:[e.jsxs("span",{children:["Difficulté ",n.feeling??n.rpe??0,"/5"]}),e.jsx("span",{children:"•"}),e.jsxs("span",{children:[n.logs?.length||0," Séries"]})]})]})},n.id)),ve.length===0&&e.jsx("div",{className:"text-center text-muted-foreground py-10",children:"Aucun historique."}),je.hasNextPage&&e.jsx(F,{variant:"outline",size:"sm",className:"w-full",onClick:()=>je.fetchNextPage(),disabled:je.isFetchingNextPage,children:je.isFetchingNextPage?"Chargement...":"Charger plus"})]})]})]})})}export{Rt as buildInProgressRunCache,qr as createInProgressRun,cs as default,yn as orderStrengthItems,Br as resetStrengthRunState};
