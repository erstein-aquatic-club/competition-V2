import{u as H,M as L,r as l,k as u,al as G,Q as f,j as e,B as N,C as F,g as A,h as I,a0 as E,i as T,_ as m,S as R,b as w,d as B,e as M,f as k}from"./index-ctSa7tft.js";import{S as O}from"./switch-BwZaOBHI.js";import{B as D}from"./badge-DLZmQGUg.js";import{T as K,a as Q,b as $,c as d,d as X,e as c}from"./table-Di8K8j1M.js";const P=[{value:"M",label:"Garçon"},{value:"F",label:"Fille"}],q=x=>x==="user"?"Compte":"Ancien";function ee(){const x=H(s=>s.role),{toast:i}=L(),[t,o]=l.useState({display_name:"",iuf:"",sex:"",birthdate:""}),[h,S]=l.useState([]),[v,y]=l.useState(!1),[p,_]=l.useState(null),g=x==="coach"||x==="admin",n=l.useCallback(async()=>{if(g){y(!0),_(null);try{const s=await u.getClubRecordSwimmers();S(s)}catch(s){const a=G(s,"Impossible de charger la liste.");_(a.message),S([])}finally{y(!1)}}},[g]);l.useEffect(()=>{n()},[n]);const C=f({mutationFn:()=>u.createClubRecordSwimmer({display_name:t.display_name.trim(),iuf:t.iuf.trim()||null,sex:t.sex?t.sex:null,birthdate:t.birthdate||null,is_active:!0}),onSuccess:()=>{i({title:"Nageur ajouté"}),o({display_name:"",iuf:"",sex:"",birthdate:""}),n()},onError:()=>{i({title:"Impossible d'ajouter le nageur",variant:"destructive"})}}),U=f({mutationFn:({id:s,payload:a})=>u.updateClubRecordSwimmer(s,a),onSuccess:()=>{n()},onError:()=>{i({title:"Mise à jour impossible",variant:"destructive"})}}),V=f({mutationFn:({userId:s,payload:a})=>u.updateClubRecordSwimmerForUser(s,a),onSuccess:()=>{n()},onError:()=>{i({title:"Mise à jour impossible",variant:"destructive"})}}),j=(s,a)=>{if(s.source_type==="user"&&s.user_id){V.mutate({userId:s.user_id,payload:a});return}s.id&&U.mutate({id:s.id,payload:a})},b=f({mutationFn:()=>u.importClubRecords(),onSuccess:s=>{i({title:"Import terminé",description:s?`Performances importées: ${s.imported??0}. Erreurs: ${s.errors?.length??0}.`:""}),n()},onError:()=>{i({title:"Import impossible",variant:"destructive"})}}),z=l.useMemo(()=>[...h].sort((s,a)=>s.source_type!==a.source_type?s.source_type.localeCompare(a.source_type):s.display_name.localeCompare(a.display_name)),[h]);return g?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-display font-bold uppercase italic text-primary",children:"Administration des records"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Gérez les nageurs pris en compte pour les records et lancez l'import FFN."})]}),e.jsx(N,{onClick:()=>b.mutate(),disabled:b.isPending,children:b.isPending?"Import en cours...":"Mettre à jour les records"})]}),e.jsxs(F,{children:[e.jsxs(A,{children:[e.jsx(I,{children:"Ajouter un ancien nageur"}),e.jsx(E,{children:"Ajoutez un nageur sans compte pour l'import des performances FFN."})]}),e.jsxs(T,{className:"grid gap-4 md:grid-cols-[2fr_1fr_1fr_1fr_auto]",children:[e.jsx(m,{placeholder:"Nom du nageur",value:t.display_name,onChange:s=>o(a=>({...a,display_name:s.target.value}))}),e.jsx(m,{placeholder:"IUF",value:t.iuf,onChange:s=>o(a=>({...a,iuf:s.target.value}))}),e.jsxs(R,{value:t.sex,onValueChange:s=>o(a=>({...a,sex:s})),children:[e.jsx(w,{children:e.jsx(B,{placeholder:"Sexe"})}),e.jsx(M,{children:P.map(s=>e.jsx(k,{value:s.value,children:s.label},s.value))})]}),e.jsx(m,{type:"date",value:t.birthdate,onChange:s=>o(a=>({...a,birthdate:s.target.value}))}),e.jsx(N,{onClick:()=>C.mutate(),disabled:!t.display_name.trim()||C.isPending,children:"Ajouter"})]})]}),e.jsxs(F,{children:[e.jsxs(A,{children:[e.jsx(I,{children:"Liste des nageurs suivis"}),e.jsx(E,{children:"Mettre à jour l'IUF, le sexe ou l'activation pour l'import FFN."})]}),e.jsxs(T,{children:[v&&e.jsx("div",{className:"space-y-3",children:[1,2,3,4].map(s=>e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"h-4 w-32 rounded bg-muted animate-pulse"}),e.jsx("div",{className:"h-4 w-20 rounded bg-muted animate-pulse"}),e.jsx("div",{className:"h-4 w-16 rounded bg-muted animate-pulse"}),e.jsx("div",{className:"h-4 w-24 rounded bg-muted animate-pulse"})]},s))}),p&&e.jsx("p",{className:"text-sm text-destructive",children:p}),!v&&!p&&h.length===0&&e.jsx("p",{className:"text-sm text-muted-foreground",children:"Aucun nageur disponible."}),!v&&!p&&h.length>0&&e.jsxs(K,{children:[e.jsx(Q,{children:e.jsxs($,{children:[e.jsx(d,{children:"Nageur"}),e.jsx(d,{children:"Source"}),e.jsx(d,{children:"IUF"}),e.jsx(d,{children:"Sexe"}),e.jsx(d,{children:"Naissance"}),e.jsx(d,{children:"Actif"})]})}),e.jsx(X,{children:z.map(s=>{const a=s.id??`user-${s.user_id??"unknown"}`;return e.jsxs($,{children:[e.jsx(c,{className:"font-medium",children:s.display_name}),e.jsx(c,{children:e.jsx(D,{variant:s.source_type==="manual"?"secondary":"outline",children:q(s.source_type)})}),e.jsx(c,{children:e.jsx(m,{defaultValue:s.iuf??"",onBlur:r=>j(s,{iuf:r.target.value.trim()||null})},`${a}-${s.iuf??""}`)}),e.jsx(c,{children:e.jsxs(R,{value:s.sex??"",onValueChange:r=>j(s,{sex:r||null}),children:[e.jsx(w,{children:e.jsx(B,{placeholder:"Sexe"})}),e.jsx(M,{children:P.map(r=>e.jsx(k,{value:r.value,children:r.label},r.value))})]})}),e.jsx(c,{children:e.jsx(m,{type:"date",defaultValue:s.birthdate??"",onBlur:r=>j(s,{birthdate:r.target.value||null})},`${a}-${s.birthdate??""}`)}),e.jsx(c,{children:e.jsx(O,{checked:!!s.is_active,onCheckedChange:r=>j(s,{is_active:r})})})]},a)})})]})]})]})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("h1",{className:"text-3xl font-display font-bold uppercase italic text-primary",children:"Administration des records"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Accès réservé aux coachs."})]})}export{ee as default};
