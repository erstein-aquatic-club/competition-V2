import{r as l,u as O,j as e,c as be,d as R,f as ys}from"./vendor-query-DyA9aSKS.js";import{c as as,B as A,P as oe,d as ve,L as $,I as Z,s as rs,X as bs,G as vs,T as Ns,u as is,g as _s,t as Cs,Z as ws,b as Ss}from"./index-DA5GZgf4.js";import{a as h}from"./api-BCcY6pA7.js";import{T as ks,a as Ts,b as Se,c as ke}from"./tabs-Cpn8hBuJ.js";import{B as U}from"./badge-bqTojPPT.js";import{C as We,w as ls,a as cs,M as Re,S as Je,G as os,b as Es}from"./SwimmerFeedbackTab-D4btQdIG.js";import{T as Ue}from"./textarea-D-GTCPJD.js";import{S as ue,a as me,b as xe,c as pe,d as X}from"./select-CnYpk-25.js";import{T as Ds,a as Ke}from"./toggle-group-DCA4LWYJ.js";import{S as Fe,a as Ae,b as Pe,c as Me,d as Ye}from"./sheet-DR9vH5X8.js";import{A as se,a as te,b as ne,c as ae,d as re,e as ie,f as le,g as ce}from"./alert-dialog-DN4pjrdQ.js";import{T as Ce,s as ds,a as us,c as ms,d as qs,S as xs,e as Ve,f as we,b as Fs,F as As,p as Xe}from"./objectiveHelpers-DYH4OYqU.js";import{T as Le}from"./trash-2-BjH2BhKw.js";import{t as ze}from"./date-DrpgLmFD.js";import{C as Ps}from"./copy-CAAEDhBx.js";import{C as Ms}from"./index-BLRVfVG-.js";import{P as Os}from"./pencil-CUYfEQG1.js";import{C as Ls,a as Ks,b as $s}from"./collapsible-D2sP7pYr.js";import{S as Ws,b as Rs,c as zs}from"./smsUtils-7ThR1XIU.js";import{C as Bs}from"./chevron-up-ZDeL66J0.js";import{C as Qs}from"./chevron-down-CTrnTHGN.js";import{C as Oe}from"./clock-BoXoxktI.js";import{C as Us}from"./chevron-right-bZb46x4_.js";import{M as Vs}from"./map-pin-ItyQeLRn.js";import{A as Is}from"./arrow-left-BbwSBpZI.js";import"./vendor-react-BzrpNAyj.js";import"./vendor-charts-BrQ8X25f.js";import"./vendor-supabase-DFPLkPj_.js";import"./vendor-motion-CMsaQ8FX.js";import"./swim-_c6SQ4vB.js";import"./index-BZdqcolq.js";import"./index-C3918TWi.js";import"./chart-column-BIFCQqAE.js";import"./index-DCX2sNhR.js";import"./index-BPfI1gVE.js";import"./vendor-date-B8Mnp-Vt.js";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gs=[["path",{d:"M16 14v2.2l1.6 1",key:"fo4ql5"}],["path",{d:"M16 2v4",key:"4m81vk"}],["path",{d:"M21 7.5V6a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h3.5",key:"1osxxc"}],["path",{d:"M3 10h5",key:"r794hk"}],["path",{d:"M8 2v4",key:"1cmpym"}],["circle",{cx:"16",cy:"16",r:"6",key:"qoo3c4"}]],Hs=as("calendar-clock",Gs);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Js=[["path",{d:"M9 17H7A5 5 0 0 1 7 7h2",key:"8i5ue5"}],["path",{d:"M15 7h2a5 5 0 1 1 0 10h-2",key:"1b9ql8"}],["line",{x1:"8",x2:"16",y1:"12",y2:"12",key:"1jonct"}]],Ys=as("link-2",Js);async function Xs(s){const{data:t,error:n}=await rs.rpc("get_auth_uid_for_user",{p_user_id:s});return n?(console.error("[objectives-tab] Failed to resolve auth UUID:",n.message),null):t}const Zs=({open:s,onOpenChange:t,objective:n,athleteName:r,athleteAuthId:o,competitions:c})=>{const{toast:a}=ve(),u=be(),v=!!n,[p,x]=l.useState("chrono"),[g,y]=l.useState(""),[C,f]=l.useState("25"),[P,F]=l.useState(""),[E,D]=l.useState(""),[_,B]=l.useState(""),[K,Q]=l.useState(!1);l.useEffect(()=>{if(s)if(n){const d=!!n.event_code,z=!!n.text;x(d&&z?"both":z?"texte":"chrono"),y(n.event_code??""),f(String(n.pool_length??25)),F(n.target_time_seconds!=null?we(n.target_time_seconds):""),D(n.text??""),B(n.competition_id??"")}else x("chrono"),y(""),f("25"),F(""),D(""),B("")},[s,n]);const m=R({mutationFn:d=>h.createObjective(d),onSuccess:()=>{a({title:"Objectif crÃ©Ã©"}),u.invalidateQueries({queryKey:["objectives",o]}),t(!1)},onError:d=>{a({title:"Erreur",description:d.message,variant:"destructive"})}}),N=R({mutationFn:d=>h.updateObjective(n.id,d),onSuccess:()=>{a({title:"Objectif mis Ã  jour"}),u.invalidateQueries({queryKey:["objectives",o]}),t(!1)},onError:d=>{a({title:"Erreur",description:d.message,variant:"destructive"})}}),b=R({mutationFn:()=>h.deleteObjective(n.id),onSuccess:()=>{a({title:"Objectif supprimÃ©"}),u.invalidateQueries({queryKey:["objectives",o]}),t(!1)},onError:d=>{a({title:"Erreur",description:d.message,variant:"destructive"})}}),L=p==="chrono"||p==="both",j=p==="texte"||p==="both",w=()=>{if(L&&!g){a({title:"Ã‰preuve requise",description:"Veuillez sÃ©lectionner une Ã©preuve.",variant:"destructive"});return}if(L&&P&&Xe(P)===null){a({title:"Format invalide",description:"Le temps doit Ãªtre au format m:ss:cc (ex: 1:05:30)",variant:"destructive"});return}if(j&&!E.trim()){a({title:"Texte requis",description:"Veuillez saisir un objectif texte.",variant:"destructive"});return}const d={athlete_id:o,competition_id:_&&_!=="none"?_:null,event_code:L?g:null,pool_length:L?Number(C):null,target_time_seconds:L&&P?Xe(P):null,text:j?E.trim():null};v?N.mutate(d):m.mutate(d)},T=m.isPending||N.isPending||b.isPending,S=l.useMemo(()=>{const d=new Date;return d.setHours(0,0,0,0),c.filter(z=>new Date(z.date+"T00:00:00").getTime()>=d.getTime())},[c]);return e.jsxs(e.Fragment,{children:[e.jsx(Fe,{open:s,onOpenChange:t,children:e.jsxs(Ae,{side:"right",className:"w-full sm:max-w-md overflow-y-auto",children:[e.jsx(Pe,{children:e.jsx(Me,{children:v?"Modifier l'objectif":"Nouvel objectif"})}),e.jsxs("div",{className:"mt-6 space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx($,{children:"Nageur"}),e.jsx("p",{className:"text-sm font-medium",children:r})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx($,{children:"Type d'objectif"}),e.jsxs(Ds,{type:"single",variant:"outline",value:p,onValueChange:d=>{d&&x(d)},className:"justify-start",children:[e.jsx(Ke,{value:"chrono",className:"text-xs",children:"Chrono"}),e.jsx(Ke,{value:"texte",className:"text-xs",children:"Texte"}),e.jsx(Ke,{value:"both",className:"text-xs",children:"Les deux"})]})]}),L&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx($,{children:"Ã‰preuve *"}),e.jsxs(ue,{value:g,onValueChange:y,children:[e.jsx(me,{children:e.jsx(xe,{placeholder:"Choisir une Ã©preuve"})}),e.jsx(pe,{children:As.map(d=>e.jsx(X,{value:d,children:Ve(d)},d))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx($,{children:"Bassin"}),e.jsxs(ue,{value:C,onValueChange:f,children:[e.jsx(me,{children:e.jsx(xe,{})}),e.jsxs(pe,{children:[e.jsx(X,{value:"25",children:"25m"}),e.jsx(X,{value:"50",children:"50m"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx($,{children:"Temps cible (min:sec:centiÃ¨mes)"}),e.jsx(Z,{placeholder:"Ex : 1:05:30",value:P,onChange:d=>F(d.target.value)})]})]}),j&&e.jsxs("div",{className:"space-y-2",children:[e.jsx($,{children:"Objectif texte *"}),e.jsx(Ue,{placeholder:"Ex : AmÃ©liorer la coulÃ©e de dos",value:E,onChange:d=>D(d.target.value),rows:3})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx($,{children:"Lier Ã  une compÃ©tition"}),e.jsxs(ue,{value:_,onValueChange:B,children:[e.jsx(me,{children:e.jsx(xe,{placeholder:"Aucune"})}),e.jsxs(pe,{children:[e.jsx(X,{value:"none",children:"Aucune"}),S.map(d=>e.jsxs(X,{value:d.id,children:[d.name," (",d.date,")"]},d.id))]})]})]}),e.jsxs("div",{className:"space-y-2 pt-2",children:[e.jsx(A,{className:"w-full",onClick:w,disabled:T,children:T?"Enregistrement...":v?"Enregistrer":"CrÃ©er"}),v&&e.jsx(A,{variant:"outline",className:"w-full text-destructive hover:text-destructive",onClick:()=>Q(!0),disabled:T,children:"Supprimer cet objectif"})]})]})]})}),e.jsx(se,{open:K,onOpenChange:Q,children:e.jsxs(te,{children:[e.jsxs(ne,{children:[e.jsx(ae,{children:"Supprimer l'objectif"}),e.jsx(re,{children:"Cette action est irrÃ©versible. L'objectif sera supprimÃ© dÃ©finitivement."})]}),e.jsxs(ie,{children:[e.jsx(le,{children:"Annuler"}),e.jsx(ce,{onClick:()=>{b.mutate(),Q(!1)},className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Supprimer"})]})]})})]})};function et(s){const t=s.split("-");return t.length===3?`${t[2]}/${t[1]}/${t[0]}`:s}const st=({objective:s,performances:t,onEdit:n})=>{const r=s.event_code?ds(s.event_code):null,o=r?xs[r]??"":"",c=s.event_code?us(t,s.event_code,s.pool_length):null;let a=null,u=null;c&&s.target_time_seconds!=null&&s.event_code&&(a=c.time-s.target_time_seconds,u=ms(c.time,s.target_time_seconds,s.event_code));const v=!!s.competition_name,p=s.competition_date?qs(s.competition_date):null;return e.jsxs("button",{type:"button",className:`w-full text-left rounded-lg border bg-card p-3 text-sm space-y-1.5 transition-colors hover:bg-muted/50 ${o?`border-l-4 ${o}`:""}`,onClick:()=>n(s),children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx(Ce,{className:"h-3.5 w-3.5 text-muted-foreground shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0 flex items-center gap-1.5 flex-wrap",children:[s.event_code&&e.jsx("span",{className:"font-medium",children:Ve(s.event_code)}),s.event_code&&s.pool_length&&e.jsxs("span",{className:"text-muted-foreground",children:["(",s.pool_length,"m)"]}),s.target_time_seconds!=null&&e.jsx("span",{className:"font-mono text-xs text-primary",children:we(s.target_time_seconds)})]}),e.jsx(Le,{className:"h-3.5 w-3.5 text-muted-foreground/40 shrink-0"})]}),s.text&&e.jsx("p",{className:"text-muted-foreground text-xs pl-5 line-clamp-2",children:s.text}),s.event_code&&c&&e.jsxs("div",{className:"flex items-center gap-2 pl-5 text-xs text-muted-foreground flex-wrap",children:[e.jsxs("span",{children:["Actuel : ",e.jsx("span",{className:"font-mono",children:we(c.time)})]}),c.date&&e.jsxs("span",{className:"text-muted-foreground/60",children:["(",et(c.date),")"]}),a!=null&&e.jsx("span",{className:a<=0?"text-emerald-600 font-medium":"text-amber-600",children:a<=0?"Objectif atteint !":`+${a.toFixed(2)}s`})]}),s.event_code&&!c&&e.jsx("p",{className:"text-[10px] text-muted-foreground italic pl-5",children:"Pas encore de temps enregistrÃ©"}),u!=null&&e.jsx("div",{className:"pl-5 pr-1",children:e.jsx("div",{className:"h-1.5 w-full rounded-full bg-muted overflow-hidden",children:e.jsx("div",{className:`h-full rounded-full transition-all duration-500 ${Fs(u)}`,style:{width:`${Math.min(u,100)}%`}})})}),v&&e.jsx("div",{className:"pl-5",children:e.jsxs(U,{variant:"outline",className:"border-orange-300 text-orange-600 dark:text-orange-400 text-[10px] px-1.5 py-0",children:[s.competition_name,p!=null&&p>0&&e.jsxs("span",{className:"ml-1 font-bold",children:["J-",p]})]})})]})},tt=({athleteId:s,athleteName:t})=>{const[n,r]=l.useState(!1),[o,c]=l.useState(null),{data:a,isLoading:u}=O({queryKey:["auth-uid",s],queryFn:()=>Xs(s),enabled:!!s}),{data:v=[]}=O({queryKey:["competitions"],queryFn:()=>h.getCompetitions()}),{data:p=[],isLoading:x}=O({queryKey:["objectives",a],queryFn:()=>h.getObjectives(a),enabled:!!a}),{data:g}=O({queryKey:["profile",s],queryFn:()=>h.getProfile({userId:s}),enabled:!!s}),y=g?.ffn_iuf??null,C=l.useMemo(()=>{const _=new Date;return _.setDate(_.getDate()-360),_.toISOString().slice(0,10)},[]),{data:f=[]}=O({queryKey:["swimmer-performances-recent",y],queryFn:()=>h.getSwimmerPerformances({iuf:y,fromDate:C}),enabled:!!y}),P=()=>{c(null),r(!0)},F=_=>{c(_),r(!0)},E=u,D=!!a&&!u;return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex justify-end",children:e.jsxs(A,{variant:"outline",size:"sm",onClick:P,disabled:!a,children:[e.jsx(oe,{className:"mr-1.5 h-3.5 w-3.5"}),"Ajouter un objectif"]})}),E&&e.jsx("div",{className:"space-y-2",children:[1,2,3].map(_=>e.jsx("div",{className:"rounded-xl border p-3 animate-pulse motion-reduce:animate-none",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-4 w-40 rounded bg-muted"}),e.jsx("div",{className:"ml-auto h-5 w-12 rounded bg-muted"})]})},_))}),D&&x&&e.jsx("div",{className:"space-y-2",children:[1,2].map(_=>e.jsx("div",{className:"rounded-xl border p-3 animate-pulse motion-reduce:animate-none",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-4 w-32 rounded bg-muted"}),e.jsx("div",{className:"ml-auto h-5 w-16 rounded bg-muted"})]})},_))}),D&&!x&&p.length===0&&e.jsxs("div",{className:"text-center py-12 space-y-3",children:[e.jsx(Ce,{className:"h-10 w-10 text-muted-foreground mx-auto"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Aucun objectif dÃ©fini pour ",t,"."]}),e.jsxs(A,{variant:"outline",size:"sm",onClick:P,children:[e.jsx(oe,{className:"mr-1.5 h-3.5 w-3.5"}),"CrÃ©er le premier objectif"]})]}),D&&!x&&p.length>0&&e.jsxs("div",{className:"space-y-2",children:[p.map(_=>e.jsx(st,{objective:_,performances:f,onEdit:F},_.id)),e.jsx("p",{className:"text-[10px] text-muted-foreground/60 italic text-center pt-1",children:"Les temps Â« Actuel Â» correspondent Ã  la meilleure performance des 360 derniers jours sur l'Ã©preuve."})]}),a&&e.jsx(Zs,{open:n,onOpenChange:r,objective:o,athleteName:t,athleteAuthId:a,competitions:v})]})},Be="__today__";function Qe(s,t){const n=[],r=new Date(s+"T00:00:00"),o=new Date(t+"T00:00:00"),c=new Date(r),a=c.getDay(),u=a===0?1:a===1?0:8-a;for(c.setDate(c.getDate()+u);c<=o;)n.push(c.toISOString().split("T")[0]),c.setDate(c.getDate()+7);return n}function _e(s){return new Date(s+"T00:00:00").toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric"})}function Te(s){return new Date(s+"T00:00:00").toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit"})}function nt(s){const t=new Date(s+"T00:00:00");return t.setDate(t.getDate()+6),t.toISOString().split("T")[0]}function at(s){const t=new Date;t.setHours(0,0,0,0);const n=new Date(s+"T00:00:00"),r=new Date(s+"T00:00:00");return r.setDate(r.getDate()+6),t>=n&&t<=r}const rt=({athleteId:s})=>{const{toast:t}=ve(),n=be(),[r,o]=l.useState(null),[c,a]=l.useState(null),[u,v]=l.useState(""),[p,x]=l.useState(""),[g,y]=l.useState(!1),[C,f]=l.useState(!1),[P,F]=l.useState(!1),[E,D]=l.useState(""),[_,B]=l.useState(""),[K,Q]=l.useState(""),{data:m=[]}=O({queryKey:["athletes"],queryFn:()=>h.getAthletes()}),N=l.useMemo(()=>m.find(M=>M.id===s)?.group_id??null,[m,s]),{data:b=[],isLoading:L}=O({queryKey:["training-cycles","athlete",s],queryFn:()=>h.getTrainingCycles({athleteId:s})}),{data:j=[],isLoading:w}=O({queryKey:["training-cycles","group",N],queryFn:()=>h.getTrainingCycles({groupId:N}),enabled:N!=null}),T=b.length===0&&j.length>0,S=b.length>0?b:j;l.useEffect(()=>{S.length>0&&(!r||!S.find(i=>i.id===r))&&o(S[0].id)},[S,r]);const d=S.find(i=>i.id===r)??null,{data:z=[],isLoading:he}=O({queryKey:["training-weeks",r],queryFn:()=>h.getTrainingWeeks(r),enabled:!!r}),{data:q=[]}=O({queryKey:["competitions"],queryFn:()=>h.getCompetitions()}),W=l.useMemo(()=>[...q].sort((i,M)=>i.date.localeCompare(M.date)),[q]),V=l.useMemo(()=>{const i=new Set;return z.forEach(M=>{M.week_type&&i.add(M.week_type)}),Array.from(i).sort()},[z]),I=d?.start_competition_date??d?.start_date??null,k=l.useMemo(()=>{if(!d)return[];const i=I,M=d.end_competition_date;return!i||!M?[]:Qe(i,M)},[d,I]),de=l.useMemo(()=>{const i=new Map;return z.forEach(M=>i.set(M.week_start,M)),i},[z]),ge=L||w,je=R({mutationFn:async i=>{const M=await h.createTrainingCycle(i),G=i.start_date??q.find(J=>J.id===i.start_competition_id)?.date,H=q.find(J=>J.id===i.end_competition_id);if(G&&H){const J=Qe(G,H.date);J.length>0&&await h.bulkUpsertTrainingWeeks(J.map(Ne=>({cycle_id:M.id,week_start:Ne})))}return M},onSuccess:i=>{t({title:"Cycle cree"}),o(i.id),y(!1),D(""),B(""),Q(""),n.invalidateQueries({queryKey:["training-cycles"]}),n.invalidateQueries({queryKey:["training-weeks",i.id]})},onError:i=>{t({title:"Erreur",description:i.message,variant:"destructive"})}}),fe=R({mutationFn:i=>h.deleteTrainingCycle(i),onSuccess:()=>{t({title:"Cycle supprime"}),o(null),f(!1),n.invalidateQueries({queryKey:["training-cycles"]})},onError:i=>{t({title:"Erreur",description:i.message,variant:"destructive"})}}),Ie=R({mutationFn:i=>h.upsertTrainingWeek(i),onSuccess:()=>{a(null),n.invalidateQueries({queryKey:["training-weeks",r]})},onError:i=>{t({title:"Erreur",description:i.message,variant:"destructive"})}}),Ge=R({mutationFn:async()=>{for(const i of j){const M=await h.createTrainingCycle({athlete_id:s,group_id:null,start_competition_id:i.start_competition_id,end_competition_id:i.end_competition_id,name:i.name,notes:i.notes}),G=await h.getTrainingWeeks(i.id);G.length>0&&await h.bulkUpsertTrainingWeeks(G.map(H=>({cycle_id:M.id,week_start:H.week_start,week_type:H.week_type,notes:H.notes})))}},onSuccess:()=>{t({title:"Planification personnalisee"}),F(!1),o(null),n.invalidateQueries({queryKey:["training-cycles"]})},onError:i=>{t({title:"Erreur",description:i.message,variant:"destructive"})}}),He=()=>{if(!E.trim()){t({title:"Nom requis",variant:"destructive"});return}if(!_||!K){t({title:"Dates requises",description:"Choisis un debut et une fin.",variant:"destructive"});return}const i=_===Be,M=i?ze(new Date):null,G=i?null:q.find(Ne=>Ne.id===_),H=q.find(Ne=>Ne.id===K),J=i?M:G?.date;if(J&&H&&H.date<=J){t({title:"Dates invalides",description:"La fin doit etre apres le debut.",variant:"destructive"});return}je.mutate({athlete_id:s,group_id:null,start_competition_id:i?null:_,end_competition_id:K,start_date:M,name:E.trim()})},hs=i=>{a(i.id),v(i.week_type??""),x(i.notes??"")},gs=i=>{a(`new:${i}`),v(""),x("")},js=(i,M)=>{r&&Ie.mutate({cycle_id:r,week_start:i,week_type:u.trim()||null,notes:p.trim()||null})},fs=()=>{a(null)};return!ge&&S.length===0?e.jsxs("div",{className:"text-center py-12 space-y-3",children:[e.jsx(We,{className:"h-10 w-10 text-muted-foreground mx-auto"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Aucun cycle pour ce nageur."}),e.jsxs(A,{variant:"outline",size:"sm",onClick:()=>y(!0),children:[e.jsx(oe,{className:"mr-1.5 h-3.5 w-3.5"}),"Nouveau cycle"]}),e.jsx(Ze,{open:g,onOpenChange:y,competitions:W,name:E,setName:D,startId:_,setStartId:B,endId:K,setEndId:Q,onSubmit:He,isPending:je.isPending})]}):ge?e.jsx("div",{className:"space-y-3",children:[1,2,3].map(i=>e.jsx("div",{className:"rounded-xl border p-3 animate-pulse motion-reduce:animate-none",children:e.jsx("div",{className:"h-4 w-48 rounded bg-muted"})},i))}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[S.length>1?e.jsxs(ue,{value:r??"",onValueChange:o,children:[e.jsx(me,{className:"w-auto min-w-[180px] h-8 text-sm",children:e.jsx(xe,{placeholder:"Choisir un cycle"})}),e.jsx(pe,{children:S.map(i=>e.jsx(X,{value:i.id,children:i.name},i.id))})]}):d?e.jsx("span",{className:"text-sm font-semibold",children:d.name}):null,T&&e.jsx(U,{variant:"secondary",className:"text-[10px] px-1.5 py-0",children:"Planif. groupe"}),e.jsx("div",{className:"flex-1"}),T&&e.jsxs(A,{variant:"outline",size:"sm",className:"text-xs h-7",onClick:()=>F(!0),children:[e.jsx(Ps,{className:"mr-1 h-3 w-3"}),"Personnaliser"]}),e.jsxs(A,{variant:"outline",size:"sm",className:"text-xs h-7",onClick:()=>y(!0),children:[e.jsx(oe,{className:"mr-1 h-3 w-3"}),"Nouveau"]}),d&&!T&&e.jsx(A,{variant:"ghost",size:"sm",className:"text-xs h-7 text-destructive hover:text-destructive",onClick:()=>f(!0),children:e.jsx(Le,{className:"h-3 w-3"})})]}),d&&e.jsxs("div",{className:"space-y-0",children:[e.jsxs("div",{className:"flex items-center gap-2 py-2 px-1",children:[e.jsx("span",{className:"text-base","aria-hidden":"true",children:d.start_competition_id?"ðŸŠ":"ðŸ“…"}),e.jsx("span",{className:"text-sm font-medium",children:d.start_competition_id?d.start_competition_name??"Competition":"Debut du cycle"}),I&&e.jsxs("span",{className:"text-xs text-muted-foreground",children:["(",_e(I),")"]})]}),e.jsx("div",{className:"relative ml-3 border-l-2 border-border pl-4 space-y-1",children:he?e.jsx("div",{className:"py-4",children:e.jsx("div",{className:"h-4 w-32 rounded bg-muted animate-pulse motion-reduce:animate-none"})}):k.map((i,M)=>{const G=de.get(i),H=at(i),J=c===(G?.id??`new:${i}`);return e.jsx(it,{monday:i,weekNumber:M+1,week:G,isCurrent:H,isEditing:J,isGroupPlan:T,editWeekType:u,setEditWeekType:v,editWeekNotes:p,setEditWeekNotes:x,existingWeekTypes:V,onStartEdit:()=>G?hs(G):gs(i),onSave:()=>js(i),onCancel:fs,isSaving:Ie.isPending},i)})}),e.jsxs("div",{className:"flex items-center gap-2 py-2 px-1",children:[e.jsx("span",{className:"text-base","aria-hidden":"true",children:"ðŸŽ¯"}),e.jsx("span",{className:"text-sm font-medium",children:d.end_competition_name??"Competition"}),d.end_competition_date&&e.jsxs("span",{className:"text-xs text-muted-foreground",children:["(",_e(d.end_competition_date),")"]})]})]}),e.jsx(Ze,{open:g,onOpenChange:y,competitions:W,name:E,setName:D,startId:_,setStartId:B,endId:K,setEndId:Q,onSubmit:He,isPending:je.isPending}),e.jsx(se,{open:C,onOpenChange:f,children:e.jsxs(te,{children:[e.jsxs(ne,{children:[e.jsx(ae,{children:"Supprimer le cycle"}),e.jsx(re,{children:"Le cycle et ses semaines seront supprimes."})]}),e.jsxs(ie,{children:[e.jsx(le,{children:"Annuler"}),e.jsx(ce,{onClick:()=>r&&fe.mutate(r),className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Supprimer"})]})]})}),e.jsx(se,{open:P,onOpenChange:F,children:e.jsxs(te,{children:[e.jsxs(ne,{children:[e.jsx(ae,{children:"Personnaliser la planification"}),e.jsx(re,{children:"Copie le plan du groupe pour ce nageur. Tu pourras ensuite l'ajuster."})]}),e.jsxs(ie,{children:[e.jsx(le,{children:"Annuler"}),e.jsx(ce,{onClick:()=>Ge.mutate(),children:Ge.isPending?"Copie...":"Personnaliser"})]})]})})]})},it=({monday:s,weekNumber:t,week:n,isCurrent:r,isEditing:o,isGroupPlan:c,editWeekType:a,setEditWeekType:u,editWeekNotes:v,setEditWeekNotes:p,existingWeekTypes:x,onStartEdit:g,onSave:y,onCancel:C,isSaving:f})=>{const P=nt(s),F=`week-types-${s}`;return o?e.jsxs("div",{className:`rounded-lg border bg-card p-3 space-y-2 ${r?"ring-2 ring-primary":""}`,children:[e.jsxs("div",{className:"text-xs font-medium text-muted-foreground",children:["Sem. ",t," (",Te(s)," - ",Te(P),")"]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx($,{className:"text-xs",children:"Type de semaine"}),e.jsx(Z,{className:"h-7 text-sm",placeholder:"Ex : Foncier, Affutage",list:F,value:a,onChange:E=>u(E.target.value)}),e.jsx("datalist",{id:F,children:x.map(E=>e.jsx("option",{value:E},E))})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx($,{className:"text-xs",children:"Notes"}),e.jsx(Ue,{className:"text-sm min-h-[48px]",placeholder:"Note optionnelle",rows:2,value:v,onChange:E=>p(E.target.value)})]}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsxs(A,{variant:"ghost",size:"sm",className:"h-7 text-xs",onClick:C,children:[e.jsx(bs,{className:"mr-1 h-3 w-3"}),"Annuler"]}),e.jsxs(A,{size:"sm",className:"h-7 text-xs",onClick:y,disabled:f,children:[e.jsx(Ms,{className:"mr-1 h-3 w-3"}),f?"...":"Enregistrer"]})]})]}):e.jsxs("button",{type:"button",className:`w-full text-left rounded-lg border bg-card px-3 py-2 flex items-center gap-2 transition-colors ${c?"cursor-default":"hover:bg-muted/50"} ${r?"ring-2 ring-primary":""}`,onClick:c?void 0:g,disabled:c,children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs("span",{className:"text-xs font-medium text-muted-foreground whitespace-nowrap",children:["Sem. ",t]}),e.jsxs("span",{className:"text-[10px] text-muted-foreground/70 whitespace-nowrap",children:["(",Te(s)," - ",Te(P),")"]}),n?.week_type&&e.jsx(U,{className:"text-[10px] px-1.5 py-0 border-0",style:{backgroundColor:cs(n.week_type),color:ls(n.week_type)},children:n.week_type})]}),n?.notes&&e.jsx("p",{className:"text-xs text-muted-foreground mt-0.5 line-clamp-1",children:n.notes})]}),!c&&e.jsx(Os,{className:"h-3 w-3 text-muted-foreground/40 shrink-0"})]})},Ze=({open:s,onOpenChange:t,competitions:n,name:r,setName:o,startId:c,setStartId:a,endId:u,setEndId:v,onSubmit:p,isPending:x})=>(l.useEffect(()=>{s&&(o(""),a(""),v(""))},[s]),e.jsx(Fe,{open:s,onOpenChange:t,children:e.jsxs(Ae,{side:"right",className:"w-full sm:max-w-md overflow-y-auto",children:[e.jsx(Pe,{children:e.jsx(Me,{children:"Nouveau cycle"})}),e.jsxs("div",{className:"mt-6 space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx($,{children:"Nom du cycle *"}),e.jsx(Z,{placeholder:"Ex : Preparation hiver",value:r,onChange:g=>o(g.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx($,{children:"Date de debut *"}),e.jsxs(ue,{value:c,onValueChange:a,children:[e.jsx(me,{children:e.jsx(xe,{placeholder:"Choisir..."})}),e.jsxs(pe,{children:[e.jsxs(X,{value:Be,children:["Aujourd'hui (",_e(ze(new Date)),")"]}),n.map(g=>e.jsxs(X,{value:g.id,children:[g.name," (",_e(g.date),")"]},g.id))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx($,{children:"Competition de fin *"}),e.jsxs(ue,{value:u,onValueChange:v,children:[e.jsx(me,{children:e.jsx(xe,{placeholder:"Choisir..."})}),e.jsx(pe,{children:n.map(g=>e.jsxs(X,{value:g.id,children:[g.name," (",_e(g.date),")"]},g.id))})]})]}),c&&u&&(()=>{const y=c===Be?ze(new Date):n.find(f=>f.id===c)?.date,C=n.find(f=>f.id===u);if(y&&C&&C.date>y){const f=Qe(y,C.date).length;return e.jsxs("p",{className:"text-xs text-muted-foreground",children:[f," semaine",f>1?"s":""," seront generees."]})}return null})(),e.jsx(A,{className:"w-full",onClick:p,disabled:x,children:x?"Creation...":"Creer le cycle"})]})]})}));function ye(s){return new Date(s+"T12:00:00").toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric"})}function Ee(s){return new Date(s+"T00:00:00").toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit"})}function lt(s){const t=new Date(s+"T00:00:00");return t.setDate(t.getDate()+6),t.toISOString().split("T")[0]}function ct(s){const t=new Date;t.setHours(0,0,0,0);const n=new Date(s+"T00:00:00"),r=new Date(s+"T00:00:00");return r.setDate(r.getDate()+6),t>=n&&t<=r}function $e(s,t){const n=[],r=new Date(s+"T00:00:00"),o=new Date(t+"T00:00:00"),c=new Date(r),a=c.getDay(),u=a===0?1:a===1?0:8-a;for(c.setDate(c.getDate()+u);c<=o;)n.push(c.toISOString().split("T")[0]),c.setDate(c.getDate()+7);return n}function es(s,t){const n=new Date(s+"T00:00:00"),r=new Date(t+"T00:00:00");return Math.round((r.getTime()-n.getTime())/(1e3*60*60*24))}const ot={draft_athlete:{label:"En attente nageur",variant:"secondary",className:"bg-amber-100 text-amber-800 dark:bg-amber-900/40 dark:text-amber-300 border-amber-200 dark:border-amber-800"},draft_coach:{label:"PrÃ©paration coach",variant:"secondary",className:"bg-blue-100 text-blue-800 dark:bg-blue-900/40 dark:text-blue-300 border-blue-200 dark:border-blue-800"},sent:{label:"EnvoyÃ©",variant:"secondary",className:"bg-green-100 text-green-800 dark:bg-green-900/40 dark:text-green-300 border-green-200 dark:border-green-800"},signed:{label:"SignÃ©",variant:"secondary",className:"bg-slate-100 text-slate-600 dark:bg-slate-800/40 dark:text-slate-300 border-slate-200 dark:border-slate-700"}};function dt(s){const t=ot[s];return e.jsx(U,{variant:t.variant,className:`text-[10px] px-1.5 py-0 ${t.className}`,children:t.label})}async function ut(s){const{data:t,error:n}=await rs.rpc("get_auth_uid_for_user",{p_user_id:s});return n?(console.error("[interviews-tab] Failed to resolve auth UUID:",n.message),null):t}const ee=({label:s,text:t})=>e.jsxs("div",{className:"border-l-4 border-blue-400 rounded-r-lg bg-blue-50/50 dark:bg-blue-950/20 p-3 space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(vs,{className:"h-3.5 w-3.5 text-blue-500"}),e.jsx("p",{className:"text-xs font-bold uppercase tracking-widest text-muted-foreground",children:s})]}),e.jsx("p",{className:"text-sm whitespace-pre-wrap",children:t?.trim()||e.jsx("span",{className:"italic text-muted-foreground",children:"Non renseignÃ©"})})]}),De=({label:s,text:t})=>e.jsxs("div",{className:"border-l-4 border-amber-400 rounded-r-lg bg-amber-50/50 dark:bg-amber-950/20 p-3 space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(os,{className:"h-3.5 w-3.5 text-amber-500"}),e.jsx("p",{className:"text-xs font-bold uppercase tracking-widest text-muted-foreground",children:s})]}),e.jsx("p",{className:"text-sm whitespace-pre-wrap",children:t?.trim()||e.jsx("span",{className:"italic text-muted-foreground",children:"Non renseignÃ©"})})]}),qe=({label:s,value:t,onChange:n,onBlur:r,placeholder:o,rows:c=3})=>e.jsxs("div",{className:"border-l-4 border-amber-400 rounded-r-lg bg-amber-50/50 dark:bg-amber-950/20 p-3 space-y-1.5",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(os,{className:"h-3.5 w-3.5 text-amber-500"}),e.jsx("p",{className:"text-xs font-bold uppercase tracking-widest text-muted-foreground",children:s})]}),e.jsx(Ue,{className:"bg-white dark:bg-background",placeholder:o,value:t,onChange:a=>n(a.target.value),onBlur:r,rows:c})]}),Y=({label:s})=>e.jsxs("div",{className:"flex items-center gap-2 pt-3",children:[e.jsx("div",{className:"h-px flex-1 bg-border"}),e.jsx("span",{className:"text-xs font-bold uppercase tracking-widest text-muted-foreground",children:s}),e.jsx("div",{className:"h-px flex-1 bg-border"})]}),ss=({objective:s,performances:t=[]})=>{const n=!!s.event_code,r=!!s.text,o=n?ds(s.event_code):null,c=o?xs[o]??"":"",a=n?us(t,s.event_code,s.pool_length):null;let u=null;return a&&s.target_time_seconds!=null&&s.event_code&&(u=a.time-s.target_time_seconds,ms(a.time,s.target_time_seconds,s.event_code)),e.jsxs("div",{className:`rounded-lg border bg-card p-2.5 text-sm space-y-1 ${n?`border-l-4 ${c}`:""}`,children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx(Ce,{className:"h-3.5 w-3.5 text-muted-foreground shrink-0"}),e.jsx("span",{className:"font-medium",children:n?Ve(s.event_code):""}),s.pool_length&&e.jsxs(U,{variant:"secondary",className:"text-[10px] px-1.5 py-0",children:[s.pool_length,"m"]}),s.target_time_seconds!=null&&e.jsx(U,{variant:"outline",className:"text-[10px] px-1.5 py-0 font-mono",children:we(s.target_time_seconds)})]}),r&&e.jsx("p",{className:"text-muted-foreground line-clamp-2 pl-5",children:s.text}),a&&e.jsxs("div",{className:"flex items-center gap-2 pl-5 text-xs text-muted-foreground flex-wrap",children:[e.jsxs("span",{children:["Actuel : ",e.jsx("span",{className:"font-mono",children:we(a.time)})]}),a.date&&e.jsxs("span",{className:"text-muted-foreground/60",children:["(",ye(a.date),")"]}),u!=null&&e.jsx("span",{className:u<=0?"text-emerald-600 font-medium":"text-amber-600",children:u<=0?"Objectif atteint !":`+${u.toFixed(2)}s`})]}),!a&&n&&s.target_time_seconds!=null&&e.jsx("p",{className:"text-[10px] text-muted-foreground italic pl-5",children:"Pas encore de temps enregistrÃ©"})]})},ts=({prevInterview:s,commitmentReview:t})=>{const[n,r]=l.useState(!1);return e.jsxs(Ls,{open:n,onOpenChange:r,children:[e.jsx(Ks,{asChild:!0,children:e.jsxs("button",{type:"button",className:"w-full flex items-center gap-2 rounded-xl border bg-muted/30 px-3 py-2.5 text-left transition-colors hover:bg-muted/50",children:[e.jsx(Us,{className:`h-3.5 w-3.5 text-muted-foreground shrink-0 transition-transform ${n?"rotate-90":""}`}),e.jsx("span",{className:"text-xs font-bold uppercase tracking-widest text-muted-foreground",children:"Rappel engagements prÃ©cÃ©dents"}),e.jsx(U,{variant:"secondary",className:"text-[10px] px-1.5 py-0 ml-auto",children:ye(s.date)})]})}),e.jsx($s,{children:e.jsxs("div",{className:"rounded-b-xl border border-t-0 bg-muted/30 px-3 pb-3 space-y-2",children:[s.athlete_commitments&&e.jsxs("div",{className:"border-l-4 border-blue-400 rounded-r-lg bg-blue-50/50 dark:bg-blue-950/20 p-2",children:[e.jsx("p",{className:"text-[10px] font-semibold text-muted-foreground",children:"Engagements nageur"}),e.jsx("p",{className:"text-xs whitespace-pre-wrap",children:s.athlete_commitments})]}),s.coach_actions&&e.jsxs("div",{className:"border-l-4 border-amber-400 rounded-r-lg bg-amber-50/50 dark:bg-amber-950/20 p-2",children:[e.jsx("p",{className:"text-[10px] font-semibold text-muted-foreground",children:"Actions coach"}),e.jsx("p",{className:"text-xs whitespace-pre-wrap",children:s.coach_actions})]}),t&&e.jsxs("div",{className:"border-l-4 border-blue-400 rounded-r-lg bg-blue-50/80 dark:bg-blue-950/30 p-2",children:[e.jsx("p",{className:"text-[10px] font-semibold text-muted-foreground",children:"Bilan du nageur"}),e.jsx("p",{className:"text-xs whitespace-pre-wrap",children:t})]})]})})]})},ns=({athleteId:s,interviewDate:t})=>{const{toast:n}=ve(),r=be(),{data:o=[]}=O({queryKey:["competitions"],queryFn:()=>h.getCompetitions()}),{data:c=[]}=O({queryKey:["my-competition-ids",s],queryFn:()=>h.getMyCompetitionIds(s)}),a=l.useMemo(()=>{const m=new Set(c);return o.filter(N=>m.has(N.id)).sort((N,b)=>N.date.localeCompare(b.date))},[o,c]),u=l.useMemo(()=>a.filter(m=>m.date>=t),[a,t]),{data:v=[]}=O({queryKey:["training-cycles","athlete",s],queryFn:()=>h.getTrainingCycles({athleteId:s})}),p=l.useMemo(()=>{const m=new Map;return v.slice().sort((N,b)=>(N.end_competition_date??"").localeCompare(b.end_competition_date??"")).forEach(N=>{N.end_competition_id&&!m.has(N.end_competition_id)&&m.set(N.end_competition_id,N)}),m},[v]),x=l.useMemo(()=>{const m=new Set;return u.map(N=>p.get(N.id)??null).filter(N=>!N||m.has(N.id)?!1:(m.add(N.id),!0))},[u,p]),g=ys({queries:x.map(m=>({queryKey:["training-weeks",m.id],queryFn:()=>h.getTrainingWeeks(m.id),enabled:!!m.id}))}),[y,C]=l.useState(null),[f,P]=l.useState(""),F=l.useMemo(()=>{const m=new Map;return x.forEach((N,b)=>{m.set(N.id,g[b]?.data??[])}),m},[x,g]),E=l.useMemo(()=>{const m=new Set;return F.forEach(N=>{N.forEach(b=>{b.week_type&&m.add(b.week_type)})}),Array.from(m).sort()},[F]),D=u[0]??null,_=l.useMemo(()=>new Date().toISOString().split("T")[0],[]),B=D?es(_,D.date):null,K=R({mutationFn:async m=>{const N=a.find(S=>S.id===m);if(!N)throw new Error("Pas de compÃ©tition");const b=a.findIndex(S=>S.id===m),L=b>0?a[b-1]:null,j=L?.date??t,w=await h.createTrainingCycle({athlete_id:s,group_id:null,start_competition_id:L?.id??null,start_date:L?null:t,end_competition_id:N.id,name:`PrÃ©paration ${N.name}`}),T=$e(j,N.date);return T.length>0&&await h.bulkUpsertTrainingWeeks(T.map(S=>({cycle_id:w.id,week_start:S}))),w},onSuccess:()=>{n({title:"Planification crÃ©Ã©e"}),r.invalidateQueries({queryKey:["training-cycles"]}),r.invalidateQueries({queryKey:["training-weeks"]})},onError:m=>{n({title:"Erreur",description:m.message,variant:"destructive"})}}),Q=R({mutationFn:m=>h.upsertTrainingWeek(m),onSuccess:()=>{C(null),r.invalidateQueries({queryKey:["training-weeks"]})},onError:m=>{n({title:"Erreur",description:m.message,variant:"destructive"})}});return D?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"rounded-xl border bg-muted/20 p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm flex-wrap",children:[e.jsx(Ns,{className:"h-4 w-4 text-amber-500 shrink-0"}),e.jsxs("span",{className:"font-medium",children:[u.length," Ã©chÃ©ance",u.length>1?"s":""," Ã  planifier"]}),B!=null&&e.jsxs(U,{variant:"secondary",className:"text-[10px]",children:["prochaine J-",B]})]}),e.jsx("p",{className:"mt-1 text-xs text-muted-foreground",children:"Une carte par compÃ©tition cible pour construire et piloter plusieurs macrocycles Ã  l'avance."})]}),e.jsx("div",{className:"space-y-3",children:u.map((m,N)=>{const b=p.get(m.id)??null,L=b?F.get(b.id)??[]:[],j=new Map(L.map(q=>[q.week_start,q])),w=b?.start_date??b?.start_competition_date??t,T=w>t?w:t,S=b?$e(T,m.date):[],d=b?$e(w,m.date):[],z=Math.max(d.length-S.length,0),he=es(_,m.date);return e.jsxs("div",{className:"rounded-xl border bg-card shadow-sm overflow-hidden",children:[e.jsxs("div",{className:"border-b border-border bg-muted/20 px-3 py-2.5",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"text-sm font-semibold",children:m.name}),N===0&&e.jsx(U,{className:"text-[10px] bg-primary/10 text-primary border-primary/20",children:"PrioritÃ©"}),e.jsx(U,{variant:"secondary",className:"text-[10px]",children:ye(m.date)}),e.jsxs(U,{variant:"outline",className:"text-[10px]",children:["J-",he]})]}),b?e.jsxs("div",{className:"mt-1 flex items-center gap-2 flex-wrap text-xs text-muted-foreground",children:[e.jsx("span",{className:"font-medium text-foreground",children:b.name}),b.start_competition_name&&e.jsxs("span",{children:["depuis ",b.start_competition_name]}),e.jsxs("span",{children:[d.length," sem."]}),z>0&&e.jsxs("span",{children:[z," dÃ©jÃ  passÃ©es"]})]}):e.jsx("p",{className:"mt-1 text-xs text-muted-foreground",children:"Aucun macrocycle crÃ©Ã© pour cette Ã©chÃ©ance."})]}),b?S.length===0?e.jsx("div",{className:"px-3 py-3 text-xs text-muted-foreground italic",children:"Aucune semaine future Ã  afficher sur ce macrocycle."}):e.jsx("div",{className:"px-3 py-3",children:e.jsx("div",{className:"relative ml-2 border-l-2 border-border pl-3 space-y-1.5",children:S.map((q,W)=>{const V=j.get(q),I=ct(q),k=lt(q),de=`${b.id}:${q}`,ge=y===de,je=`inline-week-${b.id}-${q}`;return ge?e.jsxs("div",{className:`rounded-lg border bg-card p-2 space-y-1.5 ${I?"ring-2 ring-primary":""}`,children:[e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Sem. ",z+W+1," (",Ee(q)," - ",Ee(k),")"]}),e.jsx(Z,{className:"h-7 text-sm",placeholder:"Foncier, Techni., AffÃ»tage...",list:je,value:f,onChange:fe=>P(fe.target.value)}),e.jsx("datalist",{id:je,children:E.map(fe=>e.jsx("option",{value:fe},fe))}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx(A,{variant:"ghost",size:"sm",className:"h-6 text-xs px-2",onClick:()=>C(null),children:"Annuler"}),e.jsx(A,{size:"sm",className:"h-6 text-xs px-2",onClick:()=>{Q.mutate({cycle_id:b.id,week_start:q,week_type:f.trim()||null,notes:V?.notes??null})},disabled:Q.isPending,children:"OK"})]})]},q):e.jsxs("button",{type:"button",className:`w-full text-left rounded-lg border bg-card px-2.5 py-2 text-xs transition-colors hover:bg-muted/50 ${I?"ring-2 ring-primary bg-primary/5":""}`,onClick:()=>{C(de),P(V?.week_type??"")},children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:`h-2 w-2 rounded-full shrink-0 ${I?"bg-primary":V?.week_type?"bg-muted-foreground/40":"bg-muted-foreground/20"}`}),e.jsxs("span",{className:"text-muted-foreground whitespace-nowrap",children:["Sem. ",z+W+1]}),e.jsxs("span",{className:"text-muted-foreground/70 whitespace-nowrap",children:[Ee(q)," - ",Ee(k)]}),V?.week_type&&e.jsx(U,{className:"text-[10px] px-1.5 py-0 border-0 ml-auto",style:{backgroundColor:cs(V.week_type),color:ls(V.week_type)},children:V.week_type})]}),V?.notes&&e.jsx("p",{className:"mt-1 pl-4 text-[11px] text-muted-foreground line-clamp-2",children:V.notes})]},q)})})}):e.jsxs("div",{className:"px-3 py-3 space-y-2",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"CrÃ©ez un macrocycle dÃ©diÃ© pour donner de la visibilitÃ© long terme sur cette cible."}),e.jsx(A,{variant:"outline",size:"sm",className:"w-full text-xs",onClick:()=>K.mutate(m.id),disabled:K.isPending,children:K.isPending?"CrÃ©ation...":"CrÃ©er ce macrocycle"})]})]},m.id)})})]}):e.jsx("div",{className:"text-center py-4",children:e.jsx("p",{className:"text-xs text-muted-foreground italic",children:"Aucune compÃ©tition assignÃ©e Ã  venir â€” planification non disponible."})})},mt=({interview:s,athleteId:t,athleteName:n,athletePhone:r,objectives:o,performances:c})=>{const{toast:a}=ve(),u=be(),[v,p]=l.useState(!1),[x,g]=l.useState(s.coach_comment_successes??""),[y,C]=l.useState(s.coach_comment_difficulties??""),[f,P]=l.useState(s.coach_comment_goals??""),F=s.coach_review??"",E=s.coach_objectives??"",[D,_]=l.useState(s.coach_actions??""),[B,K]=l.useState(!1),[Q,m]=l.useState(!1),[N,b]=l.useState(!1),L=l.useRef(!1),{data:j}=O({queryKey:["previous-interview",t,s.date,s.id],queryFn:()=>h.getPreviousInterview(t,s.date,s.id),enabled:!!s.date}),w=l.useCallback(()=>({coach_comment_successes:x.trim()||null,coach_comment_difficulties:y.trim()||null,coach_comment_goals:f.trim()||null,coach_review:F.trim()||null,coach_objectives:E.trim()||null,coach_actions:D.trim()||null}),[D,y,f,x,E,F]),T=l.useCallback(()=>{const k=w();return(s.coach_comment_successes??null)!==k.coach_comment_successes||(s.coach_comment_difficulties??null)!==k.coach_comment_difficulties||(s.coach_comment_goals??null)!==k.coach_comment_goals||(s.coach_review??null)!==k.coach_review||(s.coach_objectives??null)!==k.coach_objectives||(s.coach_actions??null)!==k.coach_actions},[w,s]),S=R({mutationFn:k=>h.updateInterviewCoachSections(s.id,k),onSuccess:()=>{u.invalidateQueries({queryKey:["interviews",t]})},onError:k=>{a({title:"Erreur",description:k.message,variant:"destructive"})}}),d=R({mutationFn:async()=>(await h.updateInterviewCoachSections(s.id,w()),h.sendInterviewToAthlete(s.id)),onSuccess:()=>{a({title:"Entretien envoyÃ© au nageur"}),u.invalidateQueries({queryKey:["interviews",t]}),b(!0)},onError:k=>{a({title:"Erreur",description:k.message,variant:"destructive"})}}),z=()=>{if(!r)return;const de=`Bonjour ${n.split(" ")[0]}, ton entretien est disponible. Consulte-le ici : https://erstein-aquatic-club.github.io/competition/#/profile`,ge=Rs([r],de);zs()?window.location.href=ge:navigator.clipboard.writeText(`${r}
${de}`).then(()=>{a({title:"CopiÃ©",description:"NumÃ©ro et message copiÃ©s dans le presse-papiers."})}).catch(()=>{a({title:"Erreur",description:"Impossible de copier.",variant:"destructive"})}),b(!1)},he=R({mutationFn:()=>h.deleteInterview(s.id),onSuccess:()=>{a({title:"Entretien supprimÃ©"}),u.invalidateQueries({queryKey:["interviews",t]})},onError:k=>{a({title:"Erreur",description:k.message,variant:"destructive"})}}),q=S.isPending||d.isPending||he.isPending,W=s.status,V=W==="draft_athlete"?"border-amber-300 dark:border-amber-700 border-l-4":W==="draft_coach"?"border-blue-300 dark:border-blue-700 border-l-4":W==="sent"?"border-emerald-300 dark:border-emerald-700 border-l-4":"",I=l.useCallback(()=>{W!=="draft_coach"||L.current||q||!T()||(L.current=!0,S.mutate(w()),window.setTimeout(()=>{L.current=!1},500))},[w,T,q,S,W]);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:`rounded-xl border bg-card shadow-sm ${V}`,children:[e.jsxs("button",{type:"button",className:"w-full flex items-center justify-between p-4 text-left",onClick:()=>p(k=>!k),children:[e.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[e.jsx("span",{className:"text-sm font-semibold",children:ye(s.date)}),dt(W),W==="signed"&&s.signed_at&&e.jsxs("span",{className:"text-xs text-muted-foreground",children:["le ",ye(s.signed_at.slice(0,10))]})]}),v?e.jsx(Bs,{className:"h-4 w-4 text-muted-foreground shrink-0"}):e.jsx(Qs,{className:"h-4 w-4 text-muted-foreground shrink-0"})]}),v&&e.jsxs("div",{className:"px-4 pb-4 space-y-5",children:[W==="draft_athlete"&&e.jsxs("div",{className:"rounded-xl border border-dashed border-amber-300 bg-amber-50/50 dark:bg-amber-950/20 p-6 text-center space-y-2",children:[e.jsx(Oe,{className:"h-8 w-8 mx-auto text-amber-500"}),e.jsx("p",{className:"text-sm font-medium",children:"En attente de la prÃ©paration du nageur"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Le contenu n'est pas encore visible. Le nageur doit d'abord remplir ses sections."})]}),W==="draft_coach"&&e.jsxs(e.Fragment,{children:[j&&e.jsx(ts,{prevInterview:j,commitmentReview:s.athlete_commitment_review}),e.jsx(Y,{label:"RÃ©ussites"}),e.jsx(ee,{label:"Nageur",text:s.athlete_successes}),e.jsx(qe,{label:"Coach",value:x,onChange:g,onBlur:I,placeholder:"Votre commentaire sur les rÃ©ussites..."}),e.jsx(Y,{label:"DifficultÃ©s"}),e.jsx(ee,{label:"Nageur",text:s.athlete_difficulties}),e.jsx(qe,{label:"Coach",value:y,onChange:C,onBlur:I,placeholder:"Votre commentaire sur les difficultÃ©s..."}),e.jsx(Y,{label:"Objectifs"}),o.length>0&&e.jsx("div",{className:"space-y-1.5",children:o.map(k=>e.jsx(ss,{objective:k,performances:c},k.id))}),e.jsx(ee,{label:"Nageur",text:s.athlete_goals}),e.jsx(qe,{label:"Coach",value:f,onChange:P,onBlur:I,placeholder:"Objectifs complÃ©mentaires, commentaires..."}),e.jsx(Y,{label:"Planification"}),e.jsx(ns,{athleteId:t,interviewDate:s.date}),e.jsx(Y,{label:"Engagements & Actions"}),e.jsxs("div",{className:"rounded-xl bg-card border shadow-sm p-4 space-y-3",children:[e.jsx(ee,{label:"Engagements du nageur",text:s.athlete_commitments}),e.jsx(qe,{label:"Actions du coach",value:D,onChange:_,onBlur:I,placeholder:"Actions concrÃ¨tes, points de suivi..."})]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:S.isPending?"Sauvegarde...":"Sauvegarde automatique a la sortie d'un champ."})]}),(W==="sent"||W==="signed")&&e.jsxs(e.Fragment,{children:[j&&e.jsx(ts,{prevInterview:j,commitmentReview:s.athlete_commitment_review}),e.jsx(Y,{label:"RÃ©ussites"}),e.jsx(ee,{label:"Nageur",text:s.athlete_successes}),e.jsx(De,{label:"Coach",text:s.coach_comment_successes||s.coach_review}),e.jsx(Y,{label:"DifficultÃ©s"}),e.jsx(ee,{label:"Nageur",text:s.athlete_difficulties}),e.jsx(De,{label:"Coach",text:s.coach_comment_difficulties}),e.jsx(Y,{label:"Objectifs"}),o.length>0&&e.jsx("div",{className:"space-y-1.5",children:o.map(k=>e.jsx(ss,{objective:k,performances:c},k.id))}),e.jsx(ee,{label:"Nageur",text:s.athlete_goals}),e.jsx(De,{label:"Coach",text:s.coach_comment_goals||s.coach_objectives}),e.jsx(Y,{label:"Planification"}),e.jsx(ns,{athleteId:t,interviewDate:s.date}),e.jsx(Y,{label:"Engagements & Actions"}),e.jsxs("div",{className:"rounded-xl bg-card border shadow-sm p-4 space-y-3",children:[e.jsx(ee,{label:"Engagements du nageur",text:s.athlete_commitments}),e.jsx(De,{label:"Actions du coach",text:s.coach_actions})]})]}),e.jsxs("div",{className:"space-y-2 pt-2 border-t",children:[W==="draft_coach"&&e.jsxs(A,{className:"w-full",onClick:()=>m(!0),disabled:q,children:[e.jsx(Je,{className:"mr-1.5 h-3.5 w-3.5"}),"Envoyer au nageur"]}),e.jsxs(A,{variant:"outline",className:"w-full text-destructive hover:text-destructive",onClick:()=>K(!0),disabled:q,children:[e.jsx(Le,{className:"mr-1.5 h-3.5 w-3.5"}),"Supprimer"]})]})]})]}),e.jsx(se,{open:B,onOpenChange:K,children:e.jsxs(te,{children:[e.jsxs(ne,{children:[e.jsx(ae,{children:"Supprimer l'entretien"}),e.jsxs(re,{children:["Cette action est irrÃ©versible. L'entretien du ",s.date?ye(s.date):""," sera supprimÃ© dÃ©finitivement."]})]}),e.jsxs(ie,{children:[e.jsx(le,{children:"Annuler"}),e.jsx(ce,{onClick:()=>{he.mutate(),K(!1)},className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Supprimer"})]})]})}),e.jsx(se,{open:Q,onOpenChange:m,children:e.jsxs(te,{children:[e.jsxs(ne,{children:[e.jsx(ae,{children:"Envoyer au nageur"}),e.jsx(re,{children:"L'entretien sera envoyÃ© au nageur pour consultation. Les sections coach seront enregistrÃ©es automatiquement."})]}),e.jsxs(ie,{children:[e.jsx(le,{children:"Annuler"}),e.jsxs(ce,{onClick:()=>{d.mutate(),m(!1)},children:[e.jsx(Je,{className:"mr-1.5 h-3.5 w-3.5"}),"Envoyer"]})]})]})}),e.jsx(se,{open:N,onOpenChange:b,children:e.jsxs(te,{children:[e.jsxs(ne,{children:[e.jsx(ae,{children:"Entretien envoyÃ©"}),e.jsx(re,{children:r?e.jsxs(e.Fragment,{children:["L'entretien a bien Ã©tÃ© envoyÃ© Ã  ",e.jsx("strong",{children:n}),". Voulez-vous le notifier par SMS ?"]}):e.jsxs(e.Fragment,{children:["L'entretien a bien Ã©tÃ© envoyÃ© Ã  ",e.jsx("strong",{children:n}),". Aucun numÃ©ro de tÃ©lÃ©phone enregistrÃ© pour ce nageur."]})})]}),e.jsxs(ie,{children:[e.jsx(le,{children:"Plus tard"}),e.jsxs(ce,{onClick:z,disabled:!r,children:[e.jsx(Ws,{className:"mr-1.5 h-3.5 w-3.5"}),"Envoyer le SMS"]})]})]})})]})},xt=({athleteId:s,athleteName:t})=>{const{toast:n}=ve(),r=be(),{data:o}=O({queryKey:["auth-uid",s],queryFn:()=>ut(s),enabled:!!s}),{data:c=[]}=O({queryKey:["objectives",o],queryFn:()=>h.getObjectives(o),enabled:!!o}),{data:a}=O({queryKey:["athlete-profile",s],queryFn:()=>h.getProfile({userId:s}),enabled:!!s}),u=a?.ffn_iuf??null,v=a?.phone??null,p=l.useMemo(()=>{const f=new Date;return f.setDate(f.getDate()-360),f.toISOString().slice(0,10)},[]),{data:x=[]}=O({queryKey:["swimmer-performances-recent",u],queryFn:()=>h.getSwimmerPerformances({iuf:u,fromDate:p}),enabled:!!u}),{data:g=[],isLoading:y}=O({queryKey:["interviews",s],queryFn:()=>h.getInterviews(s),enabled:!!s}),C=R({mutationFn:()=>h.createInterview({athlete_id:s}),onSuccess:()=>{n({title:"Entretien crÃ©Ã©"}),r.invalidateQueries({queryKey:["interviews",s]})},onError:f=>{n({title:"Erreur",description:f.message,variant:"destructive"})}});return y?e.jsx("div",{className:"space-y-2",children:[1,2,3].map(f=>e.jsx("div",{className:"rounded-xl border p-3 animate-pulse motion-reduce:animate-none",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-4 w-24 rounded bg-muted"}),e.jsx("div",{className:"ml-auto h-5 w-20 rounded bg-muted"})]})},f))}):g.length===0?e.jsxs("div",{className:"text-center py-12 space-y-3",children:[e.jsx(Re,{className:"h-10 w-10 text-muted-foreground mx-auto"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Aucun entretien pour ",t,"."]}),e.jsxs(A,{variant:"outline",size:"sm",onClick:()=>C.mutate(),disabled:C.isPending,children:[e.jsx(oe,{className:"mr-1.5 h-3.5 w-3.5"}),C.isPending?"CrÃ©ation...":"Nouvel entretien"]})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"text-sm font-semibold",children:"Entretiens"}),e.jsx(U,{variant:"secondary",className:"text-[10px] px-1.5 py-0",children:g.length})]}),e.jsxs(A,{variant:"outline",size:"sm",onClick:()=>C.mutate(),disabled:C.isPending,children:[e.jsx(oe,{className:"mr-1.5 h-3.5 w-3.5"}),C.isPending?"CrÃ©ation...":"Nouvel entretien"]})]}),e.jsx("div",{className:"space-y-2",children:g.map(f=>e.jsx(mt,{interview:f,athleteId:s,athleteName:t,athletePhone:v,objectives:c,performances:x},f.id))})]})},ps=["Lundi","Mardi","Mercredi","Jeudi","Vendredi","Samedi","Dimanche"];function pt({athleteId:s,athleteName:t,groupId:n}){const{userId:r}=is(),{toast:o}=ve(),c=be(),{data:a,isLoading:u}=O({queryKey:["swimmer-slots",s],queryFn:()=>h.getSwimmerSlots(s)}),{data:v}=O({queryKey:["swimmer-slots-exists",s],queryFn:()=>h.hasCustomSlots(s)}),{data:p=[]}=O({queryKey:["training-slots","group",n],queryFn:()=>h.getTrainingSlotsForGroup(n)}),x=v===!0,g=x?a??[]:[],y=()=>{c.invalidateQueries({queryKey:["swimmer-slots",s]}),c.invalidateQueries({queryKey:["swimmer-slots-exists",s]})},C=R({mutationFn:()=>h.initSwimmerSlots(s,n,r),onSuccess:()=>{y(),o({title:"Planning personnalisÃ© crÃ©Ã©"})},onError:j=>o({title:"Erreur",description:j.message,variant:"destructive"})}),f=R({mutationFn:()=>h.resetSwimmerSlots(s,n,r),onSuccess:()=>{y(),o({title:"Planning rÃ©initialisÃ©"})},onError:j=>o({title:"Erreur",description:j.message,variant:"destructive"})}),P=R({mutationFn:j=>h.deleteSwimmerSlot(j),onSuccess:()=>{y(),o({title:"CrÃ©neau supprimÃ©"})}}),F=R({mutationFn:j=>h.createSwimmerSlot(j,r),onSuccess:()=>{y(),o({title:"CrÃ©neau ajoutÃ©"})},onError:j=>o({title:"Erreur",description:j.message,variant:"destructive"})}),E=R({mutationFn:({slotId:j,input:w})=>h.updateSwimmerSlot(j,w),onSuccess:()=>{y(),o({title:"CrÃ©neau modifiÃ©"})},onError:j=>o({title:"Erreur",description:j.message,variant:"destructive"})}),[D,_]=l.useState(null),[B,K]=l.useState(!1),[Q,m]=l.useState(!1),[N,b]=l.useState(null),L=l.useMemo(()=>{const j=x?g:p,w=new Map;for(const T of j){const S=w.get(T.day_of_week)??[];S.push(T),w.set(T.day_of_week,S)}return w},[x,g,p]);return u?e.jsx("div",{className:"space-y-3",children:Array.from({length:5}).map((j,w)=>e.jsx(_s,{className:"h-14 rounded-lg"},w))}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between gap-2",children:x?e.jsxs(e.Fragment,{children:[e.jsxs(A,{size:"sm",variant:"outline",onClick:()=>K(!0),children:[e.jsx(oe,{className:"h-3.5 w-3.5 mr-1"}),"Ajouter"]}),e.jsxs(A,{size:"sm",variant:"ghost",onClick:()=>m(!0),children:[e.jsx(Cs,{className:"h-3.5 w-3.5 mr-1"}),"RÃ©initialiser"]})]}):e.jsxs(A,{size:"sm",onClick:()=>C.mutate(),disabled:C.isPending,children:[e.jsx(oe,{className:"h-3.5 w-3.5 mr-1"}),"Personnaliser le planning"]})}),!x&&p.length>0&&e.jsx("div",{className:"rounded-lg border border-blue-200 bg-blue-50 dark:border-blue-800 dark:bg-blue-950/30 px-3 py-2 text-sm text-blue-700 dark:text-blue-300",children:"HÃ©rite du planning du groupe. Cliquez sur Â« Personnaliser Â» pour ajuster."}),[1,2,3,4,5,6,7].map(j=>{const w=L.get(j);return!w||w.length===0?null:e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("h3",{className:"text-xs font-semibold text-muted-foreground uppercase tracking-wider",children:ps[j-1]}),w.map(T=>e.jsxs("button",{type:"button",className:"w-full flex items-center gap-3 rounded-lg border border-border bg-card px-3 py-2 text-left hover:bg-muted/50 transition",onClick:()=>x?_(T):void 0,children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-sm font-mono tabular-nums",children:[e.jsx(Oe,{className:"h-3.5 w-3.5 text-muted-foreground"}),T.start_time.slice(0,5)," â€“ ",T.end_time.slice(0,5)]}),e.jsxs("div",{className:"flex items-center gap-1.5 text-sm text-muted-foreground truncate",children:[e.jsx(Vs,{className:"h-3.5 w-3.5"}),T.location]}),x&&T.source_assignment_id&&e.jsx(Ys,{className:"h-3.5 w-3.5 text-blue-500 ml-auto flex-shrink-0"})]},T.id))]},j)}),L.size===0&&e.jsx("p",{className:"text-center text-sm text-muted-foreground py-8",children:"Aucun crÃ©neau configurÃ©."}),e.jsx(se,{open:Q,onOpenChange:m,children:e.jsxs(te,{children:[e.jsxs(ne,{children:[e.jsx(ae,{children:"RÃ©initialiser le planning ?"}),e.jsx(re,{children:"Tous les crÃ©neaux personnalisÃ©s seront supprimÃ©s et remplacÃ©s par ceux du groupe."})]}),e.jsxs(ie,{children:[e.jsx(le,{children:"Annuler"}),e.jsx(ce,{onClick:()=>{f.mutate(),m(!1)},children:"RÃ©initialiser"})]})]})}),e.jsx(se,{open:!!N,onOpenChange:()=>b(null),children:e.jsxs(te,{children:[e.jsxs(ne,{children:[e.jsx(ae,{children:"Supprimer ce crÃ©neau ?"}),e.jsx(re,{children:"Le crÃ©neau sera retirÃ© du planning personnel."})]}),e.jsxs(ie,{children:[e.jsx(le,{children:"Annuler"}),e.jsx(ce,{onClick:()=>{N&&P.mutate(N),b(null)},className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Supprimer"})]})]})}),e.jsx(Fe,{open:!!D,onOpenChange:j=>!j&&_(null),children:e.jsxs(Ae,{side:"bottom",className:"max-h-[80vh]",children:[e.jsxs(Pe,{children:[e.jsx(Me,{children:"Modifier le crÃ©neau"}),e.jsx(Ye,{children:"Ajustez les horaires ou le lieu"})]}),D&&e.jsx(ht,{slot:D,onSave:j=>{E.mutate({slotId:D.id,input:j}),_(null)},onDelete:()=>{b(D.id),_(null)},isPending:E.isPending})]})}),e.jsx(Fe,{open:B,onOpenChange:K,children:e.jsxs(Ae,{side:"bottom",className:"max-h-[80vh]",children:[e.jsxs(Pe,{children:[e.jsx(Me,{children:"Ajouter un crÃ©neau"}),e.jsx(Ye,{children:"Nouveau crÃ©neau personnalisÃ©"})]}),e.jsx(gt,{onSave:j=>{F.mutate({...j,user_id:s}),K(!1)},isPending:F.isPending})]})})]})}function ht({slot:s,onSave:t,onDelete:n,isPending:r}){const[o,c]=l.useState(s.start_time.slice(0,5)),[a,u]=l.useState(s.end_time.slice(0,5)),[v,p]=l.useState(s.location);return e.jsxs("div",{className:"space-y-4 pt-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx($,{children:"DÃ©but"}),e.jsx(Z,{type:"time",value:o,onChange:x=>c(x.target.value)})]}),e.jsxs("div",{children:[e.jsx($,{children:"Fin"}),e.jsx(Z,{type:"time",value:a,onChange:x=>u(x.target.value)})]})]}),e.jsxs("div",{children:[e.jsx($,{children:"Lieu"}),e.jsx(Z,{value:v,onChange:x=>p(x.target.value)})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(A,{className:"flex-1",onClick:()=>t({start_time:o,end_time:a,location:v}),disabled:r,children:"Enregistrer"}),e.jsx(A,{variant:"destructive",size:"icon",onClick:n,children:e.jsx(Le,{className:"h-4 w-4"})})]})]})}function gt({onSave:s,isPending:t}){const[n,r]=l.useState("1"),[o,c]=l.useState("08:00"),[a,u]=l.useState("10:00"),[v,p]=l.useState("");return e.jsxs("div",{className:"space-y-4 pt-4",children:[e.jsxs("div",{children:[e.jsx($,{children:"Jour"}),e.jsxs(ue,{value:n,onValueChange:r,children:[e.jsx(me,{children:e.jsx(xe,{})}),e.jsx(pe,{children:ps.map((x,g)=>e.jsx(X,{value:String(g+1),children:x},g+1))})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx($,{children:"DÃ©but"}),e.jsx(Z,{type:"time",value:o,onChange:x=>c(x.target.value)})]}),e.jsxs("div",{children:[e.jsx($,{children:"Fin"}),e.jsx(Z,{type:"time",value:a,onChange:x=>u(x.target.value)})]})]}),e.jsxs("div",{children:[e.jsx($,{children:"Lieu"}),e.jsx(Z,{value:v,onChange:x=>p(x.target.value),placeholder:"Piscine, Salle..."})]}),e.jsx(A,{className:"w-full",onClick:()=>s({day_of_week:Number(n),start_time:o,end_time:a,location:v}),disabled:t||!v,children:"Ajouter"})]})}function Zt({athleteId:s,athleteName:t,onBack:n}={}){const[,r]=ws("/coach/swimmer/:id"),[,o]=Ss(),{selectedAthleteId:c,selectedAthleteName:a}=is(),[u,v]=l.useState("resume"),p=s??(r?.id?Number(r.id):c),x=t??a,{data:g}=O({queryKey:["profile",p],queryFn:()=>h.getProfile({userId:p}),enabled:p!=null}),y=g?.display_name??x??"Nageur",C=g?.avatar_url??null,f=g?.group_label??null,P=n??(()=>o("/coach?section=swimmers"));return p?e.jsxs("div",{className:"mx-auto max-w-3xl px-4 py-4 space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{type:"button",onClick:P,className:"h-9 w-9 rounded-xl border border-border bg-card flex items-center justify-center hover:bg-muted transition","aria-label":"Retour",children:e.jsx(Is,{className:"h-4 w-4"})}),C?e.jsx("img",{src:C,alt:"",className:"h-10 w-10 rounded-full object-cover border border-border"}):e.jsx("div",{className:"h-10 w-10 rounded-full bg-primary/10 flex items-center justify-center text-sm font-bold text-primary",children:y.charAt(0).toUpperCase()}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h1",{className:"text-lg font-bold truncate",children:y}),f&&e.jsx(U,{variant:"secondary",className:"text-[10px] px-1.5 py-0",children:f})]})]}),e.jsxs(ks,{value:u,onValueChange:F=>v(F),children:[e.jsxs(Ts,{className:"grid h-auto w-full grid-cols-2 gap-2 bg-transparent p-0",children:[e.jsx(Se,{value:"resume",className:"rounded-xl border bg-card px-3 py-2 text-xs data-[state=active]:border-primary data-[state=active]:bg-primary/5",children:"RÃ©sumÃ©"}),e.jsx(Se,{value:"suivi",className:"rounded-xl border bg-card px-3 py-2 text-xs data-[state=active]:border-primary data-[state=active]:bg-primary/5",children:"Suivi"}),e.jsx(Se,{value:"echanges",className:"rounded-xl border bg-card px-3 py-2 text-xs data-[state=active]:border-primary data-[state=active]:bg-primary/5",children:"Ã‰changes"}),e.jsx(Se,{value:"planif",className:"rounded-xl border bg-card px-3 py-2 text-xs data-[state=active]:border-primary data-[state=active]:bg-primary/5",children:"Planif"})]}),e.jsx(ke,{value:"resume",className:"mt-4 space-y-3",children:e.jsxs("div",{className:"rounded-2xl border bg-card p-4",children:[e.jsx("p",{className:"text-sm font-semibold",children:"Vue rapide"}),e.jsxs("p",{className:"mt-1 text-sm text-muted-foreground",children:["AccÃ¨s direct au suivi, aux entretiens et Ã  la planification de ",y,"."]}),e.jsxs("div",{className:"mt-3 grid grid-cols-2 gap-2",children:[e.jsxs("button",{type:"button",onClick:()=>v("suivi"),className:"rounded-xl border px-3 py-3 text-left active:bg-muted",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold",children:[e.jsx(Oe,{className:"h-4 w-4 text-muted-foreground"}),"Suivi"]}),e.jsx("p",{className:"mt-1 text-xs text-muted-foreground",children:"Ressentis et objectifs"})]}),e.jsxs("button",{type:"button",onClick:()=>v("echanges"),className:"rounded-xl border px-3 py-3 text-left active:bg-muted",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold",children:[e.jsx(Re,{className:"h-4 w-4 text-muted-foreground"}),"Ã‰changes"]}),e.jsx("p",{className:"mt-1 text-xs text-muted-foreground",children:"Entretiens du nageur"})]}),e.jsxs("button",{type:"button",onClick:()=>v("planif"),className:"rounded-xl border px-3 py-3 text-left active:bg-muted",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold",children:[e.jsx(We,{className:"h-4 w-4 text-muted-foreground"}),"Planif"]}),e.jsx("p",{className:"mt-1 text-xs text-muted-foreground",children:"Cycles et crÃ©neaux"})]}),e.jsxs("button",{type:"button",onClick:()=>v("suivi"),className:"rounded-xl border px-3 py-3 text-left active:bg-muted",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold",children:[e.jsx(Ce,{className:"h-4 w-4 text-muted-foreground"}),"Objectifs"]}),e.jsx("p",{className:"mt-1 text-xs text-muted-foreground",children:"Temps cibles et cap"})]})]})]})}),e.jsxs(ke,{value:"suivi",className:"mt-4 space-y-4",children:[e.jsxs("section",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Oe,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("h2",{className:"text-sm font-semibold",children:"Ressentis"})]}),e.jsx(Es,{athleteId:p,athleteName:y,showProgressAction:!1})]}),e.jsxs("section",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ce,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("h2",{className:"text-sm font-semibold",children:"Objectifs"})]}),e.jsx(tt,{athleteId:p,athleteName:y})]})]}),e.jsxs(ke,{value:"echanges",className:"mt-4 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Re,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("h2",{className:"text-sm font-semibold",children:"Entretiens"})]}),e.jsx(xt,{athleteId:p,athleteName:y})]}),e.jsxs(ke,{value:"planif",className:"mt-4 space-y-4",children:[e.jsxs("section",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(We,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("h2",{className:"text-sm font-semibold",children:"Cycle"})]}),e.jsx(rt,{athleteId:p})]}),e.jsxs("section",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Hs,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("h2",{className:"text-sm font-semibold",children:"CrÃ©neaux"})]}),e.jsx(pt,{athleteId:p,athleteName:y,groupId:g?.group_id??0})]})]})]})]}):e.jsxs("div",{className:"p-4 text-center text-muted-foreground",children:[e.jsx("p",{children:"Aucun nageur sÃ©lectionnÃ©."}),e.jsx("button",{type:"button",onClick:P,className:"mt-2 text-primary underline",children:"Retour au dashboard"})]})}export{Zt as default};
