const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/StrengthCatalog-BjUrHn3-.js","assets/vendor-query-BiSH4r2z.js","assets/vendor-react-BzrpNAyj.js","assets/api-BI2S8x_2.js","assets/index-B0EYvMaU.js","assets/vendor-supabase-DFPLkPj_.js","assets/index-DiaupzI4.css","assets/swim-Cvq3kT24.js","assets/objectiveHelpers-lwqxf8zv.js","assets/dialog-DJvj3-ws.js","assets/index-FpXi5B7B.js","assets/index-CFteTQBG.js","assets/index-DJKIBUEX.js","assets/checkbox-Be1_z74C.js","assets/select-C6xmqCVo.js","assets/index-CC1VnhJY.js","assets/chevron-down-CHuRxv6V.js","assets/chevron-up-B-wS4ndy.js","assets/alert-dialog-B2jtqcwb.js","assets/tabs-Ceh4gNE3.js","assets/index-DzTJWhIc.js","assets/SessionListView-B-MIZQim.js","assets/chevron-left-Ds8zT-As.js","assets/play-BZX7IuLq.js","assets/save-8UQtFz6_.js","assets/chevron-right-DsP8pSCN.js","assets/CalendarGrid-BZdIU4-q.js","assets/circle-alert-DDmSuFQM.js","assets/pencil-C46atw3y.js","assets/share-2-j43ijVBE.js","assets/trash-2-B0CHfOXV.js","assets/drawer-CLmwuyZI.js","assets/plus-D0ICk8yB.js","assets/loader-circle-BkVIKbdb.js","assets/search-DXEOxVAA.js","assets/pen-DlwSHdU2.js","assets/toggle-group-C7A_tbpl.js","assets/badge-fTBd6N_K.js","assets/copy-Cus8en4m.js","assets/InlineBanner-JNMQTFsk.js","assets/separator-Ct1gARId.js","assets/collapsible-BseAtKt6.js","assets/user-plus-Gy9JykOH.js","assets/clock-a-pKZrm6.js","assets/map-pin-DmImv-_J.js","assets/SwimCatalog-Cdn8-Vzw.js","assets/SwimSessionTimeline-H9FCkK1i.js","assets/swimConsultationUtils-du0t5K-X.js","assets/timer-BR4qAwhP.js","assets/eye-UWE0kTOV.js","assets/date-NdbyDBh_.js","assets/format-B9mPVj_w.js"])))=>i.map(i=>d[i]);
import{c as Te,B as L,d as le,C as qe,i as ze,k as Le,l as Ke,g as Ge,L as B,I as de,n as Se,o as $t,p as qt,R as Vs,q as vt,r as Ve,P as ae,t as zt,v as jt,w as Bs,x as Us,y as Qs,z as Hs,a as X,X as St,s as Lt,W as Kt,D as Gt,E as Ws,U as Xe,G as Ys,H as Js,T as ct,J as Xs,K as _t,u as kt,b as Zs,M as Mt,_ as Vt}from"./index-B0EYvMaU.js";import{j as e,r,u as Q,R as Bt,c as he,d as W}from"./vendor-query-BiSH4r2z.js";import{a as O}from"./api-BI2S8x_2.js";import{T as Ze,a as ce}from"./toggle-group-C7A_tbpl.js";import{A as Je,T as bt,M as Ut,a as dt,e as Qt,f as Ht,F as en,p as At}from"./objectiveHelpers-lwqxf8zv.js";import{B as ie}from"./badge-fTBd6N_K.js";import{S as te,a as se,b as ne,c as re,d as H,u as tn}from"./select-C6xmqCVo.js";import{h as sn,R as nn,u as rn,F as an,C as Et}from"./index-DJKIBUEX.js";import{u as ge}from"./index-CFteTQBG.js";import{R as on,P as ln,O as cn,C as dn}from"./index-FpXi5B7B.js";import"./dialog-DJvj3-ws.js";import{S as un}from"./search-DXEOxVAA.js";import{C as mn}from"./copy-Cus8en4m.js";import{a as pn,b as hn,P as xn,C as gn}from"./CalendarGrid-BZdIU4-q.js";import{S as ve,a as je,b as be,c as ye,d as Be,A as _e,e as ke,f as Me,g as Ae,h as Ee,i as Re,j as De,k as Pe}from"./alert-dialog-B2jtqcwb.js";import{I as fn}from"./InlineBanner-JNMQTFsk.js";import{C as vn}from"./circle-alert-DDmSuFQM.js";import{T as et}from"./trash-2-B0CHfOXV.js";import{C as Wt}from"./checkbox-Be1_z74C.js";import{S as Yt}from"./separator-Ct1gARId.js";import{C as jn,a as bn,b as yn}from"./collapsible-BseAtKt6.js";import{P as ue}from"./plus-D0ICk8yB.js";import{U as Nn,a as wn}from"./user-plus-Gy9JykOH.js";import{C as Jt}from"./chevron-down-CHuRxv6V.js";import{c as Xt,R as Cn,I as Sn}from"./index-DzTJWhIc.js";import{u as _n}from"./index-CC1VnhJY.js";import{C as yt}from"./clock-a-pKZrm6.js";import{P as kn}from"./pencil-C46atw3y.js";import{M as Mn}from"./map-pin-DmImv-_J.js";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const An=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 18h.01",key:"lrp35t"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M16 18h.01",key:"kzsmim"}]],ut=Te("calendar-days",An);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const En=[["path",{d:"m7 15 5 5 5-5",key:"1hf1tw"}],["path",{d:"m7 9 5-5 5 5",key:"sgt6xg"}]],Rn=Te("chevrons-up-down",En);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dn=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]],Zt=Te("external-link",Dn);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pn=[["path",{d:"M2 9.5a5.5 5.5 0 0 1 9.591-3.676.56.56 0 0 0 .818 0A5.49 5.49 0 0 1 22 9.5c0 2.29-1.5 4-3 5.5l-5.492 5.313a2 2 0 0 1-3 .019L5 15c-1.5-1.5-3-3.2-3-5.5",key:"mvr1a0"}],["path",{d:"M3.22 13H9.5l.5-1 2 4.5 2-7 1.5 3.5h5.27",key:"auskq0"}]],Fn=Te("heart-pulse",Pn);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const In=[["path",{d:"m22 7-8.991 5.727a2 2 0 0 1-2.009 0L2 7",key:"132q7q"}],["rect",{x:"2",y:"4",width:"20",height:"16",rx:"2",key:"izxlao"}]],es=Te("mail",In);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tn=[["path",{d:"M18 21a8 8 0 0 0-16 0",key:"3ypg7q"}],["circle",{cx:"10",cy:"8",r:"5",key:"o932ke"}],["path",{d:"M22 20c0-3.37-2-6.5-4-8a5 5 0 0 0-.45-8.3",key:"10s06x"}]],ts=Te("users-round",Tn),me=({title:t,description:n,onBack:s,actions:o})=>e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs(L,{variant:"ghost",size:"sm",className:"-ml-2",onClick:s,children:[e.jsx(Je,{className:"mr-2 h-4 w-4"}),"Retour"]}),e.jsx("h2",{className:"text-2xl font-display font-semibold uppercase italic text-primary",children:t}),n?e.jsx("p",{className:"text-sm text-muted-foreground",children:n}):null]}),o?e.jsx("div",{className:"flex items-center gap-2",children:o}):null]});function On(t){if(t.length===0)return null;const n=t[0],s=n.effort,o=n.fatigue,a=n.performance,i=n.engagement,u=[];return s!=null&&u.push((11-s)/2),o!=null&&u.push((11-o)/2),a!=null&&u.push(a/2),i!=null&&u.push(i/2),u.length===0?null:Math.round(u.reduce((l,g)=>l+g,0)/u.length*10)/10}function $n(t){return t==null?{label:"—",className:"bg-muted text-muted-foreground"}:t>=3.5?{label:`${t.toFixed(1)}`,className:"bg-emerald-100 text-emerald-800 dark:bg-emerald-900/30 dark:text-emerald-400"}:t>=2.5?{label:`${t.toFixed(1)}`,className:"bg-amber-100 text-amber-800 dark:bg-amber-900/30 dark:text-amber-400"}:{label:`${t.toFixed(1)}`,className:"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400"}}function qn({athletes:t,athletesLoading:n,onBack:s,onOpenAthlete:o}){const[a,i]=r.useState(null),[u,l]=r.useState("name"),{data:g=[]}=Q({queryKey:["recent-sessions-all",30],queryFn:()=>O.getRecentSessionsAllAthletes(30),enabled:t.length>0,staleTime:300*1e3}),{data:m}=Q({queryKey:["objectives-counts-by-user"],queryFn:()=>O.getObjectivesCountsByUser(),enabled:t.length>0,staleTime:300*1e3}),p=r.useMemo(()=>{const x=new Map;return t.forEach(c=>{c.group_id&&c.group_label&&x.set(c.group_id,c.group_label)}),Array.from(x.entries()).map(([c,v])=>({id:c,name:v})).sort((c,v)=>c.name.localeCompare(v.name,"fr"))},[t]),h=r.useMemo(()=>{const x=new Map,c=new Map;for(const v of g){if(v.athlete_id==null)continue;const C=c.get(v.athlete_id)??[];C.push(v),c.set(v.athlete_id,C)}for(const v of t){if(v.id==null)continue;const C=c.get(v.id)??[],b=On(C),y=C.length>0?C[0].session_date:null;x.set(v.id,{forme:b,lastSessionDate:y,sessionsCount30d:C.length,assiduity:null,objectivesTotal:m?.get(v.id)??0,objectivesAchieved:0})}return x},[t,g,m]),f=r.useMemo(()=>{let x=[...t];switch(a!=null&&(x=x.filter(c=>c.group_id===a)),u){case"forme":x.sort((c,v)=>{const C=c.id!=null?h.get(c.id)?.forme??99:99,b=v.id!=null?h.get(v.id)?.forme??99:99;return C-b});break;case"assiduity":x.sort((c,v)=>{const C=c.id!=null?h.get(c.id)?.sessionsCount30d??99:99,b=v.id!=null?h.get(v.id)?.sessionsCount30d??99:99;return C-b});break;default:x.sort((c,v)=>c.display_name.localeCompare(v.display_name,"fr"))}return x},[t,a,u,h]);return e.jsxs("div",{className:"space-y-4",children:[e.jsx(me,{title:"Nageurs",description:n?"Chargement…":`${t.length} nageur${t.length!==1?"s":""}`,onBack:s}),p.length>1&&e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{type:"button",onClick:()=>i(null),className:`rounded-full px-3 py-1 text-xs font-medium border transition ${a==null?"bg-foreground text-background border-foreground":"bg-card text-foreground border-border hover:bg-muted"}`,children:"Tous"}),p.map(x=>e.jsx("button",{type:"button",onClick:()=>i(a===x.id?null:x.id),className:`rounded-full px-3 py-1 text-xs font-medium border transition ${a===x.id?"bg-foreground text-background border-foreground":"bg-card text-foreground border-border hover:bg-muted"}`,children:x.name},x.id))]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"Trier :"}),[{key:"name",label:"Nom"},{key:"forme",label:"Forme"},{key:"assiduity",label:"Activité"}].map(x=>e.jsx("button",{type:"button",onClick:()=>l(x.key),className:`rounded-full px-2.5 py-0.5 text-xs font-medium border transition ${u===x.key?"bg-primary/10 text-primary border-primary/30":"bg-card text-muted-foreground border-border hover:bg-muted"}`,children:x.label},x.key))]}),n?e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3",children:[1,2,3,4,5,6].map(x=>e.jsxs("div",{className:"rounded-2xl border bg-card p-4 animate-pulse motion-reduce:animate-none",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-muted"}),e.jsxs("div",{className:"space-y-1.5 flex-1",children:[e.jsx("div",{className:"h-4 w-24 rounded bg-muted"}),e.jsx("div",{className:"h-3 w-16 rounded bg-muted"})]})]}),e.jsxs("div",{className:"mt-3 space-y-2",children:[e.jsx("div",{className:"h-3 w-full rounded bg-muted"}),e.jsx("div",{className:"h-3 w-2/3 rounded bg-muted"})]})]},x))}):f.length===0?e.jsx("p",{className:"text-sm text-muted-foreground text-center py-8",children:a!=null?"Aucun nageur dans ce groupe.":"Aucun nageur disponible."}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3",children:f.map(x=>{const c=x.id!=null?h.get(x.id):null,v=$n(c?.forme??null);return e.jsxs("button",{type:"button",onClick:()=>o(x),className:"rounded-2xl border bg-card p-4 text-left hover:shadow-md hover:border-primary/20 transition-all",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[x.avatar_url?e.jsx("img",{src:x.avatar_url,alt:"",className:"h-10 w-10 rounded-full object-cover border border-border"}):e.jsx("div",{className:"h-10 w-10 rounded-full bg-primary/10 flex items-center justify-center text-sm font-bold text-primary",children:x.display_name.charAt(0).toUpperCase()}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-sm font-semibold truncate",children:x.display_name}),x.group_label&&e.jsx(ie,{variant:"secondary",className:"text-[10px] px-1.5 py-0 mt-0.5",children:x.group_label})]})]}),e.jsxs("div",{className:"mt-3 grid grid-cols-3 gap-2",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-[10px] font-medium text-muted-foreground mb-1",children:"Forme"}),e.jsx("span",{className:`inline-block rounded-full px-2 py-0.5 text-xs font-semibold ${v.className}`,children:v.label})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-[10px] font-medium text-muted-foreground mb-1",children:"30j"}),e.jsx("span",{className:"text-sm font-bold text-foreground",children:c?.sessionsCount30d??0}),e.jsx("span",{className:"text-[10px] text-muted-foreground ml-0.5",children:"séances"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-[10px] font-medium text-muted-foreground mb-1",children:"Objectifs"}),e.jsx("span",{className:"text-sm font-bold text-foreground",children:c?.objectivesTotal??0})]})]}),c?.lastSessionDate&&e.jsxs("div",{className:"mt-2 text-[10px] text-muted-foreground",children:["Dernier ressenti : ",new Date(c.lastSessionDate).toLocaleDateString("fr-FR",{day:"numeric",month:"short"})]})]},x.id??x.display_name)})})]})}const zn=({onBack:t,athletes:n,groups:s,athletesLoading:o})=>{const{toast:a}=le(),[i,u]=r.useState(""),[l,g]=r.useState(""),m=r.useMemo(()=>n.filter(c=>c.id&&c.email).map(c=>({value:`user:${c.id}`,label:c.group_label?`${c.display_name} · ${c.group_label}`:c.display_name,email:c.email})),[n]),p=r.useMemo(()=>s.map(c=>({value:`group:${c.id}`,label:c.name,id:c.id})),[s]),h=()=>{if(!l)return[];if(l.startsWith("user:")){const c=m.find(v=>v.value===l);return c?[c.email]:[]}if(l.startsWith("group:")){const c=Number(l.split(":")[1]);return n.filter(v=>v.group_id===c&&v.email).map(v=>v.email)}return[]},f=()=>{const c=h();if(!c.length){a({title:"Aucune adresse email",description:"Aucun nageur avec une adresse email dans cette sélection."});return}const v=new URLSearchParams;v.set("bcc",c.join(",")),i.trim()&&v.set("subject",i.trim()),window.location.href=`mailto:?${v.toString()}`},x=h();return e.jsxs("div",{className:"space-y-6 pb-24",children:[e.jsx(me,{title:"Contacter par email",description:"Ouvre votre application mail avec les destinataires en CCI.",onBack:t}),e.jsxs(qe,{className:"border-l-4 border-l-primary",children:[e.jsxs(ze,{children:[e.jsx(Le,{children:"Destinataire"}),e.jsx(Ke,{children:"Sélectionnez un nageur ou un groupe."})]}),e.jsxs(Ge,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(B,{children:"Destinataire"}),e.jsxs(te,{value:l,onValueChange:g,children:[e.jsx(se,{children:e.jsx(ne,{placeholder:o?"Chargement...":"Choisir un nageur ou un groupe"})}),e.jsxs(re,{children:[p.length?e.jsxs(e.Fragment,{children:[e.jsx(H,{value:"section-group",disabled:!0,children:"Groupes"}),p.map(c=>e.jsx(H,{value:c.value,children:c.label},c.value))]}):null,m.length?e.jsxs(e.Fragment,{children:[e.jsx(H,{value:"section-athlete",disabled:!0,children:"Nageurs"}),m.map(c=>e.jsx(H,{value:c.value,children:c.label},c.value))]}):null]})]})]}),l&&x.length>0?e.jsxs("p",{className:"text-xs text-muted-foreground",children:[x.length," adresse",x.length>1?"s":""," email",x.length>1?" (envoi en CCI)":""]}):null,l&&x.length===0?e.jsx("p",{className:"text-xs text-destructive",children:"Aucune adresse email disponible pour cette sélection."}):null]})]}),e.jsxs(qe,{children:[e.jsxs(ze,{children:[e.jsx(Le,{children:"Objet"}),e.jsx(Ke,{children:"Optionnel — pré-rempli dans votre application mail."})]}),e.jsx(Ge,{children:e.jsx(de,{value:i,onChange:c=>u(c.target.value),placeholder:"Objet du mail…"})})]}),e.jsx("div",{className:"sticky bottom-0 z-10 -mx-4 border-t bg-background/95 p-4 backdrop-blur sm:static sm:mx-0 sm:border-0 sm:p-0",children:e.jsxs(L,{className:"w-full sm:w-auto",onClick:f,disabled:!l||x.length===0,children:[e.jsx(es,{className:"mr-2 h-4 w-4"}),"Ouvrir dans l'app mail",e.jsx(Zt,{className:"ml-2 h-3 w-3"})]})})]})};function $e(t,n,{checkForDefaultPrevented:s=!0}={}){return function(a){if(t?.(a),s===!1||!a.defaultPrevented)return n?.(a)}}function Ln(t){const n=Kn(t),s=r.forwardRef((o,a)=>{const{children:i,...u}=o,l=r.Children.toArray(i),g=l.find(Vn);if(g){const m=g.props.children,p=l.map(h=>h===g?r.Children.count(m)>1?r.Children.only(null):r.isValidElement(m)?m.props.children:null:h);return e.jsx(n,{...u,ref:a,children:r.isValidElement(m)?r.cloneElement(m,void 0,p):null})}return e.jsx(n,{...u,ref:a,children:i})});return s.displayName=`${t}.Slot`,s}function Kn(t){const n=r.forwardRef((s,o)=>{const{children:a,...i}=s;if(r.isValidElement(a)){const u=Un(a),l=Bn(i,a.props);return a.type!==r.Fragment&&(l.ref=o?Se(o,u):u),r.cloneElement(a,l)}return r.Children.count(a)>1?r.Children.only(null):null});return n.displayName=`${t}.SlotClone`,n}var Gn=Symbol("radix.slottable");function Vn(t){return r.isValidElement(t)&&typeof t.type=="function"&&"__radixId"in t.type&&t.type.__radixId===Gn}function Bn(t,n){const s={...n};for(const o in n){const a=t[o],i=n[o];/^on[A-Z]/.test(o)?a&&i?s[o]=(...l)=>{const g=i(...l);return a(...l),g}:a&&(s[o]=a):o==="style"?s[o]={...a,...i}:o==="className"&&(s[o]=[a,i].filter(Boolean).join(" "))}return{...t,...s}}function Un(t){let n=Object.getOwnPropertyDescriptor(t.props,"ref")?.get,s=n&&"isReactWarning"in n&&n.isReactWarning;return s?t.ref:(n=Object.getOwnPropertyDescriptor(t,"ref")?.get,s=n&&"isReactWarning"in n&&n.isReactWarning,s?t.props.ref:t.props.ref||t.ref)}var Qn=Bt[" useInsertionEffect ".trim().toString()]||$t;function Hn({prop:t,defaultProp:n,onChange:s=()=>{},caller:o}){const[a,i,u]=Wn({defaultProp:n,onChange:s}),l=t!==void 0,g=l?t:a;{const p=r.useRef(t!==void 0);r.useEffect(()=>{const h=p.current;h!==l&&console.warn(`${o} is changing from ${h?"controlled":"uncontrolled"} to ${l?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),p.current=l},[l,o])}const m=r.useCallback(p=>{if(l){const h=Yn(p)?p(t):p;h!==t&&u.current?.(h)}else i(p)},[l,t,i,u]);return[g,m]}function Wn({defaultProp:t,onChange:n}){const[s,o]=r.useState(t),a=r.useRef(s),i=r.useRef(n);return Qn(()=>{i.current=n},[n]),r.useEffect(()=>{a.current!==s&&(i.current?.(s),a.current=s)},[s,a]),[s,o,i]}function Yn(t){return typeof t=="function"}var tt="Popover",[ss]=vt(tt,[qt]),Ue=qt(),[Jn,xe]=ss(tt),ns=t=>{const{__scopePopover:n,children:s,open:o,defaultOpen:a,onOpenChange:i,modal:u=!1}=t,l=Ue(n),g=r.useRef(null),[m,p]=r.useState(!1),[h,f]=Hn({prop:o,defaultProp:a??!1,onChange:i,caller:tt});return e.jsx(Vs,{...l,children:e.jsx(Jn,{scope:n,contentId:ge(),triggerRef:g,open:h,onOpenChange:f,onOpenToggle:r.useCallback(()=>f(x=>!x),[f]),hasCustomAnchor:m,onCustomAnchorAdd:r.useCallback(()=>p(!0),[]),onCustomAnchorRemove:r.useCallback(()=>p(!1),[]),modal:u,children:s})})};ns.displayName=tt;var rs="PopoverAnchor",Xn=r.forwardRef((t,n)=>{const{__scopePopover:s,...o}=t,a=xe(rs,s),i=Ue(s),{onCustomAnchorAdd:u,onCustomAnchorRemove:l}=a;return r.useEffect(()=>(u(),()=>l()),[u,l]),e.jsx(zt,{...i,...o,ref:n})});Xn.displayName=rs;var as="PopoverTrigger",os=r.forwardRef((t,n)=>{const{__scopePopover:s,...o}=t,a=xe(as,s),i=Ue(s),u=Ve(n,a.triggerRef),l=e.jsx(ae.button,{type:"button","aria-haspopup":"dialog","aria-expanded":a.open,"aria-controls":a.contentId,"data-state":us(a.open),...o,ref:u,onClick:$e(t.onClick,a.onOpenToggle)});return a.hasCustomAnchor?l:e.jsx(zt,{asChild:!0,...i,children:l})});os.displayName=as;var Nt="PopoverPortal",[Zn,er]=ss(Nt,{forceMount:void 0}),is=t=>{const{__scopePopover:n,forceMount:s,children:o,container:a}=t,i=xe(Nt,n);return e.jsx(Zn,{scope:n,forceMount:s,children:e.jsx(jt,{present:s||i.open,children:e.jsx(Bs,{asChild:!0,container:a,children:o})})})};is.displayName=Nt;var Fe="PopoverContent",ls=r.forwardRef((t,n)=>{const s=er(Fe,t.__scopePopover),{forceMount:o=s.forceMount,...a}=t,i=xe(Fe,t.__scopePopover);return e.jsx(jt,{present:o||i.open,children:i.modal?e.jsx(sr,{...a,ref:n}):e.jsx(nr,{...a,ref:n})})});ls.displayName=Fe;var tr=Ln("PopoverContent.RemoveScroll"),sr=r.forwardRef((t,n)=>{const s=xe(Fe,t.__scopePopover),o=r.useRef(null),a=Ve(n,o),i=r.useRef(!1);return r.useEffect(()=>{const u=o.current;if(u)return sn(u)},[]),e.jsx(nn,{as:tr,allowPinchZoom:!0,children:e.jsx(cs,{...t,ref:a,trapFocus:s.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:$e(t.onCloseAutoFocus,u=>{u.preventDefault(),i.current||s.triggerRef.current?.focus()}),onPointerDownOutside:$e(t.onPointerDownOutside,u=>{const l=u.detail.originalEvent,g=l.button===0&&l.ctrlKey===!0,m=l.button===2||g;i.current=m},{checkForDefaultPrevented:!1}),onFocusOutside:$e(t.onFocusOutside,u=>u.preventDefault(),{checkForDefaultPrevented:!1})})})}),nr=r.forwardRef((t,n)=>{const s=xe(Fe,t.__scopePopover),o=r.useRef(!1),a=r.useRef(!1);return e.jsx(cs,{...t,ref:n,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:i=>{t.onCloseAutoFocus?.(i),i.defaultPrevented||(o.current||s.triggerRef.current?.focus(),i.preventDefault()),o.current=!1,a.current=!1},onInteractOutside:i=>{t.onInteractOutside?.(i),i.defaultPrevented||(o.current=!0,i.detail.originalEvent.type==="pointerdown"&&(a.current=!0));const u=i.target;s.triggerRef.current?.contains(u)&&i.preventDefault(),i.detail.originalEvent.type==="focusin"&&a.current&&i.preventDefault()}})}),cs=r.forwardRef((t,n)=>{const{__scopePopover:s,trapFocus:o,onOpenAutoFocus:a,onCloseAutoFocus:i,disableOutsidePointerEvents:u,onEscapeKeyDown:l,onPointerDownOutside:g,onFocusOutside:m,onInteractOutside:p,...h}=t,f=xe(Fe,s),x=Ue(s);return rn(),e.jsx(an,{asChild:!0,loop:!0,trapped:o,onMountAutoFocus:a,onUnmountAutoFocus:i,children:e.jsx(Us,{asChild:!0,disableOutsidePointerEvents:u,onInteractOutside:p,onEscapeKeyDown:l,onPointerDownOutside:g,onFocusOutside:m,onDismiss:()=>f.onOpenChange(!1),children:e.jsx(Qs,{"data-state":us(f.open),role:"dialog",id:f.contentId,...x,...h,ref:n,style:{...h.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}})})})}),ds="PopoverClose",rr=r.forwardRef((t,n)=>{const{__scopePopover:s,...o}=t,a=xe(ds,s);return e.jsx(ae.button,{type:"button",...o,ref:n,onClick:$e(t.onClick,()=>a.onOpenChange(!1))})});rr.displayName=ds;var ar="PopoverArrow",or=r.forwardRef((t,n)=>{const{__scopePopover:s,...o}=t,a=Ue(s);return e.jsx(Hs,{...a,...o,ref:n})});or.displayName=ar;function us(t){return t?"open":"closed"}var ir=ns,lr=os,cr=is,ms=ls;const dr=ir,ur=lr,ps=r.forwardRef(({className:t,align:n="center",sideOffset:s=4,...o},a)=>e.jsx(cr,{children:e.jsx(ms,{ref:a,align:n,sideOffset:s,className:X("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-popover-content-transform-origin]",t),...o})}));ps.displayName=ms.displayName;var Rt=1,mr=.9,pr=.8,hr=.17,rt=.1,at=.999,xr=.9999,gr=.99,fr=/[\\\/_+.#"@\[\(\{&]/,vr=/[\\\/_+.#"@\[\(\{&]/g,jr=/[\s-]/,hs=/[\s-]/g;function mt(t,n,s,o,a,i,u){if(i===n.length)return a===t.length?Rt:gr;var l=`${a},${i}`;if(u[l]!==void 0)return u[l];for(var g=o.charAt(i),m=s.indexOf(g,a),p=0,h,f,x,c;m>=0;)h=mt(t,n,s,o,m+1,i+1,u),h>p&&(m===a?h*=Rt:fr.test(t.charAt(m-1))?(h*=pr,x=t.slice(a,m-1).match(vr),x&&a>0&&(h*=Math.pow(at,x.length))):jr.test(t.charAt(m-1))?(h*=mr,c=t.slice(a,m-1).match(hs),c&&a>0&&(h*=Math.pow(at,c.length))):(h*=hr,a>0&&(h*=Math.pow(at,m-a))),t.charAt(m)!==n.charAt(i)&&(h*=xr)),(h<rt&&s.charAt(m-1)===o.charAt(i+1)||o.charAt(i+1)===o.charAt(i)&&s.charAt(m-1)!==o.charAt(i))&&(f=mt(t,n,s,o,m+1,i+2,u),f*rt>h&&(h=f*rt)),h>p&&(p=h),m=s.indexOf(g,m+1);return u[l]=p,p}function Dt(t){return t.toLowerCase().replace(hs," ")}function br(t,n,s){return t=s&&s.length>0?`${t+" "+s.join(" ")}`:t,mt(t,n,Dt(t),Dt(n),0,0,{})}var Oe='[cmdk-group=""]',ot='[cmdk-group-items=""]',yr='[cmdk-group-heading=""]',xs='[cmdk-item=""]',Pt=`${xs}:not([aria-disabled="true"])`,pt="cmdk-item-select",we="data-value",Nr=(t,n,s)=>br(t,n,s),gs=r.createContext(void 0),Qe=()=>r.useContext(gs),fs=r.createContext(void 0),wt=()=>r.useContext(fs),vs=r.createContext(void 0),js=r.forwardRef((t,n)=>{let s=Ce(()=>{var j,R;return{search:"",value:(R=(j=t.value)!=null?j:t.defaultValue)!=null?R:"",selectedItemId:void 0,filtered:{count:0,items:new Map,groups:new Set}}}),o=Ce(()=>new Set),a=Ce(()=>new Map),i=Ce(()=>new Map),u=Ce(()=>new Set),l=bs(t),{label:g,children:m,value:p,onValueChange:h,filter:f,shouldFilter:x,loop:c,disablePointerSelection:v=!1,vimBindings:C=!0,...b}=t,y=ge(),F=ge(),z=ge(),P=r.useRef(null),_=Pr();fe(()=>{if(p!==void 0){let j=p.trim();s.current.value=j,E.emit()}},[p]),fe(()=>{_(6,q)},[]);let E=r.useMemo(()=>({subscribe:j=>(u.current.add(j),()=>u.current.delete(j)),snapshot:()=>s.current,setState:(j,R,k)=>{var A,K,U,Z;if(!Object.is(s.current[j],R)){if(s.current[j]=R,j==="search")V(),T(),_(1,$);else if(j==="value"){if(document.activeElement.hasAttribute("cmdk-input")||document.activeElement.hasAttribute("cmdk-root")){let ee=document.getElementById(z);ee?ee.focus():(A=document.getElementById(y))==null||A.focus()}if(_(7,()=>{var ee;s.current.selectedItemId=(ee=S())==null?void 0:ee.id,E.emit()}),k||_(5,q),((K=l.current)==null?void 0:K.value)!==void 0){let ee=R??"";(Z=(U=l.current).onValueChange)==null||Z.call(U,ee);return}}E.emit()}},emit:()=>{u.current.forEach(j=>j())}}),[]),M=r.useMemo(()=>({value:(j,R,k)=>{var A;R!==((A=i.current.get(j))==null?void 0:A.value)&&(i.current.set(j,{value:R,keywords:k}),s.current.filtered.items.set(j,w(R,k)),_(2,()=>{T(),E.emit()}))},item:(j,R)=>(o.current.add(j),R&&(a.current.has(R)?a.current.get(R).add(j):a.current.set(R,new Set([j]))),_(3,()=>{V(),T(),s.current.value||$(),E.emit()}),()=>{i.current.delete(j),o.current.delete(j),s.current.filtered.items.delete(j);let k=S();_(4,()=>{V(),k?.getAttribute("id")===j&&$(),E.emit()})}),group:j=>(a.current.has(j)||a.current.set(j,new Set),()=>{i.current.delete(j),a.current.delete(j)}),filter:()=>l.current.shouldFilter,label:g||t["aria-label"],getDisablePointerSelection:()=>l.current.disablePointerSelection,listId:y,inputId:z,labelId:F,listInnerRef:P}),[]);function w(j,R){var k,A;let K=(A=(k=l.current)==null?void 0:k.filter)!=null?A:Nr;return j?K(j,s.current.search,R):0}function T(){if(!s.current.search||l.current.shouldFilter===!1)return;let j=s.current.filtered.items,R=[];s.current.filtered.groups.forEach(A=>{let K=a.current.get(A),U=0;K.forEach(Z=>{let ee=j.get(Z);U=Math.max(ee,U)}),R.push([A,U])});let k=P.current;d().sort((A,K)=>{var U,Z;let ee=A.getAttribute("id"),He=K.getAttribute("id");return((U=j.get(He))!=null?U:0)-((Z=j.get(ee))!=null?Z:0)}).forEach(A=>{let K=A.closest(ot);K?K.appendChild(A.parentElement===K?A:A.closest(`${ot} > *`)):k.appendChild(A.parentElement===k?A:A.closest(`${ot} > *`))}),R.sort((A,K)=>K[1]-A[1]).forEach(A=>{var K;let U=(K=P.current)==null?void 0:K.querySelector(`${Oe}[${we}="${encodeURIComponent(A[0])}"]`);U?.parentElement.appendChild(U)})}function $(){let j=d().find(k=>k.getAttribute("aria-disabled")!=="true"),R=j?.getAttribute(we);E.setState("value",R||void 0)}function V(){var j,R,k,A;if(!s.current.search||l.current.shouldFilter===!1){s.current.filtered.count=o.current.size;return}s.current.filtered.groups=new Set;let K=0;for(let U of o.current){let Z=(R=(j=i.current.get(U))==null?void 0:j.value)!=null?R:"",ee=(A=(k=i.current.get(U))==null?void 0:k.keywords)!=null?A:[],He=w(Z,ee);s.current.filtered.items.set(U,He),He>0&&K++}for(let[U,Z]of a.current)for(let ee of Z)if(s.current.filtered.items.get(ee)>0){s.current.filtered.groups.add(U);break}s.current.filtered.count=K}function q(){var j,R,k;let A=S();A&&(((j=A.parentElement)==null?void 0:j.firstChild)===A&&((k=(R=A.closest(Oe))==null?void 0:R.querySelector(yr))==null||k.scrollIntoView({block:"nearest"})),A.scrollIntoView({block:"nearest"}))}function S(){var j;return(j=P.current)==null?void 0:j.querySelector(`${xs}[aria-selected="true"]`)}function d(){var j;return Array.from(((j=P.current)==null?void 0:j.querySelectorAll(Pt))||[])}function N(j){let R=d()[j];R&&E.setState("value",R.getAttribute(we))}function I(j){var R;let k=S(),A=d(),K=A.findIndex(Z=>Z===k),U=A[K+j];(R=l.current)!=null&&R.loop&&(U=K+j<0?A[A.length-1]:K+j===A.length?A[0]:A[K+j]),U&&E.setState("value",U.getAttribute(we))}function G(j){let R=S(),k=R?.closest(Oe),A;for(;k&&!A;)k=j>0?Rr(k,Oe):Dr(k,Oe),A=k?.querySelector(Pt);A?E.setState("value",A.getAttribute(we)):I(j)}let J=()=>N(d().length-1),D=j=>{j.preventDefault(),j.metaKey?J():j.altKey?G(1):I(1)},Y=j=>{j.preventDefault(),j.metaKey?N(0):j.altKey?G(-1):I(-1)};return r.createElement(ae.div,{ref:n,tabIndex:-1,...b,"cmdk-root":"",onKeyDown:j=>{var R;(R=b.onKeyDown)==null||R.call(b,j);let k=j.nativeEvent.isComposing||j.keyCode===229;if(!(j.defaultPrevented||k))switch(j.key){case"n":case"j":{C&&j.ctrlKey&&D(j);break}case"ArrowDown":{D(j);break}case"p":case"k":{C&&j.ctrlKey&&Y(j);break}case"ArrowUp":{Y(j);break}case"Home":{j.preventDefault(),N(0);break}case"End":{j.preventDefault(),J();break}case"Enter":{j.preventDefault();let A=S();if(A){let K=new Event(pt);A.dispatchEvent(K)}}}}},r.createElement("label",{"cmdk-label":"",htmlFor:M.inputId,id:M.labelId,style:Ir},g),st(t,j=>r.createElement(fs.Provider,{value:E},r.createElement(gs.Provider,{value:M},j))))}),wr=r.forwardRef((t,n)=>{var s,o;let a=ge(),i=r.useRef(null),u=r.useContext(vs),l=Qe(),g=bs(t),m=(o=(s=g.current)==null?void 0:s.forceMount)!=null?o:u?.forceMount;fe(()=>{if(!m)return l.item(a,u?.id)},[m]);let p=ys(a,i,[t.value,t.children,i],t.keywords),h=wt(),f=pe(_=>_.value&&_.value===p.current),x=pe(_=>m||l.filter()===!1?!0:_.search?_.filtered.items.get(a)>0:!0);r.useEffect(()=>{let _=i.current;if(!(!_||t.disabled))return _.addEventListener(pt,c),()=>_.removeEventListener(pt,c)},[x,t.onSelect,t.disabled]);function c(){var _,E;v(),(E=(_=g.current).onSelect)==null||E.call(_,p.current)}function v(){h.setState("value",p.current,!0)}if(!x)return null;let{disabled:C,value:b,onSelect:y,forceMount:F,keywords:z,...P}=t;return r.createElement(ae.div,{ref:Se(i,n),...P,id:a,"cmdk-item":"",role:"option","aria-disabled":!!C,"aria-selected":!!f,"data-disabled":!!C,"data-selected":!!f,onPointerMove:C||l.getDisablePointerSelection()?void 0:v,onClick:C?void 0:c},t.children)}),Cr=r.forwardRef((t,n)=>{let{heading:s,children:o,forceMount:a,...i}=t,u=ge(),l=r.useRef(null),g=r.useRef(null),m=ge(),p=Qe(),h=pe(x=>a||p.filter()===!1?!0:x.search?x.filtered.groups.has(u):!0);fe(()=>p.group(u),[]),ys(u,l,[t.value,t.heading,g]);let f=r.useMemo(()=>({id:u,forceMount:a}),[a]);return r.createElement(ae.div,{ref:Se(l,n),...i,"cmdk-group":"",role:"presentation",hidden:h?void 0:!0},s&&r.createElement("div",{ref:g,"cmdk-group-heading":"","aria-hidden":!0,id:m},s),st(t,x=>r.createElement("div",{"cmdk-group-items":"",role:"group","aria-labelledby":s?m:void 0},r.createElement(vs.Provider,{value:f},x))))}),Sr=r.forwardRef((t,n)=>{let{alwaysRender:s,...o}=t,a=r.useRef(null),i=pe(u=>!u.search);return!s&&!i?null:r.createElement(ae.div,{ref:Se(a,n),...o,"cmdk-separator":"",role:"separator"})}),_r=r.forwardRef((t,n)=>{let{onValueChange:s,...o}=t,a=t.value!=null,i=wt(),u=pe(m=>m.search),l=pe(m=>m.selectedItemId),g=Qe();return r.useEffect(()=>{t.value!=null&&i.setState("search",t.value)},[t.value]),r.createElement(ae.input,{ref:n,...o,"cmdk-input":"",autoComplete:"off",autoCorrect:"off",spellCheck:!1,"aria-autocomplete":"list",role:"combobox","aria-expanded":!0,"aria-controls":g.listId,"aria-labelledby":g.labelId,"aria-activedescendant":l,id:g.inputId,type:"text",value:a?t.value:u,onChange:m=>{a||i.setState("search",m.target.value),s?.(m.target.value)}})}),kr=r.forwardRef((t,n)=>{let{children:s,label:o="Suggestions",...a}=t,i=r.useRef(null),u=r.useRef(null),l=pe(m=>m.selectedItemId),g=Qe();return r.useEffect(()=>{if(u.current&&i.current){let m=u.current,p=i.current,h,f=new ResizeObserver(()=>{h=requestAnimationFrame(()=>{let x=m.offsetHeight;p.style.setProperty("--cmdk-list-height",x.toFixed(1)+"px")})});return f.observe(m),()=>{cancelAnimationFrame(h),f.unobserve(m)}}},[]),r.createElement(ae.div,{ref:Se(i,n),...a,"cmdk-list":"",role:"listbox",tabIndex:-1,"aria-activedescendant":l,"aria-label":o,id:g.listId},st(t,m=>r.createElement("div",{ref:Se(u,g.listInnerRef),"cmdk-list-sizer":""},m)))}),Mr=r.forwardRef((t,n)=>{let{open:s,onOpenChange:o,overlayClassName:a,contentClassName:i,container:u,...l}=t;return r.createElement(on,{open:s,onOpenChange:o},r.createElement(ln,{container:u},r.createElement(cn,{"cmdk-overlay":"",className:a}),r.createElement(dn,{"aria-label":t.label,"cmdk-dialog":"",className:i},r.createElement(js,{ref:n,...l}))))}),Ar=r.forwardRef((t,n)=>pe(s=>s.filtered.count===0)?r.createElement(ae.div,{ref:n,...t,"cmdk-empty":"",role:"presentation"}):null),Er=r.forwardRef((t,n)=>{let{progress:s,children:o,label:a="Loading...",...i}=t;return r.createElement(ae.div,{ref:n,...i,"cmdk-loading":"",role:"progressbar","aria-valuenow":s,"aria-valuemin":0,"aria-valuemax":100,"aria-label":a},st(t,u=>r.createElement("div",{"aria-hidden":!0},u)))}),oe=Object.assign(js,{List:kr,Item:wr,Input:_r,Group:Cr,Separator:Sr,Dialog:Mr,Empty:Ar,Loading:Er});function Rr(t,n){let s=t.nextElementSibling;for(;s;){if(s.matches(n))return s;s=s.nextElementSibling}}function Dr(t,n){let s=t.previousElementSibling;for(;s;){if(s.matches(n))return s;s=s.previousElementSibling}}function bs(t){let n=r.useRef(t);return fe(()=>{n.current=t}),n}var fe=typeof window>"u"?r.useEffect:r.useLayoutEffect;function Ce(t){let n=r.useRef();return n.current===void 0&&(n.current=t()),n}function pe(t){let n=wt(),s=()=>t(n.snapshot());return r.useSyncExternalStore(n.subscribe,s,s)}function ys(t,n,s,o=[]){let a=r.useRef(),i=Qe();return fe(()=>{var u;let l=(()=>{var m;for(let p of s){if(typeof p=="string")return p.trim();if(typeof p=="object"&&"current"in p)return p.current?(m=p.current.textContent)==null?void 0:m.trim():a.current}})(),g=o.map(m=>m.trim());i.value(t,l,g),(u=n.current)==null||u.setAttribute(we,l),a.current=l}),a}var Pr=()=>{let[t,n]=r.useState(),s=Ce(()=>new Map);return fe(()=>{s.current.forEach(o=>o()),s.current=new Map},[t]),(o,a)=>{s.current.set(o,a),n({})}};function Fr(t){let n=t.type;return typeof n=="function"?n(t.props):"render"in n?n.render(t.props):t}function st({asChild:t,children:n},s){return t&&r.isValidElement(n)?r.cloneElement(Fr(n),{ref:n.ref},s(n.props.children)):s(n)}var Ir={position:"absolute",width:"1px",height:"1px",padding:"0",margin:"-1px",overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",borderWidth:"0"};const Ns=r.forwardRef(({className:t,...n},s)=>e.jsx(oe,{ref:s,className:X("flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground",t),...n}));Ns.displayName=oe.displayName;const ws=r.forwardRef(({className:t,...n},s)=>e.jsxs("div",{className:"flex items-center border-b px-3","cmdk-input-wrapper":"",children:[e.jsx(un,{className:"mr-2 h-4 w-4 shrink-0 opacity-50"}),e.jsx(oe.Input,{ref:s,className:X("flex h-10 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50",t),...n})]}));ws.displayName=oe.Input.displayName;const Cs=r.forwardRef(({className:t,...n},s)=>e.jsx(oe.List,{ref:s,className:X("max-h-[300px] overflow-y-auto overflow-x-hidden",t),...n}));Cs.displayName=oe.List.displayName;const Ss=r.forwardRef((t,n)=>e.jsx(oe.Empty,{ref:n,className:"py-6 text-center text-sm",...t}));Ss.displayName=oe.Empty.displayName;const ht=r.forwardRef(({className:t,...n},s)=>e.jsx(oe.Group,{ref:s,className:X("overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground",t),...n}));ht.displayName=oe.Group.displayName;const Tr=r.forwardRef(({className:t,...n},s)=>e.jsx(oe.Separator,{ref:s,className:X("-mx-1 h-px bg-border",t),...n}));Tr.displayName=oe.Separator.displayName;const xt=r.forwardRef(({className:t,...n},s)=>e.jsx(oe.Item,{ref:s,className:X("relative flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected=true]:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",t),...n}));xt.displayName=oe.Item.displayName;const Or=({onBack:t,athletes:n,groups:s,athletesLoading:o})=>{const{toast:a}=le(),[i,u]=r.useState(""),[l,g]=r.useState(new Set),[m,p]=r.useState(new Set),[h,f]=r.useState(!1),{data:x}=Q({queryKey:["athlete-phones"],queryFn:async()=>{const{data:w}=await Lt.from("user_profiles").select("user_id, phone").not("phone","is",null);return new Map((w??[]).map(T=>[T.user_id,T.phone]))}}),c=r.useMemo(()=>n.filter(w=>w.id!=null).map(w=>({id:w.id,display_name:w.display_name,group_id:w.group_id??null,group_label:w.group_label??null})),[n]),v=w=>{g(T=>{const $=new Set(T);return $.has(w)?$.delete(w):$.add(w),$})},C=w=>{p(T=>{const $=new Set(T);return $.has(w)?$.delete(w):$.add(w),$})},b=()=>{g(new Set),p(new Set)},{selectedPhones:y,selectedTotal:F,missingCount:z}=r.useMemo(()=>{if(!x)return{selectedPhones:[],selectedTotal:0,missingCount:0};const w=new Set;for(const V of l)for(const q of c)q.group_id===V&&w.add(q.id);for(const V of m)w.add(V);const T=w.size,$=[];for(const V of w){const q=x.get(V);q&&q.trim().length>0&&$.push(q)}return{selectedPhones:$,selectedTotal:T,missingCount:T-$.length}},[l,m,c,x]),P=l.size+m.size,_=r.useMemo(()=>{const w=[];return l.size>0&&w.push(`${l.size} groupe${l.size>1?"s":""}`),m.size>0&&w.push(`${m.size} nageur${m.size>1?"s":""}`),w.join(", ")},[l.size,m.size]),E=()=>{if(y.length===0){a({title:"Aucun numéro",description:"Aucun nageur avec un numéro de téléphone dans cette sélection.",variant:"destructive"});return}if(/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)){const T=i.trim()?encodeURIComponent(i.trim()):"",$=/iPhone|iPad|iPod/i.test(navigator.userAgent);let V;if($){const q=y.join(",");V=T?`sms:/open?addresses=${q}&body=${T}`:`sms:/open?addresses=${q}`}else V=T?`sms:${y.join(",")}?body=${T}`:`sms:${y.join(",")}`;window.location.href=V}else navigator.clipboard.writeText(y.join(", ")).then(()=>{a({title:"Numéros copiés",description:`${y.length} numéro${y.length>1?"s":""} copié${y.length>1?"s":""} dans le presse-papiers.`})}).catch(()=>{a({title:"Erreur",description:"Impossible de copier les numéros.",variant:"destructive"})})},M=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent);return e.jsxs("div",{className:"space-y-6 pb-24",children:[e.jsx(me,{title:"Envoyer un SMS",description:"Ouvre votre application SMS ou copie les numéros.",onBack:t}),e.jsxs(qe,{className:"border-l-4 border-l-primary",children:[e.jsxs(ze,{children:[e.jsx(Le,{children:"Destinataires"}),e.jsx(Ke,{children:"Sélectionnez des groupes et/ou des nageurs."})]}),e.jsxs(Ge,{className:"space-y-3",children:[e.jsx(B,{children:"Destinataires"}),e.jsxs(dr,{open:h,onOpenChange:f,children:[e.jsx(ur,{asChild:!0,children:e.jsxs(L,{variant:"outline",role:"combobox","aria-expanded":h,className:"w-full justify-between font-normal",children:[e.jsx("span",{className:"truncate",children:P>0?_:o?"Chargement...":"Choisir des destinataires"}),e.jsx(Rn,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),e.jsx(ps,{className:"w-[var(--radix-popover-trigger-width)] p-0",align:"start",children:e.jsxs(Ns,{children:[e.jsx(ws,{placeholder:"Rechercher..."}),e.jsxs(Cs,{children:[e.jsx(Ss,{children:"Aucun résultat."}),s.length>0&&e.jsx(ht,{heading:"Groupes",children:s.map(w=>e.jsxs(xt,{value:`groupe ${w.name}`,onSelect:()=>v(w.id),children:[e.jsx(Et,{className:X("mr-2 h-4 w-4",l.has(w.id)?"opacity-100":"opacity-0")}),w.name]},`group:${w.id}`))}),c.length>0&&e.jsx(ht,{heading:"Nageurs",children:c.map(w=>e.jsxs(xt,{value:`nageur ${w.display_name} ${w.group_label??""}`,onSelect:()=>C(w.id),children:[e.jsx(Et,{className:X("mr-2 h-4 w-4",m.has(w.id)?"opacity-100":"opacity-0")}),e.jsx("span",{className:"truncate",children:w.display_name}),w.group_label&&e.jsx("span",{className:"ml-auto text-xs text-muted-foreground",children:w.group_label})]},`user:${w.id}`))})]})]})})]}),P>0&&e.jsxs("div",{className:"flex flex-wrap items-center gap-1.5",children:[[...l].map(w=>{const T=s.find($=>$.id===w);return T?e.jsxs(ie,{variant:"secondary",className:"gap-1 pr-1",children:[T.name,e.jsx("button",{type:"button",onClick:()=>v(w),className:"ml-0.5 rounded-full p-0.5 hover:bg-muted",children:e.jsx(St,{className:"h-3 w-3"})})]},`g:${w}`):null}),[...m].map(w=>{const T=c.find($=>$.id===w);return T?e.jsxs(ie,{variant:"outline",className:"gap-1 pr-1",children:[T.display_name,e.jsx("button",{type:"button",onClick:()=>C(w),className:"ml-0.5 rounded-full p-0.5 hover:bg-muted",children:e.jsx(St,{className:"h-3 w-3"})})]},`u:${w}`):null}),P>1&&e.jsx("button",{type:"button",onClick:b,className:"text-xs text-muted-foreground underline hover:text-foreground",children:"Tout effacer"})]}),P>0&&y.length>0&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:[y.length," numéro",y.length>1?"s":""," trouvé",y.length>1?"s":"",z>0&&e.jsxs("span",{className:"text-destructive",children:[" · ",z," sans téléphone"]})]}),P>0&&y.length===0&&e.jsx("p",{className:"text-xs text-destructive",children:"Aucun numéro de téléphone disponible pour cette sélection."})]})]}),e.jsxs(qe,{children:[e.jsxs(ze,{children:[e.jsx(Le,{children:"Message"}),e.jsx(Ke,{children:"Optionnel — pré-rempli dans votre application SMS."})]}),e.jsx(Ge,{children:e.jsx(bt,{value:i,onChange:w=>u(w.target.value),placeholder:"Contenu du SMS…",rows:3})})]}),e.jsx("div",{className:"sticky bottom-0 z-10 -mx-4 border-t bg-background/95 p-4 backdrop-blur sm:static sm:mx-0 sm:border-0 sm:p-0",children:e.jsx(L,{className:"w-full sm:w-auto",onClick:E,disabled:P===0||y.length===0,children:M?e.jsxs(e.Fragment,{children:[e.jsx(Ut,{className:"mr-2 h-4 w-4"}),"Ouvrir dans l'app SMS",e.jsx(Zt,{className:"ml-2 h-3 w-3"})]}):e.jsxs(e.Fragment,{children:[e.jsx(mn,{className:"mr-2 h-4 w-4"}),"Copier les numéros"]})})})]})};function Ft(t){return String(t).padStart(2,"0")}function Ne(t){return`${t.getFullYear()}-${Ft(t.getMonth()+1)}-${Ft(t.getDate())}`}function it(t){return new Date(t.getFullYear(),t.getMonth(),1)}function It(t,n){const s=new Date(t);return s.setDate(s.getDate()+n),s}function $r(t){return(t.getDay()+6)%7}function lt(t){if(!t)return"AM";const n=t.toLowerCase();return n==="evening"||n.includes("soir")||n==="pm"?"PM":"AM"}const qr=[{key:"swim-morning",label:"Nage — Matin",type:"swim",scheduledSlot:"morning"},{key:"swim-evening",label:"Nage — Soir",type:"swim",scheduledSlot:"evening"},{key:"strength",label:"Musculation",type:"strength",scheduledSlot:null}];function zr({groupId:t,userId:n,enabled:s}){const o=r.useMemo(()=>new Date,[]),[a,i]=r.useState(()=>it(new Date)),[u,l]=r.useState(()=>Ne(new Date)),[g,m]=r.useState(null),[p,h]=r.useState(!1),f=r.useMemo(()=>it(a),[a]),x=r.useMemo(()=>{const d=$r(f),N=It(f,-d),I=[];for(let G=0;G<42;G++)I.push(It(N,G));return I},[f]),c=r.useMemo(()=>{const d=Ne(x[0]),N=Ne(x[x.length-1]);return{from:d,to:N}},[x]),v=!!(t||n),{data:C=[],isLoading:b}=Q({queryKey:["coach-calendar-assignments",t,n,c.from,c.to],queryFn:()=>O.getCoachAssignments({groupId:t??null,userId:n??null,from:c.from,to:c.to}),enabled:v}),y=r.useMemo(()=>{const d=new Map;for(const N of C){const I=N.scheduledDate?.slice(0,10);I&&(d.has(I)||d.set(I,[]),d.get(I).push(N))}return d},[C]),F=r.useMemo(()=>{const d={};for(const N of x){const I=Ne(N),G=y.get(I)??[],J=G.some(R=>lt(R.scheduledSlot)==="AM"),D=G.some(R=>lt(R.scheduledSlot)==="PM"),Y=(J?1:0)+(D?1:0),j=[{slotKey:"AM",expected:J,completed:J,absent:!1},{slotKey:"PM",expected:D,completed:D,absent:!1}];d[I]={completed:Y,total:Y,slots:j}}return d},[x,y]),z=r.useMemo(()=>{const[d,N,I]=u.split("-").map(Number);return new Date(d,N-1,I)},[u]),P=r.useMemo(()=>y.get(u)??[],[y,u]),_=r.useMemo(()=>{const d=P;return qr.map(N=>{const I=d.filter(D=>N.type!==D.type?!1:N.type==="swim"?lt(D.scheduledSlot)===(N.scheduledSlot==="morning"?"AM":"PM"):!0),G=I.find(D=>D.targetType==="user"),J=I.find(D=>D.targetType==="group");return{...N,assignment:G??J??null}})},[P]),{data:E=[]}=Q({queryKey:["planned-absences-coach",n,c.from,c.to],queryFn:()=>O.getPlannedAbsences({userId:n,from:c.from,to:c.to}),enabled:!!n}),M=r.useMemo(()=>new Set(E.map(d=>d.date)),[E]),w=r.useMemo(()=>{const d={};for(const N of x){const I=Ne(N),G=y.get(I)??[];d[I]=G.some(J=>J.type==="strength")}return d},[x,y]),T=F[u]??{completed:0,total:0,slots:[{slotKey:"AM",expected:!1,completed:!1,absent:!1},{slotKey:"PM",expected:!1,completed:!1,absent:!1}]},$=r.useCallback(()=>{i(d=>new Date(d.getFullYear(),d.getMonth()-1,1))},[]),V=r.useCallback(()=>{i(d=>new Date(d.getFullYear(),d.getMonth()+1,1))},[]),q=r.useCallback(()=>{i(it(new Date)),l(Ne(new Date))},[]),S=r.useCallback(d=>{l(d),h(!0)},[]);return{today:o,monthCursor:a,selectedISO:u,selectedDayIndex:g,drawerOpen:p,gridDates:x,completionByISO:F,selectedDate:z,selectedDayStatus:T,assignmentsForSelectedDay:P,slotsForSelectedDay:_,hasStrengthByISO:w,absenceDates:M,isLoading:b,hasFilter:v,setSelectedISO:l,setSelectedDayIndex:m,setDrawerOpen:h,prevMonth:$,nextMonth:V,jumpToday:q,openDay:S}}function Lr(t){const[n,s,o]=t.split("-").map(Number);return new Date(n,s-1,o).toLocaleDateString("fr-FR",{weekday:"long",day:"numeric",month:"long"})}function Kr({onBack:t,athletes:n,groups:s,swimSessions:o,strengthSessions:a}){const[i,u]=r.useState("group"),[l,g]=r.useState(""),[m,p]=r.useState(""),h=i==="group"&&l?Number(l):null,f=i==="user"&&m?Number(m):null,{today:x,monthCursor:c,selectedISO:v,selectedDayIndex:C,drawerOpen:b,gridDates:y,completionByISO:F,selectedDayStatus:z,slotsForSelectedDay:P,hasStrengthByISO:_,absenceDates:E,hasFilter:M,setSelectedISO:w,setSelectedDayIndex:T,setDrawerOpen:$,prevMonth:V,nextMonth:q,jumpToday:S,openDay:d}=zr({groupId:h,userId:f,enabled:!0}),N=he(),I=W({mutationFn:D=>O.assignments_create(D),onSuccess:()=>{N.invalidateQueries({queryKey:["coach-calendar-assignments"]})}}),G=W({mutationFn:D=>O.assignments_delete(D),onSuccess:()=>{N.invalidateQueries({queryKey:["coach-calendar-assignments"]})}}),J=(D,Y)=>{let j=Y;if(D.key==="ArrowLeft"&&(j=Math.max(0,Y-1)),D.key==="ArrowRight"&&(j=Math.min(y.length-1,Y+1)),D.key==="ArrowUp"&&(j=Math.max(0,Y-7)),D.key==="ArrowDown"&&(j=Math.min(y.length-1,Y+7)),j!==Y){D.preventDefault(),T(j);const R=K=>String(K).padStart(2,"0"),k=y[j],A=`${k.getFullYear()}-${R(k.getMonth()+1)}-${R(k.getDate())}`;w(A)}if(D.key==="Enter"||D.key===" "){D.preventDefault();const R=K=>String(K).padStart(2,"0"),k=y[Y],A=`${k.getFullYear()}-${R(k.getMonth()+1)}-${R(k.getDate())}`;d(A)}};return e.jsxs("div",{className:"space-y-4",children:[e.jsx(me,{title:"Calendrier",description:"Vue mensuelle des assignations",onBack:t}),e.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center",children:[e.jsxs(Ze,{type:"single",value:i,onValueChange:D=>{(D==="group"||D==="user")&&u(D)},className:"shrink-0",children:[e.jsx(ce,{value:"group",className:"text-xs px-3",children:"Groupe"}),e.jsx(ce,{value:"user",className:"text-xs px-3",children:"Nageur"})]}),i==="group"?e.jsxs(te,{value:l,onValueChange:g,children:[e.jsx(se,{className:"w-full sm:w-56",children:e.jsx(ne,{placeholder:"Choisir un groupe"})}),e.jsx(re,{children:s.map(D=>e.jsx(H,{value:String(D.id),children:D.name},String(D.id)))})]}):e.jsxs(te,{value:m,onValueChange:p,children:[e.jsx(se,{className:"w-full sm:w-56",children:e.jsx(ne,{placeholder:"Choisir un nageur"})}),e.jsx(re,{children:n.filter(D=>D.id!=null).map(D=>e.jsxs(H,{value:String(D.id),children:[D.display_name,D.group_label?` · ${D.group_label}`:""]},String(D.id)))})]})]}),M?e.jsxs("div",{className:"rounded-2xl border bg-card shadow-sm",children:[e.jsx(pn,{monthCursor:c,selectedDayStatus:z,onPrevMonth:V,onNextMonth:q,onJumpToday:S}),e.jsx(hn,{monthCursor:c,gridDates:y,completionByISO:F,strengthByISO:_,absenceDates:E,selectedISO:v,selectedDayIndex:C,today:x,onDayClick:d,onKeyDown:J})]}):e.jsx("div",{className:"py-12 text-center text-sm text-muted-foreground",children:"Sélectionnez un groupe ou un nageur pour afficher le calendrier."}),e.jsx(ve,{open:b,onOpenChange:$,children:e.jsxs(je,{side:"bottom",className:"max-h-[70vh] overflow-y-auto rounded-t-2xl",children:[e.jsxs(be,{className:"pb-3",children:[e.jsx(ye,{className:"capitalize text-left",children:Lr(v)}),e.jsx(Be,{className:"sr-only",children:"Gérer les assignations pour cette journée"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(fn,{variant:"red",icon:e.jsx(vn,{}),label:"Absence prévue",visible:E.has(v),animate:!1}),P.map(D=>{const Y=D.assignment?.targetType==="group",j=i==="user";return e.jsx(Gr,{slot:D,swimSessions:o,strengthSessions:a,isGroupAssignment:Y&&j,onAssign:R=>{I.mutate({assignment_type:D.type,session_id:R,scheduled_date:v,scheduled_slot:D.scheduledSlot??void 0,target_group_id:h,target_user_id:f})},onDelete:R=>{G.mutate(R)},onReplace:(R,k)=>{Y&&j?I.mutate({assignment_type:D.type,session_id:k,scheduled_date:v,scheduled_slot:D.scheduledSlot??void 0,target_user_id:f}):G.mutate(R,{onSuccess:()=>{I.mutate({assignment_type:D.type,session_id:k,scheduled_date:v,scheduled_slot:D.scheduledSlot??void 0,target_group_id:h,target_user_id:f})}})},isPending:I.isPending||G.isPending},D.key)})]})]})})]})}function Gr({slot:t,swimSessions:n,strengthSessions:s,isGroupAssignment:o,onAssign:a,onDelete:i,onReplace:u,isPending:l}){const[g,m]=r.useState(!1),p=t.type==="swim",h=p?(n??[]).map(c=>({id:c.id,label:c.name})):(s??[]).map(c=>({id:c.id,label:c.title})),f=t.assignment!==null,x=c=>{const v=Number(c);v&&(f&&g?(u(t.assignment.id,v),m(!1)):a(v))};return e.jsxs("div",{className:"rounded-xl border p-3 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[p?e.jsx(Kt,{className:"h-4 w-4 text-blue-500 shrink-0"}):e.jsx(Gt,{className:"h-4 w-4 text-orange-500 shrink-0"}),e.jsx("span",{className:"text-xs font-semibold text-muted-foreground uppercase tracking-wide",children:t.label})]}),f&&!g?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("p",{className:"text-sm font-semibold truncate flex-1",children:[t.assignment.title,o&&e.jsx("span",{className:"ml-1.5 text-[10px] font-medium text-muted-foreground bg-muted px-1.5 py-0.5 rounded-full align-middle",children:"Groupe"})]}),e.jsx(L,{type:"button",size:"icon",variant:"ghost",className:"h-7 w-7 shrink-0",disabled:l,onClick:()=>m(!0),title:o?"Personnaliser":"Changer",children:e.jsx(Ws,{className:"h-3.5 w-3.5"})}),!o&&e.jsx(L,{type:"button",size:"icon",variant:"ghost",className:"h-7 w-7 shrink-0 text-destructive hover:text-destructive",disabled:l,onClick:()=>i(t.assignment.id),title:"Supprimer",children:e.jsx(et,{className:"h-3.5 w-3.5"})})]}):e.jsxs(te,{value:"",onValueChange:x,disabled:l||h.length===0,children:[e.jsx(se,{className:"h-9 text-xs",children:e.jsx(ne,{placeholder:g?o?"Personnaliser pour ce nageur":"Choisir le remplacement":"Choisir une séance"})}),e.jsx(re,{children:h.map(c=>e.jsx(H,{value:String(c.id),children:c.label},c.id))})]}),g?e.jsx("button",{type:"button",className:"text-xs text-muted-foreground hover:text-foreground",onClick:()=>m(!1),children:"Annuler"}):null]})}const _s=({athletes:t,selected:n,onToggle:s,filterToUserIds:o})=>{const[a,i]=r.useState(""),u=r.useMemo(()=>{let g=t.filter(m=>m.id!=null);if(o&&(g=g.filter(m=>o.has(m.id))),a.trim()){const m=a.toLowerCase();g=g.filter(p=>p.display_name.toLowerCase().includes(m))}return g},[t,o,a]),l=r.useMemo(()=>{const g=new Map;for(const m of u){const p=m.group_label||"Sans groupe";g.has(p)||g.set(p,[]),g.get(p).push(m)}return[...g.entries()].sort(([m],[p])=>m.localeCompare(p,"fr"))},[u]);return e.jsxs("div",{className:"space-y-3",children:[e.jsx(de,{placeholder:"Rechercher un nageur...",value:a,onChange:g=>i(g.target.value)}),e.jsxs("div",{className:"max-h-[50vh] overflow-y-auto space-y-3",children:[l.map(([g,m])=>e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-semibold uppercase tracking-wider text-muted-foreground mb-1.5",children:g}),e.jsx("div",{className:"space-y-1",children:m.map(p=>e.jsxs("label",{className:"flex items-center gap-2.5 rounded-lg border px-3 py-2 cursor-pointer hover:bg-muted/50 transition-colors",children:[e.jsx(Wt,{checked:n.has(p.id),onCheckedChange:()=>s(p.id)}),e.jsx("span",{className:"text-sm",children:p.display_name})]},p.id))})]},g)),l.length===0&&e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"Aucun nageur trouvé."})]}),n.size>0&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:[n.size," nageur",n.size>1?"s":""," ","sélectionné",n.size>1?"s":""]})]})},ks=({open:t,onOpenChange:n,athletes:s,parentGroupId:o,parentMembers:a,onCreated:i})=>{const{toast:u}=le(),[l,g]=r.useState(""),[m,p]=r.useState(new Set),h=c=>{p(v=>{const C=new Set(v);return C.has(c)?C.delete(c):C.add(c),C})},f=W({mutationFn:()=>O.createTemporaryGroup({name:l.trim(),member_user_ids:[...m],parent_group_id:o??void 0}),onSuccess:()=>{u({title:"Groupe créé",description:`Le groupe "${l.trim()}" a été créé avec ${m.size} nageur${m.size>1?"s":""}.`}),g(""),p(new Set),n(!1),i()},onError:c=>{u({title:"Erreur",description:c.message,variant:"destructive"})}}),x=()=>{if(!l.trim()){u({title:"Nom requis",description:"Veuillez saisir un nom pour le groupe.",variant:"destructive"});return}f.mutate()};return e.jsx(ve,{open:t,onOpenChange:n,children:e.jsxs(je,{side:"right",className:"w-full sm:max-w-md overflow-y-auto",children:[e.jsxs(be,{children:[e.jsx(ye,{children:o?"Créer un sous-groupe":"Créer un groupe"}),e.jsx(Be,{children:o?"Sélectionnez des nageurs du groupe parent pour ce sous-groupe.":"Créez un groupe temporaire (stage, compétition) avec des nageurs de différents groupes."})]}),e.jsxs("div",{className:"mt-6 space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(B,{htmlFor:"group-name",children:"Nom du groupe"}),e.jsx(de,{id:"group-name",placeholder:"Ex : Stage Pâques 2026",value:l,onChange:c=>g(c.target.value)})]}),e.jsx(Yt,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(B,{children:"Nageurs"}),e.jsx(_s,{athletes:s,selected:m,onToggle:h,filterToUserIds:a??null})]}),e.jsx(L,{className:"w-full",onClick:x,disabled:f.isPending||!l.trim(),children:f.isPending?"Création...":"Créer le groupe"})]})]})})},Vr=({open:t,onOpenChange:n,groupId:s,athletes:o,existingMemberIds:a,onAdded:i})=>{const{toast:u}=le(),[l,g]=r.useState(new Set),m=r.useMemo(()=>o.filter(f=>f.id!=null&&!a.has(f.id)),[o,a]),p=f=>{g(x=>{const c=new Set(x);return c.has(f)?c.delete(f):c.add(f),c})},h=W({mutationFn:()=>O.addTemporaryGroupMembers(s,[...l]),onSuccess:()=>{u({title:"Nageurs ajoutés",description:`${l.size} nageur${l.size>1?"s":""} ajouté${l.size>1?"s":""}.`}),g(new Set),n(!1),i()},onError:f=>{u({title:"Erreur",description:f.message,variant:"destructive"})}});return e.jsx(ve,{open:t,onOpenChange:n,children:e.jsxs(je,{side:"right",className:"w-full sm:max-w-md overflow-y-auto",children:[e.jsxs(be,{children:[e.jsx(ye,{children:"Ajouter des nageurs"}),e.jsx(Be,{children:"Sélectionnez les nageurs à ajouter au groupe."})]}),e.jsxs("div",{className:"mt-6 space-y-4",children:[e.jsx(_s,{athletes:m,selected:l,onToggle:p}),e.jsx(L,{className:"w-full",onClick:()=>h.mutate(),disabled:h.isPending||l.size===0,children:h.isPending?"Ajout...":`Ajouter ${l.size} nageur${l.size>1?"s":""}`})]})]})})},Br=({groupId:t,athletes:n,onBack:s})=>{const{toast:o}=le(),a=he(),[i,u]=r.useState(!1),[l,g]=r.useState(!1),[m,p]=r.useState(null),{data:h,isLoading:f}=Q({queryKey:["temp-group-detail",t],queryFn:()=>O.getTemporaryGroupDetail(t)}),x=W({mutationFn:b=>O.removeTemporaryGroupMember(t,b),onSuccess:()=>{o({title:"Nageur retiré"}),a.invalidateQueries({queryKey:["temp-group-detail",t]}),a.invalidateQueries({queryKey:["temp-groups"]})},onError:b=>{o({title:"Erreur",description:b.message,variant:"destructive"})}}),c=()=>{a.invalidateQueries({queryKey:["temp-group-detail",t]}),a.invalidateQueries({queryKey:["temp-groups"]})},v=r.useMemo(()=>new Set((h?.members??[]).map(b=>b.user_id)),[h]),C=r.useMemo(()=>new Set((h?.members??[]).map(b=>b.user_id)),[h]);return f?e.jsxs("div",{className:"space-y-4",children:[e.jsxs(L,{variant:"ghost",size:"sm",className:"-ml-2",onClick:s,children:[e.jsx(Je,{className:"mr-2 h-4 w-4"}),"Retour aux groupes"]}),e.jsx("div",{className:"space-y-2",children:[1,2,3].map(b=>e.jsx("div",{className:"rounded-xl border p-3 animate-pulse motion-reduce:animate-none",children:e.jsx("div",{className:"h-4 w-32 rounded bg-muted"})},b))})]}):h?e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs(L,{variant:"ghost",size:"sm",className:"-ml-2",onClick:s,children:[e.jsx(Je,{className:"mr-2 h-4 w-4"}),"Retour aux groupes"]}),e.jsx("h2",{className:"text-2xl font-display font-semibold uppercase italic text-primary",children:h.name}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ie,{variant:h.is_active?"default":"secondary",children:h.is_active?"Actif":"Terminé"}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:[h.members.length," membre",h.members.length!==1?"s":""]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-xs font-semibold uppercase tracking-[0.15em] text-muted-foreground",children:"Membres"}),h.is_active&&e.jsxs(L,{size:"sm",variant:"outline",onClick:()=>u(!0),children:[e.jsx(Nn,{className:"mr-1.5 h-3.5 w-3.5"}),"Ajouter"]})]}),h.members.length===0?e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"Aucun membre dans ce groupe."}):e.jsx("div",{className:"space-y-1.5",children:h.members.map(b=>e.jsxs("div",{className:"flex items-center gap-3 rounded-xl border bg-card p-3",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-sm font-semibold truncate",children:b.display_name}),b.permanent_group_label&&e.jsx(ie,{variant:"secondary",className:"text-[10px] px-1.5 py-0 mt-0.5",children:b.permanent_group_label})]}),h.is_active&&e.jsx(L,{size:"icon",variant:"ghost",className:"h-8 w-8 text-muted-foreground hover:text-destructive",onClick:()=>p({userId:b.user_id,name:b.display_name}),title:"Retirer du groupe",children:e.jsx(wn,{className:"h-4 w-4"})})]},b.user_id))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-xs font-semibold uppercase tracking-[0.15em] text-muted-foreground",children:"Sous-groupes"}),h.is_active&&e.jsxs(L,{size:"sm",variant:"outline",onClick:()=>g(!0),children:[e.jsx(ue,{className:"mr-1.5 h-3.5 w-3.5"}),"Sous-groupe"]})]}),h.subgroups.length===0?e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"Aucun sous-groupe."}):e.jsx("div",{className:"space-y-2",children:h.subgroups.map(b=>e.jsxs(jn,{children:[e.jsxs(bn,{className:"flex w-full items-center justify-between rounded-xl border bg-card p-3 text-left hover:bg-muted/50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ts,{className:"h-4 w-4 text-primary"}),e.jsx("span",{className:"text-sm font-semibold",children:b.name}),e.jsx(ie,{variant:"secondary",className:"text-[10px] px-1.5 py-0",children:b.members.length})]}),e.jsx(Jt,{className:"h-4 w-4 text-muted-foreground transition-transform [[data-state=open]_&]:rotate-180"})]}),e.jsx(yn,{children:e.jsxs("div",{className:"ml-4 mt-1 space-y-1",children:[b.members.map(y=>e.jsx("div",{className:"flex items-center gap-2 rounded-lg border px-3 py-2",children:e.jsx("span",{className:"text-sm",children:y.display_name})},y.user_id)),b.members.length===0&&e.jsx("p",{className:"text-xs text-muted-foreground py-2",children:"Aucun membre."})]})})]},b.id))})]}),e.jsx(Vr,{open:i,onOpenChange:u,groupId:t,athletes:n,existingMemberIds:v,onAdded:c}),e.jsx(ks,{open:l,onOpenChange:g,athletes:n,parentGroupId:t,parentMembers:C,onCreated:c}),e.jsx(_e,{open:!!m,onOpenChange:b=>{b||p(null)},children:e.jsxs(ke,{children:[e.jsxs(Me,{children:[e.jsx(Ae,{children:"Retirer du groupe"}),e.jsxs(Ee,{children:["Voulez-vous retirer ",m?.name," de ce groupe ?",h.subgroups.length>0?" Le nageur sera aussi retiré des sous-groupes.":""]})]}),e.jsxs(Re,{children:[e.jsx(De,{children:"Annuler"}),e.jsx(Pe,{onClick:()=>{m&&(x.mutate(m.userId),p(null))},className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Retirer"})]})]})})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs(L,{variant:"ghost",size:"sm",className:"-ml-2",onClick:s,children:[e.jsx(Je,{className:"mr-2 h-4 w-4"}),"Retour aux groupes"]}),e.jsx("p",{className:"text-sm text-muted-foreground text-center py-8",children:"Groupe introuvable."})]})},Tt=({group:t,onManage:n,onDeactivate:s,onReactivate:o,onDelete:a})=>{const i=new Date(t.created_at).toLocaleDateString("fr-FR",{day:"numeric",month:"short",year:"numeric"});return e.jsxs("div",{className:"rounded-xl border bg-card p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-sm font-bold truncate",children:t.name}),e.jsxs("div",{className:"flex items-center gap-2 mt-1 flex-wrap",children:[e.jsxs("span",{className:"text-xs text-muted-foreground",children:[t.member_count," membre",t.member_count!==1?"s":""]}),t.subgroup_count>0&&e.jsxs("span",{className:"text-xs text-muted-foreground",children:[t.subgroup_count," sous-groupe",t.subgroup_count!==1?"s":""]}),e.jsx("span",{className:"text-xs text-muted-foreground",children:i})]})]}),e.jsx(ie,{variant:t.is_active?"default":"secondary",children:t.is_active?"Actif":"Terminé"})]}),e.jsx("div",{className:"flex items-center gap-2 flex-wrap",children:t.is_active?e.jsxs(e.Fragment,{children:[e.jsxs(L,{size:"sm",variant:"outline",onClick:()=>n(t.id),children:[e.jsx(Ys,{className:"mr-1.5 h-3.5 w-3.5"}),"Gérer"]}),e.jsxs(L,{size:"sm",variant:"outline",onClick:()=>s(t.id),children:[e.jsx(xn,{className:"mr-1.5 h-3.5 w-3.5"}),"Terminer"]})]}):e.jsxs(e.Fragment,{children:[e.jsxs(L,{size:"sm",variant:"outline",onClick:()=>o(t.id),children:[e.jsx(Js,{className:"mr-1.5 h-3.5 w-3.5"}),"Réactiver"]}),e.jsxs(L,{size:"sm",variant:"outline",className:"text-destructive hover:text-destructive",onClick:()=>a(t.id),children:[e.jsx(et,{className:"mr-1.5 h-3.5 w-3.5"}),"Supprimer"]})]})})]})},Ur=({onBack:t,athletes:n,athletesLoading:s})=>{const{toast:o}=le(),a=he(),[i,u]=r.useState("list"),[l,g]=r.useState(null),[m,p]=r.useState(!1),[h,f]=r.useState(null),[x,c]=r.useState(null),{data:v=[],isLoading:C}=Q({queryKey:["temp-groups"],queryFn:()=>O.getTemporaryGroups()}),b=r.useMemo(()=>v.filter(M=>M.is_active),[v]),y=r.useMemo(()=>v.filter(M=>!M.is_active),[v]),F=W({mutationFn:M=>O.deactivateTemporaryGroup(M),onSuccess:()=>{o({title:"Groupe terminé"}),a.invalidateQueries({queryKey:["temp-groups"]})},onError:M=>{o({title:"Erreur",description:M.message,variant:"destructive"})}}),z=W({mutationFn:M=>O.reactivateTemporaryGroup(M),onSuccess:()=>{o({title:"Groupe réactivé"}),a.invalidateQueries({queryKey:["temp-groups"]})},onError:M=>{o({title:"Erreur",description:M.message,variant:"destructive"})}}),P=W({mutationFn:M=>O.deleteTemporaryGroup(M),onSuccess:()=>{o({title:"Groupe supprimé"}),a.invalidateQueries({queryKey:["temp-groups"]})},onError:M=>{o({title:"Erreur",description:M.message,variant:"destructive"})}}),_=M=>{g(M),u("detail")},E=()=>{g(null),u("list"),a.invalidateQueries({queryKey:["temp-groups"]})};return i==="detail"&&l!=null?e.jsx(Br,{groupId:l,athletes:n,onBack:E}):e.jsxs("div",{className:"space-y-6 pb-24",children:[e.jsx(me,{title:"Groupes temporaires",description:"Créez et gérez des groupes pour les stages, compétitions ou événements.",onBack:t,actions:e.jsxs(L,{size:"sm",onClick:()=>p(!0),children:[e.jsx(ue,{className:"mr-1.5 h-3.5 w-3.5"}),"Créer un groupe"]})}),C||s?e.jsx("div",{className:"space-y-2",children:[1,2,3].map(M=>e.jsx("div",{className:"rounded-xl border p-4 animate-pulse motion-reduce:animate-none",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-4 w-40 rounded bg-muted"}),e.jsx("div",{className:"ml-auto h-6 w-16 rounded bg-muted"})]})},M))}):v.length===0?e.jsxs("div",{className:"text-center py-12 space-y-3",children:[e.jsx(Xe,{className:"h-10 w-10 text-muted-foreground mx-auto"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Aucun groupe temporaire pour le moment."}),e.jsxs(L,{variant:"outline",size:"sm",onClick:()=>p(!0),children:[e.jsx(ue,{className:"mr-1.5 h-3.5 w-3.5"}),"Créer le premier groupe"]})]}):e.jsxs(e.Fragment,{children:[b.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h3",{className:"text-xs font-semibold uppercase tracking-[0.15em] text-muted-foreground",children:["Actifs (",b.length,")"]}),b.map(M=>e.jsx(Tt,{group:M,onManage:_,onDeactivate:w=>f(w),onReactivate:w=>z.mutate(w),onDelete:w=>c(w)},M.id))]}),y.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h3",{className:"text-xs font-semibold uppercase tracking-[0.15em] text-muted-foreground",children:["Terminés (",y.length,")"]}),y.map(M=>e.jsx(Tt,{group:M,onManage:_,onDeactivate:w=>f(w),onReactivate:w=>z.mutate(w),onDelete:w=>c(w)},M.id))]})]}),e.jsx(ks,{open:m,onOpenChange:p,athletes:n,onCreated:()=>{a.invalidateQueries({queryKey:["temp-groups"]})}}),e.jsx(_e,{open:h!=null,onOpenChange:M=>{M||f(null)},children:e.jsxs(ke,{children:[e.jsxs(Me,{children:[e.jsx(Ae,{children:"Terminer le groupe"}),e.jsx(Ee,{children:"Voulez-vous marquer ce groupe comme terminé ? Les sous-groupes seront aussi désactivés. Vous pourrez le réactiver plus tard si nécessaire."})]}),e.jsxs(Re,{children:[e.jsx(De,{children:"Annuler"}),e.jsx(Pe,{onClick:()=>{h!=null&&(F.mutate(h),f(null))},children:"Terminer"})]})]})}),e.jsx(_e,{open:x!=null,onOpenChange:M=>{M||c(null)},children:e.jsxs(ke,{children:[e.jsxs(Me,{children:[e.jsx(Ae,{children:"Supprimer le groupe"}),e.jsx(Ee,{children:"Cette action est irréversible. Le groupe et tous ses sous-groupes seront supprimés définitivement."})]}),e.jsxs(Re,{children:[e.jsx(De,{children:"Annuler"}),e.jsx(Pe,{onClick:()=>{x!=null&&(P.mutate(x),c(null))},className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Supprimer"})]})]})})]})};function Qr(t){const n=new Date;n.setHours(0,0,0,0);const s=new Date(t+"T00:00:00");return Math.ceil((s.getTime()-n.getTime())/(1e3*60*60*24))}function Hr(t){return`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")}`}function We(t,n){return Math.max(0,Math.round((new Date(n+"T00:00:00").getTime()-new Date(t+"T00:00:00").getTime())/6048e5))}const Wr=7,Yr=20,Jr=72;function Ye(t){return Math.min(Jr,Math.max(Yr,t*Wr))}const Xr=({open:t,onOpenChange:n,competition:s})=>{const{toast:o}=le(),a=he(),i=!!s,[u,l]=r.useState(""),[g,m]=r.useState(""),[p,h]=r.useState(""),[f,x]=r.useState(""),[c,v]=r.useState(""),[C,b]=r.useState(!1),[y,F]=r.useState(new Set),{data:z=[]}=Q({queryKey:["athletes"],queryFn:()=>O.getAthletes()}),{data:P=[]}=Q({queryKey:["groups"],queryFn:()=>O.getGroups()}),{data:_}=Q({queryKey:["competition-assignments",s?.id],queryFn:()=>O.getCompetitionAssignments(s.id),enabled:!!s?.id});r.useEffect(()=>{t&&(s?(l(s.name),m(s.date),h(s.end_date??s.date??""),x(s.location??""),v(s.description??""),_&&F(new Set(_.map(S=>S.athlete_id)))):(l(""),m(""),h(""),x(""),v(""),F(new Set)))},[t,s,_]);const E=W({mutationFn:S=>O.createCompetition(S),onSuccess:async S=>{if(y.size>0)try{await O.setCompetitionAssignments(S.id,Array.from(y))}catch(d){console.warn("[EAC] Failed to save competition assignments:",d)}o({title:"Competition creee"}),a.invalidateQueries({queryKey:["competitions"]}),a.invalidateQueries({queryKey:["competition-assignments"]}),n(!1)},onError:S=>{o({title:"Erreur",description:S.message,variant:"destructive"})}}),M=W({mutationFn:S=>O.updateCompetition(s.id,S),onSuccess:async()=>{try{await O.setCompetitionAssignments(s.id,Array.from(y))}catch(S){console.warn("[EAC] Failed to save competition assignments:",S)}o({title:"Competition mise a jour"}),a.invalidateQueries({queryKey:["competitions"]}),a.invalidateQueries({queryKey:["competition-assignments"]}),n(!1)},onError:S=>{o({title:"Erreur",description:S.message,variant:"destructive"})}}),w=W({mutationFn:()=>O.deleteCompetition(s.id),onSuccess:()=>{o({title:"Competition supprimee"}),a.invalidateQueries({queryKey:["competitions"]}),n(!1)},onError:S=>{o({title:"Erreur",description:S.message,variant:"destructive"})}}),T=()=>{if(!u.trim()){o({title:"Nom requis",description:"Veuillez saisir un nom pour la competition.",variant:"destructive"});return}if(!g){o({title:"Date requise",description:"Veuillez saisir une date.",variant:"destructive"});return}const S={name:u.trim(),date:g,end_date:p||g||null,location:f.trim()||null,description:c.trim()||null};i?M.mutate(S):E.mutate(S)},$=E.isPending||M.isPending||w.isPending,V="flex h-9 w-full rounded-lg border border-input bg-transparent px-3 py-1 text-sm shadow-sm transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring",q=S=>{m(S),(!p||p<S)&&h(S)};return e.jsxs(e.Fragment,{children:[e.jsx(ve,{open:t,onOpenChange:n,children:e.jsxs(je,{side:"right",className:"w-full sm:max-w-md overflow-y-auto",children:[e.jsx(be,{children:e.jsx(ye,{children:i?"Modifier":"Nouvelle compétition"})}),e.jsxs("div",{className:"mt-5 space-y-5",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(B,{htmlFor:"comp-name",className:"text-[11px] font-semibold uppercase tracking-wider text-muted-foreground",children:"Nom"}),e.jsx(de,{id:"comp-name",placeholder:"Ex : Championnats Régionaux",value:u,onChange:S=>l(S.target.value),className:"text-[15px] font-medium"})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("span",{className:"text-[11px] font-semibold uppercase tracking-wider text-muted-foreground",children:"Dates"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{htmlFor:"comp-date",className:"text-[10px] text-muted-foreground/60 pl-0.5",children:"Début"}),e.jsx("input",{id:"comp-date",type:"date",value:g,onChange:S=>q(S.target.value),className:V})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{htmlFor:"comp-end-date",className:"text-[10px] text-muted-foreground/60 pl-0.5",children:"Fin"}),e.jsx("input",{id:"comp-end-date",type:"date",value:p,onChange:S=>h(S.target.value),min:g||void 0,className:V})]})]})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(B,{htmlFor:"comp-location",className:"text-[11px] font-semibold uppercase tracking-wider text-muted-foreground",children:"Lieu"}),e.jsx(de,{id:"comp-location",placeholder:"Ex : Piscine de Strasbourg",value:f,onChange:S=>x(S.target.value)})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(B,{htmlFor:"comp-description",className:"text-[11px] font-semibold uppercase tracking-wider text-muted-foreground",children:"Notes"}),e.jsx(bt,{id:"comp-description",placeholder:"Informations complémentaires...",value:c,onChange:S=>v(S.target.value),rows:2,className:"resize-none"})]}),e.jsx("div",{className:"border-t border-border/40"}),e.jsxs("div",{className:"space-y-2.5",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-[11px] font-semibold uppercase tracking-wider text-muted-foreground",children:"Nageurs"}),e.jsxs("span",{className:"text-[10px] tabular-nums text-muted-foreground/50",children:[y.size," sélectionné",y.size>1?"s":""]})]}),e.jsxs(te,{value:"",onValueChange:S=>{const d=z.filter(N=>N.group_id===Number(S));F(N=>{const I=new Set(N);return d.forEach(G=>{G.id!=null&&I.add(G.id)}),I})},children:[e.jsx(se,{className:"h-8 text-xs",children:e.jsx(ne,{placeholder:"Ajouter un groupe..."})}),e.jsx(re,{children:P.filter(S=>!S.is_temporary).map(S=>e.jsx(H,{value:String(S.id),children:S.name},S.id))})]}),e.jsx("div",{className:"max-h-44 overflow-y-auto rounded-lg border p-1.5 space-y-0.5",children:z.map(S=>{if(S.id==null)return null;const d=y.has(S.id);return e.jsxs("label",{className:X("flex items-center gap-2 py-1 px-1.5 rounded-md cursor-pointer transition-colors",d?"bg-primary/5":"hover:bg-muted/50"),children:[e.jsx(Wt,{checked:d,onCheckedChange:N=>{F(I=>{const G=new Set(I);return N?G.add(S.id):G.delete(S.id),G})}}),e.jsx("span",{className:"text-[13px]",children:S.display_name}),S.group_label&&e.jsx("span",{className:"text-[10px] text-muted-foreground/50 ml-auto",children:S.group_label})]},S.id)})})]}),e.jsxs("div",{className:"space-y-3 pt-1",children:[e.jsx(L,{className:"w-full",onClick:T,disabled:$||!u.trim()||!g||!p,children:$?"Enregistrement...":i?"Enregistrer":"Créer la compétition"}),i&&e.jsx("button",{type:"button",className:"w-full text-center text-[11px] text-destructive/50 hover:text-destructive py-1.5 transition-colors",onClick:()=>b(!0),disabled:$,children:"Supprimer cette compétition"})]})]})]})}),e.jsx(_e,{open:C,onOpenChange:b,children:e.jsxs(ke,{children:[e.jsxs(Me,{children:[e.jsx(Ae,{children:"Supprimer la compétition"}),e.jsxs(Ee,{children:["Cette action est irréversible. La compétition «"," ",s?.name," » sera supprimée définitivement."]})]}),e.jsxs(Re,{children:[e.jsx(De,{children:"Annuler"}),e.jsx(Pe,{onClick:()=>{w.mutate(),b(!1)},className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Supprimer"})]})]})})]})},Zr=({competitions:t,onEdit:n})=>{const[s,o]=r.useState(!1),{items:a,todayIdx:i}=r.useMemo(()=>{const p=[...t].sort((b,y)=>b.date.localeCompare(y.date)),h=new Date;h.setHours(0,0,0,0);const f=Hr(h),x=[];let c="",v="",C=!1;for(const b of p){const y=b.date<f,F=Qr(b.date),z=b.date.slice(0,7),P=z!==v,_=new Date(b.date+"T00:00:00").toLocaleDateString("fr-FR",{month:"short"}).replace(".","").toUpperCase();if(!C&&!y){if(c){const M=We(c,f);M>=1&&x.push({kind:"gap",weeks:M,height:Ye(M)})}x.push({kind:"today"}),C=!0;const E=We(f,b.date);E>=1&&x.push({kind:"gap",weeks:E,height:Ye(E)})}else if(c){const E=We(c,b.date);E>=1&&x.push({kind:"gap",weeks:E,height:Ye(E)})}x.push({kind:"comp",comp:b,isPast:y,days:F,isNewMonth:P,monthLabel:_}),c=b.end_date||b.date,v=z}if(!C){if(c){const b=We(c,f);b>=1&&x.push({kind:"gap",weeks:b,height:Ye(b)})}x.push({kind:"today"})}return{items:x,todayIdx:x.findIndex(b=>b.kind==="today")}},[t]);if(t.length===0)return null;const u=i>0?a.slice(0,i):[],l=i>=0?a.slice(i):a,g=u.filter(p=>p.kind==="comp").length,m=(p,h)=>{if(p.kind==="gap")return e.jsx("div",{className:"relative",style:{height:p.height},children:p.weeks>=2&&e.jsxs("span",{className:"absolute left-[-0.8rem] -translate-x-1/2 top-1/2 -translate-y-1/2 text-[9px] tabular-nums font-medium text-muted-foreground/30 bg-background px-1 select-none",children:[p.weeks,"s"]})},`g${h}`);if(p.kind==="today")return e.jsxs("div",{className:"relative flex items-center h-7 -ml-14",children:[e.jsx("div",{className:"absolute left-0 right-0 h-[2px] bg-emerald-500/60"}),e.jsx("span",{className:"relative text-[10px] font-bold tracking-widest text-emerald-600 dark:text-emerald-400 bg-background pl-2 pr-1.5 select-none",children:"AUJOURD'HUI"})]},"today");const{comp:f,isPast:x,days:c,isNewMonth:v,monthLabel:C}=p,b=(()=>{const y=new Date(f.date+"T00:00:00");if(!f.end_date||f.end_date===f.date)return y.toLocaleDateString("fr-FR",{day:"numeric",month:"short"}).replace(".","");const F=new Date(f.end_date+"T00:00:00"),z=F.toLocaleDateString("fr-FR",{day:"numeric",month:"short"}).replace(".","");return y.getMonth()===F.getMonth()?`${y.getDate()}–${z}`:`${y.toLocaleDateString("fr-FR",{day:"numeric",month:"short"}).replace(".","")} → ${z}`})();return e.jsxs("button",{type:"button",className:X("relative w-full flex items-start text-left py-1.5 group transition-opacity",x?"opacity-40 hover:opacity-70":"hover:opacity-80"),onClick:()=>n(f),children:[v&&e.jsx("span",{className:"absolute left-[-3.25rem] top-[3px] w-[2rem] text-[10px] font-bold uppercase tracking-widest text-muted-foreground/50 text-right select-none",children:C}),e.jsx("div",{className:X("absolute left-[-0.8rem] top-[5px] h-[10px] w-[10px] rounded-full -translate-x-1/2 z-10 border-2 border-background transition-transform group-hover:scale-150",x?"bg-muted-foreground/30":"bg-amber-500 shadow-[0_0_6px_rgba(245,158,11,0.4)]")}),e.jsxs("div",{className:"min-w-0 flex-1 pl-1",children:[e.jsxs("div",{className:"flex items-center gap-1.5 min-w-0",children:[e.jsx("span",{className:X("text-[13px] font-semibold truncate flex-1 min-w-0",x?"text-muted-foreground":"text-foreground"),children:f.name}),!x&&c>=0&&e.jsxs("span",{className:"text-[10px] font-bold tabular-nums shrink-0 px-1.5 py-0.5 rounded-full bg-amber-100 text-amber-700 dark:bg-amber-900/30 dark:text-amber-400",children:["J-",c]})]}),e.jsxs("p",{className:X("text-[11px] truncate",x?"text-muted-foreground/60":"text-muted-foreground"),children:[b,f.location&&f.location!=="??"&&` · ${f.location}`]})]})]},f.id)};return e.jsxs("div",{className:"relative pl-14",children:[e.jsx("div",{className:"absolute left-[2.625rem] top-1 bottom-1 w-[2px] rounded-full bg-gradient-to-b from-border/10 via-border/40 to-border/10"}),g>0&&e.jsxs("button",{type:"button",className:"relative flex items-center gap-1.5 py-2 text-[11px] font-medium text-muted-foreground/50 hover:text-muted-foreground transition-colors select-none",onClick:()=>o(p=>!p),children:[e.jsx(Jt,{className:X("h-3 w-3 shrink-0 transition-transform",s&&"rotate-180")}),e.jsxs("span",{children:["Passées (",g,")"]})]}),s&&u.map((p,h)=>m(p,h)),l.map((p,h)=>m(p,u.length+h))]})},ea=({onBack:t})=>{const[n,s]=r.useState(!1),[o,a]=r.useState(null),{data:i=[],isLoading:u}=Q({queryKey:["competitions"],queryFn:()=>O.getCompetitions()}),l=()=>{a(null),s(!0)},g=p=>{a(p),s(!0)},m=i.length===0?"Gerez les competitions du club.":`${i.length} competition${i.length>1?"s":""}`;return e.jsxs("div",{className:"space-y-6 pb-24",children:[e.jsx(me,{title:"Competitions",description:m,onBack:t,actions:e.jsxs(L,{variant:"outline",size:"sm",onClick:l,children:[e.jsx(ue,{className:"mr-1.5 h-3.5 w-3.5"}),"Ajouter"]})}),u?e.jsx("div",{className:"space-y-2",children:[1,2,3].map(p=>e.jsx("div",{className:"rounded-xl border p-3 animate-pulse motion-reduce:animate-none",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-4 w-40 rounded bg-muted"}),e.jsx("div",{className:"ml-auto h-5 w-12 rounded bg-muted"})]})},p))}):i.length===0?e.jsxs("div",{className:"text-center py-12 space-y-3",children:[e.jsx(ct,{className:"h-10 w-10 text-muted-foreground mx-auto"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Aucune competition creee."}),e.jsxs(L,{variant:"outline",size:"sm",onClick:l,children:[e.jsx(ue,{className:"mr-1.5 h-3.5 w-3.5"}),"Creer la premiere competition"]})]}):e.jsx(Zr,{competitions:i,onEdit:g}),e.jsx(Xr,{open:n,onOpenChange:s,competition:o})]})};async function ta(t){const{data:n,error:s}=await Lt.rpc("get_auth_uid_for_user",{p_user_id:t});return s?(console.error("[objectives] Failed to resolve auth UUID:",s.message),null):n}const sa=({open:t,onOpenChange:n,objective:s,athleteName:o,athleteAuthId:a,competitions:i})=>{const{toast:u}=le(),l=he(),g=!!s,[m,p]=r.useState("chrono"),[h,f]=r.useState(""),[x,c]=r.useState("25"),[v,C]=r.useState(""),[b,y]=r.useState(""),[F,z]=r.useState(""),[P,_]=r.useState(!1);r.useEffect(()=>{if(t)if(s){const d=!!s.event_code,N=!!s.text;p(d&&N?"both":N?"texte":"chrono"),f(s.event_code??""),c(String(s.pool_length??25)),C(s.target_time_seconds!=null?Ht(s.target_time_seconds):""),y(s.text??""),z(s.competition_id??"")}else p("chrono"),f(""),c("25"),C(""),y(""),z("")},[t,s]);const E=W({mutationFn:d=>O.createObjective(d),onSuccess:()=>{u({title:"Objectif cree"}),l.invalidateQueries({queryKey:["objectives"]}),n(!1)},onError:d=>{u({title:"Erreur",description:d.message,variant:"destructive"})}}),M=W({mutationFn:d=>O.updateObjective(s.id,d),onSuccess:()=>{u({title:"Objectif mis a jour"}),l.invalidateQueries({queryKey:["objectives"]}),n(!1)},onError:d=>{u({title:"Erreur",description:d.message,variant:"destructive"})}}),w=W({mutationFn:()=>O.deleteObjective(s.id),onSuccess:()=>{u({title:"Objectif supprime"}),l.invalidateQueries({queryKey:["objectives"]}),n(!1)},onError:d=>{u({title:"Erreur",description:d.message,variant:"destructive"})}}),T=m==="chrono"||m==="both",$=m==="texte"||m==="both",V=()=>{if(T&&!h){u({title:"Epreuve requise",description:"Veuillez selectionner une epreuve.",variant:"destructive"});return}if(T&&v&&At(v)===null){u({title:"Format invalide",description:"Le temps doit être au format m:ss:cc (ex: 1:05:30)",variant:"destructive"});return}if($&&!b.trim()){u({title:"Texte requis",description:"Veuillez saisir un objectif texte.",variant:"destructive"});return}const d={athlete_id:a,competition_id:F&&F!=="none"?F:null,event_code:T?h:null,pool_length:T?Number(x):null,target_time_seconds:T&&v?At(v):null,text:$?b.trim():null};g?M.mutate(d):E.mutate(d)},q=E.isPending||M.isPending||w.isPending,S=r.useMemo(()=>{const d=new Date;return d.setHours(0,0,0,0),i.filter(N=>new Date(N.date+"T00:00:00").getTime()>=d.getTime())},[i]);return e.jsxs(e.Fragment,{children:[e.jsx(ve,{open:t,onOpenChange:n,children:e.jsxs(je,{side:"right",className:"w-full sm:max-w-md overflow-y-auto",children:[e.jsx(be,{children:e.jsx(ye,{children:g?"Modifier l'objectif":"Nouvel objectif"})}),e.jsxs("div",{className:"mt-6 space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(B,{children:"Nageur"}),e.jsx("p",{className:"text-sm font-medium",children:o})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(B,{children:"Type d'objectif"}),e.jsxs(Ze,{type:"single",variant:"outline",value:m,onValueChange:d=>{d&&p(d)},className:"justify-start",children:[e.jsx(ce,{value:"chrono",className:"text-xs",children:"Chrono"}),e.jsx(ce,{value:"texte",className:"text-xs",children:"Texte"}),e.jsx(ce,{value:"both",className:"text-xs",children:"Les deux"})]})]}),T&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(B,{children:"Epreuve *"}),e.jsxs(te,{value:h,onValueChange:f,children:[e.jsx(se,{children:e.jsx(ne,{placeholder:"Choisir une epreuve"})}),e.jsx(re,{children:en.map(d=>e.jsx(H,{value:d,children:Qt(d)},d))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(B,{children:"Bassin"}),e.jsxs(te,{value:x,onValueChange:c,children:[e.jsx(se,{children:e.jsx(ne,{})}),e.jsxs(re,{children:[e.jsx(H,{value:"25",children:"25m"}),e.jsx(H,{value:"50",children:"50m"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(B,{children:"Temps cible (min:sec:centièmes)"}),e.jsx(de,{placeholder:"Ex : 1:05:30",value:v,onChange:d=>C(d.target.value)})]})]}),$&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(B,{children:"Objectif texte *"}),e.jsx(bt,{placeholder:"Ex : Ameliorer la coulée de dos",value:b,onChange:d=>y(d.target.value),rows:3})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(B,{children:"Lier a une competition"}),e.jsxs(te,{value:F,onValueChange:z,children:[e.jsx(se,{children:e.jsx(ne,{placeholder:"Aucune"})}),e.jsxs(re,{children:[e.jsx(H,{value:"none",children:"Aucune"}),S.map(d=>e.jsxs(H,{value:d.id,children:[d.name," (",d.date,")"]},d.id))]})]})]}),e.jsxs("div",{className:"space-y-2 pt-2",children:[e.jsx(L,{className:"w-full",onClick:V,disabled:q,children:q?"Enregistrement...":g?"Enregistrer":"Creer"}),g&&e.jsx(L,{variant:"outline",className:"w-full text-destructive hover:text-destructive",onClick:()=>_(!0),disabled:q,children:"Supprimer cet objectif"})]})]})]})}),e.jsx(_e,{open:P,onOpenChange:_,children:e.jsxs(ke,{children:[e.jsxs(Me,{children:[e.jsx(Ae,{children:"Supprimer l'objectif"}),e.jsx(Ee,{children:"Cette action est irreversible. L'objectif sera supprime definitivement."})]}),e.jsxs(Re,{children:[e.jsx(De,{children:"Annuler"}),e.jsx(Pe,{onClick:()=>{w.mutate(),_(!1)},className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Supprimer"})]})]})})]})},na=({objective:t,onEdit:n})=>{const s=!!t.event_code,o=!!t.text;return e.jsxs("button",{type:"button",className:"w-full text-left rounded-xl border bg-card p-3 space-y-1.5 transition-colors hover:bg-muted/50",onClick:()=>n(t),children:[s&&e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"text-sm font-semibold",children:Qt(t.event_code)}),t.pool_length&&e.jsxs(ie,{variant:"secondary",className:"text-[10px] px-1.5 py-0",children:[t.pool_length,"m"]}),t.target_time_seconds!=null&&e.jsx(ie,{variant:"outline",className:"text-[10px] px-1.5 py-0 font-mono",children:Ht(t.target_time_seconds)})]}),o&&e.jsx("p",{className:"text-sm text-muted-foreground line-clamp-2",children:t.text}),t.competition_name&&e.jsx(ie,{variant:"outline",className:"border-orange-300 text-orange-600 dark:text-orange-400 text-[10px] px-1.5 py-0",children:t.competition_name})]})},ra=({onBack:t,athletes:n,athletesLoading:s})=>{const{toast:o}=le(),[a,i]=r.useState(""),[u,l]=r.useState(!1),[g,m]=r.useState(null),p=r.useMemo(()=>a?n.find(P=>P.id!=null&&String(P.id)===a)??null:null,[n,a]),{data:h,isLoading:f}=Q({queryKey:["auth-uid",a],queryFn:()=>ta(Number(a)),enabled:!!a}),{data:x=[]}=Q({queryKey:["competitions"],queryFn:()=>O.getCompetitions()}),{data:c=[],isLoading:v}=Q({queryKey:["objectives",h],queryFn:()=>O.getObjectives(h),enabled:!!h}),C=r.useMemo(()=>{const P=n.filter(E=>E.id!=null),_=new Map;for(const E of P){const M=E.group_label||"Sans groupe";_.has(M)||_.set(M,[]),_.get(M).push(E)}return[..._.entries()].sort(([E],[M])=>E.localeCompare(M,"fr"))},[n]),b=()=>{if(!h){o({title:"Nageur requis",description:"Veuillez selectionner un nageur.",variant:"destructive"});return}m(null),l(!0)},y=P=>{m(P),l(!0)},F=s||!!a&&f,z=!!h&&!f;return e.jsxs("div",{className:"space-y-6 pb-24",children:[e.jsx(me,{title:"Objectifs",description:"Definissez des objectifs chrono ou texte pour chaque nageur.",onBack:t,actions:e.jsxs(L,{variant:"outline",size:"sm",onClick:b,disabled:!h,children:[e.jsx(ue,{className:"mr-1.5 h-3.5 w-3.5"}),"Ajouter"]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(B,{children:"Nageur"}),e.jsxs(te,{value:a,onValueChange:i,children:[e.jsx(se,{children:e.jsx(ne,{placeholder:"Selectionner un nageur"})}),e.jsx(re,{children:C.map(([P,_])=>e.jsxs("div",{children:[e.jsx("div",{className:"px-2 py-1.5 text-xs font-semibold uppercase tracking-wider text-muted-foreground",children:P}),_.map(E=>e.jsx(H,{value:String(E.id),children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:E.display_name}),E.group_label&&e.jsx(ie,{variant:"secondary",className:"text-[10px] px-1.5 py-0",children:E.group_label})]})},E.id))]},P))})]})]}),!a&&e.jsxs("div",{className:"text-center py-12 space-y-3",children:[e.jsx(dt,{className:"h-10 w-10 text-muted-foreground mx-auto"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Selectionnez un nageur pour voir et gerer ses objectifs."})]}),F&&a&&e.jsx("div",{className:"space-y-2",children:[1,2,3].map(P=>e.jsx("div",{className:"rounded-xl border p-3 animate-pulse motion-reduce:animate-none",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-4 w-40 rounded bg-muted"}),e.jsx("div",{className:"ml-auto h-5 w-12 rounded bg-muted"})]})},P))}),z&&v&&e.jsx("div",{className:"space-y-2",children:[1,2].map(P=>e.jsx("div",{className:"rounded-xl border p-3 animate-pulse motion-reduce:animate-none",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-4 w-32 rounded bg-muted"}),e.jsx("div",{className:"ml-auto h-5 w-16 rounded bg-muted"})]})},P))}),z&&!v&&c.length===0&&e.jsxs("div",{className:"text-center py-12 space-y-3",children:[e.jsx(dt,{className:"h-10 w-10 text-muted-foreground mx-auto"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Aucun objectif defini pour ",p?.display_name,"."]}),e.jsxs(L,{variant:"outline",size:"sm",onClick:b,children:[e.jsx(ue,{className:"mr-1.5 h-3.5 w-3.5"}),"Creer le premier objectif"]})]}),z&&!v&&c.length>0&&e.jsx("div",{className:"space-y-2",children:c.map(P=>e.jsx(na,{objective:P,onEdit:y},P.id))}),h&&p&&e.jsx(sa,{open:u,onOpenChange:l,objective:g,athleteName:p.display_name,athleteAuthId:h,competitions:x})]})};function gt(t,n,{checkForDefaultPrevented:s=!0}={}){return function(a){if(t?.(a),s===!1||!a.defaultPrevented)return n?.(a)}}var aa=Bt[" useInsertionEffect ".trim().toString()]||$t;function oa({prop:t,defaultProp:n,onChange:s=()=>{},caller:o}){const[a,i,u]=ia({defaultProp:n,onChange:s}),l=t!==void 0,g=l?t:a;{const p=r.useRef(t!==void 0);r.useEffect(()=>{const h=p.current;h!==l&&console.warn(`${o} is changing from ${h?"controlled":"uncontrolled"} to ${l?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),p.current=l},[l,o])}const m=r.useCallback(p=>{if(l){const h=la(p)?p(t):p;h!==t&&u.current?.(h)}else i(p)},[l,t,i,u]);return[g,m]}function ia({defaultProp:t,onChange:n}){const[s,o]=r.useState(t),a=r.useRef(s),i=r.useRef(n);return aa(()=>{i.current=n},[n]),r.useEffect(()=>{a.current!==s&&(i.current?.(s),a.current=s)},[s,a]),[s,o,i]}function la(t){return typeof t=="function"}var Ct="Radio",[ca,Ms]=vt(Ct),[da,ua]=ca(Ct),As=r.forwardRef((t,n)=>{const{__scopeRadio:s,name:o,checked:a=!1,required:i,disabled:u,value:l="on",onCheck:g,form:m,...p}=t,[h,f]=r.useState(null),x=Ve(n,C=>f(C)),c=r.useRef(!1),v=h?m||!!h.closest("form"):!0;return e.jsxs(da,{scope:s,checked:a,disabled:u,children:[e.jsx(ae.button,{type:"button",role:"radio","aria-checked":a,"data-state":Ps(a),"data-disabled":u?"":void 0,disabled:u,value:l,...p,ref:x,onClick:gt(t.onClick,C=>{a||g?.(),v&&(c.current=C.isPropagationStopped(),c.current||C.stopPropagation())})}),v&&e.jsx(Ds,{control:h,bubbles:!c.current,name:o,value:l,checked:a,required:i,disabled:u,form:m,style:{transform:"translateX(-100%)"}})]})});As.displayName=Ct;var Es="RadioIndicator",Rs=r.forwardRef((t,n)=>{const{__scopeRadio:s,forceMount:o,...a}=t,i=ua(Es,s);return e.jsx(jt,{present:o||i.checked,children:e.jsx(ae.span,{"data-state":Ps(i.checked),"data-disabled":i.disabled?"":void 0,...a,ref:n})})});Rs.displayName=Es;var ma="RadioBubbleInput",Ds=r.forwardRef(({__scopeRadio:t,control:n,checked:s,bubbles:o=!0,...a},i)=>{const u=r.useRef(null),l=Ve(u,i),g=tn(s),m=Xs(n);return r.useEffect(()=>{const p=u.current;if(!p)return;const h=window.HTMLInputElement.prototype,x=Object.getOwnPropertyDescriptor(h,"checked").set;if(g!==s&&x){const c=new Event("click",{bubbles:o});x.call(p,s),p.dispatchEvent(c)}},[g,s,o]),e.jsx(ae.input,{type:"radio","aria-hidden":!0,defaultChecked:s,...a,tabIndex:-1,ref:l,style:{...a.style,...m,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});Ds.displayName=ma;function Ps(t){return t?"checked":"unchecked"}var pa=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],nt="RadioGroup",[ha]=vt(nt,[Xt,Ms]),Fs=Xt(),Is=Ms(),[xa,ga]=ha(nt),Ts=r.forwardRef((t,n)=>{const{__scopeRadioGroup:s,name:o,defaultValue:a,value:i,required:u=!1,disabled:l=!1,orientation:g,dir:m,loop:p=!0,onValueChange:h,...f}=t,x=Fs(s),c=_n(m),[v,C]=oa({prop:i,defaultProp:a??null,onChange:h,caller:nt});return e.jsx(xa,{scope:s,name:o,required:u,disabled:l,value:v,onValueChange:C,children:e.jsx(Cn,{asChild:!0,...x,orientation:g,dir:c,loop:p,children:e.jsx(ae.div,{role:"radiogroup","aria-required":u,"aria-orientation":g,"data-disabled":l?"":void 0,dir:c,...f,ref:n})})})});Ts.displayName=nt;var Os="RadioGroupItem",$s=r.forwardRef((t,n)=>{const{__scopeRadioGroup:s,disabled:o,...a}=t,i=ga(Os,s),u=i.disabled||o,l=Fs(s),g=Is(s),m=r.useRef(null),p=Ve(n,m),h=i.value===a.value,f=r.useRef(!1);return r.useEffect(()=>{const x=v=>{pa.includes(v.key)&&(f.current=!0)},c=()=>f.current=!1;return document.addEventListener("keydown",x),document.addEventListener("keyup",c),()=>{document.removeEventListener("keydown",x),document.removeEventListener("keyup",c)}},[]),e.jsx(Sn,{asChild:!0,...l,focusable:!u,active:h,children:e.jsx(As,{disabled:u,required:i.required,checked:h,...g,...a,name:i.name,ref:p,onCheck:()=>i.onValueChange(a.value),onKeyDown:gt(x=>{x.key==="Enter"&&x.preventDefault()}),onFocus:gt(a.onFocus,()=>{f.current&&m.current?.click()})})})});$s.displayName=Os;var fa="RadioGroupIndicator",qs=r.forwardRef((t,n)=>{const{__scopeRadioGroup:s,...o}=t,a=Is(s);return e.jsx(Rs,{...a,...o,ref:n})});qs.displayName=fa;var zs=Ts,Ls=$s,va=qs;const Ks=r.forwardRef(({className:t,...n},s)=>e.jsx(zs,{className:X("grid gap-2",t),...n,ref:s}));Ks.displayName=zs.displayName;const ft=r.forwardRef(({className:t,...n},s)=>e.jsx(Ls,{ref:s,className:X("aspect-square h-4 w-4 rounded-full border border-primary text-primary shadow focus:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",t),...n,children:e.jsx(va,{className:"flex items-center justify-center",children:e.jsx(gn,{className:"h-3.5 w-3.5 fill-primary"})})}));ft.displayName=Ls.displayName;const Gs=["Lundi","Mardi","Mercredi","Jeudi","Vendredi","Samedi","Dimanche"],ja=["Lun","Mar","Mer","Jeu","Ven","Sam","Dim"];function Ie(t){return t.slice(0,5)}function ba(){return new Date().toISOString().slice(0,10)}const ya=({open:t,onOpenChange:n,slot:s,groups:o,coaches:a})=>{const{toast:i}=le(),u=he(),l=!!s,[g,m]=r.useState("1"),[p,h]=r.useState(""),[f,x]=r.useState(""),[c,v]=r.useState(""),[C,b]=r.useState([]),[y,F]=r.useState(1),[z,P]=r.useState(!1);r.useEffect(()=>{if(t)if(s){m(String(s.day_of_week)),h(Ie(s.start_time)),x(Ie(s.end_time)),v(s.location);const d=s.assignments.map((N,I)=>({key:I,group_id:String(N.group_id),coach_id:String(N.coach_id),lane_count:N.lane_count!=null?String(N.lane_count):""}));b(d),F(d.length)}else m("1"),h(""),x(""),v(""),b([]),F(1)},[t,s]);const _=()=>{b(d=>[...d,{key:y,group_id:"",coach_id:"",lane_count:""}]),F(d=>d+1)},E=d=>{b(N=>N.filter(I=>I.key!==d))},M=(d,N,I)=>{b(G=>G.map(J=>J.key===d?{...J,[N]:I}:J))},w=()=>!p||!f?(i({title:"Horaires requis",description:"Veuillez saisir les heures de debut et fin.",variant:"destructive"}),null):c.trim()?{day_of_week:Number(g),start_time:p,end_time:f,location:c.trim(),assignments:C.filter(d=>d.group_id&&d.coach_id).map(d=>({group_id:Number(d.group_id),coach_id:Number(d.coach_id),lane_count:d.lane_count?Number(d.lane_count):null}))}:(i({title:"Lieu requis",description:"Veuillez saisir un lieu.",variant:"destructive"}),null),T=W({mutationFn:d=>O.createTrainingSlot(d),onSuccess:()=>{i({title:"Creneau cree"}),u.invalidateQueries({queryKey:["training-slots"]}),n(!1)},onError:d=>{i({title:"Erreur",description:d.message,variant:"destructive"})}}),$=W({mutationFn:d=>O.updateTrainingSlot(s.id,d),onSuccess:()=>{i({title:"Creneau mis a jour"}),u.invalidateQueries({queryKey:["training-slots"]}),n(!1)},onError:d=>{i({title:"Erreur",description:d.message,variant:"destructive"})}}),V=W({mutationFn:()=>O.deleteTrainingSlot(s.id),onSuccess:()=>{i({title:"Creneau supprime"}),u.invalidateQueries({queryKey:["training-slots"]}),n(!1)},onError:d=>{i({title:"Erreur",description:d.message,variant:"destructive"})}}),q=()=>{const d=w();d&&(l?$.mutate(d):T.mutate(d))},S=T.isPending||$.isPending||V.isPending;return e.jsxs(e.Fragment,{children:[e.jsx(ve,{open:t,onOpenChange:n,children:e.jsxs(je,{side:"right",className:"w-full sm:max-w-md overflow-y-auto",children:[e.jsxs(be,{children:[e.jsx(ye,{children:l?"Modifier le creneau":"Nouveau creneau"}),e.jsx(Be,{children:l?"Modifiez les details de ce creneau.":"Definissez un nouveau creneau hebdomadaire."})]}),e.jsxs("div",{className:"mt-6 space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(B,{children:"Jour de la semaine *"}),e.jsxs(te,{value:g,onValueChange:m,children:[e.jsx(se,{children:e.jsx(ne,{})}),e.jsx(re,{children:Gs.map((d,N)=>e.jsx(H,{value:String(N+1),children:d},N+1))})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(B,{htmlFor:"slot-start",children:"Debut *"}),e.jsx("input",{id:"slot-start",type:"time",value:p,onChange:d=>h(d.target.value),className:"flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-sm transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(B,{htmlFor:"slot-end",children:"Fin *"}),e.jsx("input",{id:"slot-end",type:"time",value:f,onChange:d=>x(d.target.value),className:"flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-sm transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(B,{htmlFor:"slot-location",children:"Lieu *"}),e.jsx(de,{id:"slot-location",placeholder:"Ex : Piscine Erstein",value:c,onChange:d=>v(d.target.value)})]}),e.jsx(Yt,{}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(B,{children:"Groupes & Coachs"}),e.jsxs(L,{type:"button",variant:"outline",size:"sm",onClick:_,children:[e.jsx(ue,{className:"mr-1 h-3.5 w-3.5"}),"Ajouter"]})]}),C.length===0&&e.jsx("p",{className:"text-xs text-muted-foreground text-center py-2",children:"Aucun groupe assigne."}),C.map(d=>e.jsx("div",{className:"rounded-lg border p-3 space-y-2",children:e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs(te,{value:d.group_id,onValueChange:N=>M(d.key,"group_id",N),children:[e.jsx(se,{className:"h-8 text-xs",children:e.jsx(ne,{placeholder:"Groupe..."})}),e.jsx(re,{children:o.map(N=>e.jsx(H,{value:String(N.id),children:N.name},N.id))})]}),e.jsxs(te,{value:d.coach_id,onValueChange:N=>M(d.key,"coach_id",N),children:[e.jsx(se,{className:"h-8 text-xs",children:e.jsx(ne,{placeholder:"Coach..."})}),e.jsx(re,{children:a.map(N=>e.jsx(H,{value:String(N.id),children:N.display_name},N.id))})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(de,{type:"number",min:0,placeholder:"Lignes d'eau",value:d.lane_count,onChange:N=>M(d.key,"lane_count",N.target.value),className:"h-8 text-xs flex-1"}),e.jsx(L,{type:"button",variant:"ghost",size:"icon",className:"h-8 w-8 text-muted-foreground hover:text-destructive shrink-0",onClick:()=>E(d.key),children:e.jsx(et,{className:"h-3.5 w-3.5"})})]})]})},d.key))]}),e.jsxs("div",{className:"space-y-2 pt-2",children:[e.jsx(L,{className:"w-full",onClick:q,disabled:S||!p||!f||!c.trim(),children:S?"Enregistrement...":l?"Enregistrer":"Creer"}),l&&e.jsx(L,{variant:"outline",className:"w-full text-destructive hover:text-destructive",onClick:()=>P(!0),disabled:S,children:"Supprimer ce creneau"})]})]})]})}),e.jsx(_e,{open:z,onOpenChange:P,children:e.jsxs(ke,{children:[e.jsxs(Me,{children:[e.jsx(Ae,{children:"Supprimer le creneau"}),e.jsx(Ee,{children:"Ce creneau sera desactive. Les exceptions associees resteront en base mais ne seront plus visibles."})]}),e.jsxs(Re,{children:[e.jsx(De,{children:"Annuler"}),e.jsx(Pe,{onClick:()=>{V.mutate(),P(!1)},className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Supprimer"})]})]})})]})},Na=({open:t,onOpenChange:n,slot:s})=>{const{toast:o}=le(),a=he(),[i,u]=r.useState(""),[l,g]=r.useState("cancelled"),[m,p]=r.useState(""),[h,f]=r.useState(""),[x,c]=r.useState(""),[v,C]=r.useState("");r.useEffect(()=>{t&&(u(""),g("cancelled"),p(s?Ie(s.start_time):""),f(s?Ie(s.end_time):""),c(s?.location??""),C(""))},[t,s]);const b=W({mutationFn:F=>O.createSlotOverride(F),onSuccess:()=>{o({title:"Exception enregistree"}),a.invalidateQueries({queryKey:["training-slot-overrides"]}),a.invalidateQueries({queryKey:["training-slots"]}),n(!1)},onError:F=>{o({title:"Erreur",description:F.message,variant:"destructive"})}}),y=()=>{if(!s)return;if(!i){o({title:"Date requise",description:"Veuillez saisir la date de l'exception.",variant:"destructive"});return}const F={slot_id:s.id,override_date:i,status:l,new_start_time:l==="modified"&&m||null,new_end_time:l==="modified"&&h||null,new_location:l==="modified"&&x.trim()?x.trim():null,reason:v.trim()||null};b.mutate(F)};return e.jsx(ve,{open:t,onOpenChange:n,children:e.jsxs(je,{side:"right",className:"w-full sm:max-w-md overflow-y-auto",children:[e.jsxs(be,{children:[e.jsx(ye,{children:"Exception"}),e.jsx(Be,{children:"Annulez ou modifiez ce creneau pour une date precise."})]}),e.jsxs("div",{className:"mt-6 space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(B,{htmlFor:"override-date",children:"Date *"}),e.jsx("input",{id:"override-date",type:"date",value:i,onChange:F=>u(F.target.value),className:"flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-sm transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(B,{children:"Type"}),e.jsxs(Ks,{value:l,onValueChange:F=>g(F),className:"flex gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ft,{value:"cancelled",id:"ovr-cancelled"}),e.jsx(B,{htmlFor:"ovr-cancelled",className:"font-normal",children:"Annule"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ft,{value:"modified",id:"ovr-modified"}),e.jsx(B,{htmlFor:"ovr-modified",className:"font-normal",children:"Modifie"})]})]})]}),l==="modified"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(B,{htmlFor:"ovr-start",children:"Nouvel horaire debut"}),e.jsx("input",{id:"ovr-start",type:"time",value:m,onChange:F=>p(F.target.value),className:"flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-sm transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(B,{htmlFor:"ovr-end",children:"Nouvel horaire fin"}),e.jsx("input",{id:"ovr-end",type:"time",value:h,onChange:F=>f(F.target.value),className:"flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-sm transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(B,{htmlFor:"ovr-location",children:"Nouveau lieu"}),e.jsx(de,{id:"ovr-location",value:x,onChange:F=>c(F.target.value)})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(B,{htmlFor:"ovr-reason",children:"Motif"}),e.jsx(de,{id:"ovr-reason",placeholder:"Ex : Vacances scolaires",value:v,onChange:F=>C(F.target.value)})]}),e.jsx(L,{className:"w-full",onClick:y,disabled:b.isPending||!i,children:b.isPending?"Enregistrement...":"Enregistrer"})]})]})})},wa=({slot:t,overrides:n,onEdit:s,onOverride:o,onDeleteOverride:a})=>e.jsxs("div",{className:"rounded-lg border bg-card p-2 space-y-1.5 text-xs",children:[e.jsxs("div",{className:"flex items-center justify-between gap-1",children:[e.jsxs("div",{className:"flex items-center gap-1 min-w-0",children:[e.jsx(yt,{className:"h-3 w-3 text-primary shrink-0"}),e.jsxs("span",{className:"font-semibold whitespace-nowrap",children:[Ie(t.start_time),"–",Ie(t.end_time)]})]}),e.jsxs("div",{className:"flex items-center shrink-0",children:[e.jsx(L,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:()=>s(t),title:"Modifier",children:e.jsx(kn,{className:"h-3 w-3"})}),e.jsx(L,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:()=>o(t),title:"Exception",children:e.jsx(_t,{className:"h-3 w-3"})})]})]}),e.jsxs("div",{className:"flex items-center gap-1 text-muted-foreground",children:[e.jsx(Mn,{className:"h-2.5 w-2.5 shrink-0"}),e.jsx("span",{className:"truncate text-[10px]",children:t.location})]}),t.assignments.length>0&&e.jsx("div",{className:"space-y-1 pt-0.5",children:t.assignments.map(i=>e.jsxs("div",{className:"flex items-center gap-1 flex-wrap",children:[e.jsx(ie,{variant:"secondary",className:"text-[10px] px-1.5 py-0",children:i.group_name}),e.jsxs("span",{className:"text-[10px] text-muted-foreground truncate",children:[i.coach_name,i.lane_count!=null&&` · ${i.lane_count}L`]})]},i.id))}),n.length>0&&e.jsx("div",{className:"space-y-0.5 pt-1 border-t border-dashed",children:n.map(i=>e.jsxs("div",{className:"flex items-center gap-1 text-[10px]",children:[e.jsx(_t,{className:"h-2.5 w-2.5 text-orange-500 shrink-0"}),e.jsx("span",{className:"text-muted-foreground",children:new Date(i.override_date+"T00:00:00").toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit"})}),e.jsx(ie,{variant:i.status==="cancelled"?"destructive":"outline",className:"text-[9px] px-1 py-0",children:i.status==="cancelled"?"Annule":"Modifie"}),e.jsx(L,{variant:"ghost",size:"icon",className:"h-4 w-4 ml-auto shrink-0 text-muted-foreground hover:text-destructive",onClick:()=>a(i.id),title:"Supprimer",children:e.jsx(et,{className:"h-2 w-2"})})]},i.id))})]}),Ca=({onBack:t,groups:n})=>{const{toast:s}=le(),o=he(),[a,i]=r.useState(!1),[u,l]=r.useState(null),[g,m]=r.useState(null),[p,h]=r.useState(!1),[f,x]=r.useState("group"),[c,v]=r.useState("all"),[C,b]=r.useState("all"),{data:y=[],isLoading:F}=Q({queryKey:["training-slots"],queryFn:()=>O.getTrainingSlots()}),{data:z=[]}=Q({queryKey:["training-slot-overrides","upcoming"],queryFn:()=>O.getSlotOverrides({fromDate:ba()})}),{data:P=[]}=Q({queryKey:["users","coaches"],queryFn:()=>O.listUsers({role:"coach"})}),_=r.useMemo(()=>{if(f==="coach"&&c!=="all"){const d=Number(c);return y.filter(N=>N.assignments.some(I=>I.coach_id===d))}if(f==="group"&&C!=="all"){const d=Number(C);return y.filter(N=>N.assignments.some(I=>I.group_id===d))}return y},[y,f,c,C]),E=r.useMemo(()=>{const d=new Map;for(let N=1;N<=7;N++)d.set(N,[]);for(const N of _)d.get(N.day_of_week).push(N);for(const N of d.values())N.sort((I,G)=>I.start_time.localeCompare(G.start_time));return d},[_]),M=r.useMemo(()=>{const d=new Map;for(const N of z){const I=d.get(N.slot_id)??[];I.push(N),d.set(N.slot_id,I)}return d},[z]),w=W({mutationFn:d=>O.deleteSlotOverride(d),onSuccess:()=>{s({title:"Exception supprimee"}),o.invalidateQueries({queryKey:["training-slot-overrides"]})},onError:d=>{s({title:"Erreur",description:d.message,variant:"destructive"})}}),T=()=>{l(null),i(!0)},$=d=>{l(d),i(!0)},V=d=>{m(d),h(!0)},q=P.map(d=>({id:d.id,display_name:d.display_name})),S=y.length===0?"Planning hebdomadaire des entrainements.":`${y.length} creneau${y.length>1?"x":""}`;return e.jsxs("div",{className:"space-y-4 pb-24",children:[e.jsx(me,{title:"Creneaux",description:S,onBack:t,actions:e.jsxs(L,{variant:"outline",size:"sm",onClick:T,children:[e.jsx(ue,{className:"mr-1.5 h-3.5 w-3.5"}),"Nouveau"]})}),e.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center",children:[e.jsxs(Ze,{type:"single",value:f,onValueChange:d=>{(d==="coach"||d==="group")&&x(d)},className:"shrink-0",children:[e.jsx(ce,{value:"group",className:"text-xs px-3",children:"Groupe"}),e.jsx(ce,{value:"coach",className:"text-xs px-3",children:"Coach"})]}),f==="group"?e.jsxs(te,{value:C,onValueChange:b,children:[e.jsx(se,{className:"w-full sm:w-56",children:e.jsx(ne,{placeholder:"Tous les groupes"})}),e.jsxs(re,{children:[e.jsx(H,{value:"all",children:"Tous les groupes"}),n.map(d=>e.jsx(H,{value:String(d.id),children:d.name},d.id))]})]}):e.jsxs(te,{value:c,onValueChange:v,children:[e.jsx(se,{className:"w-full sm:w-56",children:e.jsx(ne,{placeholder:"Tous les coachs"})}),e.jsxs(re,{children:[e.jsx(H,{value:"all",children:"Tous les coachs"}),P.map(d=>e.jsx(H,{value:String(d.id),children:d.display_name},d.id))]})]})]}),F?e.jsx("div",{className:"grid grid-cols-7 gap-2",children:Array.from({length:7},(d,N)=>e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-4 w-12 rounded bg-muted animate-pulse motion-reduce:animate-none"}),e.jsx("div",{className:"h-20 rounded-lg bg-muted animate-pulse motion-reduce:animate-none"})]},N))}):y.length===0?e.jsxs("div",{className:"text-center py-12 space-y-3",children:[e.jsx(yt,{className:"h-10 w-10 text-muted-foreground mx-auto"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Aucun creneau defini."}),e.jsxs(L,{variant:"outline",size:"sm",onClick:T,children:[e.jsx(ue,{className:"mr-1.5 h-3.5 w-3.5"}),"Creer le premier creneau"]})]}):e.jsx("div",{className:"overflow-x-auto -mx-4 px-4",children:e.jsx("div",{className:"grid grid-cols-7 gap-2",style:{minWidth:"700px"},children:Array.from({length:7},(d,N)=>N+1).map(d=>{const N=E.get(d)??[];return e.jsxs("div",{className:"min-w-0",children:[e.jsxs("div",{className:"text-center mb-2",children:[e.jsx("span",{className:"text-[10px] font-semibold uppercase tracking-[0.15em] text-muted-foreground sm:hidden",children:ja[d-1]}),e.jsx("span",{className:"text-[10px] font-semibold uppercase tracking-[0.15em] text-muted-foreground hidden sm:inline",children:Gs[d-1]})]}),e.jsx("div",{className:"space-y-2 min-h-[60px]",children:N.length===0?e.jsx("div",{className:"rounded-lg border border-dashed p-2 text-center",children:e.jsx("span",{className:"text-[10px] text-muted-foreground/50",children:"—"})}):N.map(I=>e.jsx(wa,{slot:I,overrides:M.get(I.id)??[],onEdit:$,onOverride:V,onDeleteOverride:G=>w.mutate(G)},I.id))})]},d)})})}),e.jsx(ya,{open:a,onOpenChange:i,slot:u,groups:n,coaches:q}),e.jsx(Na,{open:p,onOpenChange:h,slot:g})]})},Sa=r.lazy(()=>Vt(()=>import("./StrengthCatalog-BjUrHn3-.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44]))),_a=r.lazy(()=>Vt(()=>import("./SwimCatalog-Cdn8-Vzw.js"),__vite__mapDeps([45,1,2,3,4,5,6,7,9,10,11,12,18,25,46,47,17,48,49,16,43,21,22,23,24,15,20,26,27,28,29,30,8,14,38,32,50,51,34]))),ka=({onNavigate:t,onOpenRecordsAdmin:n,onOpenRecordsClub:s,athletes:o,athletesLoading:a,upcomingBirthdays:i,birthdaysLoading:u,kpiLoading:l,kpiPeriod:g,onKpiPeriodChange:m,fatigueAlerts:p,mostLoadedAthlete:h,swimSessionCount:f,strengthSessionCount:x})=>{const c=new Date().getHours(),v=c<12?"Bonjour":c<18?"Bon après-midi":"Bonsoir",C=new Date().toLocaleDateString("fr-FR",{weekday:"long",day:"numeric",month:"long"}),b=p.length>0;return e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-display font-bold uppercase italic",children:[v,", ",e.jsx("span",{className:"text-primary",children:"Coach"})]}),e.jsx("p",{className:"text-sm text-muted-foreground capitalize",children:C})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h2",{className:"text-xs font-semibold uppercase tracking-[0.15em] text-muted-foreground",children:["Signaux · ",g,"j"]}),e.jsxs(Ze,{type:"single",size:"sm",variant:"outline",value:String(g),onValueChange:y=>{y&&m(Number(y))},children:[e.jsx(ce,{value:"7",className:"h-7 px-2 text-xs","aria-label":"7 jours",children:"7j"}),e.jsx(ce,{value:"30",className:"h-7 px-2 text-xs","aria-label":"30 jours",children:"30j"}),e.jsx(ce,{value:"365",className:"h-7 px-2 text-xs","aria-label":"1 an",children:"1an"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:`rounded-xl border p-3 ${b?"border-destructive/30 bg-destructive/5":"bg-muted/30"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-[11px] text-muted-foreground",children:"Fatigue 5/5"}),e.jsx(Fn,{className:`h-3.5 w-3.5 ${b?"text-destructive":"text-muted-foreground"}`})]}),e.jsx("p",{className:"text-xl font-bold tabular-nums",children:l?"–":p.length}),e.jsx("p",{className:"text-[11px] text-muted-foreground truncate",children:l?"Chargement…":b?p.slice(0,2).map(y=>y.athleteName.split(" ")[0]).join(", "):"Aucune alerte"})]}),e.jsxs("div",{className:"rounded-xl border bg-muted/30 p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-[11px] text-muted-foreground",children:"Plus chargé"}),e.jsx(Xe,{className:"h-3.5 w-3.5 text-muted-foreground"})]}),e.jsx("p",{className:"text-xl font-bold truncate",children:l?"–":h?.athleteName?.split(" ")[0]??"–"}),e.jsx("p",{className:"text-[11px] text-muted-foreground",children:l?"Calcul…":h?`Charge ${Math.round(h.loadScore)}`:"Pas de données"})]})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs("button",{type:"button",onClick:()=>t("calendar"),className:"flex items-center gap-1.5 rounded-full bg-primary text-primary-foreground px-3.5 py-2 text-sm font-semibold active:opacity-80 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",children:[e.jsx(ut,{className:"h-3.5 w-3.5"}),"Assigner"]}),e.jsxs("button",{type:"button",onClick:()=>t("messaging"),className:"flex items-center gap-1.5 rounded-full border px-3.5 py-2 text-sm font-semibold active:bg-muted focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",children:[e.jsx(es,{className:"h-3.5 w-3.5"}),"Email"]}),e.jsxs("button",{type:"button",onClick:()=>t("sms"),className:"flex items-center gap-1.5 rounded-full border px-3.5 py-2 text-sm font-semibold active:bg-muted focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",children:[e.jsx(Ut,{className:"h-3.5 w-3.5"}),"SMS"]}),e.jsxs("button",{type:"button",onClick:()=>t("groups"),className:"flex items-center gap-1.5 rounded-full border px-3.5 py-2 text-sm font-semibold active:bg-muted focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",children:[e.jsx(ts,{className:"h-3.5 w-3.5"}),"Groupes"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("button",{type:"button",onClick:()=>t("swim"),className:"rounded-xl border bg-card p-4 text-left shadow-sm active:bg-muted/50 transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",children:[e.jsx(Kt,{className:"h-5 w-5 text-primary mb-2"}),e.jsx("p",{className:"text-sm font-bold",children:"Natation"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:f!=null?`${f} séance${f!==1?"s":""}`:"Bibliothèque"})]}),e.jsxs("button",{type:"button",onClick:()=>t("strength"),className:"rounded-xl border bg-card p-4 text-left shadow-sm active:bg-muted/50 transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",children:[e.jsx(Gt,{className:"h-5 w-5 text-primary mb-2"}),e.jsx("p",{className:"text-sm font-bold",children:"Musculation"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:x!=null?`${x} séance${x!==1?"s":""}`:"Bibliothèque"})]}),e.jsxs("button",{type:"button",onClick:()=>t("swimmers"),className:"rounded-xl border bg-card p-4 text-left shadow-sm active:bg-muted/50 transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",children:[e.jsx(Xe,{className:"h-5 w-5 text-primary mb-2"}),e.jsx("p",{className:"text-sm font-bold",children:"Nageurs"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:a?"Chargement…":`${o.length} nageur${o.length!==1?"s":""}`})]}),e.jsxs("button",{type:"button",onClick:n,className:"rounded-xl border bg-card p-4 text-left shadow-sm active:bg-muted/50 transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",children:[e.jsx(ct,{className:"h-5 w-5 text-primary mb-2"}),e.jsx("p",{className:"text-sm font-bold",children:"Records club"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Import & administration"})]}),e.jsxs("button",{type:"button",onClick:()=>t("competitions"),className:"rounded-xl border bg-card p-4 text-left shadow-sm active:bg-muted/50 transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",children:[e.jsx(ct,{className:"h-5 w-5 text-amber-500 mb-2"}),e.jsx("p",{className:"text-sm font-bold",children:"Compétitions"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Échéances & calendrier"})]}),e.jsxs("button",{type:"button",onClick:()=>t("objectives"),className:"rounded-xl border bg-card p-4 text-left shadow-sm active:bg-muted/50 transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",children:[e.jsx(dt,{className:"h-5 w-5 text-primary mb-2"}),e.jsx("p",{className:"text-sm font-bold",children:"Objectifs"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Temps cibles & objectifs"})]}),e.jsxs("button",{type:"button",onClick:()=>t("training-slots"),className:"rounded-xl border bg-card p-4 text-left shadow-sm active:bg-muted/50 transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",children:[e.jsx(yt,{className:"h-5 w-5 text-primary mb-2"}),e.jsx("p",{className:"text-sm font-bold",children:"Creneaux"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Planning hebdo"})]})]}),e.jsx("button",{type:"button",onClick:s,className:"w-full text-center text-sm text-primary font-semibold py-1 active:opacity-70 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring rounded",children:"Voir les records du club"}),!u&&i&&i.length>0?e.jsxs("div",{className:"space-y-2",children:[e.jsx("h2",{className:"text-xs font-semibold uppercase tracking-[0.15em] text-muted-foreground",children:"Anniversaires"}),e.jsx("div",{className:"space-y-1.5",children:i.slice(0,3).map(y=>e.jsxs("div",{className:"flex items-center justify-between gap-2 rounded-lg border px-3 py-2",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("span",{className:"text-sm font-medium truncate block",children:y.display_name}),e.jsx("span",{className:"text-[11px] text-muted-foreground",children:Ma(y.next_birthday)})]}),e.jsxs("span",{className:"text-xs font-bold text-primary shrink-0",children:["J-",y.days_until]})]},y.id))})]}):null]})},Ma=t=>{if(!t)return"-";const n=new Date(t);return Number.isNaN(n.getTime())?t:n.toLocaleDateString("fr-FR")},Ot=t=>t.toISOString().split("T")[0],Aa=t=>new Date(t.completed_at||t.started_at||t.date||t.created_at||0).getTime(),Ea=t=>{if(!t.length)return null;const n=t.reduce((o,a)=>o+a,0)/t.length,s=Math.min(5,Math.max(1,Math.round(n/10*5)));return{average:n,rating:s}};function Ra(){const t=kt(_=>_.role),n=kt(_=>_.setSelectedAthlete),[,s]=Zs(),[o,a]=r.useState(()=>window.location.hash.match(/[?&]section=([^&]+)/)?.[1]||"home"),[i,u]=r.useState(7);r.useEffect(()=>{const _=()=>a("home");return window.addEventListener("nav:reset",_),()=>window.removeEventListener("nav:reset",_)},[]);const l=t==="coach"||t==="admin",g=o==="home"||o==="calendar",m=o==="home"||o==="messaging"||o==="sms"||o==="swimmers"||o==="calendar"||o==="groups"||o==="objectives",p=o==="messaging"||o==="sms"||o==="calendar"||o==="groups"||o==="training-slots",h=o==="home"||o==="swimmers",{data:f}=Q({queryKey:["swim_catalog"],queryFn:()=>O.getSwimCatalog(),enabled:l&&g}),{data:x}=Q({queryKey:["strength_catalog"],queryFn:()=>O.getStrengthSessions(),enabled:l&&g}),{data:c=[],isLoading:v}=Q({queryKey:["athletes"],queryFn:()=>O.getAthletes(),enabled:l&&m}),C=r.useMemo(()=>c.slice(0,5),[c]),{data:b=[]}=Q({queryKey:["groups"],queryFn:()=>O.getGroups(),enabled:l&&p}),y=Q({queryKey:["upcoming-birthdays"],queryFn:()=>O.getUpcomingBirthdays({days:30}),enabled:l&&h}),F=y.data,z=Q({queryKey:["coach-kpis",i,C.map(_=>_.id??_.display_name)],enabled:l&&o==="home"&&C.length>0,queryFn:async()=>{const _=i,E=new Date;E.setDate(E.getDate()-_);const M=Ot(E),w=Ot(new Date),T=await Promise.all(C.map(async q=>{const[S,d]=await Promise.all([O.getSessions(q.display_name,q.id),O.getStrengthHistory(q.display_name,{athleteId:q.id,limit:50,from:M,to:w})]),N=S.filter(k=>new Date(k.date).getTime()>=E.getTime()),I=N.map(k=>k.fatigue??k.feeling).filter(k=>Number.isFinite(k)),G=N.reduce((k,A)=>k+(Number(A.duration)||0)*(Number(A.effort)||0),0),D=(d?.runs??[]).filter(k=>Aa(k)>=E.getTime()),Y=D.map(k=>k.fatigue??k.feeling??k.rpe).filter(k=>Number.isFinite(Number(k))).map(k=>Number(k)),j=D.reduce((k,A)=>{const K=Number(A.feeling??A.rpe??0),U=Number(A.duration??0);if(U>0&&K>0)return k+U*K;const Z=Array.isArray(A.logs)?A.logs.length:0;return k+Z*5},0),R=Ea([...I,...Y]);return{athleteName:q.display_name,loadScore:G+j,fatigueRating:R}})),$=T.filter(q=>q.fatigueRating?.rating===5).map(q=>({athleteName:q.athleteName,rating:q.fatigueRating?.rating??0})),V=T.filter(q=>q.loadScore>0).sort((q,S)=>S.loadScore-q.loadScore)[0];return{fatigueAlerts:$,mostLoadedAthlete:V??null}}}),P=_=>{n({id:_.id??null,name:_.display_name}),s(_.id!=null?`/coach/swimmer/${_.id}`:"/progress")};return le(),l?e.jsxs("div",{className:"space-y-6",children:[o==="home"?e.jsx(ka,{onNavigate:a,onOpenRecordsAdmin:()=>s("/records-admin"),onOpenRecordsClub:()=>s("/records-club"),athletes:c,athletesLoading:v,upcomingBirthdays:F,birthdaysLoading:y.isLoading,kpiLoading:z.isLoading,kpiPeriod:i,onKpiPeriodChange:u,fatigueAlerts:z.data?.fatigueAlerts??[],mostLoadedAthlete:z.data?.mostLoadedAthlete??null,swimSessionCount:f?.length,strengthSessionCount:x?.length}):null,o==="swim"?e.jsxs("div",{className:"space-y-6",children:[e.jsx(me,{title:"Bibliothèque natation",description:"Accédez aux séances et aux templates natation.",onBack:()=>a("home"),actions:e.jsxs(L,{variant:"outline",size:"sm",onClick:()=>a("calendar"),children:[e.jsx(ut,{className:"mr-1.5 h-3.5 w-3.5"}),"Assigner"]})}),e.jsx(r.Suspense,{fallback:e.jsx(Mt,{}),children:e.jsx(_a,{})})]}):null,o==="strength"?e.jsxs("div",{className:"space-y-6",children:[e.jsx(me,{title:"Bibliothèque musculation",description:"Consultez et créez des séances musculation.",onBack:()=>a("home"),actions:e.jsxs(L,{variant:"outline",size:"sm",onClick:()=>a("calendar"),children:[e.jsx(ut,{className:"mr-1.5 h-3.5 w-3.5"}),"Assigner"]})}),e.jsx(r.Suspense,{fallback:e.jsx(Mt,{}),children:e.jsx(Sa,{})})]}):null,o==="swimmers"?e.jsx(qn,{athletes:c,athletesLoading:v,onBack:()=>a("home"),onOpenAthlete:P}):null,o==="messaging"?e.jsx(zn,{onBack:()=>a("home"),athletes:c,groups:b,athletesLoading:v}):null,o==="sms"?e.jsx(Or,{onBack:()=>a("home"),athletes:c,groups:b,athletesLoading:v}):null,o==="calendar"?e.jsx(Kr,{onBack:()=>a("home"),athletes:c,groups:b,swimSessions:f,strengthSessions:x}):null,o==="groups"?e.jsx(Ur,{onBack:()=>a("home"),athletes:c,groups:b,athletesLoading:v}):null,o==="competitions"?e.jsx(ea,{onBack:()=>a("home")}):null,o==="objectives"?e.jsx(ra,{onBack:()=>a("home"),athletes:c,athletesLoading:v}):null,o==="training-slots"?e.jsx(Ca,{onBack:()=>a("home"),groups:b}):null]}):e.jsx("div",{className:"flex items-center justify-center min-h-[60vh] animate-in fade-in motion-reduce:animate-none",children:e.jsxs(qe,{className:"w-full max-w-sm shadow-xl border-t-4 border-t-primary",children:[e.jsxs(ze,{children:[e.jsxs(Le,{className:"flex items-center gap-2 uppercase italic",children:[e.jsx(Xe,{className:"h-5 w-5 text-primary"}),"Accès Coach"]}),e.jsx(Ke,{children:"Cette section est réservée aux coachs et administrateurs."})]}),e.jsx(Ge,{children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"Connectez-vous avec un compte autorisé pour accéder aux outils de gestion."})})]})})}const io=Object.freeze(Object.defineProperty({__proto__:null,default:Ra},Symbol.toStringTag,{value:"Module"}));export{Ns as C,dr as P,Ks as R,ws as a,Cs as b,Ss as c,ht as d,xt as e,ur as f,ps as g,ft as h,io as i};
