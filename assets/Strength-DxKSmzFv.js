import{R as m,T as zs,G as qs,H as Bs,J as Vs,K as Ks,r as d,O as Us,j as e}from"./vendor-ui-DJQMR4VV.js";import{b as as,u as Be,c as it,d as Ws}from"./vendor-query-BT4y-huw.js";import{c as zt,a as be,f as qt,D as We,B as Y,C as Ve,g as vt,h as Bt,l as is,i as pt,L as Je,p as Qs,X as xt,q as Ys,d as ye,I as Dt,u as Xs,S as Ne}from"./index-CFdl5Q7y.js";import{S as Mt}from"./switch-DDRwoEv7.js";import{T as Gs,a as Js,b as Qt,c as Yt}from"./tabs-C2n4jbSx.js";import{B as ot}from"./badge-Dm-CN4Xe.js";import{S as At,a as It,b as Ot,c as $t,d as Zs}from"./sheet-Jz22BOuQ.js";import{A as os,a as ls,b as cs,c as ds,d as us,e as ms,f as fs,g as hs,P as ps}from"./alert-dialog-Cg1DXy9D.js";import{B as xs,C as Pt,I as en}from"./BottomActionBar-D4SicsxW.js";import{c as st}from"./design-tokens-CGMys_0P.js";import{L as tn}from"./loader-circle-DXFkqT4u.js";import{C as sn}from"./circle-check-Dap3K7er.js";import{S as nn}from"./sticky-note-B8VDXi6z.js";import{C as Xt}from"./check-BA45BSHM.js";import{T as rn}from"./timer-C6NxL-6G.js";import{m as Lt,s as an,l as on,f as ln}from"./animations-BTr26p-C.js";import{S as cn}from"./search-2guQu0z4.js";import{f as yt}from"./fr-CqUxEDd2.js";import{f as bt}from"./vendor-date-cQbdWov0.js";import{C as gs}from"./chevron-left-CJZw_PbG.js";import{S as dn,a as un,b as mn,c as fn,d as mt}from"./select-pOY1BaTD.js";import{C as hn}from"./circle-alert-BhK2UQ0L.js";import"./vendor-react-BzrpNAyj.js";import"./vendor-charts-Db4xOvcx.js";import"./vendor-supabase-D7B1G6YZ.js";import"./chevron-up-DFViaBOJ.js";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pn=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],xn=zt("calendar",pn);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gn=[["rect",{x:"14",y:"3",width:"5",height:"18",rx:"1",key:"kaeet6"}],["rect",{x:"5",y:"3",width:"5",height:"18",rx:"1",key:"1wsw3u"}]],vn=zt("pause",gn);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yn=[["path",{d:"M10 5H3",key:"1qgfaw"}],["path",{d:"M12 19H3",key:"yhmn1j"}],["path",{d:"M14 3v4",key:"1sua03"}],["path",{d:"M16 17v4",key:"1q0r14"}],["path",{d:"M21 12h-9",key:"1o4lsq"}],["path",{d:"M21 19h-5",key:"1rlt1p"}],["path",{d:"M21 5h-7",key:"1oszz2"}],["path",{d:"M8 10v4",key:"tgpxqk"}],["path",{d:"M8 12H3",key:"a7s4jb"}]],bn=zt("sliders-horizontal",yn);function wn(t){if(typeof document>"u")return;let s=document.head||document.getElementsByTagName("head")[0],n=document.createElement("style");n.type="text/css",s.appendChild(n),n.styleSheet?n.styleSheet.cssText=t:n.appendChild(document.createTextNode(t))}const vs=m.createContext({drawerRef:{current:null},overlayRef:{current:null},onPress:()=>{},onRelease:()=>{},onDrag:()=>{},onNestedDrag:()=>{},onNestedOpenChange:()=>{},onNestedRelease:()=>{},openProp:void 0,dismissible:!1,isOpen:!1,isDragging:!1,keyboardIsOpen:{current:!1},snapPointsOffset:null,snapPoints:null,handleOnly:!1,modal:!1,shouldFade:!1,activeSnapPoint:null,onOpenChange:()=>{},setActiveSnapPoint:()=>{},closeDrawer:()=>{},direction:"bottom",shouldAnimate:{current:!0},shouldScaleBackground:!1,setBackgroundColorOnScale:!0,noBodyStyles:!1,container:null,autoFocus:!1}),lt=()=>{const t=m.useContext(vs);if(!t)throw new Error("useDrawerContext must be used within a Drawer.Root");return t};wn(`[data-vaul-drawer]{touch-action:none;will-change:transform;transition:transform .5s cubic-bezier(.32, .72, 0, 1);animation-duration:.5s;animation-timing-function:cubic-bezier(0.32,0.72,0,1)}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=bottom][data-state=open]{animation-name:slideFromBottom}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=bottom][data-state=closed]{animation-name:slideToBottom}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=top][data-state=open]{animation-name:slideFromTop}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=top][data-state=closed]{animation-name:slideToTop}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=left][data-state=open]{animation-name:slideFromLeft}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=left][data-state=closed]{animation-name:slideToLeft}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=right][data-state=open]{animation-name:slideFromRight}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=right][data-state=closed]{animation-name:slideToRight}[data-vaul-drawer][data-vaul-snap-points=true][data-vaul-drawer-direction=bottom]{transform:translate3d(0,var(--initial-transform,100%),0)}[data-vaul-drawer][data-vaul-snap-points=true][data-vaul-drawer-direction=top]{transform:translate3d(0,calc(var(--initial-transform,100%) * -1),0)}[data-vaul-drawer][data-vaul-snap-points=true][data-vaul-drawer-direction=left]{transform:translate3d(calc(var(--initial-transform,100%) * -1),0,0)}[data-vaul-drawer][data-vaul-snap-points=true][data-vaul-drawer-direction=right]{transform:translate3d(var(--initial-transform,100%),0,0)}[data-vaul-drawer][data-vaul-delayed-snap-points=true][data-vaul-drawer-direction=top]{transform:translate3d(0,var(--snap-point-height,0),0)}[data-vaul-drawer][data-vaul-delayed-snap-points=true][data-vaul-drawer-direction=bottom]{transform:translate3d(0,var(--snap-point-height,0),0)}[data-vaul-drawer][data-vaul-delayed-snap-points=true][data-vaul-drawer-direction=left]{transform:translate3d(var(--snap-point-height,0),0,0)}[data-vaul-drawer][data-vaul-delayed-snap-points=true][data-vaul-drawer-direction=right]{transform:translate3d(var(--snap-point-height,0),0,0)}[data-vaul-overlay][data-vaul-snap-points=false]{animation-duration:.5s;animation-timing-function:cubic-bezier(0.32,0.72,0,1)}[data-vaul-overlay][data-vaul-snap-points=false][data-state=open]{animation-name:fadeIn}[data-vaul-overlay][data-state=closed]{animation-name:fadeOut}[data-vaul-animate=false]{animation:none!important}[data-vaul-overlay][data-vaul-snap-points=true]{opacity:0;transition:opacity .5s cubic-bezier(.32, .72, 0, 1)}[data-vaul-overlay][data-vaul-snap-points=true]{opacity:1}[data-vaul-drawer]:not([data-vaul-custom-container=true])::after{content:'';position:absolute;background:inherit;background-color:inherit}[data-vaul-drawer][data-vaul-drawer-direction=top]::after{top:initial;bottom:100%;left:0;right:0;height:200%}[data-vaul-drawer][data-vaul-drawer-direction=bottom]::after{top:100%;bottom:initial;left:0;right:0;height:200%}[data-vaul-drawer][data-vaul-drawer-direction=left]::after{left:initial;right:100%;top:0;bottom:0;width:200%}[data-vaul-drawer][data-vaul-drawer-direction=right]::after{left:100%;right:initial;top:0;bottom:0;width:200%}[data-vaul-overlay][data-vaul-snap-points=true]:not([data-vaul-snap-points-overlay=true]):not(
[data-state=closed]
){opacity:0}[data-vaul-overlay][data-vaul-snap-points-overlay=true]{opacity:1}[data-vaul-handle]{display:block;position:relative;opacity:.7;background:#e2e2e4;margin-left:auto;margin-right:auto;height:5px;width:32px;border-radius:1rem;touch-action:pan-y}[data-vaul-handle]:active,[data-vaul-handle]:hover{opacity:1}[data-vaul-handle-hitarea]{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);width:max(100%,2.75rem);height:max(100%,2.75rem);touch-action:inherit}@media (hover:hover) and (pointer:fine){[data-vaul-drawer]{user-select:none}}@media (pointer:fine){[data-vaul-handle-hitarea]:{width:100%;height:100%}}@keyframes fadeIn{from{opacity:0}to{opacity:1}}@keyframes fadeOut{to{opacity:0}}@keyframes slideFromBottom{from{transform:translate3d(0,var(--initial-transform,100%),0)}to{transform:translate3d(0,0,0)}}@keyframes slideToBottom{to{transform:translate3d(0,var(--initial-transform,100%),0)}}@keyframes slideFromTop{from{transform:translate3d(0,calc(var(--initial-transform,100%) * -1),0)}to{transform:translate3d(0,0,0)}}@keyframes slideToTop{to{transform:translate3d(0,calc(var(--initial-transform,100%) * -1),0)}}@keyframes slideFromLeft{from{transform:translate3d(calc(var(--initial-transform,100%) * -1),0,0)}to{transform:translate3d(0,0,0)}}@keyframes slideToLeft{to{transform:translate3d(calc(var(--initial-transform,100%) * -1),0,0)}}@keyframes slideFromRight{from{transform:translate3d(var(--initial-transform,100%),0,0)}to{transform:translate3d(0,0,0)}}@keyframes slideToRight{to{transform:translate3d(var(--initial-transform,100%),0,0)}}`);function jn(){const t=navigator.userAgent;return typeof window<"u"&&(/Firefox/.test(t)&&/Mobile/.test(t)||/FxiOS/.test(t))}function Nn(){return Vt(/^Mac/)}function Sn(){return Vt(/^iPhone/)}function Gt(){return/^((?!chrome|android).)*safari/i.test(navigator.userAgent)}function _n(){return Vt(/^iPad/)||Nn()&&navigator.maxTouchPoints>1}function ys(){return Sn()||_n()}function Vt(t){return typeof window<"u"&&window.navigator!=null?t.test(window.navigator.platform):void 0}const Cn=24,Rn=typeof window<"u"?d.useLayoutEffect:d.useEffect;function Jt(...t){return(...s)=>{for(let n of t)typeof n=="function"&&n(...s)}}const _t=typeof document<"u"&&window.visualViewport;function Zt(t){let s=window.getComputedStyle(t);return/(auto|scroll)/.test(s.overflow+s.overflowX+s.overflowY)}function bs(t){for(Zt(t)&&(t=t.parentElement);t&&!Zt(t);)t=t.parentElement;return t||document.scrollingElement||document.documentElement}const En=new Set(["checkbox","radio","range","color","file","image","button","submit","reset"]);let ft=0,Ct;function kn(t={}){let{isDisabled:s}=t;Rn(()=>{if(!s)return ft++,ft===1&&ys()&&(Ct=Tn()),()=>{ft--,ft===0&&Ct?.()}},[s])}function Tn(){let t,s=0,n=i=>{t=bs(i.target),!(t===document.documentElement&&t===document.body)&&(s=i.changedTouches[0].pageY)},r=i=>{if(!t||t===document.documentElement||t===document.body){i.preventDefault();return}let v=i.changedTouches[0].pageY,T=t.scrollTop,$=t.scrollHeight-t.clientHeight;$!==0&&((T<=0&&v>s||T>=$&&v<s)&&i.preventDefault(),s=v)},l=i=>{let v=i.target;Ft(v)&&v!==document.activeElement&&(i.preventDefault(),v.style.transform="translateY(-2000px)",v.focus(),requestAnimationFrame(()=>{v.style.transform=""}))},o=i=>{let v=i.target;Ft(v)&&(v.style.transform="translateY(-2000px)",requestAnimationFrame(()=>{v.style.transform="",_t&&(_t.height<window.innerHeight?requestAnimationFrame(()=>{es(v)}):_t.addEventListener("resize",()=>es(v),{once:!0}))}))},p=()=>{window.scrollTo(0,0)},f=window.pageXOffset,x=window.pageYOffset,S=Jt(Dn(document.documentElement,"paddingRight",`${window.innerWidth-document.documentElement.clientWidth}px`));window.scrollTo(0,0);let h=Jt(nt(document,"touchstart",n,{passive:!1,capture:!0}),nt(document,"touchmove",r,{passive:!1,capture:!0}),nt(document,"touchend",l,{passive:!1,capture:!0}),nt(document,"focus",o,!0),nt(window,"scroll",p));return()=>{S(),h(),window.scrollTo(f,x)}}function Dn(t,s,n){let r=t.style[s];return t.style[s]=n,()=>{t.style[s]=r}}function nt(t,s,n,r){return t.addEventListener(s,n,r),()=>{t.removeEventListener(s,n,r)}}function es(t){let s=document.scrollingElement||document.documentElement;for(;t&&t!==s;){let n=bs(t);if(n!==document.documentElement&&n!==document.body&&n!==t){let r=n.getBoundingClientRect().top,l=t.getBoundingClientRect().top,o=t.getBoundingClientRect().bottom;const p=n.getBoundingClientRect().bottom+Cn;o>p&&(n.scrollTop+=l-r)}t=n.parentElement}}function Ft(t){return t instanceof HTMLInputElement&&!En.has(t.type)||t instanceof HTMLTextAreaElement||t instanceof HTMLElement&&t.isContentEditable}function Mn(t,s){typeof t=="function"?t(s):t!=null&&(t.current=s)}function An(...t){return s=>t.forEach(n=>Mn(n,s))}function ws(...t){return d.useCallback(An(...t),t)}const js=new WeakMap;function le(t,s,n=!1){if(!t||!(t instanceof HTMLElement))return;let r={};Object.entries(s).forEach(([l,o])=>{if(l.startsWith("--")){t.style.setProperty(l,o);return}r[l]=t.style[l],t.style[l]=o}),!n&&js.set(t,r)}function In(t,s){if(!t||!(t instanceof HTMLElement))return;let n=js.get(t);n&&(t.style[s]=n[s])}const oe=t=>{switch(t){case"top":case"bottom":return!0;case"left":case"right":return!1;default:return t}};function ht(t,s){if(!t)return null;const n=window.getComputedStyle(t),r=n.transform||n.webkitTransform||n.mozTransform;let l=r.match(/^matrix3d\((.+)\)$/);return l?parseFloat(l[1].split(", ")[oe(s)?13:12]):(l=r.match(/^matrix\((.+)\)$/),l?parseFloat(l[1].split(", ")[oe(s)?5:4]):null)}function On(t){return 8*(Math.log(t+1)-2)}function Rt(t,s){if(!t)return()=>{};const n=t.style.cssText;return Object.assign(t.style,s),()=>{t.style.cssText=n}}function $n(...t){return(...s)=>{for(const n of t)typeof n=="function"&&n(...s)}}const se={DURATION:.5,EASE:[.32,.72,0,1]},Ns=.4,Pn=.25,Ln=100,Ss=8,Ue=16,Ht=26,Et="vaul-dragging";function _s(t){const s=m.useRef(t);return m.useEffect(()=>{s.current=t}),m.useMemo(()=>(...n)=>s.current==null?void 0:s.current.call(s,...n),[])}function Fn({defaultProp:t,onChange:s}){const n=m.useState(t),[r]=n,l=m.useRef(r),o=_s(s);return m.useEffect(()=>{l.current!==r&&(o(r),l.current=r)},[r,l,o]),n}function Cs({prop:t,defaultProp:s,onChange:n=()=>{}}){const[r,l]=Fn({defaultProp:s,onChange:n}),o=t!==void 0,p=o?t:r,f=_s(n),x=m.useCallback(S=>{if(o){const i=typeof S=="function"?S(t):S;i!==t&&f(i)}else l(S)},[o,t,l,f]);return[p,x]}function Hn({activeSnapPointProp:t,setActiveSnapPointProp:s,snapPoints:n,drawerRef:r,overlayRef:l,fadeFromIndex:o,onSnapPointChange:p,direction:f="bottom",container:x,snapToSequentialPoint:S}){const[h,i]=Cs({prop:t,defaultProp:n?.[0],onChange:s}),[v,T]=m.useState(typeof window<"u"?{innerWidth:window.innerWidth,innerHeight:window.innerHeight}:void 0);m.useEffect(()=>{function w(){T({innerWidth:window.innerWidth,innerHeight:window.innerHeight})}return window.addEventListener("resize",w),()=>window.removeEventListener("resize",w)},[]);const $=m.useMemo(()=>h===n?.[n.length-1]||null,[n,h]),D=m.useMemo(()=>{var w;return(w=n?.findIndex(M=>M===h))!=null?w:null},[n,h]),q=n&&n.length>0&&(o||o===0)&&!Number.isNaN(o)&&n[o]===h||!n,j=m.useMemo(()=>{const w=x?{width:x.getBoundingClientRect().width,height:x.getBoundingClientRect().height}:typeof window<"u"?{width:window.innerWidth,height:window.innerHeight}:{width:0,height:0};var M;return(M=n?.map(O=>{const E=typeof O=="string";let y=0;if(E&&(y=parseInt(O,10)),oe(f)){const b=E?y:v?O*w.height:0;return v?f==="bottom"?w.height-b:-w.height+b:b}const K=E?y:v?O*w.width:0;return v?f==="right"?w.width-K:-w.width+K:K}))!=null?M:[]},[n,v,x]),A=m.useMemo(()=>D!==null?j?.[D]:null,[j,D]),P=m.useCallback(w=>{var M;const O=(M=j?.findIndex(E=>E===w))!=null?M:null;p(O),le(r.current,{transition:`transform ${se.DURATION}s cubic-bezier(${se.EASE.join(",")})`,transform:oe(f)?`translate3d(0, ${w}px, 0)`:`translate3d(${w}px, 0, 0)`}),j&&O!==j.length-1&&o!==void 0&&O!==o&&O<o?le(l.current,{transition:`opacity ${se.DURATION}s cubic-bezier(${se.EASE.join(",")})`,opacity:"0"}):le(l.current,{transition:`opacity ${se.DURATION}s cubic-bezier(${se.EASE.join(",")})`,opacity:"1"}),i(n?.[Math.max(O,0)])},[r.current,n,j,o,l,i]);m.useEffect(()=>{if(h||t){var w;const M=(w=n?.findIndex(O=>O===t||O===h))!=null?w:-1;j&&M!==-1&&typeof j[M]=="number"&&P(j[M])}},[h,t,n,j,P]);function g({draggedDistance:w,closeDrawer:M,velocity:O,dismissible:E}){if(o===void 0)return;const y=f==="bottom"||f==="right"?(A??0)-w:(A??0)+w,K=D===o-1,b=D===0,ee=w>0;if(K&&le(l.current,{transition:`opacity ${se.DURATION}s cubic-bezier(${se.EASE.join(",")})`}),!S&&O>2&&!ee){E?M():P(j[0]);return}if(!S&&O>2&&ee&&j&&n){P(j[n.length-1]);return}const L=j?.reduce((B,Z)=>typeof B!="number"||typeof Z!="number"?B:Math.abs(Z-y)<Math.abs(B-y)?Z:B),X=oe(f)?window.innerHeight:window.innerWidth;if(O>Ns&&Math.abs(w)<X*.4){const B=ee?1:-1;if(B>0&&$&&n){P(j[n.length-1]);return}if(b&&B<0&&E&&M(),D===null)return;P(j[D+B]);return}P(L)}function U({draggedDistance:w}){if(A===null)return;const M=f==="bottom"||f==="right"?A-w:A+w;(f==="bottom"||f==="right")&&M<j[j.length-1]||(f==="top"||f==="left")&&M>j[j.length-1]||le(r.current,{transform:oe(f)?`translate3d(0, ${M}px, 0)`:`translate3d(${M}px, 0, 0)`})}function W(w,M){if(!n||typeof D!="number"||!j||o===void 0)return null;const O=D===o-1;if(D>=o&&M)return 0;if(O&&!M)return 1;if(!q&&!O)return null;const y=O?D+1:D-1,K=O?j[y]-j[y-1]:j[y+1]-j[y],b=w/Math.abs(K);return O?1-b:b}return{isLastSnapPoint:$,activeSnapPoint:h,shouldFade:q,getPercentageDragged:W,setActiveSnapPoint:i,activeSnapPointIndex:D,onRelease:g,onDrag:U,snapPointsOffset:j}}const zn=()=>()=>{};function qn(){const{direction:t,isOpen:s,shouldScaleBackground:n,setBackgroundColorOnScale:r,noBodyStyles:l}=lt(),o=m.useRef(null),p=d.useMemo(()=>document.body.style.backgroundColor,[]);function f(){return(window.innerWidth-Ht)/window.innerWidth}m.useEffect(()=>{if(s&&n){o.current&&clearTimeout(o.current);const x=document.querySelector("[data-vaul-drawer-wrapper]")||document.querySelector("[vaul-drawer-wrapper]");if(!x)return;$n(r&&!l?Rt(document.body,{background:"black"}):zn,Rt(x,{transformOrigin:oe(t)?"top":"left",transitionProperty:"transform, border-radius",transitionDuration:`${se.DURATION}s`,transitionTimingFunction:`cubic-bezier(${se.EASE.join(",")})`}));const S=Rt(x,{borderRadius:`${Ss}px`,overflow:"hidden",...oe(t)?{transform:`scale(${f()}) translate3d(0, calc(env(safe-area-inset-top) + 14px), 0)`}:{transform:`scale(${f()}) translate3d(calc(env(safe-area-inset-top) + 14px), 0, 0)`}});return()=>{S(),o.current=window.setTimeout(()=>{p?document.body.style.background=p:document.body.style.removeProperty("background")},se.DURATION*1e3)}}},[s,n,p])}let rt=null;function Bn({isOpen:t,modal:s,nested:n,hasBeenOpened:r,preventScrollRestoration:l,noBodyStyles:o}){const[p,f]=m.useState(()=>typeof window<"u"?window.location.href:""),x=m.useRef(0),S=m.useCallback(()=>{if(Gt()&&rt===null&&t&&!o){rt={position:document.body.style.position,top:document.body.style.top,left:document.body.style.left,height:document.body.style.height,right:"unset"};const{scrollX:i,innerHeight:v}=window;document.body.style.setProperty("position","fixed","important"),Object.assign(document.body.style,{top:`${-x.current}px`,left:`${-i}px`,right:"0px",height:"auto"}),window.setTimeout(()=>window.requestAnimationFrame(()=>{const T=v-window.innerHeight;T&&x.current>=v&&(document.body.style.top=`${-(x.current+T)}px`)}),300)}},[t]),h=m.useCallback(()=>{if(Gt()&&rt!==null&&!o){const i=-parseInt(document.body.style.top,10),v=-parseInt(document.body.style.left,10);Object.assign(document.body.style,rt),window.requestAnimationFrame(()=>{if(l&&p!==window.location.href){f(window.location.href);return}window.scrollTo(v,i)}),rt=null}},[p]);return m.useEffect(()=>{function i(){x.current=window.scrollY}return i(),window.addEventListener("scroll",i),()=>{window.removeEventListener("scroll",i)}},[]),m.useEffect(()=>{if(s)return()=>{typeof document>"u"||document.querySelector("[data-vaul-drawer]")||h()}},[s,h]),m.useEffect(()=>{n||!r||(t?(!window.matchMedia("(display-mode: standalone)").matches&&S(),s||window.setTimeout(()=>{h()},500)):h())},[t,r,p,s,n,S,h]),{restorePositionSetting:h}}function Vn({open:t,onOpenChange:s,children:n,onDrag:r,onRelease:l,snapPoints:o,shouldScaleBackground:p=!1,setBackgroundColorOnScale:f=!0,closeThreshold:x=Pn,scrollLockTimeout:S=Ln,dismissible:h=!0,handleOnly:i=!1,fadeFromIndex:v=o&&o.length-1,activeSnapPoint:T,setActiveSnapPoint:$,fixed:D,modal:q=!0,onClose:j,nested:A,noBodyStyles:P=!1,direction:g="bottom",defaultOpen:U=!1,disablePreventScroll:W=!0,snapToSequentialPoint:w=!1,preventScrollRestoration:M=!1,repositionInputs:O=!0,onAnimationEnd:E,container:y,autoFocus:K=!1}){var b,ee;const[L=!1,X]=Cs({defaultProp:U,prop:t,onChange:N=>{s?.(N),!N&&!A&&u(),setTimeout(()=>{E?.(N)},se.DURATION*1e3),N&&!q&&typeof window<"u"&&window.requestAnimationFrame(()=>{document.body.style.pointerEvents="auto"}),N||(document.body.style.pointerEvents="auto")}}),[B,Z]=m.useState(!1),[me,Ce]=m.useState(!1),[de,Fe]=m.useState(!1),c=m.useRef(null),G=m.useRef(null),ne=m.useRef(null),ce=m.useRef(null),ie=m.useRef(null),ue=m.useRef(!1),V=m.useRef(null),Re=m.useRef(0),Te=m.useRef(!1),He=m.useRef(!U),Ke=m.useRef(0),_=m.useRef(null),pe=m.useRef(((b=_.current)==null?void 0:b.getBoundingClientRect().height)||0),De=m.useRef(((ee=_.current)==null?void 0:ee.getBoundingClientRect().width)||0),we=m.useRef(0),Se=m.useCallback(N=>{o&&N===Me.length-1&&(G.current=new Date)},[]),{activeSnapPoint:Ze,activeSnapPointIndex:fe,setActiveSnapPoint:ze,onRelease:qe,snapPointsOffset:Me,onDrag:Qe,shouldFade:Ye,getPercentageDragged:Xe}=Hn({snapPoints:o,activeSnapPointProp:T,setActiveSnapPointProp:$,drawerRef:_,fadeFromIndex:v,overlayRef:c,onSnapPointChange:Se,direction:g,container:y,snapToSequentialPoint:w});kn({isDisabled:!L||me||!q||de||!B||!O||!W});const{restorePositionSetting:u}=Bn({isOpen:L,modal:q,nested:A??!1,hasBeenOpened:B,preventScrollRestoration:M,noBodyStyles:P});function C(){return(window.innerWidth-Ht)/window.innerWidth}function he(N){var H,Q;!h&&!o||_.current&&!_.current.contains(N.target)||(pe.current=((H=_.current)==null?void 0:H.getBoundingClientRect().height)||0,De.current=((Q=_.current)==null?void 0:Q.getBoundingClientRect().width)||0,Ce(!0),ne.current=new Date,ys()&&window.addEventListener("touchend",()=>ue.current=!1,{once:!0}),N.target.setPointerCapture(N.pointerId),Re.current=oe(g)?N.pageY:N.pageX)}function xe(N,H){var Q;let F=N;const z=(Q=window.getSelection())==null?void 0:Q.toString(),J=_.current?ht(_.current,g):null,re=new Date;if(F.tagName==="SELECT"||F.hasAttribute("data-vaul-no-drag")||F.closest("[data-vaul-no-drag]"))return!1;if(g==="right"||g==="left")return!0;if(G.current&&re.getTime()-G.current.getTime()<500)return!1;if(J!==null&&(g==="bottom"?J>0:J<0))return!0;if(z&&z.length>0)return!1;if(ie.current&&re.getTime()-ie.current.getTime()<S&&J===0||H)return ie.current=re,!1;for(;F;){if(F.scrollHeight>F.clientHeight){if(F.scrollTop!==0)return ie.current=new Date,!1;if(F.getAttribute("role")==="dialog")return!0}F=F.parentNode}return!0}function te(N){if(_.current&&me){const H=g==="bottom"||g==="right"?1:-1,Q=(Re.current-(oe(g)?N.pageY:N.pageX))*H,F=Q>0,z=o&&!h&&!F;if(z&&fe===0)return;const J=Math.abs(Q),re=document.querySelector("[data-vaul-drawer-wrapper]"),Ee=g==="bottom"||g==="top"?pe.current:De.current;let ve=J/Ee;const ke=Xe(J,F);if(ke!==null&&(ve=ke),z&&ve>=1||!ue.current&&!xe(N.target,F))return;if(_.current.classList.add(Et),ue.current=!0,le(_.current,{transition:"none"}),le(c.current,{transition:"none"}),o&&Qe({draggedDistance:Q}),F&&!o){const _e=On(Q),Ge=Math.min(_e*-1,0)*H;le(_.current,{transform:oe(g)?`translate3d(0, ${Ge}px, 0)`:`translate3d(${Ge}px, 0, 0)`});return}const Ae=1-ve;if((Ye||v&&fe===v-1)&&(r?.(N,ve),le(c.current,{opacity:`${Ae}`,transition:"none"},!0)),re&&c.current&&p){const _e=Math.min(C()+ve*(1-C()),1),Ge=8-ve*8,et=Math.max(0,14-ve*14);le(re,{borderRadius:`${Ge}px`,transform:oe(g)?`scale(${_e}) translate3d(0, ${et}px, 0)`:`scale(${_e}) translate3d(${et}px, 0, 0)`,transition:"none"},!0)}if(!o){const _e=J*H;le(_.current,{transform:oe(g)?`translate3d(0, ${_e}px, 0)`:`translate3d(${_e}px, 0, 0)`})}}}m.useEffect(()=>{window.requestAnimationFrame(()=>{He.current=!0})},[]),m.useEffect(()=>{var N;function H(){if(!_.current||!O)return;const Q=document.activeElement;if(Ft(Q)||Te.current){var F;const z=((F=window.visualViewport)==null?void 0:F.height)||0,J=window.innerHeight;let re=J-z;const Ee=_.current.getBoundingClientRect().height||0,ve=Ee>J*.8;we.current||(we.current=Ee);const ke=_.current.getBoundingClientRect().top;if(Math.abs(Ke.current-re)>60&&(Te.current=!Te.current),o&&o.length>0&&Me&&fe){const Ae=Me[fe]||0;re+=Ae}if(Ke.current=re,Ee>z||Te.current){const Ae=_.current.getBoundingClientRect().height;let _e=Ae;Ae>z&&(_e=z-(ve?ke:Ht)),D?_.current.style.height=`${Ae-Math.max(re,0)}px`:_.current.style.height=`${Math.max(_e,z-ke)}px`}else jn()||(_.current.style.height=`${we.current}px`);o&&o.length>0&&!Te.current?_.current.style.bottom="0px":_.current.style.bottom=`${Math.max(re,0)}px`}}return(N=window.visualViewport)==null||N.addEventListener("resize",H),()=>{var Q;return(Q=window.visualViewport)==null?void 0:Q.removeEventListener("resize",H)}},[fe,o,Me]);function je(N){ge(),j?.(),N||X(!1),setTimeout(()=>{o&&ze(o[0])},se.DURATION*1e3)}function I(){if(!_.current)return;const N=document.querySelector("[data-vaul-drawer-wrapper]"),H=ht(_.current,g);le(_.current,{transform:"translate3d(0, 0, 0)",transition:`transform ${se.DURATION}s cubic-bezier(${se.EASE.join(",")})`}),le(c.current,{transition:`opacity ${se.DURATION}s cubic-bezier(${se.EASE.join(",")})`,opacity:"1"}),p&&H&&H>0&&L&&le(N,{borderRadius:`${Ss}px`,overflow:"hidden",...oe(g)?{transform:`scale(${C()}) translate3d(0, calc(env(safe-area-inset-top) + 14px), 0)`,transformOrigin:"top"}:{transform:`scale(${C()}) translate3d(calc(env(safe-area-inset-top) + 14px), 0, 0)`,transformOrigin:"left"},transitionProperty:"transform, border-radius",transitionDuration:`${se.DURATION}s`,transitionTimingFunction:`cubic-bezier(${se.EASE.join(",")})`},!0)}function ge(){!me||!_.current||(_.current.classList.remove(Et),ue.current=!1,Ce(!1),ce.current=new Date)}function ct(N){if(!me||!_.current)return;_.current.classList.remove(Et),ue.current=!1,Ce(!1),ce.current=new Date;const H=ht(_.current,g);if(!N||!xe(N.target,!1)||!H||Number.isNaN(H)||ne.current===null)return;const Q=ce.current.getTime()-ne.current.getTime(),F=Re.current-(oe(g)?N.pageY:N.pageX),z=Math.abs(F)/Q;if(z>.05&&(Fe(!0),setTimeout(()=>{Fe(!1)},200)),o){qe({draggedDistance:F*(g==="bottom"||g==="right"?1:-1),closeDrawer:je,velocity:z,dismissible:h}),l?.(N,!0);return}if(g==="bottom"||g==="right"?F>0:F<0){I(),l?.(N,!0);return}if(z>Ns){je(),l?.(N,!1);return}var J;const re=Math.min((J=_.current.getBoundingClientRect().height)!=null?J:0,window.innerHeight);var Ee;const ve=Math.min((Ee=_.current.getBoundingClientRect().width)!=null?Ee:0,window.innerWidth),ke=g==="left"||g==="right";if(Math.abs(H)>=(ke?ve:re)*x){je(),l?.(N,!1);return}l?.(N,!0),I()}m.useEffect(()=>(L&&(le(document.documentElement,{scrollBehavior:"auto"}),G.current=new Date),()=>{In(document.documentElement,"scrollBehavior")}),[L]);function wt(N){const H=N?(window.innerWidth-Ue)/window.innerWidth:1,Q=N?-Ue:0;V.current&&window.clearTimeout(V.current),le(_.current,{transition:`transform ${se.DURATION}s cubic-bezier(${se.EASE.join(",")})`,transform:oe(g)?`scale(${H}) translate3d(0, ${Q}px, 0)`:`scale(${H}) translate3d(${Q}px, 0, 0)`}),!N&&_.current&&(V.current=setTimeout(()=>{const F=ht(_.current,g);le(_.current,{transition:"none",transform:oe(g)?`translate3d(0, ${F}px, 0)`:`translate3d(${F}px, 0, 0)`})},500))}function dt(N,H){if(H<0)return;const Q=(window.innerWidth-Ue)/window.innerWidth,F=Q+H*(1-Q),z=-Ue+H*Ue;le(_.current,{transform:oe(g)?`scale(${F}) translate3d(0, ${z}px, 0)`:`scale(${F}) translate3d(${z}px, 0, 0)`,transition:"none"})}function Ie(N,H){const Q=oe(g)?window.innerHeight:window.innerWidth,F=H?(Q-Ue)/Q:1,z=H?-Ue:0;H&&le(_.current,{transition:`transform ${se.DURATION}s cubic-bezier(${se.EASE.join(",")})`,transform:oe(g)?`scale(${F}) translate3d(0, ${z}px, 0)`:`scale(${F}) translate3d(${z}px, 0, 0)`})}return m.useEffect(()=>{q||window.requestAnimationFrame(()=>{document.body.style.pointerEvents="auto"})},[q]),m.createElement(Bs,{defaultOpen:U,onOpenChange:N=>{!h&&!N||(N?Z(!0):je(!0),X(N))},open:L},m.createElement(vs.Provider,{value:{activeSnapPoint:Ze,snapPoints:o,setActiveSnapPoint:ze,drawerRef:_,overlayRef:c,onOpenChange:s,onPress:he,onRelease:ct,onDrag:te,dismissible:h,shouldAnimate:He,handleOnly:i,isOpen:L,isDragging:me,shouldFade:Ye,closeDrawer:je,onNestedDrag:dt,onNestedOpenChange:wt,onNestedRelease:Ie,keyboardIsOpen:Te,modal:q,snapPointsOffset:Me,activeSnapPointIndex:fe,direction:g,shouldScaleBackground:p,setBackgroundColorOnScale:f,noBodyStyles:P,container:y,autoFocus:K}},n))}const Rs=m.forwardRef(function({...t},s){const{overlayRef:n,snapPoints:r,onRelease:l,shouldFade:o,isOpen:p,modal:f,shouldAnimate:x}=lt(),S=ws(s,n),h=r&&r.length>0;if(!f)return null;const i=m.useCallback(v=>l(v),[l]);return m.createElement(Us,{onMouseUp:i,ref:S,"data-vaul-overlay":"","data-vaul-snap-points":p&&h?"true":"false","data-vaul-snap-points-overlay":p&&o?"true":"false","data-vaul-animate":x?.current?"true":"false",...t})});Rs.displayName="Drawer.Overlay";const Es=m.forwardRef(function({onPointerDownOutside:t,style:s,onOpenAutoFocus:n,...r},l){const{drawerRef:o,onPress:p,onRelease:f,onDrag:x,keyboardIsOpen:S,snapPointsOffset:h,activeSnapPointIndex:i,modal:v,isOpen:T,direction:$,snapPoints:D,container:q,handleOnly:j,shouldAnimate:A,autoFocus:P}=lt(),[g,U]=m.useState(!1),W=ws(l,o),w=m.useRef(null),M=m.useRef(null),O=m.useRef(!1),E=D&&D.length>0;qn();const y=(b,ee,L=0)=>{if(O.current)return!0;const X=Math.abs(b.y),B=Math.abs(b.x),Z=B>X,me=["bottom","right"].includes(ee)?1:-1;if(ee==="left"||ee==="right"){if(!(b.x*me<0)&&B>=0&&B<=L)return Z}else if(!(b.y*me<0)&&X>=0&&X<=L)return!Z;return O.current=!0,!0};m.useEffect(()=>{E&&window.requestAnimationFrame(()=>{U(!0)})},[]);function K(b){w.current=null,O.current=!1,f(b)}return m.createElement(Ks,{"data-vaul-drawer-direction":$,"data-vaul-drawer":"","data-vaul-delayed-snap-points":g?"true":"false","data-vaul-snap-points":T&&E?"true":"false","data-vaul-custom-container":q?"true":"false","data-vaul-animate":A?.current?"true":"false",...r,ref:W,style:h&&h.length>0?{"--snap-point-height":`${h[i??0]}px`,...s}:s,onPointerDown:b=>{j||(r.onPointerDown==null||r.onPointerDown.call(r,b),w.current={x:b.pageX,y:b.pageY},p(b))},onOpenAutoFocus:b=>{n?.(b),P||b.preventDefault()},onPointerDownOutside:b=>{if(t?.(b),!v||b.defaultPrevented){b.preventDefault();return}S.current&&(S.current=!1)},onFocusOutside:b=>{if(!v){b.preventDefault();return}},onPointerMove:b=>{if(M.current=b,j||(r.onPointerMove==null||r.onPointerMove.call(r,b),!w.current))return;const ee=b.pageY-w.current.y,L=b.pageX-w.current.x,X=b.pointerType==="touch"?10:2;y({x:L,y:ee},$,X)?x(b):(Math.abs(L)>X||Math.abs(ee)>X)&&(w.current=null)},onPointerUp:b=>{r.onPointerUp==null||r.onPointerUp.call(r,b),w.current=null,O.current=!1,f(b)},onPointerOut:b=>{r.onPointerOut==null||r.onPointerOut.call(r,b),K(M.current)},onContextMenu:b=>{r.onContextMenu==null||r.onContextMenu.call(r,b),M.current&&K(M.current)}})});Es.displayName="Drawer.Content";const Kn=250,Un=120,Wn=m.forwardRef(function({preventCycle:t=!1,children:s,...n},r){const{closeDrawer:l,isDragging:o,snapPoints:p,activeSnapPoint:f,setActiveSnapPoint:x,dismissible:S,handleOnly:h,isOpen:i,onPress:v,onDrag:T}=lt(),$=m.useRef(null),D=m.useRef(!1);function q(){if(D.current){P();return}window.setTimeout(()=>{j()},Un)}function j(){if(o||t||D.current){P();return}if(P(),!p||p.length===0){S||l();return}if(f===p[p.length-1]&&S){l();return}const U=p.findIndex(w=>w===f);if(U===-1)return;const W=p[U+1];x(W)}function A(){$.current=window.setTimeout(()=>{D.current=!0},Kn)}function P(){$.current&&window.clearTimeout($.current),D.current=!1}return m.createElement("div",{onClick:q,onPointerCancel:P,onPointerDown:g=>{h&&v(g),A()},onPointerMove:g=>{h&&T(g)},ref:r,"data-vaul-drawer-visible":i?"true":"false","data-vaul-handle":"","aria-hidden":"true",...n},m.createElement("span",{"data-vaul-handle-hitarea":"","aria-hidden":"true"},s))});Wn.displayName="Drawer.Handle";function Qn(t){const s=lt(),{container:n=s.container,...r}=t;return m.createElement(Vs,{container:n,...r})}const Le={Root:Vn,Content:Es,Overlay:Rs,Portal:Qn,Title:zs,Description:qs},ks=({shouldScaleBackground:t=!0,...s})=>e.jsx(Le.Root,{shouldScaleBackground:t,...s});ks.displayName="Drawer";const Yn=Le.Portal,Ts=d.forwardRef(({className:t,...s},n)=>e.jsx(Le.Overlay,{ref:n,className:be("fixed inset-0 z-50 bg-black/80 motion-reduce:animate-none",t),...s}));Ts.displayName=Le.Overlay.displayName;const Ds=d.forwardRef(({className:t,children:s,...n},r)=>e.jsxs(Yn,{children:[e.jsx(Ts,{}),e.jsxs(Le.Content,{ref:r,className:be("fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background motion-reduce:animate-none",t),...n,children:[e.jsx("div",{className:"mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted"}),s]})]}));Ds.displayName="DrawerContent";const Ms=({className:t,...s})=>e.jsx("div",{className:be("grid gap-1.5 p-4 text-center sm:text-left",t),...s});Ms.displayName="DrawerHeader";const As=d.forwardRef(({className:t,...s},n)=>e.jsx(Le.Title,{ref:n,className:be("text-lg font-semibold leading-none tracking-tight",t),...s}));As.displayName=Le.Title.displayName;const Is=d.forwardRef(({className:t,...s},n)=>e.jsx(Le.Description,{ref:n,className:be("text-sm text-muted-foreground",t),...s}));Is.displayName=Le.Description.displayName;const Xn=[1,2,3,4,5];function ts({value:t,onChange:s,className:n,disabled:r=!1,size:l="md",ariaLabel:o="Sélecteur d'échelle 1 à 5"}){const p=l==="sm"?"h-10 w-10 text-xs":"h-11 w-11 text-sm";return e.jsx("div",{className:be("flex items-center gap-2",n),role:"group","aria-label":o,children:Xn.map(f=>{const x=t===f;return e.jsx("button",{type:"button",className:be("flex items-center justify-center rounded-full border font-semibold transition",p,x?"border-primary bg-primary text-primary-foreground":"border-muted-foreground/30 bg-background text-foreground",r&&"opacity-60"),"aria-pressed":x,disabled:r,onClick:()=>{r||s?.(f)},children:f},f)})})}const Gn=()=>{try{const t=new(window.AudioContext||window.webkitAudioContext),s=t.createOscillator(),n=t.createGain();s.connect(n),n.connect(t.destination),s.frequency.value=880,n.gain.value=.3,s.start(),s.stop(t.currentTime+.25);const r=t.createOscillator(),l=t.createGain();r.connect(l),l.connect(t.destination),r.frequency.value=1100,l.gain.value=.3,r.start(t.currentTime+.35),r.stop(t.currentTime+.6),r.onended=()=>t.close()}catch{}try{navigator.vibrate?.([200,100,200])}catch{}},gt=(t,s)=>{const n=Number(t?.set_index??t?.set_number??t?.setIndex??s);return!Number.isFinite(n)||n<=0?s:n},Os=(t=[],s,n)=>{if(!t.length)return 0;const r=Array.isArray(s)?s:[];if(r.length>0){const p=new Map;r.forEach((x,S)=>{if(!x?.exercise_id)return;const h=p.get(x.exercise_id)??[];h.push({...x,set_index:gt(x,S+1)}),p.set(x.exercise_id,h)});let f=t.length+1;for(let x=0;x<t.length;x+=1){const S=t[x];if((p.get(S.exercise_id)??[]).length<(S.sets??0)){f=x+1;break}}return f}const l=Number(n??0);if(!Number.isFinite(l)||l<=0)return 0;const o=Math.min(t.length,Math.max(0,Math.round(l/100*t.length)));return Math.min(t.length,o+1)},Pe=(t,s)=>{const n=Number(t);return!Number.isFinite(n)||n<=0?"—":s?`${n}${s}`:String(n)};function Jn({session:t,exercises:s,oneRMs:n,onFinish:r,onStart:l,onLogSets:o,onProgress:p,initialLogs:f,isFinishing:x,initialStep:S,onStepChange:h,initialInputOpen:i,initialSeriesOpen:v,onExitFocus:T,exerciseNotes:$,onUpdateNote:D}){const{toast:q}=qt(),j=d.useRef(!1),[A,P]=d.useState(S??0),[g,U]=d.useState([]),[W,w]=d.useState(0),[M,O]=d.useState(!0),E=d.useRef(Date.now()),y=d.useRef(0),[K,b]=d.useState(0),[ee,L]=d.useState(!1),[X,B]=d.useState(!1),Z=d.useRef(0),[me,Ce]=d.useState(!0),[de,Fe]=d.useState(3),[c,G]=d.useState(3),[ne,ce]=d.useState(""),[ie,ue]=d.useState(!1),[V,Re]=d.useState(1),[Te,He]=d.useState(v??!1),[Ke,_]=d.useState(i??!1),[pe,De]=d.useState("weight"),[we,Se]=d.useState(""),[Ze,fe]=d.useState(!1),[ze,qe]=d.useState(!1),[Me,Qe]=d.useState(!1),[Ye,Xe]=d.useState(!1),[u,C]=d.useState(!1),[he,xe]=d.useState("");d.useEffect(()=>{if(!M)return;const a=()=>{const k=Math.floor((Date.now()-E.current)/1e3)+y.current;w(k)};a();const R=setInterval(a,1e3),ae=()=>{document.visibilityState==="visible"&&a()};return document.addEventListener("visibilitychange",ae),()=>{clearInterval(R),document.removeEventListener("visibilitychange",ae)}},[M]),d.useEffect(()=>{if(!ze)return;const a=R=>{R.key==="Escape"&&qe(!1)};return window.addEventListener("keydown",a),()=>window.removeEventListener("keydown",a)},[ze]),d.useEffect(()=>{if(!ee||X)return;const a=()=>{if(Z.current<=0)return;const k=Math.max(0,Math.ceil((Z.current-Date.now())/1e3));b(k),k<=0&&(Gn(),q({title:"Temps de récupération terminé"}),L(!1),B(!1))};a();const R=setInterval(a,1e3),ae=()=>{document.visibilityState==="visible"&&a()};return document.addEventListener("visibilitychange",ae),()=>{clearInterval(R),document.removeEventListener("visibilitychange",ae)}},[ee,X]);const te=t.items||[],je=A-1,I=A>0&&A<=te.length?te[je]:null,ge=I?s.find(a=>a.id===I.exercise_id):null,ct=A<te.length?te[A]:null,wt=ct?s.find(a=>a.id===ct.exercise_id):null,dt=(()=>{const a=ge?.muscle_groups??ge?.muscles??ge?.muscleGroups??[];return Array.isArray(a)?a:[]})(),Ie=I?.rest_seconds??0,N=te.length?Math.min(100,Math.max(0,Math.round((A-1)/te.length*100))):0,H=Number(I?.percent_1rm),Q=Number.isFinite(H)&&H>0,F=Q&&n.find(a=>a.exercise_id===I?.exercise_id)?.weight||0,z=Q?Math.round(F*(H/100)):0,[J,re]=d.useState({}),Ee=d.useMemo(()=>{const a=new Map;return g.forEach((R,ae)=>{const k=gt(R,ae+1);R.exercise_id&&a.set(`${R.exercise_id}-${k}`,R)}),a},[g]),ve=I?`${I.exercise_id}-${V}`:null,ke=ve?Ee.get(ve):null,Ae=ke?.weight??J[V-1]?.weight??z,_e=ke?.reps??J[V-1]?.reps??I?.reps??"",Ge=()=>{if(typeof window>"u")return;const a=[st.status.success,st.chart[2],st.chart[3],st.destructive,st.accent],R=120;for(let ae=0;ae<R;ae+=1){const k=document.createElement("div"),Oe=Math.random()*6+6;k.style.position="fixed",k.style.top="-10px",k.style.left=`${Math.random()*100}vw`,k.style.width=`${Oe}px`,k.style.height=`${Oe*.6}px`,k.style.backgroundColor=a[ae%a.length],k.style.opacity="0.9",k.style.pointerEvents="none",k.style.zIndex="80",k.style.borderRadius="2px",document.body.appendChild(k);const $e=(Math.random()-.5)*200,tt=1200+Math.random()*800,ut=Math.random()*360;k.animate([{transform:"translate3d(0, 0, 0) rotate(0deg)",opacity:1},{transform:`translate3d(${$e}px, ${window.innerHeight+200}px, 0) rotate(${ut}deg)`,opacity:0}],{duration:tt,easing:"ease-out"}).onfinish=()=>k.remove()}};d.useEffect(()=>{if(j.current){f&&U(f);return}if(!f){U(k=>k.length?[]:k),re(k=>Object.keys(k).length?{}:k);return}if(U(f),!f.length){re(k=>Object.keys(k).length?{}:k),P(k=>k===0?k:0);return}const a=t.items||[];if(!a.length)return;const R=new Map;f.forEach((k,Oe)=>{if(!k.exercise_id)return;const $e=R.get(k.exercise_id)??[];$e.push({...k,set_index:gt(k,Oe+1)}),R.set(k.exercise_id,$e)});const ae=Os(a,f);if(ae>0&&ae<=a.length){const k=a[ae-1],Oe=R.get(k.exercise_id)??[],$e=Oe.reduce((ut,St,Fs)=>{const Hs=gt(St,Fs+1);return ut[Hs-1]={reps:St.reps??void 0,weight:St.weight??void 0},ut},{});re($e);const tt=Math.min(k.sets??1,Oe.length+1);Re(tt)}else re({}),Re(1);P(k=>k===ae?k:ae)},[f,t.items]),d.useEffect(()=>{A<=te.length||ie||(Ge(),ue(!0))},[A,te.length,ie]);const et=a=>{P(a),h?.(a)},Kt=a=>{a<=0||(Z.current=Date.now()+a*1e3,b(a),L(!0),B(!1))},jt=async()=>{window.scrollTo({top:0,behavior:"smooth"});const a=A+1;Re(1),re({}),et(a);const R=Math.round(Math.min(a-1,te.length)/te.length*100);try{await p?.(R)}catch{q({title:"Erreur de sauvegarde",description:"Réessayez",variant:"destructive"})}},Ps=async()=>{if(!I)return;if(ke){V>=I.sets?await jt():Re(R=>Math.min(I.sets,R+1));return}const a={exercise_id:I.exercise_id,set_number:V,reps:J[V-1]?.reps||I.reps,weight:J[V-1]?.weight||z};U(R=>[...R,a]),j.current=!0;try{await o?.([a])}catch{q({title:"Erreur de sauvegarde",description:"Réessayez",variant:"destructive"})}finally{j.current=!1}if(me&&I.rest_seconds>0&&Kt(I.rest_seconds),V>=I.sets){await jt();return}Re(R=>Math.min(I.sets,R+1))},Ut=a=>{De(a);const R=a==="weight"?J[V-1]?.weight??z??"":J[V-1]?.reps??I?.reps??"";Se(R?String(R):""),fe(!!R),_(!0)},Ls=()=>{if(!I)return;const a=Number(pe==="weight"?we.replace(",","."):we);Number.isFinite(a)&&(re(R=>({...R,[V-1]:{...R[V-1],[pe]:a}})),_(!1))},Nt=a=>{if(Ze){fe(!1),Se(a);return}Se(R=>a==="."&&R.includes(".")?R:R+a)},Wt=a=>{if(!I)return;De(a);const R=a==="weight"?J[V-1]?.weight??z??"":J[V-1]?.reps??I?.reps??"";Se(R?String(R):""),fe(!!R)};return A===0?e.jsxs("div",{className:"space-y-6 text-center py-8 animate-in zoom-in duration-300",children:[e.jsx("div",{className:"h-24 w-24 bg-primary/10 rounded-full flex items-center justify-center mx-auto animate-pulse",children:e.jsx(We,{className:"h-10 w-10 text-primary ml-1"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold font-display uppercase",children:t.title}),e.jsx("p",{className:"text-muted-foreground text-lg",children:t.description}),e.jsxs("div",{className:"flex gap-2 justify-center mt-4",children:[e.jsx(ot,{variant:"outline",className:"text-sm px-3 py-1",children:t.cycle}),e.jsxs(ot,{variant:"secondary",className:"text-sm px-3 py-1",children:[te.length," Exercices"]})]})]}),e.jsx(Y,{size:"lg",className:"w-full text-xl h-14 font-bold uppercase tracking-wider shadow-lg hover:scale-[1.02] transition-transform",disabled:Me,onClick:async()=>{Qe(!0);try{await l?.(),et(1)}finally{Qe(!1)}},children:Me?e.jsxs(e.Fragment,{children:[e.jsx(tn,{className:"mr-2 h-5 w-5 animate-spin"}),"CHARGEMENT..."]}):"COMMENCER SÉANCE"})]}):A>te.length?e.jsx("div",{className:"space-y-6 animate-in fade-in",children:e.jsxs(Ve,{className:"border-t-8 border-t-primary shadow-xl",children:[e.jsxs(vt,{className:"text-center pb-2",children:[e.jsx("div",{className:"mx-auto bg-primary/10 p-4 rounded-full w-fit mb-4",children:e.jsx(sn,{className:"h-12 w-12 text-primary"})}),e.jsx(Bt,{className:"text-3xl uppercase font-display italic",children:"Séance Terminée !"}),e.jsxs(is,{className:"text-lg",children:["Durée totale: ",Math.floor(W/60),"m ",W%60,"s"]})]}),e.jsxs(pt,{className:"space-y-6 pt-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-center",children:[e.jsxs("div",{className:"bg-muted p-4 rounded-lg",children:[e.jsx("div",{className:"text-xs uppercase font-bold text-muted-foreground",children:"Volume"}),e.jsxs("div",{className:"text-2xl font-mono font-bold",children:[g.reduce((a,R)=>a+(Number(R.weight)||0)*(Number(R.reps)||0),0).toLocaleString("fr-FR")," kg"]})]}),e.jsxs("div",{className:"bg-muted p-4 rounded-lg",children:[e.jsx("div",{className:"text-xs uppercase font-bold text-muted-foreground",children:"Séries"}),e.jsx("div",{className:"text-2xl font-mono font-bold",children:g.length})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(Je,{className:"uppercase font-bold text-xs text-muted-foreground",children:"Difficulté de la séance"}),e.jsxs("div",{className:"flex items-center justify-between text-[11px] font-semibold text-muted-foreground",children:[e.jsx("span",{children:"Facile"}),e.jsx("span",{children:"Très dur"})]}),e.jsx(ts,{value:de,onChange:Fe})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(Je,{className:"uppercase font-bold text-xs text-muted-foreground",children:"Fatigue fin de séance"}),e.jsxs("div",{className:"flex items-center justify-between text-[11px] font-semibold text-muted-foreground",children:[e.jsx("span",{children:"Frais"}),e.jsx("span",{children:"Épuisé"})]}),e.jsx(ts,{value:c,onChange:G})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Je,{className:"uppercase font-bold text-xs text-muted-foreground",children:"Notes"}),e.jsx("textarea",{placeholder:"Sensations, douleurs...",value:ne,onChange:a=>ce(a.target.value),rows:3,className:"flex w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 resize-none"})]})]}),e.jsx(Qs,{children:e.jsx(Y,{className:"w-full h-14 text-lg font-bold uppercase",disabled:x,onClick:()=>{x||r({duration:Math.floor(W/60),feeling:de,fatigue:c,comments:ne,logs:g})},children:x?"ENREGISTREMENT...":"ENREGISTRER & FERMER"})})]})}):e.jsxs("div",{className:"space-y-6 pb-32",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{type:"button","aria-label":"Voir l'animation de l'exercice",onClick:()=>{ge?.illustration_gif&&qe(!0)},className:"flex h-10 w-10 shrink-0 items-center justify-center overflow-hidden rounded-full border bg-card shadow-sm",children:ge?.illustration_gif?e.jsx("img",{src:ge.illustration_gif,alt:"",className:"h-full w-full object-cover",loading:"lazy",decoding:"async"}):e.jsx(We,{className:"h-5 w-5 text-muted-foreground"})}),e.jsx("h2",{className:"flex-1 min-w-0 text-lg font-semibold tracking-tight truncate",children:ge?.nom_exercice??"Exercice"}),D&&I&&e.jsx(Y,{variant:"ghost",size:"icon",className:"h-8 w-8 shrink-0",onClick:()=>{xe($?.[I.exercise_id]??""),C(!0)},"aria-label":"Notes personnelles",children:e.jsx(nn,{className:be("h-4 w-4",$?.[I?.exercise_id]?"text-primary":"text-muted-foreground")})}),T&&e.jsx(Y,{variant:"ghost",size:"icon",className:"h-8 w-8 shrink-0","aria-label":"Quitter le focus",onClick:()=>{g.length>0?Xe(!0):T()},children:e.jsx(xt,{className:"h-4 w-4"})})]}),I&&$?.[I.exercise_id]&&e.jsx("p",{className:"text-xs italic text-muted-foreground line-clamp-1 -mt-1",children:$[I.exercise_id]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"rounded-full bg-primary/10 text-primary px-2.5 py-0.5 text-xs font-bold shrink-0",children:["Ex ",A,"/",te.length]}),e.jsxs("span",{className:"rounded-full bg-muted px-2.5 py-0.5 text-xs font-semibold shrink-0",children:["S ",V,"/",Pe(I?.sets)]}),e.jsx("div",{className:"flex-1 h-1.5 overflow-hidden rounded-full bg-muted",children:e.jsx("div",{className:"h-full rounded-full bg-primary transition-all",style:{width:`${N}%`}})}),e.jsxs("span",{className:"text-xs font-semibold text-muted-foreground shrink-0",children:[N,"%"]})]}),dt.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2",children:dt.map(a=>e.jsx("span",{className:"rounded-full bg-muted px-2.5 py-0.5 text-xs font-semibold text-muted-foreground",children:a},a))})]}),e.jsxs(Ve,{className:"rounded-3xl border bg-card p-4 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"text-sm font-semibold",children:["Série ",V,"/",Pe(I?.sets)," · ",Pe(I?.reps)," reps"]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsx(Mt,{checked:me,onCheckedChange:Ce,className:"scale-90"}),e.jsx("span",{children:"Auto repos"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("button",{type:"button",className:"group relative rounded-2xl border-2 border-primary/20 bg-gradient-to-br from-card to-muted/30 p-4 text-left shadow-sm transition-all active:scale-[0.98] hover:border-primary/40 hover:shadow-md",onClick:()=>Ut("weight"),children:[e.jsx("div",{className:"text-[10px] font-bold uppercase tracking-wide text-muted-foreground",children:"Charge"}),e.jsxs("div",{className:"mt-1 flex items-baseline gap-0.5",children:[e.jsx("span",{className:"text-3xl font-bold tabular-nums tracking-tight",children:Ae||"—"}),e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"kg"})]})]}),e.jsxs("button",{type:"button",className:"group relative rounded-2xl border-2 border-primary/20 bg-gradient-to-br from-card to-muted/30 p-4 text-left shadow-sm transition-all active:scale-[0.98] hover:border-primary/40 hover:shadow-md",onClick:()=>Ut("reps"),children:[e.jsx("div",{className:"text-[10px] font-bold uppercase tracking-wide text-muted-foreground",children:"Reps"}),e.jsxs("div",{className:"mt-1 flex items-baseline gap-0.5",children:[e.jsx("span",{className:"text-3xl font-bold tabular-nums tracking-tight",children:_e||"—"}),e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"reps"})]})]})]})]}),(I?.notes||ge?.description)&&e.jsx("div",{className:"rounded-2xl border bg-muted/10 px-4 py-3",children:e.jsx("p",{className:"text-sm text-muted-foreground line-clamp-2",children:I?.notes||ge?.description})}),e.jsx(Y,{variant:"outline",className:"w-full rounded-2xl",onClick:()=>He(!0),children:"Voir les séries"}),!Ke&&!ee?e.jsxs(xs,{className:"bottom-0 z-modal",containerClassName:"gap-3 py-4",children:[e.jsxs(Y,{className:"flex-1 min-w-0 h-12 rounded-xl text-sm font-bold shadow-lg active:scale-95 transition-transform",onClick:Ps,children:[e.jsx(Xt,{className:"mr-2 h-5 w-5"})," Valider série"]}),e.jsxs(Y,{type:"button",variant:"outline",className:"h-12 rounded-xl px-3 flex flex-col items-center justify-center gap-0.5 active:scale-95 transition-transform",onClick:()=>{Ie>0&&Kt(Ie)},disabled:Ie<=0,"aria-label":"Démarrer le repos",children:[e.jsx(rn,{className:"h-4 w-4"}),e.jsx("span",{className:"text-[10px] font-semibold leading-none",children:"Repos"})]}),e.jsxs(Y,{type:"button",variant:"outline",className:"h-12 rounded-xl px-3 flex flex-col items-center justify-center gap-0.5 active:scale-95 transition-transform",onClick:()=>jt(),"aria-label":"Exercice suivant",children:[e.jsx(Pt,{className:"h-4 w-4"}),e.jsx("span",{className:"text-[10px] font-semibold leading-none",children:"Suivant"})]})]}):null,ee&&e.jsxs("div",{className:"fixed inset-0 z-modal flex flex-col bg-background/95 pb-[env(safe-area-inset-bottom)]",children:[e.jsxs("div",{className:"flex items-start justify-between border-b px-6 py-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-semibold text-muted-foreground",children:"Timer"}),e.jsx("div",{className:"text-lg font-semibold",children:"Transition inter-exercice"}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Prochain exercice : ",wt?.nom_exercice??"À venir"]})]}),e.jsx(Y,{variant:"ghost",size:"icon",onClick:()=>{L(!1),B(!1)},"aria-label":"Fermer le timer de repos",children:e.jsx(xt,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"flex flex-1 flex-col items-center justify-center gap-6 px-6 py-8",children:[e.jsxs(Ve,{className:"w-full max-w-sm rounded-3xl border p-6 shadow-sm",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Temps restant"}),e.jsxs("div",{className:"mt-2 text-5xl font-semibold tracking-tight",children:[Math.floor(K/60),":",String(K%60).padStart(2,"0")]}),e.jsx("div",{className:"mt-6 h-3 w-full overflow-hidden rounded-full bg-muted",children:e.jsx("div",{className:"h-full rounded-full bg-primary",style:{width:Ie?`${K/Ie*100}%`:"0%"}})}),e.jsxs("div",{className:"mt-6 flex gap-3",children:[e.jsx(Y,{variant:"outline",className:"flex-1 h-12 rounded-full text-base font-semibold",onClick:()=>{Z.current+=30*1e3,b(a=>a+30)},children:"+30s"}),e.jsxs(Y,{variant:"outline",className:"flex-1 h-12 rounded-full text-base font-semibold",onClick:()=>{Z.current=Date.now()+Ie*1e3,b(Ie)},children:[e.jsx(Ys,{className:"mr-2 h-4 w-4"})," Reset"]})]})]}),e.jsxs("div",{className:"flex w-full max-w-sm flex-wrap gap-3",children:[e.jsxs(Y,{className:"flex-1 rounded-full py-6 text-base font-semibold",onClick:()=>{X&&(Z.current=Date.now()+K*1e3),B(a=>!a)},children:[e.jsx(vn,{className:"mr-2 h-4 w-4"})," ",X?"Reprendre":"Pause"]}),e.jsxs(Y,{variant:"outline",className:"rounded-full px-6 py-6 text-base font-semibold",onClick:()=>{Z.current=0,L(!1),b(0),B(!1)},children:["Passer ",e.jsx(Pt,{className:"ml-2 h-4 w-4"})]})]})]})]}),ze&&ge?.illustration_gif&&e.jsx("div",{className:"fixed inset-0 z-50 bg-black/50",onClick:()=>qe(!1),children:e.jsx("div",{className:"fixed inset-0 flex items-center justify-center p-4",onClick:a=>a.stopPropagation(),children:e.jsxs("div",{className:"relative",children:[e.jsx("button",{type:"button","aria-label":"Fermer",className:"absolute -right-3 -top-3 rounded-full bg-background p-2 shadow",onClick:()=>qe(!1),children:e.jsx(xt,{className:"h-4 w-4"})}),e.jsx("img",{src:ge.illustration_gif,alt:"",className:"max-h-[80vh] w-auto max-w-[92vw] rounded-2xl",loading:"lazy"})]})})}),e.jsx(At,{open:Te,onOpenChange:He,children:e.jsxs(It,{side:"bottom",className:"max-h-[80vh] overflow-y-auto",children:[e.jsx(Ot,{children:e.jsx($t,{children:"Aperçu séance"})}),e.jsx("div",{className:"mt-4 space-y-4",children:te.map((a,R)=>{const ae=s.find($e=>$e.id===a.exercise_id),k=Array.from({length:a.sets}).filter(($e,tt)=>Ee.get(`${a.exercise_id}-${tt+1}`)).length,Oe=a.sets?Math.round(k/a.sets*100):0;return e.jsxs(Ve,{className:"rounded-3xl border bg-muted/10 p-4 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-base font-semibold",children:ae?.nom_exercice??a.exercise_name}),e.jsxs("div",{className:"mt-1 text-sm text-muted-foreground",children:[Pe(a.sets),"x",Pe(a.reps)," ·"," ",a.percent_1rm?`${Pe(a.percent_1rm)} 1RM`:"—"]})]}),e.jsxs("div",{className:"rounded-full bg-muted px-3 py-1 text-sm font-semibold",children:[k,"/",Pe(a.sets)]})]}),e.jsx("div",{className:"mt-4 h-3 w-full overflow-hidden rounded-full bg-muted",children:e.jsx("div",{className:"h-full rounded-full bg-primary",style:{width:`${Oe}%`}})})]},`${a.exercise_id}-${R}`)})})]})}),e.jsx(ks,{open:Ke,onOpenChange:_,children:e.jsx(Ds,{className:"max-h-[90vh]",children:e.jsxs("div",{className:"mx-auto w-full max-w-md px-4 pb-8",children:[e.jsxs(Ms,{className:"pb-2",children:[e.jsx(As,{className:"text-center",children:pe==="weight"?"Charge":"Répétitions"}),e.jsxs(Is,{className:"text-center",children:["Série ",V,"/",Pe(I?.sets)," · Objectif"," ",Pe(I?.reps)," reps"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-4",children:[e.jsxs("button",{type:"button",className:be("rounded-xl border-2 p-4 text-center transition-all",pe==="weight"?"border-primary bg-primary/10 shadow-sm":"border-muted bg-card hover:border-muted-foreground/30"),onClick:()=>Wt("weight"),children:[e.jsx("div",{className:"text-xs font-semibold uppercase text-muted-foreground",children:"Charge"}),e.jsxs("div",{className:"mt-1 text-2xl font-bold tabular-nums",children:[pe==="weight"?we||"—":String(J[V-1]?.weight??z??"—"),e.jsx("span",{className:"ml-1 text-base font-normal text-muted-foreground",children:"kg"})]})]}),e.jsxs("button",{type:"button",className:be("rounded-xl border-2 p-4 text-center transition-all",pe==="reps"?"border-primary bg-primary/10 shadow-sm":"border-muted bg-card hover:border-muted-foreground/30"),onClick:()=>Wt("reps"),children:[e.jsx("div",{className:"text-xs font-semibold uppercase text-muted-foreground",children:"Reps"}),e.jsxs("div",{className:"mt-1 text-2xl font-bold tabular-nums",children:[pe==="reps"?we||"—":String(J[V-1]?.reps??I?.reps??"—"),e.jsx("span",{className:"ml-1 text-base font-normal text-muted-foreground",children:"reps"})]})]})]}),pe==="weight"&&z>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"text-xs font-semibold text-muted-foreground mb-2",children:"Suggestions"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:[z-10,z-5,z,z+5,z+10].filter(a=>a>0).map(a=>e.jsxs(Y,{variant:Number(we)===a?"default":"outline",size:"sm",className:"rounded-full px-4 h-10 text-sm font-semibold",onClick:()=>Se(String(a)),children:[a," kg"]},a))})]}),pe==="reps"&&e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"text-xs font-semibold text-muted-foreground mb-2",children:"Suggestions"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:[6,8,10,12,15,20].map(a=>e.jsx(Y,{variant:Number(we)===a?"default":"outline",size:"sm",className:"rounded-full px-4 h-10 text-sm font-semibold",onClick:()=>Se(String(a)),children:a},a))})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 mb-4",children:[[1,2,3,4,5,6,7,8,9].map(a=>e.jsx(Y,{variant:"outline",className:"h-14 text-xl font-semibold rounded-xl active:scale-95 transition-transform",onClick:()=>Nt(String(a)),children:a},a)),e.jsx(Y,{variant:"outline",className:"h-14 text-xl font-semibold rounded-xl active:scale-95 transition-transform",onClick:()=>Nt("."),children:","}),e.jsx(Y,{variant:"outline",className:"h-14 text-xl font-semibold rounded-xl active:scale-95 transition-transform",onClick:()=>Nt("0"),children:"0"}),e.jsx(Y,{variant:"outline",className:"h-14 text-xl font-semibold rounded-xl active:scale-95 transition-transform",onClick:()=>{fe(!1),Se(a=>a.slice(0,-1))},children:"⌫"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(Y,{variant:"outline",className:"flex-1 h-14 text-base font-semibold rounded-xl",onClick:()=>{fe(!1),Se("")},children:"Effacer"}),e.jsxs(Y,{className:"flex-1 h-14 text-base font-semibold rounded-xl",onClick:Ls,children:[e.jsx(Xt,{className:"mr-2 h-5 w-5"}),"Valider"]})]})]})})}),T&&e.jsx(os,{open:Ye,onOpenChange:Xe,children:e.jsxs(ls,{children:[e.jsxs(cs,{children:[e.jsx(ds,{children:"Quitter la séance ?"}),e.jsx(us,{children:"Les séries enregistrées seront conservées."})]}),e.jsxs(ms,{children:[e.jsx(fs,{children:"Annuler"}),e.jsx(hs,{onClick:()=>{Xe(!1),T()},children:"Quitter"})]})]})}),D&&e.jsx(At,{open:u,onOpenChange:a=>{if(!a&&I){const R=he.trim()||null,ae=$?.[I.exercise_id]??null;R!==ae&&D(I.exercise_id,R)}C(a)},children:e.jsxs(It,{side:"bottom",className:"max-h-[60vh]",children:[e.jsx(Ot,{children:e.jsxs($t,{children:["Notes — ",ge?.nom_exercice]})}),e.jsx("textarea",{value:he,onChange:a=>xe(a.target.value),placeholder:"Réglages machine, repères personnels...",rows:4,className:"flex w-full rounded-md border border-input bg-background px-3 py-2 text-sm mt-4 resize-none ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring"})]})})]})}const $s=(t=[])=>{if(!t.length)return t;const s=t.map((r,l)=>{const o=Number(r.order_index);return{item:r,index:l,order:Number.isFinite(o)?o:null}});return s.some(r=>r.order!==null)?s.sort((r,l)=>r.order===null&&l.order===null?r.index-l.index:r.order===null?1:l.order===null?-1:r.order===l.order?r.index-l.index:r.order-l.order).map(r=>r.item):t},kt=t=>t==="endurance"||t==="hypertrophie"||t==="force"?t:"endurance";function Zn({user:t,userId:s,athleteName:n,athleteId:r,athleteKey:l,cycleType:o,searchQuery:p,isLoading:f,setSaveState:x,onCycleChange:S,onSearchChange:h,onStartAssignment:i,onStartCatalog:v,onResumeInProgress:T}){const{toast:$}=qt(),D=as(),[q,j]=d.useState(null),[A,P]=d.useState(!1),[g,U]=d.useState(null),W=[{value:"endurance",label:"Endurance"},{value:"hypertrophie",label:"Hypertrophie"},{value:"force",label:"Force"}],{data:w}=Be({queryKey:["assignments",t,"strength"],queryFn:()=>ye.getAssignments(t,s,{assignmentType:"strength"}),enabled:!!t}),{data:M}=Be({queryKey:["strength_catalog"],queryFn:()=>ye.getStrengthSessions()}),{data:O}=Be({queryKey:["exercises"],queryFn:()=>ye.getExercises()}),y=Be({queryKey:["strength_run_in_progress",l],queryFn:()=>ye.getStrengthHistory(n,{limit:1,offset:0,order:"desc",status:"in_progress",athleteId:r}),enabled:!!n}).data?.runs?.[0]??null,K=y?.status==="completed"||(y?.progress_pct??0)>=100,b=it({mutationFn:c=>ye.deleteStrengthRun(c),onMutate:()=>{x("saving")},onSuccess:c=>{x("saved"),setTimeout(()=>x("idle"),2e3),D.invalidateQueries({queryKey:["strength_run_in_progress",l]}),D.invalidateQueries({queryKey:["strength_history"]}),D.invalidateQueries({queryKey:["assignments",t,"strength"]});const G=c?.source==="local"?"Suppression locale : le serveur n'est pas disponible.":void 0;$({title:"Séance supprimée",description:G})},onError:()=>{x("error"),setTimeout(()=>x("idle"),3e3),$({title:"Erreur",description:"Impossible de supprimer la séance en cours.",variant:"destructive"})}});d.useMemo(()=>O?new Map(O.map(c=>[c.id,c])):new Map,[O]);const ee=d.useMemo(()=>w?.filter(c=>c.session_type==="strength")||[],[w]),L=d.useMemo(()=>ee.filter(c=>c.status!=="completed"),[ee]),X=d.useMemo(()=>y?L.find(c=>c.id===y.assignment_id)??null:null,[y,L]),B=d.useMemo(()=>y&&!X?M?.find(c=>c.id===y.session_id)??null:null,[y,X,M]),Z=(!!X?.items?.length||!!B?.items?.length)&&!K,me=d.useMemo(()=>L.map(c=>{const G=(c.items??[]).filter(ne=>"exercise_id"in ne);return{key:`assignment-${c.id}`,title:c.title,description:c.description,type:"assignment",assignedDate:c.assigned_date,session:{id:c.session_id,title:c.title,description:c.description,cycle:kt(c.cycle),items:G},assignment:c,exerciseCount:G.length}}),[L]),Ce=d.useMemo(()=>(M??[]).map(c=>({key:`catalog-${c.id}`,title:c.title,description:c.description,type:"catalog",session:{...c,cycle:o},exerciseCount:c.items?.length??0})),[M,o]),de=d.useMemo(()=>{const c=p.trim().toLowerCase(),G=[...me,...Ce];return c?G.filter(ne=>`${ne.title} ${ne.description}`.toLowerCase().includes(c)):G},[me,Ce,p]),Fe=d.useCallback((c,G)=>{if(!["ArrowUp","ArrowDown","Enter"].includes(c.key))return;if(c.preventDefault(),c.key==="Enter"){const ie=de[G];ie.type==="assignment"&&ie.assignment?i(ie.assignment):v(ie.session);return}let ce=G;c.key==="ArrowUp"&&(ce=Math.max(0,G-1)),c.key==="ArrowDown"&&(ce=Math.min(de.length-1,G+1)),j(ce),setTimeout(()=>{const ie=document.querySelectorAll('[data-session-card="true"]');ie[ce]&&ie[ce].focus()},0)},[de,i,v]);return f?e.jsxs("div",{className:"space-y-5 pt-4",children:[e.jsx("div",{className:"flex justify-center gap-2",children:[1,2,3].map(c=>e.jsx("div",{className:"h-10 w-28 rounded-full bg-muted animate-pulse"},c))}),e.jsx("div",{className:"h-12 rounded-2xl bg-muted/30 animate-pulse"}),e.jsx("div",{className:"space-y-3",children:[1,2,3,4].map(c=>e.jsx("div",{className:"rounded-2xl border bg-card p-4 shadow-sm",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"h-12 w-12 shrink-0 rounded-xl bg-muted animate-pulse"}),e.jsxs("div",{className:"flex-1 min-w-0 space-y-2",children:[e.jsx("div",{className:"h-4 w-3/4 rounded bg-muted animate-pulse"}),e.jsx("div",{className:"h-3 w-1/2 rounded bg-muted animate-pulse"})]}),e.jsx("div",{className:"h-10 w-10 shrink-0 rounded-full bg-muted animate-pulse"})]})},c))})]}):e.jsxs("div",{className:"space-y-5 animate-in fade-in motion-reduce:animate-none",children:[e.jsxs("p",{className:"text-center text-sm text-muted-foreground py-1",children:[de.length," séance",de.length>1?"s":""," ","disponible",de.length>1?"s":""]}),e.jsx("div",{className:"flex justify-center gap-2",children:W.map(c=>e.jsx("button",{type:"button",onClick:()=>S(kt(c.value)),className:be("px-5 py-2.5 rounded-full text-sm font-semibold transition-all active:scale-95",o===c.value?"bg-primary text-primary-foreground shadow-md":"bg-muted/50 text-muted-foreground hover:bg-muted"),children:c.label},c.value))}),e.jsxs("p",{className:"text-center text-[11px] text-muted-foreground",children:[o==="endurance"&&"Beaucoup de reps, charges légères",o==="hypertrophie"&&"Reps et charges modérées",o==="force"&&"Peu de reps, charges lourdes"]}),e.jsxs("div",{className:"relative",children:[e.jsx(cn,{className:"absolute left-4 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground pointer-events-none"}),e.jsx(Dt,{placeholder:"Rechercher une séance...",className:"h-12 rounded-2xl bg-muted/30 pl-11 pr-4 border-0 shadow-sm focus-visible:ring-2",value:p,onChange:c=>h(c.target.value),"aria-label":"Rechercher une séance"})]}),y&&e.jsxs("div",{className:"relative overflow-hidden rounded-2xl bg-gradient-to-br from-primary/10 via-primary/5 to-transparent border-2 border-primary/30 p-5",children:[e.jsx("div",{className:"absolute top-0 right-0 w-24 h-24 bg-primary/10 rounded-full blur-2xl -mr-8 -mt-8"}),e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsxs("span",{className:"relative flex h-3 w-3",children:[e.jsx("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-primary opacity-75"}),e.jsx("span",{className:"relative inline-flex rounded-full h-3 w-3 bg-primary"})]}),e.jsx("span",{className:"text-xs font-bold uppercase tracking-wider text-primary",children:K?"Complétée":"En cours"})]}),e.jsx("h3",{className:"text-xl font-bold tracking-tight mb-1",children:X?.title??"Séance en cours"}),e.jsxs("p",{className:"text-sm text-muted-foreground mb-4",children:["Démarrée le"," ",bt(new Date(y.started_at||new Date),"dd MMMM",{locale:yt})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex justify-between text-xs font-semibold mb-1.5",children:[e.jsx("span",{className:"text-muted-foreground",children:"Progression"}),e.jsxs("span",{className:"text-primary",children:[Math.round(y.progress_pct??0),"%"]})]}),e.jsx("div",{className:"h-2 rounded-full bg-muted overflow-hidden",children:e.jsx("div",{className:"h-full rounded-full bg-primary transition-all duration-500",style:{width:`${y.progress_pct??0}%`}})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Y,{variant:"default",className:"flex-1 h-12 rounded-xl font-semibold",disabled:!Z,onClick:()=>{const c=X??B;if(!c)return;const ne=(X?.items??B?.items??[]).filter(V=>"exercise_id"in V),ce=kt(X?.cycle??B?.cycle??ne.find(V=>V.cycle_type)?.cycle_type),ie=ne.filter(V=>V.cycle_type===ce),ue=$s(ie.length?ie:ne);T({assignment:X??null,session:{...c,title:c.title,description:c.description??null,cycle:ce,items:ue},runId:y.id,logs:y.logs??[],progressPct:y.progress_pct??0})},children:K?"Voir le résumé":"Reprendre"}),!K&&e.jsx(Y,{variant:"outline",className:"h-12 w-12 rounded-xl p-0",disabled:b.isPending,onClick:()=>{y&&(U(y.id),P(!0))},"aria-label":"Supprimer la séance",children:e.jsx(xt,{className:"h-5 w-5"})})]})]})]}),!y&&de.length>0&&e.jsxs("div",{className:"flex items-center gap-2 pt-2",children:[e.jsx(We,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-xs font-semibold uppercase tracking-wider text-muted-foreground",children:"Choisir une séance"})]}),de.length>0?e.jsx(Lt.div,{className:"space-y-3 motion-reduce:animate-none",variants:an,initial:"hidden",animate:"visible",children:de.map((c,G)=>{const ne=q===G||q===null&&G===0;return e.jsx(Lt.button,{type:"button",tabIndex:ne?0:-1,"data-session-card":"true",onKeyDown:ce=>Fe(ce,G),variants:on,className:be("group w-full rounded-2xl border bg-card p-4 text-left shadow-sm transition-all active:scale-[0.98] hover:shadow-md hover:border-primary/30 focus:outline-none motion-reduce:animate-none",ne&&"ring-2 ring-primary"),onClick:()=>{if(c.type==="assignment"&&c.assignment){i(c.assignment);return}v(c.session)},children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:be("flex h-12 w-12 shrink-0 items-center justify-center rounded-xl",c.type==="assignment"?"bg-primary/10 text-primary":"bg-muted text-muted-foreground"),children:e.jsx(We,{className:"h-5 w-5"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-0.5",children:[c.type==="assignment"&&e.jsx("span",{className:"inline-flex items-center rounded-full bg-primary/10 px-2 py-0.5 text-[10px] font-bold uppercase text-primary",children:"Assignée"}),c.type==="assignment"&&c.assignedDate&&e.jsx("span",{className:"text-xs text-muted-foreground",children:bt(new Date(c.assignedDate),"dd MMM",{locale:yt})})]}),e.jsx("h3",{className:"font-semibold tracking-tight truncate",children:c.title}),e.jsxs("p",{className:"text-sm text-muted-foreground truncate",children:[c.exerciseCount," exercice",c.exerciseCount>1?"s":"",c.description?` · ${c.description}`:""]})]}),e.jsx("div",{className:"flex h-10 w-10 shrink-0 items-center justify-center rounded-full bg-muted/50 text-muted-foreground transition-colors group-hover:bg-primary group-hover:text-primary-foreground",children:e.jsx(ps,{className:"h-4 w-4 ml-0.5"})})]})},c.key)})}):e.jsxs("div",{className:"py-12 text-center",children:[e.jsx("div",{className:"mx-auto mb-4 flex h-16 w-16 items-center justify-center rounded-full bg-muted",children:e.jsx(We,{className:"h-7 w-7 text-muted-foreground"})}),e.jsx("h3",{className:"font-semibold",children:"Aucune séance"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Essayez un autre mot-clé ou changez de cycle."})]}),e.jsx(os,{open:A,onOpenChange:P,children:e.jsxs(ls,{children:[e.jsxs(cs,{children:[e.jsx(ds,{children:"Supprimer la séance ?"}),e.jsx(us,{children:"Les séries déjà enregistrées seront perdues."})]}),e.jsxs(ms,{children:[e.jsx(fs,{children:"Annuler"}),e.jsx(hs,{className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",onClick:()=>{g&&b.mutate(g),P(!1)},children:"Supprimer"})]})]})})]})}const ss=t=>{const s=Number(t);return!Number.isFinite(s)||s<=0?"—":String(s)},er=t=>{const s=Number(t);return!Number.isFinite(s)||s<=0?"—":`${s}s`};function tr({session:t,assignment:s,cycleType:n,cycleOptions:r,exercises:l,oneRMs:o,saveState:p,onBack:f,onLaunch:x}){const S=d.useMemo(()=>new Map(l.map(i=>[i.id,i])),[l]),h=t.items??[];return e.jsxs(Lt.div,{className:"space-y-5 pb-36",variants:ln,initial:"hidden",animate:"visible",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{type:"button",onClick:f,className:"flex h-10 w-10 items-center justify-center rounded-full bg-muted/50 text-muted-foreground transition-colors hover:bg-muted active:scale-95","aria-label":"Retour",children:e.jsx(gs,{className:"h-5 w-5"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-xs font-semibold uppercase tracking-wider text-muted-foreground truncate",children:r.find(i=>i.value===n)?.label}),e.jsx("h1",{className:"text-xl font-bold tracking-tight truncate",children:t.title})]})]}),e.jsxs("div",{className:"relative overflow-hidden rounded-2xl bg-gradient-to-br from-primary/10 via-primary/5 to-transparent border border-primary/20 p-5",children:[e.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-primary/10 rounded-full blur-3xl -mr-12 -mt-12"}),e.jsxs("div",{className:"relative space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[s&&e.jsxs("span",{className:"inline-flex items-center gap-1.5 rounded-full bg-primary/20 px-3 py-1 text-xs font-bold uppercase text-primary",children:[e.jsx("span",{className:"h-1.5 w-1.5 rounded-full bg-primary"}),"Assignée"]}),!s&&e.jsx("span",{className:"inline-flex items-center rounded-full bg-muted px-3 py-1 text-xs font-semibold text-muted-foreground",children:"Catalogue"}),s?.assigned_date&&e.jsxs("span",{className:"text-xs text-muted-foreground",children:["Prévue le ",bt(new Date(s.assigned_date),"dd MMM",{locale:yt})]})]}),t.description&&e.jsx("p",{className:"text-sm text-muted-foreground leading-relaxed",children:t.description}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex h-9 w-9 items-center justify-center rounded-xl bg-background/80",children:e.jsx(We,{className:"h-4 w-4 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-bold leading-none",children:h.length}),e.jsx("p",{className:"text-[10px] uppercase text-muted-foreground font-semibold",children:"Exercices"})]})]}),e.jsx("div",{className:"h-8 w-px bg-border"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex h-9 w-9 items-center justify-center rounded-xl bg-background/80",children:e.jsx(xn,{className:"h-4 w-4 text-muted-foreground"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-bold leading-none",children:r.find(i=>i.value===n)?.label}),e.jsx("p",{className:"text-[10px] uppercase text-muted-foreground font-semibold",children:"Cycle"})]})]})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between gap-2 pt-1",children:[e.jsxs("span",{className:"text-xs font-semibold uppercase tracking-wider text-muted-foreground",children:[h.length," exercice",h.length>1?"s":""]}),e.jsx("div",{className:"flex-1 h-px bg-border"})]}),e.jsxs("div",{className:"space-y-2",children:[h.map((i,v)=>{const T=S.get(i.exercise_id),$=Number(i.percent_1rm),D=Number.isFinite($)&&$>0,q=D?o?.find(w=>w.exercise_id===i.exercise_id)?.weight??0:0,j=D?Math.round(q*($/100)):0,A=D?j>0?`${j} kg (${$}% 1RM)`:`${$}% 1RM`:null,P=i.notes?.trim(),g=ss(i.sets),U=ss(i.reps),W=er(i.rest_seconds);return e.jsxs(At,{children:[e.jsx(Zs,{asChild:!0,children:e.jsxs("button",{type:"button",className:"w-full flex items-center gap-3 rounded-xl border bg-card px-3 py-3 text-left transition-all active:scale-[0.98] hover:border-primary/50 hover:shadow-sm",children:[e.jsx("div",{className:"flex h-7 w-7 shrink-0 items-center justify-center rounded-full bg-primary text-xs font-bold text-primary-foreground",children:v+1}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsx("p",{className:"font-semibold text-sm truncate",children:T?.nom_exercice??i.exercise_name??"Exercice"})}),e.jsxs("div",{className:"flex items-center gap-2 shrink-0 text-xs font-medium text-muted-foreground",children:[e.jsxs("span",{className:"font-mono",children:[g,"×",U]}),e.jsx("span",{className:"text-border",children:"|"}),e.jsx("span",{className:"font-mono",children:W}),e.jsx(Pt,{className:"h-4 w-4 text-muted-foreground/50"})]})]})}),e.jsxs(It,{side:"bottom",className:"max-h-[90vh] overflow-y-auto rounded-t-3xl pb-8",children:[e.jsx(Ot,{className:"text-left pb-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex h-10 w-10 shrink-0 items-center justify-center rounded-full bg-primary text-sm font-bold text-primary-foreground",children:v+1}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx($t,{className:"text-xl leading-tight",children:T?.nom_exercice??i.exercise_name??"Exercice"}),T?.exercise_type&&e.jsx("p",{className:"text-sm text-muted-foreground mt-0.5",children:T.exercise_type})]})]})}),e.jsxs("div",{className:"space-y-4",children:[T?.illustration_gif&&e.jsx("div",{className:"rounded-xl overflow-hidden bg-muted/20 border aspect-video flex items-center justify-center",children:e.jsx("img",{src:T.illustration_gif,alt:T.nom_exercice??"Exercice",className:"w-full h-full max-h-36 object-contain",loading:"lazy",decoding:"async"})}),T?.description&&e.jsx("div",{className:"text-sm text-muted-foreground leading-relaxed",children:T.description}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:"rounded-xl bg-muted/40 p-3 text-center",children:[e.jsx("p",{className:"text-2xl font-bold leading-none",children:g}),e.jsx("p",{className:"text-[10px] uppercase text-muted-foreground font-semibold mt-1",children:"Séries"})]}),e.jsxs("div",{className:"rounded-xl bg-muted/40 p-3 text-center",children:[e.jsx("p",{className:"text-2xl font-bold leading-none",children:U}),e.jsx("p",{className:"text-[10px] uppercase text-muted-foreground font-semibold mt-1",children:"Reps"})]}),e.jsxs("div",{className:"rounded-xl bg-muted/40 p-3 text-center",children:[e.jsx("p",{className:"text-lg font-bold leading-none",children:A??"—"}),e.jsx("p",{className:"text-[10px] uppercase text-muted-foreground font-semibold mt-1",children:"Charge"})]}),e.jsxs("div",{className:"rounded-xl bg-muted/40 p-3 text-center",children:[e.jsx("p",{className:"text-lg font-bold leading-none",children:W}),e.jsx("p",{className:"text-[10px] uppercase text-muted-foreground font-semibold mt-1",children:"Repos"})]})]}),P&&e.jsxs("div",{className:"rounded-xl bg-primary/5 border border-primary/20 p-4",children:[e.jsx("div",{className:"text-[10px] uppercase text-primary font-semibold mb-1",children:"Notes coach"}),e.jsx("div",{className:"text-sm text-foreground",children:P})]})]})]})]},`${i.exercise_id}-${v}`)}),h.length===0&&e.jsx("div",{className:"p-6 border-2 border-dashed rounded-xl text-center text-muted-foreground",children:"Aucun exercice disponible pour cette séance."})]}),e.jsx(xs,{saveState:p,children:e.jsxs(Y,{variant:"default",className:"flex-1 h-14 rounded-xl font-bold text-base shadow-lg",onClick:x,children:[e.jsx(ps,{className:"h-5 w-5 mr-2"}),"Lancer la séance"]})})]})}function sr({athleteName:t,athleteId:s,athleteKey:n}){const[r,l]=d.useState("all"),[o,p]=d.useState(""),[f,x]=d.useState(""),S=Ws({queryKey:["strength_history",n,r,o,f],queryFn:({pageParam:i=0})=>ye.getStrengthHistory(t,{athleteId:s,limit:10,offset:i,order:"desc",status:r==="all"?void 0:r,from:o||void 0,to:f||void 0}),enabled:!!t,getNextPageParam:i=>{const v=i.pagination.offset+i.pagination.limit;return v<i.pagination.total?v:void 0},initialPageParam:0}),h=S.data?.pages.flatMap(i=>i.runs)??[];return e.jsxs("div",{className:"space-y-4 pt-4",children:[e.jsxs("div",{className:"grid gap-3 md:grid-cols-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(Je,{htmlFor:"strength-history-status",children:"Statut"}),e.jsxs(dn,{value:r,onValueChange:l,children:[e.jsx(un,{id:"strength-history-status",children:e.jsx(mn,{placeholder:"Tous"})}),e.jsxs(fn,{children:[e.jsx(mt,{value:"all",children:"Tous"}),e.jsx(mt,{value:"in_progress",children:"En cours"}),e.jsx(mt,{value:"completed",children:"Terminé"}),e.jsx(mt,{value:"abandoned",children:"Abandonné"})]})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(Je,{htmlFor:"strength-history-from",children:"Du"}),e.jsx(Dt,{id:"strength-history-from",type:"date",value:o,onChange:i=>p(i.target.value)})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(Je,{htmlFor:"strength-history-to",children:"Au"}),e.jsx(Dt,{id:"strength-history-to",type:"date",value:f,onChange:i=>x(i.target.value)})]})]}),h.map(i=>e.jsx(Ve,{className:"group hover:border-primary/50 transition-colors",children:e.jsxs(vt,{className:"pb-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx(Bt,{className:"text-base font-bold uppercase",children:bt(new Date(i.started_at||i.date||i.created_at||new Date),"dd MMM yyyy",{locale:yt})}),e.jsxs("div",{className:"text-sm font-mono font-bold text-muted-foreground group-hover:text-primary",children:[i.duration??0," min"]})]}),e.jsxs("div",{className:"flex gap-2 text-xs font-bold text-muted-foreground",children:[e.jsxs("span",{children:["Difficulté ",i.feeling??i.rpe??0,"/5"]}),e.jsx("span",{children:"•"}),e.jsxs("span",{children:[i.logs?.length||0," Séries"]})]})]})},i.id)),h.length===0&&e.jsx("div",{className:"text-center text-muted-foreground py-10",children:"Aucun historique."}),S.hasNextPage&&e.jsx(Y,{variant:"outline",size:"sm",className:"w-full",onClick:()=>S.fetchNextPage(),disabled:S.isFetchingNextPage,children:S.isFetchingNextPage?"Chargement...":"Charger plus"})]})}const nr=t=>t==="endurance"||t==="hypertrophie"||t==="force"?t:"endurance";function rr({athleteKey:t}){const s="strength-preferences",n=d.useMemo(()=>`strength-focus-state-${t??"anonymous"}`,[t]),[r,l]=d.useState(null),[o,p]=d.useState(null),[f,x]=d.useState(null),[S,h]=d.useState(null),[i,v]=d.useState(0),[T,$]=d.useState("list"),[D,q]=d.useState(!1),[j,A]=d.useState("idle"),[P,g]=d.useState({poolMode:!1,largeText:!1}),[U,W]=d.useState(""),[w,M]=d.useState("endurance");return d.useEffect(()=>{if(typeof window>"u")return;const E=window.localStorage.getItem(s);if(E)try{const y=JSON.parse(E);g(K=>({...K,...y??{}}))}catch{return}},[]),d.useEffect(()=>{typeof window>"u"||window.localStorage.setItem(s,JSON.stringify(P))},[s,P]),d.useEffect(()=>{if(!(typeof document>"u")){if(T==="focus")return document.body.dataset.focusMode="strength",()=>{document.body.dataset.focusMode==="strength"&&delete document.body.dataset.focusMode};document.body.dataset.focusMode==="strength"&&delete document.body.dataset.focusMode}},[T]),d.useEffect(()=>{if(typeof window>"u"||r)return;const E=window.localStorage.getItem(n);if(E)try{const y=JSON.parse(E),K=y?.screenMode==="focus"?"focus":y?.screenMode==="reader"?"reader":null;if(!K||!y?.session)return;l(y.session),p(y.assignment??null),x(typeof y.runId=="number"?y.runId:null),h(Array.isArray(y.runLogs)?y.runLogs:null),v(Number.isFinite(y.runnerStep)?y.runnerStep:0),y.cycleType&&M(nr(y.cycleType)),$(K)}catch{return}},[r,n]),d.useEffect(()=>{if(typeof window>"u")return;if(!(T==="focus"||T==="reader")||!r){window.localStorage.removeItem(n);return}const y={screenMode:T,session:r,assignment:o,runId:f,runLogs:S,runnerStep:i,cycleType:w};window.localStorage.setItem(n,JSON.stringify(y))},[o,f,S,i,r,w,n,T]),{activeSession:r,setActiveSession:l,activeAssignment:o,setActiveAssignment:p,activeRunId:f,setActiveRunId:x,activeRunLogs:S,setActiveRunLogs:h,activeRunnerStep:i,setActiveRunnerStep:v,screenMode:T,setScreenMode:$,isFinishing:D,setIsFinishing:q,saveState:j,setSaveState:A,preferences:P,setPreferences:g,searchQuery:U,setSearchQuery:W,cycleType:w,setCycleType:M,clearActiveRunState:()=>{l(null),p(null),x(null),h(null),v(0),$("list")}}}const ns=t=>t==="endurance"||t==="hypertrophie"||t==="force"?t:"endurance",at=t=>{const s=Number(t);return!Number.isFinite(s)||s<=0?null:s},ar=(t,s)=>{if(!t)return{sets:null,reps:null,percent1rm:null,restSeries:null,restExercise:null};const n={endurance:{sets:t.Nb_series_endurance,reps:t.Nb_reps_endurance,percent1rm:t.pct_1rm_endurance,restSeries:t.recup_endurance,restExercise:t.recup_exercices_endurance},hypertrophie:{sets:t.Nb_series_hypertrophie,reps:t.Nb_reps_hypertrophie,percent1rm:t.pct_1rm_hypertrophie,restSeries:t.recup_hypertrophie,restExercise:t.recup_exercices_hypertrophie},force:{sets:t.Nb_series_force,reps:t.Nb_reps_force,percent1rm:t.pct_1rm_force,restSeries:t.recup_force,restExercise:t.recup_exercices_force}}[s];return{sets:at(n.sets),reps:at(n.reps),percent1rm:at(n.percent1rm),restSeries:at(n.restSeries),restExercise:at(n.restExercise)}},ir=(t=[],s)=>{const n=t.filter(l=>l.cycle_type===s),r=n.length?n:t;return $s(r)},Tt=(t=[],s,n)=>ir(t,s).map(r=>{const l=ar(n.get(r.exercise_id),s);return{...r,sets:l.sets??0,reps:l.reps??0,rest_seconds:l.restSeries??0,percent_1rm:l.percent1rm??0}}),or=({runId:t,assignmentId:s,startedAt:n})=>({id:t,assignment_id:s??null,started_at:n,progress_pct:0,status:"in_progress",logs:[]}),rs=t=>({runs:t?[t]:[],pagination:{limit:1,offset:0,total:t?1:0},exercise_summary:[]});function Ir(){const{user:t,userId:s,role:n,selectedAthleteId:r,selectedAthleteName:l}=Xs(),{toast:o}=qt(),p=as(),f=(n==="coach"||n==="admin")&&(r!==null||!!l),x=f?l:t,S=f?r:s,h=S??x,{activeSession:i,setActiveSession:v,activeAssignment:T,setActiveAssignment:$,activeRunId:D,setActiveRunId:q,activeRunLogs:j,setActiveRunLogs:A,activeRunnerStep:P,setActiveRunnerStep:g,screenMode:U,setScreenMode:W,isFinishing:w,setIsFinishing:M,saveState:O,setSaveState:E,preferences:y,setPreferences:K,searchQuery:b,setSearchQuery:ee,cycleType:L,setCycleType:X}=rr({athleteKey:h}),{poolMode:B,largeText:Z}=y,me=[{value:"endurance",label:"Endurance"},{value:"hypertrophie",label:"Hypertrophie"},{value:"force",label:"Force"}],{data:Ce,isLoading:de,error:Fe,refetch:c}=Be({queryKey:["assignments",t,"strength"],queryFn:()=>ye.getAssignments(t,s,{assignmentType:"strength"}),enabled:!!t}),{data:G,isLoading:ne,error:ce,refetch:ie}=Be({queryKey:["strength_catalog"],queryFn:()=>ye.getStrengthSessions()}),{data:ue,error:V,refetch:Re}=Be({queryKey:["exercises"],queryFn:()=>ye.getExercises()}),Te=de||ne,He=Fe||ce||V,Ke=()=>{c(),ie(),Re()},{data:_}=Be({queryKey:["1rm",t,s],queryFn:()=>ye.get1RM({athleteName:t,athleteId:s}),enabled:!!t}),pe=d.useMemo(()=>{const u={};return(_??[]).forEach(C=>{C.notes&&(u[C.exercise_id]=C.notes)}),u},[_]),De=d.useMemo(()=>ue?new Map(ue.map(u=>[u.id,u])):new Map,[ue]),we=d.useMemo(()=>i?Tt(i.items??[],L,De):[],[i,L,De]),Se=it({mutationFn:u=>ye.startStrengthRun(u),onMutate:()=>{E("saving")},onSuccess:u=>{if(E("saved"),setTimeout(()=>E("idle"),2e3),u?.run_id&&(q(u.run_id),A(C=>C??[]),h)){const C=or({runId:u.run_id,assignmentId:T?.id??null,startedAt:new Date().toISOString()});p.setQueryData(["strength_run_in_progress",h],rs(C))}p.invalidateQueries({queryKey:["assignments",t,"strength"]}),p.invalidateQueries({queryKey:["strength_run_in_progress",h]}),p.invalidateQueries({queryKey:["strength_history"]})},onError:()=>{E("error"),setTimeout(()=>E("idle"),3e3),o({title:"Erreur",description:"Impossible de démarrer la séance.",variant:"destructive"})}}),Ze=it({mutationFn:u=>ye.logStrengthSet(u),onMutate:()=>{E("saving")},onSuccess:u=>{E("saved"),setTimeout(()=>E("idle"),2e3),u?.one_rm_updated&&(p.invalidateQueries({queryKey:["1rm",t,s]}),o({title:"Nouveau 1RM détecté",description:"Ton record vient d'être mis à jour."}))},onError:()=>{E("error"),setTimeout(()=>E("idle"),3e3),o({title:"Erreur",description:"Impossible d'enregistrer une série.",variant:"destructive"})}}),fe=it({mutationFn:u=>ye.updateStrengthRun(u),onMutate:()=>{E("saving")},onSuccess:(u,C)=>{E("saved"),setTimeout(()=>E("idle"),2e3),M(!1),p.invalidateQueries({queryKey:["strength_history"]}),C?.status==="completed"&&(h&&p.setQueryData(["strength_run_in_progress",h],rs(null)),p.invalidateQueries({queryKey:["assignments",t]}),p.invalidateQueries({queryKey:["assignments",t,"strength"]}),p.invalidateQueries({queryKey:["1rm",t,s]}),$(null),q(null),v(null),A(null),W("list"),o({title:"Séance sauvegardée",description:"Bravo pour l'effort !"}))},onError:(u,C)=>{E("error"),setTimeout(()=>E("idle"),3e3),C?.status==="completed"&&(M(!1),o({title:"Erreur",description:"Impossible d'enregistrer la séance. Réessayez.",variant:"destructive"}))}}),ze=it({mutationFn:u=>ye.updateExerciseNote({athlete_id:s??0,exercise_id:u.exercise_id,notes:u.notes}),onMutate:()=>{E("saving")},onSuccess:()=>{E("saved"),setTimeout(()=>E("idle"),2e3),p.invalidateQueries({queryKey:["1rm",t,s]})},onError:()=>{E("error"),setTimeout(()=>E("idle"),3e3),o({title:"Erreur",description:"Impossible de sauvegarder la note.",variant:"destructive"})}}),qe=(u,C)=>{const he=u.items??[],xe=ns(C??u.cycle??he.find(je=>je.cycle_type)?.cycle_type),te=Tt(he,xe,De);$(u),v({...u,title:u.title,description:u.description,cycle:xe,items:te}),q(null),A(null),g(0),W("reader")},Me=u=>{if((u.items??[]).length===0){o({title:"Séance vide",description:"Aucun exercice n'est disponible pour cette séance."});return}qe(u,L),q(null),A(null)},Qe=u=>{const C=u.items??[],xe=C.filter(je=>je.cycle_type===L).length>0?L:ns(u.cycle??C.find(je=>je.cycle_type)?.cycle_type),te=Tt(C,xe,De);if(te.length===0){o({title:"Séance vide",description:"Aucun exercice n'est disponible pour cette séance."});return}v({...u,cycle:xe,items:te}),$(null),q(null),A(null),g(0),W("reader")},Ye=()=>{if(i){if(we.length===0){o({title:"Séance vide",description:"Aucun exercice n'est disponible pour cette séance."});return}v({...i,cycle:L,items:we}),g(0),W("focus")}};return d.useEffect(()=>{if(U!=="reader")return;const u=C=>{C.key==="Escape"&&(C.preventDefault(),W("list"))};return window.addEventListener("keydown",u),()=>window.removeEventListener("keydown",u)},[U]),de||ne?e.jsxs("div",{className:"space-y-4 md:space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(Ne,{className:"h-8 w-32"}),e.jsx(Ne,{className:"h-10 w-10 rounded-full"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Ne,{className:"h-10 w-32"}),e.jsx(Ne,{className:"h-10 w-32"})]}),e.jsxs("div",{className:"flex gap-2 overflow-x-auto pb-2",children:[e.jsx(Ne,{className:"h-9 w-28 rounded-full"}),e.jsx(Ne,{className:"h-9 w-32 rounded-full"}),e.jsx(Ne,{className:"h-9 w-24 rounded-full"})]}),e.jsx(Ne,{className:"h-10 w-full rounded-lg"}),e.jsx("div",{className:"space-y-3",children:Array.from({length:3}).map((u,C)=>e.jsxs(Ve,{className:"overflow-hidden",children:[e.jsx(vt,{children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx(Ne,{className:"h-5 w-48"}),e.jsx(Ne,{className:"h-4 w-32"})]}),e.jsx(Ne,{className:"h-6 w-20 rounded-full"})]})}),e.jsxs(pt,{className:"space-y-2",children:[e.jsx(Ne,{className:"h-4 w-full"}),e.jsx(Ne,{className:"h-4 w-3/4"})]})]},`skeleton-${C}`))})]}):He?e.jsxs("div",{className:"flex flex-col items-center justify-center p-8 text-center",children:[e.jsx(hn,{className:"h-12 w-12 text-destructive mb-4"}),e.jsx("h3",{className:"font-semibold",children:"Impossible de charger les données"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:He.message}),e.jsx(Y,{variant:"default",onClick:()=>Ke(),className:"mt-4 h-12 md:h-10",children:"Réessayer"})]}):e.jsx("div",{className:be("space-y-4 md:space-y-6",B&&"dark bg-background text-foreground contrast-125",Z&&"text-lg leading-relaxed [&_.text-xs]:text-sm [&_.text-sm]:text-base"),children:U==="focus"&&i?ue?e.jsx("div",{className:"animate-in fade-in motion-reduce:animate-none",children:e.jsx(Jn,{session:i,exercises:ue,oneRMs:_||[],exerciseNotes:pe,onUpdateNote:(u,C)=>ze.mutate({exercise_id:u,notes:C}),initialLogs:j,initialStep:P,isFinishing:w,onStepChange:u=>g(u),onExitFocus:()=>W("reader"),onStart:async()=>{if(D)return;const u=T?.session_id??i?.id??null;if(!u){o({title:"Session manquante",description:"Impossible de démarrer sans session associée.",variant:"destructive"});return}const C={assignment_id:T?.id??null,athlete_id:s??null,athleteName:t??void 0,progress_pct:0,session_id:u,cycle_type:i?.cycle};try{const he=await Se.mutateAsync(C);he?.run_id&&q(he.run_id)}catch{return}},onLogSets:async u=>{D&&(A(C=>[...C??[],...u]),await Promise.all(u.map((C,he)=>Ze.mutateAsync({run_id:D,exercise_id:C.exercise_id,set_index:C.set_number??he+1,reps:C.reps??null,weight:C.weight??null,athlete_id:s??null,athlete_name:t??null}))))},onProgress:async u=>{D&&await fe.mutateAsync({run_id:D,progress_pct:u,status:"in_progress"})},onFinish:u=>{D&&(M(!0),fe.mutate({assignment_id:T?.id??void 0,run_id:D,session_id:T?.session_id??i?.id??void 0,athlete_id:s??void 0,date:new Date().toISOString(),progress_pct:100,status:"completed",...u}))}})}):e.jsxs("div",{className:"space-y-4 py-10",children:[e.jsx("div",{className:"mx-auto h-8 w-48 rounded-lg bg-muted animate-pulse motion-reduce:animate-none"}),e.jsx("div",{className:"mx-auto h-4 w-32 rounded-lg bg-muted animate-pulse motion-reduce:animate-none"}),e.jsx("div",{className:"space-y-3 pt-4",children:[1,2,3].map(u=>e.jsx("div",{className:"h-20 w-full rounded-xl bg-muted animate-pulse motion-reduce:animate-none"},u))})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-3xl font-display font-bold uppercase italic text-primary",children:"Musculation"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(Y,{variant:"ghost",size:"sm","aria-label":"Informations sur le calcul du 1RM",onClick:()=>{window.location.hash="#/records?tab=1rm"},className:"text-muted-foreground",children:[e.jsx(We,{className:"mr-2 h-4 w-4"})," Info 1RM"]}),e.jsx(Y,{variant:"ghost",size:"icon",onClick:()=>W("settings"),className:"rounded-full border border-muted/50 text-muted-foreground","aria-label":"Paramètres",children:e.jsx(bn,{className:"h-4 w-4"})})]})]}),e.jsxs(Gs,{defaultValue:"start",className:"w-full",children:[e.jsxs(Js,{className:"grid w-full grid-cols-2",children:[e.jsx(Qt,{value:"start",children:"S'entraîner"}),e.jsx(Qt,{value:"history",children:"Historique"})]}),e.jsxs(Yt,{value:"start",className:"space-y-5 pt-4",children:[U==="list"&&e.jsx(Zn,{user:t,userId:s,athleteName:x,athleteId:S,athleteKey:h,cycleType:L,searchQuery:b,isLoading:Te,setSaveState:E,onCycleChange:X,onSearchChange:ee,onStartAssignment:u=>{u.session_type==="strength"&&Me(u)},onStartCatalog:Qe,onResumeInProgress:({assignment:u,session:C,runId:he,logs:xe,progressPct:te})=>{$(u),v(C),q(he),A(xe),g(Os(C?.items??[],xe,te)),W("focus")}}),U==="settings"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[e.jsxs(Y,{variant:"ghost",size:"sm",onClick:()=>W("list"),className:"gap-2",children:[e.jsx(gs,{className:"h-4 w-4"}),"Retour"]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.3em] text-muted-foreground",children:"Préférences"}),e.jsx("h2",{className:"text-2xl font-display font-bold uppercase text-primary",children:"Paramètres"})]})]}),e.jsxs(Ve,{className:"border border-muted/60 shadow-sm",children:[e.jsxs(vt,{children:[e.jsx(Bt,{className:"text-lg uppercase",children:"Lisibilité & contrastes"}),e.jsx(is,{children:"Ajuste l'écran pour rester lisible en bassin comme en extérieur."})]}),e.jsxs(pt,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-4 rounded-lg border bg-muted/30 p-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm font-semibold uppercase",children:"Mode piscine"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Contraste renforcé et lisibilité optimisée."})]}),e.jsx(Mt,{checked:B,onCheckedChange:u=>K(C=>({...C,poolMode:u}))})]}),e.jsxs("div",{className:"flex items-center justify-between gap-4 rounded-lg border bg-muted/30 p-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm font-semibold uppercase",children:"Texte grand"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Police plus large pour lire pendant l'effort."})]}),e.jsx(Mt,{checked:Z,onCheckedChange:u=>K(C=>({...C,largeText:u}))})]})]})]}),e.jsx(Ve,{className:"border border-muted/60 shadow-sm",children:e.jsxs(pt,{className:"space-y-3 pt-6",children:[e.jsxs("div",{className:"flex items-center gap-3 text-sm text-muted-foreground",children:[e.jsx(en,{className:"h-4 w-4"}),e.jsx("span",{children:"Les préférences sont enregistrées sur cet appareil."})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 text-xs font-semibold uppercase text-muted-foreground",children:[B&&e.jsx(ot,{variant:"secondary",children:"Mode piscine activé"}),Z&&e.jsx(ot,{variant:"secondary",children:"Texte grand activé"}),!B&&!Z&&e.jsx(ot,{variant:"outline",children:"Réglages par défaut"})]})]})})]}),U==="reader"&&i&&ue&&e.jsx(tr,{session:i,assignment:T,cycleType:L,cycleOptions:me,exercises:ue,oneRMs:_||[],saveState:O,onBack:()=>W("list"),onLaunch:Ye})]}),e.jsx(Yt,{value:"history",className:"space-y-4 pt-4",children:e.jsx(sr,{athleteName:x,athleteId:S,athleteKey:h})})]})]})})}export{Ir as default};
