import{r as c,u as y,j as e}from"./vendor-query-DyA9aSKS.js";import{a as v}from"./api-Bvmnrh7j.js";import{B as k}from"./badge-D2Huo2Or.js";import{C as _}from"./Coach-Bs_jkMzi.js";import"./vendor-react-BzrpNAyj.js";import"./index-DWMfxnKm.js";import"./vendor-charts-BrQ8X25f.js";import"./vendor-supabase-DFPLkPj_.js";import"./vendor-motion-CMsaQ8FX.js";import"./swim-Cj1bygPc.js";import"./toggle-group-4QUn-Afv.js";import"./index-CtBaY3Qw.js";import"./index-DIhoOuTf.js";import"./target-CBFewydn.js";import"./clock-DzIBwX4X.js";function w(n){if(n.length===0)return null;const d=n[0],x=d.effort,p=d.fatigue,a=d.performance,m=d.engagement,o=[];return x!=null&&o.push((11-x)/2),p!=null&&o.push((11-p)/2),a!=null&&o.push(a/2),m!=null&&o.push(m/2),o.length===0?null:Math.round(o.reduce((f,g)=>f+g,0)/o.length*10)/10}function C(n){return n==null?{label:"—",className:"bg-muted text-muted-foreground"}:n>=3.5?{label:`${n.toFixed(1)}`,className:"bg-emerald-100 text-emerald-800 dark:bg-emerald-900/30 dark:text-emerald-400"}:n>=2.5?{label:`${n.toFixed(1)}`,className:"bg-amber-100 text-amber-800 dark:bg-amber-900/30 dark:text-amber-400"}:{label:`${n.toFixed(1)}`,className:"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400"}}function G({athletes:n,athletesLoading:d,onBack:x,onOpenAthlete:p}){const[a,m]=c.useState(null),[o,f]=c.useState("name"),{data:g=[]}=y({queryKey:["recent-sessions-all",30],queryFn:()=>v.getRecentSessionsAllAthletes(30),enabled:n.length>0,staleTime:300*1e3}),{data:b}=y({queryKey:["objectives-counts-by-user"],queryFn:()=>v.getObjectivesCountsByUser(),enabled:n.length>0,staleTime:300*1e3}),h=c.useMemo(()=>{const s=new Map;return n.forEach(t=>{t.group_id&&t.group_label&&s.set(t.group_id,t.group_label)}),Array.from(s.entries()).map(([t,r])=>({id:t,name:r})).sort((t,r)=>t.name.localeCompare(r.name,"fr"))},[n]),i=c.useMemo(()=>{const s=new Map,t=new Map;for(const r of g){if(r.athlete_id==null)continue;const l=t.get(r.athlete_id)??[];l.push(r),t.set(r.athlete_id,l)}for(const r of n){if(r.id==null)continue;const l=t.get(r.id)??[],u=w(l),N=l.length>0?l[0].session_date:null;s.set(r.id,{forme:u,lastSessionDate:N,sessionsCount30d:l.length,assiduity:null,objectivesTotal:b?.get(r.id)??0,objectivesAchieved:0})}return s},[n,g,b]),j=c.useMemo(()=>{let s=[...n];switch(a!=null&&(s=s.filter(t=>t.group_id===a)),o){case"forme":s.sort((t,r)=>{const l=t.id!=null?i.get(t.id)?.forme??99:99,u=r.id!=null?i.get(r.id)?.forme??99:99;return l-u});break;case"assiduity":s.sort((t,r)=>{const l=t.id!=null?i.get(t.id)?.sessionsCount30d??99:99,u=r.id!=null?i.get(r.id)?.sessionsCount30d??99:99;return l-u});break;default:s.sort((t,r)=>t.display_name.localeCompare(r.display_name,"fr"))}return s},[n,a,o,i]);return e.jsxs("div",{className:"space-y-4",children:[e.jsx(_,{title:"Nageurs",description:d?"Chargement…":`${n.length} nageur${n.length!==1?"s":""}`,onBack:x}),h.length>1&&e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{type:"button",onClick:()=>m(null),className:`rounded-full px-3 py-1 text-xs font-medium border transition ${a==null?"bg-foreground text-background border-foreground":"bg-card text-foreground border-border hover:bg-muted"}`,children:"Tous"}),h.map(s=>e.jsx("button",{type:"button",onClick:()=>m(a===s.id?null:s.id),className:`rounded-full px-3 py-1 text-xs font-medium border transition ${a===s.id?"bg-foreground text-background border-foreground":"bg-card text-foreground border-border hover:bg-muted"}`,children:s.name},s.id))]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"Trier :"}),[{key:"name",label:"Nom"},{key:"forme",label:"Forme"},{key:"assiduity",label:"Activité"}].map(s=>e.jsx("button",{type:"button",onClick:()=>f(s.key),className:`rounded-full px-2.5 py-0.5 text-xs font-medium border transition ${o===s.key?"bg-primary/10 text-primary border-primary/30":"bg-card text-muted-foreground border-border hover:bg-muted"}`,children:s.label},s.key))]}),d?e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3",children:[1,2,3,4,5,6].map(s=>e.jsxs("div",{className:"rounded-2xl border bg-card p-4 animate-pulse motion-reduce:animate-none",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-muted"}),e.jsxs("div",{className:"space-y-1.5 flex-1",children:[e.jsx("div",{className:"h-4 w-24 rounded bg-muted"}),e.jsx("div",{className:"h-3 w-16 rounded bg-muted"})]})]}),e.jsxs("div",{className:"mt-3 space-y-2",children:[e.jsx("div",{className:"h-3 w-full rounded bg-muted"}),e.jsx("div",{className:"h-3 w-2/3 rounded bg-muted"})]})]},s))}):j.length===0?e.jsx("p",{className:"text-sm text-muted-foreground text-center py-8",children:a!=null?"Aucun nageur dans ce groupe.":"Aucun nageur disponible."}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3",children:j.map(s=>{const t=s.id!=null?i.get(s.id):null,r=C(t?.forme??null);return e.jsxs("button",{type:"button",onClick:()=>p(s),className:"rounded-2xl border bg-card p-4 text-left hover:shadow-md hover:border-primary/20 transition-all",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[s.avatar_url?e.jsx("img",{src:s.avatar_url,alt:"",className:"h-10 w-10 rounded-full object-cover border border-border"}):e.jsx("div",{className:"h-10 w-10 rounded-full bg-primary/10 flex items-center justify-center text-sm font-bold text-primary",children:s.display_name.charAt(0).toUpperCase()}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-sm font-semibold truncate",children:s.display_name}),s.group_label&&e.jsx(k,{variant:"secondary",className:"text-[10px] px-1.5 py-0 mt-0.5",children:s.group_label})]})]}),e.jsxs("div",{className:"mt-3 grid grid-cols-3 gap-2",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-[10px] font-medium text-muted-foreground mb-1",children:"Forme"}),e.jsx("span",{className:`inline-block rounded-full px-2 py-0.5 text-xs font-semibold ${r.className}`,children:r.label})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-[10px] font-medium text-muted-foreground mb-1",children:"30j"}),e.jsx("span",{className:"text-sm font-bold text-foreground",children:t?.sessionsCount30d??0}),e.jsx("span",{className:"text-[10px] text-muted-foreground ml-0.5",children:"séances"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-[10px] font-medium text-muted-foreground mb-1",children:"Objectifs"}),e.jsx("span",{className:"text-sm font-bold text-foreground",children:t?.objectivesTotal??0})]})]}),t?.lastSessionDate&&e.jsxs("div",{className:"mt-2 text-[10px] text-muted-foreground",children:["Dernier ressenti : ",new Date(t.lastSessionDate).toLocaleDateString("fr-FR",{day:"numeric",month:"short"})]})]},s.id??s.display_name)})})]})}export{G as default};
