import{r as N,j as e,R as O,c as gt,u as ye,d as U}from"./vendor-query-DyA9aSKS.js";import{a as P}from"./api-B2vWtBIi.js";import{b as ce,c as S,ah as yt,T as jt,I as B,d as He,F as vt,P as ne,B as z,u as je,f as H}from"./index-C8n7RHvM.js";import{D as Y,a as J,b as ve,c as Ne}from"./dialog-C64CcAF4.js";import{A as we,a as ke,b as Se,c as _e,d as Te,e as Ce,f as Ae,g as Me}from"./alert-dialog-BduIZJJy.js";import{C as Nt}from"./chevron-right-BBe-i3EZ.js";import{g as wt,L as Qe,S as Xe}from"./SwimSessionTimeline-gAxvLjdi.js";import{F as kt,S as St,A as _t,a as Tt,d as Ve,c as Ct,e as At}from"./SessionListView-BkUhi2B5.js";import{T as Mt}from"./textarea-Dv6X0X9e.js";import{S as De,a as Ee,b as qe,c as Pe,d as Be}from"./select-o9R-Uy3P.js";import{i as Ye}from"./SwimTimeInput-C8cOKiBt.js";import{C as Vt}from"./copy-DL6j0hrZ.js";import{T as ie}from"./trash-2-DUbRsdUV.js";import{c as Je}from"./swimSessionUtils-DN7EW4yB.js";import{S as Dt}from"./sparkles-BWLwqTcy.js";import{R as Et}from"./repeat-ZRMON7Mn.js";import{f as Re}from"./date-DrpgLmFD.js";import{g as qt}from"./swim-Ur09MvRu.js";import{C as $e}from"./circle-alert-DTh18tCk.js";import{S as Pt}from"./search-D9doUYlU.js";import"./vendor-react-BzrpNAyj.js";import"./vendor-charts-BrQ8X25f.js";import"./vendor-supabase-DFPLkPj_.js";import"./vendor-motion-lao-Njgm.js";import"./index-Cp1GxP9-.js";import"./index-Czez78S2.js";import"./objectiveHelpers-DC7i01Ud.js";import"./chevron-up-5WRfms-N.js";import"./timer-DF5fEg07.js";import"./eye-DCclIcSU.js";import"./chevron-down-mWe9xaVK.js";import"./clock-_7noDjKb.js";import"./chevron-left-DHXEMWkM.js";import"./play-BZN-DNU5.js";import"./save-C4WwUm0I.js";import"./index-CNvkI8ip.js";import"./index-B72Prd0s.js";import"./circle-I1JpMk_2.js";import"./pencil-BNUUsfXE.js";import"./share-2-C1P-x_ix.js";import"./index-DCX2sNhR.js";import"./vendor-date-B8Mnp-Vt.js";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bt=[["path",{d:"m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2",key:"usdka0"}]],Le=ce("folder-open",Bt);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rt=[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-6a2 2 0 0 1 2.582 0l7 6A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"r6nss1"}]],Fe=ce("house",Rt);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $t=[["circle",{cx:"6",cy:"19",r:"3",key:"1kj8tv"}],["path",{d:"M9 19h8.5a3.5 3.5 0 0 0 0-7h-11a3.5 3.5 0 0 1 0-7H15",key:"1d8sl"}],["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}]],Lt=ce("route",$t),Ge=N.forwardRef(({...t},s)=>e.jsx("nav",{ref:s,"aria-label":"breadcrumb",...t}));Ge.displayName="Breadcrumb";const Ze=N.forwardRef(({className:t,...s},r)=>e.jsx("ol",{ref:r,className:S("flex flex-wrap items-center gap-1.5 break-words text-sm text-muted-foreground sm:gap-2.5",t),...s}));Ze.displayName="BreadcrumbList";const G=N.forwardRef(({className:t,...s},r)=>e.jsx("li",{ref:r,className:S("inline-flex items-center gap-1.5",t),...s}));G.displayName="BreadcrumbItem";const ae=N.forwardRef(({asChild:t,className:s,...r},i)=>{const a=t?yt:"a";return e.jsx(a,{ref:i,className:S("transition-colors hover:text-foreground",s),...r})});ae.displayName="BreadcrumbLink";const oe=N.forwardRef(({className:t,...s},r)=>e.jsx("span",{ref:r,role:"link","aria-disabled":"true","aria-current":"page",className:S("font-normal text-foreground",t),...s}));oe.displayName="BreadcrumbPage";const le=({children:t,className:s,...r})=>e.jsx("li",{role:"presentation","aria-hidden":"true",className:S("[&>svg]:w-3.5 [&>svg]:h-3.5",s),...r,children:t??e.jsx(Nt,{})});le.displayName="BreadcrumbSeparator";const ze=["V0","V1","V2","V3","Max","Prog"],Ft={V0:"bg-intensity-1",V1:"bg-intensity-2",V2:"bg-intensity-3",V3:"bg-intensity-4",Max:"bg-intensity-5",Prog:"bg-intensity-prog"},Ie={souple:"V0",facile:"V0",relache:"V0",rel√¢ch√©:"V0"},zt=t=>{if(!t)return"V0";const s=t.trim();if(!s)return"V0";const r=s.toLowerCase();if(Ie[r])return Ie[r];if(r==="prog"||r==="progressif")return"Prog";const i=s.toUpperCase();if(i==="MAX")return"Max";if(i.startsWith("V")){const a=i.replace("V","V");return a==="V4"||a==="V5"?"Max":a}return s};function It({value:t,onChange:s,className:r,ariaLabel:i="S√©lection d'intensit√©"}){const a=zt(t),u=ze.includes(a)?a:"Max";return e.jsx("div",{role:"radiogroup","aria-label":i,className:S("flex flex-wrap items-center gap-1",r),children:ze.map(h=>{const o=u===h,m=h==="Max"?"MAX":h==="Prog"?"Prog":h;return e.jsxs("button",{type:"button",role:"radio","aria-checked":o,"aria-label":`Intensit√© ${m}`,onClick:()=>s(h),className:S("flex flex-col items-center gap-1 rounded-full px-2 py-1 text-[10px] font-semibold text-muted-foreground transition","focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary",o?"text-foreground":"hover:text-foreground"),children:[h==="Prog"?e.jsx(jt,{className:S("h-3 w-3",o?"text-intensity-prog":"text-muted-foreground")}):e.jsx("span",{className:S("h-3 w-3 rounded-full",o?Ft[h]??"bg-primary":"bg-muted")}),e.jsx("span",{children:m})]},h)})})}const Oe={souple:"V0",facile:"V0",relache:"V0",rel√¢ch√©:"V0",ez:"V0"},Ot=["V0","V1","V2","V3","Max","Prog"],R=t=>{if(!t)return"V0";const s=t.trim();if(!s)return"V0";const r=s.toLowerCase();if(r==="prog"||r==="progressif")return"Prog";if(Oe[r])return Oe[r];const i=s.toUpperCase();if(i==="MAX"||i==="VMAX")return"Max";if(i.startsWith("V")){const a=Number.parseInt(i.slice(1),10);if(Number.isFinite(a)&&a>=4)return"Max";if(Ot.includes(i))return i}return s},We=t=>{const s=t.trim().toLowerCase();return s&&(s.startsWith("plaquette")||s.startsWith("plaq")?"plaquettes":s.startsWith("palm")?"palmes":s.startsWith("tuba")?"tuba":s.startsWith("pull")?"pull":s.startsWith("elas")?"elastique":s)};function Wt(t){const s=t.trim();return s?/^x\d+/i.test(s)?{type:"block_rep",raw:t,trimmed:s}:s.startsWith("#")?{type:"sub_detail",raw:t,trimmed:s}:s.startsWith("+")?{type:"continuation",raw:t,trimmed:s}:/^[SB]\d+\s*:/i.test(s)?{type:"annotation",raw:t,trimmed:s}:/^\d/.test(s)?{type:"exercise",raw:t,trimmed:s}:/^total\s*:/i.test(s)?{type:"unparsed",raw:t,trimmed:s}:{type:"unparsed",raw:t,trimmed:s}:{type:"empty",raw:t,trimmed:s}}function Ke(t){const s=t.match(/(\d+)'(\d+)/);if(s)return Number(s[1])*60+Number(s[2]);const r=t.match(/(\d+)(?:''|"|‚Ä≥)/);if(r)return Number(r[1]);const i=t.match(/^(\d+)$/);return i?Number(i[1]):null}function Kt(t){const s=t.join(" "),r=s.match(/@\s*([\d''"‚Ä≥]+(?:\s*\/\s*[\d''"‚Ä≥]+)?)/)||s.match(/\bd\s*:\s*([\d''"‚Ä≥]+(?:\s*\/\s*[\d''"‚Ä≥]+)?)/);if(r){const a=r[1].split("/")[0].trim(),u=Ke(a);if(u!==null)return{rest:u,restType:"departure"}}const i=s.match(/\br\s*:\s*([\d''"‚Ä≥]+(?:\s*\/\s*[\d''"‚Ä≥]+)?)/);if(i){const a=i[1].split("/")[0].trim(),u=Ke(a);if(u!==null)return{rest:u,restType:"rest"}}return null}function Ut(t){return t.normalize("NFD").replace(/[\u0300-\u036f]/g,"")}const Ht=[[/\b4n\b/i,"4n"],[/\bqn\b/i,"4n"],[/\bcrawl\b/i,"crawl"],[/\bcr\b/i,"crawl"],[/\bnl\b/i,"crawl"],[/\bpapillon\b/i,"pap"],[/\bpap\b/i,"pap"],[/\bdos\b/i,"dos"],[/\b[dD]\b/,"dos"],[/\bbrasse\b/i,"brasse"],[/\bbr\b/i,"brasse"],[/\bspe\b/i,"spe"]],Qt=[[/\beduc\b/i,"educ"],[/\bjbes\b/i,"jambes"],[/\bjambes\b/i,"jambes"],[/\bnac\b/i,"nc"],[/\bnc\b/i,"nc"]],Xt=[[/\bvmax\b/i,"Max"],[/\bmax\b/i,"Max"],[/\bvacc\b/i,"Max"],[/\bv3\b/i,"V3"],[/\bv2\b/i,"V2"],[/\bv1\b/i,"V1"],[/\bv0\b/i,"V0"],[/\bez\b/i,"V0"],[/\bsouple\b/i,"V0"],[/\bprog\b/i,"Prog"]],Yt=[[/\bplaq(?:uettes?)?\b/i,"plaquettes"],[/\bpalm(?:es)?\b/i,"palmes"],[/\btuba\b/i,"tuba"],[/\bpull\b/i,"pull"],[/\belas(?:tique)?\b/i,"elastique"]],Jt=[/\bW\b/,/\bmat\.\s*\w+/i,/\bDP\b/,/\bCB\b/,/\bR2N\b/,/\bD2B\b/,/\bampli\b/i,/\bAC\b/,/\bCP\b/,/\bRA\b/,/\b1\/2\s*pull\b/i,/\bfocus\b/i];function Gt(t){return t.replace(/\br\s*:\s*[\d''"‚Ä≥\/\s]+/g," ").replace(/@\s*[\d''"‚Ä≥\/\s]+/g," ").replace(/\bd\s*:\s*[\d''"‚Ä≥\/\s]+/g," ")}function Z(t){const s={repetitions:1,distance:null,stroke:"crawl",strokeType:"nc",intensity:"V1",rest:null,restType:"rest",equipment:[],modalities:""},r=Kt(t.split(/\s+/));r&&(s.rest=r.rest,s.restType=r.restType);const i=Gt(t),a=Ut(i),u=i.match(/(\d+)\s*[*x√ó]\s*(\d+)/i);if(u)s.repetitions=Number(u[1]),s.distance=Number(u[2]);else{const b=i.match(/^(\d+)\b/);b&&(s.distance=Number(b[1]))}/‚Üó|‚ÜóÔ∏é/.test(t)&&(s.intensity="Prog");const h=new Set,o=/\b(?:D2B|DP|CB|R2N|AC|CP|RA)\b/gi;let m;for(;(m=o.exec(a))!==null;)for(let b=m.index;b<m.index+m[0].length;b++)h.add(b);const p=b=>{for(let v=b.index;v<b.index+b[0].length;v++)if(h.has(v))return!0;return!1};if(s.intensity!=="Prog")for(const[b,v]of Xt){const j=new RegExp(b.source,b.flags+(b.flags.includes("g"),"")).exec(a);if(j&&!p(j)){s.intensity=v;break}}for(const[b,v]of Ht){const j=new RegExp(b.source,b.flags).exec(a);if(j&&!p(j)){if(v==="dos"&&b.source==="\\b[dD]\\b"&&j[0]!=="D")continue;s.stroke=v;break}}for(const[b,v]of Qt)if(b.test(a)){s.strokeType=v;break}for(const[b,v]of Yt)b.test(a)&&(s.equipment.includes(v)||s.equipment.push(v));const x=[],y=i.match(/\bW\s+[^\r\n]+/i);y&&x.push(y[0].trim());const w=i.match(/\bmat\.\s*\w+/i);w&&x.push(w[0].trim());for(const b of Jt){if(b.source.startsWith("\\bW\\b")||b.source.startsWith("\\bmat"))continue;const v=i.match(b);if(v){const D=v[0].trim();x.some(j=>j.includes(D))||x.push(D)}}const A=t.match(/\(([^)]+)\)/);if(A){const b=A[1].trim();b.length>2&&!x.some(v=>v.includes(b))&&x.push(`(${b})`)}const C=i.match(/\brespi\s+[\d\-]+\s*(?:temps)?/i);return C&&x.push(C[0].trim()),s.modalities=x.join(" / ").trim(),s}function Zt(t){const s=t.replace(/^#\s*/,"");if(/^\d+(?:-\d+)?\s*[:(\s]/.test(s)){if(/^\d+(?:-\d+)?\s*:/.test(s))return{form:"B",text:s.trim()};if(/^\d+\s*\(/.test(s))return{form:"B",text:s.trim()}}const r=s.match(/^(\d+)\b/);if(r){const i=Z(s);return{form:"A",distance:Number(r[1]),tokens:i}}return{form:"B",text:s.trim()}}function re(t){return{repetitions:t.repetitions,distance:t.distance,rest:t.rest,restType:t.restType,stroke:t.stroke,strokeType:t.strokeType,intensity:t.intensity,modalities:t.modalities,equipment:t.equipment}}function es(t){const s=[];let r=[];for(const i of t)i.type==="empty"?r.length>0&&(s.push({lines:r}),r=[]):r.push(i);return r.length>0&&s.push({lines:r}),s}function ts(t,s){const r={title:`Bloc ${s+1}`,repetitions:1,description:"",modalities:"",equipment:[],exercises:[]};let i=null,a=[];const u=[],h=[],o=()=>{if(i){if(a.length>0){const p=a.join(`
`);i.modalities=i.modalities?`${i.modalities}
${p}`:p}r.exercises.push(re(i))}i=null,a=[]};for(let p=0;p<t.lines.length;p++){const x=t.lines[p];switch(x.type){case"block_rep":{const y=x.trimmed.match(/^x(\d+)/i);y&&(r.repetitions=Number(y[1]));const w=x.trimmed.match(/\(([^)]+)\)/);if(w){const A=w[1].trim(),C=x.trimmed.slice(x.trimmed.indexOf(")")+1).trim();C&&h.push(C);const b=A.split(/\s*\+\s*/);for(const v of b)if(/^\d/.test(v.trim())){const D=Z(v.trim());r.exercises.push(re(D))}C&&(r.modalities=C)}break}case"exercise":{o(),i=Z(x.trimmed);break}case"sub_detail":{const y=Zt(x.trimmed);if(y.form==="A"&&i){const w=x.trimmed.replace(/^#\s*/,"");a.push(w)}else if(y.form==="B"&&i){const w=i.modalities;i.modalities=w?`${w} / ${y.text}`:y.text}else if(y.form==="A"){const w=re(y.tokens);w.distance=y.distance,r.exercises.push(w)}else u.push(y.text);break}case"continuation":{o();const y=x.trimmed.replace(/^\+\s*/,"").trim();/^\d/.test(y)?i=Z(y):u.push(y);break}case"annotation":{u.push(x.trimmed);break}case"unparsed":{p===0&&r.exercises.length===0&&!i?r.title=x.trimmed:u.push(x.trimmed);break}}}o(),u.length>0&&(r.description=u.join(`
`)),h.length>0&&(r.modalities=h.join(" / "));const m=new Set;for(const p of r.exercises)for(const x of p.equipment)m.add(x);return r.equipment=Array.from(m),r}function ss(t){if(!t||!t.trim())return[];const i=t.replace(/\r\n/g,`
`).replace(/\r/g,`
`).replace(/\u2018|\u2019/g,"'").replace(/\u201C|\u201D/g,'"').replace(/\u00A0/g," ").split(`
`).map(m=>Wt(m)),a=es(i),u=[];let h=0;for(const m of a){const p=m.lines.filter(y=>y.type!=="unparsed"||!/^total\s*:/i.test(y.trimmed));if(p.length===0)continue;const x=ts({lines:p},h);(x.exercises.length>0||x.description)&&(u.push(x),h++)}const o=[];for(let m=0;m<u.length;m++){const p=u[m];if(p.exercises.length===0&&!p.description&&(p.repetitions??1)>1&&m+1<u.length){const x=u[m+1];x.repetitions=p.repetitions}else o.push(p)}return o}const Q=t=>t?{min:Math.floor(t/60),sec:t%60}:{min:0,sec:0},rs=[{value:"palmes",label:"Palmes"},{value:"tuba",label:"Tuba"},{value:"plaquettes",label:"Plaquettes"},{value:"pull",label:"Pull"},{value:"elastique",label:"√âlastique"}],ns=[{value:"pap",label:"Papillon"},{value:"dos",label:"Dos"},{value:"brasse",label:"Brasse"},{value:"crawl",label:"Crawl"},{value:"4n",label:"4 nages"},{value:"spe",label:"Sp√©"}],is=[{value:"nc",label:"NC"},{value:"educ",label:"Educ"},{value:"jambes",label:"Jambes"}],as=t=>t==="Max"?"MAX":t,os={V0:"text-intensity-1",V1:"text-intensity-2",V2:"text-intensity-3",V3:"text-intensity-4",Max:"text-intensity-5",Prog:"text-intensity-prog"},ls={V0:"ring-intensity-1/30",V1:"ring-intensity-2/30",V2:"ring-intensity-3/30",V3:"ring-intensity-4/30",Max:"ring-intensity-5/30",Prog:"ring-intensity-prog/30"};function cs({exercise:t,onChange:s,onDelete:r,onDuplicate:i,showDelete:a=!0}){const u=R(t.intensity),h=t.modalities??"";return e.jsx("div",{className:"rounded-2xl border border-border bg-card p-3",children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"grid flex-1 grid-cols-2 sm:grid-cols-4 gap-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-[11px] font-semibold text-muted-foreground",children:"R√©p."}),e.jsx("div",{className:"mt-1",children:e.jsx(B,{type:"number",min:1,value:t.repetitions??"",onChange:o=>s("repetitions",o.target.value===""?null:Number(o.target.value)),className:"rounded-2xl"})})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-[11px] font-semibold text-muted-foreground",children:"Dist. (m)"}),e.jsx("div",{className:"mt-1",children:e.jsx(B,{type:"number",min:0,value:t.distance??"",onChange:o=>s("distance",o.target.value===""?null:Number(o.target.value)),className:"rounded-2xl"})})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-[11px] font-semibold text-muted-foreground",children:"Nage"}),e.jsx("div",{className:"mt-1",children:e.jsxs(De,{value:t.stroke,onValueChange:o=>s("stroke",o),children:[e.jsx(Ee,{className:"rounded-2xl",children:e.jsx(qe,{})}),e.jsx(Pe,{children:ns.map(o=>e.jsx(Be,{value:o.value,children:o.label},o.value))})]})})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-[11px] font-semibold text-muted-foreground",children:"Type"}),e.jsx("div",{className:"mt-1",children:e.jsxs(De,{value:t.strokeType,onValueChange:o=>s("strokeType",o),children:[e.jsx(Ee,{className:"rounded-2xl",children:e.jsx(qe,{})}),e.jsx(Pe,{children:is.map(o=>e.jsx(Be,{value:o.value,children:o.label},o.value))})]})})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-[11px] font-semibold text-muted-foreground",children:"Intensit√© (clic sur points)"}),e.jsxs("span",{className:S("inline-flex items-center gap-2 rounded-full bg-card px-2.5 py-1 text-xs font-semibold ring-1",ls[u],os[u]),children:[e.jsx("span",{className:S("h-2 w-2 rounded-full",Ye[u]??"bg-muted")}),as(u)]})]}),e.jsx("div",{className:"mt-2 flex items-center justify-between gap-2",children:e.jsx(It,{value:t.intensity,onChange:o=>s("intensity",o)})})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("div",{className:"text-[11px] font-semibold text-muted-foreground",children:"R√©cup√©ration"}),e.jsxs("div",{className:"mt-2 flex flex-wrap items-center gap-2",children:[e.jsxs("div",{className:"inline-flex rounded-full border border-border bg-card p-0.5 text-xs font-semibold",children:[e.jsx("button",{type:"button",onClick:()=>s("restType","departure"),className:S("rounded-full px-2.5 py-1 transition-colors",t.restType==="departure"?"bg-primary text-primary-foreground":"text-muted-foreground hover:text-foreground"),children:"D√©part"}),e.jsx("button",{type:"button",onClick:()=>s("restType","rest"),className:S("rounded-full px-2.5 py-1 transition-colors",t.restType==="rest"?"bg-primary text-primary-foreground":"text-muted-foreground hover:text-foreground"),children:"Repos"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(B,{type:"number",min:0,max:59,value:Q(t.rest).min||"",onChange:o=>{const m=o.target.value===""?0:Number(o.target.value),p=Q(t.rest).sec;s("rest",m*60+p||null)},placeholder:"0",className:"w-12 rounded-2xl text-center"}),e.jsx("span",{className:"text-[11px] text-muted-foreground",children:"min"}),e.jsx(B,{type:"number",min:0,max:59,value:Q(t.rest).sec||"",onChange:o=>{const m=o.target.value===""?0:Number(o.target.value),p=Q(t.rest).min;s("rest",p*60+m||null)},placeholder:"0",className:"w-12 rounded-2xl text-center"}),e.jsx("span",{className:"text-[11px] text-muted-foreground",children:"sec"})]}),t.rest?e.jsx("button",{type:"button",onClick:()=>s("rest",null),className:"text-[11px] text-muted-foreground hover:text-foreground",children:"Effacer"}):null]})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("div",{className:"text-[11px] font-semibold text-muted-foreground",children:"√âquipements"}),e.jsx("div",{className:"mt-2 flex flex-wrap gap-2",children:rs.map(o=>{const m=t.equipment.includes(o.value),p=wt(o.value);return e.jsxs("button",{type:"button",onClick:()=>{const x=m?t.equipment.filter(y=>y!==o.value):[...t.equipment,o.value];s("equipment",x)},className:S("inline-flex items-center gap-2 rounded-full border px-3 py-2 text-xs font-semibold",m?"border-primary bg-primary text-primary-foreground":"border-border bg-card text-muted-foreground hover:bg-muted"),children:[e.jsx("span",{className:S("inline-flex h-7 w-7 items-center justify-center rounded-full",m?"bg-white/10":"bg-muted"),children:p?e.jsx("img",{src:p,alt:"",className:"h-4 w-4","aria-hidden":"true",loading:"lazy"}):null}),o.label]},o.value)})})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("div",{className:"text-[11px] font-semibold text-muted-foreground",children:"Modalit√©s"}),e.jsx("div",{className:"mt-1",children:e.jsx(Mt,{value:h,onChange:o=>s("modalities",o.target.value),placeholder:"Une modalit√© par ligne",rows:3,className:"rounded-2xl"})})]})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[i&&e.jsx("button",{type:"button",onClick:i,className:"inline-flex h-9 w-9 items-center justify-center rounded-full text-muted-foreground hover:bg-muted","aria-label":"Dupliquer exercice",title:"Dupliquer exercice",children:e.jsx(Vt,{className:"h-4 w-4"})}),a&&r&&e.jsx("button",{type:"button",onClick:r,className:"inline-flex h-9 w-9 items-center justify-center rounded-full text-destructive hover:bg-destructive/10","aria-label":"Supprimer exercice",title:"Supprimer exercice",children:e.jsx(ie,{className:"h-4 w-4"})})]})]})})}const ds={nc:"NC",educ:"Educ",jambes:"Jambes"},us={nc:"bg-sky-100 text-sky-900 ring-sky-200",educ:"bg-violet-100 text-violet-900 ring-violet-200",jambes:"bg-teal-100 text-teal-900 ring-teal-200"},ms={V0:"text-intensity-1",V1:"text-intensity-2",V2:"text-intensity-3",V3:"text-intensity-4",Max:"text-intensity-5",Prog:"text-intensity-prog"},ps={V0:"ring-intensity-1/30",V1:"ring-intensity-2/30",V2:"ring-intensity-3/30",V3:"ring-intensity-4/30",Max:"ring-intensity-5/30",Prog:"ring-intensity-prog/30"},xs=t=>t==="Max"?"MAX":t,fs=t=>{if(!t)return"";const s=Math.floor(t/60),r=t%60;return s>0&&r>0?`${s}'${r.toString().padStart(2,"0")}`:s>0?`${s}'00`:`${r}s`},Ue=t=>{let s=0;return t.flatMap((r,i)=>r.exercises.map((a,u)=>{const h={block_title:r.title,block_description:r.description||null,block_order:i,block_repetitions:r.repetitions??null,block_modalities:r.modalities||null,block_equipment:r.equipment??[],exercise_repetitions:a.repetitions??null,exercise_rest:a.rest??null,exercise_rest_type:a.restType??"rest",exercise_stroke:a.stroke||null,exercise_stroke_type:a.strokeType||null,exercise_intensity:a.intensity?R(a.intensity):null,exercise_modalities:a.modalities||null,exercise_equipment:a.equipment??[],exercise_order:u},o=a.repetitions&&a.distance?`${a.repetitions}x${a.distance}m`:a.distance?`${a.distance}m`:null;return{ordre:s++,label:o,distance:a.distance??null,duration:null,intensity:a.intensity?R(a.intensity):null,notes:a.modalities||null,raw_payload:h}}))};function bs({session:t,onSessionChange:s,onSave:r,onCancel:i,userId:a,isSaving:u}){const{toast:h}=He(),[o,m]=O.useState("blocks"),[p,x]=O.useState(t.description||""),[y,w]=O.useState(null),[A,C]=O.useState(null),b=N.useMemo(()=>Je(Ue(t.blocks)),[t.blocks]),v=()=>{s({...t,blocks:[...t.blocks,{title:"Nouveau bloc",repetitions:1,description:"",modalities:"",equipment:[],exercises:[{repetitions:4,distance:50,rest:null,restType:"rest",stroke:"crawl",strokeType:"nc",intensity:"V2",modalities:"",equipment:[]}]}]})},D=(c,f,d)=>{const k=[...t.blocks];k[c]={...k[c],[f]:d},s({...t,blocks:k})},j=c=>{const f=t.blocks.filter((d,k)=>k!==c);s({...t,blocks:f})},q=(c,f)=>{const d=f==="up"?c-1:c+1;if(d<0||d>=t.blocks.length)return;const k=[...t.blocks],[_]=k.splice(c,1);k.splice(d,0,_),s({...t,blocks:k})},M=c=>{const f=[...t.blocks];f[c].exercises.push({repetitions:4,distance:50,rest:null,restType:"rest",stroke:"crawl",strokeType:"nc",intensity:"V2",modalities:"",equipment:[]}),s({...t,blocks:f})},$=(c,f,d,k)=>{const _=[...t.blocks],T=[..._[c].exercises];T[f]={...T[f],[d]:k},_[c]={..._[c],exercises:T},s({...t,blocks:_})},W=(c,f)=>{const d=[...t.blocks];d[c].exercises=d[c].exercises.filter((k,_)=>_!==f),s({...t,blocks:d})},L=(c,f)=>{const d=[...t.blocks],_={...d[c].exercises[f]};d[c].exercises=[...d[c].exercises.slice(0,f+1),_,...d[c].exercises.slice(f+1)],s({...t,blocks:d}),w({blockIndex:c,exerciseIndex:f+1})};return e.jsxs("div",{className:"animate-in slide-in-from-bottom-4 motion-reduce:animate-none",children:[e.jsx(kt,{isEditing:!!t.id,isSaving:u,saveDisabled:o==="text",onSave:r,onCancel:i,onPreview:o==="blocks"?()=>C({id:t.id??Date.now(),name:t.name,description:t.description,created_by:a??null,items:Ue(t.blocks)}):void 0}),e.jsxs("div",{className:"space-y-4 p-4",children:[e.jsx(St,{name:t.name,onNameChange:c=>s({...t,name:c}),estimatedDuration:t.estimatedDuration,onEstimatedDurationChange:c=>s({...t,estimatedDuration:c}),totalDistance:o==="blocks"?b:void 0,showDuration:!0,showTotalDistance:o==="blocks"}),e.jsxs("div",{className:"flex items-center rounded-xl border border-border bg-muted/50 p-0.5",children:[e.jsxs("button",{type:"button",onClick:()=>m("blocks"),className:S("flex flex-1 items-center justify-center gap-1.5 rounded-lg px-3 py-2 text-xs font-semibold transition-colors",o==="blocks"?"bg-background text-foreground shadow-sm":"text-muted-foreground hover:text-foreground"),children:[e.jsx(Qe,{className:"h-3.5 w-3.5"}),"Blocs"]}),e.jsxs("button",{type:"button",onClick:()=>m("text"),className:S("flex flex-1 items-center justify-center gap-1.5 rounded-lg px-3 py-2 text-xs font-semibold transition-colors",o==="text"?"bg-background text-foreground shadow-sm":"text-muted-foreground hover:text-foreground"),children:[e.jsx(vt,{className:"h-3.5 w-3.5"}),"Texte"]})]}),o==="text"?e.jsxs("div",{className:"space-y-3",children:[e.jsx("textarea",{value:p,onChange:c=>x(c.target.value),placeholder:`Collez ou tapez votre s√©ance ici‚Ä¶

Exemple :
√âchauffement
4x100 crawl V1 R30
8x50 educ dos V0

Corps de s√©ance
2x(4x100 NL V3 D1'30)
6x50 papillon jambes V2 R20

Retour au calme
200 4N souple`,className:"min-h-[280px] w-full resize-y rounded-2xl border border-border bg-card px-4 py-3 text-sm leading-relaxed placeholder:text-muted-foreground/60 focus:outline-none focus:ring-2 focus:ring-ring"}),e.jsxs("button",{type:"button",onClick:()=>{if(!p.trim())return;const c=ss(p);if(c.length===0){h({title:"Aucun bloc reconnu",description:"V√©rifiez le format du texte.",variant:"destructive"});return}s({...t,blocks:c,description:p}),m("blocks"),h({title:`${c.length} bloc(s) import√©(s)`})},className:"inline-flex w-full items-center justify-center gap-2 rounded-full bg-primary px-4 py-2.5 text-sm font-semibold text-primary-foreground transition-colors hover:bg-primary/90",children:[e.jsx(Dt,{className:"h-4 w-4"}),"Convertir en s√©ance"]}),e.jsx("p",{className:"text-center text-[11px] text-muted-foreground",children:"La conversion analysera votre texte et cr√©era les blocs correspondants."})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-3",children:[t.blocks.map((c,f)=>e.jsxs("div",{className:"rounded-2xl border border-border bg-card",children:[e.jsxs("div",{className:"flex items-center justify-between gap-1 px-3 py-2",children:[e.jsxs("div",{className:"flex min-w-0 flex-1 items-center gap-1.5",children:[e.jsxs("span",{className:"inline-flex shrink-0 items-center gap-1 rounded-full bg-primary px-2 py-0.5 text-[11px] font-semibold text-primary-foreground",children:[e.jsx(Et,{className:"inline h-3 w-3"})," ",c.repetitions??1,"x"]}),e.jsx(B,{value:c.title,onChange:d=>D(f,"title",d.target.value),placeholder:`Bloc ${f+1}`,className:"h-7 min-w-0 flex-1 rounded-lg border-none bg-transparent px-1 text-xs font-semibold shadow-none focus-visible:bg-muted focus-visible:ring-1"}),e.jsxs("div",{className:"shrink-0 text-[11px] text-muted-foreground whitespace-nowrap",children:["¬∑ ",c.exercises.length," ex"]})]}),e.jsxs("div",{className:"flex shrink-0 items-center gap-0.5",children:[e.jsx(B,{type:"number",min:1,value:c.repetitions??"",onChange:d=>D(f,"repetitions",d.target.value===""?null:Number(d.target.value)),className:"h-7 w-11 rounded-lg text-center text-xs",placeholder:"1"}),e.jsx("button",{type:"button",onClick:()=>q(f,"up"),className:"inline-flex h-10 w-10 items-center justify-center rounded-full hover:bg-muted disabled:opacity-40",disabled:f===0,children:e.jsx(_t,{className:"h-3.5 w-3.5"})}),e.jsx("button",{type:"button",onClick:()=>q(f,"down"),className:"inline-flex h-10 w-10 items-center justify-center rounded-full hover:bg-muted disabled:opacity-40",disabled:f===t.blocks.length-1,children:e.jsx(Tt,{className:"h-3.5 w-3.5"})}),e.jsx("button",{type:"button",onClick:()=>j(f),className:"inline-flex h-10 w-10 items-center justify-center rounded-full text-destructive hover:bg-destructive/10",children:e.jsx(ie,{className:"h-3.5 w-3.5"})})]})]}),e.jsx("div",{className:"border-t border-border",children:c.exercises.map((d,k)=>{const _=y?.blockIndex===f&&y?.exerciseIndex===k,T=R(d.intensity);return e.jsxs("div",{className:"border-b border-border last:border-b-0",children:[e.jsxs("button",{type:"button",onClick:()=>w(_?null:{blockIndex:f,exerciseIndex:k}),className:S("flex w-full items-center gap-1 px-3 py-2 text-left text-[11px] font-semibold transition-colors hover:bg-muted/50 overflow-hidden",_&&"bg-muted/50"),children:[e.jsxs("div",{className:"flex min-w-0 flex-1 flex-wrap items-center gap-1",children:[e.jsxs("span",{className:"text-muted-foreground whitespace-nowrap",children:[d.repetitions??"","√ó",d.distance??"","m"]}),e.jsx("span",{className:"text-muted-foreground whitespace-nowrap",children:d.stroke}),e.jsx("span",{className:S("inline-flex items-center rounded-full px-1.5 py-0.5 ring-1 whitespace-nowrap",us[d.strokeType]??"bg-muted ring-border"),children:ds[d.strokeType]??d.strokeType}),e.jsxs("span",{className:S("inline-flex items-center gap-1 rounded-full bg-card px-1.5 py-0.5 ring-1 whitespace-nowrap",ps[T],ms[T]),children:[e.jsx("span",{className:S("h-1.5 w-1.5 rounded-full",Ye[T]??"bg-muted")}),xs(T)]}),d.rest?e.jsxs("span",{className:"text-muted-foreground whitespace-nowrap",children:[d.restType==="departure"?"‚è±":"‚è∏"," ",d.restType==="departure"?"D√©p.":"Repos"," ",fs(d.rest)]}):null,d.equipment.length>0?e.jsxs("span",{className:"text-muted-foreground whitespace-nowrap",children:["üèä",d.equipment.length]}):null]}),e.jsx("span",{onClick:E=>{E.stopPropagation(),W(f,k)},className:"inline-flex h-6 w-6 shrink-0 items-center justify-center rounded-full text-destructive hover:bg-destructive/10",children:e.jsx(ie,{className:"h-3 w-3"})})]}),_?e.jsx("div",{className:"border-t border-border bg-muted/30 px-3 py-3",children:e.jsx(cs,{exercise:d,onChange:(E,V)=>$(f,k,E,V),onDelete:()=>W(f,k),onDuplicate:()=>L(f,k),showDelete:!0})}):null]},k)})}),e.jsx("div",{className:"border-t border-border px-3 py-2",children:e.jsxs("button",{type:"button",onClick:()=>M(f),className:"inline-flex items-center gap-1 rounded-full bg-muted px-3 py-1.5 text-[11px] font-semibold text-muted-foreground hover:bg-muted/80",children:[e.jsx(ne,{className:"h-3 w-3"})," Exercice"]})})]},f)),t.blocks.length?null:e.jsx("div",{className:"rounded-2xl border border-dashed border-border bg-muted px-3 py-6 text-center text-sm text-muted-foreground",children:"Aucun bloc. Ajoute un bloc pour commencer."})]}),e.jsxs(z,{variant:"outline",size:"sm",onClick:v,className:"h-10 rounded-full px-3 text-xs",children:[e.jsx(ne,{className:"h-4 w-4"})," Ajouter bloc"]})]}),e.jsx("div",{className:"h-8"})]}),e.jsx(Y,{open:!!A,onOpenChange:c=>{c||C(null)},children:e.jsx(J,{className:"max-w-4xl",children:e.jsx(Xe,{title:A?.name??"",description:A?.description??void 0,items:A?.items})})})]})}function hs(t){N.useEffect(()=>{if(!t)return;const s=r=>{r.preventDefault()};return window.addEventListener("beforeunload",s),()=>window.removeEventListener("beforeunload",s)},[t])}const gs=t=>{let s=0;return t.flatMap((r,i)=>r.exercises.map((a,u)=>{const h={block_title:r.title,block_description:r.description||null,block_order:i,block_repetitions:r.repetitions??null,block_modalities:r.modalities||null,block_equipment:r.equipment??[],exercise_repetitions:a.repetitions??null,exercise_rest:a.rest??null,exercise_rest_type:a.restType??"rest",exercise_stroke:a.stroke||null,exercise_stroke_type:a.strokeType||null,exercise_intensity:a.intensity?R(a.intensity):null,exercise_modalities:a.modalities||null,exercise_equipment:a.equipment??[],exercise_order:u},o=a.repetitions&&a.distance?`${a.repetitions}x${a.distance}m`:a.distance?`${a.distance}m`:null;return{ordre:s++,label:o,distance:a.distance??null,duration:null,intensity:a.intensity?R(a.intensity):null,notes:a.modalities||null,raw_payload:h}}))},ys=(t=[])=>{const s=new Map;return t.forEach(r=>{const i=r.raw_payload??{},a=i.block_title||i.section||"Bloc",u=Number(i.block_order??0),h=`${u}-${a}`,o=i.block_equipment??i.equipment??[],m=(Array.isArray(o)?o:String(o).split(",")).map(w=>String(w)).map(w=>We(w)).filter(Boolean);s.has(h)||s.set(h,{title:a,repetitions:i.block_repetitions??null,description:i.block_description??"",modalities:i.block_modalities??i.modalities??"",equipment:m,exercises:[],order:Number.isFinite(u)?u:0,exerciseOrder:new Map});const p=s.get(h),x=Number(i.exercise_order??r.ordre??p.exercises.length),y=R(i.exercise_intensity??r.intensity??"V1");p.exerciseOrder.set(x,{repetitions:i.exercise_repetitions??null,distance:r.distance??null,rest:i.exercise_rest??null,restType:i.exercise_rest_type??"rest",stroke:i.exercise_stroke??i.stroke??"crawl",strokeType:i.exercise_stroke_type??i.stroke_type??"nc",intensity:y,modalities:i.exercise_modalities??r.notes??"",equipment:Array.isArray(i.exercise_equipment)?i.exercise_equipment.map(w=>We(w)):[]})}),Array.from(s.values()).sort((r,i)=>r.order-i.order).map(r=>({title:r.title,repetitions:r.repetitions,description:r.description,modalities:r.modalities,equipment:r.equipment,exercises:Array.from(r.exerciseOrder.entries()).sort(([i],[a])=>i-a).map(([,i])=>i)}))},js=(t=[])=>new Set(t.map(r=>{const i=r.raw_payload;return i?.block_title||i?.section||"Bloc"})).size,X="swim_catalog_archived_ids",I="swim_catalog_archive_migrated",vs=(t,s)=>s===null?!1:!s.some(r=>r.session_type==="swim"&&r.session_id===t),Ns=(t,s)=>s===null?t:t.slice(s.length+1);function ws(t){const[s,r,i]=t.split("-").map(Number);return new Date(s,r-1,i).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit"})}function ks(t){return`${t.startTime.slice(0,5)} ¬∑ ${t.location}`}function Ss(t){return`S√©ance du ${ws(t.scheduledDate)} - ${ks(t)}`}function xr({entryContext:t=null,onEntryContextConsumed:s}={}){const{toast:r}=He(),i=gt(),a=je(n=>n.userId),u=je(n=>n.role),[h,o]=N.useState(t?.mode==="create");hs(h);const[m,p]=N.useState(null),[x,y]=N.useState(null),[w,A]=N.useState(null),[C,b]=N.useState(""),[v,D]=N.useState(30),[j,q]=N.useState(null),[M,$]=N.useState(!1),[W,L]=N.useState(!1),[c,f]=N.useState(""),[d,k]=N.useState(null),_=(n,l=j)=>({id:null,name:n?.mode==="create"?Ss(n.slot):Re(new Date),description:"",estimatedDuration:0,folder:l,blocks:[]}),[T,E]=N.useState(()=>_(t?.mode==="create"?t:null)),{data:V,isLoading:de,error:K,refetch:et}=ye({queryKey:["swim_catalog"],queryFn:()=>P.getSwimCatalog()}),{data:tt,isLoading:st,isError:rt,error:ue,refetch:nt}=ye({queryKey:["coach-assignments"],queryFn:()=>P.getAssignmentsForCoach(),enabled:u==="coach"||u==="admin"});N.useEffect(()=>{if(typeof window>"u"||window.localStorage.getItem(I))return;const n=window.localStorage.getItem(X);if(!n){window.localStorage.setItem(I,"true");return}try{const l=JSON.parse(n);if(Array.isArray(l)&&l.length>0){const g=l.map(Number).filter(Number.isFinite);P.migrateLocalStorageArchive(g).then(()=>{window.localStorage.removeItem(X),window.localStorage.setItem(I,"true"),i.invalidateQueries({queryKey:["swim_catalog"]})}).catch(()=>{})}else window.localStorage.removeItem(X),window.localStorage.setItem(I,"true")}catch{window.localStorage.removeItem(X),window.localStorage.setItem(I,"true")}},[i]);const ee=N.useMemo(()=>{const n=new Set;return(V??[]).forEach(l=>{if(l.folder){const g=l.folder.split("/");for(let F=1;F<=g.length;F++)n.add(g.slice(0,F).join("/"))}}),Array.from(n).sort()},[V]),te=N.useMemo(()=>{const n=j?j+"/":"",l=new Set;return ee.forEach(g=>{if(j===null)g.includes("/")||l.add(g);else if(g.startsWith(n)){const F=g.slice(n.length);F&&!F.includes("/")&&l.add(g)}}),Array.from(l).sort()},[ee,j]),it=N.useMemo(()=>{const n={};return(V??[]).filter(l=>!l.is_archived).forEach(l=>{l.folder&&te.forEach(g=>{(l.folder===g||l.folder.startsWith(g+"/"))&&(n[g]=(n[g]??0)+1)})}),n},[V,te]),me=N.useMemo(()=>(V??[]).filter(n=>n.is_archived).length,[V]),se=N.useMemo(()=>{let n=V??[];const l=C.trim().toLowerCase();return M?n=n.filter(g=>g.is_archived):(n=n.filter(g=>!g.is_archived),n=n.filter(g=>j===null?!g.folder:g.folder===j)),l&&(n=n.filter(g=>g.name.toLowerCase().includes(l)||(g.description??"").toLowerCase().includes(l))),n},[V,C,j,M]);N.useEffect(()=>{D(30)},[C,j,M]);const pe=U({mutationFn:n=>P.createSwimSession(n),onSuccess:(n,l)=>{i.invalidateQueries({queryKey:["swim_catalog"]}),o(!1),E(_()),r({title:l?.id?"S√©ance natation mise √† jour":"S√©ance natation cr√©√©e"})}}),xe=U({mutationFn:n=>P.deleteSwimSession(n),onSuccess:()=>{i.invalidateQueries({queryKey:["swim_catalog"]}),y(null),r({title:"S√©ance supprim√©e"})},onError:()=>{r({title:"Suppression impossible",description:"Cette s√©ance est utilis√©e dans une assignation.",variant:"destructive"})}}),fe=U({mutationFn:({sessionId:n,archived:l})=>P.archiveSwimSession(n,l),onSuccess:(n,l)=>{i.invalidateQueries({queryKey:["swim_catalog"]}),A(null),r({title:l.archived?"S√©ance archiv√©e":"S√©ance restaur√©e"})}}),at=U({mutationFn:({sessionId:n,folder:l})=>P.moveSwimSession(n,l),onSuccess:()=>{i.invalidateQueries({queryKey:["swim_catalog"]}),k(null),r({title:"S√©ance d√©plac√©e"})}}),ot=()=>{if(!T.name.trim()){r({title:"Titre requis",description:"Ajoutez un nom de s√©ance avant d'enregistrer.",variant:"destructive"});return}pe.mutate({id:T.id??void 0,name:T.name,description:T.description,estimated_duration:T.estimatedDuration||null,folder:T.folder??j,items:gs(T.blocks),created_by:a??null})},lt=()=>{o(!1),E(_())},be=n=>{E({id:n.id??null,name:n.name??Re(new Date),description:n.description??"",estimatedDuration:Number(n.estimated_duration??0),folder:n.folder??null,blocks:ys(n.items??[])}),o(!0)};N.useEffect(()=>{if(!t)return;if(t.mode==="create"){$(!1),q(null),p(null),E(_(t,null)),o(!0),s?.();return}if(!V)return;const n=V.find(l=>l.id===t.swimCatalogId);if(!n){r({title:"S√©ance introuvable",description:"La s√©ance li√©e √† ce cr√©neau n'est plus disponible.",variant:"destructive"}),s?.();return}$(!1),q(n.folder??null),be(n),s?.()},[t,V,s,r]);const ct=n=>{A(n)},dt=()=>{w&&fe.mutate({sessionId:w.id,archived:!0})},ut=n=>{fe.mutate({sessionId:n.id,archived:!1})},mt=n=>{y(n)},pt=()=>{x&&xe.mutate(x.id)},he=()=>{const n=c.trim();if(!n)return;const l=j?`${j}/${n}`:n;q(l),L(!1),f("")},ge=n=>{d&&at.mutate({sessionId:d.id,folder:n})},xt=async n=>{try{const l=await qt(n.id),g=`${window.location.origin}${window.location.pathname}#/s/${l}`;navigator.share?await navigator.share({title:n.name,url:g}):(await navigator.clipboard.writeText(g),r({title:"Lien copi√© !",description:"Le lien de partage a √©t√© copi√© dans le presse-papier."}))}catch{r({title:"Erreur",description:"Impossible de g√©n√©rer le lien de partage.",variant:"destructive"})}},ft=n=>{const l=n.match(/^S√©ance du (\d{2}\/\d{2}(?:\/\d{4})?) - (.+)$/);return l?{date:l[1],creneau:l[2]}:null},bt=n=>{const l=ft(n.name);return l?e.jsxs("span",{className:"flex items-baseline gap-1.5",children:[e.jsx("span",{children:l.date}),e.jsx("span",{className:"rounded-md bg-muted px-1.5 py-0.5 text-[10px] font-semibold uppercase tracking-wide text-muted-foreground",children:l.creneau})]}):n.name},ht=n=>{const l=Je(n.items??[]),g=js(n.items??[]);return e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx(Lt,{className:"h-3 w-3"}),l>0?`${l}m`:"‚Äî"]}),e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx(Qe,{className:"h-3 w-3"}),g," bloc",g>1?"s":""]})]})};return h?e.jsx(bs,{session:T,onSessionChange:E,onSave:ot,onCancel:lt,userId:a,isSaving:pe.isPending}):de||st?e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-border px-4 py-3",children:[e.jsxs("div",{children:[e.jsx(H,{className:"h-5 w-16 mb-1"}),e.jsx(H,{className:"h-3 w-20"})]}),e.jsx(H,{className:"h-9 w-24 rounded-full"})]}),e.jsxs("div",{className:"p-4",children:[e.jsx(H,{className:"h-10 w-full rounded-2xl mb-4"}),e.jsx(Ve,{sessions:[],isLoading:!0,renderTitle:()=>"",renderMetrics:()=>null,onPreview:()=>{},onEdit:()=>{},onArchive:()=>{},onDelete:()=>{},canDelete:()=>!1})]})]}):K?e.jsxs("div",{className:"flex flex-col items-center justify-center p-8 text-center",children:[e.jsx($e,{className:"h-12 w-12 text-destructive mb-4"}),e.jsx("h3",{className:"font-semibold",children:"Impossible de charger les donn√©es"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:K instanceof Error?K.message:"Une erreur s'est produite"}),e.jsx(z,{variant:"default",onClick:()=>et(),className:"mt-4 h-12 md:h-10",children:"R√©essayer"})]}):e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-border px-4 py-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-base font-semibold",children:"Coach"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Cr√©ation"})]}),!M&&e.jsxs("button",{type:"button",onClick:()=>{E(_()),o(!0)},className:"inline-flex items-center gap-2 rounded-full bg-primary px-3 py-2 text-xs font-semibold text-primary-foreground",children:[e.jsx(ne,{className:"h-4 w-4"})," Nouvelle"]})]}),e.jsxs("div",{className:"p-4",children:[(j!==null||M)&&e.jsx(Ge,{className:"mb-3",children:e.jsxs(Ze,{children:[e.jsx(G,{children:e.jsx(ae,{className:"cursor-pointer py-2 px-1",onClick:()=>{q(null),$(!1)},children:e.jsx(Fe,{className:"h-4 w-4"})})}),M?e.jsxs(e.Fragment,{children:[e.jsx(le,{}),e.jsx(G,{children:e.jsx(oe,{children:"Archives"})})]}):j?.split("/").map((n,l,g)=>e.jsxs(O.Fragment,{children:[e.jsx(le,{}),e.jsx(G,{children:l===g.length-1?e.jsx(oe,{children:n}):e.jsx(ae,{className:"cursor-pointer py-2 px-1",onClick:()=>q(g.slice(0,l+1).join("/")),children:n})})]},l))]})}),e.jsxs("div",{className:"flex items-center gap-2 rounded-2xl border border-border bg-card px-3 py-2",children:[e.jsx(Pt,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("input",{className:"w-full bg-transparent text-sm outline-none placeholder:text-muted-foreground",placeholder:"Rechercher une s√©ance",value:C,onChange:n=>b(n.target.value)})]}),!M&&e.jsxs("div",{className:"mt-3 flex flex-wrap gap-2",children:[te.map(n=>e.jsxs("button",{type:"button",onClick:()=>q(n),className:"inline-flex items-center gap-1.5 rounded-xl border border-border bg-card px-3 py-1.5 text-sm font-medium hover:bg-muted transition-colors",children:[e.jsx(Le,{className:"h-4 w-4 text-muted-foreground"}),Ns(n,j),e.jsxs("span",{className:"text-xs text-muted-foreground",children:["(",it[n]??0,")"]})]},n)),e.jsxs("button",{type:"button",onClick:()=>L(!0),className:"inline-flex items-center gap-1.5 rounded-xl border border-dashed border-border px-3 py-1.5 text-sm text-muted-foreground hover:bg-muted transition-colors",children:[e.jsx(Ct,{className:"h-4 w-4"}),"Nouveau dossier"]}),j===null&&me>0&&e.jsxs("button",{type:"button",onClick:()=>$(!0),className:"inline-flex items-center gap-1.5 rounded-xl border border-border bg-muted/50 px-3 py-1.5 text-sm text-muted-foreground hover:bg-muted transition-colors",children:[e.jsx(At,{className:"h-4 w-4"}),"Archives",e.jsxs("span",{className:"text-xs",children:["(",me,")"]})]})]}),rt&&e.jsxs("div",{className:"mt-4 flex flex-col items-center rounded-lg border border-destructive/20 bg-destructive/10 p-4",children:[e.jsx($e,{className:"h-8 w-8 text-destructive mb-2"}),e.jsx("p",{className:"text-sm text-destructive font-semibold",children:"Impossible de charger les assignations"}),e.jsx("p",{className:"text-xs text-destructive/80 mt-1",children:ue instanceof Error?ue.message:"Une erreur s'est produite"}),e.jsx(z,{variant:"outline",size:"sm",onClick:()=>nt(),className:"mt-2 h-10",children:"R√©essayer"})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx(Ve,{sessions:se.slice(0,v),isLoading:de,error:K,renderTitle:bt,renderMetrics:ht,onPreview:p,onEdit:be,onArchive:M?ut:ct,onDelete:mt,canDelete:n=>vs(n,tt??null),isDeleting:xe.isPending,onMove:M?void 0:n=>k(n),onShare:M?void 0:xt,archiveMode:M?"restore":"archive"}),se.length>v&&e.jsxs("div",{className:"flex flex-col items-center gap-2 py-4",children:[e.jsxs("p",{className:"text-xs text-muted-foreground",children:[v," sur ",se.length," s√©ances"]}),e.jsx(z,{variant:"outline",size:"sm",onClick:()=>D(n=>n+30),children:"Voir plus"})]})]}),e.jsx("div",{className:"h-8"})]}),e.jsx(Y,{open:!!m,onOpenChange:n=>{n||p(null)},children:e.jsxs(J,{className:"max-w-4xl",children:[e.jsx("div",{className:"pb-2",children:e.jsx("span",{className:"text-lg font-display font-bold uppercase tracking-tight",children:m?.name})}),e.jsx(Xe,{title:m?.name??"",description:m?.description??void 0,items:m?.items})]})}),e.jsx(Y,{open:W,onOpenChange:L,children:e.jsxs(J,{children:[e.jsx(ve,{children:e.jsx(Ne,{children:"Nouveau dossier"})}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(B,{placeholder:"Nom du dossier",value:c,onChange:n=>f(n.target.value),onKeyDown:n=>{n.key==="Enter"&&he()},className:"rounded-2xl"}),c.trim()&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Chemin : ",j?`${j}/${c.trim()}`:c.trim()]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(z,{variant:"outline",onClick:()=>{L(!1),f("")},children:"Annuler"}),e.jsx(z,{onClick:he,disabled:!c.trim(),children:"Cr√©er"})]})]})]})}),e.jsx(Y,{open:!!d,onOpenChange:n=>{n||k(null)},children:e.jsxs(J,{children:[e.jsx(ve,{children:e.jsxs(Ne,{children:["D√©placer ¬´ ",d?.name," ¬ª"]})}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("button",{type:"button",onClick:()=>ge(null),className:`w-full rounded-xl px-3 py-2 text-left text-sm font-medium transition-colors hover:bg-muted ${d?.folder?"text-muted-foreground":"bg-muted text-foreground"}`,children:[e.jsx(Fe,{className:"mr-2 inline h-4 w-4"}),"Racine"]}),ee.map(n=>e.jsxs("button",{type:"button",onClick:()=>ge(n),className:`w-full rounded-xl px-3 py-2 text-left text-sm font-medium transition-colors hover:bg-muted ${d?.folder===n?"bg-muted text-foreground":"text-muted-foreground"}`,children:[e.jsx(Le,{className:"mr-2 inline h-4 w-4"}),n]},n))]})]})}),e.jsx(we,{open:!!w,onOpenChange:n=>{n||A(null)},children:e.jsxs(ke,{children:[e.jsxs(Se,{children:[e.jsx(_e,{children:"Archiver la s√©ance ?"}),e.jsx(Te,{children:"La s√©ance sera d√©plac√©e dans les archives. Vous pourrez la restaurer √† tout moment."})]}),e.jsxs(Ce,{children:[e.jsx(Ae,{children:"Annuler"}),e.jsx(Me,{onClick:dt,children:"Archiver"})]})]})}),e.jsx(we,{open:!!x,onOpenChange:n=>{n||y(null)},children:e.jsxs(ke,{children:[e.jsxs(Se,{children:[e.jsx(_e,{children:"Supprimer la s√©ance ?"}),e.jsx(Te,{children:"Cette action est d√©finitive. La s√©ance sera supprim√©e du catalogue."})]}),e.jsxs(Ce,{children:[e.jsx(Ae,{children:"Annuler"}),e.jsx(Me,{onClick:pt,children:"Supprimer"})]})]})})]})}export{vs as canDeleteSwimCatalog,xr as default};
