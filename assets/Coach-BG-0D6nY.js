const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/StrengthCatalog-CbleyBga.js","assets/vendor-query-BiSH4r2z.js","assets/vendor-react-BzrpNAyj.js","assets/api-FlckuEBN.js","assets/index-CY4Gy9m6.js","assets/vendor-supabase-DFPLkPj_.js","assets/index-hyirjNTA.css","assets/swim-CLAv4wTK.js","assets/textarea-C2uMwW87.js","assets/dialog-CBTJNEq6.js","assets/index-Dnp5uRoe.js","assets/index-lsLREMcS.js","assets/index-BeEacsAc.js","assets/checkbox-CVix9Ymz.js","assets/select-BsUSn-TW.js","assets/index-B23GhzwY.js","assets/chevron-down-CqMpuX9s.js","assets/chevron-up-Dz0woobz.js","assets/alert-dialog-CYbUm7bt.js","assets/tabs-x3qScgyD.js","assets/index-B7jxichs.js","assets/SessionListView-oq067mzm.js","assets/chevron-left-BHpFyEv8.js","assets/play-D5dzLPGp.js","assets/save-Co4m4IC0.js","assets/chevron-right-Cgqr7Dvs.js","assets/CalendarGrid-W6jlfI3I.js","assets/circle-alert-DHLetCh8.js","assets/pencil-DubAEab2.js","assets/share-2-BBw3vwvC.js","assets/trash-2-BUA9ml8u.js","assets/drawer-Dfjyee-T.js","assets/plus-Bvby97Al.js","assets/loader-circle-CFkhX7HQ.js","assets/search-BlRNHpUo.js","assets/pen-D77yC0hL.js","assets/toggle-group-DLhSnW_X.js","assets/objectiveHelpers-SYUAWEr3.js","assets/badge-DOeITeET.js","assets/copy-Mak8GcDR.js","assets/sheet-CJNdsBIm.js","assets/InlineBanner-7_ldJKXe.js","assets/separator-CZT3tivU.js","assets/collapsible-BLkTvIME.js","assets/user-plus-BTk7mSlq.js","assets/clock-CkxpjyC9.js","assets/map-pin-DVwv4mhB.js","assets/SwimCatalog-CwoLqaAL.js","assets/SwimSessionTimeline-BMyU6FV4.js","assets/swimConsultationUtils-BW6s5rlZ.js","assets/timer-5SkabcXK.js","assets/eye-7pwJTPVe.js","assets/date-NdbyDBh_.js","assets/format-B9mPVj_w.js"])))=>i.map(i=>d[i]);
import{c as Te,B as K,d as le,C as ze,i as Le,k as Ke,l as Ge,g as Ve,L as U,I as de,n as _e,o as Kt,p as Gt,R as Js,q as yt,r as Ue,P as oe,t as Vt,v as Nt,w as Xs,x as Zs,y as en,z as tn,a as X,X as Mt,s as Bt,W as Ut,D as Ht,E as sn,U as Ze,G as nn,H as rn,T as ut,J as an,K as Qt,u as At,b as on,M as Et,_ as Wt}from"./index-CY4Gy9m6.js";import{j as e,r,u as Q,R as Yt,c as xe,d as J}from"./vendor-query-BiSH4r2z.js";import{a as O}from"./api-FlckuEBN.js";import{T as tt,a as ce}from"./toggle-group-DLhSnW_X.js";import{A as Xe,M as Jt,T as mt,e as Xt,f as Zt,F as ln,p as Rt}from"./objectiveHelpers-SYUAWEr3.js";import{B as te}from"./badge-DOeITeET.js";import{S as se,a as ne,b as re,c as ae,d as W,u as cn}from"./select-BsUSn-TW.js";import{T as wt}from"./textarea-C2uMwW87.js";import{h as dn,R as un,u as mn,F as pn,C as Dt}from"./index-BeEacsAc.js";import{u as ye}from"./index-lsLREMcS.js";import{R as hn,P as xn,O as gn,C as fn}from"./index-Dnp5uRoe.js";import"./dialog-CBTJNEq6.js";import{S as vn}from"./search-BlRNHpUo.js";import{C as jn}from"./copy-Mak8GcDR.js";import{a as bn,b as yn,P as Nn,C as wn}from"./CalendarGrid-W6jlfI3I.js";import{S as ge,a as fe,b as ve,c as je,d as Oe}from"./sheet-CJNdsBIm.js";import{I as Sn}from"./InlineBanner-7_ldJKXe.js";import{C as Cn}from"./circle-alert-DHLetCh8.js";import{T as st}from"./trash-2-BUA9ml8u.js";import{C as es}from"./checkbox-CVix9Ymz.js";import{S as ts}from"./separator-CZT3tivU.js";import{A as ke,a as Me,b as Ae,c as Ee,d as Re,e as De,f as Pe,g as Fe}from"./alert-dialog-CYbUm7bt.js";import{C as _n,a as kn,b as Mn}from"./collapsible-BLkTvIME.js";import{P as ue}from"./plus-Bvby97Al.js";import{U as An,a as En}from"./user-plus-BTk7mSlq.js";import{C as ss}from"./chevron-down-CqMpuX9s.js";import{c as ns,R as Rn,I as Dn}from"./index-B7jxichs.js";import{u as Pn}from"./index-B23GhzwY.js";import{C as rs}from"./clock-CkxpjyC9.js";import{M as as}from"./map-pin-DVwv4mhB.js";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fn=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 18h.01",key:"lrp35t"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M16 18h.01",key:"kzsmim"}]],pt=Te("calendar-days",Fn);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const In=[["path",{d:"m7 15 5 5 5-5",key:"1hf1tw"}],["path",{d:"m7 9 5-5 5 5",key:"sgt6xg"}]],Tn=Te("chevrons-up-down",In);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const On=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]],os=Te("external-link",On);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $n=[["path",{d:"M2 9.5a5.5 5.5 0 0 1 9.591-3.676.56.56 0 0 0 .818 0A5.49 5.49 0 0 1 22 9.5c0 2.29-1.5 4-3 5.5l-5.492 5.313a2 2 0 0 1-3 .019L5 15c-1.5-1.5-3-3.2-3-5.5",key:"mvr1a0"}],["path",{d:"M3.22 13H9.5l.5-1 2 4.5 2-7 1.5 3.5h5.27",key:"auskq0"}]],qn=Te("heart-pulse",$n);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zn=[["path",{d:"m22 7-8.991 5.727a2 2 0 0 1-2.009 0L2 7",key:"132q7q"}],["rect",{x:"2",y:"4",width:"20",height:"16",rx:"2",key:"izxlao"}]],is=Te("mail",zn);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ln=[["path",{d:"M18 21a8 8 0 0 0-16 0",key:"3ypg7q"}],["circle",{cx:"10",cy:"8",r:"5",key:"o932ke"}],["path",{d:"M22 20c0-3.37-2-6.5-4-8a5 5 0 0 0-.45-8.3",key:"10s06x"}]],ls=Te("users-round",Ln),me=({title:t,description:n,onBack:s,actions:o})=>e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs(K,{variant:"ghost",size:"sm",className:"-ml-2",onClick:s,children:[e.jsx(Xe,{className:"mr-2 h-4 w-4"}),"Retour"]}),e.jsx("h2",{className:"text-2xl font-display font-semibold uppercase italic text-primary",children:t}),n?e.jsx("p",{className:"text-sm text-muted-foreground",children:n}):null]}),o?e.jsx("div",{className:"flex items-center gap-2",children:o}):null]});function Kn(t){if(t.length===0)return null;const n=t[0],s=n.effort,o=n.fatigue,a=n.performance,l=n.engagement,d=[];return s!=null&&d.push((11-s)/2),o!=null&&d.push((11-o)/2),a!=null&&d.push(a/2),l!=null&&d.push(l/2),d.length===0?null:Math.round(d.reduce((i,g)=>i+g,0)/d.length*10)/10}function Gn(t){return t==null?{label:"—",className:"bg-muted text-muted-foreground"}:t>=3.5?{label:`${t.toFixed(1)}`,className:"bg-emerald-100 text-emerald-800 dark:bg-emerald-900/30 dark:text-emerald-400"}:t>=2.5?{label:`${t.toFixed(1)}`,className:"bg-amber-100 text-amber-800 dark:bg-amber-900/30 dark:text-amber-400"}:{label:`${t.toFixed(1)}`,className:"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400"}}function Vn({athletes:t,athletesLoading:n,onBack:s,onOpenAthlete:o}){const[a,l]=r.useState(null),[d,i]=r.useState("name"),{data:g=[]}=Q({queryKey:["recent-sessions-all",30],queryFn:()=>O.getRecentSessionsAllAthletes(30),enabled:t.length>0,staleTime:300*1e3}),{data:u}=Q({queryKey:["objectives-counts-by-user"],queryFn:()=>O.getObjectivesCountsByUser(),enabled:t.length>0,staleTime:300*1e3}),m=r.useMemo(()=>{const h=new Map;return t.forEach(c=>{c.group_id&&c.group_label&&h.set(c.group_id,c.group_label)}),Array.from(h.entries()).map(([c,j])=>({id:c,name:j})).sort((c,j)=>c.name.localeCompare(j.name,"fr"))},[t]),p=r.useMemo(()=>{const h=new Map,c=new Map;for(const j of g){if(j.athlete_id==null)continue;const S=c.get(j.athlete_id)??[];S.push(j),c.set(j.athlete_id,S)}for(const j of t){if(j.id==null)continue;const S=c.get(j.id)??[],y=Kn(S),N=S.length>0?S[0].session_date:null;h.set(j.id,{forme:y,lastSessionDate:N,sessionsCount30d:S.length,assiduity:null,objectivesTotal:u?.get(j.id)??0,objectivesAchieved:0})}return h},[t,g,u]),f=r.useMemo(()=>{let h=[...t];switch(a!=null&&(h=h.filter(c=>c.group_id===a)),d){case"forme":h.sort((c,j)=>{const S=c.id!=null?p.get(c.id)?.forme??99:99,y=j.id!=null?p.get(j.id)?.forme??99:99;return S-y});break;case"assiduity":h.sort((c,j)=>{const S=c.id!=null?p.get(c.id)?.sessionsCount30d??99:99,y=j.id!=null?p.get(j.id)?.sessionsCount30d??99:99;return S-y});break;default:h.sort((c,j)=>c.display_name.localeCompare(j.display_name,"fr"))}return h},[t,a,d,p]);return e.jsxs("div",{className:"space-y-4",children:[e.jsx(me,{title:"Nageurs",description:n?"Chargement…":`${t.length} nageur${t.length!==1?"s":""}`,onBack:s}),m.length>1&&e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{type:"button",onClick:()=>l(null),className:`rounded-full px-3 py-1 text-xs font-medium border transition ${a==null?"bg-foreground text-background border-foreground":"bg-card text-foreground border-border hover:bg-muted"}`,children:"Tous"}),m.map(h=>e.jsx("button",{type:"button",onClick:()=>l(a===h.id?null:h.id),className:`rounded-full px-3 py-1 text-xs font-medium border transition ${a===h.id?"bg-foreground text-background border-foreground":"bg-card text-foreground border-border hover:bg-muted"}`,children:h.name},h.id))]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"Trier :"}),[{key:"name",label:"Nom"},{key:"forme",label:"Forme"},{key:"assiduity",label:"Activité"}].map(h=>e.jsx("button",{type:"button",onClick:()=>i(h.key),className:`rounded-full px-2.5 py-0.5 text-xs font-medium border transition ${d===h.key?"bg-primary/10 text-primary border-primary/30":"bg-card text-muted-foreground border-border hover:bg-muted"}`,children:h.label},h.key))]}),n?e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3",children:[1,2,3,4,5,6].map(h=>e.jsxs("div",{className:"rounded-2xl border bg-card p-4 animate-pulse motion-reduce:animate-none",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-muted"}),e.jsxs("div",{className:"space-y-1.5 flex-1",children:[e.jsx("div",{className:"h-4 w-24 rounded bg-muted"}),e.jsx("div",{className:"h-3 w-16 rounded bg-muted"})]})]}),e.jsxs("div",{className:"mt-3 space-y-2",children:[e.jsx("div",{className:"h-3 w-full rounded bg-muted"}),e.jsx("div",{className:"h-3 w-2/3 rounded bg-muted"})]})]},h))}):f.length===0?e.jsx("p",{className:"text-sm text-muted-foreground text-center py-8",children:a!=null?"Aucun nageur dans ce groupe.":"Aucun nageur disponible."}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3",children:f.map(h=>{const c=h.id!=null?p.get(h.id):null,j=Gn(c?.forme??null);return e.jsxs("button",{type:"button",onClick:()=>o(h),className:"rounded-2xl border bg-card p-4 text-left hover:shadow-md hover:border-primary/20 transition-all",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[h.avatar_url?e.jsx("img",{src:h.avatar_url,alt:"",className:"h-10 w-10 rounded-full object-cover border border-border"}):e.jsx("div",{className:"h-10 w-10 rounded-full bg-primary/10 flex items-center justify-center text-sm font-bold text-primary",children:h.display_name.charAt(0).toUpperCase()}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-sm font-semibold truncate",children:h.display_name}),h.group_label&&e.jsx(te,{variant:"secondary",className:"text-[10px] px-1.5 py-0 mt-0.5",children:h.group_label})]})]}),e.jsxs("div",{className:"mt-3 grid grid-cols-3 gap-2",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-[10px] font-medium text-muted-foreground mb-1",children:"Forme"}),e.jsx("span",{className:`inline-block rounded-full px-2 py-0.5 text-xs font-semibold ${j.className}`,children:j.label})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-[10px] font-medium text-muted-foreground mb-1",children:"30j"}),e.jsx("span",{className:"text-sm font-bold text-foreground",children:c?.sessionsCount30d??0}),e.jsx("span",{className:"text-[10px] text-muted-foreground ml-0.5",children:"séances"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-[10px] font-medium text-muted-foreground mb-1",children:"Objectifs"}),e.jsx("span",{className:"text-sm font-bold text-foreground",children:c?.objectivesTotal??0})]})]}),c?.lastSessionDate&&e.jsxs("div",{className:"mt-2 text-[10px] text-muted-foreground",children:["Dernier ressenti : ",new Date(c.lastSessionDate).toLocaleDateString("fr-FR",{day:"numeric",month:"short"})]})]},h.id??h.display_name)})})]})}const Bn=({onBack:t,athletes:n,groups:s,athletesLoading:o})=>{const{toast:a}=le(),[l,d]=r.useState(""),[i,g]=r.useState(""),u=r.useMemo(()=>n.filter(c=>c.id&&c.email).map(c=>({value:`user:${c.id}`,label:c.group_label?`${c.display_name} · ${c.group_label}`:c.display_name,email:c.email})),[n]),m=r.useMemo(()=>s.map(c=>({value:`group:${c.id}`,label:c.name,id:c.id})),[s]),p=()=>{if(!i)return[];if(i.startsWith("user:")){const c=u.find(j=>j.value===i);return c?[c.email]:[]}if(i.startsWith("group:")){const c=Number(i.split(":")[1]);return n.filter(j=>j.group_id===c&&j.email).map(j=>j.email)}return[]},f=()=>{const c=p();if(!c.length){a({title:"Aucune adresse email",description:"Aucun nageur avec une adresse email dans cette sélection."});return}const j=new URLSearchParams;j.set("bcc",c.join(",")),l.trim()&&j.set("subject",l.trim()),window.location.href=`mailto:?${j.toString()}`},h=p();return e.jsxs("div",{className:"space-y-6 pb-24",children:[e.jsx(me,{title:"Contacter par email",description:"Ouvre votre application mail avec les destinataires en CCI.",onBack:t}),e.jsxs(ze,{className:"border-l-4 border-l-primary",children:[e.jsxs(Le,{children:[e.jsx(Ke,{children:"Destinataire"}),e.jsx(Ge,{children:"Sélectionnez un nageur ou un groupe."})]}),e.jsxs(Ve,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(U,{children:"Destinataire"}),e.jsxs(se,{value:i,onValueChange:g,children:[e.jsx(ne,{children:e.jsx(re,{placeholder:o?"Chargement...":"Choisir un nageur ou un groupe"})}),e.jsxs(ae,{children:[m.length?e.jsxs(e.Fragment,{children:[e.jsx(W,{value:"section-group",disabled:!0,children:"Groupes"}),m.map(c=>e.jsx(W,{value:c.value,children:c.label},c.value))]}):null,u.length?e.jsxs(e.Fragment,{children:[e.jsx(W,{value:"section-athlete",disabled:!0,children:"Nageurs"}),u.map(c=>e.jsx(W,{value:c.value,children:c.label},c.value))]}):null]})]})]}),i&&h.length>0?e.jsxs("p",{className:"text-xs text-muted-foreground",children:[h.length," adresse",h.length>1?"s":""," email",h.length>1?" (envoi en CCI)":""]}):null,i&&h.length===0?e.jsx("p",{className:"text-xs text-destructive",children:"Aucune adresse email disponible pour cette sélection."}):null]})]}),e.jsxs(ze,{children:[e.jsxs(Le,{children:[e.jsx(Ke,{children:"Objet"}),e.jsx(Ge,{children:"Optionnel — pré-rempli dans votre application mail."})]}),e.jsx(Ve,{children:e.jsx(de,{value:l,onChange:c=>d(c.target.value),placeholder:"Objet du mail…"})})]}),e.jsx("div",{className:"sticky bottom-0 z-10 -mx-4 border-t bg-background/95 p-4 backdrop-blur sm:static sm:mx-0 sm:border-0 sm:p-0",children:e.jsxs(K,{className:"w-full sm:w-auto",onClick:f,disabled:!i||h.length===0,children:[e.jsx(is,{className:"mr-2 h-4 w-4"}),"Ouvrir dans l'app mail",e.jsx(os,{className:"ml-2 h-3 w-3"})]})})]})};function qe(t,n,{checkForDefaultPrevented:s=!0}={}){return function(a){if(t?.(a),s===!1||!a.defaultPrevented)return n?.(a)}}function Un(t){const n=Hn(t),s=r.forwardRef((o,a)=>{const{children:l,...d}=o,i=r.Children.toArray(l),g=i.find(Wn);if(g){const u=g.props.children,m=i.map(p=>p===g?r.Children.count(u)>1?r.Children.only(null):r.isValidElement(u)?u.props.children:null:p);return e.jsx(n,{...d,ref:a,children:r.isValidElement(u)?r.cloneElement(u,void 0,m):null})}return e.jsx(n,{...d,ref:a,children:l})});return s.displayName=`${t}.Slot`,s}function Hn(t){const n=r.forwardRef((s,o)=>{const{children:a,...l}=s;if(r.isValidElement(a)){const d=Jn(a),i=Yn(l,a.props);return a.type!==r.Fragment&&(i.ref=o?_e(o,d):d),r.cloneElement(a,i)}return r.Children.count(a)>1?r.Children.only(null):null});return n.displayName=`${t}.SlotClone`,n}var Qn=Symbol("radix.slottable");function Wn(t){return r.isValidElement(t)&&typeof t.type=="function"&&"__radixId"in t.type&&t.type.__radixId===Qn}function Yn(t,n){const s={...n};for(const o in n){const a=t[o],l=n[o];/^on[A-Z]/.test(o)?a&&l?s[o]=(...i)=>{const g=l(...i);return a(...i),g}:a&&(s[o]=a):o==="style"?s[o]={...a,...l}:o==="className"&&(s[o]=[a,l].filter(Boolean).join(" "))}return{...t,...s}}function Jn(t){let n=Object.getOwnPropertyDescriptor(t.props,"ref")?.get,s=n&&"isReactWarning"in n&&n.isReactWarning;return s?t.ref:(n=Object.getOwnPropertyDescriptor(t,"ref")?.get,s=n&&"isReactWarning"in n&&n.isReactWarning,s?t.props.ref:t.props.ref||t.ref)}var Xn=Yt[" useInsertionEffect ".trim().toString()]||Kt;function Zn({prop:t,defaultProp:n,onChange:s=()=>{},caller:o}){const[a,l,d]=er({defaultProp:n,onChange:s}),i=t!==void 0,g=i?t:a;{const m=r.useRef(t!==void 0);r.useEffect(()=>{const p=m.current;p!==i&&console.warn(`${o} is changing from ${p?"controlled":"uncontrolled"} to ${i?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),m.current=i},[i,o])}const u=r.useCallback(m=>{if(i){const p=tr(m)?m(t):m;p!==t&&d.current?.(p)}else l(m)},[i,t,l,d]);return[g,u]}function er({defaultProp:t,onChange:n}){const[s,o]=r.useState(t),a=r.useRef(s),l=r.useRef(n);return Xn(()=>{l.current=n},[n]),r.useEffect(()=>{a.current!==s&&(l.current?.(s),a.current=s)},[s,a]),[s,o,l]}function tr(t){return typeof t=="function"}var nt="Popover",[cs]=yt(nt,[Gt]),He=Gt(),[sr,be]=cs(nt),ds=t=>{const{__scopePopover:n,children:s,open:o,defaultOpen:a,onOpenChange:l,modal:d=!1}=t,i=He(n),g=r.useRef(null),[u,m]=r.useState(!1),[p,f]=Zn({prop:o,defaultProp:a??!1,onChange:l,caller:nt});return e.jsx(Js,{...i,children:e.jsx(sr,{scope:n,contentId:ye(),triggerRef:g,open:p,onOpenChange:f,onOpenToggle:r.useCallback(()=>f(h=>!h),[f]),hasCustomAnchor:u,onCustomAnchorAdd:r.useCallback(()=>m(!0),[]),onCustomAnchorRemove:r.useCallback(()=>m(!1),[]),modal:d,children:s})})};ds.displayName=nt;var us="PopoverAnchor",nr=r.forwardRef((t,n)=>{const{__scopePopover:s,...o}=t,a=be(us,s),l=He(s),{onCustomAnchorAdd:d,onCustomAnchorRemove:i}=a;return r.useEffect(()=>(d(),()=>i()),[d,i]),e.jsx(Vt,{...l,...o,ref:n})});nr.displayName=us;var ms="PopoverTrigger",ps=r.forwardRef((t,n)=>{const{__scopePopover:s,...o}=t,a=be(ms,s),l=He(s),d=Ue(n,a.triggerRef),i=e.jsx(oe.button,{type:"button","aria-haspopup":"dialog","aria-expanded":a.open,"aria-controls":a.contentId,"data-state":vs(a.open),...o,ref:d,onClick:qe(t.onClick,a.onOpenToggle)});return a.hasCustomAnchor?i:e.jsx(Vt,{asChild:!0,...l,children:i})});ps.displayName=ms;var St="PopoverPortal",[rr,ar]=cs(St,{forceMount:void 0}),hs=t=>{const{__scopePopover:n,forceMount:s,children:o,container:a}=t,l=be(St,n);return e.jsx(rr,{scope:n,forceMount:s,children:e.jsx(Nt,{present:s||l.open,children:e.jsx(Xs,{asChild:!0,container:a,children:o})})})};hs.displayName=St;var Ie="PopoverContent",xs=r.forwardRef((t,n)=>{const s=ar(Ie,t.__scopePopover),{forceMount:o=s.forceMount,...a}=t,l=be(Ie,t.__scopePopover);return e.jsx(Nt,{present:o||l.open,children:l.modal?e.jsx(ir,{...a,ref:n}):e.jsx(lr,{...a,ref:n})})});xs.displayName=Ie;var or=Un("PopoverContent.RemoveScroll"),ir=r.forwardRef((t,n)=>{const s=be(Ie,t.__scopePopover),o=r.useRef(null),a=Ue(n,o),l=r.useRef(!1);return r.useEffect(()=>{const d=o.current;if(d)return dn(d)},[]),e.jsx(un,{as:or,allowPinchZoom:!0,children:e.jsx(gs,{...t,ref:a,trapFocus:s.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:qe(t.onCloseAutoFocus,d=>{d.preventDefault(),l.current||s.triggerRef.current?.focus()}),onPointerDownOutside:qe(t.onPointerDownOutside,d=>{const i=d.detail.originalEvent,g=i.button===0&&i.ctrlKey===!0,u=i.button===2||g;l.current=u},{checkForDefaultPrevented:!1}),onFocusOutside:qe(t.onFocusOutside,d=>d.preventDefault(),{checkForDefaultPrevented:!1})})})}),lr=r.forwardRef((t,n)=>{const s=be(Ie,t.__scopePopover),o=r.useRef(!1),a=r.useRef(!1);return e.jsx(gs,{...t,ref:n,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:l=>{t.onCloseAutoFocus?.(l),l.defaultPrevented||(o.current||s.triggerRef.current?.focus(),l.preventDefault()),o.current=!1,a.current=!1},onInteractOutside:l=>{t.onInteractOutside?.(l),l.defaultPrevented||(o.current=!0,l.detail.originalEvent.type==="pointerdown"&&(a.current=!0));const d=l.target;s.triggerRef.current?.contains(d)&&l.preventDefault(),l.detail.originalEvent.type==="focusin"&&a.current&&l.preventDefault()}})}),gs=r.forwardRef((t,n)=>{const{__scopePopover:s,trapFocus:o,onOpenAutoFocus:a,onCloseAutoFocus:l,disableOutsidePointerEvents:d,onEscapeKeyDown:i,onPointerDownOutside:g,onFocusOutside:u,onInteractOutside:m,...p}=t,f=be(Ie,s),h=He(s);return mn(),e.jsx(pn,{asChild:!0,loop:!0,trapped:o,onMountAutoFocus:a,onUnmountAutoFocus:l,children:e.jsx(Zs,{asChild:!0,disableOutsidePointerEvents:d,onInteractOutside:m,onEscapeKeyDown:i,onPointerDownOutside:g,onFocusOutside:u,onDismiss:()=>f.onOpenChange(!1),children:e.jsx(en,{"data-state":vs(f.open),role:"dialog",id:f.contentId,...h,...p,ref:n,style:{...p.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}})})})}),fs="PopoverClose",cr=r.forwardRef((t,n)=>{const{__scopePopover:s,...o}=t,a=be(fs,s);return e.jsx(oe.button,{type:"button",...o,ref:n,onClick:qe(t.onClick,()=>a.onOpenChange(!1))})});cr.displayName=fs;var dr="PopoverArrow",ur=r.forwardRef((t,n)=>{const{__scopePopover:s,...o}=t,a=He(s);return e.jsx(tn,{...a,...o,ref:n})});ur.displayName=dr;function vs(t){return t?"open":"closed"}var mr=ds,pr=ps,hr=hs,js=xs;const xr=mr,gr=pr,bs=r.forwardRef(({className:t,align:n="center",sideOffset:s=4,...o},a)=>e.jsx(hr,{children:e.jsx(js,{ref:a,align:n,sideOffset:s,className:X("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-popover-content-transform-origin]",t),...o})}));bs.displayName=js.displayName;var Pt=1,fr=.9,vr=.8,jr=.17,ot=.1,it=.999,br=.9999,yr=.99,Nr=/[\\\/_+.#"@\[\(\{&]/,wr=/[\\\/_+.#"@\[\(\{&]/g,Sr=/[\s-]/,ys=/[\s-]/g;function ht(t,n,s,o,a,l,d){if(l===n.length)return a===t.length?Pt:yr;var i=`${a},${l}`;if(d[i]!==void 0)return d[i];for(var g=o.charAt(l),u=s.indexOf(g,a),m=0,p,f,h,c;u>=0;)p=ht(t,n,s,o,u+1,l+1,d),p>m&&(u===a?p*=Pt:Nr.test(t.charAt(u-1))?(p*=vr,h=t.slice(a,u-1).match(wr),h&&a>0&&(p*=Math.pow(it,h.length))):Sr.test(t.charAt(u-1))?(p*=fr,c=t.slice(a,u-1).match(ys),c&&a>0&&(p*=Math.pow(it,c.length))):(p*=jr,a>0&&(p*=Math.pow(it,u-a))),t.charAt(u)!==n.charAt(l)&&(p*=br)),(p<ot&&s.charAt(u-1)===o.charAt(l+1)||o.charAt(l+1)===o.charAt(l)&&s.charAt(u-1)!==o.charAt(l))&&(f=ht(t,n,s,o,u+1,l+2,d),f*ot>p&&(p=f*ot)),p>m&&(m=p),u=s.indexOf(g,u+1);return d[i]=m,m}function Ft(t){return t.toLowerCase().replace(ys," ")}function Cr(t,n,s){return t=s&&s.length>0?`${t+" "+s.join(" ")}`:t,ht(t,n,Ft(t),Ft(n),0,0,{})}var $e='[cmdk-group=""]',lt='[cmdk-group-items=""]',_r='[cmdk-group-heading=""]',Ns='[cmdk-item=""]',It=`${Ns}:not([aria-disabled="true"])`,xt="cmdk-item-select",Se="data-value",kr=(t,n,s)=>Cr(t,n,s),ws=r.createContext(void 0),Qe=()=>r.useContext(ws),Ss=r.createContext(void 0),Ct=()=>r.useContext(Ss),Cs=r.createContext(void 0),_s=r.forwardRef((t,n)=>{let s=Ce(()=>{var v,D;return{search:"",value:(D=(v=t.value)!=null?v:t.defaultValue)!=null?D:"",selectedItemId:void 0,filtered:{count:0,items:new Map,groups:new Set}}}),o=Ce(()=>new Set),a=Ce(()=>new Map),l=Ce(()=>new Map),d=Ce(()=>new Set),i=ks(t),{label:g,children:u,value:m,onValueChange:p,filter:f,shouldFilter:h,loop:c,disablePointerSelection:j=!1,vimBindings:S=!0,...y}=t,N=ye(),P=ye(),z=ye(),F=r.useRef(null),C=$r();Ne(()=>{if(m!==void 0){let v=m.trim();s.current.value=v,R.emit()}},[m]),Ne(()=>{C(6,L)},[]);let R=r.useMemo(()=>({subscribe:v=>(d.current.add(v),()=>d.current.delete(v)),snapshot:()=>s.current,setState:(v,D,M)=>{var E,G,H,Z;if(!Object.is(s.current[v],D)){if(s.current[v]=D,v==="search")V(),I(),C(1,$);else if(v==="value"){if(document.activeElement.hasAttribute("cmdk-input")||document.activeElement.hasAttribute("cmdk-root")){let ee=document.getElementById(z);ee?ee.focus():(E=document.getElementById(N))==null||E.focus()}if(C(7,()=>{var ee;s.current.selectedItemId=(ee=_())==null?void 0:ee.id,R.emit()}),M||C(5,L),((G=i.current)==null?void 0:G.value)!==void 0){let ee=D??"";(Z=(H=i.current).onValueChange)==null||Z.call(H,ee);return}}R.emit()}},emit:()=>{d.current.forEach(v=>v())}}),[]),A=r.useMemo(()=>({value:(v,D,M)=>{var E;D!==((E=l.current.get(v))==null?void 0:E.value)&&(l.current.set(v,{value:D,keywords:M}),s.current.filtered.items.set(v,w(D,M)),C(2,()=>{I(),R.emit()}))},item:(v,D)=>(o.current.add(v),D&&(a.current.has(D)?a.current.get(D).add(v):a.current.set(D,new Set([v]))),C(3,()=>{V(),I(),s.current.value||$(),R.emit()}),()=>{l.current.delete(v),o.current.delete(v),s.current.filtered.items.delete(v);let M=_();C(4,()=>{V(),M?.getAttribute("id")===v&&$(),R.emit()})}),group:v=>(a.current.has(v)||a.current.set(v,new Set),()=>{l.current.delete(v),a.current.delete(v)}),filter:()=>i.current.shouldFilter,label:g||t["aria-label"],getDisablePointerSelection:()=>i.current.disablePointerSelection,listId:N,inputId:z,labelId:P,listInnerRef:F}),[]);function w(v,D){var M,E;let G=(E=(M=i.current)==null?void 0:M.filter)!=null?E:kr;return v?G(v,s.current.search,D):0}function I(){if(!s.current.search||i.current.shouldFilter===!1)return;let v=s.current.filtered.items,D=[];s.current.filtered.groups.forEach(E=>{let G=a.current.get(E),H=0;G.forEach(Z=>{let ee=v.get(Z);H=Math.max(ee,H)}),D.push([E,H])});let M=F.current;x().sort((E,G)=>{var H,Z;let ee=E.getAttribute("id"),We=G.getAttribute("id");return((H=v.get(We))!=null?H:0)-((Z=v.get(ee))!=null?Z:0)}).forEach(E=>{let G=E.closest(lt);G?G.appendChild(E.parentElement===G?E:E.closest(`${lt} > *`)):M.appendChild(E.parentElement===M?E:E.closest(`${lt} > *`))}),D.sort((E,G)=>G[1]-E[1]).forEach(E=>{var G;let H=(G=F.current)==null?void 0:G.querySelector(`${$e}[${Se}="${encodeURIComponent(E[0])}"]`);H?.parentElement.appendChild(H)})}function $(){let v=x().find(M=>M.getAttribute("aria-disabled")!=="true"),D=v?.getAttribute(Se);R.setState("value",D||void 0)}function V(){var v,D,M,E;if(!s.current.search||i.current.shouldFilter===!1){s.current.filtered.count=o.current.size;return}s.current.filtered.groups=new Set;let G=0;for(let H of o.current){let Z=(D=(v=l.current.get(H))==null?void 0:v.value)!=null?D:"",ee=(E=(M=l.current.get(H))==null?void 0:M.keywords)!=null?E:[],We=w(Z,ee);s.current.filtered.items.set(H,We),We>0&&G++}for(let[H,Z]of a.current)for(let ee of Z)if(s.current.filtered.items.get(ee)>0){s.current.filtered.groups.add(H);break}s.current.filtered.count=G}function L(){var v,D,M;let E=_();E&&(((v=E.parentElement)==null?void 0:v.firstChild)===E&&((M=(D=E.closest($e))==null?void 0:D.querySelector(_r))==null||M.scrollIntoView({block:"nearest"})),E.scrollIntoView({block:"nearest"}))}function _(){var v;return(v=F.current)==null?void 0:v.querySelector(`${Ns}[aria-selected="true"]`)}function x(){var v;return Array.from(((v=F.current)==null?void 0:v.querySelectorAll(It))||[])}function k(v){let D=x()[v];D&&R.setState("value",D.getAttribute(Se))}function q(v){var D;let M=_(),E=x(),G=E.findIndex(Z=>Z===M),H=E[G+v];(D=i.current)!=null&&D.loop&&(H=G+v<0?E[E.length-1]:G+v===E.length?E[0]:E[G+v]),H&&R.setState("value",H.getAttribute(Se))}function B(v){let D=_(),M=D?.closest($e),E;for(;M&&!E;)M=v>0?Tr(M,$e):Or(M,$e),E=M?.querySelector(It);E?R.setState("value",E.getAttribute(Se)):q(v)}let Y=()=>k(x().length-1),b=v=>{v.preventDefault(),v.metaKey?Y():v.altKey?B(1):q(1)},T=v=>{v.preventDefault(),v.metaKey?k(0):v.altKey?B(-1):q(-1)};return r.createElement(oe.div,{ref:n,tabIndex:-1,...y,"cmdk-root":"",onKeyDown:v=>{var D;(D=y.onKeyDown)==null||D.call(y,v);let M=v.nativeEvent.isComposing||v.keyCode===229;if(!(v.defaultPrevented||M))switch(v.key){case"n":case"j":{S&&v.ctrlKey&&b(v);break}case"ArrowDown":{b(v);break}case"p":case"k":{S&&v.ctrlKey&&T(v);break}case"ArrowUp":{T(v);break}case"Home":{v.preventDefault(),k(0);break}case"End":{v.preventDefault(),Y();break}case"Enter":{v.preventDefault();let E=_();if(E){let G=new Event(xt);E.dispatchEvent(G)}}}}},r.createElement("label",{"cmdk-label":"",htmlFor:A.inputId,id:A.labelId,style:zr},g),rt(t,v=>r.createElement(Ss.Provider,{value:R},r.createElement(ws.Provider,{value:A},v))))}),Mr=r.forwardRef((t,n)=>{var s,o;let a=ye(),l=r.useRef(null),d=r.useContext(Cs),i=Qe(),g=ks(t),u=(o=(s=g.current)==null?void 0:s.forceMount)!=null?o:d?.forceMount;Ne(()=>{if(!u)return i.item(a,d?.id)},[u]);let m=Ms(a,l,[t.value,t.children,l],t.keywords),p=Ct(),f=pe(C=>C.value&&C.value===m.current),h=pe(C=>u||i.filter()===!1?!0:C.search?C.filtered.items.get(a)>0:!0);r.useEffect(()=>{let C=l.current;if(!(!C||t.disabled))return C.addEventListener(xt,c),()=>C.removeEventListener(xt,c)},[h,t.onSelect,t.disabled]);function c(){var C,R;j(),(R=(C=g.current).onSelect)==null||R.call(C,m.current)}function j(){p.setState("value",m.current,!0)}if(!h)return null;let{disabled:S,value:y,onSelect:N,forceMount:P,keywords:z,...F}=t;return r.createElement(oe.div,{ref:_e(l,n),...F,id:a,"cmdk-item":"",role:"option","aria-disabled":!!S,"aria-selected":!!f,"data-disabled":!!S,"data-selected":!!f,onPointerMove:S||i.getDisablePointerSelection()?void 0:j,onClick:S?void 0:c},t.children)}),Ar=r.forwardRef((t,n)=>{let{heading:s,children:o,forceMount:a,...l}=t,d=ye(),i=r.useRef(null),g=r.useRef(null),u=ye(),m=Qe(),p=pe(h=>a||m.filter()===!1?!0:h.search?h.filtered.groups.has(d):!0);Ne(()=>m.group(d),[]),Ms(d,i,[t.value,t.heading,g]);let f=r.useMemo(()=>({id:d,forceMount:a}),[a]);return r.createElement(oe.div,{ref:_e(i,n),...l,"cmdk-group":"",role:"presentation",hidden:p?void 0:!0},s&&r.createElement("div",{ref:g,"cmdk-group-heading":"","aria-hidden":!0,id:u},s),rt(t,h=>r.createElement("div",{"cmdk-group-items":"",role:"group","aria-labelledby":s?u:void 0},r.createElement(Cs.Provider,{value:f},h))))}),Er=r.forwardRef((t,n)=>{let{alwaysRender:s,...o}=t,a=r.useRef(null),l=pe(d=>!d.search);return!s&&!l?null:r.createElement(oe.div,{ref:_e(a,n),...o,"cmdk-separator":"",role:"separator"})}),Rr=r.forwardRef((t,n)=>{let{onValueChange:s,...o}=t,a=t.value!=null,l=Ct(),d=pe(u=>u.search),i=pe(u=>u.selectedItemId),g=Qe();return r.useEffect(()=>{t.value!=null&&l.setState("search",t.value)},[t.value]),r.createElement(oe.input,{ref:n,...o,"cmdk-input":"",autoComplete:"off",autoCorrect:"off",spellCheck:!1,"aria-autocomplete":"list",role:"combobox","aria-expanded":!0,"aria-controls":g.listId,"aria-labelledby":g.labelId,"aria-activedescendant":i,id:g.inputId,type:"text",value:a?t.value:d,onChange:u=>{a||l.setState("search",u.target.value),s?.(u.target.value)}})}),Dr=r.forwardRef((t,n)=>{let{children:s,label:o="Suggestions",...a}=t,l=r.useRef(null),d=r.useRef(null),i=pe(u=>u.selectedItemId),g=Qe();return r.useEffect(()=>{if(d.current&&l.current){let u=d.current,m=l.current,p,f=new ResizeObserver(()=>{p=requestAnimationFrame(()=>{let h=u.offsetHeight;m.style.setProperty("--cmdk-list-height",h.toFixed(1)+"px")})});return f.observe(u),()=>{cancelAnimationFrame(p),f.unobserve(u)}}},[]),r.createElement(oe.div,{ref:_e(l,n),...a,"cmdk-list":"",role:"listbox",tabIndex:-1,"aria-activedescendant":i,"aria-label":o,id:g.listId},rt(t,u=>r.createElement("div",{ref:_e(d,g.listInnerRef),"cmdk-list-sizer":""},u)))}),Pr=r.forwardRef((t,n)=>{let{open:s,onOpenChange:o,overlayClassName:a,contentClassName:l,container:d,...i}=t;return r.createElement(hn,{open:s,onOpenChange:o},r.createElement(xn,{container:d},r.createElement(gn,{"cmdk-overlay":"",className:a}),r.createElement(fn,{"aria-label":t.label,"cmdk-dialog":"",className:l},r.createElement(_s,{ref:n,...i}))))}),Fr=r.forwardRef((t,n)=>pe(s=>s.filtered.count===0)?r.createElement(oe.div,{ref:n,...t,"cmdk-empty":"",role:"presentation"}):null),Ir=r.forwardRef((t,n)=>{let{progress:s,children:o,label:a="Loading...",...l}=t;return r.createElement(oe.div,{ref:n,...l,"cmdk-loading":"",role:"progressbar","aria-valuenow":s,"aria-valuemin":0,"aria-valuemax":100,"aria-label":a},rt(t,d=>r.createElement("div",{"aria-hidden":!0},d)))}),ie=Object.assign(_s,{List:Dr,Item:Mr,Input:Rr,Group:Ar,Separator:Er,Dialog:Pr,Empty:Fr,Loading:Ir});function Tr(t,n){let s=t.nextElementSibling;for(;s;){if(s.matches(n))return s;s=s.nextElementSibling}}function Or(t,n){let s=t.previousElementSibling;for(;s;){if(s.matches(n))return s;s=s.previousElementSibling}}function ks(t){let n=r.useRef(t);return Ne(()=>{n.current=t}),n}var Ne=typeof window>"u"?r.useEffect:r.useLayoutEffect;function Ce(t){let n=r.useRef();return n.current===void 0&&(n.current=t()),n}function pe(t){let n=Ct(),s=()=>t(n.snapshot());return r.useSyncExternalStore(n.subscribe,s,s)}function Ms(t,n,s,o=[]){let a=r.useRef(),l=Qe();return Ne(()=>{var d;let i=(()=>{var u;for(let m of s){if(typeof m=="string")return m.trim();if(typeof m=="object"&&"current"in m)return m.current?(u=m.current.textContent)==null?void 0:u.trim():a.current}})(),g=o.map(u=>u.trim());l.value(t,i,g),(d=n.current)==null||d.setAttribute(Se,i),a.current=i}),a}var $r=()=>{let[t,n]=r.useState(),s=Ce(()=>new Map);return Ne(()=>{s.current.forEach(o=>o()),s.current=new Map},[t]),(o,a)=>{s.current.set(o,a),n({})}};function qr(t){let n=t.type;return typeof n=="function"?n(t.props):"render"in n?n.render(t.props):t}function rt({asChild:t,children:n},s){return t&&r.isValidElement(n)?r.cloneElement(qr(n),{ref:n.ref},s(n.props.children)):s(n)}var zr={position:"absolute",width:"1px",height:"1px",padding:"0",margin:"-1px",overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",borderWidth:"0"};const As=r.forwardRef(({className:t,...n},s)=>e.jsx(ie,{ref:s,className:X("flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground",t),...n}));As.displayName=ie.displayName;const Es=r.forwardRef(({className:t,...n},s)=>e.jsxs("div",{className:"flex items-center border-b px-3","cmdk-input-wrapper":"",children:[e.jsx(vn,{className:"mr-2 h-4 w-4 shrink-0 opacity-50"}),e.jsx(ie.Input,{ref:s,className:X("flex h-10 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50",t),...n})]}));Es.displayName=ie.Input.displayName;const Rs=r.forwardRef(({className:t,...n},s)=>e.jsx(ie.List,{ref:s,className:X("max-h-[300px] overflow-y-auto overflow-x-hidden",t),...n}));Rs.displayName=ie.List.displayName;const Ds=r.forwardRef((t,n)=>e.jsx(ie.Empty,{ref:n,className:"py-6 text-center text-sm",...t}));Ds.displayName=ie.Empty.displayName;const gt=r.forwardRef(({className:t,...n},s)=>e.jsx(ie.Group,{ref:s,className:X("overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground",t),...n}));gt.displayName=ie.Group.displayName;const Lr=r.forwardRef(({className:t,...n},s)=>e.jsx(ie.Separator,{ref:s,className:X("-mx-1 h-px bg-border",t),...n}));Lr.displayName=ie.Separator.displayName;const ft=r.forwardRef(({className:t,...n},s)=>e.jsx(ie.Item,{ref:s,className:X("relative flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected=true]:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",t),...n}));ft.displayName=ie.Item.displayName;const Kr=({onBack:t,athletes:n,groups:s,athletesLoading:o})=>{const{toast:a}=le(),[l,d]=r.useState(""),[i,g]=r.useState(new Set),[u,m]=r.useState(new Set),[p,f]=r.useState(!1),{data:h}=Q({queryKey:["athlete-phones"],queryFn:async()=>{const{data:w}=await Bt.from("user_profiles").select("user_id, phone").not("phone","is",null);return new Map((w??[]).map(I=>[I.user_id,I.phone]))}}),c=r.useMemo(()=>n.filter(w=>w.id!=null).map(w=>({id:w.id,display_name:w.display_name,group_id:w.group_id??null,group_label:w.group_label??null})),[n]),j=w=>{g(I=>{const $=new Set(I);return $.has(w)?$.delete(w):$.add(w),$})},S=w=>{m(I=>{const $=new Set(I);return $.has(w)?$.delete(w):$.add(w),$})},y=()=>{g(new Set),m(new Set)},{selectedPhones:N,selectedTotal:P,missingCount:z}=r.useMemo(()=>{if(!h)return{selectedPhones:[],selectedTotal:0,missingCount:0};const w=new Set;for(const V of i)for(const L of c)L.group_id===V&&w.add(L.id);for(const V of u)w.add(V);const I=w.size,$=[];for(const V of w){const L=h.get(V);L&&L.trim().length>0&&$.push(L)}return{selectedPhones:$,selectedTotal:I,missingCount:I-$.length}},[i,u,c,h]),F=i.size+u.size,C=r.useMemo(()=>{const w=[];return i.size>0&&w.push(`${i.size} groupe${i.size>1?"s":""}`),u.size>0&&w.push(`${u.size} nageur${u.size>1?"s":""}`),w.join(", ")},[i.size,u.size]),R=()=>{if(N.length===0){a({title:"Aucun numéro",description:"Aucun nageur avec un numéro de téléphone dans cette sélection.",variant:"destructive"});return}if(/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)){const I=l.trim()?encodeURIComponent(l.trim()):"",$=/iPhone|iPad|iPod/i.test(navigator.userAgent);let V;if($){const L=N.join(",");V=I?`sms:/open?addresses=${L}&body=${I}`:`sms:/open?addresses=${L}`}else V=I?`sms:${N.join(",")}?body=${I}`:`sms:${N.join(",")}`;window.location.href=V}else navigator.clipboard.writeText(N.join(", ")).then(()=>{a({title:"Numéros copiés",description:`${N.length} numéro${N.length>1?"s":""} copié${N.length>1?"s":""} dans le presse-papiers.`})}).catch(()=>{a({title:"Erreur",description:"Impossible de copier les numéros.",variant:"destructive"})})},A=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent);return e.jsxs("div",{className:"space-y-6 pb-24",children:[e.jsx(me,{title:"Envoyer un SMS",description:"Ouvre votre application SMS ou copie les numéros.",onBack:t}),e.jsxs(ze,{className:"border-l-4 border-l-primary",children:[e.jsxs(Le,{children:[e.jsx(Ke,{children:"Destinataires"}),e.jsx(Ge,{children:"Sélectionnez des groupes et/ou des nageurs."})]}),e.jsxs(Ve,{className:"space-y-3",children:[e.jsx(U,{children:"Destinataires"}),e.jsxs(xr,{open:p,onOpenChange:f,children:[e.jsx(gr,{asChild:!0,children:e.jsxs(K,{variant:"outline",role:"combobox","aria-expanded":p,className:"w-full justify-between font-normal",children:[e.jsx("span",{className:"truncate",children:F>0?C:o?"Chargement...":"Choisir des destinataires"}),e.jsx(Tn,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),e.jsx(bs,{className:"w-[var(--radix-popover-trigger-width)] p-0",align:"start",children:e.jsxs(As,{children:[e.jsx(Es,{placeholder:"Rechercher..."}),e.jsxs(Rs,{children:[e.jsx(Ds,{children:"Aucun résultat."}),s.length>0&&e.jsx(gt,{heading:"Groupes",children:s.map(w=>e.jsxs(ft,{value:`groupe ${w.name}`,onSelect:()=>j(w.id),children:[e.jsx(Dt,{className:X("mr-2 h-4 w-4",i.has(w.id)?"opacity-100":"opacity-0")}),w.name]},`group:${w.id}`))}),c.length>0&&e.jsx(gt,{heading:"Nageurs",children:c.map(w=>e.jsxs(ft,{value:`nageur ${w.display_name} ${w.group_label??""}`,onSelect:()=>S(w.id),children:[e.jsx(Dt,{className:X("mr-2 h-4 w-4",u.has(w.id)?"opacity-100":"opacity-0")}),e.jsx("span",{className:"truncate",children:w.display_name}),w.group_label&&e.jsx("span",{className:"ml-auto text-xs text-muted-foreground",children:w.group_label})]},`user:${w.id}`))})]})]})})]}),F>0&&e.jsxs("div",{className:"flex flex-wrap items-center gap-1.5",children:[[...i].map(w=>{const I=s.find($=>$.id===w);return I?e.jsxs(te,{variant:"secondary",className:"gap-1 pr-1",children:[I.name,e.jsx("button",{type:"button",onClick:()=>j(w),className:"ml-0.5 rounded-full p-0.5 hover:bg-muted",children:e.jsx(Mt,{className:"h-3 w-3"})})]},`g:${w}`):null}),[...u].map(w=>{const I=c.find($=>$.id===w);return I?e.jsxs(te,{variant:"outline",className:"gap-1 pr-1",children:[I.display_name,e.jsx("button",{type:"button",onClick:()=>S(w),className:"ml-0.5 rounded-full p-0.5 hover:bg-muted",children:e.jsx(Mt,{className:"h-3 w-3"})})]},`u:${w}`):null}),F>1&&e.jsx("button",{type:"button",onClick:y,className:"text-xs text-muted-foreground underline hover:text-foreground",children:"Tout effacer"})]}),F>0&&N.length>0&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:[N.length," numéro",N.length>1?"s":""," trouvé",N.length>1?"s":"",z>0&&e.jsxs("span",{className:"text-destructive",children:[" · ",z," sans téléphone"]})]}),F>0&&N.length===0&&e.jsx("p",{className:"text-xs text-destructive",children:"Aucun numéro de téléphone disponible pour cette sélection."})]})]}),e.jsxs(ze,{children:[e.jsxs(Le,{children:[e.jsx(Ke,{children:"Message"}),e.jsx(Ge,{children:"Optionnel — pré-rempli dans votre application SMS."})]}),e.jsx(Ve,{children:e.jsx(wt,{value:l,onChange:w=>d(w.target.value),placeholder:"Contenu du SMS…",rows:3})})]}),e.jsx("div",{className:"sticky bottom-0 z-10 -mx-4 border-t bg-background/95 p-4 backdrop-blur sm:static sm:mx-0 sm:border-0 sm:p-0",children:e.jsx(K,{className:"w-full sm:w-auto",onClick:R,disabled:F===0||N.length===0,children:A?e.jsxs(e.Fragment,{children:[e.jsx(Jt,{className:"mr-2 h-4 w-4"}),"Ouvrir dans l'app SMS",e.jsx(os,{className:"ml-2 h-3 w-3"})]}):e.jsxs(e.Fragment,{children:[e.jsx(jn,{className:"mr-2 h-4 w-4"}),"Copier les numéros"]})})})]})};function Tt(t){return String(t).padStart(2,"0")}function we(t){return`${t.getFullYear()}-${Tt(t.getMonth()+1)}-${Tt(t.getDate())}`}function ct(t){return new Date(t.getFullYear(),t.getMonth(),1)}function Ot(t,n){const s=new Date(t);return s.setDate(s.getDate()+n),s}function Gr(t){return(t.getDay()+6)%7}function dt(t){if(!t)return"AM";const n=t.toLowerCase();return n==="evening"||n.includes("soir")||n==="pm"?"PM":"AM"}const Vr=[{key:"swim-morning",label:"Nage — Matin",type:"swim",scheduledSlot:"morning"},{key:"swim-evening",label:"Nage — Soir",type:"swim",scheduledSlot:"evening"},{key:"strength",label:"Musculation",type:"strength",scheduledSlot:null}];function Br({groupId:t,userId:n,enabled:s}){const o=r.useMemo(()=>new Date,[]),[a,l]=r.useState(()=>ct(new Date)),[d,i]=r.useState(()=>we(new Date)),[g,u]=r.useState(null),[m,p]=r.useState(!1),f=r.useMemo(()=>ct(a),[a]),h=r.useMemo(()=>{const x=Gr(f),k=Ot(f,-x),q=[];for(let B=0;B<42;B++)q.push(Ot(k,B));return q},[f]),c=r.useMemo(()=>{const x=we(h[0]),k=we(h[h.length-1]);return{from:x,to:k}},[h]),j=!!(t||n),{data:S=[],isLoading:y}=Q({queryKey:["coach-calendar-assignments",t,n,c.from,c.to],queryFn:()=>O.getCoachAssignments({groupId:t??null,userId:n??null,from:c.from,to:c.to}),enabled:j}),N=r.useMemo(()=>{const x=new Map;for(const k of S){const q=k.scheduledDate?.slice(0,10);q&&(x.has(q)||x.set(q,[]),x.get(q).push(k))}return x},[S]),P=r.useMemo(()=>{const x={};for(const k of h){const q=we(k),B=N.get(q)??[],Y=B.some(D=>dt(D.scheduledSlot)==="AM"),b=B.some(D=>dt(D.scheduledSlot)==="PM"),T=(Y?1:0)+(b?1:0),v=[{slotKey:"AM",expected:Y,completed:Y,absent:!1},{slotKey:"PM",expected:b,completed:b,absent:!1}];x[q]={completed:T,total:T,slots:v}}return x},[h,N]),z=r.useMemo(()=>{const[x,k,q]=d.split("-").map(Number);return new Date(x,k-1,q)},[d]),F=r.useMemo(()=>N.get(d)??[],[N,d]),C=r.useMemo(()=>{const x=F;return Vr.map(k=>{const q=x.filter(b=>k.type!==b.type?!1:k.type==="swim"?dt(b.scheduledSlot)===(k.scheduledSlot==="morning"?"AM":"PM"):!0),B=q.find(b=>b.targetType==="user"),Y=q.find(b=>b.targetType==="group");return{...k,assignment:B??Y??null}})},[F]),{data:R=[]}=Q({queryKey:["planned-absences-coach",n,c.from,c.to],queryFn:()=>O.getPlannedAbsences({userId:n,from:c.from,to:c.to}),enabled:!!n}),A=r.useMemo(()=>new Set(R.map(x=>x.date)),[R]),w=r.useMemo(()=>{const x={};for(const k of h){const q=we(k),B=N.get(q)??[];x[q]=B.some(Y=>Y.type==="strength")}return x},[h,N]),I=P[d]??{completed:0,total:0,slots:[{slotKey:"AM",expected:!1,completed:!1,absent:!1},{slotKey:"PM",expected:!1,completed:!1,absent:!1}]},$=r.useCallback(()=>{l(x=>new Date(x.getFullYear(),x.getMonth()-1,1))},[]),V=r.useCallback(()=>{l(x=>new Date(x.getFullYear(),x.getMonth()+1,1))},[]),L=r.useCallback(()=>{l(ct(new Date)),i(we(new Date))},[]),_=r.useCallback(x=>{i(x),p(!0)},[]);return{today:o,monthCursor:a,selectedISO:d,selectedDayIndex:g,drawerOpen:m,gridDates:h,completionByISO:P,selectedDate:z,selectedDayStatus:I,assignmentsForSelectedDay:F,slotsForSelectedDay:C,hasStrengthByISO:w,absenceDates:A,isLoading:y,hasFilter:j,setSelectedISO:i,setSelectedDayIndex:u,setDrawerOpen:p,prevMonth:$,nextMonth:V,jumpToday:L,openDay:_}}function Ur(t){const[n,s,o]=t.split("-").map(Number);return new Date(n,s-1,o).toLocaleDateString("fr-FR",{weekday:"long",day:"numeric",month:"long"})}function Hr({onBack:t,athletes:n,groups:s,swimSessions:o,strengthSessions:a}){const[l,d]=r.useState("group"),[i,g]=r.useState(""),[u,m]=r.useState(""),p=l==="group"&&i?Number(i):null,f=l==="user"&&u?Number(u):null,{today:h,monthCursor:c,selectedISO:j,selectedDayIndex:S,drawerOpen:y,gridDates:N,completionByISO:P,selectedDayStatus:z,slotsForSelectedDay:F,hasStrengthByISO:C,absenceDates:R,hasFilter:A,setSelectedISO:w,setSelectedDayIndex:I,setDrawerOpen:$,prevMonth:V,nextMonth:L,jumpToday:_,openDay:x}=Br({groupId:p,userId:f,enabled:!0}),k=xe(),q=J({mutationFn:b=>O.assignments_create(b),onSuccess:()=>{k.invalidateQueries({queryKey:["coach-calendar-assignments"]})}}),B=J({mutationFn:b=>O.assignments_delete(b),onSuccess:()=>{k.invalidateQueries({queryKey:["coach-calendar-assignments"]})}}),Y=(b,T)=>{let v=T;if(b.key==="ArrowLeft"&&(v=Math.max(0,T-1)),b.key==="ArrowRight"&&(v=Math.min(N.length-1,T+1)),b.key==="ArrowUp"&&(v=Math.max(0,T-7)),b.key==="ArrowDown"&&(v=Math.min(N.length-1,T+7)),v!==T){b.preventDefault(),I(v);const D=G=>String(G).padStart(2,"0"),M=N[v],E=`${M.getFullYear()}-${D(M.getMonth()+1)}-${D(M.getDate())}`;w(E)}if(b.key==="Enter"||b.key===" "){b.preventDefault();const D=G=>String(G).padStart(2,"0"),M=N[T],E=`${M.getFullYear()}-${D(M.getMonth()+1)}-${D(M.getDate())}`;x(E)}};return e.jsxs("div",{className:"space-y-4",children:[e.jsx(me,{title:"Calendrier",description:"Vue mensuelle des assignations",onBack:t}),e.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center",children:[e.jsxs(tt,{type:"single",value:l,onValueChange:b=>{(b==="group"||b==="user")&&d(b)},className:"shrink-0",children:[e.jsx(ce,{value:"group",className:"text-xs px-3",children:"Groupe"}),e.jsx(ce,{value:"user",className:"text-xs px-3",children:"Nageur"})]}),l==="group"?e.jsxs(se,{value:i,onValueChange:g,children:[e.jsx(ne,{className:"w-full sm:w-56",children:e.jsx(re,{placeholder:"Choisir un groupe"})}),e.jsx(ae,{children:s.map(b=>e.jsx(W,{value:String(b.id),children:b.name},String(b.id)))})]}):e.jsxs(se,{value:u,onValueChange:m,children:[e.jsx(ne,{className:"w-full sm:w-56",children:e.jsx(re,{placeholder:"Choisir un nageur"})}),e.jsx(ae,{children:n.filter(b=>b.id!=null).map(b=>e.jsxs(W,{value:String(b.id),children:[b.display_name,b.group_label?` · ${b.group_label}`:""]},String(b.id)))})]})]}),A?e.jsxs("div",{className:"rounded-2xl border bg-card shadow-sm",children:[e.jsx(bn,{monthCursor:c,selectedDayStatus:z,onPrevMonth:V,onNextMonth:L,onJumpToday:_}),e.jsx(yn,{monthCursor:c,gridDates:N,completionByISO:P,strengthByISO:C,absenceDates:R,selectedISO:j,selectedDayIndex:S,today:h,onDayClick:x,onKeyDown:Y})]}):e.jsx("div",{className:"py-12 text-center text-sm text-muted-foreground",children:"Sélectionnez un groupe ou un nageur pour afficher le calendrier."}),e.jsx(ge,{open:y,onOpenChange:$,children:e.jsxs(fe,{side:"bottom",className:"max-h-[70vh] overflow-y-auto rounded-t-2xl",children:[e.jsxs(ve,{className:"pb-3",children:[e.jsx(je,{className:"capitalize text-left",children:Ur(j)}),e.jsx(Oe,{className:"sr-only",children:"Gérer les assignations pour cette journée"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(Sn,{variant:"red",icon:e.jsx(Cn,{}),label:"Absence prévue",visible:R.has(j),animate:!1}),F.map(b=>{const T=b.assignment?.targetType==="group",v=l==="user";return e.jsx(Qr,{slot:b,swimSessions:o,strengthSessions:a,isGroupAssignment:T&&v,onAssign:D=>{q.mutate({assignment_type:b.type,session_id:D,scheduled_date:j,scheduled_slot:b.scheduledSlot??void 0,target_group_id:p,target_user_id:f})},onDelete:D=>{B.mutate(D)},onReplace:(D,M)=>{T&&v?q.mutate({assignment_type:b.type,session_id:M,scheduled_date:j,scheduled_slot:b.scheduledSlot??void 0,target_user_id:f}):B.mutate(D,{onSuccess:()=>{q.mutate({assignment_type:b.type,session_id:M,scheduled_date:j,scheduled_slot:b.scheduledSlot??void 0,target_group_id:p,target_user_id:f})}})},isPending:q.isPending||B.isPending},b.key)})]})]})})]})}function Qr({slot:t,swimSessions:n,strengthSessions:s,isGroupAssignment:o,onAssign:a,onDelete:l,onReplace:d,isPending:i}){const[g,u]=r.useState(!1),m=t.type==="swim",p=m?(n??[]).map(c=>({id:c.id,label:c.name})):(s??[]).map(c=>({id:c.id,label:c.title})),f=t.assignment!==null,h=c=>{const j=Number(c);j&&(f&&g?(d(t.assignment.id,j),u(!1)):a(j))};return e.jsxs("div",{className:"rounded-xl border p-3 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[m?e.jsx(Ut,{className:"h-4 w-4 text-blue-500 shrink-0"}):e.jsx(Ht,{className:"h-4 w-4 text-orange-500 shrink-0"}),e.jsx("span",{className:"text-xs font-semibold text-muted-foreground uppercase tracking-wide",children:t.label})]}),f&&!g?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("p",{className:"text-sm font-semibold truncate flex-1",children:[t.assignment.title,o&&e.jsx("span",{className:"ml-1.5 text-[10px] font-medium text-muted-foreground bg-muted px-1.5 py-0.5 rounded-full align-middle",children:"Groupe"})]}),e.jsx(K,{type:"button",size:"icon",variant:"ghost",className:"h-7 w-7 shrink-0",disabled:i,onClick:()=>u(!0),title:o?"Personnaliser":"Changer",children:e.jsx(sn,{className:"h-3.5 w-3.5"})}),!o&&e.jsx(K,{type:"button",size:"icon",variant:"ghost",className:"h-7 w-7 shrink-0 text-destructive hover:text-destructive",disabled:i,onClick:()=>l(t.assignment.id),title:"Supprimer",children:e.jsx(st,{className:"h-3.5 w-3.5"})})]}):e.jsxs(se,{value:"",onValueChange:h,disabled:i||p.length===0,children:[e.jsx(ne,{className:"h-9 text-xs",children:e.jsx(re,{placeholder:g?o?"Personnaliser pour ce nageur":"Choisir le remplacement":"Choisir une séance"})}),e.jsx(ae,{children:p.map(c=>e.jsx(W,{value:String(c.id),children:c.label},c.id))})]}),g?e.jsx("button",{type:"button",className:"text-xs text-muted-foreground hover:text-foreground",onClick:()=>u(!1),children:"Annuler"}):null]})}const Ps=({athletes:t,selected:n,onToggle:s,filterToUserIds:o})=>{const[a,l]=r.useState(""),d=r.useMemo(()=>{let g=t.filter(u=>u.id!=null);if(o&&(g=g.filter(u=>o.has(u.id))),a.trim()){const u=a.toLowerCase();g=g.filter(m=>m.display_name.toLowerCase().includes(u))}return g},[t,o,a]),i=r.useMemo(()=>{const g=new Map;for(const u of d){const m=u.group_label||"Sans groupe";g.has(m)||g.set(m,[]),g.get(m).push(u)}return[...g.entries()].sort(([u],[m])=>u.localeCompare(m,"fr"))},[d]);return e.jsxs("div",{className:"space-y-3",children:[e.jsx(de,{placeholder:"Rechercher un nageur...",value:a,onChange:g=>l(g.target.value)}),e.jsxs("div",{className:"max-h-[50vh] overflow-y-auto space-y-3",children:[i.map(([g,u])=>e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-semibold uppercase tracking-wider text-muted-foreground mb-1.5",children:g}),e.jsx("div",{className:"space-y-1",children:u.map(m=>e.jsxs("label",{className:"flex items-center gap-2.5 rounded-lg border px-3 py-2 cursor-pointer hover:bg-muted/50 transition-colors",children:[e.jsx(es,{checked:n.has(m.id),onCheckedChange:()=>s(m.id)}),e.jsx("span",{className:"text-sm",children:m.display_name})]},m.id))})]},g)),i.length===0&&e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"Aucun nageur trouvé."})]}),n.size>0&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:[n.size," nageur",n.size>1?"s":""," ","sélectionné",n.size>1?"s":""]})]})},Fs=({open:t,onOpenChange:n,athletes:s,parentGroupId:o,parentMembers:a,onCreated:l})=>{const{toast:d}=le(),[i,g]=r.useState(""),[u,m]=r.useState(new Set),p=c=>{m(j=>{const S=new Set(j);return S.has(c)?S.delete(c):S.add(c),S})},f=J({mutationFn:()=>O.createTemporaryGroup({name:i.trim(),member_user_ids:[...u],parent_group_id:o??void 0}),onSuccess:()=>{d({title:"Groupe créé",description:`Le groupe "${i.trim()}" a été créé avec ${u.size} nageur${u.size>1?"s":""}.`}),g(""),m(new Set),n(!1),l()},onError:c=>{d({title:"Erreur",description:c.message,variant:"destructive"})}}),h=()=>{if(!i.trim()){d({title:"Nom requis",description:"Veuillez saisir un nom pour le groupe.",variant:"destructive"});return}f.mutate()};return e.jsx(ge,{open:t,onOpenChange:n,children:e.jsxs(fe,{side:"right",className:"w-full sm:max-w-md overflow-y-auto",children:[e.jsxs(ve,{children:[e.jsx(je,{children:o?"Créer un sous-groupe":"Créer un groupe"}),e.jsx(Oe,{children:o?"Sélectionnez des nageurs du groupe parent pour ce sous-groupe.":"Créez un groupe temporaire (stage, compétition) avec des nageurs de différents groupes."})]}),e.jsxs("div",{className:"mt-6 space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(U,{htmlFor:"group-name",children:"Nom du groupe"}),e.jsx(de,{id:"group-name",placeholder:"Ex : Stage Pâques 2026",value:i,onChange:c=>g(c.target.value)})]}),e.jsx(ts,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(U,{children:"Nageurs"}),e.jsx(Ps,{athletes:s,selected:u,onToggle:p,filterToUserIds:a??null})]}),e.jsx(K,{className:"w-full",onClick:h,disabled:f.isPending||!i.trim(),children:f.isPending?"Création...":"Créer le groupe"})]})]})})},Wr=({open:t,onOpenChange:n,groupId:s,athletes:o,existingMemberIds:a,onAdded:l})=>{const{toast:d}=le(),[i,g]=r.useState(new Set),u=r.useMemo(()=>o.filter(f=>f.id!=null&&!a.has(f.id)),[o,a]),m=f=>{g(h=>{const c=new Set(h);return c.has(f)?c.delete(f):c.add(f),c})},p=J({mutationFn:()=>O.addTemporaryGroupMembers(s,[...i]),onSuccess:()=>{d({title:"Nageurs ajoutés",description:`${i.size} nageur${i.size>1?"s":""} ajouté${i.size>1?"s":""}.`}),g(new Set),n(!1),l()},onError:f=>{d({title:"Erreur",description:f.message,variant:"destructive"})}});return e.jsx(ge,{open:t,onOpenChange:n,children:e.jsxs(fe,{side:"right",className:"w-full sm:max-w-md overflow-y-auto",children:[e.jsxs(ve,{children:[e.jsx(je,{children:"Ajouter des nageurs"}),e.jsx(Oe,{children:"Sélectionnez les nageurs à ajouter au groupe."})]}),e.jsxs("div",{className:"mt-6 space-y-4",children:[e.jsx(Ps,{athletes:u,selected:i,onToggle:m}),e.jsx(K,{className:"w-full",onClick:()=>p.mutate(),disabled:p.isPending||i.size===0,children:p.isPending?"Ajout...":`Ajouter ${i.size} nageur${i.size>1?"s":""}`})]})]})})},Yr=({groupId:t,athletes:n,onBack:s})=>{const{toast:o}=le(),a=xe(),[l,d]=r.useState(!1),[i,g]=r.useState(!1),[u,m]=r.useState(null),{data:p,isLoading:f}=Q({queryKey:["temp-group-detail",t],queryFn:()=>O.getTemporaryGroupDetail(t)}),h=J({mutationFn:y=>O.removeTemporaryGroupMember(t,y),onSuccess:()=>{o({title:"Nageur retiré"}),a.invalidateQueries({queryKey:["temp-group-detail",t]}),a.invalidateQueries({queryKey:["temp-groups"]})},onError:y=>{o({title:"Erreur",description:y.message,variant:"destructive"})}}),c=()=>{a.invalidateQueries({queryKey:["temp-group-detail",t]}),a.invalidateQueries({queryKey:["temp-groups"]})},j=r.useMemo(()=>new Set((p?.members??[]).map(y=>y.user_id)),[p]),S=r.useMemo(()=>new Set((p?.members??[]).map(y=>y.user_id)),[p]);return f?e.jsxs("div",{className:"space-y-4",children:[e.jsxs(K,{variant:"ghost",size:"sm",className:"-ml-2",onClick:s,children:[e.jsx(Xe,{className:"mr-2 h-4 w-4"}),"Retour aux groupes"]}),e.jsx("div",{className:"space-y-2",children:[1,2,3].map(y=>e.jsx("div",{className:"rounded-xl border p-3 animate-pulse motion-reduce:animate-none",children:e.jsx("div",{className:"h-4 w-32 rounded bg-muted"})},y))})]}):p?e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs(K,{variant:"ghost",size:"sm",className:"-ml-2",onClick:s,children:[e.jsx(Xe,{className:"mr-2 h-4 w-4"}),"Retour aux groupes"]}),e.jsx("h2",{className:"text-2xl font-display font-semibold uppercase italic text-primary",children:p.name}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(te,{variant:p.is_active?"default":"secondary",children:p.is_active?"Actif":"Terminé"}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:[p.members.length," membre",p.members.length!==1?"s":""]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-xs font-semibold uppercase tracking-[0.15em] text-muted-foreground",children:"Membres"}),p.is_active&&e.jsxs(K,{size:"sm",variant:"outline",onClick:()=>d(!0),children:[e.jsx(An,{className:"mr-1.5 h-3.5 w-3.5"}),"Ajouter"]})]}),p.members.length===0?e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"Aucun membre dans ce groupe."}):e.jsx("div",{className:"space-y-1.5",children:p.members.map(y=>e.jsxs("div",{className:"flex items-center gap-3 rounded-xl border bg-card p-3",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-sm font-semibold truncate",children:y.display_name}),y.permanent_group_label&&e.jsx(te,{variant:"secondary",className:"text-[10px] px-1.5 py-0 mt-0.5",children:y.permanent_group_label})]}),p.is_active&&e.jsx(K,{size:"icon",variant:"ghost",className:"h-8 w-8 text-muted-foreground hover:text-destructive",onClick:()=>m({userId:y.user_id,name:y.display_name}),title:"Retirer du groupe",children:e.jsx(En,{className:"h-4 w-4"})})]},y.user_id))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-xs font-semibold uppercase tracking-[0.15em] text-muted-foreground",children:"Sous-groupes"}),p.is_active&&e.jsxs(K,{size:"sm",variant:"outline",onClick:()=>g(!0),children:[e.jsx(ue,{className:"mr-1.5 h-3.5 w-3.5"}),"Sous-groupe"]})]}),p.subgroups.length===0?e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"Aucun sous-groupe."}):e.jsx("div",{className:"space-y-2",children:p.subgroups.map(y=>e.jsxs(_n,{children:[e.jsxs(kn,{className:"flex w-full items-center justify-between rounded-xl border bg-card p-3 text-left hover:bg-muted/50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ls,{className:"h-4 w-4 text-primary"}),e.jsx("span",{className:"text-sm font-semibold",children:y.name}),e.jsx(te,{variant:"secondary",className:"text-[10px] px-1.5 py-0",children:y.members.length})]}),e.jsx(ss,{className:"h-4 w-4 text-muted-foreground transition-transform [[data-state=open]_&]:rotate-180"})]}),e.jsx(Mn,{children:e.jsxs("div",{className:"ml-4 mt-1 space-y-1",children:[y.members.map(N=>e.jsx("div",{className:"flex items-center gap-2 rounded-lg border px-3 py-2",children:e.jsx("span",{className:"text-sm",children:N.display_name})},N.user_id)),y.members.length===0&&e.jsx("p",{className:"text-xs text-muted-foreground py-2",children:"Aucun membre."})]})})]},y.id))})]}),e.jsx(Wr,{open:l,onOpenChange:d,groupId:t,athletes:n,existingMemberIds:j,onAdded:c}),e.jsx(Fs,{open:i,onOpenChange:g,athletes:n,parentGroupId:t,parentMembers:S,onCreated:c}),e.jsx(ke,{open:!!u,onOpenChange:y=>{y||m(null)},children:e.jsxs(Me,{children:[e.jsxs(Ae,{children:[e.jsx(Ee,{children:"Retirer du groupe"}),e.jsxs(Re,{children:["Voulez-vous retirer ",u?.name," de ce groupe ?",p.subgroups.length>0?" Le nageur sera aussi retiré des sous-groupes.":""]})]}),e.jsxs(De,{children:[e.jsx(Pe,{children:"Annuler"}),e.jsx(Fe,{onClick:()=>{u&&(h.mutate(u.userId),m(null))},className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Retirer"})]})]})})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs(K,{variant:"ghost",size:"sm",className:"-ml-2",onClick:s,children:[e.jsx(Xe,{className:"mr-2 h-4 w-4"}),"Retour aux groupes"]}),e.jsx("p",{className:"text-sm text-muted-foreground text-center py-8",children:"Groupe introuvable."})]})},$t=({group:t,onManage:n,onDeactivate:s,onReactivate:o,onDelete:a})=>{const l=new Date(t.created_at).toLocaleDateString("fr-FR",{day:"numeric",month:"short",year:"numeric"});return e.jsxs("div",{className:"rounded-xl border bg-card p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-sm font-bold truncate",children:t.name}),e.jsxs("div",{className:"flex items-center gap-2 mt-1 flex-wrap",children:[e.jsxs("span",{className:"text-xs text-muted-foreground",children:[t.member_count," membre",t.member_count!==1?"s":""]}),t.subgroup_count>0&&e.jsxs("span",{className:"text-xs text-muted-foreground",children:[t.subgroup_count," sous-groupe",t.subgroup_count!==1?"s":""]}),e.jsx("span",{className:"text-xs text-muted-foreground",children:l})]})]}),e.jsx(te,{variant:t.is_active?"default":"secondary",children:t.is_active?"Actif":"Terminé"})]}),e.jsx("div",{className:"flex items-center gap-2 flex-wrap",children:t.is_active?e.jsxs(e.Fragment,{children:[e.jsxs(K,{size:"sm",variant:"outline",onClick:()=>n(t.id),children:[e.jsx(nn,{className:"mr-1.5 h-3.5 w-3.5"}),"Gérer"]}),e.jsxs(K,{size:"sm",variant:"outline",onClick:()=>s(t.id),children:[e.jsx(Nn,{className:"mr-1.5 h-3.5 w-3.5"}),"Terminer"]})]}):e.jsxs(e.Fragment,{children:[e.jsxs(K,{size:"sm",variant:"outline",onClick:()=>o(t.id),children:[e.jsx(rn,{className:"mr-1.5 h-3.5 w-3.5"}),"Réactiver"]}),e.jsxs(K,{size:"sm",variant:"outline",className:"text-destructive hover:text-destructive",onClick:()=>a(t.id),children:[e.jsx(st,{className:"mr-1.5 h-3.5 w-3.5"}),"Supprimer"]})]})})]})},Jr=({onBack:t,athletes:n,athletesLoading:s})=>{const{toast:o}=le(),a=xe(),[l,d]=r.useState("list"),[i,g]=r.useState(null),[u,m]=r.useState(!1),[p,f]=r.useState(null),[h,c]=r.useState(null),{data:j=[],isLoading:S}=Q({queryKey:["temp-groups"],queryFn:()=>O.getTemporaryGroups()}),y=r.useMemo(()=>j.filter(A=>A.is_active),[j]),N=r.useMemo(()=>j.filter(A=>!A.is_active),[j]),P=J({mutationFn:A=>O.deactivateTemporaryGroup(A),onSuccess:()=>{o({title:"Groupe terminé"}),a.invalidateQueries({queryKey:["temp-groups"]})},onError:A=>{o({title:"Erreur",description:A.message,variant:"destructive"})}}),z=J({mutationFn:A=>O.reactivateTemporaryGroup(A),onSuccess:()=>{o({title:"Groupe réactivé"}),a.invalidateQueries({queryKey:["temp-groups"]})},onError:A=>{o({title:"Erreur",description:A.message,variant:"destructive"})}}),F=J({mutationFn:A=>O.deleteTemporaryGroup(A),onSuccess:()=>{o({title:"Groupe supprimé"}),a.invalidateQueries({queryKey:["temp-groups"]})},onError:A=>{o({title:"Erreur",description:A.message,variant:"destructive"})}}),C=A=>{g(A),d("detail")},R=()=>{g(null),d("list"),a.invalidateQueries({queryKey:["temp-groups"]})};return l==="detail"&&i!=null?e.jsx(Yr,{groupId:i,athletes:n,onBack:R}):e.jsxs("div",{className:"space-y-6 pb-24",children:[e.jsx(me,{title:"Groupes temporaires",description:"Créez et gérez des groupes pour les stages, compétitions ou événements.",onBack:t,actions:e.jsxs(K,{size:"sm",onClick:()=>m(!0),children:[e.jsx(ue,{className:"mr-1.5 h-3.5 w-3.5"}),"Créer un groupe"]})}),S||s?e.jsx("div",{className:"space-y-2",children:[1,2,3].map(A=>e.jsx("div",{className:"rounded-xl border p-4 animate-pulse motion-reduce:animate-none",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-4 w-40 rounded bg-muted"}),e.jsx("div",{className:"ml-auto h-6 w-16 rounded bg-muted"})]})},A))}):j.length===0?e.jsxs("div",{className:"text-center py-12 space-y-3",children:[e.jsx(Ze,{className:"h-10 w-10 text-muted-foreground mx-auto"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Aucun groupe temporaire pour le moment."}),e.jsxs(K,{variant:"outline",size:"sm",onClick:()=>m(!0),children:[e.jsx(ue,{className:"mr-1.5 h-3.5 w-3.5"}),"Créer le premier groupe"]})]}):e.jsxs(e.Fragment,{children:[y.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h3",{className:"text-xs font-semibold uppercase tracking-[0.15em] text-muted-foreground",children:["Actifs (",y.length,")"]}),y.map(A=>e.jsx($t,{group:A,onManage:C,onDeactivate:w=>f(w),onReactivate:w=>z.mutate(w),onDelete:w=>c(w)},A.id))]}),N.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h3",{className:"text-xs font-semibold uppercase tracking-[0.15em] text-muted-foreground",children:["Terminés (",N.length,")"]}),N.map(A=>e.jsx($t,{group:A,onManage:C,onDeactivate:w=>f(w),onReactivate:w=>z.mutate(w),onDelete:w=>c(w)},A.id))]})]}),e.jsx(Fs,{open:u,onOpenChange:m,athletes:n,onCreated:()=>{a.invalidateQueries({queryKey:["temp-groups"]})}}),e.jsx(ke,{open:p!=null,onOpenChange:A=>{A||f(null)},children:e.jsxs(Me,{children:[e.jsxs(Ae,{children:[e.jsx(Ee,{children:"Terminer le groupe"}),e.jsx(Re,{children:"Voulez-vous marquer ce groupe comme terminé ? Les sous-groupes seront aussi désactivés. Vous pourrez le réactiver plus tard si nécessaire."})]}),e.jsxs(De,{children:[e.jsx(Pe,{children:"Annuler"}),e.jsx(Fe,{onClick:()=>{p!=null&&(P.mutate(p),f(null))},children:"Terminer"})]})]})}),e.jsx(ke,{open:h!=null,onOpenChange:A=>{A||c(null)},children:e.jsxs(Me,{children:[e.jsxs(Ae,{children:[e.jsx(Ee,{children:"Supprimer le groupe"}),e.jsx(Re,{children:"Cette action est irréversible. Le groupe et tous ses sous-groupes seront supprimés définitivement."})]}),e.jsxs(De,{children:[e.jsx(Pe,{children:"Annuler"}),e.jsx(Fe,{onClick:()=>{h!=null&&(F.mutate(h),c(null))},className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Supprimer"})]})]})})]})};function Xr(t){const n=new Date;n.setHours(0,0,0,0);const s=new Date(t+"T00:00:00");return Math.ceil((s.getTime()-n.getTime())/(1e3*60*60*24))}function Zr(t){return`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")}`}function Ye(t,n){return Math.max(0,Math.round((new Date(n+"T00:00:00").getTime()-new Date(t+"T00:00:00").getTime())/6048e5))}const ea=7,ta=20,sa=72;function Je(t){return Math.min(sa,Math.max(ta,t*ea))}const na=({open:t,onOpenChange:n,competition:s})=>{const{toast:o}=le(),a=xe(),l=!!s,[d,i]=r.useState(""),[g,u]=r.useState(""),[m,p]=r.useState(""),[f,h]=r.useState(""),[c,j]=r.useState(""),[S,y]=r.useState(!1),[N,P]=r.useState(new Set),{data:z=[]}=Q({queryKey:["athletes"],queryFn:()=>O.getAthletes()}),{data:F=[]}=Q({queryKey:["groups"],queryFn:()=>O.getGroups()}),{data:C}=Q({queryKey:["competition-assignments",s?.id],queryFn:()=>O.getCompetitionAssignments(s.id),enabled:!!s?.id});r.useEffect(()=>{t&&(s?(i(s.name),u(s.date),p(s.end_date??s.date??""),h(s.location??""),j(s.description??""),C&&P(new Set(C.map(_=>_.athlete_id)))):(i(""),u(""),p(""),h(""),j(""),P(new Set)))},[t,s,C]);const R=J({mutationFn:_=>O.createCompetition(_),onSuccess:async _=>{if(N.size>0)try{await O.setCompetitionAssignments(_.id,Array.from(N))}catch(x){console.warn("[EAC] Failed to save competition assignments:",x)}o({title:"Competition creee"}),a.invalidateQueries({queryKey:["competitions"]}),a.invalidateQueries({queryKey:["competition-assignments"]}),n(!1)},onError:_=>{o({title:"Erreur",description:_.message,variant:"destructive"})}}),A=J({mutationFn:_=>O.updateCompetition(s.id,_),onSuccess:async()=>{try{await O.setCompetitionAssignments(s.id,Array.from(N))}catch(_){console.warn("[EAC] Failed to save competition assignments:",_)}o({title:"Competition mise a jour"}),a.invalidateQueries({queryKey:["competitions"]}),a.invalidateQueries({queryKey:["competition-assignments"]}),n(!1)},onError:_=>{o({title:"Erreur",description:_.message,variant:"destructive"})}}),w=J({mutationFn:()=>O.deleteCompetition(s.id),onSuccess:()=>{o({title:"Competition supprimee"}),a.invalidateQueries({queryKey:["competitions"]}),n(!1)},onError:_=>{o({title:"Erreur",description:_.message,variant:"destructive"})}}),I=()=>{if(!d.trim()){o({title:"Nom requis",description:"Veuillez saisir un nom pour la competition.",variant:"destructive"});return}if(!g){o({title:"Date requise",description:"Veuillez saisir une date.",variant:"destructive"});return}const _={name:d.trim(),date:g,end_date:m||g||null,location:f.trim()||null,description:c.trim()||null};l?A.mutate(_):R.mutate(_)},$=R.isPending||A.isPending||w.isPending,V="flex h-9 w-full rounded-lg border border-input bg-transparent px-3 py-1 text-sm shadow-sm transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring",L=_=>{u(_),(!m||m<_)&&p(_)};return e.jsxs(e.Fragment,{children:[e.jsx(ge,{open:t,onOpenChange:n,children:e.jsxs(fe,{side:"right",className:"w-full sm:max-w-md overflow-y-auto",children:[e.jsx(ve,{children:e.jsx(je,{children:l?"Modifier":"Nouvelle compétition"})}),e.jsxs("div",{className:"mt-5 space-y-5",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(U,{htmlFor:"comp-name",className:"text-[11px] font-semibold uppercase tracking-wider text-muted-foreground",children:"Nom"}),e.jsx(de,{id:"comp-name",placeholder:"Ex : Championnats Régionaux",value:d,onChange:_=>i(_.target.value),className:"text-[15px] font-medium"})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("span",{className:"text-[11px] font-semibold uppercase tracking-wider text-muted-foreground",children:"Dates"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{htmlFor:"comp-date",className:"text-[10px] text-muted-foreground/60 pl-0.5",children:"Début"}),e.jsx("input",{id:"comp-date",type:"date",value:g,onChange:_=>L(_.target.value),className:V})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{htmlFor:"comp-end-date",className:"text-[10px] text-muted-foreground/60 pl-0.5",children:"Fin"}),e.jsx("input",{id:"comp-end-date",type:"date",value:m,onChange:_=>p(_.target.value),min:g||void 0,className:V})]})]})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(U,{htmlFor:"comp-location",className:"text-[11px] font-semibold uppercase tracking-wider text-muted-foreground",children:"Lieu"}),e.jsx(de,{id:"comp-location",placeholder:"Ex : Piscine de Strasbourg",value:f,onChange:_=>h(_.target.value)})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(U,{htmlFor:"comp-description",className:"text-[11px] font-semibold uppercase tracking-wider text-muted-foreground",children:"Notes"}),e.jsx(wt,{id:"comp-description",placeholder:"Informations complémentaires...",value:c,onChange:_=>j(_.target.value),rows:2,className:"resize-none"})]}),e.jsx("div",{className:"border-t border-border/40"}),e.jsxs("div",{className:"space-y-2.5",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-[11px] font-semibold uppercase tracking-wider text-muted-foreground",children:"Nageurs"}),e.jsxs("span",{className:"text-[10px] tabular-nums text-muted-foreground/50",children:[N.size," sélectionné",N.size>1?"s":""]})]}),e.jsxs(se,{value:"",onValueChange:_=>{const x=z.filter(k=>k.group_id===Number(_));P(k=>{const q=new Set(k);return x.forEach(B=>{B.id!=null&&q.add(B.id)}),q})},children:[e.jsx(ne,{className:"h-8 text-xs",children:e.jsx(re,{placeholder:"Ajouter un groupe..."})}),e.jsx(ae,{children:F.filter(_=>!_.is_temporary).map(_=>e.jsx(W,{value:String(_.id),children:_.name},_.id))})]}),e.jsx("div",{className:"max-h-44 overflow-y-auto rounded-lg border p-1.5 space-y-0.5",children:z.map(_=>{if(_.id==null)return null;const x=N.has(_.id);return e.jsxs("label",{className:X("flex items-center gap-2 py-1 px-1.5 rounded-md cursor-pointer transition-colors",x?"bg-primary/5":"hover:bg-muted/50"),children:[e.jsx(es,{checked:x,onCheckedChange:k=>{P(q=>{const B=new Set(q);return k?B.add(_.id):B.delete(_.id),B})}}),e.jsx("span",{className:"text-[13px]",children:_.display_name}),_.group_label&&e.jsx("span",{className:"text-[10px] text-muted-foreground/50 ml-auto",children:_.group_label})]},_.id)})})]}),e.jsxs("div",{className:"space-y-3 pt-1",children:[e.jsx(K,{className:"w-full",onClick:I,disabled:$||!d.trim()||!g||!m,children:$?"Enregistrement...":l?"Enregistrer":"Créer la compétition"}),l&&e.jsx("button",{type:"button",className:"w-full text-center text-[11px] text-destructive/50 hover:text-destructive py-1.5 transition-colors",onClick:()=>y(!0),disabled:$,children:"Supprimer cette compétition"})]})]})]})}),e.jsx(ke,{open:S,onOpenChange:y,children:e.jsxs(Me,{children:[e.jsxs(Ae,{children:[e.jsx(Ee,{children:"Supprimer la compétition"}),e.jsxs(Re,{children:["Cette action est irréversible. La compétition «"," ",s?.name," » sera supprimée définitivement."]})]}),e.jsxs(De,{children:[e.jsx(Pe,{children:"Annuler"}),e.jsx(Fe,{onClick:()=>{w.mutate(),y(!1)},className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Supprimer"})]})]})})]})},ra=({competitions:t,onEdit:n})=>{const[s,o]=r.useState(!1),{items:a,todayIdx:l}=r.useMemo(()=>{const m=[...t].sort((y,N)=>y.date.localeCompare(N.date)),p=new Date;p.setHours(0,0,0,0);const f=Zr(p),h=[];let c="",j="",S=!1;for(const y of m){const N=y.date<f,P=Xr(y.date),z=y.date.slice(0,7),F=z!==j,C=new Date(y.date+"T00:00:00").toLocaleDateString("fr-FR",{month:"short"}).replace(".","").toUpperCase();if(!S&&!N){if(c){const A=Ye(c,f);A>=1&&h.push({kind:"gap",weeks:A,height:Je(A)})}h.push({kind:"today"}),S=!0;const R=Ye(f,y.date);R>=1&&h.push({kind:"gap",weeks:R,height:Je(R)})}else if(c){const R=Ye(c,y.date);R>=1&&h.push({kind:"gap",weeks:R,height:Je(R)})}h.push({kind:"comp",comp:y,isPast:N,days:P,isNewMonth:F,monthLabel:C}),c=y.end_date||y.date,j=z}if(!S){if(c){const y=Ye(c,f);y>=1&&h.push({kind:"gap",weeks:y,height:Je(y)})}h.push({kind:"today"})}return{items:h,todayIdx:h.findIndex(y=>y.kind==="today")}},[t]);if(t.length===0)return null;const d=l>0?a.slice(0,l):[],i=l>=0?a.slice(l):a,g=d.filter(m=>m.kind==="comp").length,u=(m,p)=>{if(m.kind==="gap")return e.jsx("div",{className:"relative",style:{height:m.height},children:m.weeks>=2&&e.jsxs("span",{className:"absolute left-[-0.8rem] -translate-x-1/2 top-1/2 -translate-y-1/2 text-[9px] tabular-nums font-medium text-muted-foreground/30 bg-background px-1 select-none",children:[m.weeks,"s"]})},`g${p}`);if(m.kind==="today")return e.jsxs("div",{className:"relative flex items-center h-7 -ml-14",children:[e.jsx("div",{className:"absolute left-0 right-0 h-[2px] bg-emerald-500/60"}),e.jsx("span",{className:"relative text-[10px] font-bold tracking-widest text-emerald-600 dark:text-emerald-400 bg-background pl-2 pr-1.5 select-none",children:"AUJOURD'HUI"})]},"today");const{comp:f,isPast:h,days:c,isNewMonth:j,monthLabel:S}=m,y=(()=>{const N=new Date(f.date+"T00:00:00");if(!f.end_date||f.end_date===f.date)return N.toLocaleDateString("fr-FR",{day:"numeric",month:"short"}).replace(".","");const P=new Date(f.end_date+"T00:00:00"),z=P.toLocaleDateString("fr-FR",{day:"numeric",month:"short"}).replace(".","");return N.getMonth()===P.getMonth()?`${N.getDate()}–${z}`:`${N.toLocaleDateString("fr-FR",{day:"numeric",month:"short"}).replace(".","")} → ${z}`})();return e.jsxs("button",{type:"button",className:X("relative w-full flex items-start text-left py-1.5 group transition-opacity",h?"opacity-40 hover:opacity-70":"hover:opacity-80"),onClick:()=>n(f),children:[j&&e.jsx("span",{className:"absolute left-[-3.25rem] top-[3px] w-[2rem] text-[10px] font-bold uppercase tracking-widest text-muted-foreground/50 text-right select-none",children:S}),e.jsx("div",{className:X("absolute left-[-0.8rem] top-[5px] h-[10px] w-[10px] rounded-full -translate-x-1/2 z-10 border-2 border-background transition-transform group-hover:scale-150",h?"bg-muted-foreground/30":"bg-amber-500 shadow-[0_0_6px_rgba(245,158,11,0.4)]")}),e.jsxs("div",{className:"min-w-0 flex-1 pl-1",children:[e.jsxs("div",{className:"flex items-center gap-1.5 min-w-0",children:[e.jsx("span",{className:X("text-[13px] font-semibold truncate flex-1 min-w-0",h?"text-muted-foreground":"text-foreground"),children:f.name}),!h&&c>=0&&e.jsxs("span",{className:"text-[10px] font-bold tabular-nums shrink-0 px-1.5 py-0.5 rounded-full bg-amber-100 text-amber-700 dark:bg-amber-900/30 dark:text-amber-400",children:["J-",c]})]}),e.jsxs("p",{className:X("text-[11px] truncate",h?"text-muted-foreground/60":"text-muted-foreground"),children:[y,f.location&&f.location!=="??"&&` · ${f.location}`]})]})]},f.id)};return e.jsxs("div",{className:"relative pl-14",children:[e.jsx("div",{className:"absolute left-[2.625rem] top-1 bottom-1 w-[2px] rounded-full bg-gradient-to-b from-border/10 via-border/40 to-border/10"}),g>0&&e.jsxs("button",{type:"button",className:"relative flex items-center gap-1.5 py-2 text-[11px] font-medium text-muted-foreground/50 hover:text-muted-foreground transition-colors select-none",onClick:()=>o(m=>!m),children:[e.jsx(ss,{className:X("h-3 w-3 shrink-0 transition-transform",s&&"rotate-180")}),e.jsxs("span",{children:["Passées (",g,")"]})]}),s&&d.map((m,p)=>u(m,p)),i.map((m,p)=>u(m,d.length+p))]})},aa=({onBack:t})=>{const[n,s]=r.useState(!1),[o,a]=r.useState(null),{data:l=[],isLoading:d}=Q({queryKey:["competitions"],queryFn:()=>O.getCompetitions()}),i=()=>{a(null),s(!0)},g=m=>{a(m),s(!0)},u=l.length===0?"Gerez les competitions du club.":`${l.length} competition${l.length>1?"s":""}`;return e.jsxs("div",{className:"space-y-6 pb-24",children:[e.jsx(me,{title:"Competitions",description:u,onBack:t,actions:e.jsxs(K,{variant:"outline",size:"sm",onClick:i,children:[e.jsx(ue,{className:"mr-1.5 h-3.5 w-3.5"}),"Ajouter"]})}),d?e.jsx("div",{className:"space-y-2",children:[1,2,3].map(m=>e.jsx("div",{className:"rounded-xl border p-3 animate-pulse motion-reduce:animate-none",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-4 w-40 rounded bg-muted"}),e.jsx("div",{className:"ml-auto h-5 w-12 rounded bg-muted"})]})},m))}):l.length===0?e.jsxs("div",{className:"text-center py-12 space-y-3",children:[e.jsx(ut,{className:"h-10 w-10 text-muted-foreground mx-auto"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Aucune competition creee."}),e.jsxs(K,{variant:"outline",size:"sm",onClick:i,children:[e.jsx(ue,{className:"mr-1.5 h-3.5 w-3.5"}),"Creer la premiere competition"]})]}):e.jsx(ra,{competitions:l,onEdit:g}),e.jsx(na,{open:n,onOpenChange:s,competition:o})]})};async function oa(t){const{data:n,error:s}=await Bt.rpc("get_auth_uid_for_user",{p_user_id:t});return s?(console.error("[objectives] Failed to resolve auth UUID:",s.message),null):n}const ia=({open:t,onOpenChange:n,objective:s,athleteName:o,athleteAuthId:a,competitions:l})=>{const{toast:d}=le(),i=xe(),g=!!s,[u,m]=r.useState("chrono"),[p,f]=r.useState(""),[h,c]=r.useState("25"),[j,S]=r.useState(""),[y,N]=r.useState(""),[P,z]=r.useState(""),[F,C]=r.useState(!1);r.useEffect(()=>{if(t)if(s){const x=!!s.event_code,k=!!s.text;m(x&&k?"both":k?"texte":"chrono"),f(s.event_code??""),c(String(s.pool_length??25)),S(s.target_time_seconds!=null?Zt(s.target_time_seconds):""),N(s.text??""),z(s.competition_id??"")}else m("chrono"),f(""),c("25"),S(""),N(""),z("")},[t,s]);const R=J({mutationFn:x=>O.createObjective(x),onSuccess:()=>{d({title:"Objectif cree"}),i.invalidateQueries({queryKey:["objectives"]}),n(!1)},onError:x=>{d({title:"Erreur",description:x.message,variant:"destructive"})}}),A=J({mutationFn:x=>O.updateObjective(s.id,x),onSuccess:()=>{d({title:"Objectif mis a jour"}),i.invalidateQueries({queryKey:["objectives"]}),n(!1)},onError:x=>{d({title:"Erreur",description:x.message,variant:"destructive"})}}),w=J({mutationFn:()=>O.deleteObjective(s.id),onSuccess:()=>{d({title:"Objectif supprime"}),i.invalidateQueries({queryKey:["objectives"]}),n(!1)},onError:x=>{d({title:"Erreur",description:x.message,variant:"destructive"})}}),I=u==="chrono"||u==="both",$=u==="texte"||u==="both",V=()=>{if(I&&!p){d({title:"Epreuve requise",description:"Veuillez selectionner une epreuve.",variant:"destructive"});return}if(I&&j&&Rt(j)===null){d({title:"Format invalide",description:"Le temps doit être au format m:ss:cc (ex: 1:05:30)",variant:"destructive"});return}if($&&!y.trim()){d({title:"Texte requis",description:"Veuillez saisir un objectif texte.",variant:"destructive"});return}const x={athlete_id:a,competition_id:P&&P!=="none"?P:null,event_code:I?p:null,pool_length:I?Number(h):null,target_time_seconds:I&&j?Rt(j):null,text:$?y.trim():null};g?A.mutate(x):R.mutate(x)},L=R.isPending||A.isPending||w.isPending,_=r.useMemo(()=>{const x=new Date;return x.setHours(0,0,0,0),l.filter(k=>new Date(k.date+"T00:00:00").getTime()>=x.getTime())},[l]);return e.jsxs(e.Fragment,{children:[e.jsx(ge,{open:t,onOpenChange:n,children:e.jsxs(fe,{side:"right",className:"w-full sm:max-w-md overflow-y-auto",children:[e.jsx(ve,{children:e.jsx(je,{children:g?"Modifier l'objectif":"Nouvel objectif"})}),e.jsxs("div",{className:"mt-6 space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(U,{children:"Nageur"}),e.jsx("p",{className:"text-sm font-medium",children:o})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(U,{children:"Type d'objectif"}),e.jsxs(tt,{type:"single",variant:"outline",value:u,onValueChange:x=>{x&&m(x)},className:"justify-start",children:[e.jsx(ce,{value:"chrono",className:"text-xs",children:"Chrono"}),e.jsx(ce,{value:"texte",className:"text-xs",children:"Texte"}),e.jsx(ce,{value:"both",className:"text-xs",children:"Les deux"})]})]}),I&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(U,{children:"Epreuve *"}),e.jsxs(se,{value:p,onValueChange:f,children:[e.jsx(ne,{children:e.jsx(re,{placeholder:"Choisir une epreuve"})}),e.jsx(ae,{children:ln.map(x=>e.jsx(W,{value:x,children:Xt(x)},x))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(U,{children:"Bassin"}),e.jsxs(se,{value:h,onValueChange:c,children:[e.jsx(ne,{children:e.jsx(re,{})}),e.jsxs(ae,{children:[e.jsx(W,{value:"25",children:"25m"}),e.jsx(W,{value:"50",children:"50m"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(U,{children:"Temps cible (min:sec:centièmes)"}),e.jsx(de,{placeholder:"Ex : 1:05:30",value:j,onChange:x=>S(x.target.value)})]})]}),$&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(U,{children:"Objectif texte *"}),e.jsx(wt,{placeholder:"Ex : Ameliorer la coulée de dos",value:y,onChange:x=>N(x.target.value),rows:3})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(U,{children:"Lier a une competition"}),e.jsxs(se,{value:P,onValueChange:z,children:[e.jsx(ne,{children:e.jsx(re,{placeholder:"Aucune"})}),e.jsxs(ae,{children:[e.jsx(W,{value:"none",children:"Aucune"}),_.map(x=>e.jsxs(W,{value:x.id,children:[x.name," (",x.date,")"]},x.id))]})]})]}),e.jsxs("div",{className:"space-y-2 pt-2",children:[e.jsx(K,{className:"w-full",onClick:V,disabled:L,children:L?"Enregistrement...":g?"Enregistrer":"Creer"}),g&&e.jsx(K,{variant:"outline",className:"w-full text-destructive hover:text-destructive",onClick:()=>C(!0),disabled:L,children:"Supprimer cet objectif"})]})]})]})}),e.jsx(ke,{open:F,onOpenChange:C,children:e.jsxs(Me,{children:[e.jsxs(Ae,{children:[e.jsx(Ee,{children:"Supprimer l'objectif"}),e.jsx(Re,{children:"Cette action est irreversible. L'objectif sera supprime definitivement."})]}),e.jsxs(De,{children:[e.jsx(Pe,{children:"Annuler"}),e.jsx(Fe,{onClick:()=>{w.mutate(),C(!1)},className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Supprimer"})]})]})})]})},la=({objective:t,onEdit:n})=>{const s=!!t.event_code,o=!!t.text;return e.jsxs("button",{type:"button",className:"w-full text-left rounded-xl border bg-card p-3 space-y-1.5 transition-colors hover:bg-muted/50",onClick:()=>n(t),children:[s&&e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"text-sm font-semibold",children:Xt(t.event_code)}),t.pool_length&&e.jsxs(te,{variant:"secondary",className:"text-[10px] px-1.5 py-0",children:[t.pool_length,"m"]}),t.target_time_seconds!=null&&e.jsx(te,{variant:"outline",className:"text-[10px] px-1.5 py-0 font-mono",children:Zt(t.target_time_seconds)})]}),o&&e.jsx("p",{className:"text-sm text-muted-foreground line-clamp-2",children:t.text}),t.competition_name&&e.jsx(te,{variant:"outline",className:"border-orange-300 text-orange-600 dark:text-orange-400 text-[10px] px-1.5 py-0",children:t.competition_name})]})},ca=({onBack:t,athletes:n,athletesLoading:s})=>{const{toast:o}=le(),[a,l]=r.useState(""),[d,i]=r.useState(!1),[g,u]=r.useState(null),m=r.useMemo(()=>a?n.find(F=>F.id!=null&&String(F.id)===a)??null:null,[n,a]),{data:p,isLoading:f}=Q({queryKey:["auth-uid",a],queryFn:()=>oa(Number(a)),enabled:!!a}),{data:h=[]}=Q({queryKey:["competitions"],queryFn:()=>O.getCompetitions()}),{data:c=[],isLoading:j}=Q({queryKey:["objectives",p],queryFn:()=>O.getObjectives(p),enabled:!!p}),S=r.useMemo(()=>{const F=n.filter(R=>R.id!=null),C=new Map;for(const R of F){const A=R.group_label||"Sans groupe";C.has(A)||C.set(A,[]),C.get(A).push(R)}return[...C.entries()].sort(([R],[A])=>R.localeCompare(A,"fr"))},[n]),y=()=>{if(!p){o({title:"Nageur requis",description:"Veuillez selectionner un nageur.",variant:"destructive"});return}u(null),i(!0)},N=F=>{u(F),i(!0)},P=s||!!a&&f,z=!!p&&!f;return e.jsxs("div",{className:"space-y-6 pb-24",children:[e.jsx(me,{title:"Objectifs",description:"Definissez des objectifs chrono ou texte pour chaque nageur.",onBack:t,actions:e.jsxs(K,{variant:"outline",size:"sm",onClick:y,disabled:!p,children:[e.jsx(ue,{className:"mr-1.5 h-3.5 w-3.5"}),"Ajouter"]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(U,{children:"Nageur"}),e.jsxs(se,{value:a,onValueChange:l,children:[e.jsx(ne,{children:e.jsx(re,{placeholder:"Selectionner un nageur"})}),e.jsx(ae,{children:S.map(([F,C])=>e.jsxs("div",{children:[e.jsx("div",{className:"px-2 py-1.5 text-xs font-semibold uppercase tracking-wider text-muted-foreground",children:F}),C.map(R=>e.jsx(W,{value:String(R.id),children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:R.display_name}),R.group_label&&e.jsx(te,{variant:"secondary",className:"text-[10px] px-1.5 py-0",children:R.group_label})]})},R.id))]},F))})]})]}),!a&&e.jsxs("div",{className:"text-center py-12 space-y-3",children:[e.jsx(mt,{className:"h-10 w-10 text-muted-foreground mx-auto"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Selectionnez un nageur pour voir et gerer ses objectifs."})]}),P&&a&&e.jsx("div",{className:"space-y-2",children:[1,2,3].map(F=>e.jsx("div",{className:"rounded-xl border p-3 animate-pulse motion-reduce:animate-none",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-4 w-40 rounded bg-muted"}),e.jsx("div",{className:"ml-auto h-5 w-12 rounded bg-muted"})]})},F))}),z&&j&&e.jsx("div",{className:"space-y-2",children:[1,2].map(F=>e.jsx("div",{className:"rounded-xl border p-3 animate-pulse motion-reduce:animate-none",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-4 w-32 rounded bg-muted"}),e.jsx("div",{className:"ml-auto h-5 w-16 rounded bg-muted"})]})},F))}),z&&!j&&c.length===0&&e.jsxs("div",{className:"text-center py-12 space-y-3",children:[e.jsx(mt,{className:"h-10 w-10 text-muted-foreground mx-auto"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Aucun objectif defini pour ",m?.display_name,"."]}),e.jsxs(K,{variant:"outline",size:"sm",onClick:y,children:[e.jsx(ue,{className:"mr-1.5 h-3.5 w-3.5"}),"Creer le premier objectif"]})]}),z&&!j&&c.length>0&&e.jsx("div",{className:"space-y-2",children:c.map(F=>e.jsx(la,{objective:F,onEdit:N},F.id))}),p&&m&&e.jsx(ia,{open:d,onOpenChange:i,objective:g,athleteName:m.display_name,athleteAuthId:p,competitions:h})]})};function vt(t,n,{checkForDefaultPrevented:s=!0}={}){return function(a){if(t?.(a),s===!1||!a.defaultPrevented)return n?.(a)}}var da=Yt[" useInsertionEffect ".trim().toString()]||Kt;function ua({prop:t,defaultProp:n,onChange:s=()=>{},caller:o}){const[a,l,d]=ma({defaultProp:n,onChange:s}),i=t!==void 0,g=i?t:a;{const m=r.useRef(t!==void 0);r.useEffect(()=>{const p=m.current;p!==i&&console.warn(`${o} is changing from ${p?"controlled":"uncontrolled"} to ${i?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),m.current=i},[i,o])}const u=r.useCallback(m=>{if(i){const p=pa(m)?m(t):m;p!==t&&d.current?.(p)}else l(m)},[i,t,l,d]);return[g,u]}function ma({defaultProp:t,onChange:n}){const[s,o]=r.useState(t),a=r.useRef(s),l=r.useRef(n);return da(()=>{l.current=n},[n]),r.useEffect(()=>{a.current!==s&&(l.current?.(s),a.current=s)},[s,a]),[s,o,l]}function pa(t){return typeof t=="function"}var _t="Radio",[ha,Is]=yt(_t),[xa,ga]=ha(_t),Ts=r.forwardRef((t,n)=>{const{__scopeRadio:s,name:o,checked:a=!1,required:l,disabled:d,value:i="on",onCheck:g,form:u,...m}=t,[p,f]=r.useState(null),h=Ue(n,S=>f(S)),c=r.useRef(!1),j=p?u||!!p.closest("form"):!0;return e.jsxs(xa,{scope:s,checked:a,disabled:d,children:[e.jsx(oe.button,{type:"button",role:"radio","aria-checked":a,"data-state":zs(a),"data-disabled":d?"":void 0,disabled:d,value:i,...m,ref:h,onClick:vt(t.onClick,S=>{a||g?.(),j&&(c.current=S.isPropagationStopped(),c.current||S.stopPropagation())})}),j&&e.jsx(qs,{control:p,bubbles:!c.current,name:o,value:i,checked:a,required:l,disabled:d,form:u,style:{transform:"translateX(-100%)"}})]})});Ts.displayName=_t;var Os="RadioIndicator",$s=r.forwardRef((t,n)=>{const{__scopeRadio:s,forceMount:o,...a}=t,l=ga(Os,s);return e.jsx(Nt,{present:o||l.checked,children:e.jsx(oe.span,{"data-state":zs(l.checked),"data-disabled":l.disabled?"":void 0,...a,ref:n})})});$s.displayName=Os;var fa="RadioBubbleInput",qs=r.forwardRef(({__scopeRadio:t,control:n,checked:s,bubbles:o=!0,...a},l)=>{const d=r.useRef(null),i=Ue(d,l),g=cn(s),u=an(n);return r.useEffect(()=>{const m=d.current;if(!m)return;const p=window.HTMLInputElement.prototype,h=Object.getOwnPropertyDescriptor(p,"checked").set;if(g!==s&&h){const c=new Event("click",{bubbles:o});h.call(m,s),m.dispatchEvent(c)}},[g,s,o]),e.jsx(oe.input,{type:"radio","aria-hidden":!0,defaultChecked:s,...a,tabIndex:-1,ref:i,style:{...a.style,...u,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});qs.displayName=fa;function zs(t){return t?"checked":"unchecked"}var va=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],at="RadioGroup",[ja]=yt(at,[ns,Is]),Ls=ns(),Ks=Is(),[ba,ya]=ja(at),Gs=r.forwardRef((t,n)=>{const{__scopeRadioGroup:s,name:o,defaultValue:a,value:l,required:d=!1,disabled:i=!1,orientation:g,dir:u,loop:m=!0,onValueChange:p,...f}=t,h=Ls(s),c=Pn(u),[j,S]=ua({prop:l,defaultProp:a??null,onChange:p,caller:at});return e.jsx(ba,{scope:s,name:o,required:d,disabled:i,value:j,onValueChange:S,children:e.jsx(Rn,{asChild:!0,...h,orientation:g,dir:c,loop:m,children:e.jsx(oe.div,{role:"radiogroup","aria-required":d,"aria-orientation":g,"data-disabled":i?"":void 0,dir:c,...f,ref:n})})})});Gs.displayName=at;var Vs="RadioGroupItem",Bs=r.forwardRef((t,n)=>{const{__scopeRadioGroup:s,disabled:o,...a}=t,l=ya(Vs,s),d=l.disabled||o,i=Ls(s),g=Ks(s),u=r.useRef(null),m=Ue(n,u),p=l.value===a.value,f=r.useRef(!1);return r.useEffect(()=>{const h=j=>{va.includes(j.key)&&(f.current=!0)},c=()=>f.current=!1;return document.addEventListener("keydown",h),document.addEventListener("keyup",c),()=>{document.removeEventListener("keydown",h),document.removeEventListener("keyup",c)}},[]),e.jsx(Dn,{asChild:!0,...i,focusable:!d,active:p,children:e.jsx(Ts,{disabled:d,required:l.required,checked:p,...g,...a,name:l.name,ref:m,onCheck:()=>l.onValueChange(a.value),onKeyDown:vt(h=>{h.key==="Enter"&&h.preventDefault()}),onFocus:vt(a.onFocus,()=>{f.current&&u.current?.click()})})})});Bs.displayName=Vs;var Na="RadioGroupIndicator",Us=r.forwardRef((t,n)=>{const{__scopeRadioGroup:s,...o}=t,a=Ks(s);return e.jsx($s,{...a,...o,ref:n})});Us.displayName=Na;var Hs=Gs,Qs=Bs,wa=Us;const Ws=r.forwardRef(({className:t,...n},s)=>e.jsx(Hs,{className:X("grid gap-2",t),...n,ref:s}));Ws.displayName=Hs.displayName;const jt=r.forwardRef(({className:t,...n},s)=>e.jsx(Qs,{ref:s,className:X("aspect-square h-4 w-4 rounded-full border border-primary text-primary shadow focus:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",t),...n,children:e.jsx(wa,{className:"flex items-center justify-center",children:e.jsx(wn,{className:"h-3.5 w-3.5 fill-primary"})})}));jt.displayName=Qs.displayName;const kt=["Lundi","Mardi","Mercredi","Jeudi","Vendredi","Samedi","Dimanche"],Sa=["Lun","Mar","Mer","Jeu","Ven","Sam","Dim"],Be=6,Ca=22,Ys=Ca-Be,et=40,qt=Ys*et,zt=Array.from({length:Ys+1},(t,n)=>Be+n);function he(t){return t.slice(0,5)}function _a(){return new Date().toISOString().slice(0,10)}function ka(t){const[n,s]=t.split(":").map(Number);return n*60+s}function bt(t){return(ka(t)-Be*60)/60*et}function Ma(t,n){return bt(n)-bt(t)}const Aa=({open:t,onOpenChange:n,slot:s,groups:o,coaches:a})=>{const{toast:l}=le(),d=xe(),i=!!s,[g,u]=r.useState("1"),[m,p]=r.useState(""),[f,h]=r.useState(""),[c,j]=r.useState(""),[S,y]=r.useState([]),[N,P]=r.useState(1),[z,F]=r.useState(!1);r.useEffect(()=>{if(t)if(s){u(String(s.day_of_week)),p(he(s.start_time)),h(he(s.end_time)),j(s.location);const x=s.assignments.map((k,q)=>({key:q,group_id:String(k.group_id),coach_id:String(k.coach_id),lane_count:k.lane_count!=null?String(k.lane_count):""}));y(x),P(x.length)}else u("1"),p(""),h(""),j(""),y([]),P(1)},[t,s]);const C=()=>{y(x=>[...x,{key:N,group_id:"",coach_id:"",lane_count:""}]),P(x=>x+1)},R=x=>{y(k=>k.filter(q=>q.key!==x))},A=(x,k,q)=>{y(B=>B.map(Y=>Y.key===x?{...Y,[k]:q}:Y))},w=()=>!m||!f?(l({title:"Horaires requis",description:"Veuillez saisir les heures de debut et fin.",variant:"destructive"}),null):c.trim()?{day_of_week:Number(g),start_time:m,end_time:f,location:c.trim(),assignments:S.filter(x=>x.group_id&&x.coach_id).map(x=>({group_id:Number(x.group_id),coach_id:Number(x.coach_id),lane_count:x.lane_count?Number(x.lane_count):null}))}:(l({title:"Lieu requis",description:"Veuillez saisir un lieu.",variant:"destructive"}),null),I=J({mutationFn:x=>O.createTrainingSlot(x),onSuccess:()=>{l({title:"Creneau cree"}),d.invalidateQueries({queryKey:["training-slots"]}),n(!1)},onError:x=>{l({title:"Erreur",description:x.message,variant:"destructive"})}}),$=J({mutationFn:x=>O.updateTrainingSlot(s.id,x),onSuccess:()=>{l({title:"Creneau mis a jour"}),d.invalidateQueries({queryKey:["training-slots"]}),n(!1)},onError:x=>{l({title:"Erreur",description:x.message,variant:"destructive"})}}),V=J({mutationFn:()=>O.deleteTrainingSlot(s.id),onSuccess:()=>{l({title:"Creneau supprime"}),d.invalidateQueries({queryKey:["training-slots"]}),n(!1)},onError:x=>{l({title:"Erreur",description:x.message,variant:"destructive"})}}),L=()=>{const x=w();x&&(i?$.mutate(x):I.mutate(x))},_=I.isPending||$.isPending||V.isPending;return e.jsxs(e.Fragment,{children:[e.jsx(ge,{open:t,onOpenChange:n,children:e.jsxs(fe,{side:"right",className:"w-full sm:max-w-md overflow-y-auto",children:[e.jsxs(ve,{children:[e.jsx(je,{children:i?"Modifier le creneau":"Nouveau creneau"}),e.jsx(Oe,{children:i?"Modifiez les details de ce creneau.":"Definissez un nouveau creneau hebdomadaire."})]}),e.jsxs("div",{className:"mt-6 space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(U,{children:"Jour de la semaine *"}),e.jsxs(se,{value:g,onValueChange:u,children:[e.jsx(ne,{children:e.jsx(re,{})}),e.jsx(ae,{children:kt.map((x,k)=>e.jsx(W,{value:String(k+1),children:x},k+1))})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(U,{htmlFor:"slot-start",children:"Debut *"}),e.jsx("input",{id:"slot-start",type:"time",value:m,onChange:x=>p(x.target.value),className:"flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-sm transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(U,{htmlFor:"slot-end",children:"Fin *"}),e.jsx("input",{id:"slot-end",type:"time",value:f,onChange:x=>h(x.target.value),className:"flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-sm transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(U,{htmlFor:"slot-location",children:"Lieu *"}),e.jsx(de,{id:"slot-location",placeholder:"Ex : Piscine Erstein",value:c,onChange:x=>j(x.target.value)})]}),e.jsx(ts,{}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(U,{children:"Groupes & Coachs"}),e.jsxs(K,{type:"button",variant:"outline",size:"sm",onClick:C,children:[e.jsx(ue,{className:"mr-1 h-3.5 w-3.5"}),"Ajouter"]})]}),S.length===0&&e.jsx("p",{className:"text-xs text-muted-foreground text-center py-2",children:"Aucun groupe assigne."}),S.map(x=>e.jsx("div",{className:"rounded-lg border p-3 space-y-2",children:e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs(se,{value:x.group_id,onValueChange:k=>A(x.key,"group_id",k),children:[e.jsx(ne,{className:"h-8 text-xs",children:e.jsx(re,{placeholder:"Groupe..."})}),e.jsx(ae,{children:o.map(k=>e.jsx(W,{value:String(k.id),children:k.name},k.id))})]}),e.jsxs(se,{value:x.coach_id,onValueChange:k=>A(x.key,"coach_id",k),children:[e.jsx(ne,{className:"h-8 text-xs",children:e.jsx(re,{placeholder:"Coach..."})}),e.jsx(ae,{children:a.map(k=>e.jsx(W,{value:String(k.id),children:k.display_name},k.id))})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(de,{type:"number",min:0,placeholder:"Lignes d'eau",value:x.lane_count,onChange:k=>A(x.key,"lane_count",k.target.value),className:"h-8 text-xs flex-1"}),e.jsx(K,{type:"button",variant:"ghost",size:"icon",className:"h-8 w-8 text-muted-foreground hover:text-destructive shrink-0",onClick:()=>R(x.key),children:e.jsx(st,{className:"h-3.5 w-3.5"})})]})]})},x.key))]}),e.jsxs("div",{className:"space-y-2 pt-2",children:[e.jsx(K,{className:"w-full",onClick:L,disabled:_||!m||!f||!c.trim(),children:_?"Enregistrement...":i?"Enregistrer":"Creer"}),i&&e.jsx(K,{variant:"outline",className:"w-full text-destructive hover:text-destructive",onClick:()=>F(!0),disabled:_,children:"Supprimer ce creneau"})]})]})]})}),e.jsx(ke,{open:z,onOpenChange:F,children:e.jsxs(Me,{children:[e.jsxs(Ae,{children:[e.jsx(Ee,{children:"Supprimer le creneau"}),e.jsx(Re,{children:"Ce creneau sera desactive. Les exceptions associees resteront en base mais ne seront plus visibles."})]}),e.jsxs(De,{children:[e.jsx(Pe,{children:"Annuler"}),e.jsx(Fe,{onClick:()=>{V.mutate(),F(!1)},className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Supprimer"})]})]})})]})},Ea=({open:t,onOpenChange:n,slot:s})=>{const{toast:o}=le(),a=xe(),[l,d]=r.useState(""),[i,g]=r.useState("cancelled"),[u,m]=r.useState(""),[p,f]=r.useState(""),[h,c]=r.useState(""),[j,S]=r.useState("");r.useEffect(()=>{t&&(d(""),g("cancelled"),m(s?he(s.start_time):""),f(s?he(s.end_time):""),c(s?.location??""),S(""))},[t,s]);const y=J({mutationFn:P=>O.createSlotOverride(P),onSuccess:()=>{o({title:"Exception enregistree"}),a.invalidateQueries({queryKey:["training-slot-overrides"]}),a.invalidateQueries({queryKey:["training-slots"]}),n(!1)},onError:P=>{o({title:"Erreur",description:P.message,variant:"destructive"})}}),N=()=>{if(!s)return;if(!l){o({title:"Date requise",description:"Veuillez saisir la date de l'exception.",variant:"destructive"});return}const P={slot_id:s.id,override_date:l,status:i,new_start_time:i==="modified"&&u||null,new_end_time:i==="modified"&&p||null,new_location:i==="modified"&&h.trim()?h.trim():null,reason:j.trim()||null};y.mutate(P)};return e.jsx(ge,{open:t,onOpenChange:n,children:e.jsxs(fe,{side:"right",className:"w-full sm:max-w-md overflow-y-auto",children:[e.jsxs(ve,{children:[e.jsx(je,{children:"Exception"}),e.jsx(Oe,{children:"Annulez ou modifiez ce creneau pour une date precise."})]}),e.jsxs("div",{className:"mt-6 space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(U,{htmlFor:"override-date",children:"Date *"}),e.jsx("input",{id:"override-date",type:"date",value:l,onChange:P=>d(P.target.value),className:"flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-sm transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(U,{children:"Type"}),e.jsxs(Ws,{value:i,onValueChange:P=>g(P),className:"flex gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(jt,{value:"cancelled",id:"ovr-cancelled"}),e.jsx(U,{htmlFor:"ovr-cancelled",className:"font-normal",children:"Annule"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(jt,{value:"modified",id:"ovr-modified"}),e.jsx(U,{htmlFor:"ovr-modified",className:"font-normal",children:"Modifie"})]})]})]}),i==="modified"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(U,{htmlFor:"ovr-start",children:"Nouvel horaire debut"}),e.jsx("input",{id:"ovr-start",type:"time",value:u,onChange:P=>m(P.target.value),className:"flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-sm transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(U,{htmlFor:"ovr-end",children:"Nouvel horaire fin"}),e.jsx("input",{id:"ovr-end",type:"time",value:p,onChange:P=>f(P.target.value),className:"flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-sm transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(U,{htmlFor:"ovr-location",children:"Nouveau lieu"}),e.jsx(de,{id:"ovr-location",value:h,onChange:P=>c(P.target.value)})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(U,{htmlFor:"ovr-reason",children:"Motif"}),e.jsx(de,{id:"ovr-reason",placeholder:"Ex : Vacances scolaires",value:j,onChange:P=>S(P.target.value)})]}),e.jsx(K,{className:"w-full",onClick:N,disabled:y.isPending||!l,children:y.isPending?"Enregistrement...":"Enregistrer"})]})]})})},Ra=({slot:t,hasOverrides:n,onSelect:s})=>{const o=bt(t.start_time),a=Ma(t.start_time,t.end_time),l=a<50;return e.jsx("button",{type:"button",className:"absolute left-0.5 right-0.5 rounded-md border bg-primary/10 border-primary/30 px-1.5 py-0.5 text-left overflow-hidden cursor-pointer hover:bg-primary/20 transition-colors group",style:{top:o,height:a,minHeight:24},onClick:()=>s(t),title:`${he(t.start_time)}–${he(t.end_time)} · ${t.location}`,children:e.jsxs("div",{className:`flex flex-col gap-0.5 ${l?"flex-row items-center":""}`,children:[e.jsxs("div",{className:"flex items-center gap-1 min-w-0",children:[e.jsx(as,{className:"h-2.5 w-2.5 text-primary shrink-0"}),e.jsx("span",{className:"text-[10px] font-medium text-foreground truncate",children:t.location}),n&&e.jsx(Qt,{className:"h-2.5 w-2.5 text-orange-500 shrink-0"})]}),!l&&t.assignments.length>0&&e.jsx("div",{className:"flex flex-wrap gap-0.5",children:t.assignments.map(d=>e.jsx(te,{variant:"secondary",className:"text-[9px] px-1 py-0 leading-tight",children:d.group_name},d.id))}),!l&&a>=70&&t.assignments.length>0&&e.jsx("span",{className:"text-[9px] text-muted-foreground truncate",children:[...new Set(t.assignments.map(d=>d.coach_name))].join(", ")})]})})},Da=({slot:t,open:n,onOpenChange:s,overrides:o,onEdit:a,onOverride:l,onDeleteOverride:d})=>t?e.jsx(ge,{open:n,onOpenChange:s,children:e.jsxs(fe,{side:"bottom",className:"max-h-[60vh] overflow-y-auto rounded-t-2xl",children:[e.jsxs(ve,{className:"pb-2",children:[e.jsxs(je,{className:"text-left text-base",children:[kt[t.day_of_week-1]," · ",he(t.start_time),"–",he(t.end_time)]}),e.jsx(Oe,{className:"sr-only",children:"Details du creneau"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-sm text-muted-foreground",children:[e.jsx(as,{className:"h-3.5 w-3.5 shrink-0"}),t.location]}),t.assignments.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1.5",children:t.assignments.map(i=>e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(te,{variant:"secondary",className:"text-xs px-2 py-0.5",children:i.group_name}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[i.coach_name,i.lane_count!=null&&` · ${i.lane_count} ligne${i.lane_count>1?"s":""}`]})]},i.id))}),o.length>0&&e.jsxs("div",{className:"space-y-1.5 pt-1 border-t border-dashed",children:[e.jsx("span",{className:"text-xs font-semibold text-muted-foreground uppercase tracking-wider",children:"Exceptions"}),o.map(i=>e.jsxs("div",{className:"flex items-center gap-1.5 text-xs",children:[e.jsx(Qt,{className:"h-3 w-3 text-orange-500 shrink-0"}),e.jsx("span",{className:"text-muted-foreground",children:new Date(i.override_date+"T00:00:00").toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit"})}),e.jsx(te,{variant:i.status==="cancelled"?"destructive":"outline",className:"text-[10px] px-1 py-0",children:i.status==="cancelled"?"Annule":"Modifie"}),i.reason&&e.jsx("span",{className:"text-muted-foreground truncate flex-1",children:i.reason}),e.jsx(K,{variant:"ghost",size:"icon",className:"h-6 w-6 ml-auto shrink-0 text-muted-foreground hover:text-destructive",onClick:()=>d(i.id),children:e.jsx(st,{className:"h-3 w-3"})})]},i.id))]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx(K,{variant:"outline",size:"sm",className:"flex-1",onClick:a,children:"Modifier"}),e.jsx(K,{variant:"outline",size:"sm",className:"flex-1",onClick:l,children:"Exception"})]})]})]})}):null,Pa=({onBack:t,groups:n})=>{const{toast:s}=le(),o=xe(),[a,l]=r.useState(!1),[d,i]=r.useState(null),[g,u]=r.useState(null),[m,p]=r.useState(!1),[f,h]=r.useState(null),[c,j]=r.useState(!1),[S,y]=r.useState("group"),[N,P]=r.useState("all"),[z,F]=r.useState("all"),{data:C=[],isLoading:R}=Q({queryKey:["training-slots"],queryFn:()=>O.getTrainingSlots()}),{data:A=[]}=Q({queryKey:["training-slot-overrides","upcoming"],queryFn:()=>O.getSlotOverrides({fromDate:_a()})}),{data:w=[]}=Q({queryKey:["users","coaches"],queryFn:()=>O.listUsers({role:"coach"})}),I=r.useMemo(()=>{if(S==="coach"&&N!=="all"){const b=Number(N);return C.filter(T=>T.assignments.some(v=>v.coach_id===b))}if(S==="group"&&z!=="all"){const b=Number(z);return C.filter(T=>T.assignments.some(v=>v.group_id===b))}return C},[C,S,N,z]),$=r.useMemo(()=>{const b=new Map;for(let T=1;T<=7;T++)b.set(T,[]);for(const T of I)b.get(T.day_of_week).push(T);for(const T of b.values())T.sort((v,D)=>v.start_time.localeCompare(D.start_time));return b},[I]),V=r.useMemo(()=>{const b=new Map;for(const T of A){const v=b.get(T.slot_id)??[];v.push(T),b.set(T.slot_id,v)}return b},[A]),L=J({mutationFn:b=>O.deleteSlotOverride(b),onSuccess:()=>{s({title:"Exception supprimee"}),o.invalidateQueries({queryKey:["training-slot-overrides"]})},onError:b=>{s({title:"Erreur",description:b.message,variant:"destructive"})}}),_=()=>{i(null),l(!0)},x=b=>{h(b),j(!0)},k=()=>{f&&(j(!1),i(f),l(!0))},q=()=>{f&&(j(!1),u(f),p(!0))},B=w.map(b=>({id:b.id,display_name:b.display_name})),Y=C.length===0?"Planning hebdomadaire des entrainements.":`${C.length} creneau${C.length>1?"x":""}`;return e.jsxs("div",{className:"space-y-4 pb-24",children:[e.jsx(me,{title:"Creneaux",description:Y,onBack:t,actions:e.jsxs(K,{variant:"outline",size:"sm",onClick:_,children:[e.jsx(ue,{className:"mr-1.5 h-3.5 w-3.5"}),"Nouveau"]})}),e.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center",children:[e.jsxs(tt,{type:"single",value:S,onValueChange:b=>{(b==="coach"||b==="group")&&y(b)},className:"shrink-0",children:[e.jsx(ce,{value:"group",className:"text-xs px-3",children:"Groupe"}),e.jsx(ce,{value:"coach",className:"text-xs px-3",children:"Coach"})]}),S==="group"?e.jsxs(se,{value:z,onValueChange:F,children:[e.jsx(ne,{className:"w-full sm:w-56",children:e.jsx(re,{placeholder:"Tous les groupes"})}),e.jsxs(ae,{children:[e.jsx(W,{value:"all",children:"Tous les groupes"}),n.map(b=>e.jsx(W,{value:String(b.id),children:b.name},b.id))]})]}):e.jsxs(se,{value:N,onValueChange:P,children:[e.jsx(ne,{className:"w-full sm:w-56",children:e.jsx(re,{placeholder:"Tous les coachs"})}),e.jsxs(ae,{children:[e.jsx(W,{value:"all",children:"Tous les coachs"}),w.map(b=>e.jsx(W,{value:String(b.id),children:b.display_name},b.id))]})]})]}),R?e.jsx("div",{className:"grid grid-cols-7 gap-2",children:Array.from({length:7},(b,T)=>e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-4 w-12 rounded bg-muted animate-pulse motion-reduce:animate-none"}),e.jsx("div",{className:"h-40 rounded-lg bg-muted animate-pulse motion-reduce:animate-none"})]},T))}):C.length===0?e.jsxs("div",{className:"text-center py-12 space-y-3",children:[e.jsx(rs,{className:"h-10 w-10 text-muted-foreground mx-auto"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Aucun creneau defini."}),e.jsxs(K,{variant:"outline",size:"sm",onClick:_,children:[e.jsx(ue,{className:"mr-1.5 h-3.5 w-3.5"}),"Creer le premier creneau"]})]}):e.jsx("div",{className:"overflow-x-auto -mx-4 px-4",children:e.jsxs("div",{className:"grid",style:{minWidth:"760px",gridTemplateColumns:"2rem repeat(7, 1fr)"},children:[e.jsx("div",{})," ",Array.from({length:7},(b,T)=>e.jsxs("div",{className:"text-center pb-1.5",children:[e.jsx("span",{className:"text-[10px] font-semibold uppercase tracking-[0.15em] text-muted-foreground sm:hidden",children:Sa[T]}),e.jsx("span",{className:"text-[10px] font-semibold uppercase tracking-[0.15em] text-muted-foreground hidden sm:inline",children:kt[T]})]},T)),e.jsx("div",{className:"relative",style:{height:qt},children:zt.map(b=>e.jsxs("span",{className:"absolute right-1 text-[9px] text-muted-foreground/70 leading-none -translate-y-1/2",style:{top:(b-Be)*et},children:[b,"h"]},b))}),Array.from({length:7},(b,T)=>T+1).map(b=>{const T=$.get(b)??[];return e.jsxs("div",{className:"relative border-l border-border/40",style:{height:qt},children:[zt.map(v=>e.jsx("div",{className:"absolute left-0 right-0 border-t border-border/20",style:{top:(v-Be)*et}},v)),T.map(v=>e.jsx(Ra,{slot:v,hasOverrides:(V.get(v.id)??[]).length>0,onSelect:x},v.id))]},b)})]})}),e.jsx(Da,{slot:f,open:c,onOpenChange:j,overrides:f?V.get(f.id)??[]:[],onEdit:k,onOverride:q,onDeleteOverride:b=>L.mutate(b)}),e.jsx(Aa,{open:a,onOpenChange:l,slot:d,groups:n,coaches:B}),e.jsx(Ea,{open:m,onOpenChange:p,slot:g})]})},Fa=r.lazy(()=>Wt(()=>import("./StrengthCatalog-CbleyBga.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46]))),Ia=r.lazy(()=>Wt(()=>import("./SwimCatalog-CwoLqaAL.js"),__vite__mapDeps([47,1,2,3,4,5,6,7,9,10,11,12,18,25,48,49,17,50,51,16,45,21,22,23,24,15,20,26,27,28,29,30,8,14,39,32,52,53,34]))),Ta=({onNavigate:t,onOpenRecordsAdmin:n,onOpenRecordsClub:s,athletes:o,athletesLoading:a,upcomingBirthdays:l,birthdaysLoading:d,kpiLoading:i,kpiPeriod:g,onKpiPeriodChange:u,fatigueAlerts:m,mostLoadedAthlete:p,swimSessionCount:f,strengthSessionCount:h})=>{const c=new Date().getHours(),j=c<12?"Bonjour":c<18?"Bon après-midi":"Bonsoir",S=new Date().toLocaleDateString("fr-FR",{weekday:"long",day:"numeric",month:"long"}),y=m.length>0;return e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-display font-bold uppercase italic",children:[j,", ",e.jsx("span",{className:"text-primary",children:"Coach"})]}),e.jsx("p",{className:"text-sm text-muted-foreground capitalize",children:S})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h2",{className:"text-xs font-semibold uppercase tracking-[0.15em] text-muted-foreground",children:["Signaux · ",g,"j"]}),e.jsxs(tt,{type:"single",size:"sm",variant:"outline",value:String(g),onValueChange:N=>{N&&u(Number(N))},children:[e.jsx(ce,{value:"7",className:"h-7 px-2 text-xs","aria-label":"7 jours",children:"7j"}),e.jsx(ce,{value:"30",className:"h-7 px-2 text-xs","aria-label":"30 jours",children:"30j"}),e.jsx(ce,{value:"365",className:"h-7 px-2 text-xs","aria-label":"1 an",children:"1an"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:`rounded-xl border p-3 ${y?"border-destructive/30 bg-destructive/5":"bg-muted/30"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-[11px] text-muted-foreground",children:"Fatigue 5/5"}),e.jsx(qn,{className:`h-3.5 w-3.5 ${y?"text-destructive":"text-muted-foreground"}`})]}),e.jsx("p",{className:"text-xl font-bold tabular-nums",children:i?"–":m.length}),e.jsx("p",{className:"text-[11px] text-muted-foreground truncate",children:i?"Chargement…":y?m.slice(0,2).map(N=>N.athleteName.split(" ")[0]).join(", "):"Aucune alerte"})]}),e.jsxs("div",{className:"rounded-xl border bg-muted/30 p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-[11px] text-muted-foreground",children:"Plus chargé"}),e.jsx(Ze,{className:"h-3.5 w-3.5 text-muted-foreground"})]}),e.jsx("p",{className:"text-xl font-bold truncate",children:i?"–":p?.athleteName?.split(" ")[0]??"–"}),e.jsx("p",{className:"text-[11px] text-muted-foreground",children:i?"Calcul…":p?`Charge ${Math.round(p.loadScore)}`:"Pas de données"})]})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs("button",{type:"button",onClick:()=>t("calendar"),className:"flex items-center gap-1.5 rounded-full bg-primary text-primary-foreground px-3.5 py-2 text-sm font-semibold active:opacity-80 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",children:[e.jsx(pt,{className:"h-3.5 w-3.5"}),"Assigner"]}),e.jsxs("button",{type:"button",onClick:()=>t("messaging"),className:"flex items-center gap-1.5 rounded-full border px-3.5 py-2 text-sm font-semibold active:bg-muted focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",children:[e.jsx(is,{className:"h-3.5 w-3.5"}),"Email"]}),e.jsxs("button",{type:"button",onClick:()=>t("sms"),className:"flex items-center gap-1.5 rounded-full border px-3.5 py-2 text-sm font-semibold active:bg-muted focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",children:[e.jsx(Jt,{className:"h-3.5 w-3.5"}),"SMS"]}),e.jsxs("button",{type:"button",onClick:()=>t("groups"),className:"flex items-center gap-1.5 rounded-full border px-3.5 py-2 text-sm font-semibold active:bg-muted focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",children:[e.jsx(ls,{className:"h-3.5 w-3.5"}),"Groupes"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("button",{type:"button",onClick:()=>t("swim"),className:"rounded-xl border bg-card p-4 text-left shadow-sm active:bg-muted/50 transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",children:[e.jsx(Ut,{className:"h-5 w-5 text-primary mb-2"}),e.jsx("p",{className:"text-sm font-bold",children:"Natation"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:f!=null?`${f} séance${f!==1?"s":""}`:"Bibliothèque"})]}),e.jsxs("button",{type:"button",onClick:()=>t("strength"),className:"rounded-xl border bg-card p-4 text-left shadow-sm active:bg-muted/50 transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",children:[e.jsx(Ht,{className:"h-5 w-5 text-primary mb-2"}),e.jsx("p",{className:"text-sm font-bold",children:"Musculation"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:h!=null?`${h} séance${h!==1?"s":""}`:"Bibliothèque"})]}),e.jsxs("button",{type:"button",onClick:()=>t("swimmers"),className:"rounded-xl border bg-card p-4 text-left shadow-sm active:bg-muted/50 transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",children:[e.jsx(Ze,{className:"h-5 w-5 text-primary mb-2"}),e.jsx("p",{className:"text-sm font-bold",children:"Nageurs"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:a?"Chargement…":`${o.length} nageur${o.length!==1?"s":""}`})]}),e.jsxs("button",{type:"button",onClick:n,className:"rounded-xl border bg-card p-4 text-left shadow-sm active:bg-muted/50 transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",children:[e.jsx(ut,{className:"h-5 w-5 text-primary mb-2"}),e.jsx("p",{className:"text-sm font-bold",children:"Records club"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Import & administration"})]}),e.jsxs("button",{type:"button",onClick:()=>t("competitions"),className:"rounded-xl border bg-card p-4 text-left shadow-sm active:bg-muted/50 transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",children:[e.jsx(ut,{className:"h-5 w-5 text-amber-500 mb-2"}),e.jsx("p",{className:"text-sm font-bold",children:"Compétitions"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Échéances & calendrier"})]}),e.jsxs("button",{type:"button",onClick:()=>t("objectives"),className:"rounded-xl border bg-card p-4 text-left shadow-sm active:bg-muted/50 transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",children:[e.jsx(mt,{className:"h-5 w-5 text-primary mb-2"}),e.jsx("p",{className:"text-sm font-bold",children:"Objectifs"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Temps cibles & objectifs"})]}),e.jsxs("button",{type:"button",onClick:()=>t("training-slots"),className:"rounded-xl border bg-card p-4 text-left shadow-sm active:bg-muted/50 transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",children:[e.jsx(rs,{className:"h-5 w-5 text-primary mb-2"}),e.jsx("p",{className:"text-sm font-bold",children:"Creneaux"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Planning hebdo"})]})]}),e.jsx("button",{type:"button",onClick:s,className:"w-full text-center text-sm text-primary font-semibold py-1 active:opacity-70 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring rounded",children:"Voir les records du club"}),!d&&l&&l.length>0?e.jsxs("div",{className:"space-y-2",children:[e.jsx("h2",{className:"text-xs font-semibold uppercase tracking-[0.15em] text-muted-foreground",children:"Anniversaires"}),e.jsx("div",{className:"space-y-1.5",children:l.slice(0,3).map(N=>e.jsxs("div",{className:"flex items-center justify-between gap-2 rounded-lg border px-3 py-2",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("span",{className:"text-sm font-medium truncate block",children:N.display_name}),e.jsx("span",{className:"text-[11px] text-muted-foreground",children:Oa(N.next_birthday)})]}),e.jsxs("span",{className:"text-xs font-bold text-primary shrink-0",children:["J-",N.days_until]})]},N.id))})]}):null]})},Oa=t=>{if(!t)return"-";const n=new Date(t);return Number.isNaN(n.getTime())?t:n.toLocaleDateString("fr-FR")},Lt=t=>t.toISOString().split("T")[0],$a=t=>new Date(t.completed_at||t.started_at||t.date||t.created_at||0).getTime(),qa=t=>{if(!t.length)return null;const n=t.reduce((o,a)=>o+a,0)/t.length,s=Math.min(5,Math.max(1,Math.round(n/10*5)));return{average:n,rating:s}};function za(){const t=At(C=>C.role),n=At(C=>C.setSelectedAthlete),[,s]=on(),[o,a]=r.useState(()=>window.location.hash.match(/[?&]section=([^&]+)/)?.[1]||"home"),[l,d]=r.useState(7);r.useEffect(()=>{const C=()=>a("home");return window.addEventListener("nav:reset",C),()=>window.removeEventListener("nav:reset",C)},[]);const i=t==="coach"||t==="admin",g=o==="home"||o==="calendar",u=o==="home"||o==="messaging"||o==="sms"||o==="swimmers"||o==="calendar"||o==="groups"||o==="objectives",m=o==="messaging"||o==="sms"||o==="calendar"||o==="groups"||o==="training-slots",p=o==="home"||o==="swimmers",{data:f}=Q({queryKey:["swim_catalog"],queryFn:()=>O.getSwimCatalog(),enabled:i&&g}),{data:h}=Q({queryKey:["strength_catalog"],queryFn:()=>O.getStrengthSessions(),enabled:i&&g}),{data:c=[],isLoading:j}=Q({queryKey:["athletes"],queryFn:()=>O.getAthletes(),enabled:i&&u}),S=r.useMemo(()=>c.slice(0,5),[c]),{data:y=[]}=Q({queryKey:["groups"],queryFn:()=>O.getGroups(),enabled:i&&m}),N=Q({queryKey:["upcoming-birthdays"],queryFn:()=>O.getUpcomingBirthdays({days:30}),enabled:i&&p}),P=N.data,z=Q({queryKey:["coach-kpis",l,S.map(C=>C.id??C.display_name)],enabled:i&&o==="home"&&S.length>0,queryFn:async()=>{const C=l,R=new Date;R.setDate(R.getDate()-C);const A=Lt(R),w=Lt(new Date),I=await Promise.all(S.map(async L=>{const[_,x]=await Promise.all([O.getSessions(L.display_name,L.id),O.getStrengthHistory(L.display_name,{athleteId:L.id,limit:50,from:A,to:w})]),k=_.filter(M=>new Date(M.date).getTime()>=R.getTime()),q=k.map(M=>M.fatigue??M.feeling).filter(M=>Number.isFinite(M)),B=k.reduce((M,E)=>M+(Number(E.duration)||0)*(Number(E.effort)||0),0),b=(x?.runs??[]).filter(M=>$a(M)>=R.getTime()),T=b.map(M=>M.fatigue??M.feeling??M.rpe).filter(M=>Number.isFinite(Number(M))).map(M=>Number(M)),v=b.reduce((M,E)=>{const G=Number(E.feeling??E.rpe??0),H=Number(E.duration??0);if(H>0&&G>0)return M+H*G;const Z=Array.isArray(E.logs)?E.logs.length:0;return M+Z*5},0),D=qa([...q,...T]);return{athleteName:L.display_name,loadScore:B+v,fatigueRating:D}})),$=I.filter(L=>L.fatigueRating?.rating===5).map(L=>({athleteName:L.athleteName,rating:L.fatigueRating?.rating??0})),V=I.filter(L=>L.loadScore>0).sort((L,_)=>_.loadScore-L.loadScore)[0];return{fatigueAlerts:$,mostLoadedAthlete:V??null}}}),F=C=>{n({id:C.id??null,name:C.display_name}),s(C.id!=null?`/coach/swimmer/${C.id}`:"/progress")};return le(),i?e.jsxs("div",{className:"space-y-6",children:[o==="home"?e.jsx(Ta,{onNavigate:a,onOpenRecordsAdmin:()=>s("/records-admin"),onOpenRecordsClub:()=>s("/records-club"),athletes:c,athletesLoading:j,upcomingBirthdays:P,birthdaysLoading:N.isLoading,kpiLoading:z.isLoading,kpiPeriod:l,onKpiPeriodChange:d,fatigueAlerts:z.data?.fatigueAlerts??[],mostLoadedAthlete:z.data?.mostLoadedAthlete??null,swimSessionCount:f?.length,strengthSessionCount:h?.length}):null,o==="swim"?e.jsxs("div",{className:"space-y-6",children:[e.jsx(me,{title:"Bibliothèque natation",description:"Accédez aux séances et aux templates natation.",onBack:()=>a("home"),actions:e.jsxs(K,{variant:"outline",size:"sm",onClick:()=>a("calendar"),children:[e.jsx(pt,{className:"mr-1.5 h-3.5 w-3.5"}),"Assigner"]})}),e.jsx(r.Suspense,{fallback:e.jsx(Et,{}),children:e.jsx(Ia,{})})]}):null,o==="strength"?e.jsxs("div",{className:"space-y-6",children:[e.jsx(me,{title:"Bibliothèque musculation",description:"Consultez et créez des séances musculation.",onBack:()=>a("home"),actions:e.jsxs(K,{variant:"outline",size:"sm",onClick:()=>a("calendar"),children:[e.jsx(pt,{className:"mr-1.5 h-3.5 w-3.5"}),"Assigner"]})}),e.jsx(r.Suspense,{fallback:e.jsx(Et,{}),children:e.jsx(Fa,{})})]}):null,o==="swimmers"?e.jsx(Vn,{athletes:c,athletesLoading:j,onBack:()=>a("home"),onOpenAthlete:F}):null,o==="messaging"?e.jsx(Bn,{onBack:()=>a("home"),athletes:c,groups:y,athletesLoading:j}):null,o==="sms"?e.jsx(Kr,{onBack:()=>a("home"),athletes:c,groups:y,athletesLoading:j}):null,o==="calendar"?e.jsx(Hr,{onBack:()=>a("home"),athletes:c,groups:y,swimSessions:f,strengthSessions:h}):null,o==="groups"?e.jsx(Jr,{onBack:()=>a("home"),athletes:c,groups:y,athletesLoading:j}):null,o==="competitions"?e.jsx(aa,{onBack:()=>a("home")}):null,o==="objectives"?e.jsx(ca,{onBack:()=>a("home"),athletes:c,athletesLoading:j}):null,o==="training-slots"?e.jsx(Pa,{onBack:()=>a("home"),groups:y}):null]}):e.jsx("div",{className:"flex items-center justify-center min-h-[60vh] animate-in fade-in motion-reduce:animate-none",children:e.jsxs(ze,{className:"w-full max-w-sm shadow-xl border-t-4 border-t-primary",children:[e.jsxs(Le,{children:[e.jsxs(Ke,{className:"flex items-center gap-2 uppercase italic",children:[e.jsx(Ze,{className:"h-5 w-5 text-primary"}),"Accès Coach"]}),e.jsx(Ge,{children:"Cette section est réservée aux coachs et administrateurs."})]}),e.jsx(Ve,{children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"Connectez-vous avec un compte autorisé pour accéder aux outils de gestion."})})]})})}const vo=Object.freeze(Object.defineProperty({__proto__:null,default:za},Symbol.toStringTag,{value:"Module"}));export{As as C,xr as P,Ws as R,Es as a,Rs as b,Ds as c,gt as d,ft as e,gr as f,bs as g,jt as h,vo as i};
