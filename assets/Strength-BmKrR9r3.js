import{R as d,T as Tn,L as Dn,G as Mn,H as An,J as In,r as m,O as On,j as e}from"./vendor-ui-CDk0TPZB.js";import{b as $n,u as it,d as Pn,c as Ze}from"./vendor-query-BoCJU2ZS.js";import{h as tt,k as ue,i as sn,D as Ye,B as L,C as Xe,b as Tt,c as Dt,d as rn,f as Mt,L as et,o as Ln,X as yt,u as Fn,I as St,g as je}from"./index-C3dQyc3H.js";import{S as At,a as It,b as Ot,c as $t,d as Hn}from"./sheet-DkZISHOj.js";import{S as Pt}from"./switch-C6utZXoj.js";import{S as zn,a as Bn,b as qn,c as Vn,d as pt}from"./select-Bujfo4c-.js";import{T as Un,a as Wn,b as Ut,c as Wt}from"./tabs-CIeYwhaP.js";import{B as ut}from"./badge-VthlwTY_.js";import{L as Kn,A as Qn,a as Yn,b as Xn,c as Gn,d as Jn,e as Zn,f as es,g as ts,P as Kt}from"./alert-dialog-B5lEtePH.js";import{C as Qt}from"./check-D2cTI8qm.js";import{T as ns}from"./timer-DOu_w0xi.js";import{C as Lt,I as ss}from"./info-BinyAWki.js";import{S as rs}from"./search-CXLM3MVt.js";import{C as Yt}from"./chevron-left-B4qZD2qI.js";import{f as ht}from"./fr-CqUxEDd2.js";import{f as xt}from"./vendor-date-cQbdWov0.js";import"./vendor-react-BzrpNAyj.js";import"./vendor-charts-bGfQb4ap.js";import"./vendor-supabase-CgI36rMY.js";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const as=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],is=tt("calendar",as);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const os=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],ls=tt("circle-check",os);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cs=[["rect",{x:"14",y:"3",width:"5",height:"18",rx:"1",key:"kaeet6"}],["rect",{x:"5",y:"3",width:"5",height:"18",rx:"1",key:"1wsw3u"}]],ds=tt("pause",cs);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const us=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]],ms=tt("rotate-ccw",us);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fs=[["path",{d:"M10 5H3",key:"1qgfaw"}],["path",{d:"M12 19H3",key:"yhmn1j"}],["path",{d:"M14 3v4",key:"1sua03"}],["path",{d:"M16 17v4",key:"1q0r14"}],["path",{d:"M21 12h-9",key:"1o4lsq"}],["path",{d:"M21 19h-5",key:"1rlt1p"}],["path",{d:"M21 5h-7",key:"1oszz2"}],["path",{d:"M8 10v4",key:"tgpxqk"}],["path",{d:"M8 12H3",key:"a7s4jb"}]],ps=tt("sliders-horizontal",fs);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hs=[["path",{d:"M16 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V8Z",key:"qazsjp"}],["path",{d:"M15 3v4a2 2 0 0 0 2 2h4",key:"40519r"}]],xs=tt("sticky-note",hs);function gs(t){if(typeof document>"u")return;let s=document.head||document.getElementsByTagName("head")[0],r=document.createElement("style");r.type="text/css",s.appendChild(r),r.styleSheet?r.styleSheet.cssText=t:r.appendChild(document.createTextNode(t))}const an=d.createContext({drawerRef:{current:null},overlayRef:{current:null},onPress:()=>{},onRelease:()=>{},onDrag:()=>{},onNestedDrag:()=>{},onNestedOpenChange:()=>{},onNestedRelease:()=>{},openProp:void 0,dismissible:!1,isOpen:!1,isDragging:!1,keyboardIsOpen:{current:!1},snapPointsOffset:null,snapPoints:null,handleOnly:!1,modal:!1,shouldFade:!1,activeSnapPoint:null,onOpenChange:()=>{},setActiveSnapPoint:()=>{},closeDrawer:()=>{},direction:"bottom",shouldAnimate:{current:!0},shouldScaleBackground:!1,setBackgroundColorOnScale:!0,noBodyStyles:!1,container:null,autoFocus:!1}),mt=()=>{const t=d.useContext(an);if(!t)throw new Error("useDrawerContext must be used within a Drawer.Root");return t};gs(`[data-vaul-drawer]{touch-action:none;will-change:transform;transition:transform .5s cubic-bezier(.32, .72, 0, 1);animation-duration:.5s;animation-timing-function:cubic-bezier(0.32,0.72,0,1)}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=bottom][data-state=open]{animation-name:slideFromBottom}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=bottom][data-state=closed]{animation-name:slideToBottom}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=top][data-state=open]{animation-name:slideFromTop}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=top][data-state=closed]{animation-name:slideToTop}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=left][data-state=open]{animation-name:slideFromLeft}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=left][data-state=closed]{animation-name:slideToLeft}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=right][data-state=open]{animation-name:slideFromRight}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=right][data-state=closed]{animation-name:slideToRight}[data-vaul-drawer][data-vaul-snap-points=true][data-vaul-drawer-direction=bottom]{transform:translate3d(0,var(--initial-transform,100%),0)}[data-vaul-drawer][data-vaul-snap-points=true][data-vaul-drawer-direction=top]{transform:translate3d(0,calc(var(--initial-transform,100%) * -1),0)}[data-vaul-drawer][data-vaul-snap-points=true][data-vaul-drawer-direction=left]{transform:translate3d(calc(var(--initial-transform,100%) * -1),0,0)}[data-vaul-drawer][data-vaul-snap-points=true][data-vaul-drawer-direction=right]{transform:translate3d(var(--initial-transform,100%),0,0)}[data-vaul-drawer][data-vaul-delayed-snap-points=true][data-vaul-drawer-direction=top]{transform:translate3d(0,var(--snap-point-height,0),0)}[data-vaul-drawer][data-vaul-delayed-snap-points=true][data-vaul-drawer-direction=bottom]{transform:translate3d(0,var(--snap-point-height,0),0)}[data-vaul-drawer][data-vaul-delayed-snap-points=true][data-vaul-drawer-direction=left]{transform:translate3d(var(--snap-point-height,0),0,0)}[data-vaul-drawer][data-vaul-delayed-snap-points=true][data-vaul-drawer-direction=right]{transform:translate3d(var(--snap-point-height,0),0,0)}[data-vaul-overlay][data-vaul-snap-points=false]{animation-duration:.5s;animation-timing-function:cubic-bezier(0.32,0.72,0,1)}[data-vaul-overlay][data-vaul-snap-points=false][data-state=open]{animation-name:fadeIn}[data-vaul-overlay][data-state=closed]{animation-name:fadeOut}[data-vaul-animate=false]{animation:none!important}[data-vaul-overlay][data-vaul-snap-points=true]{opacity:0;transition:opacity .5s cubic-bezier(.32, .72, 0, 1)}[data-vaul-overlay][data-vaul-snap-points=true]{opacity:1}[data-vaul-drawer]:not([data-vaul-custom-container=true])::after{content:'';position:absolute;background:inherit;background-color:inherit}[data-vaul-drawer][data-vaul-drawer-direction=top]::after{top:initial;bottom:100%;left:0;right:0;height:200%}[data-vaul-drawer][data-vaul-drawer-direction=bottom]::after{top:100%;bottom:initial;left:0;right:0;height:200%}[data-vaul-drawer][data-vaul-drawer-direction=left]::after{left:initial;right:100%;top:0;bottom:0;width:200%}[data-vaul-drawer][data-vaul-drawer-direction=right]::after{left:100%;right:initial;top:0;bottom:0;width:200%}[data-vaul-overlay][data-vaul-snap-points=true]:not([data-vaul-snap-points-overlay=true]):not(
[data-state=closed]
){opacity:0}[data-vaul-overlay][data-vaul-snap-points-overlay=true]{opacity:1}[data-vaul-handle]{display:block;position:relative;opacity:.7;background:#e2e2e4;margin-left:auto;margin-right:auto;height:5px;width:32px;border-radius:1rem;touch-action:pan-y}[data-vaul-handle]:active,[data-vaul-handle]:hover{opacity:1}[data-vaul-handle-hitarea]{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);width:max(100%,2.75rem);height:max(100%,2.75rem);touch-action:inherit}@media (hover:hover) and (pointer:fine){[data-vaul-drawer]{user-select:none}}@media (pointer:fine){[data-vaul-handle-hitarea]:{width:100%;height:100%}}@keyframes fadeIn{from{opacity:0}to{opacity:1}}@keyframes fadeOut{to{opacity:0}}@keyframes slideFromBottom{from{transform:translate3d(0,var(--initial-transform,100%),0)}to{transform:translate3d(0,0,0)}}@keyframes slideToBottom{to{transform:translate3d(0,var(--initial-transform,100%),0)}}@keyframes slideFromTop{from{transform:translate3d(0,calc(var(--initial-transform,100%) * -1),0)}to{transform:translate3d(0,0,0)}}@keyframes slideToTop{to{transform:translate3d(0,calc(var(--initial-transform,100%) * -1),0)}}@keyframes slideFromLeft{from{transform:translate3d(calc(var(--initial-transform,100%) * -1),0,0)}to{transform:translate3d(0,0,0)}}@keyframes slideToLeft{to{transform:translate3d(calc(var(--initial-transform,100%) * -1),0,0)}}@keyframes slideFromRight{from{transform:translate3d(var(--initial-transform,100%),0,0)}to{transform:translate3d(0,0,0)}}@keyframes slideToRight{to{transform:translate3d(var(--initial-transform,100%),0,0)}}`);function vs(){const t=navigator.userAgent;return typeof window<"u"&&(/Firefox/.test(t)&&/Mobile/.test(t)||/FxiOS/.test(t))}function ys(){return zt(/^Mac/)}function bs(){return zt(/^iPhone/)}function Xt(){return/^((?!chrome|android).)*safari/i.test(navigator.userAgent)}function ws(){return zt(/^iPad/)||ys()&&navigator.maxTouchPoints>1}function on(){return bs()||ws()}function zt(t){return typeof window<"u"&&window.navigator!=null?t.test(window.navigator.platform):void 0}const js=24,Ns=typeof window<"u"?m.useLayoutEffect:m.useEffect;function Gt(...t){return(...s)=>{for(let r of t)typeof r=="function"&&r(...s)}}const _t=typeof document<"u"&&window.visualViewport;function Jt(t){let s=window.getComputedStyle(t);return/(auto|scroll)/.test(s.overflow+s.overflowX+s.overflowY)}function ln(t){for(Jt(t)&&(t=t.parentElement);t&&!Jt(t);)t=t.parentElement;return t||document.scrollingElement||document.documentElement}const Ss=new Set(["checkbox","radio","range","color","file","image","button","submit","reset"]);let gt=0,Ct;function _s(t={}){let{isDisabled:s}=t;Ns(()=>{if(!s)return gt++,gt===1&&on()&&(Ct=Cs()),()=>{gt--,gt===0&&Ct?.()}},[s])}function Cs(){let t,s=0,r=R=>{t=ln(R.target),!(t===document.documentElement&&t===document.body)&&(s=R.changedTouches[0].pageY)},o=R=>{if(!t||t===document.documentElement||t===document.body){R.preventDefault();return}let y=R.changedTouches[0].pageY,H=t.scrollTop,q=t.scrollHeight-t.clientHeight;q!==0&&((H<=0&&y>s||H>=q&&y<s)&&R.preventDefault(),s=y)},c=R=>{let y=R.target;Ft(y)&&y!==document.activeElement&&(R.preventDefault(),y.style.transform="translateY(-2000px)",y.focus(),requestAnimationFrame(()=>{y.style.transform=""}))},l=R=>{let y=R.target;Ft(y)&&(y.style.transform="translateY(-2000px)",requestAnimationFrame(()=>{y.style.transform="",_t&&(_t.height<window.innerHeight?requestAnimationFrame(()=>{Zt(y)}):_t.addEventListener("resize",()=>Zt(y),{once:!0}))}))},h=()=>{window.scrollTo(0,0)},x=window.pageXOffset,u=window.pageYOffset,T=Gt(Rs(document.documentElement,"paddingRight",`${window.innerWidth-document.documentElement.clientWidth}px`));window.scrollTo(0,0);let v=Gt(ot(document,"touchstart",r,{passive:!1,capture:!0}),ot(document,"touchmove",o,{passive:!1,capture:!0}),ot(document,"touchend",c,{passive:!1,capture:!0}),ot(document,"focus",l,!0),ot(window,"scroll",h));return()=>{T(),v(),window.scrollTo(x,u)}}function Rs(t,s,r){let o=t.style[s];return t.style[s]=r,()=>{t.style[s]=o}}function ot(t,s,r,o){return t.addEventListener(s,r,o),()=>{t.removeEventListener(s,r,o)}}function Zt(t){let s=document.scrollingElement||document.documentElement;for(;t&&t!==s;){let r=ln(t);if(r!==document.documentElement&&r!==document.body&&r!==t){let o=r.getBoundingClientRect().top,c=t.getBoundingClientRect().top,l=t.getBoundingClientRect().bottom;const h=r.getBoundingClientRect().bottom+js;l>h&&(r.scrollTop+=c-o)}t=r.parentElement}}function Ft(t){return t instanceof HTMLInputElement&&!Ss.has(t.type)||t instanceof HTMLTextAreaElement||t instanceof HTMLElement&&t.isContentEditable}function Es(t,s){typeof t=="function"?t(s):t!=null&&(t.current=s)}function ks(...t){return s=>t.forEach(r=>Es(r,s))}function cn(...t){return m.useCallback(ks(...t),t)}const dn=new WeakMap;function ne(t,s,r=!1){if(!t||!(t instanceof HTMLElement))return;let o={};Object.entries(s).forEach(([c,l])=>{if(c.startsWith("--")){t.style.setProperty(c,l);return}o[c]=t.style[c],t.style[c]=l}),!r&&dn.set(t,o)}function Ts(t,s){if(!t||!(t instanceof HTMLElement))return;let r=dn.get(t);r&&(t.style[s]=r[s])}const ee=t=>{switch(t){case"top":case"bottom":return!0;case"left":case"right":return!1;default:return t}};function vt(t,s){if(!t)return null;const r=window.getComputedStyle(t),o=r.transform||r.webkitTransform||r.mozTransform;let c=o.match(/^matrix3d\((.+)\)$/);return c?parseFloat(c[1].split(", ")[ee(s)?13:12]):(c=o.match(/^matrix\((.+)\)$/),c?parseFloat(c[1].split(", ")[ee(s)?5:4]):null)}function Ds(t){return 8*(Math.log(t+1)-2)}function Rt(t,s){if(!t)return()=>{};const r=t.style.cssText;return Object.assign(t.style,s),()=>{t.style.cssText=r}}function Ms(...t){return(...s)=>{for(const r of t)typeof r=="function"&&r(...s)}}const Q={DURATION:.5,EASE:[.32,.72,0,1]},un=.4,As=.25,Is=100,mn=8,Ke=16,Ht=26,Et="vaul-dragging";function fn(t){const s=d.useRef(t);return d.useEffect(()=>{s.current=t}),d.useMemo(()=>(...r)=>s.current==null?void 0:s.current.call(s,...r),[])}function Os({defaultProp:t,onChange:s}){const r=d.useState(t),[o]=r,c=d.useRef(o),l=fn(s);return d.useEffect(()=>{c.current!==o&&(l(o),c.current=o)},[o,c,l]),r}function pn({prop:t,defaultProp:s,onChange:r=()=>{}}){const[o,c]=Os({defaultProp:s,onChange:r}),l=t!==void 0,h=l?t:o,x=fn(r),u=d.useCallback(T=>{if(l){const R=typeof T=="function"?T(t):T;R!==t&&x(R)}else c(T)},[l,t,c,x]);return[h,u]}function $s({activeSnapPointProp:t,setActiveSnapPointProp:s,snapPoints:r,drawerRef:o,overlayRef:c,fadeFromIndex:l,onSnapPointChange:h,direction:x="bottom",container:u,snapToSequentialPoint:T}){const[v,R]=pn({prop:t,defaultProp:r?.[0],onChange:s}),[y,H]=d.useState(typeof window<"u"?{innerWidth:window.innerWidth,innerHeight:window.innerHeight}:void 0);d.useEffect(()=>{function S(){H({innerWidth:window.innerWidth,innerHeight:window.innerHeight})}return window.addEventListener("resize",S),()=>window.removeEventListener("resize",S)},[]);const q=d.useMemo(()=>v===r?.[r.length-1]||null,[r,v]),M=d.useMemo(()=>{var S;return(S=r?.findIndex(A=>A===v))!=null?S:null},[r,v]),Y=r&&r.length>0&&(l||l===0)&&!Number.isNaN(l)&&r[l]===v||!r,b=d.useMemo(()=>{const S=u?{width:u.getBoundingClientRect().width,height:u.getBoundingClientRect().height}:typeof window<"u"?{width:window.innerWidth,height:window.innerHeight}:{width:0,height:0};var A;return(A=r?.map(I=>{const $=typeof I=="string";let G=0;if($&&(G=parseInt(I,10)),ee(x)){const p=$?G:y?I*S.height:0;return y?x==="bottom"?S.height-p:-S.height+p:p}const z=$?G:y?I*S.width:0;return y?x==="right"?S.width-z:-S.width+z:z}))!=null?A:[]},[r,y,u]),k=d.useMemo(()=>M!==null?b?.[M]:null,[b,M]),O=d.useCallback(S=>{var A;const I=(A=b?.findIndex($=>$===S))!=null?A:null;h(I),ne(o.current,{transition:`transform ${Q.DURATION}s cubic-bezier(${Q.EASE.join(",")})`,transform:ee(x)?`translate3d(0, ${S}px, 0)`:`translate3d(${S}px, 0, 0)`}),b&&I!==b.length-1&&l!==void 0&&I!==l&&I<l?ne(c.current,{transition:`opacity ${Q.DURATION}s cubic-bezier(${Q.EASE.join(",")})`,opacity:"0"}):ne(c.current,{transition:`opacity ${Q.DURATION}s cubic-bezier(${Q.EASE.join(",")})`,opacity:"1"}),R(r?.[Math.max(I,0)])},[o.current,r,b,l,c,R]);d.useEffect(()=>{if(v||t){var S;const A=(S=r?.findIndex(I=>I===t||I===v))!=null?S:-1;b&&A!==-1&&typeof b[A]=="number"&&O(b[A])}},[v,t,r,b,O]);function w({draggedDistance:S,closeDrawer:A,velocity:I,dismissible:$}){if(l===void 0)return;const G=x==="bottom"||x==="right"?(k??0)-S:(k??0)+S,z=M===l-1,p=M===0,V=S>0;if(z&&ne(c.current,{transition:`opacity ${Q.DURATION}s cubic-bezier(${Q.EASE.join(",")})`}),!T&&I>2&&!V){$?A():O(b[0]);return}if(!T&&I>2&&V&&b&&r){O(b[r.length-1]);return}const W=b?.reduce((B,K)=>typeof B!="number"||typeof K!="number"?B:Math.abs(K-G)<Math.abs(B-G)?K:B),X=ee(x)?window.innerHeight:window.innerWidth;if(I>un&&Math.abs(S)<X*.4){const B=V?1:-1;if(B>0&&q&&r){O(b[r.length-1]);return}if(p&&B<0&&$&&A(),M===null)return;O(b[M+B]);return}O(W)}function te({draggedDistance:S}){if(k===null)return;const A=x==="bottom"||x==="right"?k-S:k+S;(x==="bottom"||x==="right")&&A<b[b.length-1]||(x==="top"||x==="left")&&A>b[b.length-1]||ne(o.current,{transform:ee(x)?`translate3d(0, ${A}px, 0)`:`translate3d(${A}px, 0, 0)`})}function oe(S,A){if(!r||typeof M!="number"||!b||l===void 0)return null;const I=M===l-1;if(M>=l&&A)return 0;if(I&&!A)return 1;if(!Y&&!I)return null;const G=I?M+1:M-1,z=I?b[G]-b[G-1]:b[G+1]-b[G],p=S/Math.abs(z);return I?1-p:p}return{isLastSnapPoint:q,activeSnapPoint:v,shouldFade:Y,getPercentageDragged:oe,setActiveSnapPoint:R,activeSnapPointIndex:M,onRelease:w,onDrag:te,snapPointsOffset:b}}const Ps=()=>()=>{};function Ls(){const{direction:t,isOpen:s,shouldScaleBackground:r,setBackgroundColorOnScale:o,noBodyStyles:c}=mt(),l=d.useRef(null),h=m.useMemo(()=>document.body.style.backgroundColor,[]);function x(){return(window.innerWidth-Ht)/window.innerWidth}d.useEffect(()=>{if(s&&r){l.current&&clearTimeout(l.current);const u=document.querySelector("[data-vaul-drawer-wrapper]")||document.querySelector("[vaul-drawer-wrapper]");if(!u)return;Ms(o&&!c?Rt(document.body,{background:"black"}):Ps,Rt(u,{transformOrigin:ee(t)?"top":"left",transitionProperty:"transform, border-radius",transitionDuration:`${Q.DURATION}s`,transitionTimingFunction:`cubic-bezier(${Q.EASE.join(",")})`}));const T=Rt(u,{borderRadius:`${mn}px`,overflow:"hidden",...ee(t)?{transform:`scale(${x()}) translate3d(0, calc(env(safe-area-inset-top) + 14px), 0)`}:{transform:`scale(${x()}) translate3d(calc(env(safe-area-inset-top) + 14px), 0, 0)`}});return()=>{T(),l.current=window.setTimeout(()=>{h?document.body.style.background=h:document.body.style.removeProperty("background")},Q.DURATION*1e3)}}},[s,r,h])}let lt=null;function Fs({isOpen:t,modal:s,nested:r,hasBeenOpened:o,preventScrollRestoration:c,noBodyStyles:l}){const[h,x]=d.useState(()=>typeof window<"u"?window.location.href:""),u=d.useRef(0),T=d.useCallback(()=>{if(Xt()&&lt===null&&t&&!l){lt={position:document.body.style.position,top:document.body.style.top,left:document.body.style.left,height:document.body.style.height,right:"unset"};const{scrollX:R,innerHeight:y}=window;document.body.style.setProperty("position","fixed","important"),Object.assign(document.body.style,{top:`${-u.current}px`,left:`${-R}px`,right:"0px",height:"auto"}),window.setTimeout(()=>window.requestAnimationFrame(()=>{const H=y-window.innerHeight;H&&u.current>=y&&(document.body.style.top=`${-(u.current+H)}px`)}),300)}},[t]),v=d.useCallback(()=>{if(Xt()&&lt!==null&&!l){const R=-parseInt(document.body.style.top,10),y=-parseInt(document.body.style.left,10);Object.assign(document.body.style,lt),window.requestAnimationFrame(()=>{if(c&&h!==window.location.href){x(window.location.href);return}window.scrollTo(y,R)}),lt=null}},[h]);return d.useEffect(()=>{function R(){u.current=window.scrollY}return R(),window.addEventListener("scroll",R),()=>{window.removeEventListener("scroll",R)}},[]),d.useEffect(()=>{if(s)return()=>{typeof document>"u"||document.querySelector("[data-vaul-drawer]")||v()}},[s,v]),d.useEffect(()=>{r||!o||(t?(!window.matchMedia("(display-mode: standalone)").matches&&T(),s||window.setTimeout(()=>{v()},500)):v())},[t,o,h,s,r,T,v]),{restorePositionSetting:v}}function Hs({open:t,onOpenChange:s,children:r,onDrag:o,onRelease:c,snapPoints:l,shouldScaleBackground:h=!1,setBackgroundColorOnScale:x=!0,closeThreshold:u=As,scrollLockTimeout:T=Is,dismissible:v=!0,handleOnly:R=!1,fadeFromIndex:y=l&&l.length-1,activeSnapPoint:H,setActiveSnapPoint:q,fixed:M,modal:Y=!0,onClose:b,nested:k,noBodyStyles:O=!1,direction:w="bottom",defaultOpen:te=!1,disablePreventScroll:oe=!0,snapToSequentialPoint:S=!1,preventScrollRestoration:A=!1,repositionInputs:I=!0,onAnimationEnd:$,container:G,autoFocus:z=!1}){var p,V;const[W=!1,X]=pn({defaultProp:te,prop:t,onChange:g=>{s?.(g),!g&&!k&&st(),setTimeout(()=>{$?.(g)},Q.DURATION*1e3),g&&!Y&&typeof window<"u"&&window.requestAnimationFrame(()=>{document.body.style.pointerEvents="auto"}),g||(document.body.style.pointerEvents="auto")}}),[B,K]=d.useState(!1),[re,Ne]=d.useState(!1),[ae,Re]=d.useState(!1),me=d.useRef(null),Se=d.useRef(null),Le=d.useRef(null),ze=d.useRef(null),Ee=d.useRef(null),De=d.useRef(!1),F=d.useRef(null),ye=d.useRef(0),xe=d.useRef(!1),Be=d.useRef(!te),_e=d.useRef(0),_=d.useRef(null),ge=d.useRef(((p=_.current)==null?void 0:p.getBoundingClientRect().height)||0),J=d.useRef(((V=_.current)==null?void 0:V.getBoundingClientRect().width)||0),le=d.useRef(0),be=d.useCallback(g=>{l&&g===Me.length-1&&(Se.current=new Date)},[]),{activeSnapPoint:nt,activeSnapPointIndex:ce,setActiveSnapPoint:Fe,onRelease:He,snapPointsOffset:Me,onDrag:qe,shouldFade:fe,getPercentageDragged:Ve}=$s({snapPoints:l,activeSnapPointProp:H,setActiveSnapPointProp:q,drawerRef:_,fadeFromIndex:y,overlayRef:me,onSnapPointChange:be,direction:w,container:G,snapToSequentialPoint:S});_s({isDisabled:!W||re||!Y||ae||!B||!I||!oe});const{restorePositionSetting:st}=Fs({isOpen:W,modal:Y,nested:k??!1,hasBeenOpened:B,preventScrollRestoration:A,noBodyStyles:O});function Ce(){return(window.innerWidth-Ht)/window.innerWidth}function we(g){var n,i;!v&&!l||_.current&&!_.current.contains(g.target)||(ge.current=((n=_.current)==null?void 0:n.getBoundingClientRect().height)||0,J.current=((i=_.current)==null?void 0:i.getBoundingClientRect().width)||0,Ne(!0),Le.current=new Date,on()&&window.addEventListener("touchend",()=>De.current=!1,{once:!0}),g.target.setPointerCapture(g.pointerId),ye.current=ee(w)?g.pageY:g.pageX)}function Ue(g,n){var i;let f=g;const N=(i=window.getSelection())==null?void 0:i.toString(),D=_.current?vt(_.current,w):null,P=new Date;if(f.tagName==="SELECT"||f.hasAttribute("data-vaul-no-drag")||f.closest("[data-vaul-no-drag]"))return!1;if(w==="right"||w==="left")return!0;if(Se.current&&P.getTime()-Se.current.getTime()<500)return!1;if(D!==null&&(w==="bottom"?D>0:D<0))return!0;if(N&&N.length>0)return!1;if(Ee.current&&P.getTime()-Ee.current.getTime()<T&&D===0||n)return Ee.current=P,!1;for(;f;){if(f.scrollHeight>f.clientHeight){if(f.scrollTop!==0)return Ee.current=new Date,!1;if(f.getAttribute("role")==="dialog")return!0}f=f.parentNode}return!0}function se(g){if(_.current&&re){const n=w==="bottom"||w==="right"?1:-1,i=(ye.current-(ee(w)?g.pageY:g.pageX))*n,f=i>0,N=l&&!v&&!f;if(N&&ce===0)return;const D=Math.abs(i),P=document.querySelector("[data-vaul-drawer-wrapper]"),pe=w==="bottom"||w==="top"?ge.current:J.current;let ie=D/pe;const he=Ve(D,f);if(he!==null&&(ie=he),N&&ie>=1||!De.current&&!Ue(g.target,f))return;if(_.current.classList.add(Et),De.current=!0,ne(_.current,{transition:"none"}),ne(me.current,{transition:"none"}),l&&qe({draggedDistance:i}),f&&!l){const de=Ds(i),Ae=Math.min(de*-1,0)*n;ne(_.current,{transform:ee(w)?`translate3d(0, ${Ae}px, 0)`:`translate3d(${Ae}px, 0, 0)`});return}const ve=1-ie;if((fe||y&&ce===y-1)&&(o?.(g,ie),ne(me.current,{opacity:`${ve}`,transition:"none"},!0)),P&&me.current&&h){const de=Math.min(Ce()+ie*(1-Ce()),1),Ae=8-ie*8,We=Math.max(0,14-ie*14);ne(P,{borderRadius:`${Ae}px`,transform:ee(w)?`scale(${de}) translate3d(0, ${We}px, 0)`:`scale(${de}) translate3d(${We}px, 0, 0)`,transition:"none"},!0)}if(!l){const de=D*n;ne(_.current,{transform:ee(w)?`translate3d(0, ${de}px, 0)`:`translate3d(${de}px, 0, 0)`})}}}d.useEffect(()=>{window.requestAnimationFrame(()=>{Be.current=!0})},[]),d.useEffect(()=>{var g;function n(){if(!_.current||!I)return;const i=document.activeElement;if(Ft(i)||xe.current){var f;const N=((f=window.visualViewport)==null?void 0:f.height)||0,D=window.innerHeight;let P=D-N;const pe=_.current.getBoundingClientRect().height||0,ie=pe>D*.8;le.current||(le.current=pe);const he=_.current.getBoundingClientRect().top;if(Math.abs(_e.current-P)>60&&(xe.current=!xe.current),l&&l.length>0&&Me&&ce){const ve=Me[ce]||0;P+=ve}if(_e.current=P,pe>N||xe.current){const ve=_.current.getBoundingClientRect().height;let de=ve;ve>N&&(de=N-(ie?he:Ht)),M?_.current.style.height=`${ve-Math.max(P,0)}px`:_.current.style.height=`${Math.max(de,N-he)}px`}else vs()||(_.current.style.height=`${le.current}px`);l&&l.length>0&&!xe.current?_.current.style.bottom="0px":_.current.style.bottom=`${Math.max(P,0)}px`}}return(g=window.visualViewport)==null||g.addEventListener("resize",n),()=>{var i;return(i=window.visualViewport)==null?void 0:i.removeEventListener("resize",n)}},[ce,l,Me]);function ke(g){Z(),b?.(),g||X(!1),setTimeout(()=>{l&&Fe(l[0])},Q.DURATION*1e3)}function C(){if(!_.current)return;const g=document.querySelector("[data-vaul-drawer-wrapper]"),n=vt(_.current,w);ne(_.current,{transform:"translate3d(0, 0, 0)",transition:`transform ${Q.DURATION}s cubic-bezier(${Q.EASE.join(",")})`}),ne(me.current,{transition:`opacity ${Q.DURATION}s cubic-bezier(${Q.EASE.join(",")})`,opacity:"1"}),h&&n&&n>0&&W&&ne(g,{borderRadius:`${mn}px`,overflow:"hidden",...ee(w)?{transform:`scale(${Ce()}) translate3d(0, calc(env(safe-area-inset-top) + 14px), 0)`,transformOrigin:"top"}:{transform:`scale(${Ce()}) translate3d(calc(env(safe-area-inset-top) + 14px), 0, 0)`,transformOrigin:"left"},transitionProperty:"transform, border-radius",transitionDuration:`${Q.DURATION}s`,transitionTimingFunction:`cubic-bezier(${Q.EASE.join(",")})`},!0)}function Z(){!re||!_.current||(_.current.classList.remove(Et),De.current=!1,Ne(!1),ze.current=new Date)}function Ge(g){if(!re||!_.current)return;_.current.classList.remove(Et),De.current=!1,Ne(!1),ze.current=new Date;const n=vt(_.current,w);if(!g||!Ue(g.target,!1)||!n||Number.isNaN(n)||Le.current===null)return;const i=ze.current.getTime()-Le.current.getTime(),f=ye.current-(ee(w)?g.pageY:g.pageX),N=Math.abs(f)/i;if(N>.05&&(Re(!0),setTimeout(()=>{Re(!1)},200)),l){He({draggedDistance:f*(w==="bottom"||w==="right"?1:-1),closeDrawer:ke,velocity:N,dismissible:v}),c?.(g,!0);return}if(w==="bottom"||w==="right"?f>0:f<0){C(),c?.(g,!0);return}if(N>un){ke(),c?.(g,!1);return}var D;const P=Math.min((D=_.current.getBoundingClientRect().height)!=null?D:0,window.innerHeight);var pe;const ie=Math.min((pe=_.current.getBoundingClientRect().width)!=null?pe:0,window.innerWidth),he=w==="left"||w==="right";if(Math.abs(n)>=(he?ie:P)*u){ke(),c?.(g,!1);return}c?.(g,!0),C()}d.useEffect(()=>(W&&(ne(document.documentElement,{scrollBehavior:"auto"}),Se.current=new Date),()=>{Ts(document.documentElement,"scrollBehavior")}),[W]);function rt(g){const n=g?(window.innerWidth-Ke)/window.innerWidth:1,i=g?-Ke:0;F.current&&window.clearTimeout(F.current),ne(_.current,{transition:`transform ${Q.DURATION}s cubic-bezier(${Q.EASE.join(",")})`,transform:ee(w)?`scale(${n}) translate3d(0, ${i}px, 0)`:`scale(${n}) translate3d(${i}px, 0, 0)`}),!g&&_.current&&(F.current=setTimeout(()=>{const f=vt(_.current,w);ne(_.current,{transition:"none",transform:ee(w)?`translate3d(0, ${f}px, 0)`:`translate3d(${f}px, 0, 0)`})},500))}function Je(g,n){if(n<0)return;const i=(window.innerWidth-Ke)/window.innerWidth,f=i+n*(1-i),N=-Ke+n*Ke;ne(_.current,{transform:ee(w)?`scale(${f}) translate3d(0, ${N}px, 0)`:`scale(${f}) translate3d(${N}px, 0, 0)`,transition:"none"})}function Te(g,n){const i=ee(w)?window.innerHeight:window.innerWidth,f=n?(i-Ke)/i:1,N=n?-Ke:0;n&&ne(_.current,{transition:`transform ${Q.DURATION}s cubic-bezier(${Q.EASE.join(",")})`,transform:ee(w)?`scale(${f}) translate3d(0, ${N}px, 0)`:`scale(${f}) translate3d(${N}px, 0, 0)`})}return d.useEffect(()=>{Y||window.requestAnimationFrame(()=>{document.body.style.pointerEvents="auto"})},[Y]),d.createElement(Mn,{defaultOpen:te,onOpenChange:g=>{!v&&!g||(g?K(!0):ke(!0),X(g))},open:W},d.createElement(an.Provider,{value:{activeSnapPoint:nt,snapPoints:l,setActiveSnapPoint:Fe,drawerRef:_,overlayRef:me,onOpenChange:s,onPress:we,onRelease:Ge,onDrag:se,dismissible:v,shouldAnimate:Be,handleOnly:R,isOpen:W,isDragging:re,shouldFade:fe,closeDrawer:ke,onNestedDrag:Je,onNestedOpenChange:rt,onNestedRelease:Te,keyboardIsOpen:xe,modal:Y,snapPointsOffset:Me,activeSnapPointIndex:ce,direction:w,shouldScaleBackground:h,setBackgroundColorOnScale:x,noBodyStyles:O,container:G,autoFocus:z}},r))}const hn=d.forwardRef(function({...t},s){const{overlayRef:r,snapPoints:o,onRelease:c,shouldFade:l,isOpen:h,modal:x,shouldAnimate:u}=mt(),T=cn(s,r),v=o&&o.length>0;if(!x)return null;const R=d.useCallback(y=>c(y),[c]);return d.createElement(On,{onMouseUp:R,ref:T,"data-vaul-overlay":"","data-vaul-snap-points":h&&v?"true":"false","data-vaul-snap-points-overlay":h&&l?"true":"false","data-vaul-animate":u?.current?"true":"false",...t})});hn.displayName="Drawer.Overlay";const xn=d.forwardRef(function({onPointerDownOutside:t,style:s,onOpenAutoFocus:r,...o},c){const{drawerRef:l,onPress:h,onRelease:x,onDrag:u,keyboardIsOpen:T,snapPointsOffset:v,activeSnapPointIndex:R,modal:y,isOpen:H,direction:q,snapPoints:M,container:Y,handleOnly:b,shouldAnimate:k,autoFocus:O}=mt(),[w,te]=d.useState(!1),oe=cn(c,l),S=d.useRef(null),A=d.useRef(null),I=d.useRef(!1),$=M&&M.length>0;Ls();const G=(p,V,W=0)=>{if(I.current)return!0;const X=Math.abs(p.y),B=Math.abs(p.x),K=B>X,re=["bottom","right"].includes(V)?1:-1;if(V==="left"||V==="right"){if(!(p.x*re<0)&&B>=0&&B<=W)return K}else if(!(p.y*re<0)&&X>=0&&X<=W)return!K;return I.current=!0,!0};d.useEffect(()=>{$&&window.requestAnimationFrame(()=>{te(!0)})},[]);function z(p){S.current=null,I.current=!1,x(p)}return d.createElement(In,{"data-vaul-drawer-direction":q,"data-vaul-drawer":"","data-vaul-delayed-snap-points":w?"true":"false","data-vaul-snap-points":H&&$?"true":"false","data-vaul-custom-container":Y?"true":"false","data-vaul-animate":k?.current?"true":"false",...o,ref:oe,style:v&&v.length>0?{"--snap-point-height":`${v[R??0]}px`,...s}:s,onPointerDown:p=>{b||(o.onPointerDown==null||o.onPointerDown.call(o,p),S.current={x:p.pageX,y:p.pageY},h(p))},onOpenAutoFocus:p=>{r?.(p),O||p.preventDefault()},onPointerDownOutside:p=>{if(t?.(p),!y||p.defaultPrevented){p.preventDefault();return}T.current&&(T.current=!1)},onFocusOutside:p=>{if(!y){p.preventDefault();return}},onPointerMove:p=>{if(A.current=p,b||(o.onPointerMove==null||o.onPointerMove.call(o,p),!S.current))return;const V=p.pageY-S.current.y,W=p.pageX-S.current.x,X=p.pointerType==="touch"?10:2;G({x:W,y:V},q,X)?u(p):(Math.abs(W)>X||Math.abs(V)>X)&&(S.current=null)},onPointerUp:p=>{o.onPointerUp==null||o.onPointerUp.call(o,p),S.current=null,I.current=!1,x(p)},onPointerOut:p=>{o.onPointerOut==null||o.onPointerOut.call(o,p),z(A.current)},onContextMenu:p=>{o.onContextMenu==null||o.onContextMenu.call(o,p),A.current&&z(A.current)}})});xn.displayName="Drawer.Content";const zs=250,Bs=120,qs=d.forwardRef(function({preventCycle:t=!1,children:s,...r},o){const{closeDrawer:c,isDragging:l,snapPoints:h,activeSnapPoint:x,setActiveSnapPoint:u,dismissible:T,handleOnly:v,isOpen:R,onPress:y,onDrag:H}=mt(),q=d.useRef(null),M=d.useRef(!1);function Y(){if(M.current){O();return}window.setTimeout(()=>{b()},Bs)}function b(){if(l||t||M.current){O();return}if(O(),!h||h.length===0){T||c();return}if(x===h[h.length-1]&&T){c();return}const te=h.findIndex(S=>S===x);if(te===-1)return;const oe=h[te+1];u(oe)}function k(){q.current=window.setTimeout(()=>{M.current=!0},zs)}function O(){q.current&&window.clearTimeout(q.current),M.current=!1}return d.createElement("div",{onClick:Y,onPointerCancel:O,onPointerDown:w=>{v&&y(w),k()},onPointerMove:w=>{v&&H(w)},ref:o,"data-vaul-drawer-visible":R?"true":"false","data-vaul-handle":"","aria-hidden":"true",...r},d.createElement("span",{"data-vaul-handle-hitarea":"","aria-hidden":"true"},s))});qs.displayName="Drawer.Handle";function Vs(t){const s=mt(),{container:r=s.container,...o}=t;return d.createElement(An,{container:r,...o})}const Pe={Root:Hs,Content:xn,Overlay:hn,Portal:Vs,Title:Tn,Description:Dn},gn=({shouldScaleBackground:t=!0,...s})=>e.jsx(Pe.Root,{shouldScaleBackground:t,...s});gn.displayName="Drawer";const Us=Pe.Portal,vn=m.forwardRef(({className:t,...s},r)=>e.jsx(Pe.Overlay,{ref:r,className:ue("fixed inset-0 z-50 bg-black/80",t),...s}));vn.displayName=Pe.Overlay.displayName;const yn=m.forwardRef(({className:t,children:s,...r},o)=>e.jsxs(Us,{children:[e.jsx(vn,{}),e.jsxs(Pe.Content,{ref:o,className:ue("fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background",t),...r,children:[e.jsx("div",{className:"mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted"}),s]})]}));yn.displayName="DrawerContent";const bn=({className:t,...s})=>e.jsx("div",{className:ue("grid gap-1.5 p-4 text-center sm:text-left",t),...s});bn.displayName="DrawerHeader";const wn=m.forwardRef(({className:t,...s},r)=>e.jsx(Pe.Title,{ref:r,className:ue("text-lg font-semibold leading-none tracking-tight",t),...s}));wn.displayName=Pe.Title.displayName;const jn=m.forwardRef(({className:t,...s},r)=>e.jsx(Pe.Description,{ref:r,className:ue("text-sm text-muted-foreground",t),...s}));jn.displayName=Pe.Description.displayName;function Nn({children:t,className:s,containerClassName:r}){return e.jsx("div",{role:"region","aria-label":"Actions",className:ue("fixed bottom-16 left-0 right-0 z-bar md:bottom-0 md:z-bar",s),children:e.jsx("div",{className:ue("mx-auto flex w-full max-w-md items-center justify-between gap-2 border-t bg-background px-4 py-3 shadow-[0_-2px_10px_rgba(0,0,0,0.1)]","md:supports-[padding:env(safe-area-inset-bottom)]:pb-[calc(env(safe-area-inset-bottom)+0.75rem)]",r),children:t})})}const Ws=[1,2,3,4,5];function en({value:t,onChange:s,className:r,disabled:o=!1,size:c="md",ariaLabel:l="Sélecteur d'échelle 1 à 5"}){const h=c==="sm"?"h-10 w-10 text-xs":"h-11 w-11 text-sm";return e.jsx("div",{className:ue("flex items-center gap-2",r),role:"group","aria-label":l,children:Ws.map(x=>{const u=t===x;return e.jsx("button",{type:"button",className:ue("flex items-center justify-center rounded-full border font-semibold transition",h,u?"border-primary bg-primary text-primary-foreground":"border-muted-foreground/30 bg-background text-foreground",o&&"opacity-60"),"aria-pressed":u,disabled:o,onClick:()=>{o||s?.(x)},children:x},x)})})}const tn=()=>{try{const t=new(window.AudioContext||window.webkitAudioContext),s=t.createOscillator(),r=t.createGain();s.connect(r),r.connect(t.destination),s.frequency.value=880,r.gain.value=.3,s.start(),s.stop(t.currentTime+.25);const o=t.createOscillator(),c=t.createGain();o.connect(c),c.connect(t.destination),o.frequency.value=1100,c.gain.value=.3,o.start(t.currentTime+.35),o.stop(t.currentTime+.6),o.onended=()=>t.close()}catch{}try{navigator.vibrate?.([200,100,200])}catch{}},bt=(t,s)=>{const r=Number(t?.set_index??t?.set_number??t?.setIndex??s);return!Number.isFinite(r)||r<=0?s:r},Sn=(t=[],s,r)=>{if(!t.length)return 0;const o=Array.isArray(s)?s:[];if(o.length>0){const h=new Map;o.forEach((u,T)=>{if(!u?.exercise_id)return;const v=h.get(u.exercise_id)??[];v.push({...u,set_index:bt(u,T+1)}),h.set(u.exercise_id,v)});let x=t.length+1;for(let u=0;u<t.length;u+=1){const T=t[u];if((h.get(T.exercise_id)??[]).length<(T.sets??0)){x=u+1;break}}return x}const c=Number(r??0);if(!Number.isFinite(c)||c<=0)return 0;const l=Math.min(t.length,Math.max(0,Math.round(c/100*t.length)));return Math.min(t.length,l+1)},$e=(t,s)=>{const r=Number(t);return!Number.isFinite(r)||r<=0?"—":s?`${r}${s}`:String(r)};function Ks({session:t,exercises:s,oneRMs:r,onFinish:o,onStart:c,onLogSets:l,onProgress:h,initialLogs:x,isFinishing:u,initialStep:T,onStepChange:v,initialInputOpen:R,initialSeriesOpen:y,onExitFocus:H,exerciseNotes:q,onUpdateNote:M}){const{toast:Y}=sn(),b=m.useRef(!1),[k,O]=m.useState(T??0),[w,te]=m.useState([]),[oe,S]=m.useState(0),[A,I]=m.useState(!0),$=m.useRef(Date.now()),G=m.useRef(0),[z,p]=m.useState(0),[V,W]=m.useState(!1),[X,B]=m.useState(!1),K=m.useRef(0),[re,Ne]=m.useState(!0),[ae,Re]=m.useState(3),[me,Se]=m.useState(3),[Le,ze]=m.useState(""),[Ee,De]=m.useState(!1),[F,ye]=m.useState(1),[xe,Be]=m.useState(y??!1),[_e,_]=m.useState(R??!1),[ge,J]=m.useState("weight"),[le,be]=m.useState(""),[nt,ce]=m.useState(!1),[Fe,He]=m.useState(!1),[Me,qe]=m.useState(!1),[fe,Ve]=m.useState(!1),[st,Ce]=m.useState(!1),[we,Ue]=m.useState("");m.useEffect(()=>{if(!A)return;const a=()=>{S(Math.floor((Date.now()-$.current)/1e3)+G.current)};a();const j=setInterval(a,1e3),U=()=>{document.visibilityState==="visible"&&a()};return document.addEventListener("visibilitychange",U),()=>{clearInterval(j),document.removeEventListener("visibilitychange",U)}},[A]),m.useEffect(()=>{if(!Fe)return;const a=j=>{j.key==="Escape"&&He(!1)};return window.addEventListener("keydown",a),()=>window.removeEventListener("keydown",a)},[Fe]),m.useEffect(()=>{let a=null;V&&!X&&z>0?a=setInterval(()=>p(U=>U-1),1e3):z===0&&V&&(tn(),Y({title:"Temps de récupération terminé"}),W(!1),B(!1));const j=()=>{if(document.visibilityState==="visible"&&V&&!X&&K.current>0){const U=Math.max(0,Math.ceil((K.current-Date.now())/1e3));p(U),U<=0&&(tn(),Y({title:"Temps de récupération terminé"}),W(!1),B(!1))}};return document.addEventListener("visibilitychange",j),()=>{a&&clearInterval(a),document.removeEventListener("visibilitychange",j)}},[V,X,z]);const se=t.items||[],ke=k-1,C=k>0&&k<=se.length?se[ke]:null,Z=C?s.find(a=>a.id===C.exercise_id):null,Ge=k<se.length?se[k]:null,rt=Ge?s.find(a=>a.id===Ge.exercise_id):null,Je=(()=>{const a=Z?.muscle_groups??Z?.muscles??Z?.muscleGroups??[];return Array.isArray(a)?a:[]})(),Te=C?.rest_seconds??0,g=se.length?Math.min(100,Math.max(0,Math.round((k-1)/se.length*100))):0,n=Number(C?.percent_1rm),i=Number.isFinite(n)&&n>0,f=i&&r.find(a=>a.exercise_id===C?.exercise_id)?.weight||0,N=i?Math.round(f*(n/100)):0,[D,P]=m.useState({}),pe=m.useMemo(()=>{const a=new Map;return w.forEach((j,U)=>{const E=bt(j,U+1);j.exercise_id&&a.set(`${j.exercise_id}-${E}`,j)}),a},[w]),ie=C?`${C.exercise_id}-${F}`:null,he=ie?pe.get(ie):null,ve=he?.weight??D[F-1]?.weight??N,de=he?.reps??D[F-1]?.reps??C?.reps??"",Ae=()=>{if(typeof window>"u")return;const a=["#22c55e","#3b82f6","#f97316","#e11d48","#a855f7"],j=120;for(let U=0;U<j;U+=1){const E=document.createElement("div"),Ie=Math.random()*6+6;E.style.position="fixed",E.style.top="-10px",E.style.left=`${Math.random()*100}vw`,E.style.width=`${Ie}px`,E.style.height=`${Ie*.6}px`,E.style.backgroundColor=a[U%a.length],E.style.opacity="0.9",E.style.pointerEvents="none",E.style.zIndex="9999",E.style.borderRadius="2px",document.body.appendChild(E);const Oe=(Math.random()-.5)*200,at=1200+Math.random()*800,ft=Math.random()*360;E.animate([{transform:"translate3d(0, 0, 0) rotate(0deg)",opacity:1},{transform:`translate3d(${Oe}px, ${window.innerHeight+200}px, 0) rotate(${ft}deg)`,opacity:0}],{duration:at,easing:"ease-out"}).onfinish=()=>E.remove()}};m.useEffect(()=>{if(b.current){x&&te(x);return}if(!x){te(E=>E.length?[]:E),P(E=>Object.keys(E).length?{}:E);return}if(te(x),!x.length){P(E=>Object.keys(E).length?{}:E),O(E=>E===0?E:0);return}const a=t.items||[];if(!a.length)return;const j=new Map;x.forEach((E,Ie)=>{if(!E.exercise_id)return;const Oe=j.get(E.exercise_id)??[];Oe.push({...E,set_index:bt(E,Ie+1)}),j.set(E.exercise_id,Oe)});const U=Sn(a,x);if(U>0&&U<=a.length){const E=a[U-1],Ie=j.get(E.exercise_id)??[],Oe=Ie.reduce((ft,Nt,En)=>{const kn=bt(Nt,En+1);return ft[kn-1]={reps:Nt.reps??void 0,weight:Nt.weight??void 0},ft},{});P(Oe);const at=Math.min(E.sets??1,Ie.length+1);ye(at)}else P({}),ye(1);O(E=>E===U?E:U)},[x,t.items]),m.useEffect(()=>{k<=se.length||Ee||(Ae(),De(!0))},[k,se.length,Ee]);const We=a=>{O(a),v?.(a)},Bt=a=>{a<=0||(K.current=Date.now()+a*1e3,p(a),W(!0),B(!1))},wt=async()=>{window.scrollTo({top:0,behavior:"smooth"});const a=k+1;ye(1),P({}),We(a);const j=Math.round(Math.min(a-1,se.length)/se.length*100);try{await h?.(j)}catch{Y({title:"Erreur de sauvegarde",description:"Réessayez",variant:"destructive"})}},Cn=async()=>{if(!C)return;if(he){F>=C.sets?await wt():ye(j=>Math.min(C.sets,j+1));return}const a={exercise_id:C.exercise_id,set_number:F,reps:D[F-1]?.reps||C.reps,weight:D[F-1]?.weight||N};te(j=>[...j,a]),b.current=!0;try{await l?.([a])}catch{Y({title:"Erreur de sauvegarde",description:"Réessayez",variant:"destructive"})}finally{b.current=!1}if(re&&C.rest_seconds>0&&Bt(C.rest_seconds),F>=C.sets){await wt();return}ye(j=>Math.min(C.sets,j+1))},qt=a=>{J(a);const j=a==="weight"?D[F-1]?.weight??N??"":D[F-1]?.reps??C?.reps??"";be(j?String(j):""),ce(!!j),_(!0)},Rn=()=>{if(!C)return;const a=Number(ge==="weight"?le.replace(",","."):le);Number.isFinite(a)&&(P(j=>({...j,[F-1]:{...j[F-1],[ge]:a}})),_(!1))},jt=a=>{if(nt){ce(!1),be(a);return}be(j=>a==="."&&j.includes(".")?j:j+a)},Vt=a=>{if(!C)return;J(a);const j=a==="weight"?D[F-1]?.weight??N??"":D[F-1]?.reps??C?.reps??"";be(j?String(j):""),ce(!!j)};return k===0?e.jsxs("div",{className:"space-y-6 text-center py-8 animate-in zoom-in duration-300",children:[e.jsx("div",{className:"h-24 w-24 bg-primary/10 rounded-full flex items-center justify-center mx-auto animate-pulse",children:e.jsx(Ye,{className:"h-10 w-10 text-primary ml-1"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold font-display uppercase",children:t.title}),e.jsx("p",{className:"text-muted-foreground text-lg",children:t.description}),e.jsxs("div",{className:"flex gap-2 justify-center mt-4",children:[e.jsx(ut,{variant:"outline",className:"text-sm px-3 py-1",children:t.cycle}),e.jsxs(ut,{variant:"secondary",className:"text-sm px-3 py-1",children:[se.length," Exercices"]})]})]}),e.jsx(L,{size:"lg",className:"w-full text-xl h-14 font-bold uppercase tracking-wider shadow-lg hover:scale-[1.02] transition-transform",disabled:Me,onClick:async()=>{qe(!0);try{await c?.(),We(1)}finally{qe(!1)}},children:Me?e.jsxs(e.Fragment,{children:[e.jsx(Kn,{className:"mr-2 h-5 w-5 animate-spin"}),"CHARGEMENT..."]}):"COMMENCER SÉANCE"})]}):k>se.length?e.jsx("div",{className:"space-y-6 animate-in fade-in",children:e.jsxs(Xe,{className:"border-t-8 border-t-primary shadow-xl",children:[e.jsxs(Tt,{className:"text-center pb-2",children:[e.jsx("div",{className:"mx-auto bg-primary/10 p-4 rounded-full w-fit mb-4",children:e.jsx(ls,{className:"h-12 w-12 text-primary"})}),e.jsx(Dt,{className:"text-3xl uppercase font-display italic",children:"Séance Terminée !"}),e.jsxs(rn,{className:"text-lg",children:["Durée totale: ",Math.floor(oe/60),"m ",oe%60,"s"]})]}),e.jsxs(Mt,{className:"space-y-6 pt-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-center",children:[e.jsxs("div",{className:"bg-muted p-4 rounded-lg",children:[e.jsx("div",{className:"text-xs uppercase font-bold text-muted-foreground",children:"Volume"}),e.jsxs("div",{className:"text-2xl font-mono font-bold",children:[w.reduce((a,j)=>a+(Number(j.weight)||0)*(Number(j.reps)||0),0)," kg"]})]}),e.jsxs("div",{className:"bg-muted p-4 rounded-lg",children:[e.jsx("div",{className:"text-xs uppercase font-bold text-muted-foreground",children:"Séries"}),e.jsx("div",{className:"text-2xl font-mono font-bold",children:w.length})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(et,{className:"uppercase font-bold text-xs text-muted-foreground",children:"Difficulté de la séance"}),e.jsxs("div",{className:"flex items-center justify-between text-[11px] font-semibold text-muted-foreground",children:[e.jsx("span",{children:"Facile"}),e.jsx("span",{children:"Très dur"})]}),e.jsx(en,{value:ae,onChange:Re})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(et,{className:"uppercase font-bold text-xs text-muted-foreground",children:"Fatigue fin de séance"}),e.jsxs("div",{className:"flex items-center justify-between text-[11px] font-semibold text-muted-foreground",children:[e.jsx("span",{children:"Frais"}),e.jsx("span",{children:"Épuisé"})]}),e.jsx(en,{value:me,onChange:Se})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(et,{className:"uppercase font-bold text-xs text-muted-foreground",children:"Notes"}),e.jsx("textarea",{placeholder:"Sensations, douleurs...",value:Le,onChange:a=>ze(a.target.value),rows:3,className:"flex w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 resize-none"})]})]}),e.jsx(Ln,{children:e.jsx(L,{className:"w-full h-14 text-lg font-bold uppercase",disabled:u,onClick:()=>{u||o({duration:Math.floor(oe/60),feeling:ae,fatigue:me,comments:Le,logs:w})},children:u?"ENREGISTREMENT...":"ENREGISTRER & FERMER"})})]})}):e.jsxs("div",{className:"space-y-6 pb-32",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{type:"button","aria-label":"Voir l’animation de l’exercice",onClick:()=>{Z?.illustration_gif&&He(!0)},className:"flex h-12 w-12 items-center justify-center overflow-hidden rounded-full border bg-card shadow-sm",children:Z?.illustration_gif?e.jsx("img",{src:Z.illustration_gif,alt:"",className:"h-full w-full object-cover",loading:"lazy",decoding:"async"}):e.jsx(Ye,{className:"h-5 w-5 text-muted-foreground"})}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs("span",{className:"rounded-full bg-muted px-3 py-1 text-xs font-semibold",children:["Ex ",k,"/",se.length]}),e.jsxs("span",{className:"rounded-full bg-muted px-3 py-1 text-xs font-semibold",children:["S ",F,"/",$e(C?.sets)]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"text-xs font-semibold text-muted-foreground",children:"Séance"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-2 w-28 overflow-hidden rounded-full bg-muted",children:e.jsx("div",{className:"h-full rounded-full bg-primary",style:{width:`${g}%`}})}),e.jsxs("div",{className:"text-sm font-semibold",children:[g,"%"]})]}),H?e.jsx(L,{variant:"ghost",size:"icon","aria-label":"Quitter le focus",onClick:()=>{w.length>0?Ve(!0):H()},children:e.jsx(yt,{className:"h-4 w-4"})}):null]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h2",{className:"text-2xl font-semibold tracking-tight",children:Z?.nom_exercice??"Exercice"}),M&&C&&e.jsx(L,{variant:"ghost",size:"icon",className:"h-8 w-8 shrink-0",onClick:()=>{Ue(q?.[C.exercise_id]??""),Ce(!0)},"aria-label":"Notes personnelles",children:e.jsx(xs,{className:ue("h-4 w-4",q?.[C?.exercise_id]?"text-primary":"text-muted-foreground")})})]}),C&&q?.[C.exercise_id]&&e.jsx("p",{className:"mt-1 text-xs italic text-muted-foreground line-clamp-2",children:q[C.exercise_id]}),Je.length>0&&e.jsx("div",{className:"mt-3 flex flex-wrap gap-2",children:Je.map(a=>e.jsx("span",{className:"rounded-full bg-muted px-3 py-1 text-xs font-semibold text-muted-foreground",children:a},a))})]}),e.jsxs(Xe,{className:"rounded-3xl border bg-card p-4 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-base font-semibold",children:"Série en cours"}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(Pt,{checked:re,onCheckedChange:Ne}),"Auto repos"]})]}),e.jsxs("div",{className:"mt-4 rounded-2xl border bg-muted/20 p-4",children:[e.jsx("div",{className:"text-sm font-semibold",children:"En cours"}),e.jsxs("div",{className:"mt-2 text-lg font-semibold",children:["Série ",F,"/",$e(C?.sets)," · Objectif"," ",$e(C?.reps)," reps"]}),e.jsx("div",{className:"mt-2 text-sm text-muted-foreground",children:"Appuie sur une tuile pour saisir."})]}),e.jsxs("div",{className:"mt-4 grid grid-cols-2 gap-3",children:[e.jsxs("button",{type:"button",className:"group relative rounded-2xl border-2 border-primary/20 bg-gradient-to-br from-card to-muted/30 p-4 text-left shadow-sm transition-all active:scale-[0.98] hover:border-primary/40 hover:shadow-md",onClick:()=>qt("weight"),children:[e.jsx("div",{className:"text-[10px] font-bold uppercase tracking-wide text-muted-foreground",children:"Charge"}),e.jsxs("div",{className:"mt-1 flex items-baseline gap-0.5",children:[e.jsx("span",{className:"text-3xl font-bold tabular-nums tracking-tight",children:ve||"—"}),e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"kg"})]})]}),e.jsxs("button",{type:"button",className:"group relative rounded-2xl border-2 border-primary/20 bg-gradient-to-br from-card to-muted/30 p-4 text-left shadow-sm transition-all active:scale-[0.98] hover:border-primary/40 hover:shadow-md",onClick:()=>qt("reps"),children:[e.jsx("div",{className:"text-[10px] font-bold uppercase tracking-wide text-muted-foreground",children:"Reps"}),e.jsxs("div",{className:"mt-1 flex items-baseline gap-0.5",children:[e.jsx("span",{className:"text-3xl font-bold tabular-nums tracking-tight",children:de||"—"}),e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"reps"})]})]})]}),e.jsxs("div",{className:"mt-4 rounded-2xl border bg-muted/10 p-4",children:[e.jsx("div",{className:"text-sm font-semibold",children:"Notes"}),e.jsx("div",{className:"mt-2 text-sm text-muted-foreground",children:C?.notes||Z?.description||"Aucune note spécifique."})]}),e.jsx(L,{type:"button",variant:"outline",className:"mt-4 w-full rounded-2xl",onClick:()=>Be(!0),children:"Voir les séries"})]}),!_e&&!V?e.jsxs(Nn,{className:"bottom-0 z-[60]",containerClassName:"gap-3 py-4",children:[e.jsxs(L,{className:"flex-1 min-w-0 h-12 rounded-xl text-sm font-bold shadow-lg active:scale-95 transition-transform",onClick:Cn,children:[e.jsx(Qt,{className:"mr-2 h-5 w-5"})," Valider série"]}),e.jsx(L,{type:"button",variant:"outline",className:"h-12 w-12 rounded-xl p-0 active:scale-95 transition-transform",onClick:()=>{Te<=0||Bt(Te)},"aria-label":"Démarrer le repos",children:e.jsx(ns,{className:"h-5 w-5"})}),e.jsx(L,{type:"button",variant:"outline",className:"h-12 w-12 rounded-xl p-0 active:scale-95 transition-transform",onClick:()=>wt(),"aria-label":"Exercice suivant",children:e.jsx(Lt,{className:"h-5 w-5"})})]}):null,V&&e.jsxs("div",{className:"fixed inset-0 z-50 flex flex-col bg-background/95 pb-[env(safe-area-inset-bottom)]",children:[e.jsxs("div",{className:"flex items-start justify-between border-b px-6 py-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-semibold text-muted-foreground",children:"Timer"}),e.jsx("div",{className:"text-lg font-semibold",children:"Transition inter-exercice"}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Prochain exercice : ",rt?.nom_exercice??"À venir"]})]}),e.jsx(L,{variant:"ghost",size:"icon",onClick:()=>{W(!1),B(!1)},"aria-label":"Fermer le timer de repos",children:e.jsx(yt,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"flex flex-1 flex-col items-center justify-center gap-6 px-6 py-8",children:[e.jsxs(Xe,{className:"w-full max-w-sm rounded-3xl border p-6 shadow-sm",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Temps restant"}),e.jsxs("div",{className:"mt-2 text-5xl font-semibold tracking-tight",children:[Math.floor(z/60),":",String(z%60).padStart(2,"0")]}),e.jsx("div",{className:"mt-6 h-3 w-full overflow-hidden rounded-full bg-muted",children:e.jsx("div",{className:"h-full rounded-full bg-primary",style:{width:Te?`${z/Te*100}%`:"0%"}})}),e.jsxs("div",{className:"mt-6 flex flex-wrap gap-3",children:[e.jsx(L,{variant:"outline",className:"rounded-full",onClick:()=>{K.current+=15*1e3,p(a=>a+15)},children:"+15s"}),e.jsx(L,{variant:"outline",className:"rounded-full",onClick:()=>{K.current+=30*1e3,p(a=>a+30)},children:"+30s"}),e.jsx(L,{variant:"outline",className:"rounded-full",onClick:()=>{K.current=Math.max(Date.now(),K.current-15*1e3),p(a=>Math.max(0,a-15))},children:"-15s"}),e.jsxs(L,{variant:"outline",className:"ml-auto rounded-full",onClick:()=>{K.current=Date.now()+Te*1e3,p(Te)},children:[e.jsx(ms,{className:"mr-2 h-4 w-4"}),"Reset"]})]})]}),e.jsxs("div",{className:"flex w-full max-w-sm flex-wrap gap-3",children:[e.jsxs(L,{className:"flex-1 rounded-full py-6 text-base font-semibold",onClick:()=>{X&&(K.current=Date.now()+z*1e3),B(a=>!a)},children:[e.jsx(ds,{className:"mr-2 h-4 w-4"})," ",X?"Reprendre":"Pause"]}),e.jsxs(L,{variant:"outline",className:"rounded-full px-6 py-6 text-base font-semibold",onClick:()=>{K.current=0,W(!1),p(0),B(!1)},children:["Passer ",e.jsx(Lt,{className:"ml-2 h-4 w-4"})]})]})]})]}),Fe&&Z?.illustration_gif&&e.jsx("div",{className:"fixed inset-0 z-50 bg-black/50",onClick:()=>He(!1),children:e.jsx("div",{className:"fixed inset-0 flex items-center justify-center p-4",onClick:a=>a.stopPropagation(),children:e.jsxs("div",{className:"relative",children:[e.jsx("button",{type:"button","aria-label":"Fermer",className:"absolute -right-3 -top-3 rounded-full bg-background p-2 shadow",onClick:()=>He(!1),children:e.jsx(yt,{className:"h-4 w-4"})}),e.jsx("img",{src:Z.illustration_gif,alt:"",className:"max-h-[80vh] w-auto max-w-[92vw] rounded-2xl",loading:"lazy"})]})})}),e.jsx(At,{open:xe,onOpenChange:Be,children:e.jsxs(It,{side:"bottom",className:"max-h-[80vh] overflow-y-auto",children:[e.jsx(Ot,{children:e.jsx($t,{children:"Aperçu séance"})}),e.jsx("div",{className:"mt-4 space-y-4",children:se.map((a,j)=>{const U=s.find(Oe=>Oe.id===a.exercise_id),E=Array.from({length:a.sets}).filter((Oe,at)=>pe.get(`${a.exercise_id}-${at+1}`)).length,Ie=a.sets?Math.round(E/a.sets*100):0;return e.jsxs(Xe,{className:"rounded-3xl border bg-muted/10 p-4 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-base font-semibold",children:U?.nom_exercice??a.exercise_name}),e.jsxs("div",{className:"mt-1 text-sm text-muted-foreground",children:[$e(a.sets),"x",$e(a.reps)," ·"," ",a.percent_1rm?`${$e(a.percent_1rm)} 1RM`:"—"]})]}),e.jsxs("div",{className:"rounded-full bg-muted px-3 py-1 text-sm font-semibold",children:[E,"/",$e(a.sets)]})]}),e.jsx("div",{className:"mt-4 h-3 w-full overflow-hidden rounded-full bg-muted",children:e.jsx("div",{className:"h-full rounded-full bg-primary",style:{width:`${Ie}%`}})})]},`${a.exercise_id}-${j}`)})})]})}),e.jsx(gn,{open:_e,onOpenChange:_,children:e.jsx(yn,{className:"max-h-[90vh]",children:e.jsxs("div",{className:"mx-auto w-full max-w-md px-4 pb-8",children:[e.jsxs(bn,{className:"pb-2",children:[e.jsx(wn,{className:"text-center",children:ge==="weight"?"Charge":"Répétitions"}),e.jsxs(jn,{className:"text-center",children:["Série ",F,"/",$e(C?.sets)," · Objectif"," ",$e(C?.reps)," reps"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-4",children:[e.jsxs("button",{type:"button",className:ue("rounded-xl border-2 p-4 text-center transition-all",ge==="weight"?"border-primary bg-primary/10 shadow-sm":"border-muted bg-card hover:border-muted-foreground/30"),onClick:()=>Vt("weight"),children:[e.jsx("div",{className:"text-xs font-semibold uppercase text-muted-foreground",children:"Charge"}),e.jsxs("div",{className:"mt-1 text-2xl font-bold tabular-nums",children:[ge==="weight"?le||"—":String(D[F-1]?.weight??N??"—"),e.jsx("span",{className:"ml-1 text-base font-normal text-muted-foreground",children:"kg"})]})]}),e.jsxs("button",{type:"button",className:ue("rounded-xl border-2 p-4 text-center transition-all",ge==="reps"?"border-primary bg-primary/10 shadow-sm":"border-muted bg-card hover:border-muted-foreground/30"),onClick:()=>Vt("reps"),children:[e.jsx("div",{className:"text-xs font-semibold uppercase text-muted-foreground",children:"Reps"}),e.jsxs("div",{className:"mt-1 text-2xl font-bold tabular-nums",children:[ge==="reps"?le||"—":String(D[F-1]?.reps??C?.reps??"—"),e.jsx("span",{className:"ml-1 text-base font-normal text-muted-foreground",children:"reps"})]})]})]}),ge==="weight"&&N>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"text-xs font-semibold text-muted-foreground mb-2",children:"Suggestions"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:[N-10,N-5,N,N+5,N+10].filter(a=>a>0).map(a=>e.jsxs(L,{variant:Number(le)===a?"default":"outline",size:"sm",className:"rounded-full px-4 h-10 text-sm font-semibold",onClick:()=>be(String(a)),children:[a," kg"]},a))})]}),ge==="reps"&&e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"text-xs font-semibold text-muted-foreground mb-2",children:"Suggestions"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:[6,8,10,12,15,20].map(a=>e.jsx(L,{variant:Number(le)===a?"default":"outline",size:"sm",className:"rounded-full px-4 h-10 text-sm font-semibold",onClick:()=>be(String(a)),children:a},a))})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 mb-4",children:[[1,2,3,4,5,6,7,8,9].map(a=>e.jsx(L,{variant:"outline",className:"h-14 text-xl font-semibold rounded-xl active:scale-95 transition-transform",onClick:()=>jt(String(a)),children:a},a)),e.jsx(L,{variant:"outline",className:"h-14 text-xl font-semibold rounded-xl active:scale-95 transition-transform",onClick:()=>jt("."),children:","}),e.jsx(L,{variant:"outline",className:"h-14 text-xl font-semibold rounded-xl active:scale-95 transition-transform",onClick:()=>jt("0"),children:"0"}),e.jsx(L,{variant:"outline",className:"h-14 text-xl font-semibold rounded-xl active:scale-95 transition-transform",onClick:()=>{ce(!1),be(a=>a.slice(0,-1))},children:"⌫"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(L,{variant:"outline",className:"flex-1 h-14 text-base font-semibold rounded-xl",onClick:()=>{ce(!1),be("")},children:"Effacer"}),e.jsxs(L,{className:"flex-1 h-14 text-base font-semibold rounded-xl",onClick:Rn,children:[e.jsx(Qt,{className:"mr-2 h-5 w-5"}),"Valider"]})]})]})})}),H&&e.jsx(Qn,{open:fe,onOpenChange:Ve,children:e.jsxs(Yn,{children:[e.jsxs(Xn,{children:[e.jsx(Gn,{children:"Quitter la séance ?"}),e.jsx(Jn,{children:"Les séries enregistrées seront conservées."})]}),e.jsxs(Zn,{children:[e.jsx(es,{children:"Annuler"}),e.jsx(ts,{onClick:()=>{Ve(!1),H()},children:"Quitter"})]})]})}),M&&e.jsx(At,{open:st,onOpenChange:a=>{if(!a&&C){const j=we.trim()||null,U=q?.[C.exercise_id]??null;j!==U&&M(C.exercise_id,j)}Ce(a)},children:e.jsxs(It,{side:"bottom",className:"max-h-[60vh]",children:[e.jsx(Ot,{children:e.jsxs($t,{children:["Notes — ",Z?.nom_exercice]})}),e.jsx("textarea",{value:we,onChange:a=>Ue(a.target.value),placeholder:"Réglages machine, repères personnels...",rows:4,className:"flex w-full rounded-md border border-input bg-background px-3 py-2 text-sm mt-4 resize-none ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring"})]})})]})}const Qe=t=>t==="endurance"||t==="hypertrophie"||t==="force"?t:"endurance",ct=t=>{const s=Number(t);return!Number.isFinite(s)||s<=0?null:s},Qs=(t,s)=>{if(!t)return{sets:null,reps:null,percent1rm:null,restSeries:null,restExercise:null};const r={endurance:{sets:t.Nb_series_endurance,reps:t.Nb_reps_endurance,percent1rm:t.pct_1rm_endurance,restSeries:t.recup_endurance,restExercise:t.recup_exercices_endurance},hypertrophie:{sets:t.Nb_series_hypertrophie,reps:t.Nb_reps_hypertrophie,percent1rm:t.pct_1rm_hypertrophie,restSeries:t.recup_hypertrophie,restExercise:t.recup_exercices_hypertrophie},force:{sets:t.Nb_series_force,reps:t.Nb_reps_force,percent1rm:t.pct_1rm_force,restSeries:t.recup_force,restExercise:t.recup_exercices_force}}[s];return{sets:ct(r.sets),reps:ct(r.reps),percent1rm:ct(r.percent1rm),restSeries:ct(r.restSeries),restExercise:ct(r.restExercise)}},dt=(t=[],s,r)=>Xs(t,s).map(o=>{const c=Qs(r.get(o.exercise_id),s);return{...o,sets:c.sets??0,reps:c.reps??0,rest_seconds:c.restSeries??0,percent_1rm:c.percent1rm??0}}),nn=t=>{const s=Number(t);return!Number.isFinite(s)||s<=0?"—":String(s)},Ys=t=>{const s=Number(t);return!Number.isFinite(s)||s<=0?"—":`${s}s`},_n=(t=[])=>{if(!t.length)return t;const s=t.map((o,c)=>{const l=Number(o.order_index);return{item:o,index:c,order:Number.isFinite(l)?l:null}});return s.some(o=>o.order!==null)?s.sort((o,c)=>o.order===null&&c.order===null?o.index-c.index:o.order===null?1:c.order===null?-1:o.order===c.order?o.index-c.index:o.order-c.order).map(o=>o.item):t},Xs=(t=[],s)=>{const r=t.filter(c=>c.cycle_type===s),o=r.length?r:t;return _n(o)},Gs=t=>{t.setActiveSession(null),t.setActiveAssignment(null),t.setActiveRunId(null),t.setActiveRunLogs(null),t.setActiveRunnerStep(0),t.setScreenMode("list")},Js=({runId:t,assignmentId:s,startedAt:r})=>({id:t,assignment_id:s??null,started_at:r,progress_pct:0,status:"in_progress",logs:[]}),kt=t=>({runs:t?[t]:[],pagination:{limit:1,offset:0,total:t?1:0},exercise_summary:[]});function vr(){const{user:t,userId:s,role:r,selectedAthleteId:o,selectedAthleteName:c}=Fn(),{toast:l}=sn(),h=$n(),x="strength-preferences",[u,T]=m.useState(null),[v,R]=m.useState(null),[y,H]=m.useState(null),[q,M]=m.useState(null),[Y,b]=m.useState(0),[k,O]=m.useState("list"),[w,te]=m.useState(!1),[oe,S]=m.useState({poolMode:!1,largeText:!1}),[A,I]=m.useState(""),[$,G]=m.useState("endurance"),[z,p]=m.useState("all"),[V,W]=m.useState(""),[X,B]=m.useState(""),K=(r==="coach"||r==="admin")&&(o!==null||!!c),re=K?c:t,Ne=K?o:s,ae=Ne??re,Re=m.useMemo(()=>`strength-focus-state-${ae??"anonymous"}`,[ae]),{poolMode:me,largeText:Se}=oe;m.useEffect(()=>{if(typeof window>"u")return;const n=window.localStorage.getItem(x);if(n)try{const i=JSON.parse(n);S(f=>({...f,...i??{}}))}catch{return}},[]),m.useEffect(()=>{typeof window>"u"||window.localStorage.setItem(x,JSON.stringify(oe))},[x,oe]),m.useEffect(()=>{if(!(typeof document>"u")){if(k==="focus")return document.body.dataset.focusMode="strength",()=>{document.body.dataset.focusMode==="strength"&&delete document.body.dataset.focusMode};document.body.dataset.focusMode==="strength"&&delete document.body.dataset.focusMode}},[k]),m.useEffect(()=>{if(typeof window>"u"||u)return;const n=window.localStorage.getItem(Re);if(n)try{const i=JSON.parse(n),f=i?.screenMode==="focus"?"focus":i?.screenMode==="reader"?"reader":null;if(!f||!i?.session)return;T(i.session),R(i.assignment??null),H(typeof i.runId=="number"?i.runId:null),M(Array.isArray(i.runLogs)?i.runLogs:null),b(Number.isFinite(i.runnerStep)?i.runnerStep:0),i.cycleType&&G(Qe(i.cycleType)),O(f)}catch{return}},[u,Re]),m.useEffect(()=>{if(typeof window>"u")return;if(!(k==="focus"||k==="reader")||!u){window.localStorage.removeItem(Re);return}const i={screenMode:k,session:u,assignment:v,runId:y,runLogs:q,runnerStep:Y,cycleType:$};window.localStorage.setItem(Re,JSON.stringify(i))},[v,y,q,Y,u,$,Re,k]);const{data:Le,isLoading:ze}=it({queryKey:["assignments",t,"strength"],queryFn:()=>je.getAssignments(t,s,{assignmentType:"strength"}),enabled:!!t}),{data:Ee,isLoading:De}=it({queryKey:["strength_catalog"],queryFn:()=>je.getStrengthSessions()}),{data:F}=it({queryKey:["exercises"],queryFn:()=>je.getExercises()}),ye=ze||De,{data:xe}=it({queryKey:["1rm",t,s],queryFn:()=>je.get1RM({athleteName:t,athleteId:s}),enabled:!!t}),Be=m.useMemo(()=>{const n={};return(xe??[]).forEach(i=>{i.notes&&(n[i.exercise_id]=i.notes)}),n},[xe]),_e=Pn({queryKey:["strength_history",ae,z,V,X],queryFn:({pageParam:n=0})=>je.getStrengthHistory(re,{athleteId:Ne,limit:10,offset:n,order:"desc",status:z==="all"?void 0:z,from:V||void 0,to:X||void 0}),enabled:!!re,getNextPageParam:n=>{const i=n.pagination.offset+n.pagination.limit;return i<n.pagination.total?i:void 0},initialPageParam:0}),_=_e.data?.pages.flatMap(n=>n.runs)??[],J=it({queryKey:["strength_run_in_progress",ae],queryFn:()=>je.getStrengthHistory(re,{limit:1,offset:0,order:"desc",status:"in_progress",athleteId:Ne}),enabled:!!re}).data?.runs?.[0]??null,le=J?.status==="completed"||(J?.progress_pct??0)>=100,be=Ze({mutationFn:n=>je.startStrengthRun(n),onSuccess:n=>{if(n?.run_id&&(H(n.run_id),M(i=>i??[]),ae)){const i=Js({runId:n.run_id,assignmentId:v?.id??null,startedAt:new Date().toISOString()});h.setQueryData(["strength_run_in_progress",ae],kt(i))}h.invalidateQueries({queryKey:["assignments",t,"strength"]}),h.invalidateQueries({queryKey:["strength_run_in_progress",ae]}),h.invalidateQueries({queryKey:["strength_history"]})},onError:()=>{l({title:"Erreur",description:"Impossible de démarrer la séance.",variant:"destructive"})}}),nt=Ze({mutationFn:n=>je.logStrengthSet(n),onSuccess:n=>{n?.one_rm_updated&&(h.invalidateQueries({queryKey:["1rm",t,s]}),l({title:"Nouveau 1RM détecté",description:"Ton record vient d'être mis à jour."}))},onError:()=>{l({title:"Erreur",description:"Impossible d'enregistrer une série.",variant:"destructive"})}}),ce=Ze({mutationFn:n=>je.updateStrengthRun(n),onSuccess:(n,i)=>{te(!1),h.invalidateQueries({queryKey:["strength_history"]}),i?.status==="completed"&&(ae&&h.setQueryData(["strength_run_in_progress",ae],kt(null)),h.invalidateQueries({queryKey:["assignments",t]}),h.invalidateQueries({queryKey:["assignments",t,"strength"]}),h.invalidateQueries({queryKey:["1rm",t,s]}),R(null),H(null),T(null),M(null),O("list"),l({title:"Séance sauvegardée",description:"Bravo pour l'effort !"}))},onError:(n,i)=>{i?.status==="completed"&&(te(!1),l({title:"Erreur",description:"Impossible d'enregistrer la séance. Réessayez.",variant:"destructive"}))}}),Fe=Ze({mutationFn:n=>je.updateExerciseNote({athlete_id:s??0,exercise_id:n.exercise_id,notes:n.notes}),onSuccess:()=>{h.invalidateQueries({queryKey:["1rm",t,s]})},onError:()=>{l({title:"Erreur",description:"Impossible de sauvegarder la note.",variant:"destructive"})}});Ze({mutationFn:n=>je.startStrengthRun(n),onError:()=>{l({title:"Erreur",description:"Impossible de mettre à jour la séance.",variant:"destructive"})}});const He=(n,i)=>{const f=n.items??[],N=Qe(i??n.cycle??f.find(P=>P.cycle_type)?.cycle_type),D=dt(f,N,we);R(n),T({...n,title:n.title,description:n.description,cycle:N,items:D}),H(null),M(null),b(0),O("reader")},qe=(Le?.filter(n=>n.session_type==="strength")||[]).filter(n=>n.status!=="completed"),fe=J?qe.find(n=>n.id===J.assignment_id):null,Ve=!!fe?.items?.length&&!le,st=qe.map(n=>({...n,session:{id:n.session_id,title:n.title,description:n.description,cycle:Qe(n.cycle),items:n.items??[]}})),Ce=[{value:"endurance",label:"Endurance"},{value:"hypertrophie",label:"Hypertrophie"},{value:"force",label:"Force"}],we=m.useMemo(()=>F?new Map(F.map(n=>[n.id,n])):new Map,[F]),Ue=st.map(n=>{const i=dt(n.items??[],$,we);return{key:`assignment-${n.id}`,title:n.title,description:n.description,type:"assignment",assignedDate:n.assigned_date,session:{id:n.session_id,title:n.title,description:n.description,cycle:Qe(n.cycle),items:i},assignment:n,exerciseCount:i.length}}),se=(Ee??[]).map(n=>{const i=dt(n.items??[],$,we);return{key:`catalog-${n.id}`,title:n.title,description:n.description,type:"catalog",session:{...n,items:i,cycle:$},exerciseCount:i.length}}),ke=A.trim().toLowerCase(),C=[...Ue,...se].filter(n=>ke?`${n.title} ${n.description}`.toLowerCase().includes(ke):!0),Z=m.useMemo(()=>u?dt(u.items??[],$,we):[],[u,$,we]),Ge=n=>{if((n.items??[]).length===0){l({title:"Séance vide",description:"Aucun exercice n'est disponible pour cette séance."});return}He(n,$),H(null),M(null)},rt=n=>{const i=n.items??[],N=i.filter(P=>P.cycle_type===$).length>0?$:Qe(n.cycle??i.find(P=>P.cycle_type)?.cycle_type),D=dt(i,N,we);if(D.length===0){l({title:"Séance vide",description:"Aucun exercice n'est disponible pour cette séance."});return}T({...n,cycle:N,items:D}),R(null),H(null),M(null),b(0),O("reader")},Je=()=>{if(u){if(Z.length===0){l({title:"Séance vide",description:"Aucun exercice n'est disponible pour cette séance."});return}T({...u,cycle:$,items:Z}),b(0),O("focus")}},Te=()=>{Gs({setActiveSession:T,setActiveAssignment:R,setActiveRunId:H,setActiveRunLogs:M,setActiveRunnerStep:b,setScreenMode:O})},g=Ze({mutationFn:n=>je.deleteStrengthRun(n),onSuccess:n=>{Te(),ae&&h.setQueryData(["strength_run_in_progress",ae],kt(null)),h.invalidateQueries({queryKey:["strength_run_in_progress",ae]}),h.invalidateQueries({queryKey:["strength_history"]}),h.invalidateQueries({queryKey:["assignments",t,"strength"]});const i=n?.source==="local"?"Suppression locale : le serveur n'est pas disponible.":void 0;l({title:"Séance supprimée",description:i})},onError:()=>{l({title:"Erreur",description:"Impossible de supprimer la séance en cours.",variant:"destructive"})}});return e.jsx("div",{className:ue("space-y-4 md:space-y-6",me&&"dark bg-background text-foreground contrast-125",Se&&"text-lg leading-relaxed [&_.text-xs]:text-sm [&_.text-sm]:text-base"),children:k==="focus"&&u?F?e.jsx("div",{className:"animate-in fade-in motion-reduce:animate-none",children:e.jsx(Ks,{session:u,exercises:F,oneRMs:xe||[],exerciseNotes:Be,onUpdateNote:(n,i)=>Fe.mutate({exercise_id:n,notes:i}),initialLogs:q,initialStep:Y,isFinishing:w,onStepChange:n=>b(n),onExitFocus:()=>O("reader"),onStart:async()=>{if(y)return;const n=v?.session_id??u?.id??null;if(!n){l({title:"Session manquante",description:"Impossible de démarrer sans session associée.",variant:"destructive"});return}const i={assignment_id:v?.id??null,athlete_id:s??null,athleteName:t??void 0,progress_pct:0,session_id:n,cycle_type:u?.cycle};try{const f=await be.mutateAsync(i);f?.run_id&&H(f.run_id)}catch{return}},onLogSets:async n=>{y&&(M(i=>[...i??[],...n]),await Promise.all(n.map((i,f)=>nt.mutateAsync({run_id:y,exercise_id:i.exercise_id,set_index:i.set_number??f+1,reps:i.reps??null,weight:i.weight??null,athlete_id:s??null,athlete_name:t??null}))))},onProgress:async n=>{y&&await ce.mutateAsync({run_id:y,progress_pct:n,status:"in_progress"})},onFinish:n=>{y&&(te(!0),ce.mutate({assignment_id:v?.id??void 0,run_id:y,session_id:v?.session_id??u?.id??void 0,athlete_id:s??void 0,date:new Date().toISOString(),progress_pct:100,status:"completed",...n}))}})}):e.jsxs("div",{className:"space-y-4 py-10",children:[e.jsx("div",{className:"mx-auto h-8 w-48 rounded-lg bg-muted animate-pulse motion-reduce:animate-none"}),e.jsx("div",{className:"mx-auto h-4 w-32 rounded-lg bg-muted animate-pulse motion-reduce:animate-none"}),e.jsx("div",{className:"space-y-3 pt-4",children:[1,2,3].map(n=>e.jsx("div",{className:"h-20 w-full rounded-xl bg-muted animate-pulse motion-reduce:animate-none"},n))})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-3xl font-display font-bold uppercase italic text-primary",children:"Musculation"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(L,{variant:"ghost",size:"sm","aria-label":"Informations sur le calcul du 1RM",onClick:()=>l({title:"Info",description:"Le 1RM est calculé automatiquement."}),className:"text-muted-foreground",children:[e.jsx(Ye,{className:"mr-2 h-4 w-4"})," Info 1RM"]}),e.jsx(L,{variant:"ghost",size:"icon",onClick:()=>O("settings"),className:"rounded-full border border-muted/50 text-muted-foreground","aria-label":"Paramètres",children:e.jsx(ps,{className:"h-4 w-4"})})]})]}),e.jsxs(Un,{defaultValue:"start",className:"w-full",children:[e.jsxs(Wn,{className:"grid w-full grid-cols-2",children:[e.jsx(Ut,{value:"start",children:"S'entraîner"}),e.jsx(Ut,{value:"history",children:"Historique"})]}),e.jsxs(Wt,{value:"start",className:"space-y-5 pt-4",children:[k==="list"&&ye&&e.jsxs("div",{className:"space-y-5 pt-4",children:[e.jsx("div",{className:"flex justify-center gap-2",children:[1,2,3].map(n=>e.jsx("div",{className:"h-10 w-28 rounded-full bg-muted animate-pulse"},n))}),e.jsx("div",{className:"h-12 rounded-2xl bg-muted/30 animate-pulse"}),e.jsx("div",{className:"space-y-3",children:[1,2,3,4].map(n=>e.jsx("div",{className:"rounded-2xl border bg-card p-4 shadow-sm",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"h-12 w-12 shrink-0 rounded-xl bg-muted animate-pulse"}),e.jsxs("div",{className:"flex-1 min-w-0 space-y-2",children:[e.jsx("div",{className:"h-4 w-3/4 rounded bg-muted animate-pulse"}),e.jsx("div",{className:"h-3 w-1/2 rounded bg-muted animate-pulse"})]}),e.jsx("div",{className:"h-10 w-10 shrink-0 rounded-full bg-muted animate-pulse"})]})},n))})]}),k==="list"&&!ye&&e.jsxs("div",{className:"space-y-5 animate-in fade-in motion-reduce:animate-none",children:[e.jsxs("p",{className:"text-center text-sm text-muted-foreground py-1",children:[C.length," séance",C.length>1?"s":""," disponible",C.length>1?"s":""]}),e.jsx("div",{className:"flex justify-center gap-2",children:Ce.map(n=>e.jsx("button",{type:"button",onClick:()=>G(Qe(n.value)),className:ue("px-5 py-2.5 rounded-full text-sm font-semibold transition-all active:scale-95",$===n.value?"bg-primary text-primary-foreground shadow-md":"bg-muted/50 text-muted-foreground hover:bg-muted"),children:n.label},n.value))}),e.jsxs("div",{className:"relative",children:[e.jsx(rs,{className:"absolute left-4 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground pointer-events-none"}),e.jsx(St,{placeholder:"Rechercher une séance...",className:"h-12 rounded-2xl bg-muted/30 pl-11 pr-4 border-0 shadow-sm focus-visible:ring-2",value:A,onChange:n=>I(n.target.value),"aria-label":"Rechercher une séance"})]}),J&&e.jsxs("div",{className:"relative overflow-hidden rounded-2xl bg-gradient-to-br from-primary/10 via-primary/5 to-transparent border-2 border-primary/30 p-5",children:[e.jsx("div",{className:"absolute top-0 right-0 w-24 h-24 bg-primary/10 rounded-full blur-2xl -mr-8 -mt-8"}),e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsxs("span",{className:"relative flex h-3 w-3",children:[e.jsx("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-primary opacity-75"}),e.jsx("span",{className:"relative inline-flex rounded-full h-3 w-3 bg-primary"})]}),e.jsx("span",{className:"text-xs font-bold uppercase tracking-wider text-primary",children:le?"Complétée":"En cours"})]}),e.jsx("h3",{className:"text-xl font-bold tracking-tight mb-1",children:fe?.title??"Séance en cours"}),e.jsxs("p",{className:"text-sm text-muted-foreground mb-4",children:["Démarrée le ",xt(new Date(J.started_at||new Date),"dd MMMM",{locale:ht})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex justify-between text-xs font-semibold mb-1.5",children:[e.jsx("span",{className:"text-muted-foreground",children:"Progression"}),e.jsxs("span",{className:"text-primary",children:[Math.round(J.progress_pct??0),"%"]})]}),e.jsx("div",{className:"h-2 rounded-full bg-muted overflow-hidden",children:e.jsx("div",{className:"h-full rounded-full bg-primary transition-all duration-500",style:{width:`${J.progress_pct??0}%`}})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(L,{className:"flex-1 h-12 rounded-xl font-semibold",disabled:!Ve,onClick:()=>{if(!fe)return;const n=fe.items??[],i=Qe(fe.cycle??n.find(D=>D.cycle_type)?.cycle_type),f=n.filter(D=>D.cycle_type===i),N=_n(f.length?f:n);R(fe),T({...fe,title:fe.title,description:fe.description,cycle:i,items:N}),H(J.id),M(J.logs??[]),b(Sn(N,J.logs??[],J.progress_pct)),O("focus")},children:le?"Voir le résumé":"Reprendre"}),!le&&e.jsx(L,{variant:"outline",className:"h-12 w-12 rounded-xl p-0",disabled:g.isPending,onClick:()=>{!J||!window.confirm("Supprimer la séance en cours ?")||g.mutate(J.id)},"aria-label":"Supprimer la séance",children:e.jsx(yt,{className:"h-5 w-5"})})]})]})]}),!J&&C.length>0&&e.jsxs("div",{className:"flex items-center gap-2 pt-2",children:[e.jsx(Ye,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-xs font-semibold uppercase tracking-wider text-muted-foreground",children:"Choisir une séance"})]}),C.length>0?e.jsx("div",{className:"space-y-3",children:C.map(n=>e.jsx("button",{type:"button",className:"group w-full rounded-2xl border bg-card p-4 text-left shadow-sm transition-all active:scale-[0.98] hover:shadow-md hover:border-primary/30",onClick:()=>{if(n.type==="assignment"){Ge(n.assignment);return}rt(n.session)},children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:ue("flex h-12 w-12 shrink-0 items-center justify-center rounded-xl",n.type==="assignment"?"bg-primary/10 text-primary":"bg-muted text-muted-foreground"),children:e.jsx(Ye,{className:"h-5 w-5"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-0.5",children:[n.type==="assignment"&&e.jsx("span",{className:"inline-flex items-center rounded-full bg-primary/10 px-2 py-0.5 text-[10px] font-bold uppercase text-primary",children:"Assignée"}),n.type==="assignment"&&n.assignedDate&&e.jsx("span",{className:"text-xs text-muted-foreground",children:xt(new Date(n.assignedDate),"dd MMM",{locale:ht})})]}),e.jsx("h3",{className:"font-semibold tracking-tight truncate",children:n.title}),e.jsxs("p",{className:"text-sm text-muted-foreground truncate",children:[n.exerciseCount," exercice",n.exerciseCount>1?"s":"",n.description?` · ${n.description}`:""]})]}),e.jsx("div",{className:"flex h-10 w-10 shrink-0 items-center justify-center rounded-full bg-muted/50 text-muted-foreground transition-colors group-hover:bg-primary group-hover:text-primary-foreground",children:e.jsx(Kt,{className:"h-4 w-4 ml-0.5"})})]})},n.key))}):e.jsxs("div",{className:"py-12 text-center",children:[e.jsx("div",{className:"mx-auto mb-4 flex h-16 w-16 items-center justify-center rounded-full bg-muted",children:e.jsx(Ye,{className:"h-7 w-7 text-muted-foreground"})}),e.jsx("h3",{className:"font-semibold",children:"Aucune séance"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Essayez un autre mot-clé ou changez de cycle."})]})]}),k==="settings"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[e.jsxs(L,{variant:"ghost",size:"sm",onClick:()=>O("list"),className:"gap-2",children:[e.jsx(Yt,{className:"h-4 w-4"}),"Retour"]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.3em] text-muted-foreground",children:"Préférences"}),e.jsx("h2",{className:"text-2xl font-display font-bold uppercase text-primary",children:"Paramètres"})]})]}),e.jsxs(Xe,{className:"border border-muted/60 shadow-sm",children:[e.jsxs(Tt,{children:[e.jsx(Dt,{className:"text-lg uppercase",children:"Lisibilité & contrastes"}),e.jsx(rn,{children:"Ajuste l'écran pour rester lisible en bassin comme en extérieur."})]}),e.jsxs(Mt,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-4 rounded-lg border bg-muted/30 p-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm font-semibold uppercase",children:"Mode piscine"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Contraste renforcé et lisibilité optimisée."})]}),e.jsx(Pt,{checked:me,onCheckedChange:n=>S(i=>({...i,poolMode:n}))})]}),e.jsxs("div",{className:"flex items-center justify-between gap-4 rounded-lg border bg-muted/30 p-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm font-semibold uppercase",children:"Texte grand"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Police plus large pour lire pendant l'effort."})]}),e.jsx(Pt,{checked:Se,onCheckedChange:n=>S(i=>({...i,largeText:n}))})]})]})]}),e.jsx(Xe,{className:"border border-muted/60 shadow-sm",children:e.jsxs(Mt,{className:"space-y-3 pt-6",children:[e.jsxs("div",{className:"flex items-center gap-3 text-sm text-muted-foreground",children:[e.jsx(ss,{className:"h-4 w-4"}),e.jsx("span",{children:"Les préférences sont enregistrées sur cet appareil."})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 text-xs font-semibold uppercase text-muted-foreground",children:[me&&e.jsx(ut,{variant:"secondary",children:"Mode piscine activé"}),Se&&e.jsx(ut,{variant:"secondary",children:"Texte grand activé"}),!me&&!Se&&e.jsx(ut,{variant:"outline",children:"Réglages par défaut"})]})]})})]}),k==="reader"&&u&&e.jsxs("div",{className:"space-y-5 animate-in fade-in motion-reduce:animate-none pb-40",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{type:"button",onClick:()=>O("list"),className:"flex h-10 w-10 items-center justify-center rounded-full bg-muted/50 text-muted-foreground transition-colors hover:bg-muted active:scale-95","aria-label":"Retour",children:e.jsx(Yt,{className:"h-5 w-5"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-xs font-semibold uppercase tracking-wider text-muted-foreground truncate",children:Ce.find(n=>n.value===$)?.label}),e.jsx("h1",{className:"text-xl font-bold tracking-tight truncate",children:u.title})]})]}),e.jsxs("div",{className:"relative overflow-hidden rounded-2xl bg-gradient-to-br from-primary/10 via-primary/5 to-transparent border border-primary/20 p-5",children:[e.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-primary/10 rounded-full blur-3xl -mr-12 -mt-12"}),e.jsxs("div",{className:"relative space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[v&&e.jsxs("span",{className:"inline-flex items-center gap-1.5 rounded-full bg-primary/20 px-3 py-1 text-xs font-bold uppercase text-primary",children:[e.jsx("span",{className:"h-1.5 w-1.5 rounded-full bg-primary"}),"Assignée"]}),!v&&e.jsx("span",{className:"inline-flex items-center rounded-full bg-muted px-3 py-1 text-xs font-semibold text-muted-foreground",children:"Catalogue"}),v?.assigned_date&&e.jsxs("span",{className:"text-xs text-muted-foreground",children:["Prévue le ",xt(new Date(v.assigned_date),"dd MMM",{locale:ht})]})]}),u.description&&e.jsx("p",{className:"text-sm text-muted-foreground leading-relaxed",children:u.description}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex h-9 w-9 items-center justify-center rounded-xl bg-background/80",children:e.jsx(Ye,{className:"h-4 w-4 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-bold leading-none",children:Z.length}),e.jsx("p",{className:"text-[10px] uppercase text-muted-foreground font-semibold",children:"Exercices"})]})]}),e.jsx("div",{className:"h-8 w-px bg-border"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex h-9 w-9 items-center justify-center rounded-xl bg-background/80",children:e.jsx(is,{className:"h-4 w-4 text-muted-foreground"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-bold leading-none",children:Ce.find(n=>n.value===$)?.label}),e.jsx("p",{className:"text-[10px] uppercase text-muted-foreground font-semibold",children:"Cycle"})]})]})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between gap-2 pt-1",children:[e.jsxs("span",{className:"text-xs font-semibold uppercase tracking-wider text-muted-foreground",children:[Z.length," exercice",Z.length>1?"s":""]}),e.jsx("div",{className:"flex-1 h-px bg-border"})]}),e.jsxs("div",{className:"space-y-2",children:[Z.map((n,i)=>{const f=we.get(n.exercise_id),N=Number(n.percent_1rm),D=Number.isFinite(N)&&N>0,P=D?xe?.find(We=>We.exercise_id===n.exercise_id)?.weight??0:0,pe=D?Math.round(P*(N/100)):0,ie=D?pe>0?`${pe} kg (${N}% 1RM)`:`${N}% 1RM`:null,he=n.notes?.trim(),ve=nn(n.sets),de=nn(n.reps),Ae=Ys(n.rest_seconds);return e.jsxs(At,{children:[e.jsx(Hn,{asChild:!0,children:e.jsxs("button",{type:"button",className:"w-full flex items-center gap-3 rounded-xl border bg-card px-3 py-3 text-left transition-all active:scale-[0.98] hover:border-primary/50 hover:shadow-sm",children:[e.jsx("div",{className:"flex h-7 w-7 shrink-0 items-center justify-center rounded-full bg-primary text-xs font-bold text-primary-foreground",children:i+1}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsx("p",{className:"font-semibold text-sm truncate",children:f?.nom_exercice??n.exercise_name??"Exercice"})}),e.jsxs("div",{className:"flex items-center gap-2 shrink-0 text-xs font-medium text-muted-foreground",children:[e.jsxs("span",{className:"font-mono",children:[ve,"×",de]}),e.jsx("span",{className:"text-border",children:"|"}),e.jsx("span",{className:"font-mono",children:Ae}),e.jsx(Lt,{className:"h-4 w-4 text-muted-foreground/50"})]})]})}),e.jsxs(It,{side:"bottom",className:"max-h-[90vh] overflow-y-auto rounded-t-3xl pb-8",children:[e.jsx(Ot,{className:"text-left pb-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex h-10 w-10 shrink-0 items-center justify-center rounded-full bg-primary text-sm font-bold text-primary-foreground",children:i+1}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx($t,{className:"text-xl leading-tight",children:f?.nom_exercice??n.exercise_name??"Exercice"}),f?.exercise_type&&e.jsx("p",{className:"text-sm text-muted-foreground mt-0.5",children:f.exercise_type})]})]})}),e.jsxs("div",{className:"space-y-4",children:[f?.illustration_gif&&e.jsx("div",{className:"rounded-xl overflow-hidden bg-muted/20 border aspect-video flex items-center justify-center",children:e.jsx("img",{src:f.illustration_gif,alt:f.nom_exercice??"Exercice",className:"w-full h-full max-h-36 object-contain",loading:"lazy",decoding:"async"})}),f?.description&&e.jsx("div",{className:"text-sm text-muted-foreground leading-relaxed",children:f.description}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:"rounded-xl bg-muted/40 p-3 text-center",children:[e.jsx("p",{className:"text-2xl font-bold leading-none",children:ve}),e.jsx("p",{className:"text-[10px] uppercase text-muted-foreground font-semibold mt-1",children:"Séries"})]}),e.jsxs("div",{className:"rounded-xl bg-muted/40 p-3 text-center",children:[e.jsx("p",{className:"text-2xl font-bold leading-none",children:de}),e.jsx("p",{className:"text-[10px] uppercase text-muted-foreground font-semibold mt-1",children:"Reps"})]}),e.jsxs("div",{className:"rounded-xl bg-muted/40 p-3 text-center",children:[e.jsx("p",{className:"text-lg font-bold leading-none",children:ie??"—"}),e.jsx("p",{className:"text-[10px] uppercase text-muted-foreground font-semibold mt-1",children:"Charge"})]}),e.jsxs("div",{className:"rounded-xl bg-muted/40 p-3 text-center",children:[e.jsx("p",{className:"text-lg font-bold leading-none",children:Ae}),e.jsx("p",{className:"text-[10px] uppercase text-muted-foreground font-semibold mt-1",children:"Repos"})]})]}),he&&e.jsxs("div",{className:"rounded-xl bg-primary/5 border border-primary/20 p-4",children:[e.jsx("div",{className:"text-[10px] uppercase text-primary font-semibold mb-1",children:"Notes coach"}),e.jsx("div",{className:"text-sm text-foreground",children:he})]})]})]})]},`${n.exercise_id}-${i}`)}),Z.length===0&&e.jsx("div",{className:"p-6 border-2 border-dashed rounded-xl text-center text-muted-foreground",children:"Aucun exercice disponible pour cette séance."})]}),e.jsx(Nn,{children:e.jsxs(L,{className:"flex-1 h-14 rounded-xl font-bold text-base bg-primary hover:bg-primary/90 shadow-lg",onClick:Je,children:[e.jsx(Kt,{className:"h-5 w-5 mr-2"}),"Lancer la séance"]})})]})]}),e.jsxs(Wt,{value:"history",className:"space-y-4 pt-4",children:[e.jsxs("div",{className:"grid gap-3 md:grid-cols-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(et,{htmlFor:"strength-history-status",children:"Statut"}),e.jsxs(zn,{value:z,onValueChange:p,children:[e.jsx(Bn,{id:"strength-history-status",children:e.jsx(qn,{placeholder:"Tous"})}),e.jsxs(Vn,{children:[e.jsx(pt,{value:"all",children:"Tous"}),e.jsx(pt,{value:"in_progress",children:"En cours"}),e.jsx(pt,{value:"completed",children:"Terminé"}),e.jsx(pt,{value:"abandoned",children:"Abandonné"})]})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(et,{htmlFor:"strength-history-from",children:"Du"}),e.jsx(St,{id:"strength-history-from",type:"date",value:V,onChange:n=>W(n.target.value)})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(et,{htmlFor:"strength-history-to",children:"Au"}),e.jsx(St,{id:"strength-history-to",type:"date",value:X,onChange:n=>B(n.target.value)})]})]}),_.map(n=>e.jsx(Xe,{className:"group hover:border-primary/50 transition-colors",children:e.jsxs(Tt,{className:"pb-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx(Dt,{className:"text-base font-bold uppercase",children:xt(new Date(n.started_at||n.date||n.created_at||new Date),"dd MMM yyyy",{locale:ht})}),e.jsxs("div",{className:"text-sm font-mono font-bold text-muted-foreground group-hover:text-primary",children:[n.duration??0," min"]})]}),e.jsxs("div",{className:"flex gap-2 text-xs font-bold text-muted-foreground",children:[e.jsxs("span",{children:["Difficulté ",n.feeling??n.rpe??0,"/5"]}),e.jsx("span",{children:"•"}),e.jsxs("span",{children:[n.logs?.length||0," Séries"]})]})]})},n.id)),_.length===0&&e.jsx("div",{className:"text-center text-muted-foreground py-10",children:"Aucun historique."}),_e.hasNextPage&&e.jsx(L,{variant:"outline",size:"sm",className:"w-full",onClick:()=>_e.fetchNextPage(),disabled:_e.isFetchingNextPage,children:_e.isFetchingNextPage?"Chargement...":"Charger plus"})]})]})]})})}export{kt as buildInProgressRunCache,Js as createInProgressRun,vr as default,_n as orderStrengthItems,Gs as resetStrengthRunState};
