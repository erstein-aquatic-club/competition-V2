import{r as a,j as e,c as St,u as ve,d as ge,a as Fe}from"./vendor-query-BiSH4r2z.js";import{a as U}from"./api-BR6TazbR.js";import{c as we,b as qt,W as nt,X as $e,F as Mt,u as Rt,d as Qt,s as Ve,B as zt,T as Jt}from"./index-Cj4Ssg6c.js";import{P as Ut,C as Ye,M as Ht,a as Vt,b as Yt}from"./CalendarGrid-l6y2skX7.js";import{A as Ee,B as Wt}from"./BottomActionBar-KLMcxMvf.js";import{a as Xt,s as Gt,l as ot}from"./animations-CrcLFysI.js";import{d as at}from"./design-tokens-CKgCpdH6.js";import{C as Ct}from"./chevron-right-1Cy1mjxI.js";import{m as de}from"./proxy-Dh0N-Z8G.js";import{C as Zt}from"./chevron-down-BzK_i_NW.js";import{C as rt}from"./check-BQQC0n9Y.js";import{P as Be}from"./plus-CA-2uVIx.js";import{A as lt,H as ct,f as We,p as es}from"./swimConsultationUtils-DnfuTvlj.js";import{T as Xe}from"./trash-2-DpQdiJwt.js";import{T as dt}from"./timer-BOz96-p8.js";import{P as ts}from"./pencil-CAuBc6VU.js";import{C as ss}from"./circle-alert-CoK70hgh.js";import"./vendor-react-BzrpNAyj.js";import"./swim-BRZGi7hR.js";import"./vendor-supabase-DFPLkPj_.js";import"./chevron-left-D119ORtr.js";import"./loader-circle-Bn3uL7ce.js";import"./circle-check-DnOTUGx2.js";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ns=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],ut=we("info",ns);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rs=[["path",{d:"M5 12h14",key:"1ays0h"}]],_t=we("minus",rs);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const is=[["path",{d:"M14 17H5",key:"gfn3mx"}],["path",{d:"M19 7h-9",key:"6i9tg"}],["circle",{cx:"17",cy:"17",r:"3",key:"18b49y"}],["circle",{cx:"7",cy:"7",r:"3",key:"dfmy0x"}]],mt=we("settings-2",is);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const os=[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]],as=we("sun",os);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ls=[["path",{d:"m16 11 2 2 4-4",key:"9rsbq5"}],["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],xt=we("user-check",ls);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cs=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]],Ke=we("user-x",cs),Ge={NL:"",DOS:"",BR:"",PAP:"",QN:""};function pt(t){return String(t).padStart(2,"0")}function ft(t){return`${t.getFullYear()}-${pt(t.getMonth()+1)}-${pt(t.getDate())}`}function bt(t){return new Date(t.getFullYear(),t.getMonth(),1)}function gt(t,s){const r=new Date(t);return r.setDate(r.getDate()+s),r}function Ze(t){return(t.getDay()+6)%7}function Oe(t){const s=Number(t);return Number.isFinite(s)?Math.round(s/1e3*100)/100:0}function ds(t){const s=Number(t);return Number.isFinite(s)?Math.round(s*1e3):0}function us(t){return t?String(t).replaceAll(`\r
`,`
`).split(`
`).map(r=>r.trim()).filter(Boolean).flatMap(r=>{const i=r.replace(/^[•\\-–—]\\s*/,"").trim();return i?[i]:[]}):[]}function ms(t){if(!t)return null;const r=String(t).match(/(\\d+(?:[\\.,]\\d+)?)\\s*(km|m)\\b/i);if(!r)return null;const i=Number(String(r[1]).replace(",","."));return Number.isFinite(i)?r[2].toLowerCase()==="m"?Oe(i):i:null}function xs(t,s){const r=t?.slot??t?.session_slot??t?.assigned_slot??t?.time_slot??t?.timeOfDay??t?.slot_key??t?.slotKey,i=String(r||"").toLowerCase();if(i.includes("mat")||i.includes("morning")||i==="am")return"AM";if(i.includes("soir")||i.includes("evening")||i==="pm")return"PM";const p=`${t?.title??""} ${t?.description??""}`.toLowerCase();return p.includes("matin")||p.includes(" am ")||p.includes("(am)")?"AM":p.includes("soir")||p.includes(" pm ")||p.includes("(pm)")?"PM":s===0?"AM":"PM"}function ps(t){const s=t?.assigned_date??t?.date??t?.day??t?.scheduled_for??t?.scheduledAt??null;if(!s)return null;const r=String(s),i=r.length>=10?r.slice(0,10):r;return/\d{4}-\d{2}-\d{2}/.test(i)?i:null}function fs(t){if(Array.isArray(t?.items)){let p=0;for(const m of t.items){const h=Number(m?.distance);if(!Number.isFinite(h)||h<=0)continue;const x=m?.raw_payload,j=Number(x?.exercise_repetitions),y=Number(x?.block_repetitions),w=Number.isFinite(j)&&j>0?j:1,C=Number.isFinite(y)&&y>0?y:1;p+=h*w*C}if(p>0)return Oe(p)}const s=t?.distance_meters??t?.distanceMeters??t?.meters??t?.planned_meters??t?.plannedMeters??t?.distance??null;if(s!=null&&Number.isFinite(Number(s))){const p=Number(s);return p>0&&p<=50?p:Oe(p)}const r=t?.km??t?.distance_km??t?.distanceKm??t?.planned_km??t?.plannedKm??null;if(r!=null&&Number.isFinite(Number(r)))return Number(r);const i=ms(`${t?.title??""} ${t?.description??""}`);return i??null}function bs(t){if(!Array.isArray(t)||t.length===0)return null;const s={crawl:"NL",dos:"DOS",brasse:"BR",pap:"PAP","4n":"QN"},r={NL:0,DOS:0,BR:0,PAP:0,QN:0};for(const p of t){const m=Number(p?.distance);if(!Number.isFinite(m)||m<=0)continue;const h=p?.raw_payload,x=Number(h?.exercise_repetitions),j=Number(h?.block_repetitions),y=Number.isFinite(x)&&x>0?x:1,w=Number.isFinite(j)&&j>0?j:1,C=m*y*w,Y=h?.exercise_stroke??h?.stroke??"crawl",te=s[String(Y).toLowerCase()];te?r[te]+=C:r.NL+=C}return Object.values(r).some(p=>p>0)?r:null}function ht(t){const s=Number(t);if(!Number.isFinite(s))return"—";const r=Math.round(s*100)/100,i=String(r);return i.endsWith(".0")?i.slice(0,-2):i}function gs(){const t={};for(let s=0;s<7;s++)t[s]={AM:!0,PM:!0};return t}function et(t){if(!t)return null;try{return JSON.parse(t)}catch{return null}}function hs({sessions:t,assignments:s,userId:r,user:i}){const p=`swim-dashboard-v2:${r??i??"anon"}`,m=`${p}:presenceDefaults`,h=`${p}:attendanceOverrides`,x=`${p}:stableFields`,[j,y]=a.useState(()=>gs()),[w,C]=a.useState({}),[Y,te]=a.useState(90);a.useEffect(()=>{if(typeof window>"u")return;const l=et(window.localStorage.getItem(m));l&&y(l);const c=et(window.localStorage.getItem(h));c&&C(c);const u=et(window.localStorage.getItem(x));u?.duration&&Number.isFinite(u.duration)&&u.duration>=30&&u.duration<=240&&te(u.duration)},[m,h,x]),a.useEffect(()=>{typeof window>"u"||window.localStorage.setItem(m,JSON.stringify(j))},[j,m]),a.useEffect(()=>{typeof window>"u"||window.localStorage.setItem(h,JSON.stringify(w))},[w,h]),a.useEffect(()=>{typeof window>"u"||window.localStorage.setItem(x,JSON.stringify({duration:Y}))},[Y,x]);const re=a.useMemo(()=>new Date,[]),[ue,pe]=a.useState(()=>bt(new Date)),[W,me]=a.useState(()=>ft(new Date)),[G,d]=a.useState(!1),[b,A]=a.useState(!1),[M,B]=a.useState(!1),[q,ie]=a.useState(null),[he,fe]=a.useState(!1),[ke,F]=a.useState(null),[T,P]=a.useState(!1),[K,k]=a.useTransition(),E=a.useMemo(()=>(Array.isArray(s)?s:[]).filter(c=>c?.session_type==="swim"),[s]),H=a.useMemo(()=>{const l=new Map;for(const c of E){const u=ps(c);u&&(l.has(u)||l.set(u,[]),l.get(u).push(c))}for(const[c,u]of l.entries())u.sort((N,v)=>Number(N?.id??0)-Number(v?.id??0)),l.set(c,u);return l},[E]),R=a.useMemo(()=>{const l=Array.isArray(t)?t:[],c={};for(const u of l){const N=String(u?.date??"").slice(0,10),v=u?.slot==="Soir"?"PM":"AM";c[`${N}__${v}`]=u}return c},[t]),$=a.useRef(new Map);a.useEffect(()=>{$.current.clear()},[H]);const _=a.useCallback(l=>{const c=$.current;if(c.has(l))return c.get(l);const u=[{id:`${l}__AM`,iso:l,slotKey:"AM",title:"Séance vide",km:null,details:[],isEmpty:!0},{id:`${l}__PM`,iso:l,slotKey:"PM",title:"Séance vide",km:null,details:[],isEmpty:!0}],N=H.get(l)??[],v=new Set;return N.forEach((g,I)=>{const z=g,ne=xs(z,I);if(v.has(ne))return;const J=ne==="AM"?0:1,ye=fs(z),Qe=Array.isArray(z?.details)?z.details.map(String):us(g?.description);u[J]={id:`${l}__${ne}`,iso:l,slotKey:ne,title:String(g?.title??"Séance coach"),km:ye,details:Qe,assignmentId:typeof g?.id=="number"?g.id:Number(g?.id)||void 0,isEmpty:!1},v.add(ne)}),c.set(l,u),u},[H]),Q=a.useCallback((l,c)=>{const u=Ze(c),N=!!j?.[u]?.[l.slotKey],v=w[l.id];return v==="present"?{status:"present",expected:!0,expectedByDefault:N}:v==="absent"?{status:"absent",expected:!0,expectedByDefault:N}:N?{status:"present",expected:!0,expectedByDefault:N}:{status:"not_expected",expected:!1,expectedByDefault:N}},[w,j]),X=a.useMemo(()=>bt(ue),[ue]),xe=a.useMemo(()=>{const l=Ze(X),c=gt(X,-l),u=[];for(let N=0;N<42;N++)u.push(gt(c,N));return u},[X]),Z=a.useMemo(()=>{const l={};for(const c of xe){const u=ft(c),N=_(u);let v=0,g=0;const I=[];for(const z of N){const ne=Q(z,c);if(!ne.expected){I.push({slotKey:z.slotKey,expected:!1,completed:!1,absent:!1});continue}v+=1;const J=!!R[z.id],ye=ne.status==="absent";J&&(g+=1),I.push({slotKey:z.slotKey,expected:!0,completed:J,absent:ye})}l[u]={completed:g,total:v,slots:I}}return l},[xe,_,Q,R]),L=a.useMemo(()=>{const[l,c,u]=W.split("-").map(Number);return new Date(l,c-1,u)},[W]),ee=a.useMemo(()=>_(W),[_,W]),oe=Z[W]||{completed:0,total:2,slots:[{slotKey:"AM",expected:!0,completed:!1,absent:!1},{slotKey:"PM",expected:!0,completed:!1,absent:!1}]},Se=a.useMemo(()=>{const l=Array.isArray(t)?t:[];let c=0;for(const u of l){const N=String(u?.date??"").slice(0,10),v=u?.slot==="Soir"?"PM":"AM",g=`${N}__${v}`;if(w[g]==="absent")continue;const I=Ze(new Date(N));(j?.[I]?.[v]||w[g]==="present")&&Number.isFinite(Number(u?.distance))&&(c+=Number(u.distance))}return ht(Oe(c))},[t,w,j]),be=a.useMemo(()=>{const l=ee;let c=0;for(const u of l){const N=Q(u,L);if(!N.expected||N.status==="absent")continue;const v=R[u.id];v&&Number.isFinite(Number(v?.distance))&&(c+=Number(v.distance))}return ht(Oe(c))},[ee,Q,L,R]),Me=a.useMemo(()=>q&&R[q]||null,[q,R]),ae=a.useMemo(()=>{const l=Me||{},c=l?.stroke_distances,u=c?{NL:c.NL?String(c.NL):"",DOS:c.DOS?String(c.DOS):"",BR:c.BR?String(c.BR):"",PAP:c.PAP?String(c.PAP):"",QN:c.QN?String(c.QN):""}:Ge;return{difficulty:l?.effort??null,fatigue_end:l?.fatigue??l?.feeling??null,performance:l?.performance??l?.feeling??null,engagement:l?.engagement??l?.feeling??null,comment:String(l?.comments??""),distanceMeters:Number.isFinite(Number(l?.distance))?Number(l.distance):null,showStrokeDetail:!!(c&&Object.values(c).some(N=>N&&N>0)),strokes:u,exerciseLogs:[]}},[Me]),[Re,se]=a.useState(()=>({difficulty:null,fatigue_end:null,performance:null,engagement:null,comment:"",distanceMeters:null,showStrokeDetail:!1,strokes:Ge,exerciseLogs:[]}));return a.useEffect(()=>{const l=ee.find(c=>c.id===q);if(l){const c=l.km!=null?ds(l.km):5e3;let u=Ge;if(l.assignmentId){const v=(s??[]).find(g=>g.id===l.assignmentId);if(v?.items){const g=bs(v.items);g&&(u={NL:String(g.NL||""),DOS:String(g.DOS||""),BR:String(g.BR||""),PAP:String(g.PAP||""),QN:String(g.QN||"")})}}const N=Object.values(ae.strokes).some(v=>v&&Number(v)>0);se(v=>({...v,...ae,distanceMeters:ae.distanceMeters==null?c:ae.distanceMeters,strokes:N?ae.strokes:u,showStrokeDetail:N||Object.values(u).some(g=>g&&Number(g)>0)}));return}se(c=>({...c,...ae}))},[ae,q,ee,s]),a.useEffect(()=>{G&&T&&oe.total>0&&oe.completed>=oe.total&&(d(!1),ie(null),fe(!1),P(!1))},[G,T,oe.completed,oe.total]),{today:re,monthCursor:ue,selectedISO:W,drawerOpen:G,settingsOpen:b,infoOpen:M,activeSessionId:q,detailsOpen:he,selectedDayIndex:ke,isPending:K,presenceDefaults:j,attendanceOverrideBySessionId:w,stableDurationMin:Y,draftState:Re,gridDates:xe,completionByISO:Z,selectedDate:L,sessionsForSelectedDay:ee,selectedDayStatus:oe,globalKm:Se,dayKm:be,logsBySessionId:R,setMonthCursor:pe,setSelectedISO:me,setDrawerOpen:d,setSettingsOpen:A,setInfoOpen:B,setActiveSessionId:ie,setDetailsOpen:fe,setSelectedDayIndex:F,setPresenceDefaults:y,setAttendanceOverrideBySessionId:C,setStableDurationMin:te,setDraftState:se,setAutoCloseArmed:P,startTransition:k,getSessionStatus:Q,getSessionsForISO:_}}function tt(...t){return t.filter(Boolean).join(" ")}const yt={NL:"NL",DOS:"Dos",BR:"Brasse",PAP:"Pap",QN:"4N"};function ys({strokes:t,showStrokeDetail:s,disabled:r=!1,onToggle:i,onChange:p}){return e.jsxs("div",{className:"mt-3",children:[e.jsxs("button",{type:"button",disabled:r,onClick:i,className:tt("flex w-full items-center justify-between rounded-2xl border px-3 py-2 text-sm font-semibold transition",r?"text-muted-foreground border-border cursor-not-allowed":"text-foreground border-border hover:bg-muted"),children:[e.jsx("span",{children:"Détail par nage"}),e.jsx(Ct,{className:tt("h-4 w-4 transition-transform",s&&"rotate-90")})]}),s&&e.jsx("div",{className:"mt-2 grid grid-cols-5 gap-2",children:Object.keys(yt).map(m=>e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"block text-center text-xs font-medium text-muted-foreground",children:yt[m]}),e.jsx("input",{type:"number",inputMode:"numeric",min:0,step:100,disabled:r,value:t[m],onChange:h=>p({...t,[m]:h.target.value}),placeholder:"0",className:tt("w-full rounded-xl border px-1 py-2 text-center text-sm outline-none",r?"bg-muted text-muted-foreground":"bg-card text-foreground border-border focus:ring-2 focus:ring-foreground/10")}),e.jsx("div",{className:"text-center text-[10px] text-muted-foreground",children:"m"})]},m))})]})}function O(...t){return t.filter(Boolean).join(" ")}function Ns(t){return t.toLocaleDateString("fr-FR",{weekday:"long",day:"numeric",month:"long",year:"numeric"})}function qe(t){const s=Number(t);if(!Number.isFinite(s))return"—";const r=Math.round(s*100)/100,i=String(r);return i.endsWith(".0")?i.slice(0,-2):i}function Nt(t){const s=Number(t);return Number.isFinite(s)?Math.round(s/1e3*100)/100:0}function js(t){const s=Number(t);return Number.isFinite(s)?Math.round(s*1e3):0}const st=[{key:"difficulty",label:"Difficulté",mode:"hard"},{key:"fatigue_end",label:"Fatigue fin",mode:"hard"},{key:"performance",label:"Perf perçue",mode:"good"},{key:"engagement",label:"Engagement",mode:"good"}],vs=[{key:"AM",label:"Matin",Icon:as},{key:"PM",label:"Soir",Icon:Ht}];function Te({children:t}){return e.jsx("span",{className:"inline-flex items-center rounded-full bg-muted px-2 py-0.5 text-xs font-semibold text-muted-foreground",children:t})}function De({onClick:t,label:s,children:r,tone:i="neutral",disabled:p}){const m={neutral:"bg-background border-border text-foreground hover:bg-muted",dark:"bg-foreground border-foreground text-background hover:opacity-90",sky:"bg-primary/10 border-primary/30 text-primary hover:bg-primary/20"};return e.jsxs("button",{type:"button",onClick:t,disabled:p,className:O("inline-flex items-center justify-center rounded-2xl border p-2 transition",m[i],p&&"opacity-50 cursor-not-allowed hover:bg-background"),"aria-label":s,title:s,children:[r,e.jsx("span",{className:"sr-only",children:s})]})}function ws(t,s){const r=Number(s);return!Number.isFinite(r)||r<1||r>5?"neutral":t==="hard"?{1:"bg-intensity-1 border-intensity-1 text-white",2:"bg-intensity-2 border-intensity-2 text-white",3:"bg-intensity-3 border-intensity-3 text-white",4:"bg-intensity-4 border-intensity-4 text-white",5:"bg-intensity-5 border-intensity-5 text-white"}[r]:{1:"bg-intensity-5 border-intensity-5 text-white",2:"bg-intensity-4 border-intensity-4 text-white",3:"bg-intensity-3 border-intensity-3 text-white",4:"bg-intensity-2 border-intensity-2 text-white",5:"bg-intensity-1 border-intensity-1 text-white"}[r]}function ks({plannedMeters:t,valueMeters:s,onChange:r,disabled:i}){const x=Number.isFinite(Number(s))?Number(s):t,j=x-t;return e.jsxs("div",{className:O("mt-4 rounded-3xl border px-4 py-3",i?"bg-muted border-border":"bg-card border-border"),children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:O("text-xs font-semibold",i?"text-muted-foreground":"text-foreground"),children:"Ajuster kilométrage"}),j!==0&&e.jsx("div",{className:O("text-xs font-semibold px-2 py-0.5 rounded-full",j>0?"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400":"bg-orange-100 text-orange-800 dark:bg-orange-900/30 dark:text-orange-400"),children:j>0?`+${j}m`:`${j}m`})]}),e.jsx("div",{className:"text-center mb-3",children:e.jsxs("div",{className:O("text-xs","text-muted-foreground"),children:["Planifié : ",t,"m (",qe(Nt(t))," km)"]})}),e.jsxs("div",{className:"flex items-center justify-center gap-3",children:[e.jsx("button",{type:"button",disabled:i||x-100<0,onClick:()=>r(x-100),className:O("h-11 w-11 rounded-2xl border flex items-center justify-center transition-colors",i?"bg-muted border-border text-muted-foreground cursor-not-allowed":"bg-card border-border text-foreground hover:bg-muted active:scale-95"),"aria-label":"-100m",children:e.jsx(_t,{className:"h-5 w-5"})}),e.jsxs("div",{className:"min-w-[140px] text-center",children:[e.jsxs("div",{className:O("text-2xl font-bold",i?"text-muted-foreground":"text-foreground"),children:[x,"m"]}),e.jsxs("div",{className:O("text-sm font-medium mt-0.5",i?"text-muted-foreground":"text-primary"),children:[qe(Nt(x))," km"]})]}),e.jsx("button",{type:"button",disabled:i||x+100>3e4,onClick:()=>r(x+100),className:O("h-11 w-11 rounded-2xl border flex items-center justify-center transition-colors",i?"bg-muted border-border text-muted-foreground cursor-not-allowed":"bg-card border-border text-foreground hover:bg-muted active:scale-95"),"aria-label":"+100m",children:e.jsx(Be,{className:"h-5 w-5"})})]})]})}function Ss({onMark:t}){const[s,r]=a.useState(!1),[i,p]=a.useState("");return s?e.jsxs("div",{className:"flex gap-2 mb-3",children:[e.jsx("input",{type:"text",placeholder:"Motif (optionnel)",value:i,onChange:m=>p(m.target.value),className:"flex-1 rounded-md border border-input bg-transparent px-3 py-1.5 text-sm",autoFocus:!0}),e.jsx("button",{type:"button",onClick:()=>{t(i||void 0),r(!1),p("")},className:"rounded-md bg-primary px-3 py-1.5 text-sm font-medium text-primary-foreground",children:"OK"})]}):e.jsx("button",{type:"button",className:"w-full rounded-xl border border-dashed border-muted-foreground/30 p-2.5 mb-3 text-sm text-muted-foreground hover:bg-muted/50 transition-colors",onClick:()=>r(!0),children:"Marquer indisponible"})}function Ms({open:t,selectedDate:s,sessionsForSelectedDay:r,selectedDayStatus:i,dayKm:p,activeSessionId:m,detailsOpen:h,draftState:x,saveState:j,isPending:y,logsBySessionId:w,onClose:C,onDayOffAll:Y,onOpenSession:te,onCloseSession:re,onToggleDetails:ue,onMarkAbsent:pe,onMarkPresent:W,onClearOverride:me,onSaveFeedback:G,onDraftStateChange:d,getSessionStatus:b,isAbsent:A,absenceReason:M,isFutureDate:B,onMarkDayAbsent:q,onRemoveDayAbsence:ie}){const[,he]=qt(),[fe,ke]=a.useState(!1),F=a.useMemo(()=>m&&r.find(T=>T.id===m)||null,[m,r]);return e.jsx(Ee,{children:t&&e.jsxs(e.Fragment,{children:[e.jsx(de.div,{className:"fixed inset-0 z-overlay bg-black/30",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:C}),e.jsx(de.div,{className:O("fixed z-modal bg-background shadow-2xl","left-0 right-0 bottom-0 top-auto max-h-[calc(100dvh-env(safe-area-inset-top))] h-[88dvh] rounded-t-3xl","sm:right-0 sm:top-0 sm:left-auto sm:bottom-auto sm:h-full sm:w-full sm:max-w-xl sm:rounded-none"),variants:Xt,initial:"hidden",animate:"visible",exit:"exit",role:"dialog","aria-modal":"true",children:e.jsxs("div",{className:"flex h-full flex-col",children:[e.jsx("div",{className:"px-5 pt-3 sm:hidden",children:e.jsx("div",{className:"mx-auto h-1.5 w-12 rounded-full bg-muted"})}),e.jsxs("div",{className:"sticky top-0 z-10 flex items-center justify-between border-b border-primary/15 bg-background px-4 sm:px-5 py-2.5",children:[e.jsxs("div",{className:"flex items-center gap-2.5 min-w-0",children:[e.jsx("div",{className:"flex items-center justify-center h-7 w-7 rounded-lg bg-primary text-primary-foreground shrink-0",children:e.jsx(nt,{className:"h-3.5 w-3.5"})}),e.jsx("div",{className:"min-w-0",children:e.jsx("div",{className:"truncate text-sm font-display font-bold uppercase italic tracking-tight text-primary",children:Ns(s)})})]}),e.jsx(De,{onClick:C,label:"Fermer",children:e.jsx($e,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"flex-1 overflow-auto p-4 sm:p-5",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center gap-2.5",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"text-lg font-bold text-foreground",children:[p," km"]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:O("h-1.5 w-1.5 rounded-full",i.total>0&&i.completed>=1?"bg-status-success":"bg-muted-foreground/30")}),e.jsx("span",{className:O("h-1.5 w-1.5 rounded-full",i.total>0&&i.completed>=2?"bg-status-success":"bg-muted-foreground/30")})]})]})}),e.jsx(De,{onClick:Y,label:"OFF (absent journée)",tone:"dark",disabled:y,children:e.jsx(Ut,{className:"h-5 w-5"})})]}),B&&q&&ie&&(A?e.jsxs("div",{className:"rounded-xl border border-muted bg-muted/30 p-3 mt-3 mb-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"Marqué indisponible"}),e.jsx("button",{type:"button",onClick:ie,className:"text-xs text-primary hover:underline",children:"Annuler"})]}),M&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:M})]}):e.jsx("div",{className:"mt-3",children:e.jsx(Ss,{onMark:q})})),(()=>{const T=[],P=[];for(const k of r)b(k,s).status==="not_expected"?P.push(k):T.push(k);const K=k=>{const E=b(k,s),H=!!w[k.id],R=E.status==="absent",$=E.status==="not_expected",_=R||$,Q=E.expected&&!H&&!R,X=H?"bg-status-success-bg border-status-success/30":_?"bg-sky-50 border-sky-200":Q?"bg-status-warning-bg border-status-warning/30":"bg-card border-border",xe=vs.find(Z=>Z.key===k.slotKey)?.Icon||Ye;return e.jsx("button",{type:"button",onClick:()=>te(k.id),className:O("w-full rounded-3xl border px-3 py-3 text-left transition",X,"hover:shadow-sm"),children:e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[e.jsx("div",{className:O("h-10 w-10 rounded-2xl border flex items-center justify-center",H?"border-status-success/30 bg-status-success-bg":_?"border-sky-200 bg-sky-100":Q?"border-status-warning/30 bg-status-warning-bg":"border-border bg-muted"),children:e.jsx(xe,{className:"h-5 w-5 text-foreground"})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"truncate text-sm font-semibold text-foreground",children:k.title}),e.jsxs("div",{className:"mt-1 flex items-center gap-2",children:[k.isEmpty?e.jsx(Te,{children:"Vide"}):e.jsxs(Te,{children:[qe(k.km)," km"]}),H&&e.jsxs("span",{className:"inline-flex items-center text-emerald-800",children:[e.jsx(rt,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Présent"})]}),_&&!H&&e.jsxs("span",{className:"inline-flex items-center text-sky-800",children:[e.jsx(Ke,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Absent"})]}),Q&&e.jsxs("span",{className:"inline-flex items-center text-orange-900",children:[e.jsx(Ye,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"En attente"})]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[$&&e.jsx(De,{onClick:Z=>{Z.stopPropagation(),W(k.id)},label:"Je suis venu",disabled:y,children:e.jsx(xt,{className:"h-5 w-5"})}),E.expected&&!H&&!R&&e.jsx(De,{onClick:Z=>{Z.stopPropagation(),pe(k.id)},label:"Absent",tone:"sky",disabled:y,children:e.jsx(Ke,{className:"h-5 w-5"})})]})]})},k.id)};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mt-4 grid gap-2",children:T.map(K)}),P.length>0&&e.jsxs("div",{className:"mt-3",children:[e.jsxs("button",{type:"button",onClick:()=>ke(k=>!k),className:"flex w-full items-center gap-2 rounded-2xl px-3 py-2 text-xs font-semibold text-muted-foreground hover:bg-muted transition",children:[e.jsx(Zt,{className:O("h-4 w-4 transition-transform",fe&&"rotate-180")}),"Autres séances (",P.length,")"]}),e.jsx(Ee,{children:fe&&e.jsx(de.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.2},className:"overflow-hidden",children:e.jsx("div",{className:"mt-1 grid gap-2",children:P.map(K)})})})]})]})})(),e.jsx(Ee,{children:F&&e.jsx(de.div,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},exit:{opacity:0,y:8},transition:{duration:at.normal},className:"mt-4 rounded-3xl border border-border bg-card overflow-hidden",children:(()=>{const T=b(F,s),P=T.status==="absent",K=T.status==="not_expected",k=!!w[F.id],E=T.expected&&!P,H=P?"Annuler":K?"Je suis venu":"Absent",R=P?()=>me(F.id):K?()=>W(F.id):()=>pe(F.id),$=js(F.km??0);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-border",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"truncate text-sm font-semibold text-foreground",children:F.title}),e.jsxs("div",{className:"mt-1 flex items-center gap-2",children:[F.isEmpty?e.jsx(Te,{children:"Vide"}):e.jsxs(Te,{children:[qe(F.km)," km"]}),k?e.jsxs("span",{className:"inline-flex items-center text-emerald-800",children:[e.jsx(rt,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Présent"})]}):P||K?e.jsxs("span",{className:"inline-flex items-center text-sky-800",children:[e.jsx(Ke,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Absent"})]}):e.jsxs("span",{className:"inline-flex items-center text-orange-900",children:[e.jsx(Ye,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"En attente"})]})]})]}),e.jsx(De,{onClick:re,label:"Retour",children:e.jsx($e,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 p-3",children:[e.jsxs("button",{type:"button",onClick:R,className:O("rounded-2xl px-3 py-3 text-sm font-semibold border transition inline-flex items-center justify-center gap-2",K?"bg-foreground text-background border-foreground hover:opacity-90":"bg-card text-foreground border-border hover:bg-muted"),children:[K?e.jsx(xt,{className:"h-4 w-4"}):e.jsx(Ke,{className:"h-4 w-4"}),H]}),e.jsxs("button",{type:"button",onClick:ue,className:"rounded-2xl px-3 py-3 text-sm font-semibold border border-border bg-card hover:bg-muted inline-flex items-center justify-center gap-2",children:[e.jsx(Mt,{className:"h-4 w-4"}),"Fiche"]})]}),e.jsx(Ee,{children:h&&e.jsxs(de.div,{initial:{opacity:0,y:6},animate:{opacity:1,y:0},exit:{opacity:0,y:6},transition:{duration:at.normal},className:"mx-3 mb-3 rounded-2xl border border-border bg-muted p-3",children:[F.details?.length?e.jsx("ul",{className:"list-disc pl-5 space-y-1 text-sm text-foreground",children:F.details.map((_,Q)=>e.jsx("li",{children:_},Q))}):e.jsx("div",{className:"text-sm text-muted-foreground",children:F.assignmentId?"Séance coach — détails dans la fiche.":"Aucun détail pour ce créneau."}),e.jsx("div",{className:"mt-3",children:e.jsx("button",{type:"button",onClick:()=>he(F.assignmentId?`/swim-session?assignmentId=${F.assignmentId}`:"/swim-session"),className:"w-full rounded-2xl border border-border bg-card px-3 py-2 text-sm font-semibold text-foreground hover:bg-muted",children:F.assignmentId?"Ouvrir la fiche complète":"Saisir mes détails techniques"})})]})}),e.jsxs("div",{className:"px-4 pb-4",children:[!E&&e.jsx("div",{className:"mb-3 rounded-2xl bg-sky-50 text-sky-900 px-3 py-2 text-xs",children:P?"Absent: aucun ressenti.":'Non prévu: appuyez "Je suis venu".'}),e.jsxs(de.div,{className:"space-y-4",variants:Gt,initial:"hidden",animate:"visible",children:[st.map(_=>{const Q=x[_.key];return e.jsxs(de.div,{className:"space-y-2",variants:ot,children:[e.jsx("div",{className:O("text-sm font-semibold",E?"text-foreground":"text-muted-foreground"),children:_.label}),e.jsx("div",{className:"flex items-center gap-2",children:[1,2,3,4,5].map(X=>{const xe=Q===X;return e.jsx("button",{type:"button",disabled:!E,onClick:()=>d({...x,[_.key]:X}),className:O("h-11 w-11 rounded-2xl border text-sm font-semibold transition",E?xe?ws(_.mode,X):"bg-card text-foreground border-border hover:bg-muted":"bg-muted text-muted-foreground border-border cursor-not-allowed"),children:X},X)})})]},_.key)}),e.jsxs(de.div,{className:"space-y-2",variants:ot,children:[e.jsx("div",{className:O("text-sm font-semibold",E?"text-foreground":"text-muted-foreground"),children:"Commentaire"}),e.jsx("textarea",{value:x.comment,onChange:_=>d({...x,comment:_.target.value}),disabled:!E,rows:3,placeholder:"Sensations, points techniques…",className:O("w-full resize-none rounded-3xl border px-4 py-3 text-sm outline-none",E?"bg-card text-foreground border-border focus:ring-2 focus:ring-foreground/10":"bg-muted text-muted-foreground border-border")})]})]}),e.jsx(ks,{plannedMeters:$,valueMeters:x.distanceMeters,onChange:_=>d({...x,distanceMeters:_}),disabled:!E}),e.jsx(ys,{strokes:x.strokes,showStrokeDetail:x.showStrokeDetail,disabled:!E,onToggle:()=>d({...x,showStrokeDetail:!x.showStrokeDetail}),onChange:_=>d({...x,strokes:_})})]})]})})()},F.id)})]}),F&&(()=>{const T=b(F,s),P=T.expected&&T.status!=="absent";return e.jsxs(Wt,{saveState:j,position:"static",children:[e.jsx("button",{type:"button",onClick:G,disabled:y||!P||!st.every(K=>Number.isInteger(x[K.key])),className:O("rounded-2xl px-4 py-3 text-sm font-semibold transition flex-1",y||!P?"bg-muted text-muted-foreground cursor-not-allowed":st.every(K=>Number.isInteger(x[K.key]))?"bg-status-success text-white hover:opacity-90":"bg-status-success-bg text-status-success cursor-not-allowed"),children:"Valider"}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["→"," km"]})]})})()]})})]})})}function Cs(...t){return t.filter(Boolean).join(" ")}function _s(t){try{return new Date(t).toLocaleDateString("fr-FR",{weekday:"short",day:"numeric",month:"short"})}catch{return t}}function As({userId:t,expanded:s,onToggle:r}){const i=St(),{data:p,isLoading:m}=ve({queryKey:["swim-exercise-logs-history",t],queryFn:()=>U.getSwimExerciseLogsHistory(t,100),enabled:!!t&&s}),h=ge({mutationFn:({logId:y,patch:w})=>U.updateSwimExerciseLog(y,w),onSuccess:()=>{i.invalidateQueries({queryKey:["swim-exercise-logs-history",t]})}}),x=ge({mutationFn:y=>U.deleteSwimExerciseLog(y),onSuccess:()=>{i.invalidateQueries({queryKey:["swim-exercise-logs-history",t]})}}),j=Fe.useMemo(()=>{if(!p?.length)return[];const y=new Map;for(const w of p){const C=(w.created_at??"").slice(0,10);y.has(C)||y.set(C,[]),y.get(C).push(w)}return Array.from(y.entries()).map(([w,C])=>({date:w,entries:C}))},[p]);return e.jsxs("div",{className:"mt-6",children:[e.jsxs("button",{type:"button",onClick:r,className:"flex w-full items-center justify-between rounded-2xl border border-border px-3 py-2.5 text-sm font-semibold text-foreground hover:bg-muted transition",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(Mt,{className:"h-4 w-4"}),"Historique notes techniques"]}),e.jsx(Ct,{className:Cs("h-4 w-4 transition-transform",s&&"rotate-90")})]}),s&&e.jsxs("div",{className:"mt-3 space-y-3",children:[m&&e.jsx("div",{className:"text-sm text-muted-foreground text-center py-4",children:"Chargement..."}),!m&&j.length===0&&e.jsx("div",{className:"text-sm text-muted-foreground text-center py-4",children:"Aucune note technique enregistree."}),j.map(({date:y,entries:w})=>e.jsxs("div",{className:"rounded-2xl border border-border overflow-hidden",children:[e.jsx("div",{className:"bg-muted/50 px-3 py-2 text-xs font-semibold text-muted-foreground",children:_s(y)}),e.jsx("div",{className:"divide-y divide-border",children:w.map(C=>e.jsx(Ds,{log:C,onSave:Y=>h.mutate({logId:C.id,patch:Y}),onDelete:()=>x.mutate(C.id),saving:h.isPending},C.id))})]},y))]})]})}function Ds({log:t,onSave:s,onDelete:r,saving:i}){const[p,m]=a.useState(!1),[h,x]=a.useState({notes:t.notes??"",tempo:t.tempo,split_times:t.split_times,stroke_count:t.stroke_count}),[j,y]=a.useState([]),w=()=>{x({notes:t.notes??"",tempo:t.tempo,split_times:[...t.split_times],stroke_count:[...t.stroke_count]}),y(t.split_times.map(d=>We(d.time_seconds))),m(!0)},C=()=>m(!1),Y=()=>{s({notes:h.notes.trim()||null,tempo:h.tempo,split_times:h.split_times,stroke_count:h.stroke_count}),m(!1)},te=()=>{x(d=>({...d,split_times:[...d.split_times,{rep:d.split_times.length+1,time_seconds:0}]})),y(d=>[...d,""])},re=(d,b)=>{y(A=>A.map((M,B)=>B===d?b:M))},ue=d=>{const b=es(j[d]),A=We(b);y(M=>M.map((B,q)=>q===d?A:B)),x(M=>({...M,split_times:M.split_times.map((B,q)=>q===d?{...B,time_seconds:b}:B)}))},pe=d=>{x(b=>({...b,split_times:b.split_times.filter((A,M)=>M!==d).map((A,M)=>({...A,rep:M+1}))})),y(b=>b.filter((A,M)=>M!==d))},W=()=>{x(d=>({...d,stroke_count:[...d.stroke_count,{rep:d.stroke_count.length+1,count:0}]}))},me=(d,b)=>{x(A=>({...A,stroke_count:A.stroke_count.map((M,B)=>B===d?{...M,count:b}:M)}))},G=d=>{x(b=>({...b,stroke_count:b.stroke_count.filter((A,M)=>M!==d).map((A,M)=>({...A,rep:M+1}))}))};return p?e.jsxs("div",{className:"px-3 py-2.5 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-semibold text-foreground",children:t.exercise_label}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{type:"button",onClick:Y,disabled:i,className:"p-1.5 rounded-lg text-primary hover:bg-primary/10 transition","aria-label":"Enregistrer",children:e.jsx(rt,{className:"h-4 w-4"})}),e.jsx("button",{type:"button",onClick:C,className:"p-1.5 rounded-lg text-muted-foreground hover:bg-muted transition","aria-label":"Annuler",children:e.jsx($e,{className:"h-4 w-4"})}),e.jsx("button",{type:"button",onClick:r,className:"p-1.5 rounded-lg text-muted-foreground hover:text-destructive hover:bg-destructive/10 transition","aria-label":"Supprimer",children:e.jsx(Xe,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-xs font-medium text-muted-foreground min-w-[80px]",children:[e.jsx(lt,{className:"h-3.5 w-3.5"}),"Tempo"]}),e.jsx("input",{type:"number",inputMode:"decimal",step:"0.1",min:0,value:h.tempo??"",onChange:d=>x(b=>({...b,tempo:d.target.value?Number(d.target.value):null})),placeholder:"coups/min",className:"w-24 rounded-xl border border-border bg-background px-2 py-1.5 text-sm text-center outline-none focus:ring-2 focus:ring-foreground/10"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-xs font-medium text-muted-foreground",children:[e.jsx(dt,{className:"h-3.5 w-3.5"}),"Temps"]}),e.jsxs("button",{type:"button",onClick:te,className:"inline-flex items-center gap-1 text-xs text-primary hover:text-primary/80 transition",children:[e.jsx(Be,{className:"h-3 w-3"}),"Rep"]})]}),h.split_times.length>0&&e.jsx("div",{className:"mt-1.5 flex flex-wrap gap-1.5",children:h.split_times.map((d,b)=>e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"text-[10px] text-muted-foreground w-4 text-right",children:d.rep}),e.jsx("input",{type:"text",inputMode:"numeric",value:j[b]??"",onChange:A=>re(b,A.target.value),onBlur:()=>ue(b),placeholder:"ss:cc",className:"w-16 rounded-lg border border-border bg-background px-1.5 py-1 text-xs text-center outline-none focus:ring-2 focus:ring-foreground/10"}),e.jsx("button",{type:"button",onClick:()=>pe(b),className:"p-0.5 text-muted-foreground hover:text-destructive transition",children:e.jsx(Xe,{className:"h-3 w-3"})})]},b))})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-xs font-medium text-muted-foreground",children:[e.jsx(ct,{className:"h-3.5 w-3.5"}),"Coups de bras"]}),e.jsxs("button",{type:"button",onClick:W,className:"inline-flex items-center gap-1 text-xs text-primary hover:text-primary/80 transition",children:[e.jsx(Be,{className:"h-3 w-3"}),"Rep"]})]}),h.stroke_count.length>0&&e.jsx("div",{className:"mt-1.5 flex flex-wrap gap-1.5",children:h.stroke_count.map((d,b)=>e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"text-[10px] text-muted-foreground w-4 text-right",children:d.rep}),e.jsx("input",{type:"number",inputMode:"numeric",min:0,value:d.count||"",onChange:A=>me(b,Number(A.target.value)||0),placeholder:"nb",className:"w-14 rounded-lg border border-border bg-background px-1.5 py-1 text-xs text-center outline-none focus:ring-2 focus:ring-foreground/10"}),e.jsx("button",{type:"button",onClick:()=>G(b),className:"p-0.5 text-muted-foreground hover:text-destructive transition",children:e.jsx(Xe,{className:"h-3 w-3"})})]},b))})]}),e.jsx("textarea",{value:h.notes,onChange:d=>x(b=>({...b,notes:d.target.value})),placeholder:"Notes libres...",rows:2,className:"w-full resize-none rounded-xl border border-border bg-background px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-foreground/10"})]}):e.jsxs("div",{className:"px-3 py-2.5 space-y-1.5 group",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-sm font-semibold text-foreground",children:t.exercise_label}),e.jsx("button",{type:"button",onClick:w,className:"p-1.5 rounded-lg text-muted-foreground hover:bg-muted transition","aria-label":"Modifier",children:e.jsx(ts,{className:"h-3.5 w-3.5"})})]}),e.jsxs("div",{className:"flex flex-wrap gap-x-4 gap-y-1 text-xs text-muted-foreground",children:[t.tempo!=null&&e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx(lt,{className:"h-3 w-3"}),t.tempo," c/min"]}),t.split_times.length>0&&e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx(dt,{className:"h-3 w-3"}),t.split_times.map(d=>We(d.time_seconds)||"—").join(" / ")]}),t.stroke_count.length>0&&e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx(ct,{className:"h-3 w-3"}),t.stroke_count.map(d=>d.count).join(" / ")," cps"]})]}),t.notes&&e.jsx("div",{className:"text-xs text-foreground/70 italic",children:t.notes})]})}const Fs=["Lun","Mar","Mer","Jeu","Ven","Sam","Dim"],Es=[{key:"AM",label:"Matin"},{key:"PM",label:"Soir"}],Os=[{key:"difficulty",label:"Difficulté",mode:"hard"},{key:"fatigue_end",label:"Fatigue fin",mode:"hard"},{key:"performance",label:"Perf perçue",mode:"good"},{key:"engagement",label:"Engagement",mode:"good"}];function jt(...t){return t.filter(Boolean).join(" ")}function vt(t){return String(t).padStart(2,"0")}function je(t){return`${t.getFullYear()}-${vt(t.getMonth()+1)}-${vt(t.getDate())}`}function Is(t){return new Date(t.getFullYear(),t.getMonth(),1)}function Ls(t){const s=String(t).split("__");return{iso:s[0],slotKey:s[1]||""}}function wt(t,s){return Number.isFinite(t)?Math.round(t/s)*s:0}function kt({open:t,title:s,onClose:r,children:i}){return e.jsx(Ee,{children:t&&e.jsxs(e.Fragment,{children:[e.jsx(de.div,{className:"fixed inset-0 z-overlay bg-black/30",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:r}),e.jsx(de.div,{className:"fixed inset-0 z-modal flex items-end sm:items-center justify-center p-3 pb-24 sm:p-4 sm:pb-4",initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:10},children:e.jsxs("div",{className:"w-full max-w-md rounded-3xl border bg-background shadow-2xl overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between border-b px-4 py-3",children:[e.jsx("div",{className:"truncate text-base font-semibold text-foreground",children:s}),e.jsxs("button",{type:"button",onClick:r,className:"inline-flex items-center justify-center rounded-2xl border border-border bg-background p-2 transition hover:bg-muted","aria-label":"Fermer",children:[e.jsx($e,{className:"h-5 w-5"}),e.jsx("span",{className:"sr-only",children:"Fermer"})]})]}),e.jsx("div",{className:"p-4",children:i})]})})]})})}function on(){const{user:t,userId:s}=Rt(),{toast:r}=Qt(),i=St(),[p,m]=Fe.useState("idle"),[h,x]=Fe.useState(!1),[j,y]=Fe.useState(null);Fe.useEffect(()=>{Ve.auth.getSession().then(({data:n})=>{y(n.session?.user?.id??null)})},[t]);const{data:w,isLoading:C,error:Y,refetch:te}=ve({queryKey:["sessions",s??t],queryFn:()=>U.getSessions(t,s),enabled:!!t}),{data:re,isLoading:ue,error:pe,refetch:W}=ve({queryKey:["assignments",t],queryFn:()=>U.getAssignments(t,s),enabled:!!t}),{data:me=[]}=ve({queryKey:["competitions"],queryFn:()=>U.getCompetitions()}),{data:G}=ve({queryKey:["my-competition-ids"],queryFn:()=>U.getMyCompetitionIds()}),d=a.useMemo(()=>!G||G.length===0?me:me.filter(n=>G.includes(n.id)),[me,G]),{data:b=[]}=ve({queryKey:["my-planned-absences"],queryFn:()=>U.getMyPlannedAbsences()}),A=a.useMemo(()=>new Set(b.map(n=>n.date)),[b]),M=C||ue,B=Y||pe,q=()=>{te(),W()},ie=ge({mutationFn:n=>U.deleteSession(n),onMutate:()=>{m("saving")},onSuccess:()=>{i.invalidateQueries({queryKey:["sessions"]}),i.invalidateQueries({queryKey:["hall-of-fame"]}),r({title:"Séance supprimée",description:"La saisie a été supprimée."}),m("saved"),setTimeout(()=>m("idle"),2e3)},onError:()=>{r({title:"Erreur",description:"Impossible de supprimer la séance.",variant:"destructive"}),m("error"),setTimeout(()=>m("idle"),3e3)}}),he=ge({mutationFn:async n=>{const{_exerciseLogs:o,...f}=n,S=await U.syncSession({...f,athlete_name:t,athlete_id:s??void 0});if(o&&o.length>0&&S.sessionId)try{const{data:D}=await Ve.auth.getSession(),V=D.session?.user?.id;V&&await U.saveSwimExerciseLogs(S.sessionId,V,o)}catch(D){console.warn("[EAC] Failed to save exercise logs:",D)}return S},onMutate:()=>{m("saving")},onSuccess:()=>{i.invalidateQueries({queryKey:["sessions"]}),i.invalidateQueries({queryKey:["assignments"]}),i.invalidateQueries({queryKey:["hall-of-fame"]}),r({title:"Séance enregistrée",description:"Vos données ont été synchronisées."}),m("saved"),setTimeout(()=>m("idle"),2e3)},onError:()=>{r({title:"Erreur",description:"Impossible d'enregistrer la séance.",variant:"destructive"}),m("error"),setTimeout(()=>m("idle"),3e3)}}),fe=ge({mutationFn:async n=>{const{_exerciseLogs:o,...f}=n,S=await U.updateSession(f);if(console.log("[EAC] updateMutation - exerciseLogs:",o),o&&f.id)try{const{data:D}=await Ve.auth.getSession(),V=D.session?.user?.id;console.log("[EAC] updateMutation - authUid:",V,"sessionId:",f.id),V?(console.log("[EAC] updateMutation - calling saveSwimExerciseLogs with logs:",o),await U.saveSwimExerciseLogs(f.id,V,o),console.log("[EAC] updateMutation - saveSwimExerciseLogs completed successfully")):console.warn("[EAC] updateMutation - No authUid found, skipping exercise logs save")}catch(D){throw console.error("[EAC] Failed to save exercise logs:",D),D}else console.log("[EAC] updateMutation - skipping exercise logs (empty or no session ID)");return S},onMutate:()=>{m("saving")},onSuccess:()=>{i.invalidateQueries({queryKey:["sessions"]}),i.invalidateQueries({queryKey:["hall-of-fame"]}),r({title:"Séance mise à jour",description:"Votre saisie a été mise à jour."}),m("saved"),setTimeout(()=>m("idle"),2e3)},onError:()=>{r({title:"Erreur",description:"Impossible de mettre à jour la séance.",variant:"destructive"}),m("error"),setTimeout(()=>m("idle"),3e3)}}),ke=ge({mutationFn:({date:n,reason:o})=>U.setPlannedAbsence(n,o),onSuccess:()=>{i.invalidateQueries({queryKey:["my-planned-absences"]}),r({title:"Jour marqué indisponible"})},onError:()=>{r({title:"Erreur",description:"Impossible de marquer ce jour indisponible.",variant:"destructive"})}}),F=ge({mutationFn:n=>U.removePlannedAbsence(n),onSuccess:()=>{i.invalidateQueries({queryKey:["my-planned-absences"]}),r({title:"Disponibilité restaurée"})},onError:()=>{r({title:"Erreur",description:"Impossible de restaurer la disponibilité.",variant:"destructive"})}}),T=hs({sessions:w,assignments:re,userId:s,user:t}),{today:P,monthCursor:K,selectedISO:k,drawerOpen:E,settingsOpen:H,infoOpen:R,activeSessionId:$,detailsOpen:_,selectedDayIndex:Q,isPending:X,presenceDefaults:xe,stableDurationMin:Z,draftState:L,gridDates:ee,completionByISO:oe,selectedDate:Se,sessionsForSelectedDay:be,selectedDayStatus:Me,globalKm:ae,dayKm:Re,logsBySessionId:se,setMonthCursor:l,setSelectedISO:c,setDrawerOpen:u,setSettingsOpen:N,setInfoOpen:v,setActiveSessionId:g,setDetailsOpen:I,setSelectedDayIndex:z,setPresenceDefaults:ne,setAttendanceOverrideBySessionId:J,setStableDurationMin:ye,setDraftState:Qe,setAutoCloseArmed:Ie,startTransition:le,getSessionStatus:ze}=T,At=a.useMemo(()=>{const n=new Set;for(const o of d){if(!o.date)continue;const f=o.date.slice(0,10),S=o.end_date?o.end_date.slice(0,10):f;let D=f;for(;D<=S;){n.add(D);const V=new Date(D+"T00:00:00");V.setDate(V.getDate()+1);const _e=V.getFullYear(),Pe=String(V.getMonth()+1).padStart(2,"0"),Ne=String(V.getDate()).padStart(2,"0");D=`${_e}-${Pe}-${Ne}`}}return n},[d]),ce=a.useMemo(()=>{const n=je(new Date);return d.filter(f=>f.date&&f.date.slice(0,10)>=n).sort((f,S)=>f.date.localeCompare(S.date))[0]??null},[d]),Je=a.useMemo(()=>{if(!ce)return null;const n=new Date;n.setHours(0,0,0,0);const o=new Date(ce.date.slice(0,10)+"T00:00:00");return Math.round((o.getTime()-n.getTime())/(1e3*60*60*24))},[ce]),Le=a.useMemo(()=>{if(!ce||!re)return null;const n=je(new Date),o=ce.date.slice(0,10),f=new Set;for(const S of re){const D=(S.assigned_date||"").slice(0,10);D>n&&D<=o&&f.add(D)}return f.size},[ce,re]),Ce=a.useCallback(n=>{c(n),u(!0),g(null),I(!1);const o=oe[n]||{completed:0,total:2};Ie(o.total>0&&o.completed<o.total)},[oe,c,u,g,I,Ie]),Ue=a.useCallback(()=>{u(!1),g(null),I(!1),Ie(!1),z(null)},[u,g,I,Ie,z]),Dt=a.useCallback(()=>{l(n=>new Date(n.getFullYear(),n.getMonth()-1,1))},[l]),Ft=a.useCallback(()=>{l(n=>new Date(n.getFullYear(),n.getMonth()+1,1))},[l]),Et=a.useCallback(()=>{const n=new Date;l(Is(n)),Ce(je(n))},[Ce,l]),He=a.useCallback(n=>{g(n),I(!1)},[g,I]),Ot=a.useCallback(n=>{le(()=>{J(f=>({...f,[n]:"absent"}))});const o=se[n];o?.id&&ie.mutate(Number(o.id))},[ie,se,le,J]),It=a.useCallback(n=>{le(()=>{J(o=>({...o,[n]:"present"}))})},[le,J]),Lt=a.useCallback(n=>{le(()=>{J(o=>{const f={...o};return delete f[n],f})})},[le,J]),Pt=a.useCallback(()=>{const n=be.map(o=>ze(o,Se).expected?o.id:null).filter(Boolean);n.length!==0&&(le(()=>{J(o=>{const f={...o};for(const S of n)f[S]="absent";return f}),g(null),I(!1)}),n.forEach(o=>{const f=se[o];f?.id&&ie.mutate(Number(f.id))}))},[be,ze,Se,le,se,ie,J,g,I]),Kt=a.useCallback(()=>{if(!$||!t||!Os.every(Ae=>Number.isInteger(L[Ae.key])))return;const{iso:o,slotKey:f}=Ls($),S=f==="PM"?"Soir":"Matin",D=wt(Number(L.distanceMeters??0),100),V=wt(Number(Z),15),_e={};for(const[Ae,Bt]of Object.entries(L.strokes)){const it=Number(Bt);it>0&&(_e[Ae]=it)}const Pe={date:o,slot:S,distance:D,duration:V,effort:Number(L.difficulty),feeling:Number(L.fatigue_end),performance:Number(L.performance),engagement:Number(L.engagement),comments:String(L.comment||"").slice(0,400),athlete_name:t,athlete_id:s??void 0,stroke_distances:Object.keys(_e).length>0?_e:null},Ne=se[$];console.log("[EAC] saveFeedback - draftState.exerciseLogs:",L.exerciseLogs),le(()=>{J(Ae=>({...Ae,[$]:"present"}))}),Ne?.id?(console.log("[EAC] saveFeedback - updating existing session:",Ne.id),fe.mutate({...Pe,id:Ne.id,created_at:Ne.created_at??new Date().toISOString(),_exerciseLogs:L.exerciseLogs.length>0?L.exerciseLogs:[]})):(console.log("[EAC] saveFeedback - creating new session"),he.mutate({...Pe,_exerciseLogs:L.exerciseLogs.length>0?L.exerciseLogs:void 0})),g(null),I(!1)},[$,t,s,L,Z,se,le,fe,he,J,g,I]),Tt=a.useCallback((n,o)=>{ne(f=>({...f,[n]:{...f[n],[o]:!f[n][o]}}))},[ne]);a.useEffect(()=>{if(!E)return;const n=o=>{if(o.key==="Escape"){o.preventDefault(),Ue();return}(o.key==="Enter"||o.key===" ")&&(o.preventDefault(),be.length>0&&!$&&He(be[0].id))};return window.addEventListener("keydown",n),()=>window.removeEventListener("keydown",n)},[E,Ue,be,$,He]);const $t=a.useCallback((n,o)=>{if(!["ArrowUp","ArrowDown","ArrowLeft","ArrowRight","Enter"," "].includes(n.key))return;if(n.preventDefault(),n.key==="Enter"||n.key===" "){const D=je(ee[o]);Ce(D);return}let S=o;n.key==="ArrowLeft"&&(S=Math.max(0,o-1)),n.key==="ArrowRight"&&(S=Math.min(ee.length-1,o+1)),n.key==="ArrowUp"&&(S=Math.max(0,o-7)),n.key==="ArrowDown"&&(S=Math.min(ee.length-1,o+7)),z(S),c(je(ee[S])),setTimeout(()=>{const D=document.querySelectorAll('[data-calendar-cell="true"]');D[S]&&D[S].focus()},0)},[ee,Ce,z,c]);return M?e.jsxs("div",{className:"min-h-screen bg-muted",children:[e.jsx("div",{className:"sm:hidden fixed top-0 left-0 right-0 z-overlay border-b border-primary/15 bg-background/90 backdrop-blur-md",children:e.jsxs("div",{className:"mx-auto max-w-6xl px-3 py-2.5 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2.5",children:[e.jsx("div",{className:"h-7 w-7 rounded-lg bg-primary/20 animate-pulse"}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("div",{className:"h-4 w-12 rounded bg-muted animate-pulse"}),e.jsx("div",{className:"h-3 w-16 rounded bg-muted animate-pulse"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-9 w-9 rounded-xl bg-primary/5 animate-pulse"}),e.jsx("div",{className:"h-9 w-9 rounded-xl bg-primary/5 animate-pulse"})]})]})}),e.jsx("div",{className:"mx-auto max-w-6xl px-3 sm:px-4 pt-20 pb-5 sm:py-8",children:e.jsxs("div",{className:"mt-4 rounded-3xl border border-border bg-card overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-3 sm:px-5 py-3 border-b border-border",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"h-9 w-9 rounded-2xl bg-muted animate-pulse"}),e.jsx("div",{className:"h-9 w-9 rounded-2xl bg-muted animate-pulse"})]}),e.jsx("div",{className:"h-6 w-32 rounded bg-muted animate-pulse"}),e.jsx("div",{className:"h-9 w-9 rounded-2xl bg-muted animate-pulse"})]}),e.jsx("div",{className:"p-3 sm:p-5",children:e.jsxs("div",{className:"grid grid-cols-7 gap-1.5 sm:gap-2",children:[Array.from({length:7}).map((n,o)=>e.jsx("div",{className:"px-0.5 pb-1 flex justify-center",children:e.jsx("div",{className:"h-3 w-4 rounded bg-muted animate-pulse"})},`wh-${o}`)),Array.from({length:35}).map((n,o)=>e.jsx("div",{className:"aspect-square rounded-2xl bg-muted/50 animate-pulse"},`cs-${o}`))]})})]})})]}):B?e.jsxs("div",{className:"flex flex-col items-center justify-center p-8 text-center",children:[e.jsx(ss,{className:"h-12 w-12 text-destructive mb-4"}),e.jsx("h3",{className:"font-semibold",children:"Impossible de charger les données"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:B.message}),e.jsx(zt,{onClick:()=>q(),className:"mt-4",children:"Réessayer"})]}):e.jsxs("div",{className:"min-h-screen bg-muted",children:[e.jsx("div",{className:"sm:hidden fixed top-0 left-0 right-0 z-overlay border-b border-primary/15 bg-background/90 backdrop-blur-md",children:e.jsxs("div",{className:"px-4 py-2.5 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2.5",children:[e.jsx("div",{className:"flex items-center justify-center h-7 w-7 rounded-lg bg-primary text-primary-foreground",children:e.jsx(nt,{className:"h-3.5 w-3.5"})}),e.jsx("h1",{className:"text-lg font-display font-bold uppercase italic tracking-tight text-primary",children:"Suivi"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-xs font-mono font-semibold text-muted-foreground tabular-nums",children:[ae," km"]}),e.jsx("button",{type:"button",onClick:()=>v(!0),className:"inline-flex items-center justify-center rounded-xl border border-primary/20 bg-primary/5 p-2 transition hover:bg-primary/10","aria-label":"Infos",children:e.jsx(ut,{className:"h-5 w-5 text-primary"})}),e.jsx("button",{type:"button",onClick:()=>N(!0),className:"inline-flex items-center justify-center rounded-xl border border-primary/20 bg-primary/5 p-2 transition hover:bg-primary/10","aria-label":"Paramètres",children:e.jsx(mt,{className:"h-5 w-5 text-primary"})})]})]})}),e.jsxs("div",{className:"mx-auto max-w-6xl px-3 sm:px-4 pt-20 pb-5 sm:py-8",children:[e.jsxs("div",{className:"hidden sm:flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2.5",children:[e.jsx("div",{className:"flex items-center justify-center h-7 w-7 rounded-lg bg-primary text-primary-foreground",children:e.jsx(nt,{className:"h-3.5 w-3.5"})}),e.jsx("h1",{className:"text-lg font-display font-bold uppercase italic tracking-tight text-primary",children:"Suivi"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-xs font-mono font-semibold text-muted-foreground tabular-nums",children:[ae," km"]}),e.jsx("button",{type:"button",onClick:()=>v(!0),className:"inline-flex items-center justify-center rounded-xl border border-primary/20 bg-primary/5 p-2 transition hover:bg-primary/10","aria-label":"Infos",children:e.jsx(ut,{className:"h-5 w-5 text-primary"})}),e.jsx("button",{type:"button",onClick:()=>N(!0),className:"inline-flex items-center justify-center rounded-xl border border-primary/20 bg-primary/5 p-2 transition hover:bg-primary/10","aria-label":"Paramètres",children:e.jsx(mt,{className:"h-5 w-5 text-primary"})})]})]}),ce&&Je!=null&&e.jsx("div",{className:"mt-4 rounded-xl border border-amber-200 bg-amber-50 dark:border-amber-900/30 dark:bg-amber-950/20 p-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Jt,{className:"h-5 w-5 text-amber-500 shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-xs text-amber-600 dark:text-amber-400",children:"Prochaine compétition"}),e.jsx("div",{className:"font-semibold text-sm text-foreground truncate",children:ce.name}),ce.location&&e.jsx("div",{className:"text-xs text-muted-foreground truncate",children:ce.location}),Le!=null&&Le>0&&e.jsxs("div",{className:"text-xs text-amber-600 dark:text-amber-400 font-medium",children:[Le," séance",Le>1?"s":""," d'ici là"]})]}),e.jsx("div",{className:"shrink-0 rounded-lg bg-amber-100 dark:bg-amber-900/30 px-2.5 py-1",children:e.jsx("span",{className:"font-bold text-sm text-amber-600 dark:text-amber-400",children:Je===0?"Aujourd'hui":`J-${Je}`})})]})}),e.jsxs("div",{className:"mt-4 rounded-3xl border border-border bg-card overflow-hidden",children:[e.jsx(Vt,{monthCursor:K,selectedDayStatus:Me,onPrevMonth:Dt,onNextMonth:Ft,onJumpToday:Et}),e.jsx(Yt,{monthCursor:K,gridDates:ee,completionByISO:oe,competitionDates:At,absenceDates:A,selectedISO:k,selectedDayIndex:Q,today:P,onDayClick:Ce,onKeyDown:$t})]}),j&&e.jsx(As,{userId:j,expanded:h,onToggle:()=>x(n=>!n)}),e.jsx(kt,{open:R,title:"Codes",onClose:()=>v(!1),children:e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsxs("div",{className:"flex items-center justify-between rounded-2xl border border-orange-200 bg-orange-50 px-3 py-2",children:[e.jsx("span",{className:"font-semibold",children:"Orange"}),e.jsx("span",{className:"text-foreground",children:"À compléter"})]}),e.jsxs("div",{className:"flex items-center justify-between rounded-2xl border border-emerald-200 bg-emerald-50 px-3 py-2",children:[e.jsx("span",{className:"font-semibold",children:"Vert"}),e.jsx("span",{className:"text-foreground",children:"Validé → km"})]}),e.jsxs("div",{className:"flex items-center justify-between rounded-2xl border border-sky-200 bg-sky-50 px-3 py-2",children:[e.jsx("span",{className:"font-semibold",children:"Bleu"}),e.jsx("span",{className:"text-foreground",children:"Absent / Non prévu"})]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Les km comptent uniquement après validation."})]})}),e.jsx(kt,{open:H,title:"Présence",onClose:()=>N(!1),children:e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"Toggle hebdo (séances attendues)."}),e.jsxs("div",{className:"overflow-hidden rounded-2xl border border-border bg-card",children:[e.jsxs("div",{className:"grid grid-cols-[1fr_110px_110px] bg-muted border-b border-border px-3 py-2 text-xs font-semibold text-muted-foreground",children:[e.jsx("div",{children:"Jour"}),e.jsx("div",{className:"text-center",children:"Matin"}),e.jsx("div",{className:"text-center",children:"Soir"})]}),Fs.map((n,o)=>e.jsxs("div",{className:jt("grid grid-cols-[1fr_110px_110px] items-center px-3 py-2",o!==6&&"border-b border-border"),children:[e.jsx("div",{className:"text-sm font-medium text-foreground",children:n}),Es.map(f=>{const S=!!xe?.[o]?.[f.key];return e.jsx("div",{className:"flex justify-center",children:e.jsx("button",{type:"button",onClick:()=>Tt(o,f.key),className:jt("w-24 rounded-2xl border px-3 py-2 text-sm font-semibold transition",S?"bg-foreground text-background border-foreground":"bg-card text-foreground border-border hover:bg-muted"),"aria-label":`${n} ${f.label}`,children:S?"On":"Off"})},f.key)})]},n))]}),e.jsxs("div",{className:"rounded-2xl border border-border bg-muted px-3 py-2",children:[e.jsx("div",{className:"text-xs font-semibold text-foreground",children:"Durée (valeur par défaut)"}),e.jsxs("div",{className:"mt-2 flex items-center gap-2",children:[e.jsx("button",{type:"button",className:"h-9 w-9 rounded-2xl border border-border bg-card hover:bg-muted flex items-center justify-center",onClick:()=>ye(n=>Math.max(30,n-15)),"aria-label":"Diminuer la durée",children:e.jsx(_t,{className:"h-4 w-4"})}),e.jsxs("div",{className:"text-sm font-semibold text-foreground",children:[Z," min"]}),e.jsx("button",{type:"button",className:"h-9 w-9 rounded-2xl border border-border bg-card hover:bg-muted flex items-center justify-center",onClick:()=>ye(n=>Math.min(240,n+15)),"aria-label":"Augmenter la durée",children:e.jsx(Be,{className:"h-4 w-4"})})]}),e.jsx("div",{className:"mt-1 text-[11px] text-muted-foreground",children:"Durée envoyée au back-end (non affichée dans la maquette)."})]})]})}),e.jsx(Ms,{open:E,selectedDate:Se,sessionsForSelectedDay:be,selectedDayStatus:Me,dayKm:Re,activeSessionId:$,detailsOpen:_,draftState:L,saveState:p,isPending:X,logsBySessionId:se,onClose:Ue,onDayOffAll:Pt,onOpenSession:He,onCloseSession:()=>{g(null),I(!1)},onToggleDetails:()=>I(n=>!n),onMarkAbsent:Ot,onMarkPresent:It,onClearOverride:Lt,onSaveFeedback:Kt,onDraftStateChange:Qe,getSessionStatus:ze,isAbsent:A.has(k),absenceReason:b.find(n=>n.date===k)?.reason??null,isFutureDate:k>je(new Date),onMarkDayAbsent:n=>ke.mutate({date:k,reason:n}),onRemoveDayAbsence:()=>F.mutate(k)})]})]})}export{on as default};
