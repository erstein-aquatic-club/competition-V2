const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-Cv12sZJk.js","assets/vendor-query-DyA9aSKS.js","assets/vendor-react-BzrpNAyj.js","assets/vendor-charts-BrQ8X25f.js","assets/vendor-supabase-DFPLkPj_.js","assets/vendor-motion-lao-Njgm.js","assets/index-DqiM0v4_.css"])))=>i.map(i=>d[i]);
import{c as De,u as T,r as x,d as L,j as e,f as Me}from"./vendor-query-DyA9aSKS.js";import{d as Fe,B as $,L as A,v as J,w as Je,_ as Xe,u as U,P as ee,I as Ye,s as Ze,f as se}from"./index-Cv12sZJk.js";import{a as f}from"./api-DAN2-X7j.js";import{B as w}from"./badge-C5ZP-Lkl.js";import{C as qe,a as Ee,b as Oe}from"./collapsible-BWvP-PR0.js";import{T as es,a as ss,b as Q,c as G}from"./tabs-Cfz-0abF.js";import{M as Ae,S as ts,w as Pe,a as $e,G as as,C as Be,b as rs}from"./weekTypeColor-BiiUPupK.js";import{T as K}from"./textarea-DqbkrdxT.js";import{s as Re,f as Ie,c as Ke,S as Le,e as le,a as W,F as ns,p as ue,d as ls,b as is}from"./objectiveHelpers-D7Sv8PWO.js";import{A as ie}from"./arrow-left-DibzDfD-.js";import{C as cs}from"./chevron-up-DMQc1i67.js";import{C as os}from"./chevron-down-DkXUedkX.js";import{C as H}from"./clock-DylV4th2.js";import{C as xe}from"./circle-check-CCP4h7ze.js";import{C as Ve}from"./chevron-right-BNygU7ak.js";import{T as ze}from"./trophy-Ci9O86X2.js";import{T as ds,a as te}from"./toggle-group-BV-i409I.js";import{S as pe,a as he,b as ge,c as fe,d as ae}from"./select-ByErsrGV.js";import{S as ms,a as us,b as xs,c as ps,d as hs}from"./sheet-BOG7b5tV.js";import{A as gs,a as fs,b as js,c as bs,d as ys,e as Ns,f as vs,g as _s}from"./alert-dialog-CTHay5dV.js";import{T as ws}from"./trash-2-BNJ3USPB.js";import{S as Cs}from"./sparkles-CPZrXP-x.js";import"./vendor-react-BzrpNAyj.js";import"./vendor-charts-BrQ8X25f.js";import"./vendor-supabase-DFPLkPj_.js";import"./vendor-motion-lao-Njgm.js";import"./swim-Cu_UeROj.js";import"./index-YxEwGev6.js";import"./index-BU_E-OBa.js";import"./chart-column-zgj-F16x.js";import"./index-C6CZ_XAa.js";import"./index-DCX2sNhR.js";import"./index-Cc91vfu3.js";function V(s){return new Date(s+"T12:00:00").toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric"})}function je(s){return new Date(s+"T00:00:00").toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit"})}function Ss(s){const t=new Date(s+"T00:00:00");return t.setDate(t.getDate()+6),t.toISOString().split("T")[0]}function ks(s){const t=new Date;t.setHours(0,0,0,0);const n=new Date(s+"T00:00:00"),i=new Date(s+"T00:00:00");return i.setDate(i.getDate()+6),t>=n&&t<=i}function be(s,t){const n=[],i=new Date(s+"T00:00:00"),p=new Date(t+"T00:00:00"),c=new Date(i),d=c.getDay(),h=d===0?1:d===1?0:8-d;for(c.setDate(c.getDate()+h);c<=p;)n.push(c.toISOString().split("T")[0]),c.setDate(c.getDate()+7);return n}function ye(s,t){const n=new Date(s+"T00:00:00"),i=new Date(t+"T00:00:00");return Math.round((i.getTime()-n.getTime())/(1e3*60*60*24))}function Ts({onBack:s,embedded:t=!1}){const{toast:n}=Fe(),i=De(),{data:p}=T({queryKey:["auth-user"],queryFn:async()=>{const{data:u}=await(await Xe(async()=>{const{supabase:y}=await import("./index-Cv12sZJk.js").then(D=>D.ah);return{supabase:y}},__vite__mapDeps([0,1,2,3,4,5,6]))).supabase.auth.getUser();return u.user}}),c=p?.app_metadata?.app_user_id,{data:d=[],isLoading:h}=T({queryKey:["my-interviews"],queryFn:()=>f.getMyInterviews()}),{data:b=[]}=T({queryKey:["athlete-objectives"],queryFn:()=>f.getAthleteObjectives()}),{data:_}=T({queryKey:["my-profile-iuf"],queryFn:()=>f.getProfile({userId:c}),enabled:!!c}),C=_?.ffn_iuf??null,j=x.useMemo(()=>{const u=new Date;return u.setDate(u.getDate()-360),u.toISOString().slice(0,10)},[]),{data:S=[]}=T({queryKey:["swimmer-performances-recent",C],queryFn:()=>f.getSwimmerPerformances({iuf:C,fromDate:j}),enabled:!!C}),o=x.useCallback(()=>i.invalidateQueries({queryKey:["my-interviews"]}),[i]),a=L({mutationFn:({id:u,input:y})=>f.updateInterviewAthleteSections(u,y),onSuccess:()=>{n({title:"Sauvegardé"}),o()},onError:u=>n({title:"Erreur",description:u.message,variant:"destructive"})}),l=L({mutationFn:u=>f.submitInterviewToCoach(u),onSuccess:()=>{n({title:"Envoyé au coach"}),o()},onError:u=>n({title:"Erreur",description:u.message,variant:"destructive"})}),g=L({mutationFn:u=>f.signInterview(u),onSuccess:()=>{n({title:"Entretien signé"}),o()},onError:u=>n({title:"Erreur",description:u.message,variant:"destructive"})});return e.jsxs("div",{className:"space-y-6 pb-24",children:[!t&&e.jsxs("div",{className:"space-y-1",children:[e.jsxs($,{variant:"ghost",size:"sm",className:"-ml-2",onClick:s,children:[e.jsx(ie,{className:"mr-1.5 h-4 w-4"}),"Retour"]}),e.jsx("h2",{className:"text-2xl font-display font-semibold uppercase italic text-primary",children:"Mes entretiens"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Entretiens individuels avec le coach"})]}),h&&e.jsx("div",{className:"space-y-3",children:[1,2,3].map(u=>e.jsx("div",{className:"rounded-xl border p-4 animate-pulse motion-reduce:animate-none",children:e.jsx("div",{className:"h-4 w-40 rounded bg-muted"})},u))}),!h&&d.length===0&&e.jsxs("div",{className:"text-center py-12 space-y-3",children:[e.jsx(Ae,{className:"h-10 w-10 text-muted-foreground mx-auto"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Aucun entretien en cours. Votre coach initiera les entretiens."})]}),!h&&d.map(u=>e.jsx(Ds,{interview:u,objectives:b,performances:S,appUserId:c??null,onSave:(y,D)=>a.mutate({id:y,input:D}),onSubmit:y=>{window.confirm("Envoyer votre préparation au coach ? Vous ne pourrez plus la modifier.")&&l.mutate(y)},onSign:y=>{window.confirm("Confirmer la signature de cet entretien ?")&&g.mutate(y)},isSaving:a.isPending,isSubmitting:l.isPending,isSigning:g.isPending},u.id))]})}function Ds({interview:s,objectives:t,performances:n,appUserId:i,onSave:p,onSubmit:c,onSign:d,isSaving:h,isSubmitting:b,isSigning:_}){const C=s.status==="draft_athlete",j=s.status==="draft_coach",S=s.status==="sent",o=s.status==="signed",[a,l]=x.useState(!1),[g,u]=x.useState(s.athlete_successes??""),[y,D]=x.useState(s.athlete_difficulties??""),[M,q]=x.useState(s.athlete_goals??""),[F,P]=x.useState(s.athlete_commitments??""),[k,O]=x.useState(s.athlete_commitment_review??""),{data:m}=T({queryKey:["my-previous-interview",s.date,s.id],queryFn:()=>i?f.getPreviousInterview(i,s.date,s.id):null,enabled:(C||S||o||j)&&!!i}),E=x.useRef(!1),N=x.useCallback(()=>{E.current||!C||(E.current=!0,p(s.id,{athlete_successes:g||null,athlete_difficulties:y||null,athlete_goals:M||null,athlete_commitments:F||null,athlete_commitment_review:k||null}),setTimeout(()=>{E.current=!1},500))},[s.id,g,y,M,F,k,p,C]),B=C?e.jsxs(w,{className:"bg-amber-100 text-amber-800 dark:bg-amber-900/30 dark:text-amber-400 border-amber-300 dark:border-amber-700",children:[e.jsx(H,{className:"h-3 w-3 mr-1"}),"À préparer"]}):j?e.jsxs(w,{className:"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400 border-blue-300 dark:border-blue-700",children:[e.jsx(H,{className:"h-3 w-3 mr-1"}),"En préparation"]}):S?e.jsxs(w,{className:"bg-emerald-100 text-emerald-800 dark:bg-emerald-900/30 dark:text-emerald-400 border-emerald-300 dark:border-emerald-700",children:[e.jsx(xe,{className:"h-3 w-3 mr-1"}),"À signer"]}):e.jsx(w,{variant:"secondary",children:"Signé"}),R=C?"border-amber-300 dark:border-amber-700 border-l-4":j?"border-blue-300 dark:border-blue-700 border-l-4":S?"border-emerald-300 dark:border-emerald-700 border-l-4":"";return e.jsxs("div",{className:`rounded-xl border bg-card shadow-sm ${R}`,children:[e.jsxs("button",{type:"button",className:"w-full flex items-center justify-between p-4 text-left",onClick:()=>l(v=>!v),children:[e.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[e.jsx("span",{className:"text-sm font-semibold",children:V(s.date)}),B,o&&s.signed_at&&e.jsxs("span",{className:"text-xs text-muted-foreground",children:["le ",V(s.signed_at.slice(0,10))]})]}),a?e.jsx(cs,{className:"h-4 w-4 text-muted-foreground shrink-0"}):e.jsx(os,{className:"h-4 w-4 text-muted-foreground shrink-0"})]}),a&&e.jsxs("div",{className:"px-4 pb-4 space-y-4",children:[C&&e.jsxs(e.Fragment,{children:[m&&(m.athlete_commitments||m.coach_actions)&&e.jsxs("div",{className:"rounded-xl border bg-muted/30 p-3 space-y-2",children:[e.jsx("p",{className:"text-xs font-bold uppercase tracking-widest text-muted-foreground",children:"Bilan des engagements précédents"}),m.athlete_commitments&&e.jsxs("div",{className:"border-l-4 border-blue-400 rounded-r-lg bg-blue-50/50 dark:bg-blue-950/20 p-2 space-y-0.5",children:[e.jsx("p",{className:"text-[10px] font-semibold text-muted-foreground",children:"Mes engagements"}),e.jsx("p",{className:"text-xs whitespace-pre-wrap",children:m.athlete_commitments})]}),m.coach_actions&&e.jsxs("div",{className:"border-l-4 border-amber-400 rounded-r-lg bg-amber-50/50 dark:bg-amber-950/20 p-2 space-y-0.5",children:[e.jsx("p",{className:"text-[10px] font-semibold text-muted-foreground",children:"Actions du coach"}),e.jsx("p",{className:"text-xs whitespace-pre-wrap",children:m.coach_actions})]}),e.jsxs("div",{className:"space-y-1 pt-1",children:[e.jsx(A,{htmlFor:`commitment-review-${s.id}`,className:"text-xs",children:"Comment avez-vous tenu vos engagements ?"}),e.jsx(K,{id:`commitment-review-${s.id}`,placeholder:"Mon bilan sur les engagements pris...",value:k,onChange:v=>O(v.target.value),onBlur:N,rows:3})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{htmlFor:`successes-${s.id}`,children:"Mes réussites"}),e.jsx(K,{id:`successes-${s.id}`,placeholder:"Ce dont je suis fier/fière cette saison...",value:g,onChange:v=>u(v.target.value),onBlur:N,rows:3})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{htmlFor:`difficulties-${s.id}`,children:"Mes difficultés"}),e.jsx(K,{id:`difficulties-${s.id}`,placeholder:"Les points que je souhaite améliorer...",value:y,onChange:v=>D(v.target.value),onBlur:N,rows:3})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{children:"Mes objectifs"}),t.length>0&&e.jsx("div",{className:"space-y-1.5",children:t.map(v=>e.jsx(we,{objective:v,performances:n},v.id))}),e.jsx(K,{id:`goals-${s.id}`,placeholder:"Objectifs supplémentaires ou commentaires...",value:M,onChange:v=>q(v.target.value),onBlur:N,rows:3})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{htmlFor:`commitments-${s.id}`,children:"Mes engagements"}),e.jsx(K,{id:`commitments-${s.id}`,placeholder:"Ce que je m'engage à faire...",value:F,onChange:v=>P(v.target.value),onBlur:N,rows:3})]}),h&&e.jsx("p",{className:"text-xs text-muted-foreground animate-pulse",children:"Sauvegarde..."}),e.jsxs($,{className:"w-full gap-2",onClick:()=>c(s.id),disabled:b,children:[e.jsx(ts,{className:"h-4 w-4"}),b?"Envoi...":"Envoyer au coach"]})]}),j&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"rounded-xl border border-dashed border-blue-300 dark:border-blue-700 bg-blue-50/50 dark:bg-blue-950/20 p-6 text-center space-y-2",children:[e.jsx(H,{className:"h-8 w-8 mx-auto text-blue-500"}),e.jsx("p",{className:"text-sm font-medium",children:"Entretien envoyé au coach"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Votre coach prépare l'entretien. Vous recevrez le compte-rendu complet après l'entretien en présentiel."}),s.submitted_at&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Envoyé le ",V(s.submitted_at.slice(0,10))]})]}),m&&(m.athlete_commitments||m.coach_actions)&&e.jsx(Ne,{prevInterview:m,commitmentReview:s.athlete_commitment_review}),i&&e.jsxs(e.Fragment,{children:[e.jsx(z,{label:"Planification"}),e.jsx(ve,{athleteId:i,interviewDate:s.date})]})]}),(S||o)&&e.jsxs(e.Fragment,{children:[m&&(m.athlete_commitments||m.coach_actions)&&e.jsx(Ne,{prevInterview:m,commitmentReview:s.athlete_commitment_review}),e.jsx(_e,{label:"Réussites",athleteText:s.athlete_successes,coachText:s.coach_comment_successes||s.coach_review}),e.jsx(_e,{label:"Difficultés",athleteText:s.athlete_difficulties,coachText:s.coach_comment_difficulties}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(z,{label:"Objectifs"}),t.length>0&&e.jsx("div",{className:"space-y-1.5",children:t.map(v=>e.jsx(we,{objective:v,performances:n},v.id))}),e.jsx(re,{text:s.athlete_goals}),e.jsx(ne,{text:s.coach_comment_goals||s.coach_objectives})]}),i&&e.jsxs(e.Fragment,{children:[e.jsx(z,{label:"Planification"}),e.jsx(ve,{athleteId:i,interviewDate:s.date})]}),e.jsxs("div",{className:"rounded-xl bg-card border shadow-sm p-3 space-y-2",children:[e.jsx(z,{label:"Engagements & Actions"}),e.jsx(re,{text:s.athlete_commitments,label:"Mes engagements"}),e.jsx(ne,{text:s.coach_actions,label:"Actions du coach"})]}),S&&e.jsxs($,{className:"w-full gap-2",onClick:()=>d(s.id),disabled:_,children:[e.jsx(xe,{className:"h-4 w-4"}),_?"Signature...":"Signer l'entretien"]})]})]})]})}function Ne({prevInterview:s,commitmentReview:t}){const[n,i]=x.useState(!1);return e.jsxs(qe,{open:n,onOpenChange:i,children:[e.jsx(Ee,{asChild:!0,children:e.jsxs("button",{type:"button",className:"w-full flex items-center gap-2 rounded-xl border bg-muted/30 px-3 py-2.5 text-left transition-colors hover:bg-muted/50",children:[e.jsx(Ve,{className:`h-3.5 w-3.5 text-muted-foreground shrink-0 transition-transform ${n?"rotate-90":""}`}),e.jsx("span",{className:"text-xs font-bold uppercase tracking-widest text-muted-foreground",children:"Rappel engagements précédents"}),e.jsx(w,{variant:"secondary",className:"text-[10px] px-1.5 py-0 ml-auto",children:V(s.date)})]})}),e.jsx(Oe,{children:e.jsxs("div",{className:"rounded-b-xl border border-t-0 bg-muted/30 px-3 pb-3 space-y-2",children:[s.athlete_commitments&&e.jsxs("div",{className:"border-l-4 border-blue-400 rounded-r-lg bg-blue-50/50 dark:bg-blue-950/20 p-2",children:[e.jsx("p",{className:"text-[10px] font-semibold text-muted-foreground",children:"Mes engagements"}),e.jsx("p",{className:"text-xs whitespace-pre-wrap",children:s.athlete_commitments})]}),s.coach_actions&&e.jsxs("div",{className:"border-l-4 border-amber-400 rounded-r-lg bg-amber-50/50 dark:bg-amber-950/20 p-2",children:[e.jsx("p",{className:"text-[10px] font-semibold text-muted-foreground",children:"Actions du coach"}),e.jsx("p",{className:"text-xs whitespace-pre-wrap",children:s.coach_actions})]}),t&&e.jsxs("div",{className:"border-l-4 border-blue-400 rounded-r-lg bg-blue-50/80 dark:bg-blue-950/30 p-2",children:[e.jsx("p",{className:"text-[10px] font-semibold text-muted-foreground",children:"Mon bilan"}),e.jsx("p",{className:"text-xs whitespace-pre-wrap",children:t})]})]})})]})}function ve({athleteId:s,interviewDate:t}){const{data:n=[]}=T({queryKey:["competitions"],queryFn:()=>f.getCompetitions()}),{data:i=[]}=T({queryKey:["my-competition-ids",s],queryFn:()=>f.getMyCompetitionIds(s)}),p=x.useMemo(()=>{const o=new Set(i);return n.filter(l=>o.has(l.id)&&l.date>=t).sort((l,g)=>l.date.localeCompare(g.date))[0]??null},[n,i,t]),{data:c=[]}=T({queryKey:["training-cycles","athlete",s],queryFn:()=>f.getTrainingCycles({athleteId:s})}),d=x.useMemo(()=>{const o=new Set(i);return n.filter(a=>o.has(a.id)&&a.date>=t).sort((a,l)=>a.date.localeCompare(l.date))},[n,i,t]),h=x.useMemo(()=>{const o=new Map;return c.slice().sort((a,l)=>(a.end_competition_date??"").localeCompare(l.end_competition_date??"")).forEach(a=>{a.end_competition_id&&!o.has(a.end_competition_id)&&o.set(a.end_competition_id,a)}),o},[c]),b=x.useMemo(()=>{const o=new Set;return d.map(a=>h.get(a.id)??null).filter(a=>!a||o.has(a.id)?!1:(o.add(a.id),!0))},[d,h]),_=Me({queries:b.map(o=>({queryKey:["training-weeks",o.id],queryFn:()=>f.getTrainingWeeks(o.id),enabled:!!o.id}))}),C=x.useMemo(()=>{const o=new Map;return b.forEach((a,l)=>{o.set(a.id,_[l]?.data??[])}),o},[b,_]),j=x.useMemo(()=>new Date().toISOString().split("T")[0],[]),S=p?ye(j,p.date):null;return p?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"rounded-xl border bg-muted/20 p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm flex-wrap",children:[e.jsx(ze,{className:"h-4 w-4 text-amber-500 shrink-0"}),e.jsxs("span",{className:"font-medium",children:[d.length," échéance",d.length>1?"s":""," visible",d.length>1?"s":""]}),e.jsxs(w,{variant:"secondary",className:"text-[10px]",children:["prochaine J-",S]})]}),e.jsx("p",{className:"mt-1 text-xs text-muted-foreground",children:"Vision multi-macrocycles depuis l'entretien, jusqu'aux prochaines compétitions assignées."})]}),e.jsx("div",{className:"space-y-3",children:d.map((o,a)=>{const l=h.get(o.id)??null,g=l?.start_date??l?.start_competition_date??t,u=g>t?g:t,y=l?be(u,o.date):[],D=l?be(g,o.date):[],M=Math.max(D.length-y.length,0),q=ye(j,o.date),F=l?C.get(l.id)??[]:[],P=new Map(F.map(k=>[k.week_start,k]));return e.jsxs("div",{className:"rounded-xl border bg-card shadow-sm overflow-hidden",children:[e.jsxs("div",{className:"border-b border-border bg-muted/20 px-3 py-2.5",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"text-sm font-semibold",children:o.name}),a===0&&e.jsx(w,{className:"text-[10px] bg-primary/10 text-primary border-primary/20",children:"Prochaine"}),e.jsx(w,{variant:"secondary",className:"text-[10px]",children:V(o.date)}),e.jsxs(w,{variant:"outline",className:"text-[10px]",children:["J-",q]})]}),l?e.jsxs("div",{className:"mt-1 flex items-center gap-2 flex-wrap text-xs text-muted-foreground",children:[e.jsx("span",{className:"font-medium text-foreground",children:l.name}),l.start_competition_name&&e.jsxs("span",{children:["depuis ",l.start_competition_name]}),e.jsxs("span",{children:[D.length," sem."]}),M>0&&e.jsxs("span",{children:[M," déjà écoulée",M>1?"s":""]})]}):e.jsx("p",{className:"mt-1 text-xs text-muted-foreground",children:"Aucun macrocycle créé pour cette échéance."})]}),l?y.length===0?e.jsx("div",{className:"px-3 py-3 text-xs text-muted-foreground italic",children:"Aucune semaine future à afficher sur ce macrocycle."}):e.jsx("div",{className:"px-3 py-3",children:e.jsx("div",{className:"relative ml-2 border-l-2 border-border pl-3 space-y-1.5",children:y.map((k,O)=>{const m=P.get(k),E=ks(k),N=Ss(k);return e.jsxs("div",{className:`rounded-lg border bg-card px-2.5 py-2 text-xs ${E?"ring-2 ring-primary bg-primary/5":""}`,children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:`h-2 w-2 rounded-full shrink-0 ${E?"bg-primary":m?.week_type?"bg-muted-foreground/40":"bg-muted-foreground/20"}`}),e.jsxs("span",{className:"text-muted-foreground whitespace-nowrap",children:["Sem. ",M+O+1]}),e.jsxs("span",{className:"text-muted-foreground/70 whitespace-nowrap",children:[je(k)," - ",je(N)]}),m?.week_type&&e.jsx(w,{className:"text-[10px] px-1.5 py-0 border-0 ml-auto",style:{backgroundColor:$e(m.week_type),color:Pe(m.week_type)},children:m.week_type})]}),m?.notes&&e.jsx("p",{className:"mt-1 pl-4 text-[11px] text-muted-foreground line-clamp-2",children:m.notes})]},k)})})}):e.jsx("div",{className:"px-3 py-3 text-xs text-muted-foreground italic",children:"La compétition reste visible pour garder la projection long terme, même sans planification détaillée."})]},o.id)})})]}):e.jsx("p",{className:"text-xs text-muted-foreground italic text-center py-2",children:"Aucune compétition assignée à venir."})}function _e({label:s,athleteText:t,coachText:n}){return e.jsxs("div",{className:"space-y-2",children:[e.jsx(z,{label:s}),e.jsx(re,{text:t}),e.jsx(ne,{text:n})]})}function z({label:s}){return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-px flex-1 bg-border"}),e.jsx("span",{className:"text-xs font-bold uppercase tracking-widest text-muted-foreground",children:s}),e.jsx("div",{className:"h-px flex-1 bg-border"})]})}function re({text:s,label:t}){return e.jsxs("div",{className:"border-l-4 border-blue-400 rounded-r-lg bg-blue-50/50 dark:bg-blue-950/20 p-2.5 space-y-0.5",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(Je,{className:"h-3 w-3 text-blue-500"}),e.jsx("p",{className:"text-[10px] font-bold uppercase tracking-widest text-muted-foreground",children:t??"Nageur"})]}),e.jsx("p",{className:"text-sm whitespace-pre-wrap",children:s?.trim()||e.jsx("span",{className:"italic text-muted-foreground",children:"Non renseigné"})})]})}function ne({text:s,label:t}){return s?.trim()?e.jsxs("div",{className:"border-l-4 border-amber-400 rounded-r-lg bg-amber-50/50 dark:bg-amber-950/20 p-2.5 space-y-0.5",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(as,{className:"h-3 w-3 text-amber-500"}),e.jsx("p",{className:"text-[10px] font-bold uppercase tracking-widest text-muted-foreground",children:t??"Coach"})]}),e.jsx("p",{className:"text-sm whitespace-pre-wrap",children:s})]}):null}function we({objective:s,performances:t}){const n=s.event_code?Re(s.event_code):null,i=n?Le[n]??"":"",p=s.event_code?Ie(t,s.event_code,s.pool_length):null;let c=null;return p&&s.target_time_seconds!=null&&s.event_code&&(c=p.time-s.target_time_seconds,Ke(p.time,s.target_time_seconds,s.event_code)),e.jsxs("div",{className:`rounded-lg border bg-card p-2 text-sm space-y-1 ${i?`border-l-4 ${i}`:""}`,children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx(J,{className:"h-3.5 w-3.5 text-muted-foreground shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0 flex items-center gap-1 flex-wrap",children:[s.event_code&&e.jsx("span",{className:"font-medium",children:le(s.event_code)}),s.event_code&&s.pool_length&&e.jsxs("span",{className:"text-muted-foreground",children:["(",s.pool_length,"m)"]}),s.target_time_seconds!=null&&e.jsx("span",{className:"font-mono text-xs text-primary",children:W(s.target_time_seconds)})]}),s.competition_name&&e.jsx(w,{variant:"secondary",className:"text-[10px] shrink-0",children:s.competition_name})]}),s.text&&e.jsx("p",{className:"text-muted-foreground text-xs pl-5",children:s.text}),p&&e.jsxs("div",{className:"flex items-center gap-2 pl-5 text-xs text-muted-foreground flex-wrap",children:[e.jsxs("span",{children:["Actuel : ",e.jsx("span",{className:"font-mono",children:W(p.time)})]}),p.date&&e.jsxs("span",{className:"text-muted-foreground/60",children:["(",V(p.date),")"]}),c!=null&&e.jsx("span",{className:c<=0?"text-emerald-600 font-medium":"text-amber-600",children:c<=0?"Objectif atteint !":`+${c.toFixed(2)}s`})]}),!p&&s.event_code&&s.target_time_seconds!=null&&e.jsx("p",{className:"text-[10px] text-muted-foreground italic pl-5",children:"Pas encore de temps enregistré"})]})}function Ms({onBack:s,embedded:t=!1}){const{toast:n}=Fe(),i=De(),[p,c]=x.useState(!1),[d,h]=x.useState(null),[b,_]=x.useState(null),{data:C}=T({queryKey:["auth-user"],queryFn:async()=>{const{data:r}=await Ze.auth.getUser();return r.user}}),j=C?.id??null,{data:S=[],isLoading:o}=T({queryKey:["athlete-objectives"],queryFn:()=>f.getAthleteObjectives(),enabled:!!j,refetchInterval:3e4}),a=U(r=>r.userId),l=U(r=>r.user),{data:g}=T({queryKey:["my-profile"],queryFn:()=>f.getProfile({displayName:l,userId:a}),enabled:!!a}),u=g?.ffn_iuf??null,y=x.useMemo(()=>{const r=new Date;return r.setDate(r.getDate()-360),r.toISOString().slice(0,10)},[]),{data:D=[]}=T({queryKey:["swimmer-performances-recent",u],queryFn:()=>f.getSwimmerPerformances({iuf:u,fromDate:y}),enabled:!!u}),M=x.useMemo(()=>S.filter(r=>r.created_by!==j),[S,j]),q=x.useMemo(()=>S.filter(r=>r.created_by===j),[S,j]),[F,P]=x.useState("chrono"),[k,O]=x.useState(""),[m,E]=x.useState("25"),[N,B]=x.useState(""),[R,v]=x.useState(""),We=()=>{P("chrono"),O(""),E("25"),B(""),v("")},X=()=>{h(null),We(),c(!0)},Qe=r=>{h(r);const Ue=!!r.event_code,me=!!r.text;P(Ue&&me?"both":me?"texte":"chrono"),O(r.event_code??""),E(String(r.pool_length??25)),B(r.target_time_seconds!=null?W(r.target_time_seconds):""),v(r.text??""),c(!0)},Y=()=>i.invalidateQueries({queryKey:["athlete-objectives"]}),ce=L({mutationFn:r=>f.createObjective(r),onSuccess:()=>{n({title:"Objectif créé"}),Y(),c(!1)},onError:r=>n({title:"Erreur",description:r.message,variant:"destructive"})}),oe=L({mutationFn:r=>f.updateObjective(d.id,r),onSuccess:()=>{n({title:"Objectif mis à jour"}),Y(),c(!1)},onError:r=>n({title:"Erreur",description:r.message,variant:"destructive"})}),Ge=L({mutationFn:r=>f.deleteObjective(r),onSuccess:()=>{n({title:"Objectif supprimé"}),Y(),_(null)},onError:r=>n({title:"Erreur",description:r.message,variant:"destructive"})}),I=F==="chrono"||F==="both",Z=F==="texte"||F==="both",de=ce.isPending||oe.isPending,He=()=>{if(I&&!k){n({title:"Épreuve requise",variant:"destructive"});return}if(I&&N&&ue(N)===null){n({title:"Format invalide",description:"Format : m:ss:cc (ex: 1:05:30)",variant:"destructive"});return}if(Z&&!R.trim()){n({title:"Texte requis",variant:"destructive"});return}if(!j)return;const r={athlete_id:j,event_code:I?k:null,pool_length:I?Number(m):null,target_time_seconds:I&&N?ue(N):null,text:Z?R.trim():null};d?oe.mutate(r):ce.mutate(r)};return e.jsxs("div",{className:"space-y-6 pb-24",children:[t?e.jsx("div",{className:"flex items-center justify-end",children:e.jsxs($,{variant:"outline",size:"sm",onClick:X,children:[e.jsx(ee,{className:"mr-1.5 h-3.5 w-3.5"}),"Ajouter"]})}):e.jsxs("div",{className:"space-y-1",children:[e.jsxs($,{variant:"ghost",size:"sm",className:"-ml-2",onClick:s,children:[e.jsx(ie,{className:"mr-1.5 h-4 w-4"}),"Retour"]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-display font-semibold uppercase italic text-primary",children:"Mon plan"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Mes objectifs d'entraînement"})]}),e.jsxs($,{variant:"outline",size:"sm",onClick:X,children:[e.jsx(ee,{className:"mr-1.5 h-3.5 w-3.5"}),"Ajouter"]})]})]}),o&&e.jsx("div",{className:"space-y-2",children:[1,2,3].map(r=>e.jsx("div",{className:"rounded-xl border p-3 animate-pulse motion-reduce:animate-none",children:e.jsx("div",{className:"h-4 w-40 rounded bg-muted"})},r))}),!o&&S.length===0&&e.jsxs("div",{className:"text-center py-12 space-y-3",children:[e.jsx(J,{className:"h-10 w-10 text-muted-foreground mx-auto"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Aucun objectif pour le moment."}),e.jsxs($,{variant:"outline",size:"sm",onClick:X,children:[e.jsx(ee,{className:"mr-1.5 h-3.5 w-3.5"}),"Ajouter un objectif"]})]}),M.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-xs font-semibold uppercase tracking-[0.15em] text-muted-foreground",children:"Objectifs du coach"}),M.map(r=>e.jsx(Ce,{objective:r,isPersonal:!1,performances:D},r.id))]}),(M.length>0||q.length>0)&&e.jsx("p",{className:"text-[10px] text-muted-foreground/60 italic text-center",children:"Les temps « Actuel » correspondent à la meilleure performance des 360 derniers jours sur l'épreuve."}),q.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-xs font-semibold uppercase tracking-[0.15em] text-muted-foreground",children:"Mes objectifs personnels"}),q.map(r=>e.jsx(Ce,{objective:r,isPersonal:!0,performances:D,onEdit:Qe,onDelete:_},r.id))]}),e.jsx(ms,{open:p,onOpenChange:c,children:e.jsxs(us,{side:"bottom",className:"max-h-[85vh] overflow-y-auto",children:[e.jsxs(xs,{children:[e.jsx(ps,{children:d?"Modifier l'objectif":"Nouvel objectif"}),e.jsx(hs,{children:d?"Modifiez votre objectif personnel.":"Ajoutez un objectif personnel."})]}),e.jsxs("div",{className:"mt-4 space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{children:"Type d'objectif"}),e.jsxs(ds,{type:"single",variant:"outline",value:F,onValueChange:r=>{r&&P(r)},className:"justify-start",children:[e.jsx(te,{value:"chrono",className:"text-xs",children:"Chrono"}),e.jsx(te,{value:"texte",className:"text-xs",children:"Texte"}),e.jsx(te,{value:"both",className:"text-xs",children:"Les deux"})]})]}),I&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{children:"Épreuve *"}),e.jsxs(pe,{value:k,onValueChange:O,children:[e.jsx(he,{children:e.jsx(ge,{placeholder:"Choisir une épreuve"})}),e.jsx(fe,{children:ns.map(r=>e.jsx(ae,{value:r,children:le(r)},r))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{children:"Bassin"}),e.jsxs(pe,{value:m,onValueChange:E,children:[e.jsx(he,{children:e.jsx(ge,{})}),e.jsxs(fe,{children:[e.jsx(ae,{value:"25",children:"25m"}),e.jsx(ae,{value:"50",children:"50m"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{children:"Temps cible (min:sec:centièmes)"}),e.jsx(Ye,{placeholder:"Ex : 1:05:30",value:N,onChange:r=>B(r.target.value)})]})]}),Z&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{children:"Objectif texte *"}),e.jsx(K,{placeholder:"Ex : Améliorer la coulée de dos",value:R,onChange:r=>v(r.target.value),rows:3})]}),e.jsx($,{className:"w-full",onClick:He,disabled:de,children:de?"Enregistrement...":d?"Enregistrer":"Créer"})]})]})}),e.jsx(gs,{open:!!b,onOpenChange:r=>{r||_(null)},children:e.jsxs(fs,{children:[e.jsxs(js,{children:[e.jsx(bs,{children:"Supprimer l'objectif"}),e.jsx(ys,{children:"Cette action est irréversible. L'objectif sera supprimé définitivement."})]}),e.jsxs(Ns,{children:[e.jsx(vs,{children:"Annuler"}),e.jsx(_s,{onClick:()=>{b&&Ge.mutate(b.id)},className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Supprimer"})]})]})})]})}function Fs(s){const t=s.split("-");return t.length===3?`${t[2]}/${t[1]}/${t[0]}`:s}function Ce({objective:s,isPersonal:t,performances:n,onEdit:i,onDelete:p}){const c=s.event_code?Re(s.event_code):null,d=c?Le[c]??"":"",h=s.event_code?Ie(n,s.event_code,s.pool_length):null;let b=null,_=null;h&&s.target_time_seconds!=null&&s.event_code&&(b=h.time-s.target_time_seconds,_=Ke(h.time,s.target_time_seconds,s.event_code));const C=!!s.competition_name,j=s.competition_date?ls(s.competition_date):null;return e.jsxs("div",{className:`rounded-lg border bg-card p-3 text-sm space-y-1.5 ${d?`border-l-4 ${d}`:""}`,children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx(J,{className:"h-3.5 w-3.5 text-muted-foreground shrink-0"}),!t&&e.jsx(w,{variant:"secondary",className:"text-[10px] px-1.5 py-0",children:"Coach"}),e.jsxs("div",{className:"flex-1 min-w-0 flex items-center gap-1.5 flex-wrap",children:[s.event_code&&e.jsx("span",{className:"font-medium",children:le(s.event_code)}),s.event_code&&s.pool_length&&e.jsxs("span",{className:"text-muted-foreground",children:["(",s.pool_length,"m)"]}),s.target_time_seconds!=null&&e.jsx("span",{className:"font-mono text-xs text-primary",children:W(s.target_time_seconds)})]}),t&&i&&p&&e.jsxs("div",{className:"ml-auto flex gap-1 shrink-0",children:[e.jsx("button",{type:"button",onClick:()=>i(s),className:"text-xs text-primary hover:underline",children:"Modifier"}),e.jsx("button",{type:"button",onClick:()=>p(s),className:"text-muted-foreground hover:text-destructive p-0.5",children:e.jsx(ws,{className:"h-3.5 w-3.5"})})]})]}),s.text&&e.jsx("p",{className:"text-muted-foreground text-xs pl-5",children:s.text}),s.event_code&&h&&e.jsxs("div",{className:"flex items-center gap-2 pl-5 text-xs text-muted-foreground flex-wrap",children:[e.jsxs("span",{children:["Actuel : ",e.jsx("span",{className:"font-mono",children:W(h.time)})]}),h.date&&e.jsxs("span",{className:"text-muted-foreground/60",children:["(",Fs(h.date),")"]}),b!=null&&e.jsx("span",{className:b<=0?"text-emerald-600 font-medium":"text-amber-600",children:b<=0?"Objectif atteint !":`+${b.toFixed(2)}s`})]}),s.event_code&&!h&&e.jsx("p",{className:"text-[10px] text-muted-foreground italic pl-5",children:"Pas encore de temps enregistré"}),_!=null&&e.jsx("div",{className:"pl-5 pr-1",children:e.jsx("div",{className:"h-1.5 w-full rounded-full bg-muted overflow-hidden",children:e.jsx("div",{className:`h-full rounded-full transition-all duration-500 ${is(_)}`,style:{width:`${Math.min(_,100)}%`}})})}),C&&e.jsx("div",{className:"pl-5",children:e.jsxs(w,{variant:"outline",className:"border-orange-300 text-orange-600 dark:text-orange-400 text-[10px] px-1.5 py-0",children:[s.competition_name,j!=null&&j>0&&e.jsxs("span",{className:"ml-1 font-bold",children:["J-",j]})]})})]})}function qs(s){return new Date(s+"T12:00:00").toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric"})}function Se(s){return new Date(s+"T00:00:00").toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit"})}function Es(s){const t=new Date(s+"T00:00:00");return t.setDate(t.getDate()+6),t.toISOString().split("T")[0]}function Os(s){const t=new Date;t.setHours(0,0,0,0);const n=new Date(s+"T00:00:00"),i=new Date(s+"T00:00:00");return i.setDate(i.getDate()+6),t>=n&&t<=i}function ke(s,t){const n=[],i=new Date(s+"T00:00:00"),p=new Date(t+"T00:00:00"),c=new Date(i),d=c.getDay(),h=d===0?1:d===1?0:8-d;for(c.setDate(c.getDate()+h);c<=p;)n.push(c.toISOString().split("T")[0]),c.setDate(c.getDate()+7);return n}function Te(s,t){const n=new Date(s+"T00:00:00"),i=new Date(t+"T00:00:00");return Math.round((i.getTime()-n.getTime())/(1e3*60*60*24))}function As({athleteId:s}){const t=x.useMemo(()=>new Date().toISOString().split("T")[0],[]),[n,i]=x.useState([]),{data:p=[]}=T({queryKey:["competitions"],queryFn:()=>f.getCompetitions()}),{data:c=[]}=T({queryKey:["my-competition-ids",s],queryFn:()=>f.getMyCompetitionIds(s)}),{data:d=[]}=T({queryKey:["training-cycles","athlete",s],queryFn:()=>f.getTrainingCycles({athleteId:s})}),h=x.useMemo(()=>{const a=new Set(c);return p.filter(l=>a.has(l.id)&&l.date>=t).sort((l,g)=>l.date.localeCompare(g.date))},[c,p,t]),b=x.useMemo(()=>{const a=new Map;return d.slice().sort((l,g)=>(l.end_competition_date??"").localeCompare(g.end_competition_date??"")).forEach(l=>{l.end_competition_id&&!a.has(l.end_competition_id)&&a.set(l.end_competition_id,l)}),a},[d]),_=x.useMemo(()=>{const a=new Set;return h.map(l=>b.get(l.id)??null).filter(l=>!l||a.has(l.id)?!1:(a.add(l.id),!0))},[b,h]),C=Me({queries:_.map(a=>({queryKey:["training-weeks",a.id],queryFn:()=>f.getTrainingWeeks(a.id),enabled:!!a.id}))}),j=x.useMemo(()=>{const a=new Map;return _.forEach((l,g)=>{a.set(l.id,C[g]?.data??[])}),a},[_,C]),S=h[0]??null,o=a=>{i(l=>l.includes(a)?l.filter(g=>g!==a):[...l,a])};return h.length===0?e.jsxs("div",{className:"rounded-3xl border border-dashed bg-card/70 px-4 py-8 text-center",children:[e.jsx(Be,{className:"mx-auto h-10 w-10 text-muted-foreground/60"}),e.jsx("p",{className:"mt-3 text-sm font-medium",children:"Aucune échéance à venir."}),e.jsx("p",{className:"mt-1 text-xs text-muted-foreground",children:"Ton plan apparaîtra ici."})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"rounded-3xl border bg-gradient-to-br from-primary/[0.08] via-background to-amber-500/[0.08] p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx(Cs,{className:"h-4 w-4 text-primary"}),e.jsxs("span",{className:"text-sm font-semibold",children:[h.length," échéance",h.length>1?"s":""]}),S&&e.jsxs(w,{variant:"secondary",className:"text-[10px] px-2 py-0.5",children:["cap J-",Te(t,S.date)]})]}),e.jsx("p",{className:"mt-2 text-xs text-muted-foreground",children:"Vue de tes prochains cycles."})]}),e.jsx("div",{className:"space-y-3",children:h.map((a,l)=>{const g=b.get(a.id)??null,u=g?.start_date??g?.start_competition_date??t,y=u>t?u:t,D=g?ke(y,a.date):[],M=g?ke(u,a.date):[],q=Math.max(M.length-D.length,0),F=g?j.get(g.id)??[]:[],P=new Map(F.map(m=>[m.week_start,m])),k=Te(t,a.date),O=n.includes(a.id);return e.jsx(qe,{open:O,onOpenChange:()=>o(a.id),children:e.jsxs("section",{className:"overflow-hidden rounded-3xl border bg-card shadow-sm",children:[e.jsx(Ee,{asChild:!0,children:e.jsx("button",{type:"button",className:"w-full border-b border-border bg-muted/20 px-4 py-3 text-left transition-colors hover:bg-muted/30",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Ve,{className:`mt-0.5 h-4 w-4 shrink-0 text-muted-foreground transition-transform ${O?"rotate-90":""}`}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"text-sm font-semibold",children:a.name}),l===0&&e.jsx(w,{className:"border-primary/20 bg-primary/10 text-[10px] text-primary",children:"Priorité"}),e.jsx(w,{variant:"secondary",className:"text-[10px]",children:qs(a.date)}),e.jsxs(w,{variant:"outline",className:"text-[10px]",children:["J-",k]})]}),g?e.jsxs("div",{className:"mt-1 flex items-center gap-2 flex-wrap text-xs text-muted-foreground",children:[e.jsx("span",{className:"font-medium text-foreground",children:g.name}),e.jsxs("span",{children:[M.length," sem."]}),q>0&&e.jsxs("span",{children:[q," sem. passée",q>1?"s":""]})]}):e.jsx("p",{className:"mt-1 text-xs text-muted-foreground",children:"Pas de cycle détaillé."})]})]})})}),e.jsx(Oe,{children:g?D.length===0?e.jsx("div",{className:"px-4 py-4 text-xs text-muted-foreground italic",children:"Pas de semaine à venir."}):e.jsx("div",{className:"px-4 py-4",children:e.jsx("div",{className:"relative ml-2 space-y-2 border-l-2 border-border pl-4",children:D.map((m,E)=>{const N=P.get(m),B=Os(m),R=Es(m);return e.jsxs("div",{className:`rounded-2xl border bg-card px-3 py-2 text-xs ${B?"ring-2 ring-primary/40 bg-primary/[0.04]":""}`,children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:`h-2 w-2 rounded-full shrink-0 ${B?"bg-primary":N?.week_type?"bg-muted-foreground/40":"bg-muted-foreground/20"}`}),e.jsxs("span",{className:"whitespace-nowrap text-muted-foreground",children:["Sem. ",q+E+1]}),e.jsxs("span",{className:"whitespace-nowrap text-muted-foreground/70",children:[Se(m)," - ",Se(R)]}),N?.week_type&&e.jsx(w,{className:"ml-auto border-0 px-1.5 py-0 text-[10px]",style:{backgroundColor:$e(N.week_type),color:Pe(N.week_type)},children:N.week_type})]}),N?.notes&&e.jsx("p",{className:"mt-1 pl-4 text-[11px] text-muted-foreground line-clamp-2",children:N.notes})]},m)})})}):e.jsx("div",{className:"px-4 py-4 text-xs text-muted-foreground italic",children:"L'échéance reste affichée."})})]})},a.id)})})]})}function Ps({athleteId:s,athleteName:t,groupLabel:n,onBack:i,standalone:p,defaultTab:c}){return e.jsxs("div",{className:"mx-auto max-w-4xl space-y-4 pb-24",children:[e.jsxs("div",{className:"rounded-[1.75rem] border bg-gradient-to-br from-primary/[0.12] via-background to-amber-500/[0.08] p-4 shadow-sm",children:[!p&&i&&e.jsxs($,{variant:"ghost",size:"sm",className:"-ml-2 mb-2",onClick:i,children:[e.jsx(ie,{className:"mr-1.5 h-4 w-4"}),"Retour"]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex h-11 w-11 shrink-0 items-center justify-center rounded-2xl bg-primary/12 text-primary",children:e.jsx(ze,{className:"h-5 w-5"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("h1",{className:"text-xl font-display font-semibold uppercase italic text-foreground",children:"Mon suivi"}),e.jsx(w,{className:"border-primary/20 bg-primary/10 text-[10px] text-primary",children:"Vue nageur"}),n&&e.jsx(w,{variant:"secondary",className:"text-[10px]",children:n})]}),e.jsxs("p",{className:"mt-1 text-sm text-muted-foreground",children:[t,": ton plan d'action, tes entretiens et tes échéances au même endroit."]})]})]})]}),e.jsxs(es,{defaultValue:c||"objectifs",className:"space-y-4",children:[e.jsxs(ss,{className:"grid h-auto w-full grid-cols-2 gap-2 rounded-2xl bg-transparent p-0 sm:grid-cols-4",children:[e.jsxs(Q,{value:"objectifs",className:"gap-1 rounded-2xl border border-border bg-card px-3 py-2.5 text-xs data-[state=active]:border-primary/30 data-[state=active]:bg-primary/5 data-[state=active]:text-primary",children:[e.jsx(J,{className:"hidden h-3.5 w-3.5 sm:block"}),e.jsx("span",{className:"sm:hidden",children:"Plan d'action"}),e.jsx("span",{className:"hidden sm:inline",children:"Plan d'action"})]}),e.jsxs(Q,{value:"entretiens",className:"gap-1 rounded-2xl border border-border bg-card px-3 py-2.5 text-xs data-[state=active]:border-primary/30 data-[state=active]:bg-primary/5 data-[state=active]:text-primary",children:[e.jsx(Ae,{className:"hidden h-3.5 w-3.5 sm:block"}),e.jsx("span",{className:"sm:hidden",children:"Entretiens"}),e.jsx("span",{className:"hidden sm:inline",children:"Entretiens"})]}),e.jsxs(Q,{value:"planification",className:"gap-1 rounded-2xl border border-border bg-card px-3 py-2.5 text-xs data-[state=active]:border-primary/30 data-[state=active]:bg-primary/5 data-[state=active]:text-primary",children:[e.jsx(Be,{className:"hidden h-3.5 w-3.5 sm:block"}),e.jsx("span",{children:"Planif."})]}),e.jsxs(Q,{value:"ressentis",className:"gap-1 rounded-2xl border border-border bg-card px-3 py-2.5 text-xs data-[state=active]:border-primary/30 data-[state=active]:bg-primary/5 data-[state=active]:text-primary",children:[e.jsx(H,{className:"hidden h-3.5 w-3.5 sm:block"}),e.jsx("span",{className:"sm:hidden",children:"Ressentis"}),e.jsx("span",{className:"hidden sm:inline",children:"Ressentis"})]})]}),e.jsx(G,{value:"objectifs",className:"mt-0",children:e.jsx(Ms,{embedded:!0})}),e.jsx(G,{value:"entretiens",className:"mt-0",children:e.jsx(Ts,{embedded:!0})}),e.jsx(G,{value:"planification",className:"mt-0",children:e.jsx(As,{athleteId:s})}),e.jsx(G,{value:"ressentis",className:"mt-0",children:e.jsx(rs,{athleteId:s,athleteName:t,showProgressAction:!1})})]})]})}function $s(){return typeof window>"u"?void 0:window.location.hash.match(/[?&]tab=([^&]+)/)?.[1]||void 0}function ft(){const s=U(d=>d.user),t=U(d=>d.userId),{data:n,isLoading:i}=T({queryKey:["profile",s,t],queryFn:()=>f.getProfile({displayName:s,userId:t}),enabled:!!s}),{data:p=[]}=T({queryKey:["profile-groups"],queryFn:()=>f.getGroups(),enabled:!!s}),c=p.find(d=>d.id===n?.group_id)?.name||n?.group_label||null;return i?e.jsxs("div",{className:"mx-auto max-w-4xl space-y-4 p-4",children:[e.jsx(se,{className:"h-28 rounded-3xl"}),e.jsx(se,{className:"h-12 rounded-2xl"}),e.jsx(se,{className:"h-64 rounded-2xl"})]}):e.jsx(Ps,{athleteId:t??0,athleteName:n?.display_name||s||"Nageur",groupLabel:c,standalone:!0,defaultTab:$s()})}export{ft as default};
