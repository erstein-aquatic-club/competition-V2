const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/StrengthCatalog-Demew4Qv.js","assets/vendor-query-BiSH4r2z.js","assets/vendor-react-BzrpNAyj.js","assets/api-BCdy2Rcb.js","assets/index-BtvzO39q.js","assets/vendor-supabase-DFPLkPj_.js","assets/index-duJ-8-Tx.css","assets/swim-CkxlArdh.js","assets/index-DKuxrVVj.js","assets/index-CHAn3BPP.js","assets/index-Bi85O3zy.js","assets/select-xdsyI2aR.js","assets/index-CBhf18b_.js","assets/chevron-down-DLHdLKfz.js","assets/chevron-up-Bm_3G2hd.js","assets/CalendarGrid-Cz-7DQgs.js","assets/chevron-left-CQirJdxe.js","assets/chevron-right-BxqnWE5B.js","assets/objectiveHelpers-gJ7vB29u.js","assets/dialog-DNFQjFEy.js","assets/index-BJYsXOLM.js","assets/checkbox-CBmEUV7J.js","assets/alert-dialog-BnsyFmRg.js","assets/tabs-D75HQpui.js","assets/SessionListView-1j_1mZVQ.js","assets/play-DjuhJ7Yw.js","assets/save-DR3z7mTM.js","assets/circle-alert-DY5dnPzX.js","assets/pencil-WpodPZz6.js","assets/share-2-BExzvK06.js","assets/trash-2-D8kpZahv.js","assets/drawer-TzLlI-bO.js","assets/plus-JkM-WuAU.js","assets/loader-circle-oseKiPvr.js","assets/search-BEFED85j.js","assets/pen-Cqys1jvE.js","assets/toggle-group-D8NkBQPi.js","assets/badge-Bb1Z4Aq8.js","assets/copy-CXuytuOs.js","assets/InlineBanner-wyNZ6O0Z.js","assets/separator-CNsZpTWV.js","assets/collapsible-czWeAEvB.js","assets/user-plus-ByYx4mix.js","assets/switch-7_SnwlUO.js","assets/SwimCatalog-DRMJG2j4.js","assets/SwimSessionTimeline-BBmGUMZB.js","assets/swimConsultationUtils-CEPjGNMt.js","assets/timer-DPLVcbWf.js","assets/eye-uY7R9zCj.js","assets/clock-Bjbc4rzo.js","assets/date-NdbyDBh_.js","assets/format-B9mPVj_w.js"])))=>i.map(i=>d[i]);
import{c as Ne,B as L,d as ne,C as Se,i as ke,k as _e,l as Me,g as Ae,L as H,I as je,n as be,o as xs,p as _t,R as gs,q as fs,r as Mt,P as re,t as At,v as Dt,w as vs,x as js,y as bs,z as ys,a as te,X as xt,s as Et,W as Pt,D as Rt,E as Ns,U as De,G as ws,H as Cs,T as nt,u as gt,b as Ss,J as ft,_ as Ft}from"./index-BtvzO39q.js";import{j as e,r,u as U,R as ks,c as qe,d as X}from"./vendor-query-BiSH4r2z.js";import{a as $}from"./api-BCdy2Rcb.js";import{T as dt,a as de}from"./toggle-group-D8NkBQPi.js";import{A as We,T as ut,M as Tt,a as rt,e as Ot,f as $t,F as _s,p as vt}from"./objectiveHelpers-gJ7vB29u.js";import{B as se}from"./badge-Bb1Z4Aq8.js";import{S as ae,a as oe,b as ie,c as le,d as J}from"./select-xdsyI2aR.js";import{h as Ms,R as As,u as Ds,F as Es,C as jt}from"./index-CBhf18b_.js";import{u as pe}from"./index-Bi85O3zy.js";import{R as Ps,P as Rs,O as Fs,C as Ts}from"./index-BJYsXOLM.js";import"./dialog-DNFQjFEy.js";import{S as Os}from"./search-BEFED85j.js";import{C as $s}from"./copy-CXuytuOs.js";import{a as Is,b as qs,P as zs}from"./CalendarGrid-Cz-7DQgs.js";import{S as ze,a as Le,b as Ke,c as Ge,d as mt,A as Ee,e as Pe,f as Re,g as Fe,h as Te,i as Oe,j as $e,k as Ie}from"./alert-dialog-BnsyFmRg.js";import{I as Ls}from"./InlineBanner-wyNZ6O0Z.js";import{C as Ks}from"./circle-alert-DY5dnPzX.js";import{T as It}from"./trash-2-D8kpZahv.js";import{C as qt}from"./checkbox-CBmEUV7J.js";import{S as Gs}from"./separator-CNsZpTWV.js";import{C as Vs,a as Bs,b as Us}from"./collapsible-czWeAEvB.js";import{P as he}from"./plus-JkM-WuAU.js";import{U as Hs,a as Qs}from"./user-plus-ByYx4mix.js";import{C as Ws}from"./chevron-down-DLHdLKfz.js";import{S as Ys}from"./switch-7_SnwlUO.js";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Js=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 18h.01",key:"lrp35t"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M16 18h.01",key:"kzsmim"}]],at=Ne("calendar-days",Js);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xs=[["path",{d:"m7 15 5 5 5-5",key:"1hf1tw"}],["path",{d:"m7 9 5-5 5 5",key:"sgt6xg"}]],Zs=Ne("chevrons-up-down",Xs);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const en=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]],zt=Ne("external-link",en);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tn=[["path",{d:"M2 9.5a5.5 5.5 0 0 1 9.591-3.676.56.56 0 0 0 .818 0A5.49 5.49 0 0 1 22 9.5c0 2.29-1.5 4-3 5.5l-5.492 5.313a2 2 0 0 1-3 .019L5 15c-1.5-1.5-3-3.2-3-5.5",key:"mvr1a0"}],["path",{d:"M3.22 13H9.5l.5-1 2 4.5 2-7 1.5 3.5h5.27",key:"auskq0"}]],sn=Ne("heart-pulse",tn);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nn=[["path",{d:"m22 7-8.991 5.727a2 2 0 0 1-2.009 0L2 7",key:"132q7q"}],["rect",{x:"2",y:"4",width:"20",height:"16",rx:"2",key:"izxlao"}]],Lt=Ne("mail",nn);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rn=[["path",{d:"M18 21a8 8 0 0 0-16 0",key:"3ypg7q"}],["circle",{cx:"10",cy:"8",r:"5",key:"o932ke"}],["path",{d:"M22 20c0-3.37-2-6.5-4-8a5 5 0 0 0-.45-8.3",key:"10s06x"}]],Kt=Ne("users-round",rn),ce=({title:t,description:n,onBack:s,actions:o})=>e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs(L,{variant:"ghost",size:"sm",className:"-ml-2",onClick:s,children:[e.jsx(We,{className:"mr-2 h-4 w-4"}),"Retour"]}),e.jsx("h2",{className:"text-2xl font-display font-semibold uppercase italic text-primary",children:t}),n?e.jsx("p",{className:"text-sm text-muted-foreground",children:n}):null]}),o?e.jsx("div",{className:"flex items-center gap-2",children:o}):null]});function an(t){if(t.length===0)return null;const n=t[0],s=n.effort,o=n.fatigue,a=n.performance,i=n.engagement,d=[];return s!=null&&d.push((11-s)/2),o!=null&&d.push((11-o)/2),a!=null&&d.push(a/2),i!=null&&d.push(i/2),d.length===0?null:Math.round(d.reduce((l,x)=>l+x,0)/d.length*10)/10}function on(t){return t==null?{label:"—",className:"bg-muted text-muted-foreground"}:t>=3.5?{label:`${t.toFixed(1)}`,className:"bg-emerald-100 text-emerald-800 dark:bg-emerald-900/30 dark:text-emerald-400"}:t>=2.5?{label:`${t.toFixed(1)}`,className:"bg-amber-100 text-amber-800 dark:bg-amber-900/30 dark:text-amber-400"}:{label:`${t.toFixed(1)}`,className:"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400"}}function ln({athletes:t,athletesLoading:n,onBack:s,onOpenAthlete:o}){const[a,i]=r.useState(null),[d,l]=r.useState("name"),{data:x=[]}=U({queryKey:["recent-sessions-all",30],queryFn:()=>$.getRecentSessionsAllAthletes(30),enabled:t.length>0,staleTime:300*1e3}),{data:u}=U({queryKey:["objectives-counts-by-user"],queryFn:()=>$.getObjectivesCountsByUser(),enabled:t.length>0,staleTime:300*1e3}),m=r.useMemo(()=>{const h=new Map;return t.forEach(c=>{c.group_id&&c.group_label&&h.set(c.group_id,c.group_label)}),Array.from(h.entries()).map(([c,f])=>({id:c,name:f})).sort((c,f)=>c.name.localeCompare(f.name,"fr"))},[t]),p=r.useMemo(()=>{const h=new Map,c=new Map;for(const f of x){if(f.athlete_id==null)continue;const _=c.get(f.athlete_id)??[];_.push(f),c.set(f.athlete_id,_)}for(const f of t){if(f.id==null)continue;const _=c.get(f.id)??[],y=an(_),S=_.length>0?_[0].session_date:null;h.set(f.id,{forme:y,lastSessionDate:S,sessionsCount30d:_.length,assiduity:null,objectivesTotal:u?.get(f.id)??0,objectivesAchieved:0})}return h},[t,x,u]),v=r.useMemo(()=>{let h=[...t];switch(a!=null&&(h=h.filter(c=>c.group_id===a)),d){case"forme":h.sort((c,f)=>{const _=c.id!=null?p.get(c.id)?.forme??99:99,y=f.id!=null?p.get(f.id)?.forme??99:99;return _-y});break;case"assiduity":h.sort((c,f)=>{const _=c.id!=null?p.get(c.id)?.sessionsCount30d??99:99,y=f.id!=null?p.get(f.id)?.sessionsCount30d??99:99;return _-y});break;default:h.sort((c,f)=>c.display_name.localeCompare(f.display_name,"fr"))}return h},[t,a,d,p]);return e.jsxs("div",{className:"space-y-4",children:[e.jsx(ce,{title:"Nageurs",description:n?"Chargement…":`${t.length} nageur${t.length!==1?"s":""}`,onBack:s}),m.length>1&&e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{type:"button",onClick:()=>i(null),className:`rounded-full px-3 py-1 text-xs font-medium border transition ${a==null?"bg-foreground text-background border-foreground":"bg-card text-foreground border-border hover:bg-muted"}`,children:"Tous"}),m.map(h=>e.jsx("button",{type:"button",onClick:()=>i(a===h.id?null:h.id),className:`rounded-full px-3 py-1 text-xs font-medium border transition ${a===h.id?"bg-foreground text-background border-foreground":"bg-card text-foreground border-border hover:bg-muted"}`,children:h.name},h.id))]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"Trier :"}),[{key:"name",label:"Nom"},{key:"forme",label:"Forme"},{key:"assiduity",label:"Activité"}].map(h=>e.jsx("button",{type:"button",onClick:()=>l(h.key),className:`rounded-full px-2.5 py-0.5 text-xs font-medium border transition ${d===h.key?"bg-primary/10 text-primary border-primary/30":"bg-card text-muted-foreground border-border hover:bg-muted"}`,children:h.label},h.key))]}),n?e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3",children:[1,2,3,4,5,6].map(h=>e.jsxs("div",{className:"rounded-2xl border bg-card p-4 animate-pulse motion-reduce:animate-none",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-muted"}),e.jsxs("div",{className:"space-y-1.5 flex-1",children:[e.jsx("div",{className:"h-4 w-24 rounded bg-muted"}),e.jsx("div",{className:"h-3 w-16 rounded bg-muted"})]})]}),e.jsxs("div",{className:"mt-3 space-y-2",children:[e.jsx("div",{className:"h-3 w-full rounded bg-muted"}),e.jsx("div",{className:"h-3 w-2/3 rounded bg-muted"})]})]},h))}):v.length===0?e.jsx("p",{className:"text-sm text-muted-foreground text-center py-8",children:a!=null?"Aucun nageur dans ce groupe.":"Aucun nageur disponible."}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3",children:v.map(h=>{const c=h.id!=null?p.get(h.id):null,f=on(c?.forme??null);return e.jsxs("button",{type:"button",onClick:()=>o(h),className:"rounded-2xl border bg-card p-4 text-left hover:shadow-md hover:border-primary/20 transition-all",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[h.avatar_url?e.jsx("img",{src:h.avatar_url,alt:"",className:"h-10 w-10 rounded-full object-cover border border-border"}):e.jsx("div",{className:"h-10 w-10 rounded-full bg-primary/10 flex items-center justify-center text-sm font-bold text-primary",children:h.display_name.charAt(0).toUpperCase()}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-sm font-semibold truncate",children:h.display_name}),h.group_label&&e.jsx(se,{variant:"secondary",className:"text-[10px] px-1.5 py-0 mt-0.5",children:h.group_label})]})]}),e.jsxs("div",{className:"mt-3 grid grid-cols-3 gap-2",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-[10px] font-medium text-muted-foreground mb-1",children:"Forme"}),e.jsx("span",{className:`inline-block rounded-full px-2 py-0.5 text-xs font-semibold ${f.className}`,children:f.label})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-[10px] font-medium text-muted-foreground mb-1",children:"30j"}),e.jsx("span",{className:"text-sm font-bold text-foreground",children:c?.sessionsCount30d??0}),e.jsx("span",{className:"text-[10px] text-muted-foreground ml-0.5",children:"séances"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-[10px] font-medium text-muted-foreground mb-1",children:"Objectifs"}),e.jsx("span",{className:"text-sm font-bold text-foreground",children:c?.objectivesTotal??0})]})]}),c?.lastSessionDate&&e.jsxs("div",{className:"mt-2 text-[10px] text-muted-foreground",children:["Dernier ressenti : ",new Date(c.lastSessionDate).toLocaleDateString("fr-FR",{day:"numeric",month:"short"})]})]},h.id??h.display_name)})})]})}const cn=({onBack:t,athletes:n,groups:s,athletesLoading:o})=>{const{toast:a}=ne(),[i,d]=r.useState(""),[l,x]=r.useState(""),u=r.useMemo(()=>n.filter(c=>c.id&&c.email).map(c=>({value:`user:${c.id}`,label:c.group_label?`${c.display_name} · ${c.group_label}`:c.display_name,email:c.email})),[n]),m=r.useMemo(()=>s.map(c=>({value:`group:${c.id}`,label:c.name,id:c.id})),[s]),p=()=>{if(!l)return[];if(l.startsWith("user:")){const c=u.find(f=>f.value===l);return c?[c.email]:[]}if(l.startsWith("group:")){const c=Number(l.split(":")[1]);return n.filter(f=>f.group_id===c&&f.email).map(f=>f.email)}return[]},v=()=>{const c=p();if(!c.length){a({title:"Aucune adresse email",description:"Aucun nageur avec une adresse email dans cette sélection."});return}const f=new URLSearchParams;f.set("bcc",c.join(",")),i.trim()&&f.set("subject",i.trim()),window.location.href=`mailto:?${f.toString()}`},h=p();return e.jsxs("div",{className:"space-y-6 pb-24",children:[e.jsx(ce,{title:"Contacter par email",description:"Ouvre votre application mail avec les destinataires en CCI.",onBack:t}),e.jsxs(Se,{className:"border-l-4 border-l-primary",children:[e.jsxs(ke,{children:[e.jsx(_e,{children:"Destinataire"}),e.jsx(Me,{children:"Sélectionnez un nageur ou un groupe."})]}),e.jsxs(Ae,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(H,{children:"Destinataire"}),e.jsxs(ae,{value:l,onValueChange:x,children:[e.jsx(oe,{children:e.jsx(ie,{placeholder:o?"Chargement...":"Choisir un nageur ou un groupe"})}),e.jsxs(le,{children:[m.length?e.jsxs(e.Fragment,{children:[e.jsx(J,{value:"section-group",disabled:!0,children:"Groupes"}),m.map(c=>e.jsx(J,{value:c.value,children:c.label},c.value))]}):null,u.length?e.jsxs(e.Fragment,{children:[e.jsx(J,{value:"section-athlete",disabled:!0,children:"Nageurs"}),u.map(c=>e.jsx(J,{value:c.value,children:c.label},c.value))]}):null]})]})]}),l&&h.length>0?e.jsxs("p",{className:"text-xs text-muted-foreground",children:[h.length," adresse",h.length>1?"s":""," email",h.length>1?" (envoi en CCI)":""]}):null,l&&h.length===0?e.jsx("p",{className:"text-xs text-destructive",children:"Aucune adresse email disponible pour cette sélection."}):null]})]}),e.jsxs(Se,{children:[e.jsxs(ke,{children:[e.jsx(_e,{children:"Objet"}),e.jsx(Me,{children:"Optionnel — pré-rempli dans votre application mail."})]}),e.jsx(Ae,{children:e.jsx(je,{value:i,onChange:c=>d(c.target.value),placeholder:"Objet du mail…"})})]}),e.jsx("div",{className:"sticky bottom-0 z-10 -mx-4 border-t bg-background/95 p-4 backdrop-blur sm:static sm:mx-0 sm:border-0 sm:p-0",children:e.jsxs(L,{className:"w-full sm:w-auto",onClick:v,disabled:!l||h.length===0,children:[e.jsx(Lt,{className:"mr-2 h-4 w-4"}),"Ouvrir dans l'app mail",e.jsx(zt,{className:"ml-2 h-3 w-3"})]})})]})};function Ce(t,n,{checkForDefaultPrevented:s=!0}={}){return function(a){if(t?.(a),s===!1||!a.defaultPrevented)return n?.(a)}}function dn(t){const n=un(t),s=r.forwardRef((o,a)=>{const{children:i,...d}=o,l=r.Children.toArray(i),x=l.find(pn);if(x){const u=x.props.children,m=l.map(p=>p===x?r.Children.count(u)>1?r.Children.only(null):r.isValidElement(u)?u.props.children:null:p);return e.jsx(n,{...d,ref:a,children:r.isValidElement(u)?r.cloneElement(u,void 0,m):null})}return e.jsx(n,{...d,ref:a,children:i})});return s.displayName=`${t}.Slot`,s}function un(t){const n=r.forwardRef((s,o)=>{const{children:a,...i}=s;if(r.isValidElement(a)){const d=xn(a),l=hn(i,a.props);return a.type!==r.Fragment&&(l.ref=o?be(o,d):d),r.cloneElement(a,l)}return r.Children.count(a)>1?r.Children.only(null):null});return n.displayName=`${t}.SlotClone`,n}var mn=Symbol("radix.slottable");function pn(t){return r.isValidElement(t)&&typeof t.type=="function"&&"__radixId"in t.type&&t.type.__radixId===mn}function hn(t,n){const s={...n};for(const o in n){const a=t[o],i=n[o];/^on[A-Z]/.test(o)?a&&i?s[o]=(...l)=>{const x=i(...l);return a(...l),x}:a&&(s[o]=a):o==="style"?s[o]={...a,...i}:o==="className"&&(s[o]=[a,i].filter(Boolean).join(" "))}return{...t,...s}}function xn(t){let n=Object.getOwnPropertyDescriptor(t.props,"ref")?.get,s=n&&"isReactWarning"in n&&n.isReactWarning;return s?t.ref:(n=Object.getOwnPropertyDescriptor(t,"ref")?.get,s=n&&"isReactWarning"in n&&n.isReactWarning,s?t.props.ref:t.props.ref||t.ref)}var gn=ks[" useInsertionEffect ".trim().toString()]||xs;function fn({prop:t,defaultProp:n,onChange:s=()=>{},caller:o}){const[a,i,d]=vn({defaultProp:n,onChange:s}),l=t!==void 0,x=l?t:a;{const m=r.useRef(t!==void 0);r.useEffect(()=>{const p=m.current;p!==l&&console.warn(`${o} is changing from ${p?"controlled":"uncontrolled"} to ${l?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),m.current=l},[l,o])}const u=r.useCallback(m=>{if(l){const p=jn(m)?m(t):m;p!==t&&d.current?.(p)}else i(m)},[l,t,i,d]);return[x,u]}function vn({defaultProp:t,onChange:n}){const[s,o]=r.useState(t),a=r.useRef(s),i=r.useRef(n);return gn(()=>{i.current=n},[n]),r.useEffect(()=>{a.current!==s&&(i.current?.(s),a.current=s)},[s,a]),[s,o,i]}function jn(t){return typeof t=="function"}var Ye="Popover",[Gt]=fs(Ye,[_t]),Ve=_t(),[bn,me]=Gt(Ye),Vt=t=>{const{__scopePopover:n,children:s,open:o,defaultOpen:a,onOpenChange:i,modal:d=!1}=t,l=Ve(n),x=r.useRef(null),[u,m]=r.useState(!1),[p,v]=fn({prop:o,defaultProp:a??!1,onChange:i,caller:Ye});return e.jsx(gs,{...l,children:e.jsx(bn,{scope:n,contentId:pe(),triggerRef:x,open:p,onOpenChange:v,onOpenToggle:r.useCallback(()=>v(h=>!h),[v]),hasCustomAnchor:u,onCustomAnchorAdd:r.useCallback(()=>m(!0),[]),onCustomAnchorRemove:r.useCallback(()=>m(!1),[]),modal:d,children:s})})};Vt.displayName=Ye;var Bt="PopoverAnchor",yn=r.forwardRef((t,n)=>{const{__scopePopover:s,...o}=t,a=me(Bt,s),i=Ve(s),{onCustomAnchorAdd:d,onCustomAnchorRemove:l}=a;return r.useEffect(()=>(d(),()=>l()),[d,l]),e.jsx(At,{...i,...o,ref:n})});yn.displayName=Bt;var Ut="PopoverTrigger",Ht=r.forwardRef((t,n)=>{const{__scopePopover:s,...o}=t,a=me(Ut,s),i=Ve(s),d=Mt(n,a.triggerRef),l=e.jsx(re.button,{type:"button","aria-haspopup":"dialog","aria-expanded":a.open,"aria-controls":a.contentId,"data-state":Xt(a.open),...o,ref:d,onClick:Ce(t.onClick,a.onOpenToggle)});return a.hasCustomAnchor?l:e.jsx(At,{asChild:!0,...i,children:l})});Ht.displayName=Ut;var pt="PopoverPortal",[Nn,wn]=Gt(pt,{forceMount:void 0}),Qt=t=>{const{__scopePopover:n,forceMount:s,children:o,container:a}=t,i=me(pt,n);return e.jsx(Nn,{scope:n,forceMount:s,children:e.jsx(Dt,{present:s||i.open,children:e.jsx(vs,{asChild:!0,container:a,children:o})})})};Qt.displayName=pt;var ye="PopoverContent",Wt=r.forwardRef((t,n)=>{const s=wn(ye,t.__scopePopover),{forceMount:o=s.forceMount,...a}=t,i=me(ye,t.__scopePopover);return e.jsx(Dt,{present:o||i.open,children:i.modal?e.jsx(Sn,{...a,ref:n}):e.jsx(kn,{...a,ref:n})})});Wt.displayName=ye;var Cn=dn("PopoverContent.RemoveScroll"),Sn=r.forwardRef((t,n)=>{const s=me(ye,t.__scopePopover),o=r.useRef(null),a=Mt(n,o),i=r.useRef(!1);return r.useEffect(()=>{const d=o.current;if(d)return Ms(d)},[]),e.jsx(As,{as:Cn,allowPinchZoom:!0,children:e.jsx(Yt,{...t,ref:a,trapFocus:s.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:Ce(t.onCloseAutoFocus,d=>{d.preventDefault(),i.current||s.triggerRef.current?.focus()}),onPointerDownOutside:Ce(t.onPointerDownOutside,d=>{const l=d.detail.originalEvent,x=l.button===0&&l.ctrlKey===!0,u=l.button===2||x;i.current=u},{checkForDefaultPrevented:!1}),onFocusOutside:Ce(t.onFocusOutside,d=>d.preventDefault(),{checkForDefaultPrevented:!1})})})}),kn=r.forwardRef((t,n)=>{const s=me(ye,t.__scopePopover),o=r.useRef(!1),a=r.useRef(!1);return e.jsx(Yt,{...t,ref:n,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:i=>{t.onCloseAutoFocus?.(i),i.defaultPrevented||(o.current||s.triggerRef.current?.focus(),i.preventDefault()),o.current=!1,a.current=!1},onInteractOutside:i=>{t.onInteractOutside?.(i),i.defaultPrevented||(o.current=!0,i.detail.originalEvent.type==="pointerdown"&&(a.current=!0));const d=i.target;s.triggerRef.current?.contains(d)&&i.preventDefault(),i.detail.originalEvent.type==="focusin"&&a.current&&i.preventDefault()}})}),Yt=r.forwardRef((t,n)=>{const{__scopePopover:s,trapFocus:o,onOpenAutoFocus:a,onCloseAutoFocus:i,disableOutsidePointerEvents:d,onEscapeKeyDown:l,onPointerDownOutside:x,onFocusOutside:u,onInteractOutside:m,...p}=t,v=me(ye,s),h=Ve(s);return Ds(),e.jsx(Es,{asChild:!0,loop:!0,trapped:o,onMountAutoFocus:a,onUnmountAutoFocus:i,children:e.jsx(js,{asChild:!0,disableOutsidePointerEvents:d,onInteractOutside:m,onEscapeKeyDown:l,onPointerDownOutside:x,onFocusOutside:u,onDismiss:()=>v.onOpenChange(!1),children:e.jsx(bs,{"data-state":Xt(v.open),role:"dialog",id:v.contentId,...h,...p,ref:n,style:{...p.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}})})})}),Jt="PopoverClose",_n=r.forwardRef((t,n)=>{const{__scopePopover:s,...o}=t,a=me(Jt,s);return e.jsx(re.button,{type:"button",...o,ref:n,onClick:Ce(t.onClick,()=>a.onOpenChange(!1))})});_n.displayName=Jt;var Mn="PopoverArrow",An=r.forwardRef((t,n)=>{const{__scopePopover:s,...o}=t,a=Ve(s);return e.jsx(ys,{...a,...o,ref:n})});An.displayName=Mn;function Xt(t){return t?"open":"closed"}var Dn=Vt,En=Ht,Pn=Qt,Zt=Wt;const Rn=Dn,Fn=En,es=r.forwardRef(({className:t,align:n="center",sideOffset:s=4,...o},a)=>e.jsx(Pn,{children:e.jsx(Zt,{ref:a,align:n,sideOffset:s,className:te("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-popover-content-transform-origin]",t),...o})}));es.displayName=Zt.displayName;var bt=1,Tn=.9,On=.8,$n=.17,Xe=.1,Ze=.999,In=.9999,qn=.99,zn=/[\\\/_+.#"@\[\(\{&]/,Ln=/[\\\/_+.#"@\[\(\{&]/g,Kn=/[\s-]/,ts=/[\s-]/g;function ot(t,n,s,o,a,i,d){if(i===n.length)return a===t.length?bt:qn;var l=`${a},${i}`;if(d[l]!==void 0)return d[l];for(var x=o.charAt(i),u=s.indexOf(x,a),m=0,p,v,h,c;u>=0;)p=ot(t,n,s,o,u+1,i+1,d),p>m&&(u===a?p*=bt:zn.test(t.charAt(u-1))?(p*=On,h=t.slice(a,u-1).match(Ln),h&&a>0&&(p*=Math.pow(Ze,h.length))):Kn.test(t.charAt(u-1))?(p*=Tn,c=t.slice(a,u-1).match(ts),c&&a>0&&(p*=Math.pow(Ze,c.length))):(p*=$n,a>0&&(p*=Math.pow(Ze,u-a))),t.charAt(u)!==n.charAt(i)&&(p*=In)),(p<Xe&&s.charAt(u-1)===o.charAt(i+1)||o.charAt(i+1)===o.charAt(i)&&s.charAt(u-1)!==o.charAt(i))&&(v=ot(t,n,s,o,u+1,i+2,d),v*Xe>p&&(p=v*Xe)),p>m&&(m=p),u=s.indexOf(x,u+1);return d[l]=m,m}function yt(t){return t.toLowerCase().replace(ts," ")}function Gn(t,n,s){return t=s&&s.length>0?`${t+" "+s.join(" ")}`:t,ot(t,n,yt(t),yt(n),0,0,{})}var we='[cmdk-group=""]',et='[cmdk-group-items=""]',Vn='[cmdk-group-heading=""]',ss='[cmdk-item=""]',Nt=`${ss}:not([aria-disabled="true"])`,it="cmdk-item-select",fe="data-value",Bn=(t,n,s)=>Gn(t,n,s),ns=r.createContext(void 0),Be=()=>r.useContext(ns),rs=r.createContext(void 0),ht=()=>r.useContext(rs),as=r.createContext(void 0),os=r.forwardRef((t,n)=>{let s=ve(()=>{var g,M;return{search:"",value:(M=(g=t.value)!=null?g:t.defaultValue)!=null?M:"",selectedItemId:void 0,filtered:{count:0,items:new Map,groups:new Set}}}),o=ve(()=>new Set),a=ve(()=>new Map),i=ve(()=>new Map),d=ve(()=>new Set),l=is(t),{label:x,children:u,value:m,onValueChange:p,filter:v,shouldFilter:h,loop:c,disablePointerSelection:f=!1,vimBindings:_=!0,...y}=t,S=pe(),V=pe(),z=pe(),P=r.useRef(null),k=sr();xe(()=>{if(m!==void 0){let g=m.trim();s.current.value=g,E.emit()}},[m]),xe(()=>{k(6,F)},[]);let E=r.useMemo(()=>({subscribe:g=>(d.current.add(g),()=>d.current.delete(g)),snapshot:()=>s.current,setState:(g,M,N)=>{var w,q,G,W;if(!Object.is(s.current[g],M)){if(s.current[g]=M,g==="search")B(),R(),k(1,O);else if(g==="value"){if(document.activeElement.hasAttribute("cmdk-input")||document.activeElement.hasAttribute("cmdk-root")){let Y=document.getElementById(z);Y?Y.focus():(w=document.getElementById(S))==null||w.focus()}if(k(7,()=>{var Y;s.current.selectedItemId=(Y=C())==null?void 0:Y.id,E.emit()}),N||k(5,F),((q=l.current)==null?void 0:q.value)!==void 0){let Y=M??"";(W=(G=l.current).onValueChange)==null||W.call(G,Y);return}}E.emit()}},emit:()=>{d.current.forEach(g=>g())}}),[]),D=r.useMemo(()=>({value:(g,M,N)=>{var w;M!==((w=i.current.get(g))==null?void 0:w.value)&&(i.current.set(g,{value:M,keywords:N}),s.current.filtered.items.set(g,b(M,N)),k(2,()=>{R(),E.emit()}))},item:(g,M)=>(o.current.add(g),M&&(a.current.has(M)?a.current.get(M).add(g):a.current.set(M,new Set([g]))),k(3,()=>{B(),R(),s.current.value||O(),E.emit()}),()=>{i.current.delete(g),o.current.delete(g),s.current.filtered.items.delete(g);let N=C();k(4,()=>{B(),N?.getAttribute("id")===g&&O(),E.emit()})}),group:g=>(a.current.has(g)||a.current.set(g,new Set),()=>{i.current.delete(g),a.current.delete(g)}),filter:()=>l.current.shouldFilter,label:x||t["aria-label"],getDisablePointerSelection:()=>l.current.disablePointerSelection,listId:S,inputId:z,labelId:V,listInnerRef:P}),[]);function b(g,M){var N,w;let q=(w=(N=l.current)==null?void 0:N.filter)!=null?w:Bn;return g?q(g,s.current.search,M):0}function R(){if(!s.current.search||l.current.shouldFilter===!1)return;let g=s.current.filtered.items,M=[];s.current.filtered.groups.forEach(w=>{let q=a.current.get(w),G=0;q.forEach(W=>{let Y=g.get(W);G=Math.max(Y,G)}),M.push([w,G])});let N=P.current;j().sort((w,q)=>{var G,W;let Y=w.getAttribute("id"),Ue=q.getAttribute("id");return((G=g.get(Ue))!=null?G:0)-((W=g.get(Y))!=null?W:0)}).forEach(w=>{let q=w.closest(et);q?q.appendChild(w.parentElement===q?w:w.closest(`${et} > *`)):N.appendChild(w.parentElement===N?w:w.closest(`${et} > *`))}),M.sort((w,q)=>q[1]-w[1]).forEach(w=>{var q;let G=(q=P.current)==null?void 0:q.querySelector(`${we}[${fe}="${encodeURIComponent(w[0])}"]`);G?.parentElement.appendChild(G)})}function O(){let g=j().find(N=>N.getAttribute("aria-disabled")!=="true"),M=g?.getAttribute(fe);E.setState("value",M||void 0)}function B(){var g,M,N,w;if(!s.current.search||l.current.shouldFilter===!1){s.current.filtered.count=o.current.size;return}s.current.filtered.groups=new Set;let q=0;for(let G of o.current){let W=(M=(g=i.current.get(G))==null?void 0:g.value)!=null?M:"",Y=(w=(N=i.current.get(G))==null?void 0:N.keywords)!=null?w:[],Ue=b(W,Y);s.current.filtered.items.set(G,Ue),Ue>0&&q++}for(let[G,W]of a.current)for(let Y of W)if(s.current.filtered.items.get(Y)>0){s.current.filtered.groups.add(G);break}s.current.filtered.count=q}function F(){var g,M,N;let w=C();w&&(((g=w.parentElement)==null?void 0:g.firstChild)===w&&((N=(M=w.closest(we))==null?void 0:M.querySelector(Vn))==null||N.scrollIntoView({block:"nearest"})),w.scrollIntoView({block:"nearest"}))}function C(){var g;return(g=P.current)==null?void 0:g.querySelector(`${ss}[aria-selected="true"]`)}function j(){var g;return Array.from(((g=P.current)==null?void 0:g.querySelectorAll(Nt))||[])}function T(g){let M=j()[g];M&&E.setState("value",M.getAttribute(fe))}function I(g){var M;let N=C(),w=j(),q=w.findIndex(W=>W===N),G=w[q+g];(M=l.current)!=null&&M.loop&&(G=q+g<0?w[w.length-1]:q+g===w.length?w[0]:w[q+g]),G&&E.setState("value",G.getAttribute(fe))}function K(g){let M=C(),N=M?.closest(we),w;for(;N&&!w;)N=g>0?er(N,we):tr(N,we),w=N?.querySelector(Nt);w?E.setState("value",w.getAttribute(fe)):I(g)}let ee=()=>T(j().length-1),A=g=>{g.preventDefault(),g.metaKey?ee():g.altKey?K(1):I(1)},Q=g=>{g.preventDefault(),g.metaKey?T(0):g.altKey?K(-1):I(-1)};return r.createElement(re.div,{ref:n,tabIndex:-1,...y,"cmdk-root":"",onKeyDown:g=>{var M;(M=y.onKeyDown)==null||M.call(y,g);let N=g.nativeEvent.isComposing||g.keyCode===229;if(!(g.defaultPrevented||N))switch(g.key){case"n":case"j":{_&&g.ctrlKey&&A(g);break}case"ArrowDown":{A(g);break}case"p":case"k":{_&&g.ctrlKey&&Q(g);break}case"ArrowUp":{Q(g);break}case"Home":{g.preventDefault(),T(0);break}case"End":{g.preventDefault(),ee();break}case"Enter":{g.preventDefault();let w=C();if(w){let q=new Event(it);w.dispatchEvent(q)}}}}},r.createElement("label",{"cmdk-label":"",htmlFor:D.inputId,id:D.labelId,style:rr},x),Je(t,g=>r.createElement(rs.Provider,{value:E},r.createElement(ns.Provider,{value:D},g))))}),Un=r.forwardRef((t,n)=>{var s,o;let a=pe(),i=r.useRef(null),d=r.useContext(as),l=Be(),x=is(t),u=(o=(s=x.current)==null?void 0:s.forceMount)!=null?o:d?.forceMount;xe(()=>{if(!u)return l.item(a,d?.id)},[u]);let m=ls(a,i,[t.value,t.children,i],t.keywords),p=ht(),v=ue(k=>k.value&&k.value===m.current),h=ue(k=>u||l.filter()===!1?!0:k.search?k.filtered.items.get(a)>0:!0);r.useEffect(()=>{let k=i.current;if(!(!k||t.disabled))return k.addEventListener(it,c),()=>k.removeEventListener(it,c)},[h,t.onSelect,t.disabled]);function c(){var k,E;f(),(E=(k=x.current).onSelect)==null||E.call(k,m.current)}function f(){p.setState("value",m.current,!0)}if(!h)return null;let{disabled:_,value:y,onSelect:S,forceMount:V,keywords:z,...P}=t;return r.createElement(re.div,{ref:be(i,n),...P,id:a,"cmdk-item":"",role:"option","aria-disabled":!!_,"aria-selected":!!v,"data-disabled":!!_,"data-selected":!!v,onPointerMove:_||l.getDisablePointerSelection()?void 0:f,onClick:_?void 0:c},t.children)}),Hn=r.forwardRef((t,n)=>{let{heading:s,children:o,forceMount:a,...i}=t,d=pe(),l=r.useRef(null),x=r.useRef(null),u=pe(),m=Be(),p=ue(h=>a||m.filter()===!1?!0:h.search?h.filtered.groups.has(d):!0);xe(()=>m.group(d),[]),ls(d,l,[t.value,t.heading,x]);let v=r.useMemo(()=>({id:d,forceMount:a}),[a]);return r.createElement(re.div,{ref:be(l,n),...i,"cmdk-group":"",role:"presentation",hidden:p?void 0:!0},s&&r.createElement("div",{ref:x,"cmdk-group-heading":"","aria-hidden":!0,id:u},s),Je(t,h=>r.createElement("div",{"cmdk-group-items":"",role:"group","aria-labelledby":s?u:void 0},r.createElement(as.Provider,{value:v},h))))}),Qn=r.forwardRef((t,n)=>{let{alwaysRender:s,...o}=t,a=r.useRef(null),i=ue(d=>!d.search);return!s&&!i?null:r.createElement(re.div,{ref:be(a,n),...o,"cmdk-separator":"",role:"separator"})}),Wn=r.forwardRef((t,n)=>{let{onValueChange:s,...o}=t,a=t.value!=null,i=ht(),d=ue(u=>u.search),l=ue(u=>u.selectedItemId),x=Be();return r.useEffect(()=>{t.value!=null&&i.setState("search",t.value)},[t.value]),r.createElement(re.input,{ref:n,...o,"cmdk-input":"",autoComplete:"off",autoCorrect:"off",spellCheck:!1,"aria-autocomplete":"list",role:"combobox","aria-expanded":!0,"aria-controls":x.listId,"aria-labelledby":x.labelId,"aria-activedescendant":l,id:x.inputId,type:"text",value:a?t.value:d,onChange:u=>{a||i.setState("search",u.target.value),s?.(u.target.value)}})}),Yn=r.forwardRef((t,n)=>{let{children:s,label:o="Suggestions",...a}=t,i=r.useRef(null),d=r.useRef(null),l=ue(u=>u.selectedItemId),x=Be();return r.useEffect(()=>{if(d.current&&i.current){let u=d.current,m=i.current,p,v=new ResizeObserver(()=>{p=requestAnimationFrame(()=>{let h=u.offsetHeight;m.style.setProperty("--cmdk-list-height",h.toFixed(1)+"px")})});return v.observe(u),()=>{cancelAnimationFrame(p),v.unobserve(u)}}},[]),r.createElement(re.div,{ref:be(i,n),...a,"cmdk-list":"",role:"listbox",tabIndex:-1,"aria-activedescendant":l,"aria-label":o,id:x.listId},Je(t,u=>r.createElement("div",{ref:be(d,x.listInnerRef),"cmdk-list-sizer":""},u)))}),Jn=r.forwardRef((t,n)=>{let{open:s,onOpenChange:o,overlayClassName:a,contentClassName:i,container:d,...l}=t;return r.createElement(Ps,{open:s,onOpenChange:o},r.createElement(Rs,{container:d},r.createElement(Fs,{"cmdk-overlay":"",className:a}),r.createElement(Ts,{"aria-label":t.label,"cmdk-dialog":"",className:i},r.createElement(os,{ref:n,...l}))))}),Xn=r.forwardRef((t,n)=>ue(s=>s.filtered.count===0)?r.createElement(re.div,{ref:n,...t,"cmdk-empty":"",role:"presentation"}):null),Zn=r.forwardRef((t,n)=>{let{progress:s,children:o,label:a="Loading...",...i}=t;return r.createElement(re.div,{ref:n,...i,"cmdk-loading":"",role:"progressbar","aria-valuenow":s,"aria-valuemin":0,"aria-valuemax":100,"aria-label":a},Je(t,d=>r.createElement("div",{"aria-hidden":!0},d)))}),Z=Object.assign(os,{List:Yn,Item:Un,Input:Wn,Group:Hn,Separator:Qn,Dialog:Jn,Empty:Xn,Loading:Zn});function er(t,n){let s=t.nextElementSibling;for(;s;){if(s.matches(n))return s;s=s.nextElementSibling}}function tr(t,n){let s=t.previousElementSibling;for(;s;){if(s.matches(n))return s;s=s.previousElementSibling}}function is(t){let n=r.useRef(t);return xe(()=>{n.current=t}),n}var xe=typeof window>"u"?r.useEffect:r.useLayoutEffect;function ve(t){let n=r.useRef();return n.current===void 0&&(n.current=t()),n}function ue(t){let n=ht(),s=()=>t(n.snapshot());return r.useSyncExternalStore(n.subscribe,s,s)}function ls(t,n,s,o=[]){let a=r.useRef(),i=Be();return xe(()=>{var d;let l=(()=>{var u;for(let m of s){if(typeof m=="string")return m.trim();if(typeof m=="object"&&"current"in m)return m.current?(u=m.current.textContent)==null?void 0:u.trim():a.current}})(),x=o.map(u=>u.trim());i.value(t,l,x),(d=n.current)==null||d.setAttribute(fe,l),a.current=l}),a}var sr=()=>{let[t,n]=r.useState(),s=ve(()=>new Map);return xe(()=>{s.current.forEach(o=>o()),s.current=new Map},[t]),(o,a)=>{s.current.set(o,a),n({})}};function nr(t){let n=t.type;return typeof n=="function"?n(t.props):"render"in n?n.render(t.props):t}function Je({asChild:t,children:n},s){return t&&r.isValidElement(n)?r.cloneElement(nr(n),{ref:n.ref},s(n.props.children)):s(n)}var rr={position:"absolute",width:"1px",height:"1px",padding:"0",margin:"-1px",overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",borderWidth:"0"};const cs=r.forwardRef(({className:t,...n},s)=>e.jsx(Z,{ref:s,className:te("flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground",t),...n}));cs.displayName=Z.displayName;const ds=r.forwardRef(({className:t,...n},s)=>e.jsxs("div",{className:"flex items-center border-b px-3","cmdk-input-wrapper":"",children:[e.jsx(Os,{className:"mr-2 h-4 w-4 shrink-0 opacity-50"}),e.jsx(Z.Input,{ref:s,className:te("flex h-10 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50",t),...n})]}));ds.displayName=Z.Input.displayName;const us=r.forwardRef(({className:t,...n},s)=>e.jsx(Z.List,{ref:s,className:te("max-h-[300px] overflow-y-auto overflow-x-hidden",t),...n}));us.displayName=Z.List.displayName;const ms=r.forwardRef((t,n)=>e.jsx(Z.Empty,{ref:n,className:"py-6 text-center text-sm",...t}));ms.displayName=Z.Empty.displayName;const lt=r.forwardRef(({className:t,...n},s)=>e.jsx(Z.Group,{ref:s,className:te("overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground",t),...n}));lt.displayName=Z.Group.displayName;const ar=r.forwardRef(({className:t,...n},s)=>e.jsx(Z.Separator,{ref:s,className:te("-mx-1 h-px bg-border",t),...n}));ar.displayName=Z.Separator.displayName;const ct=r.forwardRef(({className:t,...n},s)=>e.jsx(Z.Item,{ref:s,className:te("relative flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected=true]:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",t),...n}));ct.displayName=Z.Item.displayName;const or=({onBack:t,athletes:n,groups:s,athletesLoading:o})=>{const{toast:a}=ne(),[i,d]=r.useState(""),[l,x]=r.useState(new Set),[u,m]=r.useState(new Set),[p,v]=r.useState(!1),{data:h}=U({queryKey:["athlete-phones"],queryFn:async()=>{const{data:b}=await Et.from("user_profiles").select("user_id, phone").not("phone","is",null);return new Map((b??[]).map(R=>[R.user_id,R.phone]))}}),c=r.useMemo(()=>n.filter(b=>b.id!=null).map(b=>({id:b.id,display_name:b.display_name,group_id:b.group_id??null,group_label:b.group_label??null})),[n]),f=b=>{x(R=>{const O=new Set(R);return O.has(b)?O.delete(b):O.add(b),O})},_=b=>{m(R=>{const O=new Set(R);return O.has(b)?O.delete(b):O.add(b),O})},y=()=>{x(new Set),m(new Set)},{selectedPhones:S,selectedTotal:V,missingCount:z}=r.useMemo(()=>{if(!h)return{selectedPhones:[],selectedTotal:0,missingCount:0};const b=new Set;for(const B of l)for(const F of c)F.group_id===B&&b.add(F.id);for(const B of u)b.add(B);const R=b.size,O=[];for(const B of b){const F=h.get(B);F&&F.trim().length>0&&O.push(F)}return{selectedPhones:O,selectedTotal:R,missingCount:R-O.length}},[l,u,c,h]),P=l.size+u.size,k=r.useMemo(()=>{const b=[];return l.size>0&&b.push(`${l.size} groupe${l.size>1?"s":""}`),u.size>0&&b.push(`${u.size} nageur${u.size>1?"s":""}`),b.join(", ")},[l.size,u.size]),E=()=>{if(S.length===0){a({title:"Aucun numéro",description:"Aucun nageur avec un numéro de téléphone dans cette sélection.",variant:"destructive"});return}if(/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)){const R=i.trim()?encodeURIComponent(i.trim()):"",O=/iPhone|iPad|iPod/i.test(navigator.userAgent);let B;if(O){const F=S.join(",");B=R?`sms:/open?addresses=${F}&body=${R}`:`sms:/open?addresses=${F}`}else B=R?`sms:${S.join(",")}?body=${R}`:`sms:${S.join(",")}`;window.location.href=B}else navigator.clipboard.writeText(S.join(", ")).then(()=>{a({title:"Numéros copiés",description:`${S.length} numéro${S.length>1?"s":""} copié${S.length>1?"s":""} dans le presse-papiers.`})}).catch(()=>{a({title:"Erreur",description:"Impossible de copier les numéros.",variant:"destructive"})})},D=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent);return e.jsxs("div",{className:"space-y-6 pb-24",children:[e.jsx(ce,{title:"Envoyer un SMS",description:"Ouvre votre application SMS ou copie les numéros.",onBack:t}),e.jsxs(Se,{className:"border-l-4 border-l-primary",children:[e.jsxs(ke,{children:[e.jsx(_e,{children:"Destinataires"}),e.jsx(Me,{children:"Sélectionnez des groupes et/ou des nageurs."})]}),e.jsxs(Ae,{className:"space-y-3",children:[e.jsx(H,{children:"Destinataires"}),e.jsxs(Rn,{open:p,onOpenChange:v,children:[e.jsx(Fn,{asChild:!0,children:e.jsxs(L,{variant:"outline",role:"combobox","aria-expanded":p,className:"w-full justify-between font-normal",children:[e.jsx("span",{className:"truncate",children:P>0?k:o?"Chargement...":"Choisir des destinataires"}),e.jsx(Zs,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),e.jsx(es,{className:"w-[var(--radix-popover-trigger-width)] p-0",align:"start",children:e.jsxs(cs,{children:[e.jsx(ds,{placeholder:"Rechercher..."}),e.jsxs(us,{children:[e.jsx(ms,{children:"Aucun résultat."}),s.length>0&&e.jsx(lt,{heading:"Groupes",children:s.map(b=>e.jsxs(ct,{value:`groupe ${b.name}`,onSelect:()=>f(b.id),children:[e.jsx(jt,{className:te("mr-2 h-4 w-4",l.has(b.id)?"opacity-100":"opacity-0")}),b.name]},`group:${b.id}`))}),c.length>0&&e.jsx(lt,{heading:"Nageurs",children:c.map(b=>e.jsxs(ct,{value:`nageur ${b.display_name} ${b.group_label??""}`,onSelect:()=>_(b.id),children:[e.jsx(jt,{className:te("mr-2 h-4 w-4",u.has(b.id)?"opacity-100":"opacity-0")}),e.jsx("span",{className:"truncate",children:b.display_name}),b.group_label&&e.jsx("span",{className:"ml-auto text-xs text-muted-foreground",children:b.group_label})]},`user:${b.id}`))})]})]})})]}),P>0&&e.jsxs("div",{className:"flex flex-wrap items-center gap-1.5",children:[[...l].map(b=>{const R=s.find(O=>O.id===b);return R?e.jsxs(se,{variant:"secondary",className:"gap-1 pr-1",children:[R.name,e.jsx("button",{type:"button",onClick:()=>f(b),className:"ml-0.5 rounded-full p-0.5 hover:bg-muted",children:e.jsx(xt,{className:"h-3 w-3"})})]},`g:${b}`):null}),[...u].map(b=>{const R=c.find(O=>O.id===b);return R?e.jsxs(se,{variant:"outline",className:"gap-1 pr-1",children:[R.display_name,e.jsx("button",{type:"button",onClick:()=>_(b),className:"ml-0.5 rounded-full p-0.5 hover:bg-muted",children:e.jsx(xt,{className:"h-3 w-3"})})]},`u:${b}`):null}),P>1&&e.jsx("button",{type:"button",onClick:y,className:"text-xs text-muted-foreground underline hover:text-foreground",children:"Tout effacer"})]}),P>0&&S.length>0&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:[S.length," numéro",S.length>1?"s":""," trouvé",S.length>1?"s":"",z>0&&e.jsxs("span",{className:"text-destructive",children:[" · ",z," sans téléphone"]})]}),P>0&&S.length===0&&e.jsx("p",{className:"text-xs text-destructive",children:"Aucun numéro de téléphone disponible pour cette sélection."})]})]}),e.jsxs(Se,{children:[e.jsxs(ke,{children:[e.jsx(_e,{children:"Message"}),e.jsx(Me,{children:"Optionnel — pré-rempli dans votre application SMS."})]}),e.jsx(Ae,{children:e.jsx(ut,{value:i,onChange:b=>d(b.target.value),placeholder:"Contenu du SMS…",rows:3})})]}),e.jsx("div",{className:"sticky bottom-0 z-10 -mx-4 border-t bg-background/95 p-4 backdrop-blur sm:static sm:mx-0 sm:border-0 sm:p-0",children:e.jsx(L,{className:"w-full sm:w-auto",onClick:E,disabled:P===0||S.length===0,children:D?e.jsxs(e.Fragment,{children:[e.jsx(Tt,{className:"mr-2 h-4 w-4"}),"Ouvrir dans l'app SMS",e.jsx(zt,{className:"ml-2 h-3 w-3"})]}):e.jsxs(e.Fragment,{children:[e.jsx($s,{className:"mr-2 h-4 w-4"}),"Copier les numéros"]})})})]})};function wt(t){return String(t).padStart(2,"0")}function ge(t){return`${t.getFullYear()}-${wt(t.getMonth()+1)}-${wt(t.getDate())}`}function tt(t){return new Date(t.getFullYear(),t.getMonth(),1)}function Ct(t,n){const s=new Date(t);return s.setDate(s.getDate()+n),s}function ir(t){return(t.getDay()+6)%7}function st(t){if(!t)return"AM";const n=t.toLowerCase();return n==="evening"||n.includes("soir")||n==="pm"?"PM":"AM"}const lr=[{key:"swim-morning",label:"Nage — Matin",type:"swim",scheduledSlot:"morning"},{key:"swim-evening",label:"Nage — Soir",type:"swim",scheduledSlot:"evening"},{key:"strength",label:"Musculation",type:"strength",scheduledSlot:null}];function cr({groupId:t,userId:n,enabled:s}){const o=r.useMemo(()=>new Date,[]),[a,i]=r.useState(()=>tt(new Date)),[d,l]=r.useState(()=>ge(new Date)),[x,u]=r.useState(null),[m,p]=r.useState(!1),v=r.useMemo(()=>tt(a),[a]),h=r.useMemo(()=>{const j=ir(v),T=Ct(v,-j),I=[];for(let K=0;K<42;K++)I.push(Ct(T,K));return I},[v]),c=r.useMemo(()=>{const j=ge(h[0]),T=ge(h[h.length-1]);return{from:j,to:T}},[h]),f=!!(t||n),{data:_=[],isLoading:y}=U({queryKey:["coach-calendar-assignments",t,n,c.from,c.to],queryFn:()=>$.getCoachAssignments({groupId:t??null,userId:n??null,from:c.from,to:c.to}),enabled:f}),S=r.useMemo(()=>{const j=new Map;for(const T of _){const I=T.scheduledDate?.slice(0,10);I&&(j.has(I)||j.set(I,[]),j.get(I).push(T))}return j},[_]),V=r.useMemo(()=>{const j={};for(const T of h){const I=ge(T),K=S.get(I)??[],ee=K.some(M=>st(M.scheduledSlot)==="AM"),A=K.some(M=>st(M.scheduledSlot)==="PM"),Q=(ee?1:0)+(A?1:0),g=[{slotKey:"AM",expected:ee,completed:ee,absent:!1},{slotKey:"PM",expected:A,completed:A,absent:!1}];j[I]={completed:Q,total:Q,slots:g}}return j},[h,S]),z=r.useMemo(()=>{const[j,T,I]=d.split("-").map(Number);return new Date(j,T-1,I)},[d]),P=r.useMemo(()=>S.get(d)??[],[S,d]),k=r.useMemo(()=>{const j=P;return lr.map(T=>{const I=j.filter(A=>T.type!==A.type?!1:T.type==="swim"?st(A.scheduledSlot)===(T.scheduledSlot==="morning"?"AM":"PM"):!0),K=I.find(A=>A.targetType==="user"),ee=I.find(A=>A.targetType==="group");return{...T,assignment:K??ee??null}})},[P]),{data:E=[]}=U({queryKey:["planned-absences-coach",n,c.from,c.to],queryFn:()=>$.getPlannedAbsences({userId:n,from:c.from,to:c.to}),enabled:!!n}),D=r.useMemo(()=>new Set(E.map(j=>j.date)),[E]),b=r.useMemo(()=>{const j={};for(const T of h){const I=ge(T),K=S.get(I)??[];j[I]=K.some(ee=>ee.type==="strength")}return j},[h,S]),R=V[d]??{completed:0,total:0,slots:[{slotKey:"AM",expected:!1,completed:!1,absent:!1},{slotKey:"PM",expected:!1,completed:!1,absent:!1}]},O=r.useCallback(()=>{i(j=>new Date(j.getFullYear(),j.getMonth()-1,1))},[]),B=r.useCallback(()=>{i(j=>new Date(j.getFullYear(),j.getMonth()+1,1))},[]),F=r.useCallback(()=>{i(tt(new Date)),l(ge(new Date))},[]),C=r.useCallback(j=>{l(j),p(!0)},[]);return{today:o,monthCursor:a,selectedISO:d,selectedDayIndex:x,drawerOpen:m,gridDates:h,completionByISO:V,selectedDate:z,selectedDayStatus:R,assignmentsForSelectedDay:P,slotsForSelectedDay:k,hasStrengthByISO:b,absenceDates:D,isLoading:y,hasFilter:f,setSelectedISO:l,setSelectedDayIndex:u,setDrawerOpen:p,prevMonth:O,nextMonth:B,jumpToday:F,openDay:C}}function dr(t){const[n,s,o]=t.split("-").map(Number);return new Date(n,s-1,o).toLocaleDateString("fr-FR",{weekday:"long",day:"numeric",month:"long"})}function ur({onBack:t,athletes:n,groups:s,swimSessions:o,strengthSessions:a}){const[i,d]=r.useState("group"),[l,x]=r.useState(""),[u,m]=r.useState(""),p=i==="group"&&l?Number(l):null,v=i==="user"&&u?Number(u):null,{today:h,monthCursor:c,selectedISO:f,selectedDayIndex:_,drawerOpen:y,gridDates:S,completionByISO:V,selectedDayStatus:z,slotsForSelectedDay:P,hasStrengthByISO:k,absenceDates:E,hasFilter:D,setSelectedISO:b,setSelectedDayIndex:R,setDrawerOpen:O,prevMonth:B,nextMonth:F,jumpToday:C,openDay:j}=cr({groupId:p,userId:v,enabled:!0}),T=qe(),I=X({mutationFn:A=>$.assignments_create(A),onSuccess:()=>{T.invalidateQueries({queryKey:["coach-calendar-assignments"]})}}),K=X({mutationFn:A=>$.assignments_delete(A),onSuccess:()=>{T.invalidateQueries({queryKey:["coach-calendar-assignments"]})}}),ee=(A,Q)=>{let g=Q;if(A.key==="ArrowLeft"&&(g=Math.max(0,Q-1)),A.key==="ArrowRight"&&(g=Math.min(S.length-1,Q+1)),A.key==="ArrowUp"&&(g=Math.max(0,Q-7)),A.key==="ArrowDown"&&(g=Math.min(S.length-1,Q+7)),g!==Q){A.preventDefault(),R(g);const M=q=>String(q).padStart(2,"0"),N=S[g],w=`${N.getFullYear()}-${M(N.getMonth()+1)}-${M(N.getDate())}`;b(w)}if(A.key==="Enter"||A.key===" "){A.preventDefault();const M=q=>String(q).padStart(2,"0"),N=S[Q],w=`${N.getFullYear()}-${M(N.getMonth()+1)}-${M(N.getDate())}`;j(w)}};return e.jsxs("div",{className:"space-y-4",children:[e.jsx(ce,{title:"Calendrier",description:"Vue mensuelle des assignations",onBack:t}),e.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center",children:[e.jsxs(dt,{type:"single",value:i,onValueChange:A=>{(A==="group"||A==="user")&&d(A)},className:"shrink-0",children:[e.jsx(de,{value:"group",className:"text-xs px-3",children:"Groupe"}),e.jsx(de,{value:"user",className:"text-xs px-3",children:"Nageur"})]}),i==="group"?e.jsxs(ae,{value:l,onValueChange:x,children:[e.jsx(oe,{className:"w-full sm:w-56",children:e.jsx(ie,{placeholder:"Choisir un groupe"})}),e.jsx(le,{children:s.map(A=>e.jsx(J,{value:String(A.id),children:A.name},String(A.id)))})]}):e.jsxs(ae,{value:u,onValueChange:m,children:[e.jsx(oe,{className:"w-full sm:w-56",children:e.jsx(ie,{placeholder:"Choisir un nageur"})}),e.jsx(le,{children:n.filter(A=>A.id!=null).map(A=>e.jsxs(J,{value:String(A.id),children:[A.display_name,A.group_label?` · ${A.group_label}`:""]},String(A.id)))})]})]}),D?e.jsxs("div",{className:"rounded-2xl border bg-card shadow-sm",children:[e.jsx(Is,{monthCursor:c,selectedDayStatus:z,onPrevMonth:B,onNextMonth:F,onJumpToday:C}),e.jsx(qs,{monthCursor:c,gridDates:S,completionByISO:V,strengthByISO:k,absenceDates:E,selectedISO:f,selectedDayIndex:_,today:h,onDayClick:j,onKeyDown:ee})]}):e.jsx("div",{className:"py-12 text-center text-sm text-muted-foreground",children:"Sélectionnez un groupe ou un nageur pour afficher le calendrier."}),e.jsx(ze,{open:y,onOpenChange:O,children:e.jsxs(Le,{side:"bottom",className:"max-h-[70vh] overflow-y-auto rounded-t-2xl",children:[e.jsxs(Ke,{className:"pb-3",children:[e.jsx(Ge,{className:"capitalize text-left",children:dr(f)}),e.jsx(mt,{className:"sr-only",children:"Gérer les assignations pour cette journée"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(Ls,{variant:"red",icon:e.jsx(Ks,{}),label:"Absence prévue",visible:E.has(f),animate:!1}),P.map(A=>{const Q=A.assignment?.targetType==="group",g=i==="user";return e.jsx(mr,{slot:A,swimSessions:o,strengthSessions:a,isGroupAssignment:Q&&g,onAssign:M=>{I.mutate({assignment_type:A.type,session_id:M,scheduled_date:f,scheduled_slot:A.scheduledSlot??void 0,target_group_id:p,target_user_id:v})},onDelete:M=>{K.mutate(M)},onReplace:(M,N)=>{Q&&g?I.mutate({assignment_type:A.type,session_id:N,scheduled_date:f,scheduled_slot:A.scheduledSlot??void 0,target_user_id:v}):K.mutate(M,{onSuccess:()=>{I.mutate({assignment_type:A.type,session_id:N,scheduled_date:f,scheduled_slot:A.scheduledSlot??void 0,target_group_id:p,target_user_id:v})}})},isPending:I.isPending||K.isPending},A.key)})]})]})})]})}function mr({slot:t,swimSessions:n,strengthSessions:s,isGroupAssignment:o,onAssign:a,onDelete:i,onReplace:d,isPending:l}){const[x,u]=r.useState(!1),m=t.type==="swim",p=m?(n??[]).map(c=>({id:c.id,label:c.name})):(s??[]).map(c=>({id:c.id,label:c.title})),v=t.assignment!==null,h=c=>{const f=Number(c);f&&(v&&x?(d(t.assignment.id,f),u(!1)):a(f))};return e.jsxs("div",{className:"rounded-xl border p-3 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[m?e.jsx(Pt,{className:"h-4 w-4 text-blue-500 shrink-0"}):e.jsx(Rt,{className:"h-4 w-4 text-orange-500 shrink-0"}),e.jsx("span",{className:"text-xs font-semibold text-muted-foreground uppercase tracking-wide",children:t.label})]}),v&&!x?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("p",{className:"text-sm font-semibold truncate flex-1",children:[t.assignment.title,o&&e.jsx("span",{className:"ml-1.5 text-[10px] font-medium text-muted-foreground bg-muted px-1.5 py-0.5 rounded-full align-middle",children:"Groupe"})]}),e.jsx(L,{type:"button",size:"icon",variant:"ghost",className:"h-7 w-7 shrink-0",disabled:l,onClick:()=>u(!0),title:o?"Personnaliser":"Changer",children:e.jsx(Ns,{className:"h-3.5 w-3.5"})}),!o&&e.jsx(L,{type:"button",size:"icon",variant:"ghost",className:"h-7 w-7 shrink-0 text-destructive hover:text-destructive",disabled:l,onClick:()=>i(t.assignment.id),title:"Supprimer",children:e.jsx(It,{className:"h-3.5 w-3.5"})})]}):e.jsxs(ae,{value:"",onValueChange:h,disabled:l||p.length===0,children:[e.jsx(oe,{className:"h-9 text-xs",children:e.jsx(ie,{placeholder:x?o?"Personnaliser pour ce nageur":"Choisir le remplacement":"Choisir une séance"})}),e.jsx(le,{children:p.map(c=>e.jsx(J,{value:String(c.id),children:c.label},c.id))})]}),x?e.jsx("button",{type:"button",className:"text-xs text-muted-foreground hover:text-foreground",onClick:()=>u(!1),children:"Annuler"}):null]})}const ps=({athletes:t,selected:n,onToggle:s,filterToUserIds:o})=>{const[a,i]=r.useState(""),d=r.useMemo(()=>{let x=t.filter(u=>u.id!=null);if(o&&(x=x.filter(u=>o.has(u.id))),a.trim()){const u=a.toLowerCase();x=x.filter(m=>m.display_name.toLowerCase().includes(u))}return x},[t,o,a]),l=r.useMemo(()=>{const x=new Map;for(const u of d){const m=u.group_label||"Sans groupe";x.has(m)||x.set(m,[]),x.get(m).push(u)}return[...x.entries()].sort(([u],[m])=>u.localeCompare(m,"fr"))},[d]);return e.jsxs("div",{className:"space-y-3",children:[e.jsx(je,{placeholder:"Rechercher un nageur...",value:a,onChange:x=>i(x.target.value)}),e.jsxs("div",{className:"max-h-[50vh] overflow-y-auto space-y-3",children:[l.map(([x,u])=>e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-semibold uppercase tracking-wider text-muted-foreground mb-1.5",children:x}),e.jsx("div",{className:"space-y-1",children:u.map(m=>e.jsxs("label",{className:"flex items-center gap-2.5 rounded-lg border px-3 py-2 cursor-pointer hover:bg-muted/50 transition-colors",children:[e.jsx(qt,{checked:n.has(m.id),onCheckedChange:()=>s(m.id)}),e.jsx("span",{className:"text-sm",children:m.display_name})]},m.id))})]},x)),l.length===0&&e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"Aucun nageur trouvé."})]}),n.size>0&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:[n.size," nageur",n.size>1?"s":""," ","sélectionné",n.size>1?"s":""]})]})},hs=({open:t,onOpenChange:n,athletes:s,parentGroupId:o,parentMembers:a,onCreated:i})=>{const{toast:d}=ne(),[l,x]=r.useState(""),[u,m]=r.useState(new Set),p=c=>{m(f=>{const _=new Set(f);return _.has(c)?_.delete(c):_.add(c),_})},v=X({mutationFn:()=>$.createTemporaryGroup({name:l.trim(),member_user_ids:[...u],parent_group_id:o??void 0}),onSuccess:()=>{d({title:"Groupe créé",description:`Le groupe "${l.trim()}" a été créé avec ${u.size} nageur${u.size>1?"s":""}.`}),x(""),m(new Set),n(!1),i()},onError:c=>{d({title:"Erreur",description:c.message,variant:"destructive"})}}),h=()=>{if(!l.trim()){d({title:"Nom requis",description:"Veuillez saisir un nom pour le groupe.",variant:"destructive"});return}v.mutate()};return e.jsx(ze,{open:t,onOpenChange:n,children:e.jsxs(Le,{side:"right",className:"w-full sm:max-w-md overflow-y-auto",children:[e.jsxs(Ke,{children:[e.jsx(Ge,{children:o?"Créer un sous-groupe":"Créer un groupe"}),e.jsx(mt,{children:o?"Sélectionnez des nageurs du groupe parent pour ce sous-groupe.":"Créez un groupe temporaire (stage, compétition) avec des nageurs de différents groupes."})]}),e.jsxs("div",{className:"mt-6 space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(H,{htmlFor:"group-name",children:"Nom du groupe"}),e.jsx(je,{id:"group-name",placeholder:"Ex : Stage Pâques 2026",value:l,onChange:c=>x(c.target.value)})]}),e.jsx(Gs,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(H,{children:"Nageurs"}),e.jsx(ps,{athletes:s,selected:u,onToggle:p,filterToUserIds:a??null})]}),e.jsx(L,{className:"w-full",onClick:h,disabled:v.isPending||!l.trim(),children:v.isPending?"Création...":"Créer le groupe"})]})]})})},pr=({open:t,onOpenChange:n,groupId:s,athletes:o,existingMemberIds:a,onAdded:i})=>{const{toast:d}=ne(),[l,x]=r.useState(new Set),u=r.useMemo(()=>o.filter(v=>v.id!=null&&!a.has(v.id)),[o,a]),m=v=>{x(h=>{const c=new Set(h);return c.has(v)?c.delete(v):c.add(v),c})},p=X({mutationFn:()=>$.addTemporaryGroupMembers(s,[...l]),onSuccess:()=>{d({title:"Nageurs ajoutés",description:`${l.size} nageur${l.size>1?"s":""} ajouté${l.size>1?"s":""}.`}),x(new Set),n(!1),i()},onError:v=>{d({title:"Erreur",description:v.message,variant:"destructive"})}});return e.jsx(ze,{open:t,onOpenChange:n,children:e.jsxs(Le,{side:"right",className:"w-full sm:max-w-md overflow-y-auto",children:[e.jsxs(Ke,{children:[e.jsx(Ge,{children:"Ajouter des nageurs"}),e.jsx(mt,{children:"Sélectionnez les nageurs à ajouter au groupe."})]}),e.jsxs("div",{className:"mt-6 space-y-4",children:[e.jsx(ps,{athletes:u,selected:l,onToggle:m}),e.jsx(L,{className:"w-full",onClick:()=>p.mutate(),disabled:p.isPending||l.size===0,children:p.isPending?"Ajout...":`Ajouter ${l.size} nageur${l.size>1?"s":""}`})]})]})})},hr=({groupId:t,athletes:n,onBack:s})=>{const{toast:o}=ne(),a=qe(),[i,d]=r.useState(!1),[l,x]=r.useState(!1),[u,m]=r.useState(null),{data:p,isLoading:v}=U({queryKey:["temp-group-detail",t],queryFn:()=>$.getTemporaryGroupDetail(t)}),h=X({mutationFn:y=>$.removeTemporaryGroupMember(t,y),onSuccess:()=>{o({title:"Nageur retiré"}),a.invalidateQueries({queryKey:["temp-group-detail",t]}),a.invalidateQueries({queryKey:["temp-groups"]})},onError:y=>{o({title:"Erreur",description:y.message,variant:"destructive"})}}),c=()=>{a.invalidateQueries({queryKey:["temp-group-detail",t]}),a.invalidateQueries({queryKey:["temp-groups"]})},f=r.useMemo(()=>new Set((p?.members??[]).map(y=>y.user_id)),[p]),_=r.useMemo(()=>new Set((p?.members??[]).map(y=>y.user_id)),[p]);return v?e.jsxs("div",{className:"space-y-4",children:[e.jsxs(L,{variant:"ghost",size:"sm",className:"-ml-2",onClick:s,children:[e.jsx(We,{className:"mr-2 h-4 w-4"}),"Retour aux groupes"]}),e.jsx("div",{className:"space-y-2",children:[1,2,3].map(y=>e.jsx("div",{className:"rounded-xl border p-3 animate-pulse motion-reduce:animate-none",children:e.jsx("div",{className:"h-4 w-32 rounded bg-muted"})},y))})]}):p?e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs(L,{variant:"ghost",size:"sm",className:"-ml-2",onClick:s,children:[e.jsx(We,{className:"mr-2 h-4 w-4"}),"Retour aux groupes"]}),e.jsx("h2",{className:"text-2xl font-display font-semibold uppercase italic text-primary",children:p.name}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(se,{variant:p.is_active?"default":"secondary",children:p.is_active?"Actif":"Terminé"}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:[p.members.length," membre",p.members.length!==1?"s":""]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-xs font-semibold uppercase tracking-[0.15em] text-muted-foreground",children:"Membres"}),p.is_active&&e.jsxs(L,{size:"sm",variant:"outline",onClick:()=>d(!0),children:[e.jsx(Hs,{className:"mr-1.5 h-3.5 w-3.5"}),"Ajouter"]})]}),p.members.length===0?e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"Aucun membre dans ce groupe."}):e.jsx("div",{className:"space-y-1.5",children:p.members.map(y=>e.jsxs("div",{className:"flex items-center gap-3 rounded-xl border bg-card p-3",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-sm font-semibold truncate",children:y.display_name}),y.permanent_group_label&&e.jsx(se,{variant:"secondary",className:"text-[10px] px-1.5 py-0 mt-0.5",children:y.permanent_group_label})]}),p.is_active&&e.jsx(L,{size:"icon",variant:"ghost",className:"h-8 w-8 text-muted-foreground hover:text-destructive",onClick:()=>m({userId:y.user_id,name:y.display_name}),title:"Retirer du groupe",children:e.jsx(Qs,{className:"h-4 w-4"})})]},y.user_id))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-xs font-semibold uppercase tracking-[0.15em] text-muted-foreground",children:"Sous-groupes"}),p.is_active&&e.jsxs(L,{size:"sm",variant:"outline",onClick:()=>x(!0),children:[e.jsx(he,{className:"mr-1.5 h-3.5 w-3.5"}),"Sous-groupe"]})]}),p.subgroups.length===0?e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"Aucun sous-groupe."}):e.jsx("div",{className:"space-y-2",children:p.subgroups.map(y=>e.jsxs(Vs,{children:[e.jsxs(Bs,{className:"flex w-full items-center justify-between rounded-xl border bg-card p-3 text-left hover:bg-muted/50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Kt,{className:"h-4 w-4 text-primary"}),e.jsx("span",{className:"text-sm font-semibold",children:y.name}),e.jsx(se,{variant:"secondary",className:"text-[10px] px-1.5 py-0",children:y.members.length})]}),e.jsx(Ws,{className:"h-4 w-4 text-muted-foreground transition-transform [[data-state=open]_&]:rotate-180"})]}),e.jsx(Us,{children:e.jsxs("div",{className:"ml-4 mt-1 space-y-1",children:[y.members.map(S=>e.jsx("div",{className:"flex items-center gap-2 rounded-lg border px-3 py-2",children:e.jsx("span",{className:"text-sm",children:S.display_name})},S.user_id)),y.members.length===0&&e.jsx("p",{className:"text-xs text-muted-foreground py-2",children:"Aucun membre."})]})})]},y.id))})]}),e.jsx(pr,{open:i,onOpenChange:d,groupId:t,athletes:n,existingMemberIds:f,onAdded:c}),e.jsx(hs,{open:l,onOpenChange:x,athletes:n,parentGroupId:t,parentMembers:_,onCreated:c}),e.jsx(Ee,{open:!!u,onOpenChange:y=>{y||m(null)},children:e.jsxs(Pe,{children:[e.jsxs(Re,{children:[e.jsx(Fe,{children:"Retirer du groupe"}),e.jsxs(Te,{children:["Voulez-vous retirer ",u?.name," de ce groupe ?",p.subgroups.length>0?" Le nageur sera aussi retiré des sous-groupes.":""]})]}),e.jsxs(Oe,{children:[e.jsx($e,{children:"Annuler"}),e.jsx(Ie,{onClick:()=>{u&&(h.mutate(u.userId),m(null))},className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Retirer"})]})]})})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs(L,{variant:"ghost",size:"sm",className:"-ml-2",onClick:s,children:[e.jsx(We,{className:"mr-2 h-4 w-4"}),"Retour aux groupes"]}),e.jsx("p",{className:"text-sm text-muted-foreground text-center py-8",children:"Groupe introuvable."})]})},St=({group:t,onManage:n,onDeactivate:s,onReactivate:o,onDelete:a})=>{const i=new Date(t.created_at).toLocaleDateString("fr-FR",{day:"numeric",month:"short",year:"numeric"});return e.jsxs("div",{className:"rounded-xl border bg-card p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-sm font-bold truncate",children:t.name}),e.jsxs("div",{className:"flex items-center gap-2 mt-1 flex-wrap",children:[e.jsxs("span",{className:"text-xs text-muted-foreground",children:[t.member_count," membre",t.member_count!==1?"s":""]}),t.subgroup_count>0&&e.jsxs("span",{className:"text-xs text-muted-foreground",children:[t.subgroup_count," sous-groupe",t.subgroup_count!==1?"s":""]}),e.jsx("span",{className:"text-xs text-muted-foreground",children:i})]})]}),e.jsx(se,{variant:t.is_active?"default":"secondary",children:t.is_active?"Actif":"Terminé"})]}),e.jsx("div",{className:"flex items-center gap-2 flex-wrap",children:t.is_active?e.jsxs(e.Fragment,{children:[e.jsxs(L,{size:"sm",variant:"outline",onClick:()=>n(t.id),children:[e.jsx(ws,{className:"mr-1.5 h-3.5 w-3.5"}),"Gérer"]}),e.jsxs(L,{size:"sm",variant:"outline",onClick:()=>s(t.id),children:[e.jsx(zs,{className:"mr-1.5 h-3.5 w-3.5"}),"Terminer"]})]}):e.jsxs(e.Fragment,{children:[e.jsxs(L,{size:"sm",variant:"outline",onClick:()=>o(t.id),children:[e.jsx(Cs,{className:"mr-1.5 h-3.5 w-3.5"}),"Réactiver"]}),e.jsxs(L,{size:"sm",variant:"outline",className:"text-destructive hover:text-destructive",onClick:()=>a(t.id),children:[e.jsx(It,{className:"mr-1.5 h-3.5 w-3.5"}),"Supprimer"]})]})})]})},xr=({onBack:t,athletes:n,athletesLoading:s})=>{const{toast:o}=ne(),a=qe(),[i,d]=r.useState("list"),[l,x]=r.useState(null),[u,m]=r.useState(!1),[p,v]=r.useState(null),[h,c]=r.useState(null),{data:f=[],isLoading:_}=U({queryKey:["temp-groups"],queryFn:()=>$.getTemporaryGroups()}),y=r.useMemo(()=>f.filter(D=>D.is_active),[f]),S=r.useMemo(()=>f.filter(D=>!D.is_active),[f]),V=X({mutationFn:D=>$.deactivateTemporaryGroup(D),onSuccess:()=>{o({title:"Groupe terminé"}),a.invalidateQueries({queryKey:["temp-groups"]})},onError:D=>{o({title:"Erreur",description:D.message,variant:"destructive"})}}),z=X({mutationFn:D=>$.reactivateTemporaryGroup(D),onSuccess:()=>{o({title:"Groupe réactivé"}),a.invalidateQueries({queryKey:["temp-groups"]})},onError:D=>{o({title:"Erreur",description:D.message,variant:"destructive"})}}),P=X({mutationFn:D=>$.deleteTemporaryGroup(D),onSuccess:()=>{o({title:"Groupe supprimé"}),a.invalidateQueries({queryKey:["temp-groups"]})},onError:D=>{o({title:"Erreur",description:D.message,variant:"destructive"})}}),k=D=>{x(D),d("detail")},E=()=>{x(null),d("list"),a.invalidateQueries({queryKey:["temp-groups"]})};return i==="detail"&&l!=null?e.jsx(hr,{groupId:l,athletes:n,onBack:E}):e.jsxs("div",{className:"space-y-6 pb-24",children:[e.jsx(ce,{title:"Groupes temporaires",description:"Créez et gérez des groupes pour les stages, compétitions ou événements.",onBack:t,actions:e.jsxs(L,{size:"sm",onClick:()=>m(!0),children:[e.jsx(he,{className:"mr-1.5 h-3.5 w-3.5"}),"Créer un groupe"]})}),_||s?e.jsx("div",{className:"space-y-2",children:[1,2,3].map(D=>e.jsx("div",{className:"rounded-xl border p-4 animate-pulse motion-reduce:animate-none",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-4 w-40 rounded bg-muted"}),e.jsx("div",{className:"ml-auto h-6 w-16 rounded bg-muted"})]})},D))}):f.length===0?e.jsxs("div",{className:"text-center py-12 space-y-3",children:[e.jsx(De,{className:"h-10 w-10 text-muted-foreground mx-auto"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Aucun groupe temporaire pour le moment."}),e.jsxs(L,{variant:"outline",size:"sm",onClick:()=>m(!0),children:[e.jsx(he,{className:"mr-1.5 h-3.5 w-3.5"}),"Créer le premier groupe"]})]}):e.jsxs(e.Fragment,{children:[y.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h3",{className:"text-xs font-semibold uppercase tracking-[0.15em] text-muted-foreground",children:["Actifs (",y.length,")"]}),y.map(D=>e.jsx(St,{group:D,onManage:k,onDeactivate:b=>v(b),onReactivate:b=>z.mutate(b),onDelete:b=>c(b)},D.id))]}),S.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h3",{className:"text-xs font-semibold uppercase tracking-[0.15em] text-muted-foreground",children:["Terminés (",S.length,")"]}),S.map(D=>e.jsx(St,{group:D,onManage:k,onDeactivate:b=>v(b),onReactivate:b=>z.mutate(b),onDelete:b=>c(b)},D.id))]})]}),e.jsx(hs,{open:u,onOpenChange:m,athletes:n,onCreated:()=>{a.invalidateQueries({queryKey:["temp-groups"]})}}),e.jsx(Ee,{open:p!=null,onOpenChange:D=>{D||v(null)},children:e.jsxs(Pe,{children:[e.jsxs(Re,{children:[e.jsx(Fe,{children:"Terminer le groupe"}),e.jsx(Te,{children:"Voulez-vous marquer ce groupe comme terminé ? Les sous-groupes seront aussi désactivés. Vous pourrez le réactiver plus tard si nécessaire."})]}),e.jsxs(Oe,{children:[e.jsx($e,{children:"Annuler"}),e.jsx(Ie,{onClick:()=>{p!=null&&(V.mutate(p),v(null))},children:"Terminer"})]})]})}),e.jsx(Ee,{open:h!=null,onOpenChange:D=>{D||c(null)},children:e.jsxs(Pe,{children:[e.jsxs(Re,{children:[e.jsx(Fe,{children:"Supprimer le groupe"}),e.jsx(Te,{children:"Cette action est irréversible. Le groupe et tous ses sous-groupes seront supprimés définitivement."})]}),e.jsxs(Oe,{children:[e.jsx($e,{children:"Annuler"}),e.jsx(Ie,{onClick:()=>{h!=null&&(P.mutate(h),c(null))},className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Supprimer"})]})]})})]})};function gr(t){const n=new Date;n.setHours(0,0,0,0);const s=new Date(t+"T00:00:00");return Math.ceil((s.getTime()-n.getTime())/(1e3*60*60*24))}function fr(t){return`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")}`}function He(t,n){return Math.max(0,Math.round((new Date(n+"T00:00:00").getTime()-new Date(t+"T00:00:00").getTime())/6048e5))}const vr=7,jr=20,br=72;function Qe(t){return Math.min(br,Math.max(jr,t*vr))}const yr=({open:t,onOpenChange:n,competition:s})=>{const{toast:o}=ne(),a=qe(),i=!!s,[d,l]=r.useState(""),[x,u]=r.useState(""),[m,p]=r.useState(""),[v,h]=r.useState(!0),[c,f]=r.useState(""),[_,y]=r.useState(""),[S,V]=r.useState(!1),[z,P]=r.useState(new Set),{data:k=[]}=U({queryKey:["athletes"],queryFn:()=>$.getAthletes()}),{data:E=[]}=U({queryKey:["groups"],queryFn:()=>$.getGroups()}),{data:D}=U({queryKey:["competition-assignments",s?.id],queryFn:()=>$.getCompetitionAssignments(s.id),enabled:!!s?.id});r.useEffect(()=>{t&&(s?(l(s.name),u(s.date),p(s.end_date??""),h(!!s.end_date),f(s.location??""),y(s.description??""),D&&P(new Set(D.map(C=>C.athlete_id)))):(l(""),u(""),p(""),h(!0),f(""),y(""),P(new Set)))},[t,s,D]);const b=X({mutationFn:C=>$.createCompetition(C),onSuccess:async C=>{if(z.size>0)try{await $.setCompetitionAssignments(C.id,Array.from(z))}catch(j){console.warn("[EAC] Failed to save competition assignments:",j)}o({title:"Competition creee"}),a.invalidateQueries({queryKey:["competitions"]}),a.invalidateQueries({queryKey:["competition-assignments"]}),n(!1)},onError:C=>{o({title:"Erreur",description:C.message,variant:"destructive"})}}),R=X({mutationFn:C=>$.updateCompetition(s.id,C),onSuccess:async()=>{try{await $.setCompetitionAssignments(s.id,Array.from(z))}catch(C){console.warn("[EAC] Failed to save competition assignments:",C)}o({title:"Competition mise a jour"}),a.invalidateQueries({queryKey:["competitions"]}),a.invalidateQueries({queryKey:["competition-assignments"]}),n(!1)},onError:C=>{o({title:"Erreur",description:C.message,variant:"destructive"})}}),O=X({mutationFn:()=>$.deleteCompetition(s.id),onSuccess:()=>{o({title:"Competition supprimee"}),a.invalidateQueries({queryKey:["competitions"]}),n(!1)},onError:C=>{o({title:"Erreur",description:C.message,variant:"destructive"})}}),B=()=>{if(!d.trim()){o({title:"Nom requis",description:"Veuillez saisir un nom pour la competition.",variant:"destructive"});return}if(!x){o({title:"Date requise",description:"Veuillez saisir une date.",variant:"destructive"});return}const C={name:d.trim(),date:x,end_date:v&&m?m:null,location:c.trim()||null,description:_.trim()||null};i?R.mutate(C):b.mutate(C)},F=b.isPending||R.isPending||O.isPending;return e.jsxs(e.Fragment,{children:[e.jsx(ze,{open:t,onOpenChange:n,children:e.jsxs(Le,{side:"right",className:"w-full sm:max-w-md overflow-y-auto",children:[e.jsx(Ke,{children:e.jsx(Ge,{children:i?"Modifier la competition":"Nouvelle competition"})}),e.jsxs("div",{className:"mt-6 space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(H,{htmlFor:"comp-name",children:"Nom *"}),e.jsx(je,{id:"comp-name",placeholder:"Ex : Championnats Regionaux",value:d,onChange:C=>l(C.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(H,{htmlFor:"comp-date",children:"Date *"}),e.jsx("input",{id:"comp-date",type:"date",value:x,onChange:C=>u(C.target.value),className:"flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(H,{htmlFor:"comp-multiday",children:"Multi-jours"}),e.jsx(Ys,{id:"comp-multiday",checked:v,onCheckedChange:h})]}),v&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(H,{htmlFor:"comp-end-date",children:"Date de fin"}),e.jsx("input",{id:"comp-end-date",type:"date",value:m,onChange:C=>p(C.target.value),min:x||void 0,className:"flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(H,{htmlFor:"comp-location",children:"Lieu"}),e.jsx(je,{id:"comp-location",placeholder:"Ex : Piscine de Strasbourg",value:c,onChange:C=>f(C.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(H,{htmlFor:"comp-description",children:"Description"}),e.jsx(ut,{id:"comp-description",placeholder:"Notes, informations complementaires...",value:_,onChange:C=>y(C.target.value),rows:3})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(De,{className:"h-4 w-4 text-muted-foreground"}),e.jsx(H,{children:"Nageurs assignes"})]}),e.jsxs(ae,{value:"",onValueChange:C=>{const j=k.filter(T=>T.group_id===Number(C));P(T=>{const I=new Set(T);return j.forEach(K=>{K.id!=null&&I.add(K.id)}),I})},children:[e.jsx(oe,{children:e.jsx(ie,{placeholder:"Ajouter un groupe..."})}),e.jsx(le,{children:E.filter(C=>!C.is_temporary).map(C=>e.jsx(J,{value:String(C.id),children:C.name},C.id))})]}),e.jsx("div",{className:"max-h-48 overflow-y-auto rounded-md border p-2 space-y-1",children:k.map(C=>{if(C.id==null)return null;const j=z.has(C.id);return e.jsxs("label",{className:"flex items-center gap-2 py-1 px-1 rounded hover:bg-muted/50 cursor-pointer",children:[e.jsx(qt,{checked:j,onCheckedChange:T=>{P(I=>{const K=new Set(I);return T?K.add(C.id):K.delete(C.id),K})}}),e.jsx("span",{className:"text-sm",children:C.display_name}),C.group_label&&e.jsx("span",{className:"text-xs text-muted-foreground ml-auto",children:C.group_label})]},C.id)})}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[z.size," nageur",z.size>1?"s":""," assigne",z.size>1?"s":""]})]}),e.jsxs("div",{className:"space-y-2 pt-2",children:[e.jsx(L,{className:"w-full",onClick:B,disabled:F||!d.trim()||!x,children:F?"Enregistrement...":i?"Enregistrer":"Creer"}),i&&e.jsx(L,{variant:"outline",className:"w-full text-destructive hover:text-destructive",onClick:()=>V(!0),disabled:F,children:"Supprimer cette competition"})]})]})]})}),e.jsx(Ee,{open:S,onOpenChange:V,children:e.jsxs(Pe,{children:[e.jsxs(Re,{children:[e.jsx(Fe,{children:"Supprimer la competition"}),e.jsxs(Te,{children:["Cette action est irreversible. La competition «"," ",s?.name," » sera supprimee definitivement."]})]}),e.jsxs(Oe,{children:[e.jsx($e,{children:"Annuler"}),e.jsx(Ie,{onClick:()=>{O.mutate(),V(!1)},className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Supprimer"})]})]})})]})},Nr=({competitions:t,onEdit:n})=>{const s=r.useMemo(()=>{const o=[...t].sort((m,p)=>m.date.localeCompare(p.date)),a=new Date;a.setHours(0,0,0,0);const i=fr(a),d=[];let l="",x="",u=!1;for(const m of o){const p=m.date<i,v=gr(m.date),h=m.date.slice(0,7),c=h!==x,f=new Date(m.date+"T00:00:00").toLocaleDateString("fr-FR",{month:"short"}).replace(".","").toUpperCase();if(!u&&!p){if(l){const y=He(l,i);y>=1&&d.push({kind:"gap",weeks:y,height:Qe(y)})}d.push({kind:"today"}),u=!0;const _=He(i,m.date);_>=1&&d.push({kind:"gap",weeks:_,height:Qe(_)})}else if(l){const _=He(l,m.date);_>=1&&d.push({kind:"gap",weeks:_,height:Qe(_)})}d.push({kind:"comp",comp:m,isPast:p,days:v,isNewMonth:c,monthLabel:f}),l=m.end_date||m.date,x=h}if(!u){if(l){const m=He(l,i);m>=1&&d.push({kind:"gap",weeks:m,height:Qe(m)})}d.push({kind:"today"})}return d},[t]);return t.length===0?null:e.jsxs("div",{className:"relative pl-14",children:[e.jsx("div",{className:"absolute left-[2.625rem] top-1 bottom-1 w-[2px] rounded-full bg-gradient-to-b from-border/10 via-border/40 to-border/10"}),s.map((o,a)=>{if(o.kind==="gap")return e.jsx("div",{className:"relative",style:{height:o.height},children:o.weeks>=2&&e.jsxs("span",{className:"absolute left-[-0.8rem] -translate-x-1/2 top-1/2 -translate-y-1/2 text-[9px] tabular-nums font-medium text-muted-foreground/30 bg-background px-1 select-none",children:[o.weeks,"s"]})},`g${a}`);if(o.kind==="today")return e.jsxs("div",{className:"relative flex items-center h-7 -ml-14",children:[e.jsx("div",{className:"absolute left-0 right-0 h-[2px] bg-emerald-500/60"}),e.jsx("span",{className:"relative text-[10px] font-bold tracking-widest text-emerald-600 dark:text-emerald-400 bg-background pl-2 pr-1.5 select-none",children:"AUJOURD'HUI"})]},"today");const{comp:i,isPast:d,days:l,isNewMonth:x,monthLabel:u}=o,m=(()=>{const p=new Date(i.date+"T00:00:00");if(!i.end_date||i.end_date===i.date)return p.toLocaleDateString("fr-FR",{day:"numeric",month:"short"}).replace(".","");const v=new Date(i.end_date+"T00:00:00"),h=v.toLocaleDateString("fr-FR",{day:"numeric",month:"short"}).replace(".","");return p.getMonth()===v.getMonth()?`${p.getDate()}–${h}`:`${p.toLocaleDateString("fr-FR",{day:"numeric",month:"short"}).replace(".","")} → ${h}`})();return e.jsxs("button",{type:"button",className:te("relative w-full flex items-start text-left py-1.5 group transition-opacity",d?"opacity-40 hover:opacity-70":"hover:opacity-80"),onClick:()=>n(i),children:[x&&e.jsx("span",{className:"absolute left-[-3.25rem] top-[3px] w-[2rem] text-[10px] font-bold uppercase tracking-widest text-muted-foreground/50 text-right select-none",children:u}),e.jsx("div",{className:te("absolute left-[-0.8rem] top-[5px] h-[10px] w-[10px] rounded-full -translate-x-1/2 z-10 border-2 border-background transition-transform group-hover:scale-150",d?"bg-muted-foreground/30":"bg-amber-500 shadow-[0_0_6px_rgba(245,158,11,0.4)]")}),e.jsxs("div",{className:"min-w-0 flex-1 pl-1",children:[e.jsxs("div",{className:"flex items-center gap-1.5 min-w-0",children:[e.jsx("span",{className:te("text-[13px] font-semibold truncate",d?"text-muted-foreground":"text-foreground"),children:i.name}),!d&&l>=0&&e.jsxs("span",{className:"text-[10px] font-bold tabular-nums shrink-0 text-amber-600 dark:text-amber-400",children:["J-",l]})]}),e.jsxs("p",{className:te("text-[11px] truncate",d?"text-muted-foreground/60":"text-muted-foreground"),children:[m,i.location&&i.location!=="??"&&` · ${i.location}`]})]})]},i.id)})]})},wr=({onBack:t})=>{const[n,s]=r.useState(!1),[o,a]=r.useState(null),{data:i=[],isLoading:d}=U({queryKey:["competitions"],queryFn:()=>$.getCompetitions()}),l=()=>{a(null),s(!0)},x=m=>{a(m),s(!0)},u=i.length===0?"Gerez les competitions du club.":`${i.length} competition${i.length>1?"s":""}`;return e.jsxs("div",{className:"space-y-6 pb-24",children:[e.jsx(ce,{title:"Competitions",description:u,onBack:t,actions:e.jsxs(L,{variant:"outline",size:"sm",onClick:l,children:[e.jsx(he,{className:"mr-1.5 h-3.5 w-3.5"}),"Ajouter"]})}),d?e.jsx("div",{className:"space-y-2",children:[1,2,3].map(m=>e.jsx("div",{className:"rounded-xl border p-3 animate-pulse motion-reduce:animate-none",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-4 w-40 rounded bg-muted"}),e.jsx("div",{className:"ml-auto h-5 w-12 rounded bg-muted"})]})},m))}):i.length===0?e.jsxs("div",{className:"text-center py-12 space-y-3",children:[e.jsx(nt,{className:"h-10 w-10 text-muted-foreground mx-auto"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Aucune competition creee."}),e.jsxs(L,{variant:"outline",size:"sm",onClick:l,children:[e.jsx(he,{className:"mr-1.5 h-3.5 w-3.5"}),"Creer la premiere competition"]})]}):e.jsx(Nr,{competitions:i,onEdit:x}),e.jsx(yr,{open:n,onOpenChange:s,competition:o})]})};async function Cr(t){const{data:n,error:s}=await Et.rpc("get_auth_uid_for_user",{p_user_id:t});return s?(console.error("[objectives] Failed to resolve auth UUID:",s.message),null):n}const Sr=({open:t,onOpenChange:n,objective:s,athleteName:o,athleteAuthId:a,competitions:i})=>{const{toast:d}=ne(),l=qe(),x=!!s,[u,m]=r.useState("chrono"),[p,v]=r.useState(""),[h,c]=r.useState("25"),[f,_]=r.useState(""),[y,S]=r.useState(""),[V,z]=r.useState(""),[P,k]=r.useState(!1);r.useEffect(()=>{if(t)if(s){const j=!!s.event_code,T=!!s.text;m(j&&T?"both":T?"texte":"chrono"),v(s.event_code??""),c(String(s.pool_length??25)),_(s.target_time_seconds!=null?$t(s.target_time_seconds):""),S(s.text??""),z(s.competition_id??"")}else m("chrono"),v(""),c("25"),_(""),S(""),z("")},[t,s]);const E=X({mutationFn:j=>$.createObjective(j),onSuccess:()=>{d({title:"Objectif cree"}),l.invalidateQueries({queryKey:["objectives"]}),n(!1)},onError:j=>{d({title:"Erreur",description:j.message,variant:"destructive"})}}),D=X({mutationFn:j=>$.updateObjective(s.id,j),onSuccess:()=>{d({title:"Objectif mis a jour"}),l.invalidateQueries({queryKey:["objectives"]}),n(!1)},onError:j=>{d({title:"Erreur",description:j.message,variant:"destructive"})}}),b=X({mutationFn:()=>$.deleteObjective(s.id),onSuccess:()=>{d({title:"Objectif supprime"}),l.invalidateQueries({queryKey:["objectives"]}),n(!1)},onError:j=>{d({title:"Erreur",description:j.message,variant:"destructive"})}}),R=u==="chrono"||u==="both",O=u==="texte"||u==="both",B=()=>{if(R&&!p){d({title:"Epreuve requise",description:"Veuillez selectionner une epreuve.",variant:"destructive"});return}if(R&&f&&vt(f)===null){d({title:"Format invalide",description:"Le temps doit être au format m:ss:cc (ex: 1:05:30)",variant:"destructive"});return}if(O&&!y.trim()){d({title:"Texte requis",description:"Veuillez saisir un objectif texte.",variant:"destructive"});return}const j={athlete_id:a,competition_id:V&&V!=="none"?V:null,event_code:R?p:null,pool_length:R?Number(h):null,target_time_seconds:R&&f?vt(f):null,text:O?y.trim():null};x?D.mutate(j):E.mutate(j)},F=E.isPending||D.isPending||b.isPending,C=r.useMemo(()=>{const j=new Date;return j.setHours(0,0,0,0),i.filter(T=>new Date(T.date+"T00:00:00").getTime()>=j.getTime())},[i]);return e.jsxs(e.Fragment,{children:[e.jsx(ze,{open:t,onOpenChange:n,children:e.jsxs(Le,{side:"right",className:"w-full sm:max-w-md overflow-y-auto",children:[e.jsx(Ke,{children:e.jsx(Ge,{children:x?"Modifier l'objectif":"Nouvel objectif"})}),e.jsxs("div",{className:"mt-6 space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(H,{children:"Nageur"}),e.jsx("p",{className:"text-sm font-medium",children:o})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(H,{children:"Type d'objectif"}),e.jsxs(dt,{type:"single",variant:"outline",value:u,onValueChange:j=>{j&&m(j)},className:"justify-start",children:[e.jsx(de,{value:"chrono",className:"text-xs",children:"Chrono"}),e.jsx(de,{value:"texte",className:"text-xs",children:"Texte"}),e.jsx(de,{value:"both",className:"text-xs",children:"Les deux"})]})]}),R&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(H,{children:"Epreuve *"}),e.jsxs(ae,{value:p,onValueChange:v,children:[e.jsx(oe,{children:e.jsx(ie,{placeholder:"Choisir une epreuve"})}),e.jsx(le,{children:_s.map(j=>e.jsx(J,{value:j,children:Ot(j)},j))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(H,{children:"Bassin"}),e.jsxs(ae,{value:h,onValueChange:c,children:[e.jsx(oe,{children:e.jsx(ie,{})}),e.jsxs(le,{children:[e.jsx(J,{value:"25",children:"25m"}),e.jsx(J,{value:"50",children:"50m"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(H,{children:"Temps cible (min:sec:centièmes)"}),e.jsx(je,{placeholder:"Ex : 1:05:30",value:f,onChange:j=>_(j.target.value)})]})]}),O&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(H,{children:"Objectif texte *"}),e.jsx(ut,{placeholder:"Ex : Ameliorer la coulée de dos",value:y,onChange:j=>S(j.target.value),rows:3})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(H,{children:"Lier a une competition"}),e.jsxs(ae,{value:V,onValueChange:z,children:[e.jsx(oe,{children:e.jsx(ie,{placeholder:"Aucune"})}),e.jsxs(le,{children:[e.jsx(J,{value:"none",children:"Aucune"}),C.map(j=>e.jsxs(J,{value:j.id,children:[j.name," (",j.date,")"]},j.id))]})]})]}),e.jsxs("div",{className:"space-y-2 pt-2",children:[e.jsx(L,{className:"w-full",onClick:B,disabled:F,children:F?"Enregistrement...":x?"Enregistrer":"Creer"}),x&&e.jsx(L,{variant:"outline",className:"w-full text-destructive hover:text-destructive",onClick:()=>k(!0),disabled:F,children:"Supprimer cet objectif"})]})]})]})}),e.jsx(Ee,{open:P,onOpenChange:k,children:e.jsxs(Pe,{children:[e.jsxs(Re,{children:[e.jsx(Fe,{children:"Supprimer l'objectif"}),e.jsx(Te,{children:"Cette action est irreversible. L'objectif sera supprime definitivement."})]}),e.jsxs(Oe,{children:[e.jsx($e,{children:"Annuler"}),e.jsx(Ie,{onClick:()=>{b.mutate(),k(!1)},className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Supprimer"})]})]})})]})},kr=({objective:t,onEdit:n})=>{const s=!!t.event_code,o=!!t.text;return e.jsxs("button",{type:"button",className:"w-full text-left rounded-xl border bg-card p-3 space-y-1.5 transition-colors hover:bg-muted/50",onClick:()=>n(t),children:[s&&e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"text-sm font-semibold",children:Ot(t.event_code)}),t.pool_length&&e.jsxs(se,{variant:"secondary",className:"text-[10px] px-1.5 py-0",children:[t.pool_length,"m"]}),t.target_time_seconds!=null&&e.jsx(se,{variant:"outline",className:"text-[10px] px-1.5 py-0 font-mono",children:$t(t.target_time_seconds)})]}),o&&e.jsx("p",{className:"text-sm text-muted-foreground line-clamp-2",children:t.text}),t.competition_name&&e.jsx(se,{variant:"outline",className:"border-orange-300 text-orange-600 dark:text-orange-400 text-[10px] px-1.5 py-0",children:t.competition_name})]})},_r=({onBack:t,athletes:n,athletesLoading:s})=>{const{toast:o}=ne(),[a,i]=r.useState(""),[d,l]=r.useState(!1),[x,u]=r.useState(null),m=r.useMemo(()=>a?n.find(P=>P.id!=null&&String(P.id)===a)??null:null,[n,a]),{data:p,isLoading:v}=U({queryKey:["auth-uid",a],queryFn:()=>Cr(Number(a)),enabled:!!a}),{data:h=[]}=U({queryKey:["competitions"],queryFn:()=>$.getCompetitions()}),{data:c=[],isLoading:f}=U({queryKey:["objectives",p],queryFn:()=>$.getObjectives(p),enabled:!!p}),_=r.useMemo(()=>{const P=n.filter(E=>E.id!=null),k=new Map;for(const E of P){const D=E.group_label||"Sans groupe";k.has(D)||k.set(D,[]),k.get(D).push(E)}return[...k.entries()].sort(([E],[D])=>E.localeCompare(D,"fr"))},[n]),y=()=>{if(!p){o({title:"Nageur requis",description:"Veuillez selectionner un nageur.",variant:"destructive"});return}u(null),l(!0)},S=P=>{u(P),l(!0)},V=s||!!a&&v,z=!!p&&!v;return e.jsxs("div",{className:"space-y-6 pb-24",children:[e.jsx(ce,{title:"Objectifs",description:"Definissez des objectifs chrono ou texte pour chaque nageur.",onBack:t,actions:e.jsxs(L,{variant:"outline",size:"sm",onClick:y,disabled:!p,children:[e.jsx(he,{className:"mr-1.5 h-3.5 w-3.5"}),"Ajouter"]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(H,{children:"Nageur"}),e.jsxs(ae,{value:a,onValueChange:i,children:[e.jsx(oe,{children:e.jsx(ie,{placeholder:"Selectionner un nageur"})}),e.jsx(le,{children:_.map(([P,k])=>e.jsxs("div",{children:[e.jsx("div",{className:"px-2 py-1.5 text-xs font-semibold uppercase tracking-wider text-muted-foreground",children:P}),k.map(E=>e.jsx(J,{value:String(E.id),children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:E.display_name}),E.group_label&&e.jsx(se,{variant:"secondary",className:"text-[10px] px-1.5 py-0",children:E.group_label})]})},E.id))]},P))})]})]}),!a&&e.jsxs("div",{className:"text-center py-12 space-y-3",children:[e.jsx(rt,{className:"h-10 w-10 text-muted-foreground mx-auto"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Selectionnez un nageur pour voir et gerer ses objectifs."})]}),V&&a&&e.jsx("div",{className:"space-y-2",children:[1,2,3].map(P=>e.jsx("div",{className:"rounded-xl border p-3 animate-pulse motion-reduce:animate-none",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-4 w-40 rounded bg-muted"}),e.jsx("div",{className:"ml-auto h-5 w-12 rounded bg-muted"})]})},P))}),z&&f&&e.jsx("div",{className:"space-y-2",children:[1,2].map(P=>e.jsx("div",{className:"rounded-xl border p-3 animate-pulse motion-reduce:animate-none",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-4 w-32 rounded bg-muted"}),e.jsx("div",{className:"ml-auto h-5 w-16 rounded bg-muted"})]})},P))}),z&&!f&&c.length===0&&e.jsxs("div",{className:"text-center py-12 space-y-3",children:[e.jsx(rt,{className:"h-10 w-10 text-muted-foreground mx-auto"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Aucun objectif defini pour ",m?.display_name,"."]}),e.jsxs(L,{variant:"outline",size:"sm",onClick:y,children:[e.jsx(he,{className:"mr-1.5 h-3.5 w-3.5"}),"Creer le premier objectif"]})]}),z&&!f&&c.length>0&&e.jsx("div",{className:"space-y-2",children:c.map(P=>e.jsx(kr,{objective:P,onEdit:S},P.id))}),p&&m&&e.jsx(Sr,{open:d,onOpenChange:l,objective:x,athleteName:m.display_name,athleteAuthId:p,competitions:h})]})},Mr=r.lazy(()=>Ft(()=>import("./StrengthCatalog-Demew4Qv.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43]))),Ar=r.lazy(()=>Ft(()=>import("./SwimCatalog-DRMJG2j4.js"),__vite__mapDeps([44,1,2,3,4,5,6,7,19,20,10,12,22,17,45,46,14,47,48,13,49,24,16,25,26,9,8,15,27,28,29,30,18,11,38,32,50,51,34]))),Dr=({onNavigate:t,onOpenRecordsAdmin:n,onOpenRecordsClub:s,athletes:o,athletesLoading:a,upcomingBirthdays:i,birthdaysLoading:d,kpiLoading:l,kpiPeriod:x,onKpiPeriodChange:u,fatigueAlerts:m,mostLoadedAthlete:p,swimSessionCount:v,strengthSessionCount:h})=>{const c=new Date().getHours(),f=c<12?"Bonjour":c<18?"Bon après-midi":"Bonsoir",_=new Date().toLocaleDateString("fr-FR",{weekday:"long",day:"numeric",month:"long"}),y=m.length>0;return e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-display font-bold uppercase italic",children:[f,", ",e.jsx("span",{className:"text-primary",children:"Coach"})]}),e.jsx("p",{className:"text-sm text-muted-foreground capitalize",children:_})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h2",{className:"text-xs font-semibold uppercase tracking-[0.15em] text-muted-foreground",children:["Signaux · ",x,"j"]}),e.jsxs(dt,{type:"single",size:"sm",variant:"outline",value:String(x),onValueChange:S=>{S&&u(Number(S))},children:[e.jsx(de,{value:"7",className:"h-7 px-2 text-xs","aria-label":"7 jours",children:"7j"}),e.jsx(de,{value:"30",className:"h-7 px-2 text-xs","aria-label":"30 jours",children:"30j"}),e.jsx(de,{value:"365",className:"h-7 px-2 text-xs","aria-label":"1 an",children:"1an"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:`rounded-xl border p-3 ${y?"border-destructive/30 bg-destructive/5":"bg-muted/30"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-[11px] text-muted-foreground",children:"Fatigue 5/5"}),e.jsx(sn,{className:`h-3.5 w-3.5 ${y?"text-destructive":"text-muted-foreground"}`})]}),e.jsx("p",{className:"text-xl font-bold tabular-nums",children:l?"–":m.length}),e.jsx("p",{className:"text-[11px] text-muted-foreground truncate",children:l?"Chargement…":y?m.slice(0,2).map(S=>S.athleteName.split(" ")[0]).join(", "):"Aucune alerte"})]}),e.jsxs("div",{className:"rounded-xl border bg-muted/30 p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-[11px] text-muted-foreground",children:"Plus chargé"}),e.jsx(De,{className:"h-3.5 w-3.5 text-muted-foreground"})]}),e.jsx("p",{className:"text-xl font-bold truncate",children:l?"–":p?.athleteName?.split(" ")[0]??"–"}),e.jsx("p",{className:"text-[11px] text-muted-foreground",children:l?"Calcul…":p?`Charge ${Math.round(p.loadScore)}`:"Pas de données"})]})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs("button",{type:"button",onClick:()=>t("calendar"),className:"flex items-center gap-1.5 rounded-full bg-primary text-primary-foreground px-3.5 py-2 text-sm font-semibold active:opacity-80 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",children:[e.jsx(at,{className:"h-3.5 w-3.5"}),"Assigner"]}),e.jsxs("button",{type:"button",onClick:()=>t("messaging"),className:"flex items-center gap-1.5 rounded-full border px-3.5 py-2 text-sm font-semibold active:bg-muted focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",children:[e.jsx(Lt,{className:"h-3.5 w-3.5"}),"Email"]}),e.jsxs("button",{type:"button",onClick:()=>t("sms"),className:"flex items-center gap-1.5 rounded-full border px-3.5 py-2 text-sm font-semibold active:bg-muted focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",children:[e.jsx(Tt,{className:"h-3.5 w-3.5"}),"SMS"]}),e.jsxs("button",{type:"button",onClick:()=>t("groups"),className:"flex items-center gap-1.5 rounded-full border px-3.5 py-2 text-sm font-semibold active:bg-muted focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",children:[e.jsx(Kt,{className:"h-3.5 w-3.5"}),"Groupes"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("button",{type:"button",onClick:()=>t("swim"),className:"rounded-xl border bg-card p-4 text-left shadow-sm active:bg-muted/50 transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",children:[e.jsx(Pt,{className:"h-5 w-5 text-primary mb-2"}),e.jsx("p",{className:"text-sm font-bold",children:"Natation"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:v!=null?`${v} séance${v!==1?"s":""}`:"Bibliothèque"})]}),e.jsxs("button",{type:"button",onClick:()=>t("strength"),className:"rounded-xl border bg-card p-4 text-left shadow-sm active:bg-muted/50 transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",children:[e.jsx(Rt,{className:"h-5 w-5 text-primary mb-2"}),e.jsx("p",{className:"text-sm font-bold",children:"Musculation"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:h!=null?`${h} séance${h!==1?"s":""}`:"Bibliothèque"})]}),e.jsxs("button",{type:"button",onClick:()=>t("swimmers"),className:"rounded-xl border bg-card p-4 text-left shadow-sm active:bg-muted/50 transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",children:[e.jsx(De,{className:"h-5 w-5 text-primary mb-2"}),e.jsx("p",{className:"text-sm font-bold",children:"Nageurs"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:a?"Chargement…":`${o.length} nageur${o.length!==1?"s":""}`})]}),e.jsxs("button",{type:"button",onClick:n,className:"rounded-xl border bg-card p-4 text-left shadow-sm active:bg-muted/50 transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",children:[e.jsx(nt,{className:"h-5 w-5 text-primary mb-2"}),e.jsx("p",{className:"text-sm font-bold",children:"Records club"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Import & administration"})]}),e.jsxs("button",{type:"button",onClick:()=>t("competitions"),className:"rounded-xl border bg-card p-4 text-left shadow-sm active:bg-muted/50 transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",children:[e.jsx(nt,{className:"h-5 w-5 text-amber-500 mb-2"}),e.jsx("p",{className:"text-sm font-bold",children:"Compétitions"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Échéances & calendrier"})]}),e.jsxs("button",{type:"button",onClick:()=>t("objectives"),className:"rounded-xl border bg-card p-4 text-left shadow-sm active:bg-muted/50 transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",children:[e.jsx(rt,{className:"h-5 w-5 text-primary mb-2"}),e.jsx("p",{className:"text-sm font-bold",children:"Objectifs"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Temps cibles & objectifs"})]})]}),e.jsx("button",{type:"button",onClick:s,className:"w-full text-center text-sm text-primary font-semibold py-1 active:opacity-70 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring rounded",children:"Voir les records du club"}),!d&&i&&i.length>0?e.jsxs("div",{className:"space-y-2",children:[e.jsx("h2",{className:"text-xs font-semibold uppercase tracking-[0.15em] text-muted-foreground",children:"Anniversaires"}),e.jsx("div",{className:"space-y-1.5",children:i.slice(0,3).map(S=>e.jsxs("div",{className:"flex items-center justify-between gap-2 rounded-lg border px-3 py-2",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("span",{className:"text-sm font-medium truncate block",children:S.display_name}),e.jsx("span",{className:"text-[11px] text-muted-foreground",children:Er(S.next_birthday)})]}),e.jsxs("span",{className:"text-xs font-bold text-primary shrink-0",children:["J-",S.days_until]})]},S.id))})]}):null]})},Er=t=>{if(!t)return"-";const n=new Date(t);return Number.isNaN(n.getTime())?t:n.toLocaleDateString("fr-FR")},kt=t=>t.toISOString().split("T")[0],Pr=t=>new Date(t.completed_at||t.started_at||t.date||t.created_at||0).getTime(),Rr=t=>{if(!t.length)return null;const n=t.reduce((o,a)=>o+a,0)/t.length,s=Math.min(5,Math.max(1,Math.round(n/10*5)));return{average:n,rating:s}};function Fr(){const t=gt(k=>k.role),n=gt(k=>k.setSelectedAthlete),[,s]=Ss(),[o,a]=r.useState(()=>window.location.hash.match(/[?&]section=([^&]+)/)?.[1]||"home"),[i,d]=r.useState(7);r.useEffect(()=>{const k=()=>a("home");return window.addEventListener("nav:reset",k),()=>window.removeEventListener("nav:reset",k)},[]);const l=t==="coach"||t==="admin",x=o==="home"||o==="calendar",u=o==="home"||o==="messaging"||o==="sms"||o==="swimmers"||o==="calendar"||o==="groups"||o==="objectives",m=o==="messaging"||o==="sms"||o==="calendar"||o==="groups",p=o==="home"||o==="swimmers",{data:v}=U({queryKey:["swim_catalog"],queryFn:()=>$.getSwimCatalog(),enabled:l&&x}),{data:h}=U({queryKey:["strength_catalog"],queryFn:()=>$.getStrengthSessions(),enabled:l&&x}),{data:c=[],isLoading:f}=U({queryKey:["athletes"],queryFn:()=>$.getAthletes(),enabled:l&&u}),_=r.useMemo(()=>c.slice(0,5),[c]),{data:y=[]}=U({queryKey:["groups"],queryFn:()=>$.getGroups(),enabled:l&&m}),S=U({queryKey:["upcoming-birthdays"],queryFn:()=>$.getUpcomingBirthdays({days:30}),enabled:l&&p}),V=S.data,z=U({queryKey:["coach-kpis",i,_.map(k=>k.id??k.display_name)],enabled:l&&o==="home"&&_.length>0,queryFn:async()=>{const k=i,E=new Date;E.setDate(E.getDate()-k);const D=kt(E),b=kt(new Date),R=await Promise.all(_.map(async F=>{const[C,j]=await Promise.all([$.getSessions(F.display_name,F.id),$.getStrengthHistory(F.display_name,{athleteId:F.id,limit:50,from:D,to:b})]),T=C.filter(N=>new Date(N.date).getTime()>=E.getTime()),I=T.map(N=>N.fatigue??N.feeling).filter(N=>Number.isFinite(N)),K=T.reduce((N,w)=>N+(Number(w.duration)||0)*(Number(w.effort)||0),0),A=(j?.runs??[]).filter(N=>Pr(N)>=E.getTime()),Q=A.map(N=>N.fatigue??N.feeling??N.rpe).filter(N=>Number.isFinite(Number(N))).map(N=>Number(N)),g=A.reduce((N,w)=>{const q=Number(w.feeling??w.rpe??0),G=Number(w.duration??0);if(G>0&&q>0)return N+G*q;const W=Array.isArray(w.logs)?w.logs.length:0;return N+W*5},0),M=Rr([...I,...Q]);return{athleteName:F.display_name,loadScore:K+g,fatigueRating:M}})),O=R.filter(F=>F.fatigueRating?.rating===5).map(F=>({athleteName:F.athleteName,rating:F.fatigueRating?.rating??0})),B=R.filter(F=>F.loadScore>0).sort((F,C)=>C.loadScore-F.loadScore)[0];return{fatigueAlerts:O,mostLoadedAthlete:B??null}}}),P=k=>{n({id:k.id??null,name:k.display_name}),s(k.id!=null?`/coach/swimmer/${k.id}`:"/progress")};return ne(),l?e.jsxs("div",{className:"space-y-6",children:[o==="home"?e.jsx(Dr,{onNavigate:a,onOpenRecordsAdmin:()=>s("/records-admin"),onOpenRecordsClub:()=>s("/records-club"),athletes:c,athletesLoading:f,upcomingBirthdays:V,birthdaysLoading:S.isLoading,kpiLoading:z.isLoading,kpiPeriod:i,onKpiPeriodChange:d,fatigueAlerts:z.data?.fatigueAlerts??[],mostLoadedAthlete:z.data?.mostLoadedAthlete??null,swimSessionCount:v?.length,strengthSessionCount:h?.length}):null,o==="swim"?e.jsxs("div",{className:"space-y-6",children:[e.jsx(ce,{title:"Bibliothèque natation",description:"Accédez aux séances et aux templates natation.",onBack:()=>a("home"),actions:e.jsxs(L,{variant:"outline",size:"sm",onClick:()=>a("calendar"),children:[e.jsx(at,{className:"mr-1.5 h-3.5 w-3.5"}),"Assigner"]})}),e.jsx(r.Suspense,{fallback:e.jsx(ft,{}),children:e.jsx(Ar,{})})]}):null,o==="strength"?e.jsxs("div",{className:"space-y-6",children:[e.jsx(ce,{title:"Bibliothèque musculation",description:"Consultez et créez des séances musculation.",onBack:()=>a("home"),actions:e.jsxs(L,{variant:"outline",size:"sm",onClick:()=>a("calendar"),children:[e.jsx(at,{className:"mr-1.5 h-3.5 w-3.5"}),"Assigner"]})}),e.jsx(r.Suspense,{fallback:e.jsx(ft,{}),children:e.jsx(Mr,{})})]}):null,o==="swimmers"?e.jsx(ln,{athletes:c,athletesLoading:f,onBack:()=>a("home"),onOpenAthlete:P}):null,o==="messaging"?e.jsx(cn,{onBack:()=>a("home"),athletes:c,groups:y,athletesLoading:f}):null,o==="sms"?e.jsx(or,{onBack:()=>a("home"),athletes:c,groups:y,athletesLoading:f}):null,o==="calendar"?e.jsx(ur,{onBack:()=>a("home"),athletes:c,groups:y,swimSessions:v,strengthSessions:h}):null,o==="groups"?e.jsx(xr,{onBack:()=>a("home"),athletes:c,groups:y,athletesLoading:f}):null,o==="competitions"?e.jsx(wr,{onBack:()=>a("home")}):null,o==="objectives"?e.jsx(_r,{onBack:()=>a("home"),athletes:c,athletesLoading:f}):null]}):e.jsx("div",{className:"flex items-center justify-center min-h-[60vh] animate-in fade-in motion-reduce:animate-none",children:e.jsxs(Se,{className:"w-full max-w-sm shadow-xl border-t-4 border-t-primary",children:[e.jsxs(ke,{children:[e.jsxs(_e,{className:"flex items-center gap-2 uppercase italic",children:[e.jsx(De,{className:"h-5 w-5 text-primary"}),"Accès Coach"]}),e.jsx(Me,{children:"Cette section est réservée aux coachs et administrateurs."})]}),e.jsx(Ae,{children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"Connectez-vous avec un compte autorisé pour accéder aux outils de gestion."})})]})})}const oa=Object.freeze(Object.defineProperty({__proto__:null,default:Fr},Symbol.toStringTag,{value:"Module"}));export{cs as C,Rn as P,ds as a,us as b,ms as c,lt as d,ct as e,Fn as f,es as g,oa as h};
