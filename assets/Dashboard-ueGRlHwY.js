import{r as i,j as e,c as Ct,u as ke,d as je,R as Ce}from"./vendor-query-DyA9aSKS.js";import{b as Ee,a as _t,W as Et,X as Ft,F as Ot,P as qe,u as lt,d as Ut,s as Ye,B as Lt}from"./index-BG17NGj_.js";import{c as Yt}from"./date-DrpgLmFD.js";import{a as J}from"./api-pDGM7gcL.js";import{D as Vt,a as Wt,b as Xt,c as Gt}from"./dialog-ctX8gs7d.js";import{M as Zt,C as es,a as ts}from"./CalendarGrid-BJjJ_ZF9.js";import{B as ss}from"./BottomActionBar-CEvhf8dm.js";import{A as ns,a as rs,b as os,c as is,d as as,e as ls,f as cs,g as ds}from"./alert-dialog-BflGXwvQ.js";import{a as us,s as ms,l as ct}from"./animations-CrcLFysI.js";import{d as Ve}from"./design-tokens-CKgCpdH6.js";import{C as It}from"./chevron-right-CXVK08nj.js";import{u as xs,A as Ae,m as se,a as ps,b as dt}from"./vendor-motion-lao-Njgm.js";import{P as fs}from"./power-Cq7v9CJo.js";import{C as ut}from"./chevron-down-CkZcXlyP.js";import{C as nt}from"./index-31swUFAZ.js";import{C as We}from"./circle-TRphhOdd.js";import{T as Re}from"./trash-2-BcpD_e_s.js";import{A as mt,S as bs,H as xt,f as Xe,p as gs}from"./SwimTimeInput-CWLlL7L1.js";import{T as pt}from"./timer-CGR2RyAq.js";import{P as hs}from"./pencil-C0RrrR33.js";import{I as ys}from"./InlineBanner-D6CiNgX3.js";import{C as js}from"./circle-alert-BH3tSsfw.js";import{T as ft}from"./trophy-F1PyAR91.js";import"./vendor-react-BzrpNAyj.js";import"./vendor-charts-BrQ8X25f.js";import"./vendor-supabase-DFPLkPj_.js";import"./vendor-date-B8Mnp-Vt.js";import"./swim-YhdB8qZt.js";import"./index-CYKCrQCq.js";import"./chevron-left-ByUcAH2y.js";import"./loader-circle-DoPA7dKh.js";import"./circle-check-BYRDUjOa.js";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ns=[["path",{d:"M5 12h14",key:"1ays0h"}]],Kt=Ee("minus",Ns);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vs=[["path",{d:"M14 17H5",key:"gfn3mx"}],["path",{d:"M19 7h-9",key:"6i9tg"}],["circle",{cx:"17",cy:"17",r:"3",key:"18b49y"}],["circle",{cx:"7",cy:"7",r:"3",key:"dfmy0x"}]],ws=Ee("settings-2",vs);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ks=[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]],Ss=Ee("sun",ks);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ms=[["path",{d:"m16 11 2 2 4-4",key:"9rsbq5"}],["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],bt=Ee("user-check",Ms);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ds=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]],Pe=Ee("user-x",Ds),Ge={NL:"",DOS:"",BR:"",PAP:"",QN:""};function gt(t){return String(t).padStart(2,"0")}function ht(t){return`${t.getFullYear()}-${gt(t.getMonth()+1)}-${gt(t.getDate())}`}function yt(t){return new Date(t.getFullYear(),t.getMonth(),1)}function jt(t,n){const o=new Date(t);return o.setDate(o.getDate()+n),o}function Ze(t){return(t.getDay()+6)%7}function _e(t){const n=Number(t);return Number.isFinite(n)?Math.round(n/1e3*100)/100:0}function As(t){const n=Number(t);return Number.isFinite(n)?Math.round(n*1e3):0}function Cs(t){return t?String(t).replaceAll(`\r
`,`
`).split(`
`).map(o=>o.trim()).filter(Boolean).flatMap(o=>{const r=o.replace(/^[•\\-–—]\\s*/,"").trim();return r?[r]:[]}):[]}function _s(t){if(!t)return null;const o=String(t).match(/(\\d+(?:[\\.,]\\d+)?)\\s*(km|m)\\b/i);if(!o)return null;const r=Number(String(o[1]).replace(",","."));return Number.isFinite(r)?o[2].toLowerCase()==="m"?_e(r):r:null}function Es(t,n){const o=t?.slot??t?.session_slot??t?.assigned_slot??t?.time_slot??t?.timeOfDay??t?.slot_key??t?.slotKey,r=String(o||"").toLowerCase();if(r.includes("mat")||r.includes("morning")||r==="am")return"AM";if(r.includes("soir")||r.includes("evening")||r==="pm")return"PM";const p=`${t?.title??""} ${t?.description??""}`.toLowerCase();return p.includes("matin")||p.includes(" am ")||p.includes("(am)")?"AM":p.includes("soir")||p.includes(" pm ")||p.includes("(pm)")?"PM":n===0?"AM":"PM"}function Fs(t){const n=t?.assigned_date??t?.date??t?.day??t?.scheduled_for??t?.scheduledAt??null;if(!n)return null;const o=String(n),r=o.length>=10?o.slice(0,10):o;return/\d{4}-\d{2}-\d{2}/.test(r)?r:null}function Os(t){if(Array.isArray(t?.items)){let p=0;for(const f of t.items){const h=Number(f?.distance);if(!Number.isFinite(h)||h<=0)continue;const c=f?.raw_payload,k=Number(c?.exercise_repetitions),y=Number(c?.block_repetitions),j=Number.isFinite(k)&&k>0?k:1,M=Number.isFinite(y)&&y>0?y:1;p+=h*j*M}if(p>0)return _e(p)}const n=t?.distance_meters??t?.distanceMeters??t?.meters??t?.planned_meters??t?.plannedMeters??t?.distance??null;if(n!=null&&Number.isFinite(Number(n))){const p=Number(n);return p>0&&p<=50?p:_e(p)}const o=t?.km??t?.distance_km??t?.distanceKm??t?.planned_km??t?.plannedKm??null;if(o!=null&&Number.isFinite(Number(o)))return Number(o);const r=_s(`${t?.title??""} ${t?.description??""}`);return r??null}function Ls(t){if(!Array.isArray(t)||t.length===0)return null;const n={crawl:"NL",dos:"DOS",brasse:"BR",pap:"PAP","4n":"QN"},o={NL:0,DOS:0,BR:0,PAP:0,QN:0};for(const p of t){const f=Number(p?.distance);if(!Number.isFinite(f)||f<=0)continue;const h=p?.raw_payload,c=Number(h?.exercise_repetitions),k=Number(h?.block_repetitions),y=Number.isFinite(c)&&c>0?c:1,j=Number.isFinite(k)&&k>0?k:1,M=f*y*j,Q=h?.exercise_stroke??h?.stroke??"crawl",K=n[String(Q).toLowerCase()];K?o[K]+=M:o.NL+=M}return Object.values(o).some(p=>p>0)?o:null}function Nt(t){const n=Number(t);if(!Number.isFinite(n))return"—";const o=Math.round(n*100)/100,r=String(o);return r.endsWith(".0")?r.slice(0,-2):r}function Is(){const t={};for(let n=0;n<7;n++)t[n]={AM:!0,PM:!0};return t}function et(t){if(!t)return null;try{return JSON.parse(t)}catch{return null}}function Ks({sessions:t,assignments:n,userId:o,user:r}){const p=`swim-dashboard-v2:${o??r??"anon"}`,f=`${p}:presenceDefaults`,h=`${p}:attendanceOverrides`,c=`${p}:stableFields`,[k,y]=i.useState(()=>Is()),[j,M]=i.useState({}),[Q,K]=i.useState(90);i.useEffect(()=>{if(typeof window>"u")return;const l=et(window.localStorage.getItem(f));l&&y(l);const d=et(window.localStorage.getItem(h));d&&M(d);const x=et(window.localStorage.getItem(c));x?.duration&&Number.isFinite(x.duration)&&x.duration>=30&&x.duration<=240&&K(x.duration)},[f,h,c]),i.useEffect(()=>{typeof window>"u"||window.localStorage.setItem(f,JSON.stringify(k))},[k,f]),i.useEffect(()=>{typeof window>"u"||window.localStorage.setItem(h,JSON.stringify(j))},[j,h]),i.useEffect(()=>{typeof window>"u"||window.localStorage.setItem(c,JSON.stringify({duration:Q}))},[Q,c]);const me=i.useMemo(()=>new Date,[]),[ie,ne]=i.useState(()=>yt(new Date)),[V,xe]=i.useState(()=>ht(new Date)),[ae,m]=i.useState(!1),[b,C]=i.useState(!1),[A,B]=i.useState(!1),[z,le]=i.useState(null),[Ne,X]=i.useState(!1),[pe,fe]=i.useState(null),[be,ge]=i.useState(!1),[ve,he]=i.useTransition(),E=i.useMemo(()=>(Array.isArray(n)?n:[]).filter(d=>d?.session_type==="swim"),[n]),F=i.useMemo(()=>{const l=new Map;for(const d of E){const x=Fs(d);x&&(l.has(x)||l.set(x,[]),l.get(x).push(d))}for(const[d,x]of l.entries())x.sort((w,S)=>Number(w?.id??0)-Number(S?.id??0)),l.set(d,x);return l},[E]),D=i.useMemo(()=>{const l=Array.isArray(t)?t:[],d={};for(const x of l){const w=String(x?.date??"").slice(0,10),S=x?.slot==="Soir"?"PM":"AM";d[`${w}__${S}`]=x}return d},[t]),R=i.useRef(new Map);i.useEffect(()=>{R.current.clear()},[F]);const v=i.useCallback(l=>{const d=R.current;if(d.has(l))return d.get(l);const x=[{id:`${l}__AM`,iso:l,slotKey:"AM",title:"Séance vide",km:null,details:[],isEmpty:!0},{id:`${l}__PM`,iso:l,slotKey:"PM",title:"Séance vide",km:null,details:[],isEmpty:!0}],w=(F.get(l)??[]).slice().sort((g,L)=>(Number(L.id)||0)-(Number(g.id)||0)),S=new Set;return w.forEach((g,L)=>{const q=g,ee=Es(q,L);if(S.has(ee))return;const H=ee==="AM"?0:1,we=Os(q),Oe=Array.isArray(q?.details)?q.details.map(String):Cs(g?.description);x[H]={id:`${l}__${ee}`,iso:l,slotKey:ee,title:String(g?.title??"Séance coach"),km:we,details:Oe,assignmentId:typeof g?.id=="number"?g.id:Number(g?.id)||void 0,isEmpty:!1},S.add(ee)}),d.set(l,x),x},[F]),I=i.useCallback((l,d)=>{const x=Ze(d),w=!!k?.[x]?.[l.slotKey],S=j[l.id];return S==="present"?{status:"present",expected:!0,expectedByDefault:w}:S==="absent"?{status:"absent",expected:!0,expectedByDefault:w}:w?{status:"present",expected:!0,expectedByDefault:w}:{status:"not_expected",expected:!1,expectedByDefault:w}},[j,k]),U=i.useMemo(()=>yt(ie),[ie]),G=i.useMemo(()=>{const l=Ze(U),d=jt(U,-l),x=[];for(let w=0;w<42;w++)x.push(jt(d,w));return x},[U]),W=i.useMemo(()=>{const l={};for(const d of G){const x=ht(d),w=v(x);let S=0,g=0;const L=[];for(const q of w){const ee=I(q,d);if(!ee.expected){!!D[q.id]?(S+=1,g+=1,L.push({slotKey:q.slotKey,expected:!0,completed:!0,absent:!1})):L.push({slotKey:q.slotKey,expected:!1,completed:!1,absent:!1});continue}S+=1;const H=!!D[q.id],we=ee.status==="absent";H&&(g+=1),L.push({slotKey:q.slotKey,expected:!0,completed:H,absent:we})}l[x]={completed:g,total:S,slots:L}}return l},[G,v,I,D]),_=i.useMemo(()=>{const[l,d,x]=V.split("-").map(Number);return new Date(l,d-1,x)},[V]),O=i.useMemo(()=>v(V),[v,V]),T=W[V]||{completed:0,total:2,slots:[{slotKey:"AM",expected:!0,completed:!1,absent:!1},{slotKey:"PM",expected:!0,completed:!1,absent:!1}]},ce=i.useMemo(()=>{const l=Array.isArray(t)?t:[];let d=0;for(const x of l){const w=String(x?.date??"").slice(0,10),S=x?.slot==="Soir"?"PM":"AM",g=`${w}__${S}`;if(j[g]==="absent")continue;const L=Ze(new Date(w));(k?.[L]?.[S]||j[g]==="present")&&Number.isFinite(Number(x?.distance))&&(d+=Number(x.distance))}return Nt(_e(d))},[t,j,k]),Z=i.useMemo(()=>{const l=O;let d=0;for(const x of l){const w=I(x,_);if(!w.expected||w.status==="absent")continue;const S=D[x.id];S&&Number.isFinite(Number(S?.distance))&&(d+=Number(S.distance))}return Nt(_e(d))},[O,I,_,D]),de=i.useMemo(()=>z&&D[z]||null,[z,D]),re=i.useMemo(()=>{const l=de||{},d=l?.stroke_distances,x=d?{NL:d.NL?String(d.NL):"",DOS:d.DOS?String(d.DOS):"",BR:d.BR?String(d.BR):"",PAP:d.PAP?String(d.PAP):"",QN:d.QN?String(d.QN):""}:Ge;return{difficulty:l?.effort??null,fatigue_end:l?.fatigue??l?.feeling??null,performance:l?.performance??l?.feeling??null,engagement:l?.engagement??l?.feeling??null,comment:String(l?.comments??""),distanceMeters:Number.isFinite(Number(l?.distance))?Number(l.distance):null,showStrokeDetail:!!(d&&Object.values(d).some(w=>w&&w>0)),strokes:x,exerciseLogs:[]}},[de]),[Fe,Se]=i.useState(()=>({difficulty:null,fatigue_end:null,performance:null,engagement:null,comment:"",distanceMeters:null,showStrokeDetail:!1,strokes:Ge,exerciseLogs:[]}));return i.useEffect(()=>{const l=O.find(d=>d.id===z);if(l){const d=l.km!=null?As(l.km):5e3;let x=Ge;if(l.assignmentId){const S=(n??[]).find(g=>g.id===l.assignmentId);if(S?.items){const g=Ls(S.items);g&&(x={NL:String(g.NL||""),DOS:String(g.DOS||""),BR:String(g.BR||""),PAP:String(g.PAP||""),QN:String(g.QN||"")})}}const w=Object.values(re.strokes).some(S=>S&&Number(S)>0);Se(S=>({...S,...re,distanceMeters:re.distanceMeters==null?d:re.distanceMeters,strokes:w?re.strokes:x,showStrokeDetail:w||Object.values(x).some(g=>g&&Number(g)>0)}));return}Se(d=>({...d,...re}))},[re,z,O,n]),i.useEffect(()=>{const l=()=>{m(!1),C(!1),B(!1),le(null),X(!1),fe(null)};return window.addEventListener("nav:reset",l),()=>window.removeEventListener("nav:reset",l)},[]),i.useEffect(()=>{ae&&be&&T.total>0&&T.completed>=T.total&&(m(!1),le(null),X(!1),ge(!1))},[ae,be,T.completed,T.total]),{today:me,monthCursor:ie,selectedISO:V,drawerOpen:ae,settingsOpen:b,infoOpen:A,activeSessionId:z,detailsOpen:Ne,selectedDayIndex:pe,isPending:ve,presenceDefaults:k,attendanceOverrideBySessionId:j,stableDurationMin:Q,draftState:Fe,gridDates:G,completionByISO:W,selectedDate:_,sessionsForSelectedDay:O,selectedDayStatus:T,globalKm:ce,dayKm:Z,logsBySessionId:D,setMonthCursor:ne,setSelectedISO:xe,setDrawerOpen:m,setSettingsOpen:C,setInfoOpen:B,setActiveSessionId:le,setDetailsOpen:X,setSelectedDayIndex:fe,setPresenceDefaults:y,setAttendanceOverrideBySessionId:M,setStableDurationMin:K,setDraftState:Se,setAutoCloseArmed:ge,startTransition:he,getSessionStatus:I,getSessionsForISO:v}}function tt(...t){return t.filter(Boolean).join(" ")}const vt={NL:"NL",DOS:"Dos",BR:"Brasse",PAP:"Pap",QN:"4N"};function Ps({strokes:t,showStrokeDetail:n,disabled:o=!1,onToggle:r,onChange:p}){return e.jsxs("div",{className:"mt-3",children:[e.jsxs("button",{type:"button",disabled:o,onClick:r,className:tt("flex w-full items-center justify-between rounded-2xl border px-3 py-2 text-sm font-semibold transition",o?"text-muted-foreground border-border cursor-not-allowed":"text-foreground border-border hover:bg-muted"),children:[e.jsx("span",{children:"Détail par nage"}),e.jsx(It,{className:tt("h-4 w-4 transition-transform",n&&"rotate-90")})]}),n&&e.jsx("div",{className:"mt-2 grid grid-cols-5 gap-2",children:Object.keys(vt).map(f=>e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"block text-center text-xs font-medium text-muted-foreground",children:vt[f]}),e.jsx("input",{type:"number",inputMode:"numeric",min:0,step:100,disabled:o,value:t[f],onChange:h=>p({...t,[f]:h.target.value}),placeholder:"0",className:tt("w-full rounded-xl border px-1 py-2 text-center text-sm outline-none",o?"bg-muted text-muted-foreground":"bg-card text-foreground border-border focus:ring-2 focus:ring-foreground/10")}),e.jsx("div",{className:"text-center text-[10px] text-muted-foreground",children:"m"})]},f))})]})}function P(...t){return t.filter(Boolean).join(" ")}function Ts(t){return t.toLocaleDateString("fr-FR",{weekday:"long",day:"numeric",month:"long",year:"numeric"})}function Qe(t){const n=Number(t);if(!Number.isFinite(n))return"—";const o=Math.round(n*100)/100,r=String(o);return r.endsWith(".0")?r.slice(0,-2):r}function wt(t){const n=Number(t);return Number.isFinite(n)?Math.round(n/1e3*100)/100:0}function $s(t){const n=Number(t);return Number.isFinite(n)?Math.round(n*1e3):0}const st=[{key:"difficulty",label:"Difficulté",mode:"hard"},{key:"fatigue_end",label:"Fatigue fin",mode:"hard"},{key:"performance",label:"Perf perçue",mode:"good"},{key:"engagement",label:"Engagement",mode:"good"}],Bs=[{key:"AM",label:"Matin",Icon:Ss},{key:"PM",label:"Soir",Icon:Zt}];function Te({children:t}){return e.jsx("span",{className:"inline-flex items-center rounded-full bg-muted px-2 py-0.5 text-xs font-semibold text-muted-foreground",children:t})}function $e({onClick:t,label:n,children:o,tone:r="neutral",disabled:p}){const f={neutral:"bg-background border-border text-foreground hover:bg-muted",dark:"bg-foreground border-foreground text-background hover:opacity-90",sky:"bg-primary/10 border-primary/30 text-primary hover:bg-primary/20"};return e.jsxs("button",{type:"button",onClick:t,disabled:p,className:P("inline-flex items-center justify-center rounded-2xl border p-2 transition",f[r],p&&"opacity-50 cursor-not-allowed hover:bg-background"),"aria-label":n,title:n,children:[o,e.jsx("span",{className:"sr-only",children:n})]})}function Rs(t,n){const o=Number(n);return!Number.isFinite(o)||o<1||o>5?"neutral":t==="hard"?{1:"bg-intensity-1 border-intensity-1 text-white",2:"bg-intensity-2 border-intensity-2 text-white",3:"bg-intensity-3 border-intensity-3 text-white",4:"bg-intensity-4 border-intensity-4 text-white",5:"bg-intensity-5 border-intensity-5 text-white"}[o]:{1:"bg-intensity-5 border-intensity-5 text-white",2:"bg-intensity-4 border-intensity-4 text-white",3:"bg-intensity-3 border-intensity-3 text-white",4:"bg-intensity-2 border-intensity-2 text-white",5:"bg-intensity-1 border-intensity-1 text-white"}[o]}function qs({plannedMeters:t,valueMeters:n,onChange:o,disabled:r}){const c=Number.isFinite(Number(n))?Number(n):t,k=c-t,[y,j]=i.useState(!1),[M,Q]=i.useState("");return e.jsxs("div",{className:P("mt-4 rounded-3xl border px-4 py-3",r?"bg-muted border-border":"bg-card border-border"),children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:P("text-xs font-semibold",r?"text-muted-foreground":"text-foreground"),children:"Ajuster kilométrage"}),k!==0&&e.jsx("div",{className:P("text-xs font-semibold px-2 py-0.5 rounded-full",k>0?"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400":"bg-orange-100 text-orange-800 dark:bg-orange-900/30 dark:text-orange-400"),children:k>0?`+${k}m`:`${k}m`})]}),e.jsx("div",{className:"text-center mb-3",children:e.jsxs("div",{className:P("text-xs","text-muted-foreground"),children:["Planifié : ",t,"m (",Qe(wt(t))," km)"]})}),e.jsxs("div",{className:"flex items-center justify-center gap-3",children:[e.jsx("button",{type:"button",disabled:r||c-100<0,onClick:()=>o(c-100),className:P("h-11 w-11 rounded-2xl border flex items-center justify-center transition-colors",r?"bg-muted border-border text-muted-foreground cursor-not-allowed":"bg-card border-border text-foreground hover:bg-muted active:scale-95"),"aria-label":"-100m",children:e.jsx(Kt,{className:"h-5 w-5"})}),e.jsx("div",{className:"min-w-[140px] text-center",children:y?e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"number",step:100,min:0,max:3e4,autoFocus:!0,value:M,onChange:K=>Q(K.target.value),onBlur:()=>{const K=Number(M);Number.isFinite(K)&&K>=0&&K<=3e4&&o(Math.round(K/100)*100),j(!1)},onKeyDown:K=>{K.key==="Enter"?K.target.blur():K.key==="Escape"&&j(!1)},className:"w-20 text-center text-lg font-bold bg-transparent border-b border-primary outline-none"}),e.jsx("div",{className:"text-xs text-muted-foreground mt-0.5",children:"mètres"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("button",{type:"button",disabled:r,onClick:()=>{Q(String(c)),j(!0)},className:P("text-2xl font-bold border-b border-dashed border-muted-foreground/40",r?"text-muted-foreground cursor-not-allowed":"text-foreground hover:border-primary cursor-text"),children:[c,"m"]}),e.jsxs("div",{className:P("text-sm font-medium mt-0.5",r?"text-muted-foreground":"text-primary"),children:[Qe(wt(c))," km"]})]})}),e.jsx("button",{type:"button",disabled:r||c+100>3e4,onClick:()=>o(c+100),className:P("h-11 w-11 rounded-2xl border flex items-center justify-center transition-colors",r?"bg-muted border-border text-muted-foreground cursor-not-allowed":"bg-card border-border text-foreground hover:bg-muted active:scale-95"),"aria-label":"+100m",children:e.jsx(qe,{className:"h-5 w-5"})})]})]})}function Qs({onMark:t}){const[n,o]=i.useState(!1),[r,p]=i.useState("");return n?e.jsxs("div",{className:"flex gap-2 mb-3",children:[e.jsx("input",{type:"text",placeholder:"Motif (optionnel)",value:r,onChange:f=>p(f.target.value),className:"flex-1 rounded-md border border-input bg-transparent px-3 py-1.5 text-sm",autoFocus:!0}),e.jsx("button",{type:"button",onClick:()=>{t(r||void 0),o(!1),p("")},className:"rounded-md bg-primary px-3 py-1.5 text-sm font-medium text-primary-foreground",children:"OK"})]}):e.jsx("button",{type:"button",className:"w-full rounded-xl border border-dashed border-muted-foreground/30 p-2.5 mb-3 text-sm text-muted-foreground hover:bg-muted/50 transition-colors",onClick:()=>o(!0),children:"Marquer indisponible"})}function zs({open:t,selectedDate:n,sessionsForSelectedDay:o,selectedDayStatus:r,dayKm:p,activeSessionId:f,detailsOpen:h,draftState:c,saveState:k,isPending:y,logsBySessionId:j,onClose:M,onDayOffAll:Q,onOpenSession:K,onCloseSession:me,onToggleDetails:ie,onMarkAbsent:ne,onMarkPresent:V,onClearOverride:xe,onSaveFeedback:ae,onDraftStateChange:m,getSessionStatus:b,isAbsent:C,absenceReason:A,onDeleteFeedback:B,onMarkDayAbsent:z,onRemoveDayAbsence:le}){const Ne=xs(),[,X]=_t(),[pe,fe]=i.useState(!1),[be,ge]=i.useState(!1),[ve,he]=i.useState(null),E=i.useMemo(()=>f&&o.find(F=>F.id===f)||null,[f,o]);return i.useEffect(()=>{ge(!1)},[f]),e.jsxs(Ae,{children:[t&&e.jsxs(e.Fragment,{children:[e.jsx(se.div,{className:"fixed inset-0 z-overlay bg-black/30",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:M}),e.jsx(se.div,{className:P("fixed z-modal bg-background shadow-2xl","left-0 right-0 bottom-0 top-auto max-h-[calc(100dvh-env(safe-area-inset-top))] h-[88dvh] rounded-t-3xl","sm:right-0 sm:top-0 sm:left-auto sm:bottom-auto sm:h-full sm:w-full sm:max-w-xl sm:rounded-none"),variants:us,initial:"hidden",animate:"visible",exit:"exit",drag:"y",dragControls:Ne,dragListener:!1,dragConstraints:{top:0,bottom:0},dragElastic:{top:.05,bottom:.3},dragSnapToOrigin:!0,onDragEnd:(F,D)=>{(D.offset.y>100||D.velocity.y>500)&&M()},role:"dialog","aria-modal":"true",children:e.jsxs("div",{className:"flex h-full flex-col",children:[e.jsx("div",{className:"px-5 pt-3 sm:hidden touch-none",onPointerDown:F=>Ne.start(F),children:e.jsx("div",{className:"mx-auto h-1.5 w-12 rounded-full bg-muted"})}),e.jsxs("div",{className:"sticky top-0 z-10 flex items-center justify-between border-b border-primary/15 bg-background px-4 sm:px-5 py-2.5",children:[e.jsxs("div",{className:"flex items-center gap-2.5 min-w-0",children:[e.jsx("div",{className:"flex items-center justify-center h-7 w-7 rounded-lg bg-primary text-primary-foreground shrink-0",children:e.jsx(Et,{className:"h-3.5 w-3.5"})}),e.jsx("div",{className:"min-w-0",children:e.jsx("div",{className:"truncate text-sm font-display font-bold uppercase italic tracking-tight text-primary",children:Ts(n)})})]}),e.jsx($e,{onClick:M,label:"Fermer",children:e.jsx(Ft,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"flex-1 overflow-auto p-4 sm:p-5",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center gap-2.5",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"text-lg font-bold text-foreground",children:[p," km"]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:P("h-1.5 w-1.5 rounded-full",r.total>0&&r.completed>=1?"bg-status-success":"bg-muted-foreground/30")}),e.jsx("span",{className:P("h-1.5 w-1.5 rounded-full",r.total>0&&r.completed>=2?"bg-status-success":"bg-muted-foreground/30")})]})]})}),e.jsx($e,{onClick:Q,label:"OFF (absent journée)",tone:"dark",disabled:y,children:e.jsx(fs,{className:"h-5 w-5"})})]}),E?null:e.jsx("div",{className:"mt-3 rounded-2xl border border-border bg-muted/20 px-3 py-2 text-xs text-muted-foreground",children:"Choisis un créneau pour saisir ton ressenti. Une fois ouvert, la saisie prend toute la place."}),!E&&z&&le&&(C?e.jsxs("div",{className:"rounded-xl border border-muted bg-muted/30 p-3 mt-3 mb-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"Marqué indisponible"}),e.jsx("button",{type:"button",onClick:le,className:"text-xs text-primary hover:underline",children:"Annuler"})]}),A&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:A})]}):e.jsx("div",{className:"mt-3",children:e.jsx(Qs,{onMark:z})})),!E&&(()=>{const F=[],D=[];for(const v of o)b(v,n).status==="not_expected"?D.push(v):F.push(v);const R=v=>{const I=b(v,n),U=!!j[v.id],G=I.status==="absent",W=I.status==="not_expected",_=G||W,O=I.expected&&!U&&!G,T=U?"bg-status-success-bg border-status-success/30":_?"bg-sky-50 border-sky-200":O?"bg-status-warning-bg border-status-warning/30":"bg-card border-border",ce=Bs.find(Z=>Z.key===v.slotKey)?.Icon||We;return e.jsx("button",{type:"button",onClick:()=>K(v.id),className:P("w-full rounded-3xl border px-3 py-3 text-left transition",T,"hover:shadow-sm"),children:e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[e.jsx("div",{className:P("h-10 w-10 rounded-2xl border flex items-center justify-center",U?"border-status-success/30 bg-status-success-bg":_?"border-sky-200 bg-sky-100":O?"border-status-warning/30 bg-status-warning-bg":"border-border bg-muted"),children:e.jsx(ce,{className:"h-5 w-5 text-foreground"})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"truncate text-sm font-semibold text-foreground",children:v.title}),e.jsxs("div",{className:"mt-1 flex items-center gap-2",children:[v.isEmpty?e.jsx(Te,{children:"Vide"}):e.jsxs(Te,{children:[Qe(v.km)," km"]}),U&&e.jsxs("span",{className:"inline-flex items-center text-emerald-800",children:[e.jsx(nt,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Présent"})]}),_&&!U&&e.jsxs("span",{className:"inline-flex items-center text-sky-800",children:[e.jsx(Pe,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Absent"})]}),O&&e.jsxs("span",{className:"inline-flex items-center text-orange-900",children:[e.jsx(We,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"En attente"})]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[W&&e.jsx($e,{onClick:Z=>{Z.stopPropagation(),V(v.id)},label:"Je suis venu",disabled:y,children:e.jsx(bt,{className:"h-5 w-5"})}),I.expected&&!U&&!G&&e.jsx($e,{onClick:Z=>{Z.stopPropagation(),ne(v.id)},label:"Absent",tone:"sky",disabled:y,children:e.jsx(Pe,{className:"h-5 w-5"})})]})]})},v.id)};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mt-4 grid gap-2",children:F.map(R)}),D.length>0&&e.jsxs("div",{className:"mt-3",children:[e.jsxs("button",{type:"button",onClick:()=>fe(v=>!v),className:"flex w-full items-center gap-2 rounded-2xl px-3 py-2 text-xs font-semibold text-muted-foreground hover:bg-muted transition",children:[e.jsx(ut,{className:P("h-4 w-4 transition-transform",pe&&"rotate-180")}),"Autres séances (",D.length,")"]}),e.jsx(Ae,{children:pe&&e.jsx(se.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.2},className:"overflow-hidden",children:e.jsx("div",{className:"mt-1 grid gap-2",children:D.map(R)})})})]})]})})(),e.jsx(Ae,{children:E&&e.jsx(se.div,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},exit:{opacity:0,y:8},transition:{duration:Ve.normal},className:"mt-4 rounded-3xl border border-border bg-card overflow-hidden",children:(()=>{const F=b(E,n),D=F.status==="absent",R=F.status==="not_expected",v=!!j[E.id],I=F.expected&&!D,U=D?"Annuler":R?"Je suis venu":"Absent",G=D?()=>xe(E.id):R?()=>V(E.id):()=>ne(E.id),W=$s(E.km??0);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-border",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"text-[10px] font-semibold uppercase tracking-[0.14em] text-muted-foreground",children:"Créneau sélectionné"}),e.jsx("div",{className:"truncate text-sm font-semibold text-foreground",children:E.title}),e.jsxs("div",{className:"mt-1 flex items-center gap-2",children:[E.isEmpty?e.jsx(Te,{children:"Vide"}):e.jsxs(Te,{children:[Qe(E.km)," km"]}),v?e.jsxs("span",{className:"inline-flex items-center text-emerald-800",children:[e.jsx(nt,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Présent"})]}):D||R?e.jsxs("span",{className:"inline-flex items-center text-sky-800",children:[e.jsx(Pe,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Absent"})]}):e.jsxs("span",{className:"inline-flex items-center text-orange-900",children:[e.jsx(We,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"En attente"})]})]})]}),e.jsx("button",{type:"button",onClick:me,className:"rounded-2xl border border-border bg-card px-3 py-2 text-xs font-semibold text-foreground hover:bg-muted",children:"Retour aux créneaux"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 p-3",children:[e.jsxs("button",{type:"button",onClick:G,className:P("rounded-2xl px-3 py-3 text-sm font-semibold border transition inline-flex items-center justify-center gap-2",R?"bg-foreground text-background border-foreground hover:opacity-90":"bg-card text-foreground border-border hover:bg-muted"),children:[R?e.jsx(bt,{className:"h-4 w-4"}):e.jsx(Pe,{className:"h-4 w-4"}),U]}),e.jsxs("button",{type:"button",onClick:ie,className:"rounded-2xl px-3 py-3 text-sm font-semibold border border-border bg-card hover:bg-muted inline-flex items-center justify-center gap-2",children:[e.jsx(Ot,{className:"h-4 w-4"}),"Fiche"]})]}),e.jsx(Ae,{children:h&&e.jsx(se.div,{initial:{opacity:0,y:6},animate:{opacity:1,y:0},exit:{opacity:0,y:6},transition:{duration:Ve.normal},className:"mx-3 mb-3 rounded-2xl border border-border bg-muted p-3",children:e.jsx("button",{type:"button",onClick:()=>X(E.assignmentId?`/swim-session?assignmentId=${E.assignmentId}`:"/swim-session"),className:"w-full rounded-2xl border border-border bg-card px-3 py-2 text-sm font-semibold text-foreground hover:bg-muted",children:E.assignmentId?"Ouvrir la fiche complète":"Saisir mes détails techniques"})})}),e.jsxs("div",{className:"px-4 pb-4",children:[!I&&e.jsx("div",{className:"mb-3 rounded-2xl bg-sky-50 text-sky-900 px-3 py-2 text-xs",children:D?"Absent: aucun ressenti.":'Non prévu: appuyez "Je suis venu".'}),e.jsxs(se.div,{className:"space-y-4",variants:ms,initial:"hidden",animate:"visible",children:[st.map(_=>{const O=c[_.key];return e.jsxs(se.div,{className:"space-y-2",variants:ct,children:[e.jsx("div",{className:P("text-sm font-semibold",I?"text-foreground":"text-muted-foreground"),children:_.label}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"text-[10px] text-muted-foreground w-14 text-right shrink-0 leading-tight",children:_.mode==="hard"?"Facile":"Mauvaise"}),e.jsx("div",{className:"flex gap-1.5 flex-1 justify-center",children:[1,2,3,4,5].map(T=>{const ce=O===T;return e.jsx("button",{type:"button",disabled:!I,onClick:()=>m({...c,[_.key]:T}),className:P("h-11 w-11 rounded-2xl border text-sm font-semibold transition",I?ce?Rs(_.mode,T):"bg-card text-foreground border-border hover:bg-muted":"bg-muted text-muted-foreground border-border cursor-not-allowed"),children:T},T)})}),e.jsx("span",{className:"text-[10px] text-muted-foreground w-14 shrink-0 leading-tight",children:_.mode==="hard"?"Très dur":"Excellente"})]})]},_.key)}),e.jsxs(se.div,{className:"space-y-2",variants:ct,children:[e.jsx("div",{className:P("text-sm font-semibold",I?"text-foreground":"text-muted-foreground"),children:"Commentaire"}),e.jsx("textarea",{value:c.comment,onChange:_=>m({...c,comment:_.target.value}),disabled:!I,rows:3,placeholder:"Sensations, points techniques…",className:P("w-full resize-none rounded-3xl border px-4 py-3 text-sm outline-none",I?"bg-card text-foreground border-border focus:ring-2 focus:ring-foreground/10":"bg-muted text-muted-foreground border-border")})]})]}),e.jsxs("div",{className:"mt-4 rounded-3xl border border-border bg-muted/20 overflow-hidden",children:[e.jsxs("button",{type:"button",onClick:()=>ge(_=>!_),className:"flex w-full items-center justify-between gap-3 px-4 py-3 text-left",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold text-foreground",children:"Ajustements avancés"}),e.jsx("div",{className:"mt-0.5 text-xs text-muted-foreground",children:"Kilométrage, détail par nage et suppression du ressenti"})]}),e.jsx(ut,{className:P("h-4 w-4 shrink-0 text-muted-foreground transition-transform",be&&"rotate-180")})]}),e.jsx(Ae,{initial:!1,children:be?e.jsx(se.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:Ve.normal},className:"overflow-hidden border-t border-border",children:e.jsxs("div",{className:"px-3 pb-3",children:[e.jsx(qs,{plannedMeters:W,valueMeters:c.distanceMeters,onChange:_=>m({...c,distanceMeters:_}),disabled:!I}),e.jsx(Ps,{strokes:c.strokes,showStrokeDetail:c.showStrokeDetail,disabled:!I,onToggle:()=>m({...c,showStrokeDetail:!c.showStrokeDetail}),onChange:_=>m({...c,strokes:_})}),v&&B?e.jsxs("button",{type:"button",onClick:()=>he(E.id),disabled:y,className:"mt-4 w-full rounded-2xl border border-destructive/30 bg-destructive/5 px-3 py-2.5 text-sm font-medium text-destructive hover:bg-destructive/10 transition disabled:opacity-50 disabled:cursor-not-allowed inline-flex items-center justify-center gap-2",children:[e.jsx(Re,{className:"h-4 w-4"}),"Supprimer le ressenti"]}):null]})}):null})]})]})]})})()},E.id)})]}),E&&(()=>{const F=b(E,n),D=F.expected&&F.status!=="absent";return e.jsxs(ss,{saveState:k,position:"static",children:[e.jsx("button",{type:"button",onClick:ae,disabled:y||!D||!st.every(R=>Number.isInteger(c[R.key])),className:P("rounded-2xl px-4 py-3 text-sm font-semibold transition flex-1",y||!D?"bg-muted text-muted-foreground cursor-not-allowed":st.every(R=>Number.isInteger(c[R.key]))?"bg-status-success text-white hover:opacity-90":"bg-status-success-bg text-status-success cursor-not-allowed"),children:"Valider"}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["→"," km"]})]})})()]})})]}),B&&e.jsx(ns,{open:!!ve,onOpenChange:F=>{F||he(null)},children:e.jsxs(rs,{children:[e.jsxs(os,{children:[e.jsx(is,{children:"Supprimer ce ressenti ?"}),e.jsx(as,{children:"Cette action est irréversible."})]}),e.jsxs(ls,{children:[e.jsx(cs,{children:"Annuler"}),e.jsx(ds,{onClick:()=>{B(ve),he(null)},children:"Supprimer"})]})]})})]})}function Hs(...t){return t.filter(Boolean).join(" ")}function Js(t){try{return new Date(t).toLocaleDateString("fr-FR",{weekday:"short",day:"numeric",month:"short"})}catch{return t}}function Us({userId:t,expanded:n,onToggle:o}){const r=Ct(),{data:p,isLoading:f}=ke({queryKey:["swim-exercise-logs-history",t],queryFn:()=>J.getSwimExerciseLogsHistory(t,100),enabled:!!t&&n}),h=je({mutationFn:({logId:y,patch:j})=>J.updateSwimExerciseLog(y,j),onSuccess:()=>{r.invalidateQueries({queryKey:["swim-exercise-logs-history",t]})}}),c=je({mutationFn:y=>J.deleteSwimExerciseLog(y),onSuccess:()=>{r.invalidateQueries({queryKey:["swim-exercise-logs-history",t]})}}),k=Ce.useMemo(()=>{if(!p?.length)return[];const y=new Map;for(const j of p){const M=(j.created_at??"").slice(0,10);y.has(M)||y.set(M,[]),y.get(M).push(j)}return Array.from(y.entries()).map(([j,M])=>({date:j,entries:M}))},[p]);return e.jsxs("div",{className:"mt-6",children:[e.jsxs("button",{type:"button",onClick:o,className:"flex w-full items-center justify-between rounded-2xl border border-dashed border-border/80 bg-background px-3 py-2.5 text-left transition hover:bg-muted/40",children:[e.jsxs("span",{className:"flex min-w-0 items-center gap-2",children:[e.jsx("span",{className:"flex h-8 w-8 shrink-0 items-center justify-center rounded-xl bg-muted text-muted-foreground",children:e.jsx(Ot,{className:"h-4 w-4"})}),e.jsxs("span",{className:"min-w-0",children:[e.jsx("span",{className:"block truncate text-sm font-semibold text-foreground",children:"Notes techniques"}),e.jsx("span",{className:"block truncate text-[11px] text-muted-foreground",children:"Repères détaillés, consultation optionnelle"})]})]}),e.jsx(It,{className:Hs("h-4 w-4 transition-transform",n&&"rotate-90")})]}),n&&e.jsxs("div",{className:"mt-2 space-y-3 rounded-2xl border border-border/60 bg-card/60 p-2",children:[f&&e.jsx("div",{className:"text-sm text-muted-foreground text-center py-4",children:"Chargement..."}),!f&&k.length===0&&e.jsx("div",{className:"text-sm text-muted-foreground text-center py-4",children:"Aucune note technique enregistree."}),k.map(({date:y,entries:j})=>e.jsxs("div",{className:"rounded-2xl border border-border overflow-hidden",children:[e.jsx("div",{className:"bg-muted/50 px-3 py-2 text-xs font-semibold text-muted-foreground",children:Js(y)}),e.jsx("div",{className:"divide-y divide-border",children:j.map(M=>e.jsx(Ys,{log:M,onSave:Q=>h.mutate({logId:M.id,patch:Q}),onDelete:()=>c.mutate(M.id),saving:h.isPending},M.id))})]},y))]})]})}function Ys({log:t,onSave:n,onDelete:o,saving:r}){const[p,f]=i.useState(!1),[h,c]=i.useState({notes:t.notes??"",tempo:t.tempo,split_times:t.split_times,stroke_count:t.stroke_count}),[k,y]=i.useState([]),j=()=>{c({notes:t.notes??"",tempo:t.tempo,split_times:[...t.split_times],stroke_count:[...t.stroke_count]}),y(t.split_times.map(m=>Xe(m.time_seconds))),f(!0)},M=()=>f(!1),Q=()=>{n({notes:h.notes.trim()||null,tempo:h.tempo,split_times:h.split_times,stroke_count:h.stroke_count}),f(!1)},K=()=>{c(m=>({...m,split_times:[...m.split_times,{rep:m.split_times.length+1,time_seconds:0}]})),y(m=>[...m,""])},me=(m,b)=>{y(C=>C.map((A,B)=>B===m?b:A))},ie=m=>{const b=gs(k[m]),C=Xe(b);y(A=>A.map((B,z)=>z===m?C:B)),c(A=>({...A,split_times:A.split_times.map((B,z)=>z===m?{...B,time_seconds:b}:B)}))},ne=m=>{c(b=>({...b,split_times:b.split_times.filter((C,A)=>A!==m).map((C,A)=>({...C,rep:A+1}))})),y(b=>b.filter((C,A)=>A!==m))},V=()=>{c(m=>({...m,stroke_count:[...m.stroke_count,{rep:m.stroke_count.length+1,count:0}]}))},xe=(m,b)=>{c(C=>({...C,stroke_count:C.stroke_count.map((A,B)=>B===m?{...A,count:b}:A)}))},ae=m=>{c(b=>({...b,stroke_count:b.stroke_count.filter((C,A)=>A!==m).map((C,A)=>({...C,rep:A+1}))}))};return p?e.jsxs("div",{className:"px-3 py-2.5 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-semibold text-foreground",children:t.exercise_label}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{type:"button",onClick:Q,disabled:r,className:"p-1.5 rounded-lg text-primary hover:bg-primary/10 transition","aria-label":"Enregistrer",children:e.jsx(nt,{className:"h-4 w-4"})}),e.jsx("button",{type:"button",onClick:M,className:"p-1.5 rounded-lg text-muted-foreground hover:bg-muted transition","aria-label":"Annuler",children:e.jsx(Ft,{className:"h-4 w-4"})}),e.jsx("button",{type:"button",onClick:o,className:"p-1.5 rounded-lg text-muted-foreground hover:text-destructive hover:bg-destructive/10 transition","aria-label":"Supprimer",children:e.jsx(Re,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-xs font-medium text-muted-foreground min-w-[80px]",children:[e.jsx(mt,{className:"h-3.5 w-3.5"}),"Tempo"]}),e.jsx("input",{type:"number",inputMode:"decimal",step:"0.1",min:0,value:h.tempo??"",onChange:m=>c(b=>({...b,tempo:m.target.value?Number(m.target.value):null})),placeholder:"coups/min",className:"w-24 rounded-xl border border-border bg-background px-2 py-1.5 text-sm text-center outline-none focus:ring-2 focus:ring-foreground/10"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-xs font-medium text-muted-foreground",children:[e.jsx(pt,{className:"h-3.5 w-3.5"}),"Temps"]}),e.jsxs("button",{type:"button",onClick:K,className:"inline-flex items-center gap-1 text-xs text-primary hover:text-primary/80 transition",children:[e.jsx(qe,{className:"h-3 w-3"}),"Rep"]})]}),h.split_times.length>0&&e.jsx("div",{className:"mt-1.5 flex flex-wrap gap-1.5",children:h.split_times.map((m,b)=>e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"text-[10px] text-muted-foreground w-4 text-right",children:m.rep}),e.jsx(bs,{value:k[b]??"",onChange:C=>me(b,C),onBlur:()=>ie(b),size:"compact"}),e.jsx("button",{type:"button",onClick:()=>ne(b),className:"p-0.5 text-muted-foreground hover:text-destructive transition",children:e.jsx(Re,{className:"h-3 w-3"})})]},b))})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-xs font-medium text-muted-foreground",children:[e.jsx(xt,{className:"h-3.5 w-3.5"}),"Coups de bras"]}),e.jsxs("button",{type:"button",onClick:V,className:"inline-flex items-center gap-1 text-xs text-primary hover:text-primary/80 transition",children:[e.jsx(qe,{className:"h-3 w-3"}),"Rep"]})]}),h.stroke_count.length>0&&e.jsx("div",{className:"mt-1.5 flex flex-wrap gap-1.5",children:h.stroke_count.map((m,b)=>e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"text-[10px] text-muted-foreground w-4 text-right",children:m.rep}),e.jsx("input",{type:"number",inputMode:"numeric",min:0,value:m.count||"",onChange:C=>xe(b,Number(C.target.value)||0),placeholder:"nb",className:"w-14 rounded-lg border border-border bg-background px-1.5 py-1 text-xs text-center outline-none focus:ring-2 focus:ring-foreground/10"}),e.jsx("button",{type:"button",onClick:()=>ae(b),className:"p-0.5 text-muted-foreground hover:text-destructive transition",children:e.jsx(Re,{className:"h-3 w-3"})})]},b))})]}),e.jsx("textarea",{value:h.notes,onChange:m=>c(b=>({...b,notes:m.target.value})),placeholder:"Notes libres...",rows:2,className:"w-full resize-none rounded-xl border border-border bg-background px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-foreground/10"})]}):e.jsxs("div",{className:"px-3 py-2.5 space-y-1.5 group",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-sm font-semibold text-foreground",children:t.exercise_label}),e.jsx("button",{type:"button",onClick:j,className:"p-1.5 rounded-lg text-muted-foreground hover:bg-muted transition","aria-label":"Modifier",children:e.jsx(hs,{className:"h-3.5 w-3.5"})})]}),e.jsxs("div",{className:"flex flex-wrap gap-x-4 gap-y-1 text-xs text-muted-foreground",children:[t.tempo!=null&&e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx(mt,{className:"h-3 w-3"}),t.tempo," c/min"]}),t.split_times.length>0&&e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx(pt,{className:"h-3 w-3"}),t.split_times.map(m=>Xe(m.time_seconds)||"—").join(" / ")]}),t.stroke_count.length>0&&e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx(xt,{className:"h-3 w-3"}),t.stroke_count.map(m=>m.count).join(" / ")," cps"]})]}),t.notes&&e.jsx("div",{className:"text-xs text-foreground/70 italic",children:t.notes})]})}function Vs({onRefresh:t,children:n,pullThreshold:o=80}){const[r,p]=i.useState(!1),f=i.useRef(null),h=ps(0),c=dt(h,[0,o],[0,1]),k=dt(h,[0,o],[.5,1]),y=async()=>{const j=h.get();if(!((f.current?.scrollTop??0)>5||j<o)){p(!0);try{await t()}finally{p(!1)}}};return e.jsxs("div",{ref:f,className:"relative",style:{overscrollBehaviorY:"contain"},children:[e.jsx(se.div,{className:"pointer-events-none absolute left-1/2 top-0 z-10 flex -translate-x-1/2 items-center justify-center",style:{opacity:r?1:c,scale:r?1:k},children:e.jsx("div",{className:`mt-2 h-8 w-8 rounded-full border-2 border-primary border-t-transparent ${r?"animate-spin":""}`})}),e.jsx(se.div,{drag:"y",dragConstraints:{top:0,bottom:0},dragElastic:{top:0,bottom:.4},dragSnapToOrigin:!0,style:{y:h},onDragEnd:y,dragListener:!r,children:n})]})}const Ws=["Lun","Mar","Mer","Jeu","Ven","Sam","Dim"],kt=[{key:"AM",label:"Matin"},{key:"PM",label:"Soir"}],Xs=[{key:"difficulty",label:"Difficulté",mode:"hard"},{key:"fatigue_end",label:"Fatigue fin",mode:"hard"},{key:"performance",label:"Perf perçue",mode:"good"},{key:"engagement",label:"Engagement",mode:"good"}];function St(...t){return t.filter(Boolean).join(" ")}function Mt(t){return String(t).padStart(2,"0")}function Be(t){return`${t.getFullYear()}-${Mt(t.getMonth()+1)}-${Mt(t.getDate())}`}function Gs(t){return new Date(t.getFullYear(),t.getMonth(),1)}function Zs(t){const n=String(t).split("__");return{iso:n[0],slotKey:n[1]||""}}function Dt(t,n){return Number.isFinite(t)?Math.round(t/n)*n:0}function At({globalKm:t,onSettings:n}){return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-2.5",children:[e.jsx("div",{className:"flex items-center justify-center h-7 w-7 rounded-lg bg-primary text-primary-foreground",children:e.jsx(Et,{className:"h-3.5 w-3.5"})}),e.jsx("h1",{className:"text-lg font-display font-bold uppercase italic tracking-tight text-primary",children:"Accueil"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"hidden sm:inline text-xs font-mono font-semibold text-muted-foreground tabular-nums",children:[t," km"]}),e.jsxs(Lt,{type:"button",variant:"outline",size:"sm",onClick:n,className:"h-8 rounded-xl border-primary/20 bg-primary/5 px-2.5 text-xs font-semibold text-primary hover:bg-primary/10","aria-label":"Présence hebdo",children:[e.jsx(ws,{className:"mr-1 h-3.5 w-3.5"}),"Hebdo"]})]})]})}function On(){const t=lt(s=>s.user),n=lt(s=>s.userId),{toast:o}=Ut(),r=Ct(),p=i.useCallback(async()=>{await r.invalidateQueries({queryKey:["sessions"]}),await r.invalidateQueries({queryKey:["assignments"]}),await r.invalidateQueries({queryKey:["competitions"]}),await r.invalidateQueries({queryKey:["absences"]})},[r]),[,f]=_t(),[h,c]=Ce.useState("idle"),[k,y]=Ce.useState(!1),[j,M]=Ce.useState(null);Ce.useEffect(()=>{Ye.auth.getSession().then(({data:s})=>{M(s.session?.user?.id??null)})},[t]);const{data:Q,isLoading:K,error:me,refetch:ie}=ke({queryKey:["sessions",n??t],queryFn:()=>J.getSessions(t,n),enabled:!!t}),{data:ne,isLoading:V,error:xe,refetch:ae}=ke({queryKey:["assignments",t],queryFn:()=>J.getAssignments(t,n),enabled:!!t}),{data:m=[]}=ke({queryKey:["competitions"],queryFn:()=>J.getCompetitions()}),{data:b}=ke({queryKey:["my-competition-ids"],queryFn:()=>J.getMyCompetitionIds()}),C=i.useMemo(()=>!b||b.length===0?m:m.filter(s=>b.includes(s.id)),[m,b]),{data:A=[]}=ke({queryKey:["my-planned-absences"],queryFn:()=>J.getMyPlannedAbsences()}),B=i.useMemo(()=>new Set(A.map(s=>s.date)),[A]),z=K||V,le=me||xe,Ne=()=>{ie(),ae()},X=je({mutationFn:s=>J.deleteSession(s),onMutate:()=>{c("saving")},onSuccess:()=>{r.invalidateQueries({queryKey:["sessions"]}),r.invalidateQueries({queryKey:["hall-of-fame"]}),o({title:"Séance supprimée",description:"La saisie a été supprimée."}),c("saved"),setTimeout(()=>c("idle"),2e3)},onError:()=>{o({title:"Erreur",description:"Impossible de supprimer la séance.",variant:"destructive"}),c("error"),setTimeout(()=>c("idle"),3e3)}}),pe=je({mutationFn:async s=>{const{_exerciseLogs:a,...u}=s,N=await J.syncSession({...u,athlete_name:t,athlete_id:n??void 0});if(a&&a.length>0&&N.sessionId)try{const{data:$}=await Ye.auth.getSession(),Y=$.session?.user?.id;Y&&await J.saveSwimExerciseLogs(N.sessionId,Y,a)}catch($){console.warn("[EAC] Failed to save exercise logs:",$)}return N},onMutate:()=>{c("saving")},onSuccess:()=>{r.invalidateQueries({queryKey:["sessions"]}),r.invalidateQueries({queryKey:["assignments"]}),r.invalidateQueries({queryKey:["hall-of-fame"]}),o({title:"Séance enregistrée",description:"Vos données ont été synchronisées."}),c("saved"),setTimeout(()=>c("idle"),2e3)},onError:()=>{o({title:"Erreur",description:"Impossible d'enregistrer la séance.",variant:"destructive"}),c("error"),setTimeout(()=>c("idle"),3e3)}}),fe=je({mutationFn:async s=>{const{_exerciseLogs:a,...u}=s,N=await J.updateSession(u);if(a&&u.id)try{const{data:$}=await Ye.auth.getSession(),Y=$.session?.user?.id;Y&&await J.saveSwimExerciseLogs(u.id,Y,a)}catch($){throw console.error("[EAC] Failed to save exercise logs:",$),$}return N},onMutate:()=>{c("saving")},onSuccess:()=>{r.invalidateQueries({queryKey:["sessions"]}),r.invalidateQueries({queryKey:["hall-of-fame"]}),o({title:"Séance mise à jour",description:"Votre saisie a été mise à jour."}),c("saved"),setTimeout(()=>c("idle"),2e3)},onError:()=>{o({title:"Erreur",description:"Impossible de mettre à jour la séance.",variant:"destructive"}),c("error"),setTimeout(()=>c("idle"),3e3)}}),be=je({mutationFn:({date:s,reason:a})=>J.setPlannedAbsence(s,a),onMutate:async({date:s,reason:a})=>{await r.cancelQueries({queryKey:["my-planned-absences"]});const u=r.getQueryData(["my-planned-absences"]);return r.setQueryData(["my-planned-absences"],N=>[...N??[],{date:s,reason:a??null}]),{previous:u}},onSuccess:()=>{r.invalidateQueries({queryKey:["my-planned-absences"]}),o({title:"Jour marqué indisponible"})},onError:(s,a,u)=>{u?.previous&&r.setQueryData(["my-planned-absences"],u.previous),o({title:"Erreur",description:"Impossible de marquer ce jour indisponible.",variant:"destructive"})}}),ge=je({mutationFn:s=>J.removePlannedAbsence(s),onMutate:async s=>{await r.cancelQueries({queryKey:["my-planned-absences"]});const a=r.getQueryData(["my-planned-absences"]);return r.setQueryData(["my-planned-absences"],u=>(u??[]).filter(N=>N.date!==s)),{previous:a}},onSuccess:()=>{r.invalidateQueries({queryKey:["my-planned-absences"]}),o({title:"Disponibilité restaurée"})},onError:(s,a,u)=>{u?.previous&&r.setQueryData(["my-planned-absences"],u.previous),o({title:"Erreur",description:"Impossible de restaurer la disponibilité.",variant:"destructive"})}}),ve=Ks({sessions:Q,assignments:ne,userId:n,user:t}),{today:he,monthCursor:E,selectedISO:F,drawerOpen:D,settingsOpen:R,activeSessionId:v,detailsOpen:I,selectedDayIndex:U,isPending:G,presenceDefaults:W,stableDurationMin:_,draftState:O,gridDates:T,completionByISO:ce,selectedDate:Z,sessionsForSelectedDay:de,selectedDayStatus:re,globalKm:Fe,dayKm:Se,logsBySessionId:l,setMonthCursor:d,setSelectedISO:x,setDrawerOpen:w,setSettingsOpen:S,setActiveSessionId:g,setDetailsOpen:L,setSelectedDayIndex:q,setPresenceDefaults:ee,setAttendanceOverrideBySessionId:H,setStableDurationMin:we,setDraftState:Oe,setAutoCloseArmed:Le,startTransition:oe,getSessionStatus:ze}=ve,{competitionDates:Pt,competitionByDate:rt}=i.useMemo(()=>{const s=new Set,a=new Map;for(const u of C){if(!u.date)continue;const N=u.date.slice(0,10),$=u.end_date?u.end_date.slice(0,10):N;let Y=N;for(;Y<=$;){s.add(Y),a.has(Y)||a.set(Y,u.id);const ue=new Date(Y+"T00:00:00");ue.setDate(ue.getDate()+1);const Ke=ue.getFullYear(),De=String(ue.getMonth()+1).padStart(2,"0"),ye=String(ue.getDate()).padStart(2,"0");Y=`${Ke}-${De}-${ye}`}}return{competitionDates:s,competitionByDate:a}},[C]),te=i.useMemo(()=>{const s=Be(new Date);return C.filter(u=>u.date&&u.date.slice(0,10)>=s).sort((u,N)=>u.date.localeCompare(N.date))[0]??null},[C]),He=i.useMemo(()=>{if(!te)return null;const s=new Date;s.setHours(0,0,0,0);const a=new Date(te.date.slice(0,10)+"T00:00:00");return Math.round((a.getTime()-s.getTime())/(1e3*60*60*24))},[te]),Ie=i.useMemo(()=>te?Yt({compDate:te.date.slice(0,10),assignments:ne,absenceDates:B,presenceDefaults:W}):null,[te,ne,B,W]),Me=i.useCallback(s=>{const a=rt.get(s);if(a){f(`/competition/${a}`);return}x(s),w(!0),g(null),L(!1);const u=ce[s]||{completed:0,total:2};Le(u.total>0&&u.completed<u.total)},[rt,f,ce,x,w,g,L,Le]),Je=i.useCallback(()=>{w(!1),g(null),L(!1),Le(!1),q(null)},[w,g,L,Le,q]),ot=i.useCallback(()=>{d(s=>new Date(s.getFullYear(),s.getMonth()-1,1))},[d]),it=i.useCallback(()=>{d(s=>new Date(s.getFullYear(),s.getMonth()+1,1))},[d]),Tt=i.useCallback(()=>{const s=new Date;d(Gs(s)),Me(Be(s))},[Me,d]),Ue=i.useCallback(s=>{g(s),L(!1)},[g,L]),$t=i.useCallback(s=>{oe(()=>{H(u=>({...u,[s]:"absent"}))});const a=l[s];a?.id&&X.mutate(Number(a.id))},[X,l,oe,H]),Bt=i.useCallback(s=>{oe(()=>{H(a=>({...a,[s]:"present"}))})},[oe,H]),Rt=i.useCallback(s=>{oe(()=>{H(a=>{const u={...a};return delete u[s],u})})},[oe,H]),qt=i.useCallback(()=>{const s=de.map(a=>ze(a,Z).expected?a.id:null).filter(Boolean);s.length!==0&&(oe(()=>{H(a=>{const u={...a};for(const N of s)u[N]="absent";return u}),g(null),L(!1)}),s.forEach(a=>{const u=l[a];u?.id&&X.mutate(Number(u.id))}))},[de,ze,Z,oe,l,X,H,g,L]),Qt=i.useCallback(()=>{if(!v||!t||!Xs.every(ye=>Number.isInteger(O[ye.key])))return;const{iso:a,slotKey:u}=Zs(v),N=u==="PM"?"Soir":"Matin",$=Dt(Number(O.distanceMeters??0),100),Y=Dt(Number(_),15),ue={};for(const[ye,Jt]of Object.entries(O.strokes)){const at=Number(Jt);at>0&&(ue[ye]=at)}const Ke={date:a,slot:N,distance:$,duration:Y,effort:Number(O.difficulty),feeling:Number(O.fatigue_end),performance:Number(O.performance),engagement:Number(O.engagement),comments:String(O.comment||"").slice(0,400),athlete_name:t,athlete_id:n??void 0,stroke_distances:Object.keys(ue).length>0?ue:null},De=l[v];oe(()=>{H(ye=>({...ye,[v]:"present"}))}),De?.id?fe.mutate({...Ke,id:De.id,created_at:De.created_at??new Date().toISOString(),_exerciseLogs:O.exerciseLogs.length>0?O.exerciseLogs:[]}):pe.mutate({...Ke,_exerciseLogs:O.exerciseLogs.length>0?O.exerciseLogs:void 0}),g(null),L(!1)},[v,t,n,O,_,l,oe,fe,pe,H,g,L]),zt=i.useCallback((s,a)=>{ee(u=>({...u,[s]:{...u[s],[a]:!u[s][a]}}))},[ee]);i.useEffect(()=>{if(!D)return;const s=a=>{const u=a.target?.tagName;if(!(u==="INPUT"||u==="TEXTAREA"||a.target?.isContentEditable)){if(a.key==="Escape"){a.preventDefault(),Je();return}(a.key==="Enter"||a.key===" ")&&(a.preventDefault(),de.length>0&&!v&&Ue(de[0].id))}};return window.addEventListener("keydown",s),()=>window.removeEventListener("keydown",s)},[D,Je,de,v,Ue]);const Ht=i.useCallback((s,a)=>{if(!["ArrowUp","ArrowDown","ArrowLeft","ArrowRight","Enter"," "].includes(s.key))return;if(s.preventDefault(),s.key==="Enter"||s.key===" "){const $=Be(T[a]);Me($);return}let N=a;s.key==="ArrowLeft"&&(N=Math.max(0,a-1)),s.key==="ArrowRight"&&(N=Math.min(T.length-1,a+1)),s.key==="ArrowUp"&&(N=Math.max(0,a-7)),s.key==="ArrowDown"&&(N=Math.min(T.length-1,a+7)),q(N),x(Be(T[N])),setTimeout(()=>{const $=document.querySelectorAll('[data-calendar-cell="true"]');$[N]&&$[N].focus()},0)},[T,Me,q,x]);return z?e.jsxs("div",{className:"min-h-screen bg-muted",children:[e.jsx("div",{className:"sm:hidden fixed top-0 left-0 right-0 z-overlay border-b border-primary/15 bg-background/90 backdrop-blur-md",children:e.jsxs("div",{className:"mx-auto max-w-6xl px-3 py-2.5 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2.5",children:[e.jsx("div",{className:"h-7 w-7 rounded-lg bg-primary/20 animate-pulse"}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("div",{className:"h-4 w-12 rounded bg-muted animate-pulse"}),e.jsx("div",{className:"h-3 w-16 rounded bg-muted animate-pulse"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-9 w-9 rounded-xl bg-primary/5 animate-pulse"}),e.jsx("div",{className:"h-9 w-9 rounded-xl bg-primary/5 animate-pulse"})]})]})}),e.jsx("div",{className:"mx-auto max-w-6xl px-3 sm:px-4 pt-20 pb-5 sm:py-8",children:e.jsxs("div",{className:"mt-4 rounded-3xl border border-border bg-card overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-3 sm:px-5 py-3 border-b border-border",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"h-9 w-9 rounded-2xl bg-muted animate-pulse"}),e.jsx("div",{className:"h-9 w-9 rounded-2xl bg-muted animate-pulse"})]}),e.jsx("div",{className:"h-6 w-32 rounded bg-muted animate-pulse"}),e.jsx("div",{className:"h-9 w-9 rounded-2xl bg-muted animate-pulse"})]}),e.jsx("div",{className:"p-3 sm:p-5",children:e.jsxs("div",{className:"grid grid-cols-7 gap-1.5 sm:gap-2",children:[Array.from({length:7}).map((s,a)=>e.jsx("div",{className:"px-0.5 pb-1 flex justify-center",children:e.jsx("div",{className:"h-3 w-4 rounded bg-muted animate-pulse"})},`wh-${a}`)),Array.from({length:35}).map((s,a)=>e.jsx("div",{className:"aspect-square rounded-2xl bg-muted/50 animate-pulse"},`cs-${a}`))]})})]})})]}):le?e.jsxs("div",{className:"flex flex-col items-center justify-center p-8 text-center",children:[e.jsx(js,{className:"h-12 w-12 text-destructive mb-4"}),e.jsx("h3",{className:"font-semibold",children:"Impossible de charger les données"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:le.message}),e.jsx(Lt,{onClick:()=>Ne(),className:"mt-4",children:"Réessayer"})]}):e.jsxs("div",{className:"min-h-screen bg-muted",children:[e.jsx("div",{className:"sm:hidden fixed top-0 left-0 right-0 z-overlay border-b border-primary/15 bg-background/90 backdrop-blur-md",children:e.jsx("div",{className:"px-4 py-2.5 flex items-center justify-between",children:e.jsx(At,{globalKm:Fe,onSettings:()=>S(!0)})})}),e.jsx(Vs,{onRefresh:p,children:e.jsxs("div",{className:"mx-auto max-w-6xl px-3 sm:px-4 pt-20 pb-5 sm:py-8",children:[e.jsx("div",{className:"hidden sm:flex items-center justify-between",children:e.jsx(At,{globalKm:Fe,onSettings:()=>S(!0)})}),e.jsx(ys,{variant:"amber",icon:e.jsx(ft,{}),label:te?.name,badge:He===0?"Aujourd'hui":`J-${He}`,sublabel:te?.location,subbadge:Ie!=null&&Ie>0?`${Ie} séance${Ie>1?"s":""}`:void 0,visible:!!te&&He!=null,onClick:te?()=>f(`/competition/${te.id}`):void 0,className:"mt-4"}),e.jsx("div",{className:"mt-3 flex items-center gap-2",children:e.jsxs("button",{onClick:()=>f("/records"),className:"flex items-center gap-1.5 rounded-full border px-3 py-2 text-xs font-medium text-muted-foreground active:bg-muted",children:[e.jsx(ft,{className:"h-3.5 w-3.5"}),"Mes records"]})}),e.jsxs("div",{className:"mt-4 rounded-3xl border border-border bg-card overflow-hidden",children:[e.jsx(es,{monthCursor:E,selectedDayStatus:re,onPrevMonth:ot,onNextMonth:it,onJumpToday:Tt}),e.jsx(ts,{monthCursor:E,gridDates:T,completionByISO:ce,competitionDates:Pt,absenceDates:B,selectedISO:F,selectedDayIndex:U,today:he,onDayClick:Me,onKeyDown:Ht,onSwipeLeft:it,onSwipeRight:ot})]}),j&&e.jsx(Us,{userId:j,expanded:k,onToggle:()=>y(s=>!s)}),e.jsx(Vt,{open:R,onOpenChange:S,children:e.jsxs(Wt,{className:"max-w-sm rounded-2xl",children:[e.jsx(Xt,{children:e.jsx(Gt,{children:"Présence hebdo"})}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"Définis les créneaux attendus chaque semaine. Tu peux ensuite ajuster un jour précis dans le calendrier."}),e.jsx("div",{className:"space-y-2",children:Ws.map((s,a)=>{const u=kt.filter(N=>!!W?.[a]?.[N.key]).length;return e.jsxs("div",{className:"rounded-2xl border border-border bg-card px-3 py-3",children:[e.jsx("div",{className:"mb-2 flex items-center justify-between gap-3",children:e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold text-foreground",children:s}),e.jsx("div",{className:"text-[11px] text-muted-foreground",children:u===0?"Aucun créneau prévu":`${u} créneau${u>1?"x":""} attendu${u>1?"s":""}`})]})}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:kt.map(N=>{const $=!!W?.[a]?.[N.key];return e.jsxs("button",{type:"button",onClick:()=>zt(a,N.key),className:St("rounded-2xl border px-3 py-3 text-left transition",$?"border-foreground bg-foreground text-background":"border-border bg-card text-foreground hover:bg-muted"),"aria-label":`${s} ${N.label}`,children:[e.jsx("div",{className:"text-sm font-semibold",children:N.label}),e.jsx("div",{className:St("mt-1 text-[11px]",$?"text-background/80":"text-muted-foreground"),children:$?"Prévu":"Non prévu"})]},N.key)})})]},s)})}),e.jsxs("div",{className:"rounded-2xl border border-border bg-muted px-3 py-2",children:[e.jsx("div",{className:"text-xs font-semibold text-foreground",children:"Durée (valeur par défaut)"}),e.jsxs("div",{className:"mt-2 flex items-center gap-2",children:[e.jsx("button",{type:"button",className:"h-9 w-9 rounded-2xl border border-border bg-card hover:bg-muted flex items-center justify-center",onClick:()=>we(s=>Math.max(30,s-15)),"aria-label":"Diminuer la durée",children:e.jsx(Kt,{className:"h-4 w-4"})}),e.jsxs("div",{className:"text-sm font-semibold text-foreground",children:[_," min"]}),e.jsx("button",{type:"button",className:"h-9 w-9 rounded-2xl border border-border bg-card hover:bg-muted flex items-center justify-center",onClick:()=>we(s=>Math.min(240,s+15)),"aria-label":"Augmenter la durée",children:e.jsx(qe,{className:"h-4 w-4"})})]})]})]})]})}),e.jsx(zs,{open:D,selectedDate:Z,sessionsForSelectedDay:de,selectedDayStatus:re,dayKm:Se,activeSessionId:v,detailsOpen:I,draftState:O,saveState:h,isPending:G,logsBySessionId:l,onClose:Je,onDayOffAll:qt,onOpenSession:Ue,onCloseSession:()=>{g(null),L(!1)},onToggleDetails:()=>L(s=>!s),onMarkAbsent:$t,onMarkPresent:Bt,onClearOverride:Rt,onSaveFeedback:Qt,onDeleteFeedback:s=>{const a=l[s];a?.id&&(X.mutate(Number(a.id)),g(null),L(!1))},onDraftStateChange:Oe,getSessionStatus:ze,isAbsent:B.has(F),absenceReason:A.find(s=>s.date===F)?.reason??null,onMarkDayAbsent:s=>be.mutate({date:F,reason:s}),onRemoveDayAbsence:()=>ge.mutate(F)})]})})]})}export{On as default};
