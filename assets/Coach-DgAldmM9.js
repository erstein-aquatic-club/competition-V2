const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/CoachSwimmersOverview-CXjmVGYz.js","assets/vendor-query-DyA9aSKS.js","assets/vendor-react-BzrpNAyj.js","assets/api-B7ImV8IC.js","assets/index-D7hpDBzA.js","assets/vendor-charts-BrQ8X25f.js","assets/vendor-supabase-DFPLkPj_.js","assets/vendor-motion-lao-Njgm.js","assets/index-DKf75rHe.css","assets/swim-DudC2x7H.js","assets/badge-D3xS6Vxq.js","assets/arrow-left-2Jl5moJL.js","assets/select-DgrjNKLJ.js","assets/index-XYaf8yHV.js","assets/index-DS_zMBR9.js","assets/chevron-down-L1dqa1EK.js","assets/chevron-up-Bz2Y-fwe.js","assets/zap-BACMecjy.js","assets/message-square-BbPa4ERk.js","assets/trophy-EKqk2U4W.js","assets/clock-CPVrmjxS.js","assets/search-Crq7H5mm.js","assets/bell-ring-CmABvGRe.js","assets/chevron-right-WO7f7GHk.js","assets/CoachMessagesScreen-Ditj5unZ.js","assets/textarea-b7qBr0nF.js","assets/CoachSmsScreen-BX1lyhOU.js","assets/command-adbAl17i.js","assets/index-CVGFITFg.js","assets/dialog-DNlEcSVG.js","assets/smsUtils-DOdkjnTX.js","assets/copy-BqRF8uEk.js","assets/CoachCalendar-DbU9O6LV.js","assets/CalendarGrid-BPGzkLyN.js","assets/chevron-left-DfI80S7k.js","assets/toggle-group-JiCJ_LzO.js","assets/index-6OQJx_vN.js","assets/sheet-Cf7oniDV.js","assets/InlineBanner-DtI-hilX.js","assets/circle-alert-BIZgFBht.js","assets/trash-2-B4VR2VHp.js","assets/CoachGroupsScreen-DKLCiM2J.js","assets/checkbox-BIGrdmGw.js","assets/separator-p2ixmulS.js","assets/alert-dialog-C6fy-dQx.js","assets/collapsible-G8_Y4P4k.js","assets/user-plus-DsQcj5qN.js","assets/power-CJmTMBRo.js","assets/CoachCompetitionsScreen-DQRqdyjP.js","assets/CoachObjectivesScreen-Deb_C_Q-.js","assets/objectiveHelpers-D7Sv8PWO.js","assets/CoachTrainingSlotsScreen-cMWxDip1.js","assets/radio-group-DgzfWKtO.js","assets/circle-DGRET_mI.js","assets/map-pin-DZedMM3L.js","assets/CoachSwimmerDetail-0KC76_dn.js","assets/tabs-B5VLlfn1.js","assets/weekTypeColor-Tu6nBfuz.js","assets/chart-column-DIdaRLZ1.js","assets/date-DrpgLmFD.js","assets/vendor-date-B8Mnp-Vt.js","assets/pencil-DRgJI-uL.js","assets/StrengthCatalog-Iw-JLrqM.js","assets/SessionListView-l0m-0P89.js","assets/play-pVSPz-Kx.js","assets/save-C9v8CwoQ.js","assets/share-2-CeG7x1uO.js","assets/drawer-Dt2LifoE.js","assets/loader-circle-BMwquRl_.js","assets/pen-Dd9IfmHD.js","assets/SwimCatalog-xKMmSyka.js","assets/SwimSessionTimeline-CzIWg6TT.js","assets/SwimTimeInput-C1J0zB3A.js","assets/timer-DQ64iRN_.js","assets/eye-BzCG-qgj.js","assets/sparkles-CL8beQ9H.js"])))=>i.map(i=>d[i]);
import{c as U,B as z,f as $,R as ge,u as W,b as fe,C as be,g as je,i as ye,U as ae,j as ve,e as Ne,k as q,l as v,I as we,W as Z,D as ke,_ as N}from"./index-D7hpDBzA.js";import{j as e,r as i,u as C}from"./vendor-query-DyA9aSKS.js";import{g as _e,b as Ce,c as Se,a as F}from"./api-B7ImV8IC.js";import{A as Ae}from"./arrow-left-2Jl5moJL.js";import{B as Ee}from"./badge-D3xS6Vxq.js";import{S as De,a as Te,b as Le,c as Fe,d as Me}from"./select-DgrjNKLJ.js";import{C as ne,Z as Re}from"./zap-BACMecjy.js";import{M as Ie}from"./message-square-BbPa4ERk.js";import{T as O}from"./trophy-EKqk2U4W.js";import{C as re}from"./clock-CPVrmjxS.js";import{S as Oe}from"./search-Crq7H5mm.js";import{B as ee}from"./bell-ring-CmABvGRe.js";import{C as I}from"./chevron-right-WO7f7GHk.js";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Be=[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]],Pe=U("funnel",Be);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $e=[["path",{d:"M2 9.5a5.5 5.5 0 0 1 9.591-3.676.56.56 0 0 0 .818 0A5.49 5.49 0 0 1 22 9.5c0 2.29-1.5 4-3 5.5l-5.492 5.313a2 2 0 0 1-3 .019L5 15c-1.5-1.5-3-3.2-3-5.5",key:"mvr1a0"}],["path",{d:"M3.22 13H9.5l.5-1 2 4.5 2-7 1.5 3.5h5.27",key:"auskq0"}]],te=U("heart-pulse",$e);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ze=[["path",{d:"M18 21a8 8 0 0 0-16 0",key:"3ypg7q"}],["circle",{cx:"10",cy:"8",r:"5",key:"o932ke"}],["path",{d:"M22 20c0-3.37-2-6.5-4-8a5 5 0 0 0-.45-8.3",key:"10s06x"}]],qe=U("users-round",ze),H=({title:t,description:r,onBack:s,actions:a})=>e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs(z,{variant:"ghost",size:"sm",className:"-ml-2",onClick:s,children:[e.jsx(Ae,{className:"mr-2 h-4 w-4"}),"Retour"]}),e.jsx("h2",{className:"text-2xl font-display font-semibold uppercase italic text-primary",children:t}),r?e.jsx("p",{className:"text-sm text-muted-foreground",children:r}):null]}),a?e.jsx("div",{className:"flex items-center gap-2",children:a}):null]}),Ve={draft_athlete:"En attente nageur",draft_coach:"En attente coach",sent:"Envoyé, à signer"};function Q(t,r){const s=new Date(t),a=new Date(r),l=s.getTime()-a.getTime(),x=Math.ceil(l/(1e3*60*60*24));return x<0?"overdue":x<=7?"imminent":x<=30?"upcoming":"future"}function Ke(t,r){return t.map(s=>({id:`comp-${s.id}`,type:"competition",date:s.date,title:s.name,subtitle:s.location??void 0,urgency:Q(s.date,r),metadata:{...s}}))}function He(t,r){return t.map(s=>({id:`intv-${s.id}`,type:"interview",date:s.date,title:`Entretien : ${s.athlete_name}`,subtitle:Ve[s.status]??s.status,athleteName:s.athlete_name,athleteId:s.athlete_id,urgency:Q(s.date,r),metadata:{...s}}))}function Ge(t,r){return t.filter(s=>s.end_competition_date!=null).map(s=>({id:`cycle-${s.id}`,type:"cycle_end",date:s.end_competition_date,title:`Fin cycle : ${s.name}`,subtitle:s.end_competition_name??void 0,athleteId:s.athlete_id??void 0,urgency:Q(s.end_competition_date,r),metadata:{...s}}))}function Ue(t){return[...t].sort((r,s)=>new Date(r.date).getTime()-new Date(s.date).getTime())}function Qe(t,r){return r==="all"?t:t.filter(s=>s.type===r)}function Ye(t,r,s){if(r===0)return t;const a=new Date(s);return a.setDate(a.getDate()+r),t.filter(l=>new Date(l.date)<=a)}function Xe(){const[t,r]=i.useState("all"),[s,a]=i.useState(30),l=i.useMemo(()=>new Date().toISOString().slice(0,10),[]),x=C({queryKey:["coach-events-competitions"],queryFn:_e}),u=C({queryKey:["coach-events-interviews"],queryFn:Ce}),d=C({queryKey:["coach-events-cycles"],queryFn:()=>Se()}),o=x.isLoading||u.isLoading||d.isLoading,j=i.useMemo(()=>{const g=Ke(x.data??[],l),w=He(u.data??[],l),f=Ge(d.data??[],l);return Ue([...g,...w,...f])},[x.data,u.data,d.data,l]),k=i.useMemo(()=>{let g=Qe(j,t);return g=Ye(g,s,l),g},[j,t,s,l]),S=i.useMemo(()=>{const g={competition:0,interview:0,cycle_end:0,total:0};for(const w of j)g[w.type]++,g.total++;return g},[j]);return{events:k,isLoading:o,typeFilter:t,setTypeFilter:r,periodDays:s,setPeriodDays:a,counts:S}}const Je={competition:{icon:O,label:"Compétition",dotColor:"bg-blue-500",glowColor:"shadow-[0_0_8px_rgba(59,130,246,0.5)]",accentBorder:"border-l-blue-500",accentBg:"bg-blue-500/5 dark:bg-blue-500/10"},interview:{icon:Ie,label:"Entretien",dotColor:"bg-amber-500",glowColor:"shadow-[0_0_8px_rgba(245,158,11,0.5)]",accentBorder:"border-l-amber-500",accentBg:"bg-amber-500/5 dark:bg-amber-500/10"},cycle_end:{icon:ge,label:"Fin de cycle",dotColor:"bg-violet-500",glowColor:"shadow-[0_0_8px_rgba(139,92,246,0.5)]",accentBorder:"border-l-violet-500",accentBg:"bg-violet-500/5 dark:bg-violet-500/10"}},We={overdue:{label:"En retard",className:"bg-red-500/10 text-red-600 dark:text-red-400 border-red-500/20",icon:re},imminent:{label:"Imminent",className:"bg-amber-500/10 text-amber-600 dark:text-amber-400 border-amber-500/20"},upcoming:{label:"À venir",className:"bg-sky-500/10 text-sky-600 dark:text-sky-400 border-sky-500/20"},future:{label:"Futur",className:"bg-muted text-muted-foreground border-border"}},Ze=[{value:"7",label:"7j"},{value:"30",label:"30j"},{value:"90",label:"90j"},{value:"0",label:"Tout"}],et=[{value:"all",label:"Tout"},{value:"competition",label:"Compétitions",dotClass:"bg-blue-500"},{value:"interview",label:"Entretiens",dotClass:"bg-amber-500"},{value:"cycle_end",label:"Cycles",dotClass:"bg-violet-500"}],tt=["Janvier","Février","Mars","Avril","Mai","Juin","Juillet","Août","Septembre","Octobre","Novembre","Décembre"];function st(t){const r=new Date(t);return`${r.getFullYear()}-${String(r.getMonth()).padStart(2,"0")}`}function at(t){const r=new Date(t);return`${tt[r.getMonth()]} ${r.getFullYear()}`}function nt(t){const r=new Map;for(const s of t){const a=st(s.date);r.has(a)||r.set(a,{label:at(s.date),events:[]}),r.get(a).events.push(s)}return Array.from(r.entries()).map(([s,a])=>({monthKey:s,...a}))}function rt({event:t,isLast:r}){const s=Je[t.type],a=We[t.urgency],l=s.icon,x=new Date(t.date).toLocaleDateString("fr-FR",{weekday:"short",day:"numeric",month:"short"});return e.jsxs("div",{className:"relative flex gap-4 group",children:[e.jsxs("div",{className:"relative flex flex-col items-center",children:[e.jsx("div",{className:`
            relative z-10 flex h-9 w-9 shrink-0 items-center justify-center
            rounded-full ${s.dotColor} text-white
            ${s.glowColor}
            transition-shadow duration-300 group-hover:shadow-lg
          `,children:e.jsx(l,{className:"h-4 w-4"})}),!r&&e.jsx("div",{className:"w-px flex-1 bg-border"})]}),e.jsxs("div",{className:`
          flex-1 mb-4 rounded-xl border border-border/60
          ${s.accentBg}
          border-l-[3px] ${s.accentBorder}
          p-3.5
          shadow-sm dark:shadow-none
          transition-all duration-200
          group-hover:shadow-md group-hover:border-border
        `,children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-sm font-semibold text-foreground leading-snug",children:t.title}),t.subtitle&&e.jsx("p",{className:"text-xs text-muted-foreground mt-0.5 leading-relaxed",children:t.subtitle})]}),e.jsx(Ee,{variant:"outline",className:`shrink-0 text-[10px] leading-none px-2 py-0.5 font-medium ${a.className}`,children:a.label})]}),e.jsxs("div",{className:"flex items-center gap-1.5 mt-2 text-xs text-muted-foreground",children:[e.jsx(ne,{className:"h-3 w-3 opacity-50"}),e.jsx("span",{className:"capitalize",children:x})]})]})]})}function lt({label:t}){return e.jsxs("div",{className:"relative flex items-center gap-4 pt-2 pb-1",children:[e.jsx("div",{className:"flex items-center justify-center w-9",children:e.jsx("div",{className:"h-2.5 w-2.5 rounded-full bg-border"})}),e.jsx("span",{className:"text-[11px] font-bold uppercase tracking-[0.15em] text-muted-foreground",style:{fontFamily:"var(--font-display, 'Oswald', sans-serif)"},children:t}),e.jsx("div",{className:"flex-1 h-px bg-border/50"})]})}function it(){return e.jsx("div",{className:"space-y-5 ml-0.5",children:[1,2,3].map(t=>e.jsxs("div",{className:"flex gap-4 animate-pulse motion-reduce:animate-none",children:[e.jsx($,{className:"h-9 w-9 rounded-full shrink-0"}),e.jsxs("div",{className:"flex-1 space-y-2.5 pt-1",children:[e.jsx($,{className:"h-4 w-3/4 rounded-md"}),e.jsx($,{className:"h-3 w-1/2 rounded-md"}),e.jsx($,{className:"h-3 w-1/3 rounded-md"})]})]},t))})}function ot(){const{events:t,isLoading:r,typeFilter:s,setTypeFilter:a,periodDays:l,setPeriodDays:x,counts:u}=Xe(),d=nt(t);return e.jsxs("div",{className:"mx-auto w-full max-w-2xl space-y-5",children:[e.jsxs("div",{className:"flex items-baseline justify-between",children:[e.jsx("h2",{className:"text-xl font-bold tracking-tight text-foreground",style:{fontFamily:"var(--font-display, 'Oswald', sans-serif)"},children:"Échéances"}),u.total>0&&e.jsxs("span",{className:"text-xs tabular-nums text-muted-foreground",children:[u.total," événement",u.total!==1?"s":""]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(Pe,{className:"h-3.5 w-3.5 text-muted-foreground shrink-0"}),e.jsx("div",{className:"flex gap-1",children:et.map(o=>e.jsxs("button",{onClick:()=>a(o.value),className:`
                  flex items-center gap-1.5
                  rounded-full min-h-[36px] px-3 py-1.5
                  text-xs font-medium transition-all duration-150
                  active:scale-95
                  ${s===o.value?"bg-foreground text-background shadow-sm":"bg-muted/70 text-muted-foreground hover:bg-muted"}
                `,children:[o.dotClass&&e.jsx("span",{className:`inline-block h-1.5 w-1.5 rounded-full ${o.dotClass}`}),o.label,o.value!=="all"&&u[o.value]>0&&e.jsx("span",{className:"opacity-50 tabular-nums",children:u[o.value]})]},o.value))})]}),e.jsxs(De,{value:String(l),onValueChange:o=>x(Number(o)),children:[e.jsx(Te,{className:"h-9 w-20 text-xs rounded-full border-border/50",children:e.jsx(Le,{})}),e.jsx(Fe,{children:Ze.map(o=>e.jsx(Me,{value:o.value,children:o.label},o.value))})]})]}),r?e.jsx(it,{}):t.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-16 text-center",children:[e.jsx("div",{className:"flex h-14 w-14 items-center justify-center rounded-2xl bg-muted/50 mb-4",children:e.jsx(ne,{className:"h-7 w-7 text-muted-foreground/40"})}),e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Aucune échéance à venir"}),e.jsx("p",{className:"text-xs text-muted-foreground/60 mt-1",children:"Les compétitions, entretiens et fins de cycles apparaîtront ici"})]}):e.jsx("div",{className:"relative",children:d.map((o,j)=>e.jsxs("div",{children:[e.jsx(lt,{label:o.label}),o.events.map((k,S)=>e.jsx(rt,{event:k,isLast:j===d.length-1&&S===o.events.length-1},k.id))]},o.monthKey))})]})}const ct=i.lazy(()=>N(()=>import("./CoachSwimmersOverview-CXjmVGYz.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23]))),dt=i.lazy(()=>N(()=>import("./CoachMessagesScreen-Ditj5unZ.js"),__vite__mapDeps([24,1,2,3,4,5,6,7,8,9,25,12,13,14,15,16,22,11,10,17,18,19,20,21,23]))),mt=i.lazy(()=>N(()=>import("./CoachSmsScreen-BX1lyhOU.js"),__vite__mapDeps([26,1,2,4,5,6,7,8,10,25,27,14,28,29,21,30,31,3,9,11,12,13,15,16,17,18,19,20,22,23]))),ut=i.lazy(()=>N(()=>import("./CoachCalendar-DbU9O6LV.js"),__vite__mapDeps([32,1,2,33,34,4,5,6,7,8,23,19,3,9,12,13,14,15,16,35,36,37,28,38,39,40,11,10,17,18,20,21,22]))),xt=i.lazy(()=>N(()=>import("./CoachGroupsScreen-DKLCiM2J.js"),__vite__mapDeps([41,1,2,3,4,5,6,7,8,9,10,42,12,13,14,15,16,43,37,28,44,45,11,46,47,40,17,18,19,20,21,22,23]))),ht=i.lazy(()=>N(()=>import("./CoachCompetitionsScreen-DQRqdyjP.js"),__vite__mapDeps([48,1,2,3,4,5,6,7,8,9,25,37,28,14,44,42,12,13,15,16,19,11,10,17,18,20,21,22,23]))),pt=i.lazy(()=>N(()=>import("./CoachObjectivesScreen-Deb_C_Q-.js"),__vite__mapDeps([49,1,2,3,4,5,6,7,8,9,25,10,12,13,14,15,16,35,36,37,28,44,50,11,17,18,19,20,21,22,23]))),gt=i.lazy(()=>N(()=>import("./CoachTrainingSlotsScreen-cMWxDip1.js"),__vite__mapDeps([51,1,2,3,4,5,6,7,8,9,10,43,37,28,14,44,12,13,15,16,52,36,53,34,23,20,54,40,11,17,18,19,21,22]))),ft=i.lazy(()=>N(()=>import("./CoachSwimmerDetail-0KC76_dn.js"),__vite__mapDeps([55,1,2,4,5,6,7,8,3,9,56,36,13,10,57,58,15,25,12,14,16,35,37,28,44,50,40,59,60,31,61,45,30,18,20,23,19,54,11]))),bt=i.lazy(()=>N(()=>import("./StrengthCatalog-Iw-JLrqM.js"),__vite__mapDeps([62,1,2,3,4,5,6,7,8,9,52,36,13,12,14,15,16,53,25,29,28,42,44,56,63,34,64,65,23,39,61,66,40,67,27,21,68,69,11,10,17,18,19,20,22]))),jt=i.lazy(()=>N(()=>import("./SwimCatalog-xKMmSyka.js"),__vite__mapDeps([70,1,2,3,4,5,6,7,8,9,29,28,14,44,23,71,72,16,73,74,15,20,63,34,64,65,13,36,53,39,61,66,40,25,12,31,75,59,60,21])));function G({children:t}){return e.jsxs("div",{className:"flex items-center gap-3 pb-0.5",children:[e.jsx("span",{className:"text-[9px] font-black uppercase tracking-[0.28em] text-muted-foreground/70",children:t}),e.jsx("div",{className:"flex-1 h-px bg-border/50"})]})}function yt({score:t}){if(t==null)return null;const r=Math.round(t),s=t>=3.5?"bg-emerald-500":t>=2.5?"bg-amber-500":"bg-red-500";return e.jsx("div",{className:"flex items-center gap-0.5",children:Array.from({length:5}).map((a,l)=>e.jsx("div",{className:`h-1.5 w-1.5 rounded-full ${l<r?s:"bg-muted"}`},l))})}const vt=({onNavigate:t,onOpenRecordsAdmin:r,onOpenRecordsClub:s,onOpenAthlete:a,athletes:l,athletesLoading:x,kpiLoading:u,fatigueAlerts:d,mostLoadedAthlete:o,formeScores:j,swimSessionCount:k,strengthSessionCount:S})=>{const g=new Date().toLocaleDateString("fr-FR",{weekday:"long",day:"numeric",month:"long"}),[w,f]=i.useState(""),y=i.useDeferredValue(w.trim().toLocaleLowerCase("fr-FR")),E=i.useMemo(()=>y?l.filter(n=>{const h=n.display_name.toLocaleLowerCase("fr-FR"),A=n.group_label?.toLocaleLowerCase("fr-FR")??"";return h.includes(y)||A.includes(y)}).slice(0,6):l.slice(0,5),[l,y]),p=d.length>0,_={label:"Créer une séance",detail:"Natation · Explorer la bibliothèque",action:()=>t("swim")},B=[{label:"Natation",icon:Z,action:()=>t("swim"),color:"text-cyan-500"},{label:"Muscu",icon:ke,action:()=>t("strength"),color:"text-violet-500"},{label:"Groupes",icon:qe,action:()=>t("groups"),color:"text-emerald-500"},{label:"Compétitions",icon:O,action:()=>t("competitions"),color:"text-amber-500"},{label:"Échéances",icon:q,action:()=>t("deadlines"),color:"text-orange-500"},{label:"Créneaux",icon:re,action:()=>t("training-slots"),color:"text-blue-500"},{label:"SMS",icon:ee,action:()=>t("sms"),color:"text-rose-500"},{label:"Records",icon:O,action:s,color:"text-orange-500"},{label:"Admin rec.",icon:O,action:r,color:"text-slate-500"}];return e.jsxs("div",{className:"space-y-5 pb-24",children:[e.jsx("style",{children:`
        @keyframes cta-breathe {
          0%, 100% { opacity: 0.55; transform: scale(1); }
          50%       { opacity: 0.85; transform: scale(1.06); }
        }
        @keyframes cta-breathe-alert {
          0%, 100% { opacity: 0.45; }
          50%       { opacity: 0.85; }
        }
        @keyframes shimmer-slide {
          0%   { transform: translateX(-100%) skewX(-12deg); }
          100% { transform: translateX(300%) skewX(-12deg); }
        }
        .cta-glow     { animation: cta-breathe 3.5s ease-in-out infinite; }
        .cta-glow-alert { animation: cta-breathe-alert 1.4s ease-in-out infinite; }
        .cta-shimmer  { animation: shimmer-slide 2.8s ease-in-out infinite 0.8s; }
      `}),e.jsxs("div",{className:"sticky top-0 z-20 -mx-4 border-b bg-background/95 px-4 py-3 backdrop-blur",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:()=>t("home"),className:"shrink-0 rounded-full border px-3 py-2 text-sm font-semibold active:bg-muted",children:"Aujourd'hui"}),e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Oe,{className:"pointer-events-none absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(we,{value:w,onChange:n=>f(n.target.value),placeholder:"Rechercher un nageur",className:"h-10 rounded-full pl-9"})]}),e.jsx(z,{size:"sm",className:"shrink-0 rounded-full",onClick:()=>t("messaging"),children:"Message"})]}),e.jsx("p",{className:"mt-2 text-[11px] uppercase tracking-[0.18em] text-muted-foreground capitalize",children:g})]}),e.jsxs("section",{className:"space-y-2.5",children:[e.jsx(G,{children:"Le Quotidien"}),e.jsxs("button",{type:"button",onClick:_.action,className:["relative w-full overflow-hidden rounded-3xl text-white transition-all duration-200 active:scale-[0.97]",p?"bg-gradient-to-br from-rose-500 via-red-500 to-orange-500":"bg-gradient-to-br from-primary via-primary/80 to-primary/60"].join(" "),children:[e.jsx("div",{className:p?"cta-glow-alert absolute inset-0":"cta-glow absolute inset-0",style:{background:p?"radial-gradient(ellipse at 20% 60%, rgba(255,80,60,0.6) 0%, transparent 65%)":"radial-gradient(ellipse at 20% 60%, rgba(255,255,255,0.2) 0%, transparent 65%)"}}),e.jsx("div",{className:"cta-shimmer absolute top-0 bottom-0 left-0 w-1/3 pointer-events-none",style:{background:"linear-gradient(90deg, transparent, rgba(255,255,255,0.12), transparent)"}}),e.jsxs("div",{className:"relative flex items-center gap-4 px-6 py-7",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[p&&e.jsxs("div",{className:"mb-2.5 inline-flex items-center gap-1.5 rounded-full bg-white/20 px-2.5 py-1",children:[e.jsxs("span",{className:"relative flex h-2 w-2",children:[e.jsx("span",{className:"absolute inline-flex h-full w-full animate-ping rounded-full bg-white opacity-75"}),e.jsx("span",{className:"relative inline-flex h-2 w-2 rounded-full bg-white"})]}),e.jsx("span",{className:"text-[9px] font-black uppercase tracking-[0.22em]",children:"Attention requise"})]}),e.jsx("p",{className:"text-[1.6rem] font-bold leading-tight tracking-tight",children:_.label}),e.jsx("p",{className:"mt-1.5 text-sm opacity-75",children:_.detail})]}),e.jsx("div",{className:"flex h-14 w-14 shrink-0 items-center justify-center rounded-2xl bg-white/15 backdrop-blur-sm border border-white/20",children:p?e.jsx(te,{className:"h-7 w-7 animate-pulse"}):e.jsx(Z,{className:"h-7 w-7"})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("button",{type:"button",onClick:()=>t("objectives"),className:"flex items-center gap-2.5 rounded-2xl border bg-card px-4 py-3.5 text-left transition-colors active:bg-muted",children:[e.jsx("div",{className:"flex h-8 w-8 shrink-0 items-center justify-center rounded-xl bg-amber-100 dark:bg-amber-900/30",children:e.jsx(O,{className:"h-4 w-4 text-amber-600 dark:text-amber-400"})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-sm font-semibold",children:"Objectifs"}),e.jsx("p",{className:"text-[11px] text-muted-foreground",children:"Temps cibles"})]})]}),e.jsxs("button",{type:"button",onClick:()=>t("messaging"),className:"flex items-center gap-2.5 rounded-2xl border bg-card px-4 py-3.5 text-left transition-colors active:bg-muted",children:[e.jsx("div",{className:"flex h-8 w-8 shrink-0 items-center justify-center rounded-xl bg-blue-100 dark:bg-blue-900/30",children:e.jsx(ee,{className:"h-4 w-4 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-sm font-semibold",children:"Message"}),e.jsx("p",{className:"text-[11px] text-muted-foreground",children:"Notifier un groupe"})]})]})]})]}),e.jsxs("section",{className:"space-y-2.5",children:[e.jsx(G,{children:"Tour de Contrôle"}),e.jsxs("div",{className:["rounded-3xl border p-4 space-y-3 transition-colors",p?"border-red-200 bg-red-50/70 dark:border-red-900/50 dark:bg-red-950/25":"bg-card border-border"].join(" "),children:[p&&!u&&e.jsx("div",{className:"space-y-1.5",children:d.map(n=>e.jsxs("button",{type:"button",onClick:()=>t("swimmers"),className:"flex w-full items-center gap-3 rounded-2xl bg-white/70 dark:bg-black/20 px-3.5 py-2.5 text-left transition-colors active:bg-white/90",children:[e.jsxs("span",{className:"relative flex h-3 w-3 shrink-0",children:[e.jsx("span",{className:"absolute inline-flex h-full w-full animate-ping rounded-full bg-red-400 opacity-60"}),e.jsx("span",{className:"relative inline-flex h-3 w-3 rounded-full bg-red-500"})]}),e.jsx("span",{className:"flex-1 text-sm font-semibold text-red-900 dark:text-red-200",children:n.athleteName}),e.jsx("span",{className:"text-[9px] font-black uppercase tracking-widest text-red-600 dark:text-red-400",children:"Fatigue max"}),e.jsx(I,{className:"h-3.5 w-3.5 text-red-400"})]},n.athleteName))}),e.jsxs("div",{className:"grid grid-cols-2 gap-2.5",children:[e.jsxs("div",{className:["rounded-2xl p-3.5",p?"bg-white/50 dark:bg-black/20":"bg-muted/40"].join(" "),children:[e.jsxs("div",{className:"mb-2 flex items-center gap-1.5",children:[e.jsx(te,{className:`h-3.5 w-3.5 ${d.length>0?"text-red-500":"text-muted-foreground"}`}),e.jsx("span",{className:"text-[9px] font-bold uppercase tracking-[0.18em] text-muted-foreground",children:"Alertes"})]}),e.jsx("p",{className:`text-4xl font-black tabular-nums leading-none ${d.length>0?"text-red-600 dark:text-red-400":"text-foreground"}`,children:u?"–":d.length}),e.jsx("p",{className:"mt-1.5 text-[11px] text-muted-foreground truncate",children:u?"Calcul…":d.length>0?d.slice(0,2).map(n=>n.athleteName.split(" ")[0]).join(", "):"Aucune alerte"})]}),e.jsxs("div",{className:["rounded-2xl p-3.5",p?"bg-white/50 dark:bg-black/20":"bg-muted/40"].join(" "),children:[e.jsxs("div",{className:"mb-2 flex items-center gap-1.5",children:[e.jsx(Re,{className:"h-3.5 w-3.5 text-muted-foreground"}),e.jsx("span",{className:"text-[9px] font-bold uppercase tracking-[0.18em] text-muted-foreground",children:"Plus chargé"})]}),e.jsx("p",{className:"text-2xl font-black truncate leading-none",children:u?"–":o?.athleteName?.split(" ")[0]??"–"}),e.jsx("p",{className:"mt-1.5 text-[11px] text-muted-foreground",children:u?"Calcul…":o?`Charge ${Math.round(o.loadScore)}`:"Pas de données"})]})]})]})]}),e.jsxs("section",{className:"space-y-2.5",children:[e.jsxs("div",{className:"flex items-center gap-3 pb-0.5",children:[e.jsx("span",{className:"text-[9px] font-black uppercase tracking-[0.28em] text-muted-foreground/70",children:"Nageurs"}),e.jsx("div",{className:"flex-1 h-px bg-border/50"}),w?e.jsx("button",{type:"button",onClick:()=>f(""),className:"text-[10px] font-bold text-primary",children:"Effacer"}):e.jsxs("button",{type:"button",onClick:()=>t("swimmers"),className:"flex items-center gap-0.5 text-[10px] font-bold text-primary",children:["Tous ",e.jsx(I,{className:"h-3 w-3"})]})]}),e.jsx("div",{className:"overflow-hidden rounded-3xl border bg-card shadow-sm",children:x?e.jsx("div",{className:"divide-y divide-border/60",children:[1,2,3,4].map(n=>e.jsxs("div",{className:"flex items-center gap-3 px-4 py-3.5",children:[e.jsx("div",{className:"h-9 w-9 animate-pulse rounded-full bg-muted"}),e.jsxs("div",{className:"flex-1 space-y-1.5",children:[e.jsx("div",{className:"h-3.5 w-28 animate-pulse rounded bg-muted"}),e.jsx("div",{className:"h-3 w-18 animate-pulse rounded bg-muted"})]})]},n))}):E.length===0?e.jsx("p",{className:"px-4 py-8 text-center text-sm text-muted-foreground",children:"Aucun nageur trouvé."}):e.jsx("div",{className:"divide-y divide-border/60",children:E.map(n=>{const h=d.some(M=>M.athleteName===n.display_name),A=n.display_name.charAt(0).toUpperCase(),P=n.id!=null?j.get(n.id)??null:null;return e.jsxs("button",{type:"button",onClick:()=>a(n),className:"flex w-full items-center gap-3 px-4 py-3.5 text-left transition-colors active:bg-muted",children:[n.avatar_url?e.jsx("img",{src:n.avatar_url,alt:"",className:["h-9 w-9 shrink-0 rounded-full object-cover border",h?"border-red-400/60 ring-2 ring-red-400/60 ring-offset-1":"border-border"].join(" ")}):e.jsx("div",{className:["flex h-9 w-9 shrink-0 items-center justify-center rounded-full text-sm font-bold transition-all",h?"bg-red-100 text-red-700 dark:bg-red-900/40 dark:text-red-400 ring-2 ring-red-400/60 ring-offset-1":"bg-primary/10 text-primary"].join(" "),children:A}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"truncate text-sm font-semibold",children:n.display_name}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"truncate text-[11px] text-muted-foreground",children:n.group_label||"Sans groupe"}),P!=null&&e.jsx(yt,{score:P})]})]}),h?e.jsxs("span",{className:"inline-flex shrink-0 items-center gap-1 rounded-full bg-red-100 px-2.5 py-1 text-[9px] font-black uppercase tracking-widest text-red-600 dark:bg-red-900/30 dark:text-red-400",children:[e.jsx("span",{className:"h-1.5 w-1.5 animate-pulse rounded-full bg-current"}),"Alerte"]}):e.jsx(I,{className:"h-4 w-4 shrink-0 text-muted-foreground"})]},n.id??n.display_name)})})})]}),e.jsxs("section",{className:"space-y-2.5",children:[e.jsx(G,{children:"Arsenal"}),e.jsxs("div",{className:"space-y-2 rounded-3xl border bg-card p-3 shadow-sm",children:[e.jsxs("button",{type:"button",onClick:()=>t("calendar"),className:"flex w-full items-center gap-3 rounded-2xl bg-muted/40 px-4 py-3.5 text-left transition-colors active:bg-muted",children:[e.jsx("div",{className:"flex h-9 w-9 shrink-0 items-center justify-center rounded-xl bg-violet-100 dark:bg-violet-900/30",children:e.jsx(q,{className:"h-4.5 w-4.5 text-violet-600 dark:text-violet-400"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-sm font-semibold",children:"Calendrier · Assigner"}),e.jsxs("p",{className:"text-[11px] text-muted-foreground",children:[k??0," séances nat · ",S??0," muscu"]})]}),e.jsx(I,{className:"h-4 w-4 shrink-0 text-muted-foreground"})]}),e.jsx("div",{className:"grid grid-cols-4 gap-1.5",children:B.map(n=>e.jsxs("button",{type:"button",onClick:n.action,className:"flex flex-col items-center gap-1.5 rounded-2xl border bg-card px-1.5 py-3 text-center transition-colors active:bg-muted",children:[e.jsx(n.icon,{className:`h-4.5 w-4.5 ${n.color}`}),e.jsx("span",{className:"text-[9px] font-semibold leading-tight text-muted-foreground",children:n.label})]},n.label))}),e.jsxs("button",{type:"button",onClick:()=>t("swimmers"),className:"flex w-full items-center gap-3 rounded-2xl bg-muted/40 px-4 py-3.5 text-left transition-colors active:bg-muted",children:[e.jsx("div",{className:"flex h-9 w-9 shrink-0 items-center justify-center rounded-xl bg-blue-100 dark:bg-blue-900/30",children:e.jsx(ae,{className:"h-4.5 w-4.5 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-sm font-semibold",children:"Voir tous les nageurs"}),e.jsx("p",{className:"text-[11px] text-muted-foreground",children:x?"Chargement…":`${l.length} nageur${l.length>1?"s":""}`})]}),e.jsx(I,{className:"h-4 w-4 shrink-0 text-muted-foreground"})]})]})]})]})},se=t=>t.toISOString().split("T")[0],Nt=t=>new Date(t.completed_at||t.started_at||t.date||t.created_at||0).getTime(),wt=t=>{if(!t.length)return null;const r=t.reduce((a,l)=>a+l,0)/t.length,s=Math.min(5,Math.max(1,Math.round(r)));return{average:r,rating:s}};function kt(){const t=W(n=>n.role),r=W(n=>n.setSelectedAthlete),[,s]=fe(),[a,l]=i.useState(()=>window.location.hash.match(/[?&]section=([^&]+)/)?.[1]||"home"),x=7,[u,d]=i.useState(null);i.useEffect(()=>{const n="/coach",h=a&&a!=="home"?`#${n}?section=${a}`:`#${n}`;window.location.hash!==h&&window.history.replaceState(null,"",h)},[a]),i.useEffect(()=>{const n=()=>{l("home"),d(null)};return window.addEventListener("nav:reset",n),()=>window.removeEventListener("nav:reset",n)},[]),i.useEffect(()=>{const n=h=>{const A=h.detail;l(A),d(null)};return window.addEventListener("nav:section",n),()=>window.removeEventListener("nav:section",n)},[]);const o=t==="coach"||t==="admin",j=a==="home"||a==="calendar",k=a==="home"||a==="messaging"||a==="sms"||a==="swimmers"||a==="athlete"||a==="calendar"||a==="groups"||a==="objectives",S=a==="messaging"||a==="sms"||a==="calendar"||a==="groups"||a==="training-slots",{data:g}=C({queryKey:["swim_catalog"],queryFn:()=>F.getSwimCatalog(),enabled:o&&j}),{data:w}=C({queryKey:["strength_catalog"],queryFn:()=>F.getStrengthSessions(),enabled:o&&j}),{data:f=[],isLoading:y}=C({queryKey:["athletes"],queryFn:()=>F.getAthletes(),enabled:o&&k}),E=i.useMemo(()=>f.slice(0,5),[f]),{data:p=[]}=C({queryKey:["groups"],queryFn:()=>F.getGroups(),enabled:o&&S}),_=C({queryKey:["coach-kpis",x,E.map(n=>n.id??n.display_name)],enabled:o&&a==="home"&&E.length>0,queryFn:async()=>{const n=x,h=new Date;h.setDate(h.getDate()-n);const A=se(h),P=se(new Date),M=await Promise.all(E.map(async m=>{const[V,oe]=await Promise.all([F.getSessions(m.display_name,m.id),F.getStrengthHistory(m.display_name,{athleteId:m.id,limit:50,from:A,to:P})]),K=V.filter(c=>new Date(c.date).getTime()>=h.getTime()),ce=K.map(c=>c.fatigue??c.feeling).filter(c=>Number.isFinite(c)),de=K.reduce((c,b)=>c+(Number(b.duration)||0)*(Number(b.effort)||0),0),X=(oe?.runs??[]).filter(c=>Nt(c)>=h.getTime()),me=X.map(c=>c.fatigue??c.feeling??c.rpe).filter(c=>Number.isFinite(Number(c))).map(c=>Number(c)),ue=X.reduce((c,b)=>{const T=Number(b.feeling??b.rpe??0),L=Number(b.duration??0);if(L>0&&T>0)return c+L*T;const R=Array.isArray(b.logs)?b.logs.length:0;return c+R*5},0),xe=wt([...ce,...me]),D=K[0];let J=null;if(D){const c=[],b=D.effort,T=D.fatigue??D.feeling,L=D.performance,R=D.engagement;b!=null&&Number.isFinite(b)&&c.push(6-b),T!=null&&Number.isFinite(T)&&c.push(6-T),L!=null&&Number.isFinite(L)&&c.push(L),R!=null&&Number.isFinite(R)&&c.push(R),c.length>0&&(J=Math.round(c.reduce((he,pe)=>he+pe,0)/c.length*10)/10)}return{athleteId:m.id,athleteName:m.display_name,loadScore:de+ue,fatigueRating:xe,formeScore:J}})),le=M.filter(m=>m.fatigueRating?.rating===5).map(m=>({athleteName:m.athleteName,rating:m.fatigueRating?.rating??0})),ie=M.filter(m=>m.loadScore>0).sort((m,V)=>V.loadScore-m.loadScore)[0],Y=new Map;for(const m of M)m.athleteId!=null&&Y.set(m.athleteId,m.formeScore);return{fatigueAlerts:le,mostLoadedAthlete:ie??null,formeScores:Y}}}),B=n=>{if(r({id:n.id??null,name:n.display_name}),n.id==null){s("/progress");return}d(n),l("athlete")};return o?e.jsxs("div",{className:"space-y-6",children:[a==="home"?e.jsx(vt,{onNavigate:l,onOpenRecordsAdmin:()=>s("/records-admin"),onOpenRecordsClub:()=>s("/records-club"),onOpenAthlete:B,athletes:f,athletesLoading:y,kpiLoading:_.isLoading,fatigueAlerts:_.data?.fatigueAlerts??[],mostLoadedAthlete:_.data?.mostLoadedAthlete??null,formeScores:_.data?.formeScores??new Map,swimSessionCount:g?.length,strengthSessionCount:w?.length}):null,a==="swim"?e.jsxs("div",{className:"space-y-6",children:[e.jsx(H,{title:"Bibliothèque natation",description:"Accédez aux séances et aux templates natation.",onBack:()=>l("home"),actions:e.jsxs(z,{variant:"outline",size:"sm",onClick:()=>l("calendar"),children:[e.jsx(q,{className:"mr-1.5 h-3.5 w-3.5"}),"Assigner"]})}),e.jsx(i.Suspense,{fallback:e.jsx(v,{}),children:e.jsx(jt,{})})]}):null,a==="strength"?e.jsxs("div",{className:"space-y-6",children:[e.jsx(H,{title:"Bibliothèque musculation",description:"Consultez et créez des séances musculation.",onBack:()=>l("home"),actions:e.jsxs(z,{variant:"outline",size:"sm",onClick:()=>l("calendar"),children:[e.jsx(q,{className:"mr-1.5 h-3.5 w-3.5"}),"Assigner"]})}),e.jsx(i.Suspense,{fallback:e.jsx(v,{}),children:e.jsx(bt,{})})]}):null,a==="swimmers"?e.jsx(i.Suspense,{fallback:e.jsx(v,{}),children:e.jsx(ct,{athletes:f,athletesLoading:y,onBack:()=>l("home"),onOpenAthlete:B})}):null,a==="athlete"?e.jsx(i.Suspense,{fallback:e.jsx(v,{}),children:e.jsx(ft,{athleteId:u?.id??null,athleteName:u?.display_name??null,onBack:()=>l("home")})}):null,a==="messaging"?e.jsx(i.Suspense,{fallback:e.jsx(v,{}),children:e.jsx(dt,{onBack:()=>l("home"),athletes:f,groups:p,athletesLoading:y})}):null,a==="sms"?e.jsx(i.Suspense,{fallback:e.jsx(v,{}),children:e.jsx(mt,{onBack:()=>l("home"),athletes:f,groups:p,athletesLoading:y})}):null,a==="calendar"?e.jsx(i.Suspense,{fallback:e.jsx(v,{}),children:e.jsx(ut,{onBack:()=>l("home"),athletes:f,groups:p,swimSessions:g,strengthSessions:w})}):null,a==="groups"?e.jsx(i.Suspense,{fallback:e.jsx(v,{}),children:e.jsx(xt,{onBack:()=>l("home"),athletes:f,groups:p,athletesLoading:y})}):null,a==="competitions"?e.jsx(i.Suspense,{fallback:e.jsx(v,{}),children:e.jsx(ht,{onBack:()=>l("home")})}):null,a==="objectives"?e.jsx(i.Suspense,{fallback:e.jsx(v,{}),children:e.jsx(pt,{onBack:()=>l("home"),athletes:f,athletesLoading:y})}):null,a==="training-slots"?e.jsx(i.Suspense,{fallback:e.jsx(v,{}),children:e.jsx(gt,{onBack:()=>l("home"),groups:p})}):null,a==="deadlines"?e.jsxs("div",{className:"space-y-6",children:[e.jsx(H,{title:"Échéances",description:"Compétitions, entretiens et fins de cycles",onBack:()=>l("home")}),e.jsx(ot,{})]}):null]}):e.jsx("div",{className:"flex items-center justify-center min-h-[60vh] animate-in fade-in motion-reduce:animate-none",children:e.jsxs(be,{className:"w-full max-w-sm shadow-xl border-t-4 border-t-primary",children:[e.jsxs(je,{children:[e.jsxs(ye,{className:"flex items-center gap-2 uppercase italic",children:[e.jsx(ae,{className:"h-5 w-5 text-primary"}),"Accès Coach"]}),e.jsx(ve,{children:"Cette section est réservée aux coachs et administrateurs."})]}),e.jsx(Ne,{children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"Connectez-vous avec un compte autorisé pour accéder aux outils de gestion."})})]})})}const Pt=Object.freeze(Object.defineProperty({__proto__:null,default:kt},Symbol.toStringTag,{value:"Module"}));export{H as C,Pe as F,qe as U,Pt as a};
