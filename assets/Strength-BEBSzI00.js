import{R as d,T as wn,L as jn,G as Nn,H as Sn,J as _n,r as f,O as Cn,j as e}from"./vendor-ui-CDk0TPZB.js";import{b as Rn,u as rt,d as En,c as at}from"./vendor-query-aL7hzhW6.js";import{h as et,k as he,i as Wt,D as Ye,B as F,C as Xe,b as Rt,c as Et,d as Kt,f as kt,L as Ze,o as kn,X as vt,u as Dn,I as wt,g as Ee}from"./index-DtWo9CaA.js";import{S as Qt,a as Yt,b as Xt,c as Gt,d as Tn}from"./sheet-BEg73iub.js";import{S as Dt}from"./switch-Cbep0AJb.js";import{S as Mn,a as An,b as In,c as On,d as ft}from"./select-Bq0ef3dZ.js";import{T as $n,a as Pn,b as Ot,c as $t}from"./tabs-BcCZsSfE.js";import{B as dt}from"./badge-B8LKhQFO.js";import{A as Ln,a as Fn,b as Hn,c as zn,d as Bn,e as qn,f as Vn,g as Un,P as Pt}from"./alert-dialog-BX73-17o.js";import{C as Lt}from"./check-CU89Augd.js";import{T as Wn}from"./timer-BpoBglVh.js";import{C as Tt,I as Kn}from"./info-CofXufU3.js";import{S as Qn}from"./search-BryBfogy.js";import{C as Ft}from"./chevron-left-OcYw0-oj.js";import{f as pt}from"./fr-CqUxEDd2.js";import{f as ht}from"./vendor-date-cQbdWov0.js";import"./vendor-react-BzrpNAyj.js";import"./vendor-charts-bGfQb4ap.js";import"./vendor-supabase-CgI36rMY.js";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yn=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],Xn=et("calendar",Yn);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gn=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],Jn=et("circle-check",Gn);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zn=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]],es=et("loader-circle",Zn);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ts=[["rect",{x:"14",y:"3",width:"5",height:"18",rx:"1",key:"kaeet6"}],["rect",{x:"5",y:"3",width:"5",height:"18",rx:"1",key:"1wsw3u"}]],ns=et("pause",ts);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ss=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]],rs=et("rotate-ccw",ss);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const as=[["path",{d:"M10 5H3",key:"1qgfaw"}],["path",{d:"M12 19H3",key:"yhmn1j"}],["path",{d:"M14 3v4",key:"1sua03"}],["path",{d:"M16 17v4",key:"1q0r14"}],["path",{d:"M21 12h-9",key:"1o4lsq"}],["path",{d:"M21 19h-5",key:"1rlt1p"}],["path",{d:"M21 5h-7",key:"1oszz2"}],["path",{d:"M8 10v4",key:"tgpxqk"}],["path",{d:"M8 12H3",key:"a7s4jb"}]],is=et("sliders-horizontal",as);function os(t){if(typeof document>"u")return;let s=document.head||document.getElementsByTagName("head")[0],r=document.createElement("style");r.type="text/css",s.appendChild(r),r.styleSheet?r.styleSheet.cssText=t:r.appendChild(document.createTextNode(t))}const Jt=d.createContext({drawerRef:{current:null},overlayRef:{current:null},onPress:()=>{},onRelease:()=>{},onDrag:()=>{},onNestedDrag:()=>{},onNestedOpenChange:()=>{},onNestedRelease:()=>{},openProp:void 0,dismissible:!1,isOpen:!1,isDragging:!1,keyboardIsOpen:{current:!1},snapPointsOffset:null,snapPoints:null,handleOnly:!1,modal:!1,shouldFade:!1,activeSnapPoint:null,onOpenChange:()=>{},setActiveSnapPoint:()=>{},closeDrawer:()=>{},direction:"bottom",shouldAnimate:{current:!0},shouldScaleBackground:!1,setBackgroundColorOnScale:!0,noBodyStyles:!1,container:null,autoFocus:!1}),ut=()=>{const t=d.useContext(Jt);if(!t)throw new Error("useDrawerContext must be used within a Drawer.Root");return t};os(`[data-vaul-drawer]{touch-action:none;will-change:transform;transition:transform .5s cubic-bezier(.32, .72, 0, 1);animation-duration:.5s;animation-timing-function:cubic-bezier(0.32,0.72,0,1)}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=bottom][data-state=open]{animation-name:slideFromBottom}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=bottom][data-state=closed]{animation-name:slideToBottom}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=top][data-state=open]{animation-name:slideFromTop}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=top][data-state=closed]{animation-name:slideToTop}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=left][data-state=open]{animation-name:slideFromLeft}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=left][data-state=closed]{animation-name:slideToLeft}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=right][data-state=open]{animation-name:slideFromRight}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=right][data-state=closed]{animation-name:slideToRight}[data-vaul-drawer][data-vaul-snap-points=true][data-vaul-drawer-direction=bottom]{transform:translate3d(0,var(--initial-transform,100%),0)}[data-vaul-drawer][data-vaul-snap-points=true][data-vaul-drawer-direction=top]{transform:translate3d(0,calc(var(--initial-transform,100%) * -1),0)}[data-vaul-drawer][data-vaul-snap-points=true][data-vaul-drawer-direction=left]{transform:translate3d(calc(var(--initial-transform,100%) * -1),0,0)}[data-vaul-drawer][data-vaul-snap-points=true][data-vaul-drawer-direction=right]{transform:translate3d(var(--initial-transform,100%),0,0)}[data-vaul-drawer][data-vaul-delayed-snap-points=true][data-vaul-drawer-direction=top]{transform:translate3d(0,var(--snap-point-height,0),0)}[data-vaul-drawer][data-vaul-delayed-snap-points=true][data-vaul-drawer-direction=bottom]{transform:translate3d(0,var(--snap-point-height,0),0)}[data-vaul-drawer][data-vaul-delayed-snap-points=true][data-vaul-drawer-direction=left]{transform:translate3d(var(--snap-point-height,0),0,0)}[data-vaul-drawer][data-vaul-delayed-snap-points=true][data-vaul-drawer-direction=right]{transform:translate3d(var(--snap-point-height,0),0,0)}[data-vaul-overlay][data-vaul-snap-points=false]{animation-duration:.5s;animation-timing-function:cubic-bezier(0.32,0.72,0,1)}[data-vaul-overlay][data-vaul-snap-points=false][data-state=open]{animation-name:fadeIn}[data-vaul-overlay][data-state=closed]{animation-name:fadeOut}[data-vaul-animate=false]{animation:none!important}[data-vaul-overlay][data-vaul-snap-points=true]{opacity:0;transition:opacity .5s cubic-bezier(.32, .72, 0, 1)}[data-vaul-overlay][data-vaul-snap-points=true]{opacity:1}[data-vaul-drawer]:not([data-vaul-custom-container=true])::after{content:'';position:absolute;background:inherit;background-color:inherit}[data-vaul-drawer][data-vaul-drawer-direction=top]::after{top:initial;bottom:100%;left:0;right:0;height:200%}[data-vaul-drawer][data-vaul-drawer-direction=bottom]::after{top:100%;bottom:initial;left:0;right:0;height:200%}[data-vaul-drawer][data-vaul-drawer-direction=left]::after{left:initial;right:100%;top:0;bottom:0;width:200%}[data-vaul-drawer][data-vaul-drawer-direction=right]::after{left:100%;right:initial;top:0;bottom:0;width:200%}[data-vaul-overlay][data-vaul-snap-points=true]:not([data-vaul-snap-points-overlay=true]):not(
[data-state=closed]
){opacity:0}[data-vaul-overlay][data-vaul-snap-points-overlay=true]{opacity:1}[data-vaul-handle]{display:block;position:relative;opacity:.7;background:#e2e2e4;margin-left:auto;margin-right:auto;height:5px;width:32px;border-radius:1rem;touch-action:pan-y}[data-vaul-handle]:active,[data-vaul-handle]:hover{opacity:1}[data-vaul-handle-hitarea]{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);width:max(100%,2.75rem);height:max(100%,2.75rem);touch-action:inherit}@media (hover:hover) and (pointer:fine){[data-vaul-drawer]{user-select:none}}@media (pointer:fine){[data-vaul-handle-hitarea]:{width:100%;height:100%}}@keyframes fadeIn{from{opacity:0}to{opacity:1}}@keyframes fadeOut{to{opacity:0}}@keyframes slideFromBottom{from{transform:translate3d(0,var(--initial-transform,100%),0)}to{transform:translate3d(0,0,0)}}@keyframes slideToBottom{to{transform:translate3d(0,var(--initial-transform,100%),0)}}@keyframes slideFromTop{from{transform:translate3d(0,calc(var(--initial-transform,100%) * -1),0)}to{transform:translate3d(0,0,0)}}@keyframes slideToTop{to{transform:translate3d(0,calc(var(--initial-transform,100%) * -1),0)}}@keyframes slideFromLeft{from{transform:translate3d(calc(var(--initial-transform,100%) * -1),0,0)}to{transform:translate3d(0,0,0)}}@keyframes slideToLeft{to{transform:translate3d(calc(var(--initial-transform,100%) * -1),0,0)}}@keyframes slideFromRight{from{transform:translate3d(var(--initial-transform,100%),0,0)}to{transform:translate3d(0,0,0)}}@keyframes slideToRight{to{transform:translate3d(var(--initial-transform,100%),0,0)}}`);function ls(){const t=navigator.userAgent;return typeof window<"u"&&(/Firefox/.test(t)&&/Mobile/.test(t)||/FxiOS/.test(t))}function cs(){return It(/^Mac/)}function ds(){return It(/^iPhone/)}function Ht(){return/^((?!chrome|android).)*safari/i.test(navigator.userAgent)}function us(){return It(/^iPad/)||cs()&&navigator.maxTouchPoints>1}function Zt(){return ds()||us()}function It(t){return typeof window<"u"&&window.navigator!=null?t.test(window.navigator.platform):void 0}const ms=24,fs=typeof window<"u"?f.useLayoutEffect:f.useEffect;function zt(...t){return(...s)=>{for(let r of t)typeof r=="function"&&r(...s)}}const jt=typeof document<"u"&&window.visualViewport;function Bt(t){let s=window.getComputedStyle(t);return/(auto|scroll)/.test(s.overflow+s.overflowX+s.overflowY)}function en(t){for(Bt(t)&&(t=t.parentElement);t&&!Bt(t);)t=t.parentElement;return t||document.scrollingElement||document.documentElement}const ps=new Set(["checkbox","radio","range","color","file","image","button","submit","reset"]);let xt=0,Nt;function hs(t={}){let{isDisabled:s}=t;fs(()=>{if(!s)return xt++,xt===1&&Zt()&&(Nt=xs()),()=>{xt--,xt===0&&Nt?.()}},[s])}function xs(){let t,s=0,r=j=>{t=en(j.target),!(t===document.documentElement&&t===document.body)&&(s=j.changedTouches[0].pageY)},i=j=>{if(!t||t===document.documentElement||t===document.body){j.preventDefault();return}let v=j.changedTouches[0].pageY,H=t.scrollTop,Z=t.scrollHeight-t.clientHeight;Z!==0&&((H<=0&&v>s||H>=Z&&v<s)&&j.preventDefault(),s=v)},l=j=>{let v=j.target;Mt(v)&&v!==document.activeElement&&(j.preventDefault(),v.style.transform="translateY(-2000px)",v.focus(),requestAnimationFrame(()=>{v.style.transform=""}))},o=j=>{let v=j.target;Mt(v)&&(v.style.transform="translateY(-2000px)",requestAnimationFrame(()=>{v.style.transform="",jt&&(jt.height<window.innerHeight?requestAnimationFrame(()=>{qt(v)}):jt.addEventListener("resize",()=>qt(v),{once:!0}))}))},h=()=>{window.scrollTo(0,0)},p=window.pageXOffset,m=window.pageYOffset,E=zt(gs(document.documentElement,"paddingRight",`${window.innerWidth-document.documentElement.clientWidth}px`));window.scrollTo(0,0);let g=zt(it(document,"touchstart",r,{passive:!1,capture:!0}),it(document,"touchmove",i,{passive:!1,capture:!0}),it(document,"touchend",l,{passive:!1,capture:!0}),it(document,"focus",o,!0),it(window,"scroll",h));return()=>{E(),g(),window.scrollTo(p,m)}}function gs(t,s,r){let i=t.style[s];return t.style[s]=r,()=>{t.style[s]=i}}function it(t,s,r,i){return t.addEventListener(s,r,i),()=>{t.removeEventListener(s,r,i)}}function qt(t){let s=document.scrollingElement||document.documentElement;for(;t&&t!==s;){let r=en(t);if(r!==document.documentElement&&r!==document.body&&r!==t){let i=r.getBoundingClientRect().top,l=t.getBoundingClientRect().top,o=t.getBoundingClientRect().bottom;const h=r.getBoundingClientRect().bottom+ms;o>h&&(r.scrollTop+=l-i)}t=r.parentElement}}function Mt(t){return t instanceof HTMLInputElement&&!ps.has(t.type)||t instanceof HTMLTextAreaElement||t instanceof HTMLElement&&t.isContentEditable}function vs(t,s){typeof t=="function"?t(s):t!=null&&(t.current=s)}function ys(...t){return s=>t.forEach(r=>vs(r,s))}function tn(...t){return f.useCallback(ys(...t),t)}const nn=new WeakMap;function re(t,s,r=!1){if(!t||!(t instanceof HTMLElement))return;let i={};Object.entries(s).forEach(([l,o])=>{if(l.startsWith("--")){t.style.setProperty(l,o);return}i[l]=t.style[l],t.style[l]=o}),!r&&nn.set(t,i)}function bs(t,s){if(!t||!(t instanceof HTMLElement))return;let r=nn.get(t);r&&(t.style[s]=r[s])}const se=t=>{switch(t){case"top":case"bottom":return!0;case"left":case"right":return!1;default:return t}};function gt(t,s){if(!t)return null;const r=window.getComputedStyle(t),i=r.transform||r.webkitTransform||r.mozTransform;let l=i.match(/^matrix3d\((.+)\)$/);return l?parseFloat(l[1].split(", ")[se(s)?13:12]):(l=i.match(/^matrix\((.+)\)$/),l?parseFloat(l[1].split(", ")[se(s)?5:4]):null)}function ws(t){return 8*(Math.log(t+1)-2)}function St(t,s){if(!t)return()=>{};const r=t.style.cssText;return Object.assign(t.style,s),()=>{t.style.cssText=r}}function js(...t){return(...s)=>{for(const r of t)typeof r=="function"&&r(...s)}}const G={DURATION:.5,EASE:[.32,.72,0,1]},sn=.4,Ns=.25,Ss=100,rn=8,Ke=16,At=26,_t="vaul-dragging";function an(t){const s=d.useRef(t);return d.useEffect(()=>{s.current=t}),d.useMemo(()=>(...r)=>s.current==null?void 0:s.current.call(s,...r),[])}function _s({defaultProp:t,onChange:s}){const r=d.useState(t),[i]=r,l=d.useRef(i),o=an(s);return d.useEffect(()=>{l.current!==i&&(o(i),l.current=i)},[i,l,o]),r}function on({prop:t,defaultProp:s,onChange:r=()=>{}}){const[i,l]=_s({defaultProp:s,onChange:r}),o=t!==void 0,h=o?t:i,p=an(r),m=d.useCallback(E=>{if(o){const j=typeof E=="function"?E(t):E;j!==t&&p(j)}else l(E)},[o,t,l,p]);return[h,m]}function Cs({activeSnapPointProp:t,setActiveSnapPointProp:s,snapPoints:r,drawerRef:i,overlayRef:l,fadeFromIndex:o,onSnapPointChange:h,direction:p="bottom",container:m,snapToSequentialPoint:E}){const[g,j]=on({prop:t,defaultProp:r?.[0],onChange:s}),[v,H]=d.useState(typeof window<"u"?{innerWidth:window.innerWidth,innerHeight:window.innerHeight}:void 0);d.useEffect(()=>{function _(){H({innerWidth:window.innerWidth,innerHeight:window.innerHeight})}return window.addEventListener("resize",_),()=>window.removeEventListener("resize",_)},[]);const Z=d.useMemo(()=>g===r?.[r.length-1]||null,[r,g]),D=d.useMemo(()=>{var _;return(_=r?.findIndex(N=>N===g))!=null?_:null},[r,g]),L=r&&r.length>0&&(o||o===0)&&!Number.isNaN(o)&&r[o]===g||!r,y=d.useMemo(()=>{const _=m?{width:m.getBoundingClientRect().width,height:m.getBoundingClientRect().height}:typeof window<"u"?{width:window.innerWidth,height:window.innerHeight}:{width:0,height:0};var N;return(N=r?.map(M=>{const z=typeof M=="string";let q=0;if(z&&(q=parseInt(M,10)),se(p)){const x=z?q:v?M*_.height:0;return v?p==="bottom"?_.height-x:-_.height+x:x}const Q=z?q:v?M*_.width:0;return v?p==="right"?_.width-Q:-_.width+Q:Q}))!=null?N:[]},[r,v,m]),I=d.useMemo(()=>D!==null?y?.[D]:null,[y,D]),O=d.useCallback(_=>{var N;const M=(N=y?.findIndex(z=>z===_))!=null?N:null;h(M),re(i.current,{transition:`transform ${G.DURATION}s cubic-bezier(${G.EASE.join(",")})`,transform:se(p)?`translate3d(0, ${_}px, 0)`:`translate3d(${_}px, 0, 0)`}),y&&M!==y.length-1&&o!==void 0&&M!==o&&M<o?re(l.current,{transition:`opacity ${G.DURATION}s cubic-bezier(${G.EASE.join(",")})`,opacity:"0"}):re(l.current,{transition:`opacity ${G.DURATION}s cubic-bezier(${G.EASE.join(",")})`,opacity:"1"}),j(r?.[Math.max(M,0)])},[i.current,r,y,o,l,j]);d.useEffect(()=>{if(g||t){var _;const N=(_=r?.findIndex(M=>M===t||M===g))!=null?_:-1;y&&N!==-1&&typeof y[N]=="number"&&O(y[N])}},[g,t,r,y,O]);function b({draggedDistance:_,closeDrawer:N,velocity:M,dismissible:z}){if(o===void 0)return;const q=p==="bottom"||p==="right"?(I??0)-_:(I??0)+_,Q=D===o-1,x=D===0,Y=_>0;if(Q&&re(l.current,{transition:`opacity ${G.DURATION}s cubic-bezier(${G.EASE.join(",")})`}),!E&&M>2&&!Y){z?N():O(y[0]);return}if(!E&&M>2&&Y&&y&&r){O(y[r.length-1]);return}const X=y?.reduce((U,ce)=>typeof U!="number"||typeof ce!="number"?U:Math.abs(ce-q)<Math.abs(U-q)?ce:U),V=se(p)?window.innerHeight:window.innerWidth;if(M>sn&&Math.abs(_)<V*.4){const U=Y?1:-1;if(U>0&&Z&&r){O(y[r.length-1]);return}if(x&&U<0&&z&&N(),D===null)return;O(y[D+U]);return}O(X)}function ie({draggedDistance:_}){if(I===null)return;const N=p==="bottom"||p==="right"?I-_:I+_;(p==="bottom"||p==="right")&&N<y[y.length-1]||(p==="top"||p==="left")&&N>y[y.length-1]||re(i.current,{transform:se(p)?`translate3d(0, ${N}px, 0)`:`translate3d(${N}px, 0, 0)`})}function xe(_,N){if(!r||typeof D!="number"||!y||o===void 0)return null;const M=D===o-1;if(D>=o&&N)return 0;if(M&&!N)return 1;if(!L&&!M)return null;const q=M?D+1:D-1,Q=M?y[q]-y[q-1]:y[q+1]-y[q],x=_/Math.abs(Q);return M?1-x:x}return{isLastSnapPoint:Z,activeSnapPoint:g,shouldFade:L,getPercentageDragged:xe,setActiveSnapPoint:j,activeSnapPointIndex:D,onRelease:b,onDrag:ie,snapPointsOffset:y}}const Rs=()=>()=>{};function Es(){const{direction:t,isOpen:s,shouldScaleBackground:r,setBackgroundColorOnScale:i,noBodyStyles:l}=ut(),o=d.useRef(null),h=f.useMemo(()=>document.body.style.backgroundColor,[]);function p(){return(window.innerWidth-At)/window.innerWidth}d.useEffect(()=>{if(s&&r){o.current&&clearTimeout(o.current);const m=document.querySelector("[data-vaul-drawer-wrapper]")||document.querySelector("[vaul-drawer-wrapper]");if(!m)return;js(i&&!l?St(document.body,{background:"black"}):Rs,St(m,{transformOrigin:se(t)?"top":"left",transitionProperty:"transform, border-radius",transitionDuration:`${G.DURATION}s`,transitionTimingFunction:`cubic-bezier(${G.EASE.join(",")})`}));const E=St(m,{borderRadius:`${rn}px`,overflow:"hidden",...se(t)?{transform:`scale(${p()}) translate3d(0, calc(env(safe-area-inset-top) + 14px), 0)`}:{transform:`scale(${p()}) translate3d(calc(env(safe-area-inset-top) + 14px), 0, 0)`}});return()=>{E(),o.current=window.setTimeout(()=>{h?document.body.style.background=h:document.body.style.removeProperty("background")},G.DURATION*1e3)}}},[s,r,h])}let ot=null;function ks({isOpen:t,modal:s,nested:r,hasBeenOpened:i,preventScrollRestoration:l,noBodyStyles:o}){const[h,p]=d.useState(()=>typeof window<"u"?window.location.href:""),m=d.useRef(0),E=d.useCallback(()=>{if(Ht()&&ot===null&&t&&!o){ot={position:document.body.style.position,top:document.body.style.top,left:document.body.style.left,height:document.body.style.height,right:"unset"};const{scrollX:j,innerHeight:v}=window;document.body.style.setProperty("position","fixed","important"),Object.assign(document.body.style,{top:`${-m.current}px`,left:`${-j}px`,right:"0px",height:"auto"}),window.setTimeout(()=>window.requestAnimationFrame(()=>{const H=v-window.innerHeight;H&&m.current>=v&&(document.body.style.top=`${-(m.current+H)}px`)}),300)}},[t]),g=d.useCallback(()=>{if(Ht()&&ot!==null&&!o){const j=-parseInt(document.body.style.top,10),v=-parseInt(document.body.style.left,10);Object.assign(document.body.style,ot),window.requestAnimationFrame(()=>{if(l&&h!==window.location.href){p(window.location.href);return}window.scrollTo(v,j)}),ot=null}},[h]);return d.useEffect(()=>{function j(){m.current=window.scrollY}return j(),window.addEventListener("scroll",j),()=>{window.removeEventListener("scroll",j)}},[]),d.useEffect(()=>{if(s)return()=>{typeof document>"u"||document.querySelector("[data-vaul-drawer]")||g()}},[s,g]),d.useEffect(()=>{r||!i||(t?(!window.matchMedia("(display-mode: standalone)").matches&&E(),s||window.setTimeout(()=>{g()},500)):g())},[t,i,h,s,r,E,g]),{restorePositionSetting:g}}function Ds({open:t,onOpenChange:s,children:r,onDrag:i,onRelease:l,snapPoints:o,shouldScaleBackground:h=!1,setBackgroundColorOnScale:p=!0,closeThreshold:m=Ns,scrollLockTimeout:E=Ss,dismissible:g=!0,handleOnly:j=!1,fadeFromIndex:v=o&&o.length-1,activeSnapPoint:H,setActiveSnapPoint:Z,fixed:D,modal:L=!0,onClose:y,nested:I,noBodyStyles:O=!1,direction:b="bottom",defaultOpen:ie=!1,disablePreventScroll:xe=!0,snapToSequentialPoint:_=!1,preventScrollRestoration:N=!1,repositionInputs:M=!0,onAnimationEnd:z,container:q,autoFocus:Q=!1}){var x,Y;const[X=!1,V]=on({defaultProp:ie,prop:t,onChange:u=>{s?.(u),!u&&!I&&Ge(),setTimeout(()=>{z?.(u)},G.DURATION*1e3),u&&!L&&typeof window<"u"&&window.requestAnimationFrame(()=>{document.body.style.pointerEvents="auto"}),u||(document.body.style.pointerEvents="auto")}}),[U,ce]=d.useState(!1),[K,ge]=d.useState(!1),[De,Te]=d.useState(!1),Ne=d.useRef(null),Pe=d.useRef(null),Le=d.useRef(null),ze=d.useRef(null),$=d.useRef(null),ue=d.useRef(!1),Fe=d.useRef(null),ve=d.useRef(0),ye=d.useRef(!1),Be=d.useRef(!ie),B=d.useRef(0),w=d.useRef(null),Se=d.useRef(((x=w.current)==null?void 0:x.getBoundingClientRect().height)||0),be=d.useRef(((Y=w.current)==null?void 0:Y.getBoundingClientRect().width)||0),_e=d.useRef(0),He=d.useCallback(u=>{o&&u===J.length-1&&(Pe.current=new Date)},[]),{activeSnapPoint:tt,activeSnapPointIndex:we,setActiveSnapPoint:me,onRelease:qe,snapPointsOffset:J,onDrag:Ve,shouldFade:k,getPercentageDragged:fe}=Cs({snapPoints:o,activeSnapPointProp:H,setActiveSnapPointProp:Z,drawerRef:w,fadeFromIndex:v,overlayRef:Ne,onSnapPointChange:He,direction:b,container:q,snapToSequentialPoint:_});hs({isDisabled:!X||K||!L||De||!U||!M||!xe});const{restorePositionSetting:Ge}=ks({isOpen:X,modal:L,nested:I??!1,hasBeenOpened:U,preventScrollRestoration:N,noBodyStyles:O});function Me(){return(window.innerWidth-At)/window.innerWidth}function Ce(u){var S,A;!g&&!o||w.current&&!w.current.contains(u.target)||(Se.current=((S=w.current)==null?void 0:S.getBoundingClientRect().height)||0,be.current=((A=w.current)==null?void 0:A.getBoundingClientRect().width)||0,ge(!0),Le.current=new Date,Zt()&&window.addEventListener("touchend",()=>ue.current=!1,{once:!0}),u.target.setPointerCapture(u.pointerId),ve.current=se(b)?u.pageY:u.pageX)}function ae(u,S){var A;let T=u;const W=(A=window.getSelection())==null?void 0:A.toString(),ne=w.current?gt(w.current,b):null,ee=new Date;if(T.tagName==="SELECT"||T.hasAttribute("data-vaul-no-drag")||T.closest("[data-vaul-no-drag]"))return!1;if(b==="right"||b==="left")return!0;if(Pe.current&&ee.getTime()-Pe.current.getTime()<500)return!1;if(ne!==null&&(b==="bottom"?ne>0:ne<0))return!0;if(W&&W.length>0)return!1;if($.current&&ee.getTime()-$.current.getTime()<E&&ne===0||S)return $.current=ee,!1;for(;T;){if(T.scrollHeight>T.clientHeight){if(T.scrollTop!==0)return $.current=new Date,!1;if(T.getAttribute("role")==="dialog")return!0}T=T.parentNode}return!0}function Je(u){if(w.current&&K){const S=b==="bottom"||b==="right"?1:-1,A=(ve.current-(se(b)?u.pageY:u.pageX))*S,T=A>0,W=o&&!g&&!T;if(W&&we===0)return;const ne=Math.abs(A),ee=document.querySelector("[data-vaul-drawer-wrapper]"),de=b==="bottom"||b==="top"?Se.current:be.current;let le=ne/de;const je=fe(ne,T);if(je!==null&&(le=je),W&&le>=1||!ue.current&&!ae(u.target,T))return;if(w.current.classList.add(_t),ue.current=!0,re(w.current,{transition:"none"}),re(Ne.current,{transition:"none"}),o&&Ve({draggedDistance:A}),T&&!o){const pe=ws(A),We=Math.min(pe*-1,0)*S;re(w.current,{transform:se(b)?`translate3d(0, ${We}px, 0)`:`translate3d(${We}px, 0, 0)`});return}const ke=1-le;if((k||v&&we===v-1)&&(i?.(u,le),re(Ne.current,{opacity:`${ke}`,transition:"none"},!0)),ee&&Ne.current&&h){const pe=Math.min(Me()+le*(1-Me()),1),We=8-le*8,a=Math.max(0,14-le*14);re(ee,{borderRadius:`${We}px`,transform:se(b)?`scale(${pe}) translate3d(0, ${a}px, 0)`:`scale(${pe}) translate3d(${a}px, 0, 0)`,transition:"none"},!0)}if(!o){const pe=ne*S;re(w.current,{transform:se(b)?`translate3d(0, ${pe}px, 0)`:`translate3d(${pe}px, 0, 0)`})}}}d.useEffect(()=>{window.requestAnimationFrame(()=>{Be.current=!0})},[]),d.useEffect(()=>{var u;function S(){if(!w.current||!M)return;const A=document.activeElement;if(Mt(A)||ye.current){var T;const W=((T=window.visualViewport)==null?void 0:T.height)||0,ne=window.innerHeight;let ee=ne-W;const de=w.current.getBoundingClientRect().height||0,le=de>ne*.8;_e.current||(_e.current=de);const je=w.current.getBoundingClientRect().top;if(Math.abs(B.current-ee)>60&&(ye.current=!ye.current),o&&o.length>0&&J&&we){const ke=J[we]||0;ee+=ke}if(B.current=ee,de>W||ye.current){const ke=w.current.getBoundingClientRect().height;let pe=ke;ke>W&&(pe=W-(le?je:At)),D?w.current.style.height=`${ke-Math.max(ee,0)}px`:w.current.style.height=`${Math.max(pe,W-je)}px`}else ls()||(w.current.style.height=`${_e.current}px`);o&&o.length>0&&!ye.current?w.current.style.bottom="0px":w.current.style.bottom=`${Math.max(ee,0)}px`}}return(u=window.visualViewport)==null||u.addEventListener("resize",S),()=>{var A;return(A=window.visualViewport)==null?void 0:A.removeEventListener("resize",S)}},[we,o,J]);function Re(u){nt(),y?.(),u||V(!1),setTimeout(()=>{o&&me(o[0])},G.DURATION*1e3)}function Ue(){if(!w.current)return;const u=document.querySelector("[data-vaul-drawer-wrapper]"),S=gt(w.current,b);re(w.current,{transform:"translate3d(0, 0, 0)",transition:`transform ${G.DURATION}s cubic-bezier(${G.EASE.join(",")})`}),re(Ne.current,{transition:`opacity ${G.DURATION}s cubic-bezier(${G.EASE.join(",")})`,opacity:"1"}),h&&S&&S>0&&X&&re(u,{borderRadius:`${rn}px`,overflow:"hidden",...se(b)?{transform:`scale(${Me()}) translate3d(0, calc(env(safe-area-inset-top) + 14px), 0)`,transformOrigin:"top"}:{transform:`scale(${Me()}) translate3d(calc(env(safe-area-inset-top) + 14px), 0, 0)`,transformOrigin:"left"},transitionProperty:"transform, border-radius",transitionDuration:`${G.DURATION}s`,transitionTimingFunction:`cubic-bezier(${G.EASE.join(",")})`},!0)}function nt(){!K||!w.current||(w.current.classList.remove(_t),ue.current=!1,ge(!1),ze.current=new Date)}function oe(u){if(!K||!w.current)return;w.current.classList.remove(_t),ue.current=!1,ge(!1),ze.current=new Date;const S=gt(w.current,b);if(!u||!ae(u.target,!1)||!S||Number.isNaN(S)||Le.current===null)return;const A=ze.current.getTime()-Le.current.getTime(),T=ve.current-(se(b)?u.pageY:u.pageX),W=Math.abs(T)/A;if(W>.05&&(Te(!0),setTimeout(()=>{Te(!1)},200)),o){qe({draggedDistance:T*(b==="bottom"||b==="right"?1:-1),closeDrawer:Re,velocity:W,dismissible:g}),l?.(u,!0);return}if(b==="bottom"||b==="right"?T>0:T<0){Ue(),l?.(u,!0);return}if(W>sn){Re(),l?.(u,!1);return}var ne;const ee=Math.min((ne=w.current.getBoundingClientRect().height)!=null?ne:0,window.innerHeight);var de;const le=Math.min((de=w.current.getBoundingClientRect().width)!=null?de:0,window.innerWidth),je=b==="left"||b==="right";if(Math.abs(S)>=(je?le:ee)*m){Re(),l?.(u,!1);return}l?.(u,!0),Ue()}d.useEffect(()=>(X&&(re(document.documentElement,{scrollBehavior:"auto"}),Pe.current=new Date),()=>{bs(document.documentElement,"scrollBehavior")}),[X]);function n(u){const S=u?(window.innerWidth-Ke)/window.innerWidth:1,A=u?-Ke:0;Fe.current&&window.clearTimeout(Fe.current),re(w.current,{transition:`transform ${G.DURATION}s cubic-bezier(${G.EASE.join(",")})`,transform:se(b)?`scale(${S}) translate3d(0, ${A}px, 0)`:`scale(${S}) translate3d(${A}px, 0, 0)`}),!u&&w.current&&(Fe.current=setTimeout(()=>{const T=gt(w.current,b);re(w.current,{transition:"none",transform:se(b)?`translate3d(0, ${T}px, 0)`:`translate3d(${T}px, 0, 0)`})},500))}function c(u,S){if(S<0)return;const A=(window.innerWidth-Ke)/window.innerWidth,T=A+S*(1-A),W=-Ke+S*Ke;re(w.current,{transform:se(b)?`scale(${T}) translate3d(0, ${W}px, 0)`:`scale(${T}) translate3d(${W}px, 0, 0)`,transition:"none"})}function P(u,S){const A=se(b)?window.innerHeight:window.innerWidth,T=S?(A-Ke)/A:1,W=S?-Ke:0;S&&re(w.current,{transition:`transform ${G.DURATION}s cubic-bezier(${G.EASE.join(",")})`,transform:se(b)?`scale(${T}) translate3d(0, ${W}px, 0)`:`scale(${T}) translate3d(${W}px, 0, 0)`})}return d.useEffect(()=>{L||window.requestAnimationFrame(()=>{document.body.style.pointerEvents="auto"})},[L]),d.createElement(Nn,{defaultOpen:ie,onOpenChange:u=>{!g&&!u||(u?ce(!0):Re(!0),V(u))},open:X},d.createElement(Jt.Provider,{value:{activeSnapPoint:tt,snapPoints:o,setActiveSnapPoint:me,drawerRef:w,overlayRef:Ne,onOpenChange:s,onPress:Ce,onRelease:oe,onDrag:Je,dismissible:g,shouldAnimate:Be,handleOnly:j,isOpen:X,isDragging:K,shouldFade:k,closeDrawer:Re,onNestedDrag:c,onNestedOpenChange:n,onNestedRelease:P,keyboardIsOpen:ye,modal:L,snapPointsOffset:J,activeSnapPointIndex:we,direction:b,shouldScaleBackground:h,setBackgroundColorOnScale:p,noBodyStyles:O,container:q,autoFocus:Q}},r))}const ln=d.forwardRef(function({...t},s){const{overlayRef:r,snapPoints:i,onRelease:l,shouldFade:o,isOpen:h,modal:p,shouldAnimate:m}=ut(),E=tn(s,r),g=i&&i.length>0;if(!p)return null;const j=d.useCallback(v=>l(v),[l]);return d.createElement(Cn,{onMouseUp:j,ref:E,"data-vaul-overlay":"","data-vaul-snap-points":h&&g?"true":"false","data-vaul-snap-points-overlay":h&&o?"true":"false","data-vaul-animate":m?.current?"true":"false",...t})});ln.displayName="Drawer.Overlay";const cn=d.forwardRef(function({onPointerDownOutside:t,style:s,onOpenAutoFocus:r,...i},l){const{drawerRef:o,onPress:h,onRelease:p,onDrag:m,keyboardIsOpen:E,snapPointsOffset:g,activeSnapPointIndex:j,modal:v,isOpen:H,direction:Z,snapPoints:D,container:L,handleOnly:y,shouldAnimate:I,autoFocus:O}=ut(),[b,ie]=d.useState(!1),xe=tn(l,o),_=d.useRef(null),N=d.useRef(null),M=d.useRef(!1),z=D&&D.length>0;Es();const q=(x,Y,X=0)=>{if(M.current)return!0;const V=Math.abs(x.y),U=Math.abs(x.x),ce=U>V,K=["bottom","right"].includes(Y)?1:-1;if(Y==="left"||Y==="right"){if(!(x.x*K<0)&&U>=0&&U<=X)return ce}else if(!(x.y*K<0)&&V>=0&&V<=X)return!ce;return M.current=!0,!0};d.useEffect(()=>{z&&window.requestAnimationFrame(()=>{ie(!0)})},[]);function Q(x){_.current=null,M.current=!1,p(x)}return d.createElement(_n,{"data-vaul-drawer-direction":Z,"data-vaul-drawer":"","data-vaul-delayed-snap-points":b?"true":"false","data-vaul-snap-points":H&&z?"true":"false","data-vaul-custom-container":L?"true":"false","data-vaul-animate":I?.current?"true":"false",...i,ref:xe,style:g&&g.length>0?{"--snap-point-height":`${g[j??0]}px`,...s}:s,onPointerDown:x=>{y||(i.onPointerDown==null||i.onPointerDown.call(i,x),_.current={x:x.pageX,y:x.pageY},h(x))},onOpenAutoFocus:x=>{r?.(x),O||x.preventDefault()},onPointerDownOutside:x=>{if(t?.(x),!v||x.defaultPrevented){x.preventDefault();return}E.current&&(E.current=!1)},onFocusOutside:x=>{if(!v){x.preventDefault();return}},onPointerMove:x=>{if(N.current=x,y||(i.onPointerMove==null||i.onPointerMove.call(i,x),!_.current))return;const Y=x.pageY-_.current.y,X=x.pageX-_.current.x,V=x.pointerType==="touch"?10:2;q({x:X,y:Y},Z,V)?m(x):(Math.abs(X)>V||Math.abs(Y)>V)&&(_.current=null)},onPointerUp:x=>{i.onPointerUp==null||i.onPointerUp.call(i,x),_.current=null,M.current=!1,p(x)},onPointerOut:x=>{i.onPointerOut==null||i.onPointerOut.call(i,x),Q(N.current)},onContextMenu:x=>{i.onContextMenu==null||i.onContextMenu.call(i,x),N.current&&Q(N.current)}})});cn.displayName="Drawer.Content";const Ts=250,Ms=120,As=d.forwardRef(function({preventCycle:t=!1,children:s,...r},i){const{closeDrawer:l,isDragging:o,snapPoints:h,activeSnapPoint:p,setActiveSnapPoint:m,dismissible:E,handleOnly:g,isOpen:j,onPress:v,onDrag:H}=ut(),Z=d.useRef(null),D=d.useRef(!1);function L(){if(D.current){O();return}window.setTimeout(()=>{y()},Ms)}function y(){if(o||t||D.current){O();return}if(O(),!h||h.length===0){E||l();return}if(p===h[h.length-1]&&E){l();return}const ie=h.findIndex(_=>_===p);if(ie===-1)return;const xe=h[ie+1];m(xe)}function I(){Z.current=window.setTimeout(()=>{D.current=!0},Ts)}function O(){Z.current&&window.clearTimeout(Z.current),D.current=!1}return d.createElement("div",{onClick:L,onPointerCancel:O,onPointerDown:b=>{g&&v(b),I()},onPointerMove:b=>{g&&H(b)},ref:i,"data-vaul-drawer-visible":j?"true":"false","data-vaul-handle":"","aria-hidden":"true",...r},d.createElement("span",{"data-vaul-handle-hitarea":"","aria-hidden":"true"},s))});As.displayName="Drawer.Handle";function Is(t){const s=ut(),{container:r=s.container,...i}=t;return d.createElement(Sn,{container:r,...i})}const $e={Root:Ds,Content:cn,Overlay:ln,Portal:Is,Title:wn,Description:jn},dn=({shouldScaleBackground:t=!0,...s})=>e.jsx($e.Root,{shouldScaleBackground:t,...s});dn.displayName="Drawer";const Os=$e.Portal,un=f.forwardRef(({className:t,...s},r)=>e.jsx($e.Overlay,{ref:r,className:he("fixed inset-0 z-50 bg-black/80",t),...s}));un.displayName=$e.Overlay.displayName;const mn=f.forwardRef(({className:t,children:s,...r},i)=>e.jsxs(Os,{children:[e.jsx(un,{}),e.jsxs($e.Content,{ref:i,className:he("fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background",t),...r,children:[e.jsx("div",{className:"mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted"}),s]})]}));mn.displayName="DrawerContent";const fn=({className:t,...s})=>e.jsx("div",{className:he("grid gap-1.5 p-4 text-center sm:text-left",t),...s});fn.displayName="DrawerHeader";const pn=f.forwardRef(({className:t,...s},r)=>e.jsx($e.Title,{ref:r,className:he("text-lg font-semibold leading-none tracking-tight",t),...s}));pn.displayName=$e.Title.displayName;const hn=f.forwardRef(({className:t,...s},r)=>e.jsx($e.Description,{ref:r,className:he("text-sm text-muted-foreground",t),...s}));hn.displayName=$e.Description.displayName;function xn({children:t,className:s,containerClassName:r}){return e.jsx("div",{role:"region","aria-label":"Actions",className:he("fixed bottom-16 left-0 right-0 z-bar md:bottom-0 md:z-bar",s),children:e.jsx("div",{className:he("mx-auto flex w-full max-w-md items-center justify-between gap-2 border-t bg-background px-4 py-3 shadow-[0_-2px_10px_rgba(0,0,0,0.1)]","md:supports-[padding:env(safe-area-inset-bottom)]:pb-[calc(env(safe-area-inset-bottom)+0.75rem)]",r),children:t})})}const $s=[1,2,3,4,5];function Vt({value:t,onChange:s,className:r,disabled:i=!1,size:l="md",ariaLabel:o="Sélecteur d'échelle 1 à 5"}){const h=l==="sm"?"h-10 w-10 text-xs":"h-11 w-11 text-sm";return e.jsx("div",{className:he("flex items-center gap-2",r),role:"group","aria-label":o,children:$s.map(p=>{const m=t===p;return e.jsx("button",{type:"button",className:he("flex items-center justify-center rounded-full border font-semibold transition",h,m?"border-primary bg-primary text-primary-foreground":"border-muted-foreground/30 bg-background text-foreground",i&&"opacity-60"),"aria-pressed":m,disabled:i,onClick:()=>{i||s?.(p)},children:p},p)})})}const yt=(t,s)=>{const r=Number(t?.set_index??t?.set_number??t?.setIndex??s);return!Number.isFinite(r)||r<=0?s:r},gn=(t=[],s,r)=>{if(!t.length)return 0;const i=Array.isArray(s)?s:[];if(i.length>0){const h=new Map;i.forEach((m,E)=>{if(!m?.exercise_id)return;const g=h.get(m.exercise_id)??[];g.push({...m,set_index:yt(m,E+1)}),h.set(m.exercise_id,g)});let p=t.length+1;for(let m=0;m<t.length;m+=1){const E=t[m];if((h.get(E.exercise_id)??[]).length<(E.sets??0)){p=m+1;break}}return p}const l=Number(r??0);if(!Number.isFinite(l)||l<=0)return 0;const o=Math.min(t.length,Math.max(0,Math.round(l/100*t.length)));return Math.min(t.length,o+1)},Oe=(t,s)=>{const r=Number(t);return!Number.isFinite(r)||r<=0?"—":s?`${r}${s}`:String(r)};function Ps({session:t,exercises:s,oneRMs:r,onFinish:i,onStart:l,onLogSets:o,onProgress:h,initialLogs:p,isFinishing:m,initialStep:E,onStepChange:g,initialInputOpen:j,initialSeriesOpen:v,onExitFocus:H}){const{toast:Z}=Wt(),D=f.useRef(!1),[L,y]=f.useState(E??0),[I,O]=f.useState([]),[b,ie]=f.useState(0),[xe,_]=f.useState(!0),N=f.useRef(Date.now()),M=f.useRef(0),[z,q]=f.useState(0),[Q,x]=f.useState(!1),[Y,X]=f.useState(!1),V=f.useRef(0),[U,ce]=f.useState(!0),[K,ge]=f.useState(3),[De,Te]=f.useState(3),[Ne,Pe]=f.useState(""),[Le,ze]=f.useState(!1),[$,ue]=f.useState(1),[Fe,ve]=f.useState(v??!1),[ye,Be]=f.useState(j??!1),[B,w]=f.useState("weight"),[Se,be]=f.useState(""),[_e,He]=f.useState(!1),[tt,we]=f.useState(!1),[me,qe]=f.useState(!1);f.useEffect(()=>{if(!xe)return;const a=()=>{ie(Math.floor((Date.now()-N.current)/1e3)+M.current)};a();const C=setInterval(a,1e3),te=()=>{document.visibilityState==="visible"&&a()};return document.addEventListener("visibilitychange",te),()=>{clearInterval(C),document.removeEventListener("visibilitychange",te)}},[xe]),f.useEffect(()=>{if(!_e)return;const a=C=>{C.key==="Escape"&&He(!1)};return window.addEventListener("keydown",a),()=>window.removeEventListener("keydown",a)},[_e]),f.useEffect(()=>{let a=null;Q&&!Y&&z>0?a=setInterval(()=>q(te=>te-1),1e3):z===0&&Q&&(x(!1),X(!1));const C=()=>{if(document.visibilityState==="visible"&&Q&&!Y&&V.current>0){const te=Math.max(0,Math.ceil((V.current-Date.now())/1e3));q(te)}};return document.addEventListener("visibilitychange",C),()=>{a&&clearInterval(a),document.removeEventListener("visibilitychange",C)}},[Q,Y,z]);const J=t.items||[],Ve=L-1,k=L>0&&L<=J.length?J[Ve]:null,fe=k?s.find(a=>a.id===k.exercise_id):null,Ge=L<J.length?J[L]:null,Me=Ge?s.find(a=>a.id===Ge.exercise_id):null,Ce=(()=>{const a=fe?.muscle_groups??fe?.muscles??fe?.muscleGroups??[];return Array.isArray(a)?a:[]})(),ae=k?.rest_seconds??0,Je=J.length?Math.min(100,Math.max(0,Math.round((L-1)/J.length*100))):0,Re=Number(k?.percent_1rm),Ue=Number.isFinite(Re)&&Re>0,nt=Ue&&r.find(a=>a.exercise_id===k?.exercise_id)?.weight||0,oe=Ue?Math.round(nt*(Re/100)):0,[n,c]=f.useState({}),P=f.useMemo(()=>{const a=new Map;return I.forEach((C,te)=>{const R=yt(C,te+1);C.exercise_id&&a.set(`${C.exercise_id}-${R}`,C)}),a},[I]),u=k?`${k.exercise_id}-${$}`:null,S=u?P.get(u):null,A=S?.weight??n[$-1]?.weight??oe,T=S?.reps??n[$-1]?.reps??k?.reps??"",W=()=>{if(typeof window>"u")return;const a=["#22c55e","#3b82f6","#f97316","#e11d48","#a855f7"],C=120;for(let te=0;te<C;te+=1){const R=document.createElement("div"),Ae=Math.random()*6+6;R.style.position="fixed",R.style.top="-10px",R.style.left=`${Math.random()*100}vw`,R.style.width=`${Ae}px`,R.style.height=`${Ae*.6}px`,R.style.backgroundColor=a[te%a.length],R.style.opacity="0.9",R.style.pointerEvents="none",R.style.zIndex="9999",R.style.borderRadius="2px",document.body.appendChild(R);const Ie=(Math.random()-.5)*200,st=1200+Math.random()*800,mt=Math.random()*360;R.animate([{transform:"translate3d(0, 0, 0) rotate(0deg)",opacity:1},{transform:`translate3d(${Ie}px, ${window.innerHeight+200}px, 0) rotate(${mt}deg)`,opacity:0}],{duration:st,easing:"ease-out"}).onfinish=()=>R.remove()}};f.useEffect(()=>{if(D.current){p&&O(p);return}if(!p){O(R=>R.length?[]:R),c(R=>Object.keys(R).length?{}:R);return}if(O(p),!p.length){c(R=>Object.keys(R).length?{}:R),y(R=>R===0?R:0);return}const a=t.items||[];if(!a.length)return;const C=new Map;p.forEach((R,Ae)=>{if(!R.exercise_id)return;const Ie=C.get(R.exercise_id)??[];Ie.push({...R,set_index:yt(R,Ae+1)}),C.set(R.exercise_id,Ie)});const te=gn(a,p);if(te>0&&te<=a.length){const R=a[te-1],Ae=C.get(R.exercise_id)??[],Ie=Ae.reduce((mt,bt,yn)=>{const bn=yt(bt,yn+1);return mt[bn-1]={reps:bt.reps??void 0,weight:bt.weight??void 0},mt},{});c(Ie);const st=Math.min(R.sets??1,Ae.length+1);ue(st)}else c({}),ue(1);y(R=>R===te?R:te)},[p,t.items]),f.useEffect(()=>{L<=J.length||Le||(W(),ze(!0))},[L,J.length,Le]);const ne=a=>{y(a),g?.(a)},ee=a=>{a<=0||(V.current=Date.now()+a*1e3,q(a),x(!0),X(!1))},de=async()=>{window.scrollTo({top:0,behavior:"smooth"});const a=L+1;ue(1),c({}),ne(a);const C=Math.round(Math.min(a-1,J.length)/J.length*100);try{await h?.(C)}catch{Z({title:"Erreur de sauvegarde",description:"Réessayez",variant:"destructive"})}},le=async()=>{if(!k)return;if(S){$>=k.sets?await de():ue(C=>Math.min(k.sets,C+1));return}const a={exercise_id:k.exercise_id,set_number:$,reps:n[$-1]?.reps||k.reps,weight:n[$-1]?.weight||oe};O(C=>[...C,a]),D.current=!0;try{await o?.([a])}catch{Z({title:"Erreur de sauvegarde",description:"Réessayez",variant:"destructive"})}finally{D.current=!1}if(U&&k.rest_seconds>0&&ee(k.rest_seconds),$>=k.sets){await de();return}ue(C=>Math.min(k.sets,C+1))},je=a=>{w(a);const C=a==="weight"?n[$-1]?.weight??oe??"":n[$-1]?.reps??k?.reps??"";be(C?String(C):""),Be(!0)},ke=()=>{if(!k)return;const a=Number(B==="weight"?Se.replace(",","."):Se);Number.isFinite(a)&&(c(C=>({...C,[$-1]:{...C[$-1],[B]:a}})),Be(!1))},pe=a=>{be(C=>a==="."&&C.includes(".")?C:C+a)},We=a=>{if(!k)return;w(a);const C=a==="weight"?n[$-1]?.weight??oe??"":n[$-1]?.reps??k?.reps??"";be(C?String(C):"")};return L===0?e.jsxs("div",{className:"space-y-6 text-center py-8 animate-in zoom-in duration-300",children:[e.jsx("div",{className:"h-24 w-24 bg-primary/10 rounded-full flex items-center justify-center mx-auto animate-pulse",children:e.jsx(Ye,{className:"h-10 w-10 text-primary ml-1"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold font-display uppercase",children:t.title}),e.jsx("p",{className:"text-muted-foreground text-lg",children:t.description}),e.jsxs("div",{className:"flex gap-2 justify-center mt-4",children:[e.jsx(dt,{variant:"outline",className:"text-sm px-3 py-1",children:t.cycle}),e.jsxs(dt,{variant:"secondary",className:"text-sm px-3 py-1",children:[J.length," Exercices"]})]})]}),e.jsx(F,{size:"lg",className:"w-full text-xl h-14 font-bold uppercase tracking-wider shadow-lg hover:scale-[1.02] transition-transform",disabled:tt,onClick:async()=>{we(!0);try{await l?.(),ne(1)}finally{we(!1)}},children:tt?e.jsxs(e.Fragment,{children:[e.jsx(es,{className:"mr-2 h-5 w-5 animate-spin"}),"CHARGEMENT..."]}):"COMMENCER SÉANCE"})]}):L>J.length?e.jsx("div",{className:"space-y-6 animate-in fade-in",children:e.jsxs(Xe,{className:"border-t-8 border-t-primary shadow-xl",children:[e.jsxs(Rt,{className:"text-center pb-2",children:[e.jsx("div",{className:"mx-auto bg-primary/10 p-4 rounded-full w-fit mb-4",children:e.jsx(Jn,{className:"h-12 w-12 text-primary"})}),e.jsx(Et,{className:"text-3xl uppercase font-display italic",children:"Séance Terminée !"}),e.jsxs(Kt,{className:"text-lg",children:["Durée totale: ",Math.floor(b/60),"m ",b%60,"s"]})]}),e.jsxs(kt,{className:"space-y-6 pt-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-center",children:[e.jsxs("div",{className:"bg-muted p-4 rounded-lg",children:[e.jsx("div",{className:"text-xs uppercase font-bold text-muted-foreground",children:"Volume"}),e.jsxs("div",{className:"text-2xl font-mono font-bold",children:[I.reduce((a,C)=>a+(Number(C.weight)||0)*(Number(C.reps)||0),0)," kg"]})]}),e.jsxs("div",{className:"bg-muted p-4 rounded-lg",children:[e.jsx("div",{className:"text-xs uppercase font-bold text-muted-foreground",children:"Séries"}),e.jsx("div",{className:"text-2xl font-mono font-bold",children:I.length})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(Ze,{className:"uppercase font-bold text-xs text-muted-foreground",children:"Difficulté de la séance"}),e.jsxs("div",{className:"flex items-center justify-between text-[11px] font-semibold text-muted-foreground",children:[e.jsx("span",{children:"Facile"}),e.jsx("span",{children:"Très dur"})]}),e.jsx(Vt,{value:K,onChange:ge})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(Ze,{className:"uppercase font-bold text-xs text-muted-foreground",children:"Fatigue fin de séance"}),e.jsxs("div",{className:"flex items-center justify-between text-[11px] font-semibold text-muted-foreground",children:[e.jsx("span",{children:"Frais"}),e.jsx("span",{children:"Épuisé"})]}),e.jsx(Vt,{value:De,onChange:Te})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Ze,{className:"uppercase font-bold text-xs text-muted-foreground",children:"Notes"}),e.jsx("textarea",{placeholder:"Sensations, douleurs...",value:Ne,onChange:a=>Pe(a.target.value),rows:3,className:"flex w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 resize-none"})]})]}),e.jsx(kn,{children:e.jsx(F,{className:"w-full h-14 text-lg font-bold uppercase",disabled:m,onClick:()=>{m||i({duration:Math.floor(b/60),feeling:K,fatigue:De,comments:Ne,logs:I})},children:m?"ENREGISTREMENT...":"ENREGISTRER & FERMER"})})]})}):e.jsxs("div",{className:"space-y-6 pb-32",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{type:"button","aria-label":"Voir l’animation de l’exercice",onClick:()=>{fe?.illustration_gif&&He(!0)},className:"flex h-12 w-12 items-center justify-center overflow-hidden rounded-full border bg-card shadow-sm",children:fe?.illustration_gif?e.jsx("img",{src:fe.illustration_gif,alt:"",className:"h-full w-full object-cover",loading:"lazy",decoding:"async"}):e.jsx(Ye,{className:"h-5 w-5 text-muted-foreground"})}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs("span",{className:"rounded-full bg-muted px-3 py-1 text-xs font-semibold",children:["Ex ",L,"/",J.length]}),e.jsxs("span",{className:"rounded-full bg-muted px-3 py-1 text-xs font-semibold",children:["S ",$,"/",Oe(k?.sets)]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"text-xs font-semibold text-muted-foreground",children:"Séance"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-2 w-28 overflow-hidden rounded-full bg-muted",children:e.jsx("div",{className:"h-full rounded-full bg-primary",style:{width:`${Je}%`}})}),e.jsxs("div",{className:"text-sm font-semibold",children:[Je,"%"]})]}),H?e.jsx(F,{variant:"ghost",size:"icon","aria-label":"Quitter le focus",onClick:()=>{I.length>0?qe(!0):H()},children:e.jsx(vt,{className:"h-4 w-4"})}):null]})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-semibold tracking-tight",children:fe?.nom_exercice??"Exercice"}),Ce.length>0&&e.jsx("div",{className:"mt-3 flex flex-wrap gap-2",children:Ce.map(a=>e.jsx("span",{className:"rounded-full bg-muted px-3 py-1 text-xs font-semibold text-muted-foreground",children:a},a))})]}),e.jsxs(Xe,{className:"rounded-3xl border bg-card p-4 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-base font-semibold",children:"Série en cours"}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(Dt,{checked:U,onCheckedChange:ce}),"Auto repos"]})]}),e.jsxs("div",{className:"mt-4 rounded-2xl border bg-muted/20 p-4",children:[e.jsx("div",{className:"text-sm font-semibold",children:"En cours"}),e.jsxs("div",{className:"mt-2 text-lg font-semibold",children:["Série ",$,"/",Oe(k?.sets)," · Objectif"," ",Oe(k?.reps)," reps"]}),e.jsx("div",{className:"mt-2 text-sm text-muted-foreground",children:"Appuie sur une tuile pour saisir."})]}),e.jsxs("div",{className:"mt-4 grid grid-cols-2 gap-3",children:[e.jsxs("button",{type:"button",className:"group relative rounded-2xl border-2 border-primary/20 bg-gradient-to-br from-card to-muted/30 p-4 text-left shadow-sm transition-all active:scale-[0.98] hover:border-primary/40 hover:shadow-md",onClick:()=>je("weight"),children:[e.jsx("div",{className:"text-[10px] font-bold uppercase tracking-wide text-muted-foreground",children:"Charge"}),e.jsxs("div",{className:"mt-1 flex items-baseline gap-0.5",children:[e.jsx("span",{className:"text-3xl font-bold tabular-nums tracking-tight",children:A||"—"}),e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"kg"})]})]}),e.jsxs("button",{type:"button",className:"group relative rounded-2xl border-2 border-primary/20 bg-gradient-to-br from-card to-muted/30 p-4 text-left shadow-sm transition-all active:scale-[0.98] hover:border-primary/40 hover:shadow-md",onClick:()=>je("reps"),children:[e.jsx("div",{className:"text-[10px] font-bold uppercase tracking-wide text-muted-foreground",children:"Reps"}),e.jsxs("div",{className:"mt-1 flex items-baseline gap-0.5",children:[e.jsx("span",{className:"text-3xl font-bold tabular-nums tracking-tight",children:T||"—"}),e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"reps"})]})]})]}),e.jsxs("div",{className:"mt-4 rounded-2xl border bg-muted/10 p-4",children:[e.jsx("div",{className:"text-sm font-semibold",children:"Notes"}),e.jsx("div",{className:"mt-2 text-sm text-muted-foreground",children:k?.notes||fe?.description||"Aucune note spécifique."})]}),e.jsx(F,{type:"button",variant:"outline",className:"mt-4 w-full rounded-2xl",onClick:()=>ve(!0),children:"Voir les séries"})]}),!ye&&!Q?e.jsxs(xn,{className:"bottom-0 z-[60]",containerClassName:"gap-3 py-4",children:[e.jsxs(F,{className:"flex-1 min-w-0 h-12 rounded-xl text-sm font-bold shadow-lg active:scale-95 transition-transform",onClick:le,children:[e.jsx(Lt,{className:"mr-2 h-5 w-5"})," Valider série"]}),e.jsx(F,{type:"button",variant:"outline",className:"h-12 w-12 rounded-xl p-0 active:scale-95 transition-transform",onClick:()=>{ae<=0||ee(ae)},"aria-label":"Démarrer le repos",children:e.jsx(Wn,{className:"h-5 w-5"})}),e.jsx(F,{type:"button",variant:"outline",className:"h-12 w-12 rounded-xl p-0 active:scale-95 transition-transform",onClick:()=>de(),"aria-label":"Exercice suivant",children:e.jsx(Tt,{className:"h-5 w-5"})})]}):null,Q&&e.jsxs("div",{className:"fixed inset-0 z-50 flex flex-col bg-background/95 pb-[env(safe-area-inset-bottom)]",children:[e.jsxs("div",{className:"flex items-start justify-between border-b px-6 py-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-semibold text-muted-foreground",children:"Timer"}),e.jsx("div",{className:"text-lg font-semibold",children:"Transition inter-exercice"}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Prochain exercice : ",Me?.nom_exercice??"À venir"]})]}),e.jsx(F,{variant:"ghost",size:"icon",onClick:()=>{x(!1),X(!1)},"aria-label":"Fermer le timer de repos",children:e.jsx(vt,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"flex flex-1 flex-col items-center justify-center gap-6 px-6 py-8",children:[e.jsxs(Xe,{className:"w-full max-w-sm rounded-3xl border p-6 shadow-sm",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Temps restant"}),e.jsxs("div",{className:"mt-2 text-5xl font-semibold tracking-tight",children:[Math.floor(z/60),":",String(z%60).padStart(2,"0")]}),e.jsx("div",{className:"mt-6 h-3 w-full overflow-hidden rounded-full bg-muted",children:e.jsx("div",{className:"h-full rounded-full bg-primary",style:{width:ae?`${z/ae*100}%`:"0%"}})}),e.jsxs("div",{className:"mt-6 flex flex-wrap gap-3",children:[e.jsx(F,{variant:"outline",className:"rounded-full",onClick:()=>{V.current+=15*1e3,q(a=>a+15)},children:"+15s"}),e.jsx(F,{variant:"outline",className:"rounded-full",onClick:()=>{V.current+=30*1e3,q(a=>a+30)},children:"+30s"}),e.jsx(F,{variant:"outline",className:"rounded-full",onClick:()=>{V.current=Math.max(Date.now(),V.current-15*1e3),q(a=>Math.max(0,a-15))},children:"-15s"}),e.jsxs(F,{variant:"outline",className:"ml-auto rounded-full",onClick:()=>{V.current=Date.now()+ae*1e3,q(ae)},children:[e.jsx(rs,{className:"mr-2 h-4 w-4"}),"Reset"]})]})]}),e.jsxs("div",{className:"flex w-full max-w-sm flex-wrap gap-3",children:[e.jsxs(F,{className:"flex-1 rounded-full py-6 text-base font-semibold",onClick:()=>{Y&&(V.current=Date.now()+z*1e3),X(a=>!a)},children:[e.jsx(ns,{className:"mr-2 h-4 w-4"})," ",Y?"Reprendre":"Pause"]}),e.jsxs(F,{variant:"outline",className:"rounded-full px-6 py-6 text-base font-semibold",onClick:()=>{V.current=0,x(!1),q(0),X(!1)},children:["Passer ",e.jsx(Tt,{className:"ml-2 h-4 w-4"})]})]})]})]}),_e&&fe?.illustration_gif&&e.jsx("div",{className:"fixed inset-0 z-50 bg-black/50",onClick:()=>He(!1),children:e.jsx("div",{className:"fixed inset-0 flex items-center justify-center p-4",onClick:a=>a.stopPropagation(),children:e.jsxs("div",{className:"relative",children:[e.jsx("button",{type:"button","aria-label":"Fermer",className:"absolute -right-3 -top-3 rounded-full bg-background p-2 shadow",onClick:()=>He(!1),children:e.jsx(vt,{className:"h-4 w-4"})}),e.jsx("img",{src:fe.illustration_gif,alt:"",className:"max-h-[80vh] w-auto max-w-[92vw] rounded-2xl",loading:"lazy"})]})})}),e.jsx(Qt,{open:Fe,onOpenChange:ve,children:e.jsxs(Yt,{side:"bottom",className:"max-h-[80vh] overflow-y-auto",children:[e.jsx(Xt,{children:e.jsx(Gt,{children:"Aperçu séance"})}),e.jsx("div",{className:"mt-4 space-y-4",children:J.map((a,C)=>{const te=s.find(Ie=>Ie.id===a.exercise_id),R=Array.from({length:a.sets}).filter((Ie,st)=>P.get(`${a.exercise_id}-${st+1}`)).length,Ae=a.sets?Math.round(R/a.sets*100):0;return e.jsxs(Xe,{className:"rounded-3xl border bg-muted/10 p-4 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-base font-semibold",children:te?.nom_exercice??a.exercise_name}),e.jsxs("div",{className:"mt-1 text-sm text-muted-foreground",children:[Oe(a.sets),"x",Oe(a.reps)," ·"," ",a.percent_1rm?`${Oe(a.percent_1rm)} 1RM`:"—"]})]}),e.jsxs("div",{className:"rounded-full bg-muted px-3 py-1 text-sm font-semibold",children:[R,"/",Oe(a.sets)]})]}),e.jsx("div",{className:"mt-4 h-3 w-full overflow-hidden rounded-full bg-muted",children:e.jsx("div",{className:"h-full rounded-full bg-primary",style:{width:`${Ae}%`}})})]},`${a.exercise_id}-${C}`)})})]})}),e.jsx(dn,{open:ye,onOpenChange:Be,children:e.jsx(mn,{className:"max-h-[90vh]",children:e.jsxs("div",{className:"mx-auto w-full max-w-md px-4 pb-8",children:[e.jsxs(fn,{className:"pb-2",children:[e.jsx(pn,{className:"text-center",children:B==="weight"?"Charge":"Répétitions"}),e.jsxs(hn,{className:"text-center",children:["Série ",$,"/",Oe(k?.sets)," · Objectif"," ",Oe(k?.reps)," reps"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-4",children:[e.jsxs("button",{type:"button",className:he("rounded-xl border-2 p-4 text-center transition-all",B==="weight"?"border-primary bg-primary/10 shadow-sm":"border-muted bg-card hover:border-muted-foreground/30"),onClick:()=>We("weight"),children:[e.jsx("div",{className:"text-xs font-semibold uppercase text-muted-foreground",children:"Charge"}),e.jsxs("div",{className:"mt-1 text-2xl font-bold tabular-nums",children:[B==="weight"?Se||"—":String(n[$-1]?.weight??oe??"—"),e.jsx("span",{className:"ml-1 text-base font-normal text-muted-foreground",children:"kg"})]})]}),e.jsxs("button",{type:"button",className:he("rounded-xl border-2 p-4 text-center transition-all",B==="reps"?"border-primary bg-primary/10 shadow-sm":"border-muted bg-card hover:border-muted-foreground/30"),onClick:()=>We("reps"),children:[e.jsx("div",{className:"text-xs font-semibold uppercase text-muted-foreground",children:"Reps"}),e.jsxs("div",{className:"mt-1 text-2xl font-bold tabular-nums",children:[B==="reps"?Se||"—":String(n[$-1]?.reps??k?.reps??"—"),e.jsx("span",{className:"ml-1 text-base font-normal text-muted-foreground",children:"reps"})]})]})]}),B==="weight"&&oe>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"text-xs font-semibold text-muted-foreground mb-2",children:"Suggestions"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:[oe-10,oe-5,oe,oe+5,oe+10].filter(a=>a>0).map(a=>e.jsxs(F,{variant:Number(Se)===a?"default":"outline",size:"sm",className:"rounded-full px-4 h-10 text-sm font-semibold",onClick:()=>be(String(a)),children:[a," kg"]},a))})]}),B==="reps"&&e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"text-xs font-semibold text-muted-foreground mb-2",children:"Suggestions"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:[6,8,10,12,15,20].map(a=>e.jsx(F,{variant:Number(Se)===a?"default":"outline",size:"sm",className:"rounded-full px-4 h-10 text-sm font-semibold",onClick:()=>be(String(a)),children:a},a))})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 mb-4",children:[[1,2,3,4,5,6,7,8,9].map(a=>e.jsx(F,{variant:"outline",className:"h-14 text-xl font-semibold rounded-xl active:scale-95 transition-transform",onClick:()=>pe(String(a)),children:a},a)),e.jsx(F,{variant:"outline",className:"h-14 text-xl font-semibold rounded-xl active:scale-95 transition-transform",onClick:()=>pe("."),children:","}),e.jsx(F,{variant:"outline",className:"h-14 text-xl font-semibold rounded-xl active:scale-95 transition-transform",onClick:()=>pe("0"),children:"0"}),e.jsx(F,{variant:"outline",className:"h-14 text-xl font-semibold rounded-xl active:scale-95 transition-transform",onClick:()=>be(a=>a.slice(0,-1)),children:"⌫"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(F,{variant:"outline",className:"flex-1 h-14 text-base font-semibold rounded-xl",onClick:()=>be(""),children:"Effacer"}),e.jsxs(F,{className:"flex-1 h-14 text-base font-semibold rounded-xl",onClick:ke,children:[e.jsx(Lt,{className:"mr-2 h-5 w-5"}),"Valider"]})]})]})})}),H&&e.jsx(Ln,{open:me,onOpenChange:qe,children:e.jsxs(Fn,{children:[e.jsxs(Hn,{children:[e.jsx(zn,{children:"Quitter la séance ?"}),e.jsx(Bn,{children:"Les séries enregistrées seront conservées."})]}),e.jsxs(qn,{children:[e.jsx(Vn,{children:"Annuler"}),e.jsx(Un,{onClick:()=>{qe(!1),H()},children:"Quitter"})]})]})})]})}const Qe=t=>t==="endurance"||t==="hypertrophie"||t==="force"?t:"endurance",lt=t=>{const s=Number(t);return!Number.isFinite(s)||s<=0?null:s},Ls=(t,s)=>{if(!t)return{sets:null,reps:null,percent1rm:null,restSeries:null,restExercise:null};const r={endurance:{sets:t.Nb_series_endurance,reps:t.Nb_reps_endurance,percent1rm:t.pct_1rm_endurance,restSeries:t.recup_endurance,restExercise:t.recup_exercices_endurance},hypertrophie:{sets:t.Nb_series_hypertrophie,reps:t.Nb_reps_hypertrophie,percent1rm:t.pct_1rm_hypertrophie,restSeries:t.recup_hypertrophie,restExercise:t.recup_exercices_hypertrophie},force:{sets:t.Nb_series_force,reps:t.Nb_reps_force,percent1rm:t.pct_1rm_force,restSeries:t.recup_force,restExercise:t.recup_exercices_force}}[s];return{sets:lt(r.sets),reps:lt(r.reps),percent1rm:lt(r.percent1rm),restSeries:lt(r.restSeries),restExercise:lt(r.restExercise)}},ct=(t=[],s,r)=>Hs(t,s).map(i=>{const l=Ls(r.get(i.exercise_id),s);return{...i,sets:l.sets??0,reps:l.reps??0,rest_seconds:l.restSeries??0,percent_1rm:l.percent1rm??0}}),Ut=t=>{const s=Number(t);return!Number.isFinite(s)||s<=0?"—":String(s)},Fs=t=>{const s=Number(t);return!Number.isFinite(s)||s<=0?"—":`${s}s`},vn=(t=[])=>{if(!t.length)return t;const s=t.map((i,l)=>{const o=Number(i.order_index);return{item:i,index:l,order:Number.isFinite(o)?o:null}});return s.some(i=>i.order!==null)?s.sort((i,l)=>i.order===null&&l.order===null?i.index-l.index:i.order===null?1:l.order===null?-1:i.order===l.order?i.index-l.index:i.order-l.order).map(i=>i.item):t},Hs=(t=[],s)=>{const r=t.filter(l=>l.cycle_type===s),i=r.length?r:t;return vn(i)},zs=t=>{t.setActiveSession(null),t.setActiveAssignment(null),t.setActiveRunId(null),t.setActiveRunLogs(null),t.setActiveRunnerStep(0),t.setScreenMode("list")},Bs=({runId:t,assignmentId:s,startedAt:r})=>({id:t,assignment_id:s??null,started_at:r,progress_pct:0,status:"in_progress",logs:[]}),Ct=t=>({runs:t?[t]:[],pagination:{limit:1,offset:0,total:t?1:0},exercise_summary:[]});function lr(){const{user:t,userId:s,role:r,selectedAthleteId:i,selectedAthleteName:l}=Dn(),{toast:o}=Wt(),h=Rn(),p="strength-preferences",[m,E]=f.useState(null),[g,j]=f.useState(null),[v,H]=f.useState(null),[Z,D]=f.useState(null),[L,y]=f.useState(0),[I,O]=f.useState("list"),[b,ie]=f.useState({poolMode:!1,largeText:!1}),[xe,_]=f.useState(""),[N,M]=f.useState("endurance"),[z,q]=f.useState("all"),[Q,x]=f.useState(""),[Y,X]=f.useState(""),V=(r==="coach"||r==="admin")&&(i!==null||!!l),U=V?l:t,ce=V?i:s,K=ce??U,ge=f.useMemo(()=>`strength-focus-state-${K??"anonymous"}`,[K]),{poolMode:De,largeText:Te}=b;f.useEffect(()=>{if(typeof window>"u")return;const n=window.localStorage.getItem(p);if(n)try{const c=JSON.parse(n);ie(P=>({...P,...c??{}}))}catch{return}},[]),f.useEffect(()=>{typeof window>"u"||window.localStorage.setItem(p,JSON.stringify(b))},[p,b]),f.useEffect(()=>{if(!(typeof document>"u")){if(I==="focus")return document.body.dataset.focusMode="strength",()=>{document.body.dataset.focusMode==="strength"&&delete document.body.dataset.focusMode};document.body.dataset.focusMode==="strength"&&delete document.body.dataset.focusMode}},[I]),f.useEffect(()=>{if(typeof window>"u"||m)return;const n=window.localStorage.getItem(ge);if(n)try{const c=JSON.parse(n),P=c?.screenMode==="focus"?"focus":c?.screenMode==="reader"?"reader":null;if(!P||!c?.session)return;E(c.session),j(c.assignment??null),H(typeof c.runId=="number"?c.runId:null),D(Array.isArray(c.runLogs)?c.runLogs:null),y(Number.isFinite(c.runnerStep)?c.runnerStep:0),c.cycleType&&M(Qe(c.cycleType)),O(P)}catch{return}},[m,ge]),f.useEffect(()=>{if(typeof window>"u")return;if(!(I==="focus"||I==="reader")||!m){window.localStorage.removeItem(ge);return}const c={screenMode:I,session:m,assignment:g,runId:v,runLogs:Z,runnerStep:L,cycleType:N};window.localStorage.setItem(ge,JSON.stringify(c))},[g,v,Z,L,m,N,ge,I]);const{data:Ne,isLoading:Pe}=rt({queryKey:["assignments",t,"strength"],queryFn:()=>Ee.getAssignments(t,s,{assignmentType:"strength"}),enabled:!!t}),{data:Le,isLoading:ze}=rt({queryKey:["strength_catalog"],queryFn:()=>Ee.getStrengthSessions()}),{data:$}=rt({queryKey:["exercises"],queryFn:()=>Ee.getExercises()}),ue=Pe||ze,{data:Fe}=rt({queryKey:["1rm",t,s],queryFn:()=>Ee.get1RM({athleteName:t,athleteId:s}),enabled:!!t}),ve=En({queryKey:["strength_history",K,z,Q,Y],queryFn:({pageParam:n=0})=>Ee.getStrengthHistory(U,{athleteId:ce,limit:10,offset:n,order:"desc",status:z==="all"?void 0:z,from:Q||void 0,to:Y||void 0}),enabled:!!U,getNextPageParam:n=>{const c=n.pagination.offset+n.pagination.limit;return c<n.pagination.total?c:void 0},initialPageParam:0}),ye=ve.data?.pages.flatMap(n=>n.runs)??[],B=rt({queryKey:["strength_run_in_progress",K],queryFn:()=>Ee.getStrengthHistory(U,{limit:1,offset:0,order:"desc",status:"in_progress",athleteId:ce}),enabled:!!U}).data?.runs?.[0]??null,w=B?.status==="completed"||(B?.progress_pct??0)>=100,Se=at({mutationFn:n=>Ee.startStrengthRun(n),onSuccess:n=>{if(n?.run_id&&(H(n.run_id),D(c=>c??[]),K)){const c=Bs({runId:n.run_id,assignmentId:g?.id??null,startedAt:new Date().toISOString()});h.setQueryData(["strength_run_in_progress",K],Ct(c))}h.invalidateQueries({queryKey:["assignments",t,"strength"]}),h.invalidateQueries({queryKey:["strength_run_in_progress",K]}),h.invalidateQueries({queryKey:["strength_history"]})},onError:()=>{o({title:"Erreur",description:"Impossible de démarrer la séance.",variant:"destructive"})}}),be=at({mutationFn:n=>Ee.logStrengthSet(n),onSuccess:n=>{n?.one_rm_updated&&(h.invalidateQueries({queryKey:["1rm",t,s]}),o({title:"Nouveau 1RM détecté",description:"Ton record vient d'être mis à jour."}))},onError:()=>{o({title:"Erreur",description:"Impossible d'enregistrer une série.",variant:"destructive"})}}),_e=at({mutationFn:n=>Ee.updateStrengthRun(n),onSuccess:(n,c)=>{h.invalidateQueries({queryKey:["strength_history"]}),c?.status==="completed"&&(K&&h.setQueryData(["strength_run_in_progress",K],Ct(null)),h.invalidateQueries({queryKey:["assignments",t]}),h.invalidateQueries({queryKey:["assignments",t,"strength"]}),h.invalidateQueries({queryKey:["1rm",t,s]}),j(null),H(null),E(null),D(null),O("list"),o({title:"Séance sauvegardée",description:"Bravo pour l'effort !"}))}});at({mutationFn:n=>Ee.startStrengthRun(n),onError:()=>{o({title:"Erreur",description:"Impossible de mettre à jour la séance.",variant:"destructive"})}});const He=(n,c)=>{const P=n.items??[],u=Qe(c??n.cycle??P.find(A=>A.cycle_type)?.cycle_type),S=ct(P,u,k);j(n),E({...n,title:n.title,description:n.description,cycle:u,items:S}),H(null),D(null),y(0),O("reader")},we=(Ne?.filter(n=>n.session_type==="strength")||[]).filter(n=>n.status!=="completed"),me=B?we.find(n=>n.id===B.assignment_id):null,qe=!!me?.items?.length&&!w,J=we.map(n=>({...n,session:{id:n.session_id,title:n.title,description:n.description,cycle:Qe(n.cycle),items:n.items??[]}})),Ve=[{value:"endurance",label:"Endurance"},{value:"hypertrophie",label:"Hypertrophie"},{value:"force",label:"Force"}],k=f.useMemo(()=>$?new Map($.map(n=>[n.id,n])):new Map,[$]),fe=J.map(n=>{const c=ct(n.items??[],N,k);return{key:`assignment-${n.id}`,title:n.title,description:n.description,type:"assignment",assignedDate:n.assigned_date,session:{id:n.session_id,title:n.title,description:n.description,cycle:Qe(n.cycle),items:c},assignment:n,exerciseCount:c.length}}),Ge=(Le??[]).map(n=>{const c=ct(n.items??[],N,k);return{key:`catalog-${n.id}`,title:n.title,description:n.description,type:"catalog",session:{...n,items:c,cycle:N},exerciseCount:c.length}}),Me=xe.trim().toLowerCase(),Ce=[...fe,...Ge].filter(n=>Me?`${n.title} ${n.description}`.toLowerCase().includes(Me):!0),ae=f.useMemo(()=>m?ct(m.items??[],N,k):[],[m,N,k]),Je=n=>{if((n.items??[]).length===0){o({title:"Séance vide",description:"Aucun exercice n'est disponible pour cette séance."});return}He(n,N),H(null),D(null)},Re=n=>{const c=n.items??[],u=c.filter(A=>A.cycle_type===N).length>0?N:Qe(n.cycle??c.find(A=>A.cycle_type)?.cycle_type),S=ct(c,u,k);if(S.length===0){o({title:"Séance vide",description:"Aucun exercice n'est disponible pour cette séance."});return}E({...n,cycle:u,items:S}),j(null),H(null),D(null),y(0),O("reader")},Ue=()=>{if(m){if(ae.length===0){o({title:"Séance vide",description:"Aucun exercice n'est disponible pour cette séance."});return}E({...m,cycle:N,items:ae}),y(0),O("focus")}},nt=()=>{zs({setActiveSession:E,setActiveAssignment:j,setActiveRunId:H,setActiveRunLogs:D,setActiveRunnerStep:y,setScreenMode:O})},oe=at({mutationFn:n=>Ee.deleteStrengthRun(n),onSuccess:n=>{nt(),K&&h.setQueryData(["strength_run_in_progress",K],Ct(null)),h.invalidateQueries({queryKey:["strength_run_in_progress",K]}),h.invalidateQueries({queryKey:["strength_history"]}),h.invalidateQueries({queryKey:["assignments",t,"strength"]});const c=n?.source==="local"?"Suppression locale : le serveur n'est pas disponible.":void 0;o({title:"Séance supprimée",description:c})},onError:()=>{o({title:"Erreur",description:"Impossible de supprimer la séance en cours.",variant:"destructive"})}});return e.jsx("div",{className:he("space-y-4 md:space-y-6",De&&"dark bg-background text-foreground contrast-125",Te&&"text-lg leading-relaxed [&_.text-xs]:text-sm [&_.text-sm]:text-base"),children:I==="focus"&&m?$?e.jsx("div",{className:"animate-in fade-in motion-reduce:animate-none",children:e.jsx(Ps,{session:m,exercises:$,oneRMs:Fe||[],initialLogs:Z,initialStep:L,isFinishing:_e.isPending,onStepChange:n=>y(n),onExitFocus:()=>O("reader"),onStart:async()=>{if(v)return;const n=g?.session_id??m?.id??null;if(!n){o({title:"Session manquante",description:"Impossible de démarrer sans session associée.",variant:"destructive"});return}const c={assignment_id:g?.id??null,athlete_id:s??null,athleteName:t??void 0,progress_pct:0,session_id:n,cycle_type:m?.cycle};try{const P=await Se.mutateAsync(c);P?.run_id&&H(P.run_id)}catch{return}},onLogSets:async n=>{v&&(D(c=>[...c??[],...n]),await Promise.all(n.map((c,P)=>be.mutateAsync({run_id:v,exercise_id:c.exercise_id,set_index:c.set_number??P+1,reps:c.reps??null,weight:c.weight??null,athlete_id:s??null,athlete_name:t??null}))))},onProgress:async n=>{v&&await _e.mutateAsync({run_id:v,progress_pct:n,status:"in_progress"})},onFinish:n=>{v&&_e.mutate({assignment_id:g?.id??void 0,run_id:v,session_id:g?.session_id??m?.id??void 0,athlete_id:s??void 0,date:new Date().toISOString(),progress_pct:100,status:"completed",...n})}})}):e.jsxs("div",{className:"space-y-4 py-10",children:[e.jsx("div",{className:"mx-auto h-8 w-48 rounded-lg bg-muted animate-pulse motion-reduce:animate-none"}),e.jsx("div",{className:"mx-auto h-4 w-32 rounded-lg bg-muted animate-pulse motion-reduce:animate-none"}),e.jsx("div",{className:"space-y-3 pt-4",children:[1,2,3].map(n=>e.jsx("div",{className:"h-20 w-full rounded-xl bg-muted animate-pulse motion-reduce:animate-none"},n))})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-3xl font-display font-bold uppercase italic text-primary",children:"Musculation"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(F,{variant:"ghost",size:"sm","aria-label":"Informations sur le calcul du 1RM",onClick:()=>o({title:"Info",description:"Le 1RM est calculé automatiquement."}),className:"text-muted-foreground",children:[e.jsx(Ye,{className:"mr-2 h-4 w-4"})," Info 1RM"]}),e.jsx(F,{variant:"ghost",size:"icon",onClick:()=>O("settings"),className:"rounded-full border border-muted/50 text-muted-foreground","aria-label":"Paramètres",children:e.jsx(is,{className:"h-4 w-4"})})]})]}),e.jsxs($n,{defaultValue:"start",className:"w-full",children:[e.jsxs(Pn,{className:"grid w-full grid-cols-2",children:[e.jsx(Ot,{value:"start",children:"S'entraîner"}),e.jsx(Ot,{value:"history",children:"Historique"})]}),e.jsxs($t,{value:"start",className:"space-y-5 pt-4",children:[I==="list"&&ue&&e.jsxs("div",{className:"space-y-5 pt-4",children:[e.jsx("div",{className:"flex justify-center gap-2",children:[1,2,3].map(n=>e.jsx("div",{className:"h-10 w-28 rounded-full bg-muted animate-pulse"},n))}),e.jsx("div",{className:"h-12 rounded-2xl bg-muted/30 animate-pulse"}),e.jsx("div",{className:"space-y-3",children:[1,2,3,4].map(n=>e.jsx("div",{className:"rounded-2xl border bg-card p-4 shadow-sm",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"h-12 w-12 shrink-0 rounded-xl bg-muted animate-pulse"}),e.jsxs("div",{className:"flex-1 min-w-0 space-y-2",children:[e.jsx("div",{className:"h-4 w-3/4 rounded bg-muted animate-pulse"}),e.jsx("div",{className:"h-3 w-1/2 rounded bg-muted animate-pulse"})]}),e.jsx("div",{className:"h-10 w-10 shrink-0 rounded-full bg-muted animate-pulse"})]})},n))})]}),I==="list"&&!ue&&e.jsxs("div",{className:"space-y-5 animate-in fade-in motion-reduce:animate-none",children:[e.jsxs("p",{className:"text-center text-sm text-muted-foreground py-1",children:[Ce.length," séance",Ce.length>1?"s":""," disponible",Ce.length>1?"s":""]}),e.jsx("div",{className:"flex justify-center gap-2",children:Ve.map(n=>e.jsx("button",{type:"button",onClick:()=>M(Qe(n.value)),className:he("px-5 py-2.5 rounded-full text-sm font-semibold transition-all active:scale-95",N===n.value?"bg-primary text-primary-foreground shadow-md":"bg-muted/50 text-muted-foreground hover:bg-muted"),children:n.label},n.value))}),e.jsxs("div",{className:"relative",children:[e.jsx(Qn,{className:"absolute left-4 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground pointer-events-none"}),e.jsx(wt,{placeholder:"Rechercher une séance...",className:"h-12 rounded-2xl bg-muted/30 pl-11 pr-4 border-0 shadow-sm focus-visible:ring-2",value:xe,onChange:n=>_(n.target.value),"aria-label":"Rechercher une séance"})]}),B&&e.jsxs("div",{className:"relative overflow-hidden rounded-2xl bg-gradient-to-br from-primary/10 via-primary/5 to-transparent border-2 border-primary/30 p-5",children:[e.jsx("div",{className:"absolute top-0 right-0 w-24 h-24 bg-primary/10 rounded-full blur-2xl -mr-8 -mt-8"}),e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsxs("span",{className:"relative flex h-3 w-3",children:[e.jsx("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-primary opacity-75"}),e.jsx("span",{className:"relative inline-flex rounded-full h-3 w-3 bg-primary"})]}),e.jsx("span",{className:"text-xs font-bold uppercase tracking-wider text-primary",children:w?"Complétée":"En cours"})]}),e.jsx("h3",{className:"text-xl font-bold tracking-tight mb-1",children:me?.title??"Séance en cours"}),e.jsxs("p",{className:"text-sm text-muted-foreground mb-4",children:["Démarrée le ",ht(new Date(B.started_at||new Date),"dd MMMM",{locale:pt})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex justify-between text-xs font-semibold mb-1.5",children:[e.jsx("span",{className:"text-muted-foreground",children:"Progression"}),e.jsxs("span",{className:"text-primary",children:[Math.round(B.progress_pct??0),"%"]})]}),e.jsx("div",{className:"h-2 rounded-full bg-muted overflow-hidden",children:e.jsx("div",{className:"h-full rounded-full bg-primary transition-all duration-500",style:{width:`${B.progress_pct??0}%`}})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(F,{className:"flex-1 h-12 rounded-xl font-semibold",disabled:!qe,onClick:()=>{if(!me)return;const n=me.items??[],c=Qe(me.cycle??n.find(S=>S.cycle_type)?.cycle_type),P=n.filter(S=>S.cycle_type===c),u=vn(P.length?P:n);j(me),E({...me,title:me.title,description:me.description,cycle:c,items:u}),H(B.id),D(B.logs??[]),y(gn(u,B.logs??[],B.progress_pct)),O("focus")},children:w?"Voir le résumé":"Reprendre"}),!w&&e.jsx(F,{variant:"outline",className:"h-12 w-12 rounded-xl p-0",disabled:oe.isPending,onClick:()=>{!B||!window.confirm("Supprimer la séance en cours ?")||oe.mutate(B.id)},"aria-label":"Supprimer la séance",children:e.jsx(vt,{className:"h-5 w-5"})})]})]})]}),!B&&Ce.length>0&&e.jsxs("div",{className:"flex items-center gap-2 pt-2",children:[e.jsx(Ye,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-xs font-semibold uppercase tracking-wider text-muted-foreground",children:"Choisir une séance"})]}),Ce.length>0?e.jsx("div",{className:"space-y-3",children:Ce.map(n=>e.jsx("button",{type:"button",className:"group w-full rounded-2xl border bg-card p-4 text-left shadow-sm transition-all active:scale-[0.98] hover:shadow-md hover:border-primary/30",onClick:()=>{if(n.type==="assignment"){Je(n.assignment);return}Re(n.session)},children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:he("flex h-12 w-12 shrink-0 items-center justify-center rounded-xl",n.type==="assignment"?"bg-primary/10 text-primary":"bg-muted text-muted-foreground"),children:e.jsx(Ye,{className:"h-5 w-5"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-0.5",children:[n.type==="assignment"&&e.jsx("span",{className:"inline-flex items-center rounded-full bg-primary/10 px-2 py-0.5 text-[10px] font-bold uppercase text-primary",children:"Assignée"}),n.type==="assignment"&&n.assignedDate&&e.jsx("span",{className:"text-xs text-muted-foreground",children:ht(new Date(n.assignedDate),"dd MMM",{locale:pt})})]}),e.jsx("h3",{className:"font-semibold tracking-tight truncate",children:n.title}),e.jsxs("p",{className:"text-sm text-muted-foreground truncate",children:[n.exerciseCount," exercice",n.exerciseCount>1?"s":"",n.description?` · ${n.description}`:""]})]}),e.jsx("div",{className:"flex h-10 w-10 shrink-0 items-center justify-center rounded-full bg-muted/50 text-muted-foreground transition-colors group-hover:bg-primary group-hover:text-primary-foreground",children:e.jsx(Pt,{className:"h-4 w-4 ml-0.5"})})]})},n.key))}):e.jsxs("div",{className:"py-12 text-center",children:[e.jsx("div",{className:"mx-auto mb-4 flex h-16 w-16 items-center justify-center rounded-full bg-muted",children:e.jsx(Ye,{className:"h-7 w-7 text-muted-foreground"})}),e.jsx("h3",{className:"font-semibold",children:"Aucune séance"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Essayez un autre mot-clé ou changez de cycle."})]})]}),I==="settings"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[e.jsxs(F,{variant:"ghost",size:"sm",onClick:()=>O("list"),className:"gap-2",children:[e.jsx(Ft,{className:"h-4 w-4"}),"Retour"]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.3em] text-muted-foreground",children:"Préférences"}),e.jsx("h2",{className:"text-2xl font-display font-bold uppercase text-primary",children:"Paramètres"})]})]}),e.jsxs(Xe,{className:"border border-muted/60 shadow-sm",children:[e.jsxs(Rt,{children:[e.jsx(Et,{className:"text-lg uppercase",children:"Lisibilité & contrastes"}),e.jsx(Kt,{children:"Ajuste l'écran pour rester lisible en bassin comme en extérieur."})]}),e.jsxs(kt,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-4 rounded-lg border bg-muted/30 p-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm font-semibold uppercase",children:"Mode piscine"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Contraste renforcé et lisibilité optimisée."})]}),e.jsx(Dt,{checked:De,onCheckedChange:n=>ie(c=>({...c,poolMode:n}))})]}),e.jsxs("div",{className:"flex items-center justify-between gap-4 rounded-lg border bg-muted/30 p-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm font-semibold uppercase",children:"Texte grand"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Police plus large pour lire pendant l'effort."})]}),e.jsx(Dt,{checked:Te,onCheckedChange:n=>ie(c=>({...c,largeText:n}))})]})]})]}),e.jsx(Xe,{className:"border border-muted/60 shadow-sm",children:e.jsxs(kt,{className:"space-y-3 pt-6",children:[e.jsxs("div",{className:"flex items-center gap-3 text-sm text-muted-foreground",children:[e.jsx(Kn,{className:"h-4 w-4"}),e.jsx("span",{children:"Les préférences sont enregistrées sur cet appareil."})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 text-xs font-semibold uppercase text-muted-foreground",children:[De&&e.jsx(dt,{variant:"secondary",children:"Mode piscine activé"}),Te&&e.jsx(dt,{variant:"secondary",children:"Texte grand activé"}),!De&&!Te&&e.jsx(dt,{variant:"outline",children:"Réglages par défaut"})]})]})})]}),I==="reader"&&m&&e.jsxs("div",{className:"space-y-5 animate-in fade-in motion-reduce:animate-none pb-40",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{type:"button",onClick:()=>O("list"),className:"flex h-10 w-10 items-center justify-center rounded-full bg-muted/50 text-muted-foreground transition-colors hover:bg-muted active:scale-95","aria-label":"Retour",children:e.jsx(Ft,{className:"h-5 w-5"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-xs font-semibold uppercase tracking-wider text-muted-foreground truncate",children:Ve.find(n=>n.value===N)?.label}),e.jsx("h1",{className:"text-xl font-bold tracking-tight truncate",children:m.title})]})]}),e.jsxs("div",{className:"relative overflow-hidden rounded-2xl bg-gradient-to-br from-primary/10 via-primary/5 to-transparent border border-primary/20 p-5",children:[e.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-primary/10 rounded-full blur-3xl -mr-12 -mt-12"}),e.jsxs("div",{className:"relative space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[g&&e.jsxs("span",{className:"inline-flex items-center gap-1.5 rounded-full bg-primary/20 px-3 py-1 text-xs font-bold uppercase text-primary",children:[e.jsx("span",{className:"h-1.5 w-1.5 rounded-full bg-primary"}),"Assignée"]}),!g&&e.jsx("span",{className:"inline-flex items-center rounded-full bg-muted px-3 py-1 text-xs font-semibold text-muted-foreground",children:"Catalogue"}),g?.assigned_date&&e.jsxs("span",{className:"text-xs text-muted-foreground",children:["Prévue le ",ht(new Date(g.assigned_date),"dd MMM",{locale:pt})]})]}),m.description&&e.jsx("p",{className:"text-sm text-muted-foreground leading-relaxed",children:m.description}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex h-9 w-9 items-center justify-center rounded-xl bg-background/80",children:e.jsx(Ye,{className:"h-4 w-4 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-bold leading-none",children:ae.length}),e.jsx("p",{className:"text-[10px] uppercase text-muted-foreground font-semibold",children:"Exercices"})]})]}),e.jsx("div",{className:"h-8 w-px bg-border"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex h-9 w-9 items-center justify-center rounded-xl bg-background/80",children:e.jsx(Xn,{className:"h-4 w-4 text-muted-foreground"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-bold leading-none",children:Ve.find(n=>n.value===N)?.label}),e.jsx("p",{className:"text-[10px] uppercase text-muted-foreground font-semibold",children:"Cycle"})]})]})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between gap-2 pt-1",children:[e.jsxs("span",{className:"text-xs font-semibold uppercase tracking-wider text-muted-foreground",children:[ae.length," exercice",ae.length>1?"s":""]}),e.jsx("div",{className:"flex-1 h-px bg-border"})]}),e.jsxs("div",{className:"space-y-2",children:[ae.map((n,c)=>{const P=k.get(n.exercise_id),u=Number(n.percent_1rm),S=Number.isFinite(u)&&u>0,A=S?Fe?.find(je=>je.exercise_id===n.exercise_id)?.weight??0:0,T=S?Math.round(A*(u/100)):0,W=S?T>0?`${T} kg (${u}% 1RM)`:`${u}% 1RM`:null,ne=n.notes?.trim(),ee=Ut(n.sets),de=Ut(n.reps),le=Fs(n.rest_seconds);return e.jsxs(Qt,{children:[e.jsx(Tn,{asChild:!0,children:e.jsxs("button",{type:"button",className:"w-full flex items-center gap-3 rounded-xl border bg-card px-3 py-3 text-left transition-all active:scale-[0.98] hover:border-primary/50 hover:shadow-sm",children:[e.jsx("div",{className:"flex h-7 w-7 shrink-0 items-center justify-center rounded-full bg-primary text-xs font-bold text-primary-foreground",children:c+1}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsx("p",{className:"font-semibold text-sm truncate",children:P?.nom_exercice??n.exercise_name??"Exercice"})}),e.jsxs("div",{className:"flex items-center gap-2 shrink-0 text-xs font-medium text-muted-foreground",children:[e.jsxs("span",{className:"font-mono",children:[ee,"×",de]}),e.jsx("span",{className:"text-border",children:"|"}),e.jsx("span",{className:"font-mono",children:le}),e.jsx(Tt,{className:"h-4 w-4 text-muted-foreground/50"})]})]})}),e.jsxs(Yt,{side:"bottom",className:"max-h-[90vh] overflow-y-auto rounded-t-3xl pb-8",children:[e.jsx(Xt,{className:"text-left pb-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex h-10 w-10 shrink-0 items-center justify-center rounded-full bg-primary text-sm font-bold text-primary-foreground",children:c+1}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx(Gt,{className:"text-xl leading-tight",children:P?.nom_exercice??n.exercise_name??"Exercice"}),P?.exercise_type&&e.jsx("p",{className:"text-sm text-muted-foreground mt-0.5",children:P.exercise_type})]})]})}),e.jsxs("div",{className:"space-y-4",children:[P?.illustration_gif&&e.jsx("div",{className:"rounded-xl overflow-hidden bg-muted/20 border aspect-video flex items-center justify-center",children:e.jsx("img",{src:P.illustration_gif,alt:P.nom_exercice??"Exercice",className:"w-full h-full max-h-36 object-contain",loading:"lazy",decoding:"async"})}),P?.description&&e.jsx("div",{className:"text-sm text-muted-foreground leading-relaxed",children:P.description}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:"rounded-xl bg-muted/40 p-3 text-center",children:[e.jsx("p",{className:"text-2xl font-bold leading-none",children:ee}),e.jsx("p",{className:"text-[10px] uppercase text-muted-foreground font-semibold mt-1",children:"Séries"})]}),e.jsxs("div",{className:"rounded-xl bg-muted/40 p-3 text-center",children:[e.jsx("p",{className:"text-2xl font-bold leading-none",children:de}),e.jsx("p",{className:"text-[10px] uppercase text-muted-foreground font-semibold mt-1",children:"Reps"})]}),e.jsxs("div",{className:"rounded-xl bg-muted/40 p-3 text-center",children:[e.jsx("p",{className:"text-lg font-bold leading-none",children:W??"—"}),e.jsx("p",{className:"text-[10px] uppercase text-muted-foreground font-semibold mt-1",children:"Charge"})]}),e.jsxs("div",{className:"rounded-xl bg-muted/40 p-3 text-center",children:[e.jsx("p",{className:"text-lg font-bold leading-none",children:le}),e.jsx("p",{className:"text-[10px] uppercase text-muted-foreground font-semibold mt-1",children:"Repos"})]})]}),ne&&e.jsxs("div",{className:"rounded-xl bg-primary/5 border border-primary/20 p-4",children:[e.jsx("div",{className:"text-[10px] uppercase text-primary font-semibold mb-1",children:"Notes coach"}),e.jsx("div",{className:"text-sm text-foreground",children:ne})]})]})]})]},`${n.exercise_id}-${c}`)}),ae.length===0&&e.jsx("div",{className:"p-6 border-2 border-dashed rounded-xl text-center text-muted-foreground",children:"Aucun exercice disponible pour cette séance."})]}),e.jsx(xn,{children:e.jsxs(F,{className:"flex-1 h-14 rounded-xl font-bold text-base bg-primary hover:bg-primary/90 shadow-lg",onClick:Ue,children:[e.jsx(Pt,{className:"h-5 w-5 mr-2"}),"Lancer la séance"]})})]})]}),e.jsxs($t,{value:"history",className:"space-y-4 pt-4",children:[e.jsxs("div",{className:"grid gap-3 md:grid-cols-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(Ze,{htmlFor:"strength-history-status",children:"Statut"}),e.jsxs(Mn,{value:z,onValueChange:q,children:[e.jsx(An,{id:"strength-history-status",children:e.jsx(In,{placeholder:"Tous"})}),e.jsxs(On,{children:[e.jsx(ft,{value:"all",children:"Tous"}),e.jsx(ft,{value:"in_progress",children:"En cours"}),e.jsx(ft,{value:"completed",children:"Terminé"}),e.jsx(ft,{value:"abandoned",children:"Abandonné"})]})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(Ze,{htmlFor:"strength-history-from",children:"Du"}),e.jsx(wt,{id:"strength-history-from",type:"date",value:Q,onChange:n=>x(n.target.value)})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(Ze,{htmlFor:"strength-history-to",children:"Au"}),e.jsx(wt,{id:"strength-history-to",type:"date",value:Y,onChange:n=>X(n.target.value)})]})]}),ye.map(n=>e.jsx(Xe,{className:"group hover:border-primary/50 transition-colors",children:e.jsxs(Rt,{className:"pb-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx(Et,{className:"text-base font-bold uppercase",children:ht(new Date(n.started_at||n.date||n.created_at||new Date),"dd MMM yyyy",{locale:pt})}),e.jsxs("div",{className:"text-sm font-mono font-bold text-muted-foreground group-hover:text-primary",children:[n.duration??0," min"]})]}),e.jsxs("div",{className:"flex gap-2 text-xs font-bold text-muted-foreground",children:[e.jsxs("span",{children:["Difficulté ",n.feeling??n.rpe??0,"/5"]}),e.jsx("span",{children:"•"}),e.jsxs("span",{children:[n.logs?.length||0," Séries"]})]})]})},n.id)),ye.length===0&&e.jsx("div",{className:"text-center text-muted-foreground py-10",children:"Aucun historique."}),ve.hasNextPage&&e.jsx(F,{variant:"outline",size:"sm",className:"w-full",onClick:()=>ve.fetchNextPage(),disabled:ve.isFetchingNextPage,children:ve.isFetchingNextPage?"Chargement...":"Charger plus"})]})]})]})})}export{Ct as buildInProgressRunCache,Bs as createInProgressRun,lr as default,vn as orderStrengthItems,zs as resetStrengthRunState};
