import{r as i,u as N,j as e}from"./vendor-query-DyA9aSKS.js";import{a as k}from"./api-CSvc7NK_.js";import{B as C}from"./badge-BjNkEWSb.js";import{B as _}from"./index-BEFtN8Ff.js";import{C as S}from"./Coach-BdRRd1V3.js";import"./vendor-react-BzrpNAyj.js";import"./swim-BtCWSpXS.js";import"./vendor-charts-BrQ8X25f.js";import"./vendor-supabase-DFPLkPj_.js";import"./vendor-motion-CMsaQ8FX.js";import"./arrow-left-DGbWBg0t.js";import"./search-DstIe6XR.js";import"./chevron-right-B9_58TE1.js";import"./clock-Bdoc0C4T.js";import"./bell-ring-CSPpvxU7.js";function F(n){if(n.length===0)return null;const d=n[0],p=d.effort,g=d.fatigue,l=d.performance,c=d.engagement,o=[];return p!=null&&o.push((11-p)/2),g!=null&&o.push((11-g)/2),l!=null&&o.push(l/2),c!=null&&o.push(c/2),o.length===0?null:Math.round(o.reduce((b,m)=>b+m,0)/o.length*10)/10}function A(n){return n==null?{label:"—",className:"bg-muted text-muted-foreground"}:n>=3.5?{label:`${n.toFixed(1)}`,className:"bg-emerald-100 text-emerald-800 dark:bg-emerald-900/30 dark:text-emerald-400"}:n>=2.5?{label:`${n.toFixed(1)}`,className:"bg-amber-100 text-amber-800 dark:bg-amber-900/30 dark:text-amber-400"}:{label:`${n.toFixed(1)}`,className:"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400"}}function P({athletes:n,athletesLoading:d,onBack:p,onOpenAthlete:g}){const[l,c]=i.useState(null),[o,b]=i.useState("name"),[m,h]=i.useState(30),{data:j=[]}=N({queryKey:["recent-sessions-all",30],queryFn:()=>k.getRecentSessionsAllAthletes(30),enabled:n.length>0,staleTime:300*1e3}),{data:y}=N({queryKey:["objectives-counts-by-user"],queryFn:()=>k.getObjectivesCountsByUser(),enabled:n.length>0,staleTime:300*1e3}),v=i.useMemo(()=>{const s=new Map;return n.forEach(t=>{t.group_id&&t.group_label&&s.set(t.group_id,t.group_label)}),Array.from(s.entries()).map(([t,r])=>({id:t,name:r})).sort((t,r)=>t.name.localeCompare(r.name,"fr"))},[n]),u=i.useMemo(()=>{const s=new Map,t=new Map;for(const r of j){if(r.athlete_id==null)continue;const a=t.get(r.athlete_id)??[];a.push(r),t.set(r.athlete_id,a)}for(const r of n){if(r.id==null)continue;const a=t.get(r.id)??[],x=F(a),w=a.length>0?a[0].session_date:null;s.set(r.id,{forme:x,lastSessionDate:w,sessionsCount30d:a.length,assiduity:null,objectivesTotal:y?.get(r.id)??0,objectivesAchieved:0})}return s},[n,j,y]),f=i.useMemo(()=>{let s=[...n];switch(l!=null&&(s=s.filter(t=>t.group_id===l)),o){case"forme":s.sort((t,r)=>{const a=t.id!=null?u.get(t.id)?.forme??99:99,x=r.id!=null?u.get(r.id)?.forme??99:99;return a-x});break;case"assiduity":s.sort((t,r)=>{const a=t.id!=null?u.get(t.id)?.sessionsCount30d??99:99,x=r.id!=null?u.get(r.id)?.sessionsCount30d??99:99;return a-x});break;default:s.sort((t,r)=>t.display_name.localeCompare(r.display_name,"fr"))}return s},[n,l,o,u]);return i.useEffect(()=>{h(30)},[l,o]),e.jsxs("div",{className:"space-y-4",children:[e.jsx(S,{title:"Nageurs",description:d?"Chargement…":`${n.length} nageur${n.length!==1?"s":""}`,onBack:p}),v.length>1&&e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{type:"button",onClick:()=>c(null),className:`rounded-full px-3 py-2 text-xs font-medium border transition ${l==null?"bg-foreground text-background border-foreground":"bg-card text-foreground border-border hover:bg-muted"}`,children:"Tous"}),v.map(s=>e.jsx("button",{type:"button",onClick:()=>c(l===s.id?null:s.id),className:`rounded-full px-3 py-2 text-xs font-medium border transition ${l===s.id?"bg-foreground text-background border-foreground":"bg-card text-foreground border-border hover:bg-muted"}`,children:s.name},s.id))]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"Trier :"}),[{key:"name",label:"Nom"},{key:"forme",label:"Forme"},{key:"assiduity",label:"Activité"}].map(s=>e.jsx("button",{type:"button",onClick:()=>b(s.key),className:`rounded-full px-2.5 py-1.5 text-xs font-medium border transition ${o===s.key?"bg-primary/10 text-primary border-primary/30":"bg-card text-muted-foreground border-border hover:bg-muted"}`,children:s.label},s.key))]}),d?e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3",children:[1,2,3,4,5,6].map(s=>e.jsxs("div",{className:"rounded-2xl border bg-card p-4 animate-pulse motion-reduce:animate-none",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-muted"}),e.jsxs("div",{className:"space-y-1.5 flex-1",children:[e.jsx("div",{className:"h-4 w-24 rounded bg-muted"}),e.jsx("div",{className:"h-3 w-16 rounded bg-muted"})]})]}),e.jsxs("div",{className:"mt-3 space-y-2",children:[e.jsx("div",{className:"h-3 w-full rounded bg-muted"}),e.jsx("div",{className:"h-3 w-2/3 rounded bg-muted"})]})]},s))}):f.length===0?e.jsx("p",{className:"text-sm text-muted-foreground text-center py-8",children:l!=null?"Aucun nageur dans ce groupe.":"Aucun nageur disponible."}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3",children:f.slice(0,m).map(s=>{const t=s.id!=null?u.get(s.id):null,r=A(t?.forme??null);return e.jsxs("button",{type:"button",onClick:()=>g(s),className:"rounded-2xl border bg-card p-4 text-left hover:shadow-md hover:border-primary/20 transition-all",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[s.avatar_url?e.jsx("img",{src:s.avatar_url,alt:"",className:"h-10 w-10 rounded-full object-cover border border-border"}):e.jsx("div",{className:"h-10 w-10 rounded-full bg-primary/10 flex items-center justify-center text-sm font-bold text-primary",children:s.display_name.charAt(0).toUpperCase()}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-sm font-semibold truncate",children:s.display_name}),s.group_label&&e.jsx(C,{variant:"secondary",className:"text-[10px] px-1.5 py-0 mt-0.5",children:s.group_label})]})]}),e.jsxs("div",{className:"mt-3 grid grid-cols-3 gap-2",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-[10px] font-medium text-muted-foreground mb-1",children:"Forme"}),e.jsx("span",{className:`inline-block rounded-full px-2 py-0.5 text-xs font-semibold ${r.className}`,children:r.label})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-[10px] font-medium text-muted-foreground mb-1",children:"30j"}),e.jsx("span",{className:"text-sm font-bold text-foreground",children:t?.sessionsCount30d??0}),e.jsx("span",{className:"text-[10px] text-muted-foreground ml-0.5",children:"séances"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-[10px] font-medium text-muted-foreground mb-1",children:"Objectifs"}),e.jsx("span",{className:"text-sm font-bold text-foreground",children:t?.objectivesTotal??0})]})]}),t?.lastSessionDate&&e.jsxs("div",{className:"mt-2 text-[10px] text-muted-foreground",children:["Dernier ressenti : ",new Date(t.lastSessionDate).toLocaleDateString("fr-FR",{day:"numeric",month:"short"})]})]},s.id??s.display_name)})}),f.length>m&&e.jsxs("div",{className:"flex flex-col items-center gap-2 py-4",children:[e.jsxs("p",{className:"text-xs text-muted-foreground",children:[m," sur ",f.length," nageurs"]}),e.jsx(_,{variant:"outline",size:"sm",onClick:()=>h(s=>s+30),children:"Voir plus"})]})]})]})}export{P as default};
