import{r as u,b as ys,h as Ns,m as qe,n as bs,j as e,d as Oe,o as _s,l as Q,u as de,I as ws,t as Ss,E as Cs}from"./vendor-ui-DJQMR4VV.js";import{b as Es,u as be,c as M}from"./vendor-query-BT4y-huw.js";import{c as ue,a as G,C as Rs,L as j,I as C,f as ks,d as F,B as P,S as Z,D as _e,s as we}from"./index-gotzcQ6I.js";import{u as Ds,S as ee,a as se,b as te,c as re,d as I}from"./select-CIAtPqc9.js";import{C as Fs}from"./circle-ChgtGgbv.js";import{T as V}from"./textarea-DSva-MAf.js";import{D as ae,a as ne,b as ie,c as ce}from"./dialog-a7VtuBpO.js";import{C as Se}from"./checkbox-DT6-6-fS.js";import{A as Ce,a as Ee,b as Re,c as ke,d as De,e as Fe,f as Ie,g as Ae}from"./alert-dialog-Bt7RjcTc.js";import{T as Is,a as As,b as Ms,c as Ps}from"./tabs-23AOAQgF.js";import{A as $s,a as Ls,F as Ts,S as Gs,b as qs}from"./SessionListView-D9RaBmP_.js";import{T as me,P as z}from"./trash-2-CO8YXfYG.js";import{C as Os}from"./chevron-up-DonfcRJ3.js";import{L as Me}from"./loader-circle-B30OsDCk.js";import{C as Us}from"./circle-alert-oF8Z8aYY.js";import{S as Ks}from"./search-CjfAuB9c.js";import{P as Bs}from"./pen-DJH6CoUU.js";import"./vendor-react-BzrpNAyj.js";import"./vendor-charts-Db4xOvcx.js";import"./vendor-supabase-D7B1G6YZ.js";import"./check-BV4OjYk7.js";import"./chevron-left-MTWHc4Zn.js";import"./save-BqEf2f43.js";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vs=[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]],zs=ue("funnel",Vs);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qs=[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]],Ws=ue("grip-vertical",Qs);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hs=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],Pe=ue("upload",Hs);function le(t,a,{checkForDefaultPrevented:n=!0}={}){return function(r){if(t?.(r),n===!1||!r.defaultPrevented)return a?.(r)}}var Xs=ys[" useInsertionEffect ".trim().toString()]||Ns;function Ys({prop:t,defaultProp:a,onChange:n=()=>{},caller:i}){const[r,l,h]=Js({defaultProp:a,onChange:n}),p=t!==void 0,f=p?t:r;{const d=u.useRef(t!==void 0);u.useEffect(()=>{const g=d.current;g!==p&&console.warn(`${i} is changing from ${g?"controlled":"uncontrolled"} to ${p?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),d.current=p},[p,i])}const m=u.useCallback(d=>{if(p){const g=Zs(d)?d(t):d;g!==t&&h.current?.(g)}else l(d)},[p,t,l,h]);return[f,m]}function Js({defaultProp:t,onChange:a}){const[n,i]=u.useState(t),r=u.useRef(n),l=u.useRef(a);return Xs(()=>{l.current=a},[a]),u.useEffect(()=>{r.current!==n&&(l.current?.(n),r.current=n)},[n,r]),[n,i,l]}function Zs(t){return typeof t=="function"}var pe="Radio",[et,Ue]=Oe(pe),[st,tt]=et(pe),Ke=u.forwardRef((t,a)=>{const{__scopeRadio:n,name:i,checked:r=!1,required:l,disabled:h,value:p="on",onCheck:f,form:m,...d}=t,[g,o]=u.useState(null),y=de(a,k=>o(k)),b=u.useRef(!1),E=g?m||!!g.closest("form"):!0;return e.jsxs(st,{scope:n,checked:r,disabled:h,children:[e.jsx(Q.button,{type:"button",role:"radio","aria-checked":r,"data-state":Qe(r),"data-disabled":h?"":void 0,disabled:h,value:p,...d,ref:y,onClick:le(t.onClick,k=>{r||f?.(),E&&(b.current=k.isPropagationStopped(),b.current||k.stopPropagation())})}),E&&e.jsx(ze,{control:g,bubbles:!b.current,name:i,value:p,checked:r,required:l,disabled:h,form:m,style:{transform:"translateX(-100%)"}})]})});Ke.displayName=pe;var Be="RadioIndicator",Ve=u.forwardRef((t,a)=>{const{__scopeRadio:n,forceMount:i,...r}=t,l=tt(Be,n);return e.jsx(Ss,{present:i||l.checked,children:e.jsx(Q.span,{"data-state":Qe(l.checked),"data-disabled":l.disabled?"":void 0,...r,ref:a})})});Ve.displayName=Be;var rt="RadioBubbleInput",ze=u.forwardRef(({__scopeRadio:t,control:a,checked:n,bubbles:i=!0,...r},l)=>{const h=u.useRef(null),p=de(h,l),f=Ds(n),m=Cs(a);return u.useEffect(()=>{const d=h.current;if(!d)return;const g=window.HTMLInputElement.prototype,y=Object.getOwnPropertyDescriptor(g,"checked").set;if(f!==n&&y){const b=new Event("click",{bubbles:i});y.call(d,n),d.dispatchEvent(b)}},[f,n,i]),e.jsx(Q.input,{type:"radio","aria-hidden":!0,defaultChecked:n,...r,tabIndex:-1,ref:p,style:{...r.style,...m,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});ze.displayName=rt;function Qe(t){return t?"checked":"unchecked"}var at=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],W="RadioGroup",[nt]=Oe(W,[qe,Ue]),We=qe(),He=Ue(),[it,ct]=nt(W),Xe=u.forwardRef((t,a)=>{const{__scopeRadioGroup:n,name:i,defaultValue:r,value:l,required:h=!1,disabled:p=!1,orientation:f,dir:m,loop:d=!0,onValueChange:g,...o}=t,y=We(n),b=bs(m),[E,k]=Ys({prop:l,defaultProp:r??null,onChange:g,caller:W});return e.jsx(it,{scope:n,name:i,required:h,disabled:p,value:E,onValueChange:k,children:e.jsx(_s,{asChild:!0,...y,orientation:f,dir:b,loop:d,children:e.jsx(Q.div,{role:"radiogroup","aria-required":h,"aria-orientation":f,"data-disabled":p?"":void 0,dir:b,...o,ref:a})})})});Xe.displayName=W;var Ye="RadioGroupItem",Je=u.forwardRef((t,a)=>{const{__scopeRadioGroup:n,disabled:i,...r}=t,l=ct(Ye,n),h=l.disabled||i,p=We(n),f=He(n),m=u.useRef(null),d=de(a,m),g=l.value===r.value,o=u.useRef(!1);return u.useEffect(()=>{const y=E=>{at.includes(E.key)&&(o.current=!0)},b=()=>o.current=!1;return document.addEventListener("keydown",y),document.addEventListener("keyup",b),()=>{document.removeEventListener("keydown",y),document.removeEventListener("keyup",b)}},[]),e.jsx(ws,{asChild:!0,...p,focusable:!h,active:g,children:e.jsx(Ke,{disabled:h,required:l.required,checked:g,...f,...r,name:l.name,ref:d,onCheck:()=>l.onValueChange(r.value),onKeyDown:le(y=>{y.key==="Enter"&&y.preventDefault()}),onFocus:le(r.onFocus,()=>{o.current&&m.current?.click()})})})});Je.displayName=Ye;var lt="RadioGroupIndicator",Ze=u.forwardRef((t,a)=>{const{__scopeRadioGroup:n,...i}=t,r=He(n);return e.jsx(Ve,{...r,...i,ref:a})});Ze.displayName=lt;var es=Xe,ss=Je,ot=Ze;const ts=u.forwardRef(({className:t,...a},n)=>e.jsx(es,{className:G("grid gap-2",t),...a,ref:n}));ts.displayName=es.displayName;const oe=u.forwardRef(({className:t,...a},n)=>e.jsx(ss,{ref:n,className:G("aspect-square h-4 w-4 rounded-full border border-primary text-primary shadow focus:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",t),...a,children:e.jsx(ot,{className:"flex items-center justify-center",children:e.jsx(Fs,{className:"h-3.5 w-3.5 fill-primary"})})}));oe.displayName=ss.displayName;function dt({items:t,renderItem:a,onMoveUp:n,onMoveDown:i,onDelete:r,showControls:l=!0,className:h=""}){return e.jsx("div",{className:h,children:t.map((p,f)=>e.jsxs("div",{className:"flex items-start gap-3",children:[l&&e.jsx("span",{className:"mt-1 inline-flex h-9 w-9 items-center justify-center rounded-2xl bg-muted text-muted-foreground",children:e.jsx(Ws,{className:"h-4 w-4"})}),e.jsx("div",{className:"flex-1",children:a(p,f)}),l&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{type:"button",onClick:()=>n(f),className:"inline-flex h-9 w-9 items-center justify-center rounded-full hover:bg-muted disabled:opacity-40","aria-label":"Monter",title:"Monter",disabled:f===0,children:e.jsx($s,{className:"h-4 w-4"})}),e.jsx("button",{type:"button",onClick:()=>i(f),className:"inline-flex h-9 w-9 items-center justify-center rounded-full hover:bg-muted disabled:opacity-40","aria-label":"Descendre",title:"Descendre",disabled:f===t.length-1,children:e.jsx(Ls,{className:"h-4 w-4"})}),e.jsx("button",{type:"button",onClick:()=>r(f),className:"inline-flex h-9 w-9 items-center justify-center rounded-full text-destructive hover:bg-destructive/10","aria-label":"Supprimer",title:"Supprimer",children:e.jsx(me,{className:"h-4 w-4"})})]})]},f))})}function ut({exercise:t,exercises:a,exerciseFilter:n,index:i,onChange:r,onDelete:l}){const[h,p]=u.useState(!1),f=a.filter(o=>n==="all"?!0:o.exercise_type===n),m=a.find(o=>o.id===t.exercise_id),d=m?.nom_exercice??"Exercice",g=m?.exercise_type==="warmup";return e.jsxs(Rs,{className:G("rounded-2xl border-border transition-all",h&&"ring-1 ring-primary/20"),children:[e.jsxs("button",{type:"button",className:"flex w-full items-center gap-3 p-3 text-left",onClick:()=>p(!h),children:[e.jsx("span",{className:"flex h-7 w-7 shrink-0 items-center justify-center rounded-full bg-muted text-xs font-bold text-muted-foreground",children:i+1}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"truncate text-sm font-semibold",children:d}),g&&e.jsx("span",{className:"shrink-0 rounded-full bg-amber-100 px-2 py-0.5 text-[10px] font-semibold text-amber-800",children:"Échauf."})]}),e.jsxs("div",{className:"mt-0.5 text-xs text-muted-foreground",children:[t.sets,"×",t.reps,t.percent_1rm?` @ ${t.percent_1rm}% 1RM`:"",t.rest_seconds?` · ${t.rest_seconds}s repos`:""]})]}),e.jsx(Os,{className:G("h-4 w-4 shrink-0 text-muted-foreground transition-transform",h&&"rotate-180")})]}),h&&e.jsxs("div",{className:"border-t border-border px-3 pb-3 pt-3 space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(j,{className:"text-xs",children:"Séries"}),e.jsx(C,{type:"number",inputMode:"numeric",value:t.sets===0?"":t.sets,onChange:o=>r("sets",o.target.value===""?0:Number(o.target.value)),className:"rounded-xl h-10"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(j,{className:"text-xs",children:"Reps"}),e.jsx(C,{type:"number",inputMode:"numeric",value:t.reps===0?"":t.reps,onChange:o=>r("reps",o.target.value===""?0:Number(o.target.value)),className:"rounded-xl h-10"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(j,{className:"text-xs",children:"% 1RM"}),e.jsx(C,{type:"number",inputMode:"numeric",value:t.percent_1rm===0?"":t.percent_1rm,onChange:o=>r("percent_1rm",o.target.value===""?0:Number(o.target.value)),className:"rounded-xl h-10"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(j,{className:"text-xs",children:"Repos (s)"}),e.jsx(C,{type:"number",inputMode:"numeric",value:t.rest_seconds===0?"":t.rest_seconds,onChange:o=>r("rest_seconds",o.target.value===""?0:Number(o.target.value)),className:"rounded-xl h-10"})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(j,{className:"text-xs",children:"Exercice"}),e.jsxs(ee,{value:t.exercise_id.toString(),onValueChange:o=>r("exercise_id",parseInt(o)),children:[e.jsx(se,{className:"rounded-xl",children:e.jsx(te,{})}),e.jsx(re,{children:f.length?f.map(o=>e.jsxs(I,{value:o.id.toString(),children:[o.nom_exercice,o.exercise_type==="warmup"?" · Échauffement":""]},o.id)):e.jsx(I,{value:"no-exercise",disabled:!0,children:"Aucun exercice disponible"})})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(j,{className:"text-xs",children:"Notes"}),e.jsx(V,{value:t.notes??"",onChange:o=>r("notes",o.target.value||null),placeholder:"Notes optionnelles...",className:"rounded-xl min-h-[60px]"})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs("button",{type:"button",onClick:o=>{o.stopPropagation(),l()},className:"inline-flex h-9 items-center gap-2 rounded-full px-3 text-xs font-medium text-destructive hover:bg-destructive/10",children:[e.jsx(me,{className:"h-3.5 w-3.5"}),"Supprimer"]})})]})]})}const mt=t=>t==="endurance"||t==="hypertrophie"||t==="force"?t:"endurance";function pt({session:t,exercises:a,editingSessionId:n,onSessionChange:i,onSave:r,onCancel:l,onAddItem:h,onUpdateItem:p,onRemoveItem:f,onReorderItems:m,onExerciseDialogOpen:d,isSaving:g}){const[o,y]=u.useState("all"),[b,E]=u.useState(!1),k=new Map(a.map(x=>[x.id,x])),H=t.items.reduce((x,S)=>x+(S.sets||0),0),X=x=>{x>0&&m(x,x-1)},q=x=>{x<t.items.length-1&&m(x,x+1)},$=()=>{E(!0)};return e.jsxs("div",{className:"space-y-4 animate-in slide-in-from-bottom-4",children:[e.jsx(Ts,{isEditing:!!n,isSaving:g,onSave:r,onCancel:l,onPreview:$}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsx(Gs,{name:t.title,onNameChange:x=>i({...t,title:x}),showDuration:!1,showTotalDistance:!1,additionalFields:e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-semibold text-muted-foreground",children:"Cycle"}),e.jsx("div",{className:"mt-1",children:e.jsxs(ee,{value:t.cycle,onValueChange:x=>i({...t,cycle:mt(x)}),children:[e.jsx(se,{className:"rounded-2xl",children:e.jsx(te,{})}),e.jsxs(re,{children:[e.jsx(I,{value:"endurance",children:"Endurance"}),e.jsx(I,{value:"hypertrophie",children:"Hypertrophie"}),e.jsx(I,{value:"force",children:"Force"})]})]})})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-semibold text-muted-foreground",children:"Séries totales"}),e.jsx("div",{className:"mt-1 rounded-2xl border border-border bg-muted px-3 py-2 text-sm font-semibold",children:H})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("div",{className:"text-xs font-semibold text-muted-foreground",children:"Description"}),e.jsx("div",{className:"mt-1",children:e.jsx(V,{value:t.description,onChange:x=>i({...t,description:x.target.value}),placeholder:"Description optionnelle...",className:"rounded-2xl min-h-[60px]"})})]})]})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm font-semibold",children:["Exercices (",t.items.length,")"]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(ee,{value:o,onValueChange:x=>y(x),children:[e.jsxs(se,{className:"h-8 w-auto gap-1 rounded-full border-dashed text-xs",children:[e.jsx(zs,{className:"h-3 w-3"}),e.jsx(te,{})]}),e.jsxs(re,{children:[e.jsx(I,{value:"all",children:"Tous"}),e.jsx(I,{value:"strength",children:"Travail"}),e.jsx(I,{value:"warmup",children:"Échauf."})]})]})})]}),e.jsx(dt,{items:t.items,className:"space-y-2",onMoveUp:X,onMoveDown:q,onDelete:f,renderItem:(x,S)=>e.jsx(ut,{exercise:x,exercises:a,exerciseFilter:o,index:S,onChange:(L,O)=>p(S,L,O),onDelete:()=>f(S)})}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs("button",{type:"button",onClick:h,className:"inline-flex items-center gap-2 rounded-full bg-primary px-4 py-2 text-xs font-semibold text-primary-foreground",children:[e.jsx(z,{className:"h-4 w-4"})," Ajouter un exercice"]}),e.jsxs("button",{type:"button",onClick:d,className:"inline-flex items-center gap-2 rounded-full border border-border px-4 py-2 text-xs font-semibold hover:bg-muted",children:[e.jsx(z,{className:"h-4 w-4"})," Nouvel exercice"]})]})]}),e.jsx(ae,{open:b,onOpenChange:E,children:e.jsxs(ne,{className:"sm:max-w-3xl",children:[e.jsx(ie,{children:e.jsx(ce,{children:"Aperçu de la séance"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-lg font-semibold",children:t.title||"Sans titre"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:t.description||"—"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Cycle : ",t.cycle]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm font-semibold",children:"Exercices"}),e.jsx("div",{className:"space-y-2",children:t.items.slice().sort((x,S)=>(x.order_index??0)-(S.order_index??0)).map((x,S)=>{const L=k.get(x.exercise_id);return e.jsxs("div",{className:"rounded-xl border px-3 py-2 text-sm",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("span",{className:"font-medium",children:[S+1,". ",L?.nom_exercice??"Exercice"]}),e.jsx("span",{className:"text-xs text-muted-foreground",children:L?.exercise_type==="warmup"?"Échauffement":"Travail"})]}),e.jsxs("div",{className:"mt-1 text-xs text-muted-foreground",children:[x.sets," séries • ",x.reps," reps • ",x.percent_1rm,"% 1RM •"," ",x.rest_seconds,"s"]})]},`${x.exercise_id}-${S}`)})})]})]})]})})]})}const $e=[{key:"endurance",label:"Endurance",fieldSuffix:"endurance"},{key:"hypertrophie",label:"Hypertrophie",fieldSuffix:"hypertrophie"},{key:"force",label:"Force",fieldSuffix:"force"}],xt=t=>t==="endurance"||t==="hypertrophie"||t==="force"?t:"endurance",Le=({exercise:t,onChange:a,disabled:n=!1})=>e.jsxs(Is,{defaultValue:"endurance",className:"w-full",children:[e.jsx(As,{className:"grid w-full grid-cols-3",children:$e.map(i=>e.jsx(Ms,{value:i.key,children:i.label},i.key))}),$e.map(i=>{const r=`pct_1rm_${i.fieldSuffix}`,l=`Nb_series_${i.fieldSuffix}`,h=`Nb_reps_${i.fieldSuffix}`,p=`recup_${i.fieldSuffix}`,f=`recup_exercices_${i.fieldSuffix}`;return e.jsxs(Ps,{value:i.key,className:`space-y-3 rounded-lg border p-3 ${n?"opacity-60":""}`,children:[e.jsx("p",{className:"text-sm font-semibold",children:i.label}),e.jsxs("div",{className:"grid gap-3 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{children:"% 1RM"}),e.jsx(C,{type:"number",value:t[r]??"",disabled:n,onChange:m=>a({[r]:m.target.value===""?null:Number(m.target.value)})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{children:"Nb séries"}),e.jsx(C,{type:"number",value:t[l]??"",disabled:n,onChange:m=>a({[l]:m.target.value===""?null:Number(m.target.value)})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{children:"Nb reps"}),e.jsx(C,{type:"number",value:t[h]??"",disabled:n,onChange:m=>a({[h]:m.target.value===""?null:Number(m.target.value)})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{children:"Récup. séries (s)"}),e.jsx(C,{type:"number",value:t[p]??"",disabled:n,onChange:m=>a({[p]:m.target.value===""?null:Number(m.target.value)})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{children:"Récup. exercices (s)"}),e.jsx(C,{type:"number",value:t[f]??"",disabled:n,onChange:m=>a({[f]:m.target.value===""?null:Number(m.target.value)})})]})]})]},i.key)})]}),ht={pct_1rm_endurance:60,pct_1rm_hypertrophie:75,pct_1rm_force:85,Nb_series_endurance:4,Nb_series_hypertrophie:3,Nb_series_force:3,Nb_reps_endurance:16,Nb_reps_hypertrophie:8,Nb_reps_force:3,recup_endurance:120,recup_hypertrophie:200,recup_force:300,recup_exercices_endurance:300,recup_exercices_hypertrophie:400,recup_exercices_force:500},B=t=>{const a=Number(t);return Number.isFinite(a)?a:0},Te=(t,a,n,i)=>{const r=a==="force"?"force":a==="hypertrophie"?"hypertrophie":"endurance",l=`Nb_series_${r}`,h=`Nb_reps_${r}`,p=`pct_1rm_${r}`,f=`recup_${r}`;return{exercise_id:t.id,order_index:n,sets:B(t[l]),reps:B(t[h]),rest_seconds:B(t[f]),percent_1rm:B(t[p]),cycle_type:a,notes:i?.notes??""}},ft=()=>({nom_exercice:"",description:null,illustration_gif:null,exercise_type:"strength",warmup_reps:null,warmup_duration:null,...ht}),Ge=({exercise:t,warmupMode:a,onChange:n,onWarmupModeChange:i,idPrefix:r})=>e.jsxs("div",{className:"space-y-3 rounded-lg border p-3",children:[e.jsx("p",{className:"text-sm font-semibold",children:"Paramètres d'échauffement"}),e.jsxs(ts,{value:a,onValueChange:l=>{i(l==="duration"?"duration":"reps"),n(l==="duration"?{warmup_reps:null,warmup_duration:t.warmup_duration??0}:{warmup_duration:null,warmup_reps:t.warmup_reps??0})},className:"grid gap-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(oe,{value:"reps",id:`${r}-warmup-reps`}),e.jsx(j,{htmlFor:`${r}-warmup-reps`,children:"Nombre de répétitions"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(oe,{value:"duration",id:`${r}-warmup-duration`}),e.jsx(j,{htmlFor:`${r}-warmup-duration`,children:"Durée (secondes)"})]})]}),a==="duration"?e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{children:"Durée (s)"}),e.jsx(C,{type:"number",value:t.warmup_duration??"",onChange:l=>n({warmup_duration:l.target.value===""?null:Number(l.target.value)})})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{children:"Nombre de répétitions"}),e.jsx(C,{type:"number",value:t.warmup_reps??"",onChange:l=>n({warmup_reps:l.target.value===""?null:Number(l.target.value)})})]})]});function Ot(){const{toast:t}=ks(),a=Es(),[n,i]=u.useState(!1),[r,l]=u.useState(null),[h,p]=u.useState(!1),[f,m]=u.useState(!1),[d,g]=u.useState(null),[o,y]=u.useState(null),[b,E]=u.useState(null),[k,H]=u.useState("reps"),[X,q]=u.useState("reps"),[$,x]=u.useState(!1),[S,L]=u.useState(""),O=async(s,c)=>{if(s.size>10485760){t({title:"Fichier trop volumineux",description:"La taille maximale est de 10 Mo.",variant:"destructive"});return}x(!0);try{const v=s.name.split(".").pop()??"gif",w=`exercises/${Date.now()}-${Math.random().toString(36).slice(2)}.${v}`,{error:K}=await we.storage.from("exercise-gifs").upload(w,s,{upsert:!1});if(K)throw K;const{data:vs}=we.storage.from("exercise-gifs").getPublicUrl(w);c(vs.publicUrl),t({title:"Image uploadée"})}catch(v){const w=v instanceof Error?v.message:"Réessayez.";t({title:"Erreur d'upload",description:w,variant:"destructive"})}finally{x(!1)}},[R,D]=u.useState({title:"",description:"",cycle:"endurance",items:[]}),[_,A]=u.useState({...ft()});u.useEffect(()=>{d&&q(d.warmup_duration!=null?"duration":"reps")},[d]);const{data:T,isLoading:rs,error:Y,refetch:as}=be({queryKey:["exercises"],queryFn:()=>F.getExercises()}),{data:U,isLoading:ns,error:is,refetch:gt}=be({queryKey:["strength_catalog"],queryFn:()=>F.getStrengthSessions()}),cs=u.useMemo(()=>{if(!U)return[];if(!S.trim())return U;const s=S.toLowerCase();return U.filter(c=>c.title?.toLowerCase().includes(s))},[U,S]),ls=M({mutationFn:s=>F.createExercise(s),onSuccess:()=>{a.invalidateQueries({queryKey:["exercises"]}),p(!1),t({title:"Exercice ajouté"})}}),xe=M({mutationFn:s=>F.createStrengthSession(s),onSuccess:()=>{a.invalidateQueries({queryKey:["strength_catalog"]}),i(!1),D({title:"",description:"",cycle:"endurance",items:[]}),t({title:"Séance créée avec succès"})}}),os=M({mutationFn:s=>F.updateExercise(s),onSuccess:()=>{a.invalidateQueries({queryKey:["exercises"]}),a.invalidateQueries({queryKey:["strength_catalog"]}),m(!1),g(null),t({title:"Exercice mis à jour"})}}),ds=M({mutationFn:s=>F.deleteExercise(s),onSuccess:()=>{a.invalidateQueries({queryKey:["exercises"]}),a.invalidateQueries({queryKey:["strength_catalog"]}),E(null),t({title:"Exercice supprimé"})}}),he=M({mutationFn:s=>F.deleteStrengthSession(s),onSuccess:()=>{a.invalidateQueries({queryKey:["strength_catalog"]}),y(null),t({title:"Séance supprimée"})}}),fe=M({mutationFn:s=>F.updateStrengthSession(s),onSuccess:()=>{a.invalidateQueries({queryKey:["strength_catalog"]}),i(!1),l(null),D({title:"",description:"",cycle:"endurance",items:[]}),t({title:"Séance mise à jour"})}}),us=M({mutationFn:s=>F.persistStrengthSessionOrder(s)}),ms=()=>{i(!1),l(null),D({title:"",description:"",cycle:"endurance",items:[]})},ge=s=>{l(s.id),D({title:s.title??"",description:s.description??"",cycle:xt(s.cycle),items:s.items?.map(c=>({exercise_id:c.exercise_id,order_index:c.order_index??0,sets:c.sets,reps:c.reps,rest_seconds:c.rest_seconds,percent_1rm:c.percent_1rm,cycle_type:c.cycle_type,notes:c.notes??""}))??[]}),i(!0)},ps=s=>{g(s),m(!0)},xs=()=>{const s={...R,items:J(R.items)};r?fe.mutate({...s,id:r}):xe.mutate(s)},J=s=>s.map((c,N)=>({...c,order_index:N})),hs=()=>{const s=T?.[0];D(c=>({...c,items:[...c.items,s?Te(s,c.cycle,c.items.length):{exercise_id:1,order_index:c.items.length,sets:0,reps:0,rest_seconds:0,percent_1rm:0}]}))},fs=(s,c,N)=>{const v=[...R.items];if(c==="exercise_id"){const w=T?.find(K=>K.id===N);w?v[s]=Te(w,R.cycle,v[s].order_index??s,v[s]):v[s]={...v[s],exercise_id:Number(N)}}else v[s]={...v[s],[c]:N};D({...R,items:v})},gs=s=>{const c=J(R.items.filter((N,v)=>v!==s));D({...R,items:c})},js=(s,c)=>{if(s===c)return;const N=[...R.items],[v]=N.splice(s,1);N.splice(c,0,v);const w=J(N);D({...R,items:w}),r&&us.mutate({id:r,title:R.title,description:R.description,cycle:R.cycle,items:w})},je=e.jsx(ae,{open:f,onOpenChange:m,children:e.jsxs(ne,{className:"sm:max-w-3xl max-h-[85vh] overflow-y-auto pb-safe",children:[e.jsx(ie,{children:e.jsx(ce,{children:"Modifier l'exercice"})}),d&&e.jsxs("div",{className:"space-y-4",children:[d.exercise_type==="warmup"?e.jsx(Ge,{exercise:d,warmupMode:X,onChange:s=>g(c=>c&&{...c,...s}),onWarmupModeChange:q,idPrefix:"edit"}):null,e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{children:"Nom"}),e.jsx(C,{value:d.nom_exercice,onChange:s=>g({...d,nom_exercice:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{children:"Description"}),e.jsx(V,{value:d.description??"",onChange:s=>g({...d,description:s.target.value===""?null:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{children:"Illustration (GIF)"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(C,{value:d.illustration_gif??"",onChange:s=>g({...d,illustration_gif:s.target.value===""?null:s.target.value}),placeholder:"https://...",className:"flex-1"}),e.jsx(P,{type:"button",variant:"outline",size:"icon",disabled:$,onClick:()=>{const s=document.createElement("input");s.type="file",s.accept="image/*,.gif",s.onchange=c=>{const N=c.target.files?.[0];N&&O(N,v=>g(w=>w&&{...w,illustration_gif:v}))},s.click()},"aria-label":"Uploader une image",children:$?e.jsx(Me,{className:"h-4 w-4 animate-spin"}):e.jsx(Pe,{className:"h-4 w-4"})})]}),d.illustration_gif&&e.jsx("img",{src:d.illustration_gif,alt:"Aperçu",className:"mt-2 h-20 w-20 rounded-lg object-cover border"})]}),d.exercise_type!=="warmup"?e.jsx(Le,{exercise:d,onChange:s=>g(c=>c&&{...c,...s})}):null,e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Se,{id:"warmup-flag-edit",checked:d.exercise_type==="warmup",onCheckedChange:s=>g({...d,exercise_type:s===!0?"warmup":"strength"})}),e.jsx(j,{htmlFor:"warmup-flag-edit",children:"Exercice d'échauffement (warmup)"})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(P,{variant:"outline",onClick:()=>{m(!1),g(null)},className:"h-10",children:"Annuler"}),e.jsx(P,{variant:"default",onClick:()=>{d?.id&&os.mutate(d)},disabled:!d.nom_exercice.trim(),className:"h-10",children:"Enregistrer"})]})]})]})}),ve=e.jsx(ae,{open:h,onOpenChange:p,children:e.jsxs(ne,{className:"sm:max-w-3xl max-h-[85vh] overflow-y-auto pb-safe",children:[e.jsx(ie,{children:e.jsx(ce,{children:"Créer un exercice"})}),e.jsxs("div",{className:"space-y-4",children:[_.exercise_type==="warmup"?e.jsx(Ge,{exercise:_,warmupMode:k,onChange:s=>A(c=>({...c,...s})),onWarmupModeChange:H,idPrefix:"create"}):null,e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{children:"Nom"}),e.jsx(C,{value:_.nom_exercice,onChange:s=>A({..._,nom_exercice:s.target.value}),placeholder:"ex: Rotations Élastique"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{children:"Description"}),e.jsx(V,{value:_.description??"",onChange:s=>A({..._,description:s.target.value===""?null:s.target.value}),placeholder:"Détails, consignes..."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{children:"Illustration (GIF)"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(C,{value:_.illustration_gif??"",onChange:s=>A({..._,illustration_gif:s.target.value===""?null:s.target.value}),placeholder:"https://...",className:"flex-1"}),e.jsx(P,{type:"button",variant:"outline",size:"icon",disabled:$,onClick:()=>{const s=document.createElement("input");s.type="file",s.accept="image/*,.gif",s.onchange=c=>{const N=c.target.files?.[0];N&&O(N,v=>A(w=>({...w,illustration_gif:v})))},s.click()},"aria-label":"Uploader une image",children:$?e.jsx(Me,{className:"h-4 w-4 animate-spin"}):e.jsx(Pe,{className:"h-4 w-4"})})]}),_.illustration_gif&&e.jsx("img",{src:_.illustration_gif,alt:"Aperçu",className:"mt-2 h-20 w-20 rounded-lg object-cover border"})]}),_.exercise_type!=="warmup"?e.jsx(Le,{exercise:_,onChange:s=>A(c=>({...c,...s}))}):null,e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Se,{id:"warmup-flag",checked:_.exercise_type==="warmup",onCheckedChange:s=>A({..._,exercise_type:s===!0?"warmup":"strength"})}),e.jsx(j,{htmlFor:"warmup-flag",children:"Exercice d'échauffement (warmup)"})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(P,{variant:"outline",onClick:()=>p(!1),className:"h-10",children:"Annuler"}),e.jsx(P,{variant:"default",onClick:()=>ls.mutate(_),disabled:!_.nom_exercice.trim(),className:"h-10",children:"Enregistrer"})]})]})]})}),ye=e.jsx(Ce,{open:!!o,onOpenChange:s=>{s||y(null)},children:e.jsxs(Ee,{children:[e.jsxs(Re,{children:[e.jsx(ke,{children:"Supprimer la séance ?"}),e.jsxs(De,{children:['Cette action est définitive. La séance "',o?.title,'" sera supprimée.']})]}),e.jsxs(Fe,{children:[e.jsx(Ie,{children:"Annuler"}),e.jsx(Ae,{onClick:()=>{o?.id&&he.mutate(o.id)},children:"Supprimer"})]})]})}),Ne=e.jsx(Ce,{open:!!b,onOpenChange:s=>{s||E(null)},children:e.jsxs(Ee,{children:[e.jsxs(Re,{children:[e.jsx(ke,{children:"Supprimer l'exercice ?"}),e.jsxs(De,{children:[`Cette action est définitive. L'exercice "`,b?.nom_exercice,'" sera supprimé.']})]}),e.jsxs(Fe,{children:[e.jsx(Ie,{children:"Annuler"}),e.jsx(Ae,{onClick:()=>{b?.id&&ds.mutate(b.id)},children:"Supprimer"})]})]})});return n?e.jsxs(e.Fragment,{children:[ve,je,ye,Ne,e.jsx(pt,{session:R,exercises:T??[],editingSessionId:r,onSessionChange:D,onSave:xs,onCancel:ms,onAddItem:hs,onUpdateItem:fs,onRemoveItem:gs,onReorderItems:js,onExerciseDialogOpen:()=>p(!0),isSaving:xe.isPending||fe.isPending})]}):rs?e.jsxs("div",{className:"space-y-4 p-4",children:[e.jsx(Z,{className:"h-7 w-64"}),e.jsx(Z,{className:"h-10 w-full rounded-2xl"}),e.jsx("div",{className:"space-y-3",children:Array.from({length:4}).map((s,c)=>e.jsx(Z,{className:"h-20 w-full rounded-2xl"},c))})]}):Y?e.jsxs("div",{className:"flex flex-col items-center justify-center p-8 text-center",children:[e.jsx(Us,{className:"h-12 w-12 text-destructive mb-4"}),e.jsx("h3",{className:"font-semibold",children:"Impossible de charger les données"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:Y instanceof Error?Y.message:"Une erreur s'est produite"}),e.jsx(P,{variant:"default",onClick:()=>as(),className:"mt-4 h-12 md:h-10",children:"Réessayer"})]}):e.jsxs("div",{children:[ve,je,ye,Ne,e.jsxs("div",{className:"flex items-center justify-between border-b border-border px-4 py-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-base font-semibold",children:"Musculation"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Catalogue"})]}),e.jsxs("button",{type:"button",onClick:()=>{l(null),D({title:"",description:"",cycle:"endurance",items:[]}),i(!0)},className:"inline-flex items-center gap-2 rounded-full bg-primary px-3 py-2 text-xs font-semibold text-primary-foreground",children:[e.jsx(z,{className:"h-4 w-4"})," Nouvelle"]})]}),e.jsxs("div",{className:"p-4 space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-2 rounded-2xl border border-border bg-card px-3 py-2",children:[e.jsx(Ks,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("input",{className:"w-full bg-transparent text-sm outline-none placeholder:text-muted-foreground",placeholder:"Rechercher une séance",value:S,onChange:s=>L(s.target.value)})]}),e.jsx(qs,{sessions:cs,isLoading:ns,error:is,renderTitle:s=>s.title??"Sans titre",renderMetrics:s=>{const c=s.items?.length??0,N=s.cycle==="force"?"bg-red-100 text-red-800":s.cycle==="hypertrophie"?"bg-violet-100 text-violet-800":"bg-blue-100 text-blue-800";return e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx(_e,{className:"h-3.5 w-3.5"}),c," exo",c>1?"s":""]}),e.jsx("span",{className:G("rounded-full px-2 py-0.5 text-[10px] font-semibold",N),children:s.cycle})]})},onPreview:s=>ge(s),onEdit:s=>ge(s),onDelete:s=>y(s),canDelete:()=>!0,isDeleting:he.isPending}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm font-semibold",children:["Exercices (",T?.length??0,")"]}),e.jsxs("button",{type:"button",onClick:()=>p(!0),className:"inline-flex items-center gap-2 rounded-full border border-border px-3 py-2 text-xs font-semibold hover:bg-muted",children:[e.jsx(z,{className:"h-4 w-4"})," Ajouter"]})]}),e.jsx("div",{className:"space-y-1",children:T?.map(s=>e.jsxs("div",{className:"flex items-center gap-3 rounded-xl px-3 py-2 hover:bg-muted/50",children:[s.illustration_gif?e.jsx("img",{src:s.illustration_gif,alt:s.nom_exercice,className:"h-10 w-10 shrink-0 rounded-lg object-cover",loading:"lazy",decoding:"async"}):e.jsx("div",{className:"flex h-10 w-10 shrink-0 items-center justify-center rounded-lg bg-muted",children:e.jsx(_e,{className:"h-4 w-4 text-muted-foreground"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("div",{className:"truncate text-sm font-medium",children:s.nom_exercice}),e.jsx("div",{className:"text-xs text-muted-foreground",children:s.exercise_type==="warmup"?"Échauffement":"Séries de travail"})]}),e.jsxs("div",{className:"flex shrink-0 items-center gap-1",children:[e.jsx("button",{type:"button",onClick:()=>ps(s),className:"inline-flex h-9 w-9 items-center justify-center rounded-full hover:bg-muted","aria-label":"Modifier",children:e.jsx(Bs,{className:"h-4 w-4"})}),e.jsx("button",{type:"button",onClick:()=>E(s),className:"inline-flex h-9 w-9 items-center justify-center rounded-full text-destructive hover:bg-destructive/10","aria-label":"Supprimer",children:e.jsx(me,{className:"h-4 w-4"})})]})]},s.id))})]})]})]})}export{Te as createStrengthItemFromExercise,Ot as default};
