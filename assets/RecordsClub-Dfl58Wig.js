const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/export-records-pdf-DACvTvXR.js","assets/index-B54t_8yI.js","assets/vendor-query-DyA9aSKS.js","assets/vendor-react-BzrpNAyj.js","assets/vendor-charts-BrQ8X25f.js","assets/vendor-supabase-DFPLkPj_.js","assets/vendor-motion-lao-Njgm.js","assets/index-1RPOWF0g.css"])))=>i.map(i=>d[i]);
import{_ as Z,B as $,y as ee,c as _}from"./index-B54t_8yI.js";import{r as u,u as P,j as e}from"./vendor-query-DyA9aSKS.js";import{a as C}from"./api-CO7DiIGd.js";import{S as te,a as se,b as ae,c as ne,d as le}from"./select-DTzaas9_.js";import{P as re}from"./PageHeader-dl_WkRkV.js";import{T as S}from"./trophy-Chj2mXDq.js";import{C as ie}from"./circle-alert-DtsUvfzV.js";import{C as D}from"./chevron-up-BDngiaZy.js";import{C as oe}from"./chevron-down-BE2gMVlk.js";import{C as de}from"./chevron-right-Tjh4simQ.js";import"./vendor-react-BzrpNAyj.js";import"./vendor-charts-BrQ8X25f.js";import"./vendor-supabase-DFPLkPj_.js";import"./vendor-motion-lao-Njgm.js";import"./swim-XrdgY-3I.js";import"./index-j6znX3UH.js";import"./index-CBeugqJD.js";import"./index-DCX2sNhR.js";import"./chevron-left-oCARv_3s.js";const B=[{key:"25",label:"25m"},{key:"50",label:"50m"}],M=[{key:"M",label:"G"},{key:"F",label:"F"}],I=[{key:"ALL",label:"Tous les âges"},{key:"8",label:"≤ 8 ans"},{key:"9",label:"9 ans"},{key:"10",label:"10 ans"},{key:"11",label:"11 ans"},{key:"12",label:"12 ans"},{key:"13",label:"13 ans"},{key:"14",label:"14 ans"},{key:"15",label:"15 ans"},{key:"16",label:"16 ans"},{key:"17",label:"≥ 17 ans"}],me=[{key:"FREE",label:"Nage Libre",events:[{id:"50_FREE",label:"50 NL"},{id:"100_FREE",label:"100 NL"},{id:"200_FREE",label:"200 NL"},{id:"400_FREE",label:"400 NL"},{id:"800_FREE",label:"800 NL"},{id:"1500_FREE",label:"1500 NL"}]},{key:"BACK",label:"Dos",events:[{id:"50_BACK",label:"50 Dos"},{id:"100_BACK",label:"100 Dos"},{id:"200_BACK",label:"200 Dos"}]},{key:"BREAST",label:"Brasse",events:[{id:"50_BREAST",label:"50 Br"},{id:"100_BREAST",label:"100 Br"},{id:"200_BREAST",label:"200 Br"}]},{key:"FLY",label:"Papillon",events:[{id:"50_FLY",label:"50 Pap"},{id:"100_FLY",label:"100 Pap"},{id:"200_FLY",label:"200 Pap"}]},{key:"IM",label:"4 Nages",events:[{id:"100_IM",label:"100 4N"},{id:"200_IM",label:"200 4N"},{id:"400_IM",label:"400 4N"}]}],L=t=>{if(!t&&t!==0)return"-";const n=Math.round(t/10),l=n%100,d=Math.floor(n/100),i=d%60,r=Math.floor(d/60),m=x=>String(x).padStart(2,"0");return r>0?`${r}:${m(i)}.${m(l)}`:`${i}.${m(l)}`},b=t=>{if(!t)return"";const n=new Date(t);return Number.isNaN(n.getTime())?"":String(n.getFullYear())},ce=t=>{if(!t)return null;const n=new Date(t);return Number.isNaN(n.getTime())?null:n.toLocaleDateString("fr-FR")+" à "+n.toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"})},j=t=>t===8?"≤8":t===17?"≥17":String(t);function K({options:t,value:n,onChange:l}){return e.jsx("div",{className:"inline-flex rounded-lg border bg-muted p-0.5",children:t.map(d=>e.jsx("button",{type:"button",onClick:()=>l(d.key),className:_("rounded-md px-3 py-1.5 text-sm font-medium transition-colors",n===d.key?"bg-background text-foreground shadow-sm":"text-muted-foreground hover:text-foreground"),children:d.label},d.key))})}function $e(){const[t,n]=u.useState("50"),[l,d]=u.useState("M"),[i,r]=u.useState("17"),[m,x]=u.useState(null),[a,c]=u.useState(null),[p,f]=u.useState(!1),N=i==="ALL"?null:Number(i),k=B.find(s=>s.key===t)?.label??`${t}m`,O=M.find(s=>s.key===l)?.label??l,q=I.find(s=>s.key===i)?.label??i,Y=u.useCallback(s=>{n(s),x(null),c(null)},[]),V=u.useCallback(s=>{d(s),x(null),c(null)},[]),H=u.useCallback(s=>{r(s),x(null),c(null)},[]),{data:A}=P({queryKey:["last-import"],queryFn:()=>C.getImportLogs({limit:1})}),{data:R=[],isLoading:F,error:y,refetch:U}=P({queryKey:["club-records",t,l,i],queryFn:()=>C.getClubRecords({pool_m:Number(t),sex:l,age:N})}),w=u.useMemo(()=>m?N!==null?`${m}__${t}__${l}__${i}`:a:null,[m,N,a,t,l,i]),{data:G,isFetching:z}=P({queryKey:["club-ranking",w],queryFn:()=>{if(!w)return[];const s=w.split("__");return C.getClubRanking({event_code:s[0],pool_m:Number(s[1]),sex:s[2],age:Number(s[3])})},enabled:!!w}),v=u.useMemo(()=>{const s=new Map;for(const o of R){const g=s.get(o.event_code)??[];g.push(o),s.set(o.event_code,g)}for(const o of s.values())o.sort((g,h)=>g.age-h.age);return s},[R]),J=u.useMemo(()=>{const s=new Map;for(const[o,g]of v){let h=g[0];for(const E of g)E.time_ms<h.time_ms&&(h=E);s.set(o,h)}return s},[v]),Q=u.useCallback(s=>{x(o=>(c(null),o===s?null:s))},[]),X=u.useCallback(s=>{const o=`${s.event_code}__${t}__${l}__${s.age}`;c(g=>g===o?null:o)},[t,l]),W=u.useCallback(async()=>{f(!0);try{const s=await C.getClubRecords({}),{exportRecordsPdf:o}=await Z(async()=>{const{exportRecordsPdf:g}=await import("./export-records-pdf-DACvTvXR.js").then(h=>h.e);return{exportRecordsPdf:g}},__vite__mapDeps([0,1,2,3,4,5,6,7]));await o(s)}catch{}finally{f(!1)}},[]),T=u.useMemo(()=>me.map(s=>({...s,activeEvents:s.events.filter(o=>v.has(o.id))})).filter(s=>s.activeEvents.length>0),[v]);return e.jsxs("div",{className:"space-y-3",children:[e.jsx(re,{title:"Records du club",subtitle:A?.[0]?.status==="success"?`MAJ : ${ce(A[0].completed_at??A[0].started_at)??"-"}`:void 0,icon:e.jsx(S,{className:"h-3.5 w-3.5"}),backHref:"/hall-of-fame",backLabel:"Retour aux classements",action:e.jsxs($,{variant:"outline",size:"sm",onClick:W,disabled:p,className:"border-primary/20 text-primary hover:bg-primary/5",children:[e.jsx(ee,{className:"h-4 w-4 mr-1"}),p?"...":"PDF"]})}),e.jsxs("div",{className:"rounded-2xl border border-border/70 bg-card/90 px-4 py-3 shadow-sm",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-[11px] font-semibold uppercase tracking-[0.22em] text-muted-foreground",children:"Vue active"}),e.jsxs("p",{className:"mt-1 truncate text-sm font-semibold text-foreground",children:[k," · ",O," · ",q]})]}),e.jsxs("div",{className:"mt-3 flex flex-wrap gap-2",children:[e.jsx(K,{options:B,value:t,onChange:Y}),e.jsx(K,{options:M,value:l,onChange:V})]}),e.jsx("div",{className:"mt-2",children:e.jsxs(te,{value:i,onValueChange:H,children:[e.jsx(se,{className:"h-10 w-full text-sm",children:e.jsx(ae,{})}),e.jsx(ne,{children:I.map(s=>e.jsx(le,{value:s.key,children:s.label},s.key))})]})}),e.jsx("div",{className:"mt-2 text-[11px] text-muted-foreground",children:"Changement immédiat, sans panneau de filtres."})]}),F&&e.jsx("div",{className:"space-y-2 pt-2",children:[1,2,3,4,5].map(s=>e.jsx("div",{className:"h-14 w-full rounded-xl bg-muted animate-pulse motion-reduce:animate-none"},s))}),y&&e.jsxs("div",{className:"flex flex-col items-center justify-center p-8 text-center",children:[e.jsx(ie,{className:"h-12 w-12 text-destructive mb-4"}),e.jsx("h3",{className:"font-semibold",children:"Impossible de charger les données"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:y instanceof Error?y.message:"Une erreur s'est produite"}),e.jsx($,{onClick:()=>U(),className:"mt-4",children:"Réessayer"})]}),!F&&!y&&R.length===0&&e.jsx("p",{className:"py-8 text-center text-sm text-muted-foreground",children:"Aucun record pour ces filtres."}),!F&&!y&&T.length>0&&e.jsx("div",{className:"space-y-5 pb-4",children:T.map(s=>e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"h-4 w-1 rounded-full bg-primary"}),e.jsx("h2",{className:"text-xs font-display font-bold uppercase tracking-wider text-muted-foreground",children:s.label}),e.jsx("div",{className:"flex-1 h-px bg-border"})]}),e.jsx("div",{className:"space-y-1.5",children:s.activeEvents.map(o=>{const g=J.get(o.id),h=v.get(o.id)??[],E=m===o.id;return e.jsx(ue,{eventLabel:o.label,bestRecord:g,ageRecords:h,isExpanded:E,isAllAges:N===null,onToggle:()=>Q(o.id),onAgeRowTap:X,expandedAgeKey:a,rankingData:G,rankingLoading:z,pool:t,sex:l},o.id)})})]},s.key))})]})}function ue({eventLabel:t,bestRecord:n,ageRecords:l,isExpanded:d,isAllAges:i,onToggle:r,onAgeRowTap:m,expandedAgeKey:x,rankingData:a,rankingLoading:c,pool:p,sex:f}){return e.jsxs("div",{className:_("rounded-xl border overflow-hidden transition-colors",d?"border-primary/25 shadow-sm":"border-border"),children:[e.jsx("button",{type:"button",onClick:r,className:"w-full text-left px-3.5 py-3 hover:bg-muted/50 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx("span",{className:"text-sm font-semibold text-foreground",children:t}),e.jsxs("div",{className:"flex items-center gap-2.5",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("span",{className:"font-mono text-primary font-bold tabular-nums text-[15px] leading-none",children:L(n.time_ms)}),e.jsxs("div",{className:"flex items-center justify-end gap-1 mt-0.5",children:[e.jsx("span",{className:"text-[11px] text-muted-foreground truncate max-w-[120px]",children:n.athlete_name}),i&&e.jsxs("span",{className:"text-[10px] text-muted-foreground/60",children:[j(n.original_age??n.age),"a"]}),b(n.record_date)&&e.jsxs("span",{className:"text-[10px] text-muted-foreground/60",children:["(",b(n.record_date),")"]})]})]}),d?e.jsx(D,{className:"h-4 w-4 text-muted-foreground shrink-0"}):e.jsx(oe,{className:"h-4 w-4 text-muted-foreground shrink-0"})]})]})}),d&&e.jsx("div",{className:"border-t border-border",children:i?e.jsx(xe,{records:l,bestTime:n.time_ms,onAgeRowTap:m,expandedAgeKey:x,rankingData:a,rankingLoading:c,pool:p,sex:f}):e.jsx(pe,{record:n,eventLabel:t,rankingData:a,rankingLoading:c})})]})}function xe({records:t,bestTime:n,onAgeRowTap:l,expandedAgeKey:d,rankingData:i,rankingLoading:r,pool:m,sex:x}){return e.jsx("div",{className:"divide-y divide-border/50",children:t.map(a=>{const c=a.time_ms===n,p=`${a.event_code}__${m}__${x}__${a.age}`,f=d===p,N=a.original_age!=null&&a.original_age!==a.age,k=a.original_age?j(a.original_age):null;return e.jsxs("div",{children:[e.jsxs("button",{type:"button",onClick:()=>l(a),className:_("w-full text-left px-3.5 py-2 flex items-center gap-2.5 hover:bg-muted/40 transition-colors",c&&"bg-primary/[0.03]"),children:[e.jsxs("span",{className:_("text-[11px] font-semibold w-7 text-center shrink-0 tabular-nums",c?"text-primary":"text-muted-foreground"),children:[j(a.age),"a"]}),e.jsx("span",{className:_("font-mono tabular-nums text-sm shrink-0",c?"text-primary font-bold":"text-foreground font-medium"),children:L(a.time_ms)}),e.jsxs("span",{className:"text-xs text-muted-foreground flex-1 truncate",children:[a.athlete_name,N&&k&&e.jsxs("span",{className:"ml-1 opacity-70",children:["(",k,"a)"]})]}),b(a.record_date)&&e.jsx("span",{className:"text-[10px] text-muted-foreground shrink-0",children:b(a.record_date)}),c&&e.jsx(S,{className:"h-3 w-3 text-rank-gold shrink-0"}),f?e.jsx(D,{className:"h-3 w-3 text-muted-foreground shrink-0"}):e.jsx(de,{className:"h-3 w-3 text-muted-foreground shrink-0"})]}),f&&e.jsx(ge,{record:a,rankingData:i,rankingLoading:r})]},a.age)})})}function ge({record:t,rankingData:n,rankingLoading:l}){const d=t.original_age!=null&&t.original_age!==t.age,i=u.useMemo(()=>{const r=n??[];return d?[{id:-1,athlete_name:t.athlete_name,swimmer_iuf:t.swimmer_iuf??null,sex:t.sex,pool_m:t.pool_m,event_code:t.event_code,event_label:t.event_label,age:t.original_age??t.age,actual_age:t.original_age??t.age,time_ms:t.time_ms,record_date:t.record_date},...r]:r},[n,t,d]);return e.jsxs("div",{className:"bg-muted/30 px-3.5 py-2 ml-7 border-l-2 border-primary/20",children:[e.jsxs("p",{className:"text-[10px] font-semibold uppercase tracking-wider text-muted-foreground mb-1.5",children:["Classement (",j(t.age)," ans)"]}),l?e.jsx("div",{className:"space-y-1.5",children:[1,2,3].map(r=>e.jsx("div",{className:"h-4 w-full rounded bg-muted animate-pulse motion-reduce:animate-none"},r))}):i.length===0?e.jsx("p",{className:"text-xs text-muted-foreground",children:"Aucune donnée."}):e.jsx("div",{className:"space-y-0.5",children:i.map((r,m)=>{const x=m===0&&d&&r.id===-1;return e.jsxs("div",{className:_("flex items-center gap-2 text-xs py-0.5",m===0&&"font-semibold text-primary"),children:[e.jsx("span",{className:"w-4 text-center shrink-0 text-[10px]",children:m===0?e.jsx(S,{className:"inline h-3 w-3 text-rank-gold"}):m+1}),e.jsx("span",{className:"font-mono tabular-nums w-14 shrink-0 text-[11px]",children:L(r.time_ms)}),e.jsxs("span",{className:"flex-1 truncate text-[11px]",children:[r.athlete_name,x&&e.jsx("span",{className:"ml-1 text-[9px] font-normal text-muted-foreground",children:"(record)"})]}),b(r.record_date)&&e.jsx("span",{className:"text-[10px] text-muted-foreground shrink-0",children:b(r.record_date)})]},r.id===-1?"record-holder":r.id)})})]})}function pe({record:t,eventLabel:n,rankingData:l,rankingLoading:d}){const i=t.original_age!=null&&t.original_age!==t.age,r=t.original_age?j(t.original_age):null,m=j(t.age),x=u.useMemo(()=>{const a=l??[];return i?[{id:-1,athlete_name:t.athlete_name,swimmer_iuf:t.swimmer_iuf??null,sex:t.sex,pool_m:t.pool_m,event_code:t.event_code,event_label:t.event_label,age:t.original_age??t.age,actual_age:t.original_age??t.age,time_ms:t.time_ms,record_date:t.record_date},...a]:a},[l,t,i]);return e.jsxs("div",{className:"bg-muted/20 px-3.5 py-2.5",children:[e.jsxs("p",{className:"text-[10px] font-semibold uppercase tracking-wider text-muted-foreground mb-2",children:["Classement — ",n," (",m," ans)"]}),d?e.jsx("div",{className:"space-y-1.5",children:[1,2,3].map(a=>e.jsx("div",{className:"h-5 w-full rounded bg-muted animate-pulse motion-reduce:animate-none"},a))}):x.length===0?e.jsx("p",{className:"text-xs text-muted-foreground",children:"Aucune donnée de classement."}):e.jsx("div",{className:"space-y-0.5",children:x.map((a,c)=>{const p=c===0&&i&&a.id===-1;return e.jsxs("div",{className:_("flex items-center gap-2 text-xs py-1 rounded-md px-1",c===0&&"font-semibold text-primary",p&&"bg-primary/5"),children:[e.jsx("span",{className:"w-5 text-center shrink-0",children:c===0?e.jsx(S,{className:"inline h-3 w-3 text-rank-gold"}):c+1}),e.jsx("span",{className:"font-mono tabular-nums w-16 shrink-0",children:L(a.time_ms)}),e.jsxs("span",{className:"flex-1 truncate",children:[a.athlete_name,p&&r&&e.jsxs("span",{className:"ml-1 text-[10px] font-normal text-muted-foreground",children:["(record ",r,"a)"]})]}),e.jsxs("span",{className:"text-muted-foreground shrink-0",children:[a.actual_age??a.age,"a"]}),b(a.record_date)&&e.jsx("span",{className:"text-[10px] text-muted-foreground shrink-0",children:b(a.record_date)})]},a.id===-1?"record-holder":a.id)})})]})}export{$e as default};
