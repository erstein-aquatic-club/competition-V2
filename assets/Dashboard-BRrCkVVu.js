import{r as o,j as e}from"./vendor-ui-DJQMR4VV.js";import{b as Ct,u as Ue,c as Oe}from"./vendor-query-BT4y-huw.js";import{c as z,u as At,f as _t,b as Ft,B as Ot,W as Ie,X as $e,F as It,d as te}from"./index-DxWSFshs.js";import{I as Xe,C as Ge,B as Pt}from"./BottomActionBar-dcP_t9az.js";import{m as O,s as Et,l as Ze,b as Lt}from"./animations-CaOQmkab.js";import{C as $t}from"./circle-alert-Bopk_bPG.js";import{C as Kt}from"./chevron-left-iyFMo4Uk.js";import{C as me}from"./circle-Dj9fHnDL.js";import{P as mt}from"./plus-DyXqz0gm.js";import{C as et}from"./check-B3Pxcn4a.js";import{A as ge}from"./index-BVT9Qzfs.js";import"./vendor-react-BzrpNAyj.js";import"./vendor-charts-Db4xOvcx.js";import"./vendor-supabase-D7B1G6YZ.js";import"./loader-circle-DQes0vnT.js";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bt=[["path",{d:"M5 12h14",key:"1ays0h"}]],xt=z("minus",Bt);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rt=[["path",{d:"M20.985 12.486a9 9 0 1 1-9.473-9.472c.405-.022.617.46.402.803a6 6 0 0 0 8.268 8.268c.344-.215.825-.004.803.401",key:"kfwtm"}]],Tt=z("moon",Rt);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qt=[["path",{d:"M12 2v10",key:"mnfbl"}],["path",{d:"M18.4 6.6a9 9 0 1 1-12.77.04",key:"obofu9"}]],zt=z("power",qt);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jt=[["path",{d:"M14 17H5",key:"gfn3mx"}],["path",{d:"M19 7h-9",key:"6i9tg"}],["circle",{cx:"17",cy:"17",r:"3",key:"18b49y"}],["circle",{cx:"7",cy:"7",r:"3",key:"dfmy0x"}]],tt=z("settings-2",Jt);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qt=[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]],Vt=z("sun",Qt);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yt=[["path",{d:"m16 11 2 2 4-4",key:"9rsbq5"}],["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],st=z("user-check",Yt);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wt=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]],xe=z("user-x",Wt),Ht=["L","M","M","J","V","S","D"],nt=["Lun","Mar","Mer","Jeu","Ven","Sam","Dim"],fe=[{key:"difficulty",label:"Difficulté",mode:"hard"},{key:"fatigue_end",label:"Fatigue fin",mode:"hard"},{key:"performance",label:"Perf perçue",mode:"good"},{key:"engagement",label:"Engagement",mode:"good"}],rt=[{key:"AM",label:"Matin",Icon:Vt},{key:"PM",label:"Soir",Icon:Tt}],it={NL:"",DOS:"",BR:"",PAP:"",QN:""},ot={NL:"NL",DOS:"Dos",BR:"Brasse",PAP:"Pap",QN:"4N"};function at(n){return String(n).padStart(2,"0")}function q(n){return`${n.getFullYear()}-${at(n.getMonth()+1)}-${at(n.getDate())}`}function Pe(n){return new Date(n.getFullYear(),n.getMonth(),1)}function lt(n,i){const l=new Date(n);return l.setDate(l.getDate()+i),l}function Ut(n,i){return n.getFullYear()===i.getFullYear()&&n.getMonth()===i.getMonth()&&n.getDate()===i.getDate()}function Ee(n){return(n.getDay()+6)%7}function Xt(n){return n.toLocaleDateString("fr-FR",{month:"long",year:"numeric"})}function Gt(n){return n.toLocaleDateString("fr-FR",{weekday:"long",day:"numeric",month:"long",year:"numeric"})}function Zt(n){const i=String(n).split("__");return{iso:i[0],slotKey:i[1]||""}}function m(...n){return n.filter(Boolean).join(" ")}function se(n){const i=Number(n);if(!Number.isFinite(i))return"—";const l=Math.round(i*100)/100,u=String(l);return u.endsWith(".0")?u.slice(0,-2):u}function ne(n){const i=Number(n);return Number.isFinite(i)?Math.round(i/1e3*100)/100:0}function dt(n){const i=Number(n);return Number.isFinite(i)?Math.round(i*1e3):0}function es(n){return n?String(n).replaceAll(`\r
`,`
`).split(`
`).map(l=>l.trim()).filter(Boolean).flatMap(l=>{const u=l.replace(/^[•\\-–—]\\s*/,"").trim();return u?[u]:[]}):[]}function ts(n){if(!n)return null;const l=String(n).match(/(\\d+(?:[\\.,]\\d+)?)\\s*(km|m)\\b/i);if(!l)return null;const u=Number(String(l[1]).replace(",","."));return Number.isFinite(u)?l[2].toLowerCase()==="m"?ne(u):u:null}function ss(n,i){const l=n?.slot??n?.session_slot??n?.assigned_slot??n?.time_slot??n?.timeOfDay??n?.slot_key??n?.slotKey,u=String(l||"").toLowerCase();if(u.includes("mat")||u.includes("morning")||u==="am")return"AM";if(u.includes("soir")||u.includes("evening")||u==="pm")return"PM";const x=`${n?.title??""} ${n?.description??""}`.toLowerCase();return x.includes("matin")||x.includes(" am ")||x.includes("(am)")?"AM":x.includes("soir")||x.includes(" pm ")||x.includes("(pm)")?"PM":i===0?"AM":"PM"}function ns(n){const i=n?.assigned_date??n?.date??n?.day??n?.scheduled_for??n?.scheduledAt??null;if(!i)return null;const l=String(i),u=l.length>=10?l.slice(0,10):l;return/\d{4}-\d{2}-\d{2}/.test(u)?u:null}function rs(n){const i=n?.distance_meters??n?.distanceMeters??n?.meters??n?.planned_meters??n?.plannedMeters??n?.distance??null;if(i!=null&&Number.isFinite(Number(i))){const x=Number(i);return x>0&&x<=50?x:ne(x)}const l=n?.km??n?.distance_km??n?.distanceKm??n?.planned_km??n?.plannedKm??null;if(l!=null&&Number.isFinite(Number(l)))return Number(l);const u=ts(`${n?.title??""} ${n?.description??""}`);return u??null}function is({completed:n,total:i}){return i===0?"rest":n>=i?"full":n>0?"half":"none"}const os=o.memo(function({date:i,inMonth:l,isToday:u,isSelected:x,isFocused:L,status:g,onClick:F,onKeyDown:D}){const{completed:C,total:W}=g,N=is(g),pe=N==="full"?"bg-primary":N==="half"?"bg-primary/10":N==="none"?"bg-muted":"bg-muted/50",he=N==="full"?"border-primary":N==="half"?"border-primary/30":N==="none"?"border-muted-foreground/20":"border-border",ye=N==="full"?"text-primary-foreground":"text-foreground",re=N==="full"?"bg-primary-foreground/25":"bg-muted-foreground/30",H=N==="full"?"bg-primary-foreground":"bg-primary",je=x?N==="full"?"ring-2 ring-primary-foreground/50":"ring-2 ring-primary/30":"",J=u?N==="full"?"ring-2 ring-primary-foreground/40":"ring-2 ring-primary/50":"",ie=L?"ring-2 ring-primary":"";return e.jsx("button",{type:"button",onClick:F,onKeyDown:D,tabIndex:L?0:-1,"data-calendar-cell":"true",className:m("aspect-square min-w-0 rounded-2xl border p-1 transition",pe,he,!l&&"opacity-40","hover:shadow-sm focus:outline-none",je,J,ie),"aria-label":`${q(i)} — ${W===0?"Repos":`${C}/${W}`}`,children:e.jsxs("div",{className:"flex h-full flex-col justify-between",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsx("div",{className:m("text-[12px] font-semibold",ye),children:i.getDate()}),e.jsx("div",{className:"h-[14px] w-[14px]"})]}),e.jsx("div",{className:"flex items-center justify-end",children:W>0&&e.jsx("div",{className:"w-6",children:e.jsxs("div",{className:"flex gap-1",children:[e.jsx("span",{className:m("h-1.5 flex-1 rounded-full",C>=1?H:re)}),e.jsx("span",{className:m("h-1.5 flex-1 rounded-full",C>=2?H:re)})]})})})]})})});function as({open:n,title:i,onClose:l,children:u}){return e.jsx(ge,{children:n&&e.jsxs(e.Fragment,{children:[e.jsx(O.div,{className:"fixed inset-0 z-overlay bg-black/30",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:l}),e.jsx(O.div,{className:m("fixed z-modal bg-background shadow-2xl","left-0 right-0 bottom-0 top-auto max-h-[calc(100dvh-env(safe-area-inset-top))] h-[88dvh] rounded-t-3xl","sm:right-0 sm:top-0 sm:left-auto sm:bottom-auto sm:h-full sm:w-full sm:max-w-xl sm:rounded-none"),variants:Lt,initial:"hidden",animate:"visible",exit:"exit",role:"dialog","aria-modal":"true",children:e.jsxs("div",{className:"flex h-full flex-col",children:[e.jsx("div",{className:"px-5 pt-3 sm:hidden",children:e.jsx("div",{className:"mx-auto h-1.5 w-12 rounded-full bg-muted"})}),e.jsxs("div",{className:"sticky top-0 z-10 flex items-center justify-between border-b bg-background px-4 sm:px-5 py-3",children:[e.jsx("div",{className:"min-w-0",children:e.jsx("div",{className:"truncate text-base font-semibold text-foreground",children:i})}),e.jsx(S,{onClick:l,label:"Fermer",children:e.jsx($e,{className:"h-5 w-5"})})]}),e.jsx("div",{className:"flex-1 overflow-auto p-4 pb-24 sm:p-5 sm:pb-5",children:u})]})})]})})}function ct({open:n,title:i,onClose:l,children:u}){return e.jsx(ge,{children:n&&e.jsxs(e.Fragment,{children:[e.jsx(O.div,{className:"fixed inset-0 z-overlay bg-black/30",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:l}),e.jsx(O.div,{className:"fixed inset-0 z-modal flex items-end sm:items-center justify-center p-3 pb-24 sm:p-4 sm:pb-4",initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:10},children:e.jsxs("div",{className:"w-full max-w-md rounded-3xl border bg-background shadow-2xl overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between border-b px-4 py-3",children:[e.jsx("div",{className:"truncate text-base font-semibold text-foreground",children:i}),e.jsx(S,{onClick:l,label:"Fermer",children:e.jsx($e,{className:"h-5 w-5"})})]}),e.jsx("div",{className:"p-4",children:u})]})})]})})}function be({children:n}){return e.jsx("span",{className:"inline-flex items-center rounded-full bg-muted px-2 py-0.5 text-xs font-semibold text-muted-foreground",children:n})}function S({onClick:n,label:i,children:l,tone:u="neutral",disabled:x}){const L={neutral:"bg-background border-border text-foreground hover:bg-muted",dark:"bg-foreground border-foreground text-background hover:opacity-90",sky:"bg-primary/10 border-primary/30 text-primary hover:bg-primary/20"};return e.jsxs("button",{type:"button",onClick:n,disabled:x,className:m("inline-flex items-center justify-center rounded-2xl border p-2 transition",L[u],x&&"opacity-50 cursor-not-allowed hover:bg-background"),"aria-label":i,title:i,children:[l,e.jsx("span",{className:"sr-only",children:i})]})}function ls(n,i){const l=Number(i);return!Number.isFinite(l)||l<1||l>5?"neutral":n==="hard"?{1:"bg-intensity-1 border-intensity-1 text-white",2:"bg-intensity-2 border-intensity-2 text-white",3:"bg-intensity-3 border-intensity-3 text-white",4:"bg-intensity-4 border-intensity-4 text-white",5:"bg-intensity-5 border-intensity-5 text-white"}[l]:{1:"bg-intensity-5 border-intensity-5 text-white",2:"bg-intensity-4 border-intensity-4 text-white",3:"bg-intensity-3 border-intensity-3 text-white",4:"bg-intensity-2 border-intensity-2 text-white",5:"bg-intensity-1 border-intensity-1 text-white"}[l]}const ds=o.memo(function({plannedMeters:i,valueMeters:l,onChange:u,disabled:x}){const D=Number.isFinite(Number(l))?Number(l):i,C=D-i;return e.jsxs("div",{className:m("mt-4 rounded-3xl border px-4 py-3",x?"bg-muted border-border":"bg-card border-border"),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:m("text-xs font-semibold",x?"text-muted-foreground":"text-foreground"),children:"Ajuster kilométrage"}),e.jsx("div",{className:m("text-xs","text-muted-foreground"),children:C===0?"":C>0?`+${C}m`:`${C}m`})]}),e.jsxs("div",{className:"mt-2 flex items-center justify-center gap-3",children:[e.jsx("button",{type:"button",disabled:x||D-100<0,onClick:()=>u(D-100),className:m("h-11 w-11 rounded-2xl border flex items-center justify-center",x?"bg-muted border-border text-muted-foreground":"bg-card border-border text-foreground hover:bg-muted"),"aria-label":"-100m",children:e.jsx(xt,{className:"h-5 w-5"})}),e.jsxs("div",{className:"min-w-[120px] text-center",children:[e.jsxs("div",{className:m("text-lg font-semibold",x?"text-muted-foreground":"text-foreground"),children:[D,"m"]}),e.jsxs("div",{className:m("text-xs","text-muted-foreground"),children:["(",se(ne(D))," km)"]})]}),e.jsx("button",{type:"button",disabled:x||D+100>3e4,onClick:()=>u(D+100),className:m("h-11 w-11 rounded-2xl border flex items-center justify-center",x?"bg-muted border-border text-muted-foreground":"bg-card border-border text-foreground hover:bg-muted"),"aria-label":"+100m",children:e.jsx(mt,{className:"h-5 w-5"})})]})]})});function cs(){const n={};for(let i=0;i<7;i++)n[i]={AM:!0,PM:!0};return n}function Le(n){if(!n)return null;try{return JSON.parse(n)}catch{return null}}function ut(n,i){return Number.isFinite(n)?Math.round(n/i)*i:0}function Ms(){const{user:n,userId:i}=At(),{toast:l}=_t(),u=Ct(),[,x]=Ft(),[L,g]=o.useState("idle"),{data:F,isLoading:D,error:C,refetch:W}=Ue({queryKey:["sessions",i??n],queryFn:()=>te.getSessions(n,i),enabled:!!n}),{data:N,isLoading:pe,error:he,refetch:ye}=Ue({queryKey:["assignments",n],queryFn:()=>te.getAssignments(n,i),enabled:!!n}),re=D||pe,H=C||he,je=()=>{W(),ye()},J=Oe({mutationFn:t=>te.deleteSession(t),onMutate:()=>{g("saving")},onSuccess:()=>{u.invalidateQueries({queryKey:["sessions"]}),l({title:"Séance supprimée",description:"La saisie a été supprimée."}),g("saved"),setTimeout(()=>g("idle"),2e3)},onError:()=>{l({title:"Erreur",description:"Impossible de supprimer la séance.",variant:"destructive"}),g("error"),setTimeout(()=>g("idle"),3e3)}}),ie=Oe({mutationFn:t=>te.syncSession({...t,athlete_name:n,athlete_id:i??void 0}),onMutate:()=>{g("saving")},onSuccess:()=>{u.invalidateQueries({queryKey:["sessions"]}),u.invalidateQueries({queryKey:["assignments"]}),l({title:"Séance enregistrée",description:"Vos données ont été synchronisées."}),g("saved"),setTimeout(()=>g("idle"),2e3)},onError:()=>{l({title:"Erreur",description:"Impossible d'enregistrer la séance.",variant:"destructive"}),g("error"),setTimeout(()=>g("idle"),3e3)}}),Ke=Oe({mutationFn:t=>te.updateSession(t),onMutate:()=>{g("saving")},onSuccess:()=>{u.invalidateQueries({queryKey:["sessions"]}),l({title:"Séance mise à jour",description:"Votre saisie a été mise à jour."}),g("saved"),setTimeout(()=>g("idle"),2e3)},onError:()=>{l({title:"Erreur",description:"Impossible de mettre à jour la séance.",variant:"destructive"}),g("error"),setTimeout(()=>g("idle"),3e3)}}),Ne=`swim-dashboard-v2:${i??n??"anon"}`,oe=`${Ne}:presenceDefaults`,ae=`${Ne}:attendanceOverrides`,le=`${Ne}:stableFields`,[$,Be]=o.useState(()=>cs()),[K,Q]=o.useState({}),[U,ve]=o.useState(90);o.useEffect(()=>{if(typeof window>"u")return;const t=Le(window.localStorage.getItem(oe));t&&Be(t);const s=Le(window.localStorage.getItem(ae));s&&Q(s);const r=Le(window.localStorage.getItem(le));r?.duration&&Number.isFinite(r.duration)&&r.duration>=30&&r.duration<=240&&ve(r.duration)},[oe,ae,le]),o.useEffect(()=>{typeof window>"u"||window.localStorage.setItem(oe,JSON.stringify($))},[$,oe]),o.useEffect(()=>{typeof window>"u"||window.localStorage.setItem(ae,JSON.stringify(K))},[K,ae]),o.useEffect(()=>{typeof window>"u"||window.localStorage.setItem(le,JSON.stringify({duration:U}))},[U,le]);const ft=o.useMemo(()=>new Date,[]),[de,we]=o.useState(()=>Pe(new Date)),[V,Re]=o.useState(()=>q(new Date)),[X,ke]=o.useState(!1),[bt,Se]=o.useState(!1),[gt,Me]=o.useState(!1),[w,B]=o.useState(null),[pt,I]=o.useState(!1),[Te,qe]=o.useState(null),[ze,De]=o.useState(!1),[G,A]=o.useTransition(),Je=o.useMemo(()=>(Array.isArray(N)?N:[]).filter(s=>s?.session_type==="swim"),[N]),Ce=o.useMemo(()=>{const t=new Map;for(const s of Je){const r=ns(s);r&&(t.has(r)||t.set(r,[]),t.get(r).push(s))}for(const[s,r]of t.entries())r.sort((a,d)=>Number(a?.id??0)-Number(d?.id??0)),t.set(s,r);return t},[Je]),v=o.useMemo(()=>{const t=Array.isArray(F)?F:[],s={};for(const r of t){const a=String(r?.date??"").slice(0,10),d=r?.slot==="Soir"?"PM":"AM";s[`${a}__${d}`]=r}return s},[F]),Qe=o.useRef(new Map);o.useEffect(()=>{Qe.current.clear()},[Ce]);const ce=o.useCallback(t=>{const s=Qe.current;if(s.has(t))return s.get(t);const r=[{id:`${t}__AM`,iso:t,slotKey:"AM",title:"Séance vide",km:null,details:[],isEmpty:!0},{id:`${t}__PM`,iso:t,slotKey:"PM",title:"Séance vide",km:null,details:[],isEmpty:!0}],a=Ce.get(t)??[],d=new Set;return a.forEach((b,h)=>{const j=b,c=ss(j,h);if(d.has(c))return;const f=c==="AM"?0:1,M=rs(j),Y=Array.isArray(j?.details)?j.details.map(String):es(b?.description);r[f]={id:`${t}__${c}`,iso:t,slotKey:c,title:String(b?.title??"Séance coach"),km:M,details:Y,assignmentId:typeof b?.id=="number"?b.id:Number(b?.id)||void 0,isEmpty:!1},d.add(c)}),s.set(t,r),r},[Ce]),P=o.useCallback((t,s)=>{const r=Ee(s),a=!!$?.[r]?.[t.slotKey],d=K[t.id];return d==="present"?{status:"present",expected:!0,expectedByDefault:a}:d==="absent"?{status:"absent",expected:!0,expectedByDefault:a}:a?{status:"present",expected:!0,expectedByDefault:a}:{status:"not_expected",expected:!1,expectedByDefault:a}},[K,$]),Ae=o.useMemo(()=>Pe(de),[de]),E=o.useMemo(()=>{const t=Ee(Ae),s=lt(Ae,-t),r=[];for(let a=0;a<42;a++)r.push(lt(s,a));return r},[Ae]),ue=o.useMemo(()=>{const t={};for(const s of E){const r=q(s),a=ce(r);let d=0,b=0;for(const h of a){const j=P(h,s);if(!j.expected)continue;d+=1;const c=!!v[h.id],f=j.status==="absent";(c||f)&&(b+=1)}t[r]={completed:b,total:d}}return t},[E,ce,P,v]),R=o.useMemo(()=>{const[t,s,r]=V.split("-").map(Number);return new Date(t,s-1,r)},[V]),_=o.useMemo(()=>ce(V),[ce,V]),k=ue[V]||{completed:0,total:2};o.useEffect(()=>{X&&ze&&k.total>0&&k.completed>=k.total&&(ke(!1),B(null),I(!1),De(!1))},[X,ze,k.completed,k.total]);const p=o.useMemo(()=>w&&_.find(t=>t.id===w)||null,[w,_]),Ve=o.useMemo(()=>w&&v[w]||null,[w,v]),Z=o.useMemo(()=>{const t=Ve||{},s=t?.stroke_distances,r=s?{NL:s.NL?String(s.NL):"",DOS:s.DOS?String(s.DOS):"",BR:s.BR?String(s.BR):"",PAP:s.PAP?String(s.PAP):"",QN:s.QN?String(s.QN):""}:it;return{difficulty:t?.effort??null,fatigue_end:t?.fatigue??t?.feeling??null,performance:t?.performance??t?.feeling??null,engagement:t?.engagement??t?.feeling??null,comment:String(t?.comments??""),distanceMeters:Number.isFinite(Number(t?.distance))?Number(t.distance):null,showStrokeDetail:!!(s&&Object.values(s).some(a=>a&&a>0)),strokes:r}},[Ve]),[y,T]=o.useState(()=>({difficulty:null,fatigue_end:null,performance:null,engagement:null,comment:"",distanceMeters:null,showStrokeDetail:!1,strokes:it}));o.useEffect(()=>{if(p){const t=dt(p.km??0);T(s=>({...s,...Z,distanceMeters:Z.distanceMeters==null?t:Z.distanceMeters}));return}T(t=>({...t,...Z}))},[Z,p]);const ee=o.useCallback(t=>{Re(t),ke(!0),B(null),I(!1);const s=ue[t]||{completed:0,total:2};De(s.total>0&&s.completed<s.total)},[ue]),_e=o.useCallback(()=>{ke(!1),B(null),I(!1),De(!1),qe(null)},[]),ht=o.useCallback(()=>{we(t=>new Date(t.getFullYear(),t.getMonth()-1,1))},[]),yt=o.useCallback(()=>{we(t=>new Date(t.getFullYear(),t.getMonth()+1,1))},[]),jt=o.useCallback(()=>{const t=new Date;we(Pe(t)),ee(q(t))},[ee]),Fe=o.useCallback(t=>{B(t),I(!1)},[]),Ye=o.useCallback(t=>{A(()=>{Q(r=>({...r,[t]:"absent"}))});const s=v[t];s?.id&&J.mutate(Number(s.id))},[J,v,A]),We=o.useCallback(t=>{A(()=>{Q(s=>({...s,[t]:"present"}))})},[A]),Nt=o.useCallback(t=>{A(()=>{Q(s=>{const r={...s};return delete r[t],r})})},[A]),vt=o.useCallback(()=>{const t=_.map(s=>P(s,R).expected?s.id:null).filter(Boolean);t.length!==0&&(A(()=>{Q(s=>{const r={...s};for(const a of t)r[a]="absent";return r}),B(null),I(!1)}),t.forEach(s=>{const r=v[s];r?.id&&J.mutate(Number(r.id))}))},[_,P,R,A,v,J]),wt=o.useCallback(()=>{if(!w||!n||!fe.every(f=>Number.isInteger(y[f.key])))return;const{iso:s,slotKey:r}=Zt(w),a=r==="PM"?"Soir":"Matin",d=ut(Number(y.distanceMeters??0),100),b=ut(Number(U),15),h={};for(const[f,M]of Object.entries(y.strokes)){const Y=Number(M);Y>0&&(h[f]=Y)}const j={date:s,slot:a,distance:d,duration:b,effort:Number(y.difficulty),feeling:Number(y.fatigue_end),performance:Number(y.performance),engagement:Number(y.engagement),comments:String(y.comment||"").slice(0,400),athlete_name:n,athlete_id:i??void 0,stroke_distances:Object.keys(h).length>0?h:null},c=v[w];A(()=>{Q(f=>({...f,[w]:"present"}))}),c?.id?Ke.mutate({...j,id:c.id,created_at:c.created_at??new Date().toISOString()}):ie.mutate(j),B(null),I(!1)},[w,n,i,y,U,v,A,Ke,ie]),kt=o.useCallback((t,s)=>{Be(r=>({...r,[t]:{...r[t],[s]:!r[t][s]}}))},[]),He=o.useMemo(()=>{const t=Array.isArray(F)?F:[];let s=0;for(const r of t){const a=String(r?.date??"").slice(0,10),d=r?.slot==="Soir"?"PM":"AM",b=`${a}__${d}`;if(K[b]==="absent")continue;const h=Ee(new Date(a));($?.[h]?.[d]||K[b]==="present")&&Number.isFinite(Number(r?.distance))&&(s+=Number(r.distance))}return se(ne(s))},[F,K,$]),St=o.useMemo(()=>{const t=_;let s=0;for(const r of t){const a=P(r,R);if(!a.expected||a.status==="absent")continue;const d=v[r.id];d&&Number.isFinite(Number(d?.distance))&&(s+=Number(d.distance))}return se(ne(s))},[_,P,R,v]);o.useEffect(()=>{if(!X)return;const t=s=>{if(s.key==="Escape"){s.preventDefault(),_e();return}(s.key==="Enter"||s.key===" ")&&(s.preventDefault(),_.length>0&&!w&&Fe(_[0].id))};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[X,_e,_,w,Fe]);const Mt=o.useCallback((t,s)=>{if(!["ArrowUp","ArrowDown","ArrowLeft","ArrowRight","Enter"," "].includes(t.key))return;if(t.preventDefault(),t.key==="Enter"||t.key===" "){const d=q(E[s]);ee(d);return}let a=s;t.key==="ArrowLeft"&&(a=Math.max(0,s-1)),t.key==="ArrowRight"&&(a=Math.min(E.length-1,s+1)),t.key==="ArrowUp"&&(a=Math.max(0,s-7)),t.key==="ArrowDown"&&(a=Math.min(E.length-1,s+7)),qe(a),Re(q(E[a])),setTimeout(()=>{const d=document.querySelectorAll('[data-calendar-cell="true"]');d[a]&&d[a].focus()},0)},[E,ee]);return re?e.jsxs("div",{className:"min-h-screen bg-muted",children:[e.jsx("div",{className:"sm:hidden fixed top-0 left-0 right-0 z-overlay border-b border-border bg-card/90 backdrop-blur",children:e.jsxs("div",{className:"mx-auto max-w-6xl px-3 py-3 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-10 w-10 rounded-2xl bg-muted animate-pulse"}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("div",{className:"h-4 w-12 rounded bg-muted animate-pulse"}),e.jsx("div",{className:"h-3 w-16 rounded bg-muted animate-pulse"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-9 w-9 rounded-2xl bg-muted animate-pulse"}),e.jsx("div",{className:"h-9 w-9 rounded-2xl bg-muted animate-pulse"})]})]})}),e.jsx("div",{className:"mx-auto max-w-6xl px-3 sm:px-4 pt-20 pb-5 sm:py-8",children:e.jsxs("div",{className:"mt-4 rounded-3xl border border-border bg-card overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-3 sm:px-5 py-3 border-b border-border",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"h-9 w-9 rounded-2xl bg-muted animate-pulse"}),e.jsx("div",{className:"h-9 w-9 rounded-2xl bg-muted animate-pulse"})]}),e.jsx("div",{className:"h-6 w-32 rounded bg-muted animate-pulse"}),e.jsx("div",{className:"h-9 w-9 rounded-2xl bg-muted animate-pulse"})]}),e.jsx("div",{className:"p-3 sm:p-5",children:e.jsxs("div",{className:"grid grid-cols-7 gap-1.5 sm:gap-2",children:[Array.from({length:7}).map((t,s)=>e.jsx("div",{className:"px-0.5 pb-1 flex justify-center",children:e.jsx("div",{className:"h-3 w-4 rounded bg-muted animate-pulse"})},`wh-${s}`)),Array.from({length:35}).map((t,s)=>e.jsx("div",{className:"aspect-square rounded-2xl bg-muted/50 animate-pulse"},`cs-${s}`))]})})]})})]}):H?e.jsxs("div",{className:"flex flex-col items-center justify-center p-8 text-center",children:[e.jsx($t,{className:"h-12 w-12 text-destructive mb-4"}),e.jsx("h3",{className:"font-semibold",children:"Impossible de charger les données"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:H.message}),e.jsx(Ot,{onClick:()=>je(),className:"mt-4",children:"Réessayer"})]}):e.jsxs("div",{className:"min-h-screen bg-muted",children:[e.jsx("div",{className:"sm:hidden fixed top-0 left-0 right-0 z-overlay border-b border-border bg-card/90 backdrop-blur",children:e.jsxs("div",{className:"mx-auto max-w-6xl px-3 py-3 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-10 w-10 rounded-2xl bg-card border border-border flex items-center justify-center",children:e.jsx(Ie,{className:"h-5 w-5 text-foreground"})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("div",{className:"text-sm font-semibold text-foreground",children:"Suivi"}),e.jsxs("div",{className:"text-[11px] text-muted-foreground",children:[He," km"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(S,{onClick:()=>Me(!0),label:"Infos",children:e.jsx(Xe,{className:"h-5 w-5"})}),e.jsx(S,{onClick:()=>Se(!0),label:"Paramètres",children:e.jsx(tt,{className:"h-5 w-5"})})]})]})}),e.jsxs("div",{className:"mx-auto max-w-6xl px-3 sm:px-4 pt-20 pb-5 sm:py-8",children:[e.jsxs("div",{className:"invisible sm:visible flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-10 w-10 rounded-2xl bg-card border border-border flex items-center justify-center",children:e.jsx(Ie,{className:"h-5 w-5 text-foreground"})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("div",{className:"text-sm font-semibold text-foreground",children:"Suivi"}),e.jsxs("div",{className:"text-[11px] text-muted-foreground",children:[He," km"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(S,{onClick:()=>Me(!0),label:"Infos",children:e.jsx(Xe,{className:"h-5 w-5"})}),e.jsx(S,{onClick:()=>Se(!0),label:"Paramètres",children:e.jsx(tt,{className:"h-5 w-5"})})]})]}),e.jsxs("div",{className:"mt-4 rounded-3xl border border-border bg-card overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-3 sm:px-5 py-3 border-b border-border",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(S,{onClick:ht,label:"Mois précédent",children:e.jsx(Kt,{className:"h-5 w-5"})}),e.jsx(S,{onClick:yt,label:"Mois suivant",children:e.jsx(Ge,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"min-w-0 text-center",children:[e.jsx("div",{className:"text-base font-semibold text-foreground capitalize truncate",children:Xt(de)}),e.jsxs("div",{className:"mt-1 flex items-center justify-center gap-1",children:[e.jsx("span",{className:m("h-1.5 w-1.5 rounded-full",k.total>0&&k.completed>=1?"bg-status-success":"bg-muted-foreground/30")}),e.jsx("span",{className:m("h-1.5 w-1.5 rounded-full",k.total>0&&k.completed>=2?"bg-status-success":"bg-muted-foreground/30")})]})]}),e.jsx(S,{onClick:jt,label:"Aller à aujourd’hui",tone:"neutral",children:e.jsx(me,{className:"h-5 w-5"})})]}),e.jsx("div",{className:"p-3 sm:p-5",children:e.jsxs("div",{className:"grid grid-cols-7 gap-1.5 sm:gap-2",children:[Ht.map((t,s)=>e.jsxs("div",{className:"px-0.5 pb-1 text-[10px] font-semibold text-muted-foreground text-center",children:[e.jsx("span",{className:"sm:hidden",children:t}),e.jsx("span",{className:"hidden sm:inline",children:nt[s]})]},t+s)),E.map((t,s)=>{const r=q(t),a=t.getMonth()===de.getMonth(),d=r===V,b=ue[r]||{completed:0,total:2},h=Ut(t,ft),j=Te===s||Te===null&&h;return e.jsx(os,{date:t,inMonth:a,isToday:h,isSelected:d,isFocused:j,status:b,onClick:()=>ee(r),onKeyDown:c=>Mt(c,s)},r)})]})})]}),e.jsx(ct,{open:gt,title:"Codes",onClose:()=>Me(!1),children:e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsxs("div",{className:"flex items-center justify-between rounded-2xl border border-orange-200 bg-orange-50 px-3 py-2",children:[e.jsx("span",{className:"font-semibold",children:"Orange"}),e.jsx("span",{className:"text-foreground",children:"À compléter"})]}),e.jsxs("div",{className:"flex items-center justify-between rounded-2xl border border-emerald-200 bg-emerald-50 px-3 py-2",children:[e.jsx("span",{className:"font-semibold",children:"Vert"}),e.jsx("span",{className:"text-foreground",children:"Validé → km"})]}),e.jsxs("div",{className:"flex items-center justify-between rounded-2xl border border-sky-200 bg-sky-50 px-3 py-2",children:[e.jsx("span",{className:"font-semibold",children:"Bleu"}),e.jsx("span",{className:"text-foreground",children:"Absent / Non prévu"})]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Les km comptent uniquement après validation."})]})}),e.jsx(ct,{open:bt,title:"Présence",onClose:()=>Se(!1),children:e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"Toggle hebdo (séances attendues)."}),e.jsxs("div",{className:"overflow-hidden rounded-2xl border border-border bg-card",children:[e.jsxs("div",{className:"grid grid-cols-[1fr_110px_110px] bg-muted border-b border-border px-3 py-2 text-xs font-semibold text-muted-foreground",children:[e.jsx("div",{children:"Jour"}),e.jsx("div",{className:"text-center",children:"Matin"}),e.jsx("div",{className:"text-center",children:"Soir"})]}),nt.map((t,s)=>e.jsxs("div",{className:m("grid grid-cols-[1fr_110px_110px] items-center px-3 py-2",s!==6&&"border-b border-border"),children:[e.jsx("div",{className:"text-sm font-medium text-foreground",children:t}),rt.map(r=>{const a=!!$?.[s]?.[r.key];return e.jsx("div",{className:"flex justify-center",children:e.jsx("button",{type:"button",onClick:()=>kt(s,r.key),className:m("w-24 rounded-2xl border px-3 py-2 text-sm font-semibold transition",a?"bg-foreground text-background border-foreground":"bg-card text-foreground border-border hover:bg-muted"),"aria-label":`${t} ${r.label}`,children:a?"On":"Off"})},r.key)})]},t))]}),e.jsxs("div",{className:"rounded-2xl border border-border bg-muted px-3 py-2",children:[e.jsx("div",{className:"text-xs font-semibold text-foreground",children:"Durée (valeur par défaut)"}),e.jsxs("div",{className:"mt-2 flex items-center gap-2",children:[e.jsx("button",{type:"button",className:"h-9 w-9 rounded-2xl border border-border bg-card hover:bg-muted flex items-center justify-center",onClick:()=>ve(t=>Math.max(30,t-15)),"aria-label":"Diminuer la durée",children:e.jsx(xt,{className:"h-4 w-4"})}),e.jsxs("div",{className:"text-sm font-semibold text-foreground",children:[U," min"]}),e.jsx("button",{type:"button",className:"h-9 w-9 rounded-2xl border border-border bg-card hover:bg-muted flex items-center justify-center",onClick:()=>ve(t=>Math.min(240,t+15)),"aria-label":"Augmenter la durée",children:e.jsx(mt,{className:"h-4 w-4"})})]}),e.jsx("div",{className:"mt-1 text-[11px] text-muted-foreground",children:"Durée envoyée au back-end (non affichée dans la maquette)."})]})]})}),e.jsxs(as,{open:X,title:Gt(R),onClose:_e,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-10 w-10 rounded-2xl border border-border bg-card flex items-center justify-center",children:e.jsx(Ie,{className:"h-5 w-5 text-foreground"})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"text-sm font-semibold text-foreground",children:[St," km"]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:m("h-1.5 w-1.5 rounded-full",k.total>0&&k.completed>=1?"bg-status-success":"bg-muted-foreground/30")}),e.jsx("span",{className:m("h-1.5 w-1.5 rounded-full",k.total>0&&k.completed>=2?"bg-status-success":"bg-muted-foreground/30")})]})]})]}),e.jsx(S,{onClick:vt,label:"OFF (absent journée)",tone:"dark",disabled:G,children:e.jsx(zt,{className:"h-5 w-5"})})]}),e.jsx("div",{className:"mt-4 grid gap-2",children:_.map(t=>{const s=P(t,R),r=!!v[t.id],a=s.status==="absent",d=s.status==="not_expected",b=a||d,h=s.expected&&!r&&!a,j=r?"bg-status-success-bg border-status-success/30":b?"bg-sky-50 border-sky-200":h?"bg-status-warning-bg border-status-warning/30":"bg-card border-border",c=rt.find(f=>f.key===t.slotKey)?.Icon||me;return e.jsx("button",{type:"button",onClick:()=>Fe(t.id),className:m("w-full rounded-3xl border px-3 py-3 text-left transition",j,"hover:shadow-sm"),children:e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[e.jsx("div",{className:m("h-10 w-10 rounded-2xl border flex items-center justify-center",r?"border-status-success/30 bg-status-success-bg":b?"border-sky-200 bg-sky-100":h?"border-status-warning/30 bg-status-warning-bg":"border-border bg-muted"),children:e.jsx(c,{className:"h-5 w-5 text-foreground"})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"truncate text-sm font-semibold text-foreground",children:t.title}),e.jsxs("div",{className:"mt-1 flex items-center gap-2",children:[t.isEmpty?e.jsx(be,{children:"Vide"}):e.jsxs(be,{children:[se(t.km)," km"]}),r&&e.jsxs("span",{className:"inline-flex items-center text-emerald-800",children:[e.jsx(et,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Présent"})]}),b&&!r&&e.jsxs("span",{className:"inline-flex items-center text-sky-800",children:[e.jsx(xe,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Absent"})]}),h&&e.jsxs("span",{className:"inline-flex items-center text-orange-900",children:[e.jsx(me,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"En attente"})]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[d&&e.jsx(S,{onClick:f=>{f.stopPropagation(),We(t.id)},label:"Je suis venu",disabled:G,children:e.jsx(st,{className:"h-5 w-5"})}),s.expected&&!r&&!a&&e.jsx(S,{onClick:f=>{f.stopPropagation(),Ye(t.id)},label:"Absent",tone:"sky",disabled:G,children:e.jsx(xe,{className:"h-5 w-5"})})]})]})},t.id)})}),e.jsx(ge,{children:p&&e.jsx(O.div,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},exit:{opacity:0,y:8},transition:{duration:.18},className:"mt-4 rounded-3xl border border-border bg-card overflow-hidden",children:(()=>{const t=P(p,R),s=t.status==="absent",r=t.status==="not_expected",a=!!v[p.id],d=t.expected&&!s,b=s?"Annuler":r?"Je suis venu":"Absent",h=s?()=>Nt(p.id):r?()=>We(p.id):()=>Ye(p.id),j=dt(p.km??0);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-border",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"truncate text-sm font-semibold text-foreground",children:p.title}),e.jsxs("div",{className:"mt-1 flex items-center gap-2",children:[p.isEmpty?e.jsx(be,{children:"Vide"}):e.jsxs(be,{children:[se(p.km)," km"]}),a?e.jsxs("span",{className:"inline-flex items-center text-emerald-800",children:[e.jsx(et,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Présent"})]}):s||r?e.jsxs("span",{className:"inline-flex items-center text-sky-800",children:[e.jsx(xe,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Absent"})]}):e.jsxs("span",{className:"inline-flex items-center text-orange-900",children:[e.jsx(me,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"En attente"})]})]})]}),e.jsx(S,{onClick:()=>{B(null),I(!1)},label:"Retour",children:e.jsx($e,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 p-3",children:[e.jsxs("button",{type:"button",onClick:h,className:m("rounded-2xl px-3 py-3 text-sm font-semibold border transition inline-flex items-center justify-center gap-2",r?"bg-foreground text-background border-foreground hover:opacity-90":"bg-card text-foreground border-border hover:bg-muted"),children:[r?e.jsx(st,{className:"h-4 w-4"}):e.jsx(xe,{className:"h-4 w-4"}),b]}),e.jsxs("button",{type:"button",onClick:()=>I(c=>!c),className:"rounded-2xl px-3 py-3 text-sm font-semibold border border-border bg-card hover:bg-muted inline-flex items-center justify-center gap-2",children:[e.jsx(It,{className:"h-4 w-4"}),"Fiche"]})]}),e.jsx(ge,{children:pt&&e.jsxs(O.div,{initial:{opacity:0,y:6},animate:{opacity:1,y:0},exit:{opacity:0,y:6},transition:{duration:.16},className:"mx-3 mb-3 rounded-2xl border border-border bg-muted p-3",children:[p.details?.length?e.jsx("ul",{className:"list-disc pl-5 space-y-1 text-sm text-foreground",children:p.details.map((c,f)=>e.jsx("li",{children:c},f))}):e.jsx("div",{className:"text-sm text-muted-foreground",children:p.assignmentId?"Séance coach — détails dans la fiche.":"Aucun détail pour ce créneau."}),p.assignmentId?e.jsx("div",{className:"mt-3",children:e.jsx("button",{type:"button",onClick:()=>x(`/swim-session?assignmentId=${p.assignmentId}`),className:"w-full rounded-2xl border border-border bg-card px-3 py-2 text-sm font-semibold text-foreground hover:bg-muted",children:"Ouvrir la fiche complète"})}):null]})}),e.jsxs("div",{className:"px-4 pb-4",children:[!d&&e.jsx("div",{className:"mb-3 rounded-2xl bg-sky-50 text-sky-900 px-3 py-2 text-xs",children:s?"Absent: aucun ressenti.":'Non prévu: appuyez "Je suis venu".'}),e.jsxs(O.div,{className:"space-y-4",variants:Et,initial:"hidden",animate:"visible",children:[fe.map(c=>{const f=y[c.key];return e.jsxs(O.div,{className:"space-y-2",variants:Ze,children:[e.jsx("div",{className:m("text-sm font-semibold",d?"text-foreground":"text-muted-foreground"),children:c.label}),e.jsx("div",{className:"flex items-center gap-2",children:[1,2,3,4,5].map(M=>{const Y=f===M;return e.jsx("button",{type:"button",disabled:!d,onClick:()=>T(Dt=>({...Dt,[c.key]:M})),className:m("h-11 w-11 rounded-2xl border text-sm font-semibold transition",d?Y?ls(c.mode,M):"bg-card text-foreground border-border hover:bg-muted":"bg-muted text-muted-foreground border-border cursor-not-allowed"),children:M},M)})})]},c.key)}),e.jsxs(O.div,{className:"space-y-2",variants:Ze,children:[e.jsx("div",{className:m("text-sm font-semibold",d?"text-foreground":"text-muted-foreground"),children:"Commentaire"}),e.jsx("textarea",{value:y.comment,onChange:c=>T(f=>({...f,comment:c.target.value})),disabled:!d,rows:3,placeholder:"Sensations, points techniques…",className:m("w-full resize-none rounded-3xl border px-4 py-3 text-sm outline-none",d?"bg-card text-foreground border-border focus:ring-2 focus:ring-foreground/10":"bg-muted text-muted-foreground border-border")})]})]}),e.jsx(ds,{plannedMeters:j,valueMeters:y.distanceMeters,onChange:c=>T(f=>({...f,distanceMeters:c})),disabled:!d}),e.jsxs("div",{className:"mt-3",children:[e.jsxs("button",{type:"button",disabled:!d,onClick:()=>T(c=>({...c,showStrokeDetail:!c.showStrokeDetail})),className:m("flex w-full items-center justify-between rounded-2xl border px-3 py-2 text-sm font-semibold transition",d?"text-foreground border-border hover:bg-muted":"text-muted-foreground border-border cursor-not-allowed"),children:[e.jsx("span",{children:"Détail par nage"}),e.jsx(Ge,{className:m("h-4 w-4 transition-transform",y.showStrokeDetail&&"rotate-90")})]}),y.showStrokeDetail&&e.jsx("div",{className:"mt-2 grid grid-cols-5 gap-2",children:Object.keys(ot).map(c=>e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"block text-center text-xs font-medium text-muted-foreground",children:ot[c]}),e.jsx("input",{type:"number",inputMode:"numeric",min:0,step:100,disabled:!d,value:y.strokes[c],onChange:f=>T(M=>({...M,strokes:{...M.strokes,[c]:f.target.value}})),placeholder:"0",className:m("w-full rounded-xl border px-1 py-2 text-center text-sm outline-none",d?"bg-card text-foreground border-border focus:ring-2 focus:ring-foreground/10":"bg-muted text-muted-foreground")}),e.jsx("div",{className:"text-center text-[10px] text-muted-foreground",children:"m"})]},c))})]}),e.jsxs(Pt,{saveState:L,children:[e.jsx("button",{type:"button",onClick:wt,disabled:G||!d||!fe.every(c=>Number.isInteger(y[c.key])),className:m("rounded-2xl px-4 py-3 text-sm font-semibold transition flex-1",G||!d?"bg-muted text-muted-foreground cursor-not-allowed":fe.every(c=>Number.isInteger(y[c.key]))?"bg-status-success text-white hover:opacity-90":"bg-status-success-bg text-status-success cursor-not-allowed"),children:"Valider"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"→ km"})]})]})]})})()},p.id)})]})]})]})}export{Ms as default};
