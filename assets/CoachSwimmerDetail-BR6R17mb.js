import{r as c,u as M,j as e,c as be,d as R,f as ys}from"./vendor-query-DyA9aSKS.js";import{c as ts,B as F,P as oe,d as ve,L as $,I as Z,s as ns,X as bs,G as vs,T as Ns,u as as,g as _s,t as Cs,Z as ws,b as Ss}from"./index-DukBoFI0.js";import{a as h}from"./api-DaVd0xqR.js";import{T as ks,a as Ts,b as _e,c as Ce}from"./tabs-3VoRu60Y.js";import{B as U}from"./badge-q9Cx6pzV.js";import{C as rs,w as is,a as ls,S as Ge,G as cs,b as Ds}from"./SwimmerFeedbackTab-CTOLTNjB.js";import{T as ze}from"./textarea-DI-Yd184.js";import{S as ue,a as me,b as xe,c as he,d as X}from"./select-CGS3CQBY.js";import{T as Es,a as Le}from"./toggle-group-fRRXrIA-.js";import{S as qe,a as Fe,b as Ae,c as Me,d as He}from"./sheet-CJcayetJ.js";import{A as se,a as te,b as ne,c as ae,d as re,e as ie,f as le,g as ce}from"./alert-dialog-BDb6cgrL.js";import{s as os,a as ds,c as us,d as qs,S as ms,e as Qe,f as Se,b as Fs,F as As,p as Je}from"./objectiveHelpers-BZkbUkU3.js";import{T as Pe,M as xs,A as Ms}from"./target-BvgPgZtA.js";import{T as Oe}from"./trash-2-2kLHQvr2.js";import{t as $e}from"./date-DrpgLmFD.js";import{C as Ps}from"./copy-D_leuc4n.js";import{C as Os}from"./index-C82jO-LZ.js";import{P as Ls}from"./pencil-De43ZLB5.js";import{C as Ks,a as $s,b as Ws}from"./collapsible-Db7VRhne.js";import{S as Rs,b as zs,c as Qs}from"./smsUtils-p3Ne03WD.js";import{C as Bs}from"./chevron-up-BpjU-JNT.js";import{C as Us}from"./chevron-down-DRe1EDOM.js";import{C as Be}from"./clock-q5D54Uxz.js";import{C as Vs}from"./chevron-right-BNF74lLS.js";import{M as Is}from"./map-pin-Dl-ahky8.js";import"./vendor-react-BzrpNAyj.js";import"./vendor-charts-BrQ8X25f.js";import"./vendor-supabase-DFPLkPj_.js";import"./vendor-motion-CMsaQ8FX.js";import"./swim-DsbmPiVN.js";import"./index-BWlK1_Ix.js";import"./index-BAUf6cFa.js";import"./chart-column-8Wzt_RlC.js";import"./index-DCX2sNhR.js";import"./index-2CTScZXj.js";import"./vendor-date-B8Mnp-Vt.js";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gs=[["path",{d:"M16 14v2.2l1.6 1",key:"fo4ql5"}],["path",{d:"M16 2v4",key:"4m81vk"}],["path",{d:"M21 7.5V6a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h3.5",key:"1osxxc"}],["path",{d:"M3 10h5",key:"r794hk"}],["path",{d:"M8 2v4",key:"1cmpym"}],["circle",{cx:"16",cy:"16",r:"6",key:"qoo3c4"}]],Hs=ts("calendar-clock",Gs);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Js=[["path",{d:"M9 17H7A5 5 0 0 1 7 7h2",key:"8i5ue5"}],["path",{d:"M15 7h2a5 5 0 1 1 0 10h-2",key:"1b9ql8"}],["line",{x1:"8",x2:"16",y1:"12",y2:"12",key:"1jonct"}]],Ys=ts("link-2",Js);async function Xs(s){const{data:t,error:n}=await ns.rpc("get_auth_uid_for_user",{p_user_id:s});return n?(console.error("[objectives-tab] Failed to resolve auth UUID:",n.message),null):t}const Zs=({open:s,onOpenChange:t,objective:n,athleteName:r,athleteAuthId:l,competitions:o})=>{const{toast:a}=ve(),d=be(),v=!!n,[f,x]=c.useState("chrono"),[b,_]=c.useState(""),[C,y]=c.useState("25"),[L,P]=c.useState(""),[D,E]=c.useState(""),[N,Q]=c.useState(""),[K,B]=c.useState(!1);c.useEffect(()=>{if(s)if(n){const u=!!n.event_code,z=!!n.text;x(u&&z?"both":z?"texte":"chrono"),_(n.event_code??""),y(String(n.pool_length??25)),P(n.target_time_seconds!=null?Se(n.target_time_seconds):""),E(n.text??""),Q(n.competition_id??"")}else x("chrono"),_(""),y("25"),P(""),E(""),Q("")},[s,n]);const m=R({mutationFn:u=>h.createObjective(u),onSuccess:()=>{a({title:"Objectif crÃ©Ã©"}),d.invalidateQueries({queryKey:["objectives",l]}),t(!1)},onError:u=>{a({title:"Erreur",description:u.message,variant:"destructive"})}}),j=R({mutationFn:u=>h.updateObjective(n.id,u),onSuccess:()=>{a({title:"Objectif mis Ã  jour"}),d.invalidateQueries({queryKey:["objectives",l]}),t(!1)},onError:u=>{a({title:"Erreur",description:u.message,variant:"destructive"})}}),g=R({mutationFn:()=>h.deleteObjective(n.id),onSuccess:()=>{a({title:"Objectif supprimÃ©"}),d.invalidateQueries({queryKey:["objectives",l]}),t(!1)},onError:u=>{a({title:"Erreur",description:u.message,variant:"destructive"})}}),O=f==="chrono"||f==="both",p=f==="texte"||f==="both",w=()=>{if(O&&!b){a({title:"Ã‰preuve requise",description:"Veuillez sÃ©lectionner une Ã©preuve.",variant:"destructive"});return}if(O&&L&&Je(L)===null){a({title:"Format invalide",description:"Le temps doit Ãªtre au format m:ss:cc (ex: 1:05:30)",variant:"destructive"});return}if(p&&!D.trim()){a({title:"Texte requis",description:"Veuillez saisir un objectif texte.",variant:"destructive"});return}const u={athlete_id:l,competition_id:N&&N!=="none"?N:null,event_code:O?b:null,pool_length:O?Number(C):null,target_time_seconds:O&&L?Je(L):null,text:p?D.trim():null};v?j.mutate(u):m.mutate(u)},T=m.isPending||j.isPending||g.isPending,S=c.useMemo(()=>{const u=new Date;return u.setHours(0,0,0,0),o.filter(z=>new Date(z.date+"T00:00:00").getTime()>=u.getTime())},[o]);return e.jsxs(e.Fragment,{children:[e.jsx(qe,{open:s,onOpenChange:t,children:e.jsxs(Fe,{side:"right",className:"w-full sm:max-w-md overflow-y-auto",children:[e.jsx(Ae,{children:e.jsx(Me,{children:v?"Modifier l'objectif":"Nouvel objectif"})}),e.jsxs("div",{className:"mt-6 space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx($,{children:"Nageur"}),e.jsx("p",{className:"text-sm font-medium",children:r})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx($,{children:"Type d'objectif"}),e.jsxs(Es,{type:"single",variant:"outline",value:f,onValueChange:u=>{u&&x(u)},className:"justify-start",children:[e.jsx(Le,{value:"chrono",className:"text-xs",children:"Chrono"}),e.jsx(Le,{value:"texte",className:"text-xs",children:"Texte"}),e.jsx(Le,{value:"both",className:"text-xs",children:"Les deux"})]})]}),O&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx($,{children:"Ã‰preuve *"}),e.jsxs(ue,{value:b,onValueChange:_,children:[e.jsx(me,{children:e.jsx(xe,{placeholder:"Choisir une Ã©preuve"})}),e.jsx(he,{children:As.map(u=>e.jsx(X,{value:u,children:Qe(u)},u))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx($,{children:"Bassin"}),e.jsxs(ue,{value:C,onValueChange:y,children:[e.jsx(me,{children:e.jsx(xe,{})}),e.jsxs(he,{children:[e.jsx(X,{value:"25",children:"25m"}),e.jsx(X,{value:"50",children:"50m"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx($,{children:"Temps cible (min:sec:centiÃ¨mes)"}),e.jsx(Z,{placeholder:"Ex : 1:05:30",value:L,onChange:u=>P(u.target.value)})]})]}),p&&e.jsxs("div",{className:"space-y-2",children:[e.jsx($,{children:"Objectif texte *"}),e.jsx(ze,{placeholder:"Ex : AmÃ©liorer la coulÃ©e de dos",value:D,onChange:u=>E(u.target.value),rows:3})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx($,{children:"Lier Ã  une compÃ©tition"}),e.jsxs(ue,{value:N,onValueChange:Q,children:[e.jsx(me,{children:e.jsx(xe,{placeholder:"Aucune"})}),e.jsxs(he,{children:[e.jsx(X,{value:"none",children:"Aucune"}),S.map(u=>e.jsxs(X,{value:u.id,children:[u.name," (",u.date,")"]},u.id))]})]})]}),e.jsxs("div",{className:"space-y-2 pt-2",children:[e.jsx(F,{className:"w-full",onClick:w,disabled:T,children:T?"Enregistrement...":v?"Enregistrer":"CrÃ©er"}),v&&e.jsx(F,{variant:"outline",className:"w-full text-destructive hover:text-destructive",onClick:()=>B(!0),disabled:T,children:"Supprimer cet objectif"})]})]})]})}),e.jsx(se,{open:K,onOpenChange:B,children:e.jsxs(te,{children:[e.jsxs(ne,{children:[e.jsx(ae,{children:"Supprimer l'objectif"}),e.jsx(re,{children:"Cette action est irrÃ©versible. L'objectif sera supprimÃ© dÃ©finitivement."})]}),e.jsxs(ie,{children:[e.jsx(le,{children:"Annuler"}),e.jsx(ce,{onClick:()=>{g.mutate(),B(!1)},className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Supprimer"})]})]})})]})};function et(s){const t=s.split("-");return t.length===3?`${t[2]}/${t[1]}/${t[0]}`:s}const st=({objective:s,performances:t,onEdit:n})=>{const r=s.event_code?os(s.event_code):null,l=r?ms[r]??"":"",o=s.event_code?ds(t,s.event_code,s.pool_length):null;let a=null,d=null;o&&s.target_time_seconds!=null&&s.event_code&&(a=o.time-s.target_time_seconds,d=us(o.time,s.target_time_seconds,s.event_code));const v=!!s.competition_name,f=s.competition_date?qs(s.competition_date):null;return e.jsxs("button",{type:"button",className:`w-full text-left rounded-lg border bg-card p-3 text-sm space-y-1.5 transition-colors hover:bg-muted/50 ${l?`border-l-4 ${l}`:""}`,onClick:()=>n(s),children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx(Pe,{className:"h-3.5 w-3.5 text-muted-foreground shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0 flex items-center gap-1.5 flex-wrap",children:[s.event_code&&e.jsx("span",{className:"font-medium",children:Qe(s.event_code)}),s.event_code&&s.pool_length&&e.jsxs("span",{className:"text-muted-foreground",children:["(",s.pool_length,"m)"]}),s.target_time_seconds!=null&&e.jsx("span",{className:"font-mono text-xs text-primary",children:Se(s.target_time_seconds)})]}),e.jsx(Oe,{className:"h-3.5 w-3.5 text-muted-foreground/40 shrink-0"})]}),s.text&&e.jsx("p",{className:"text-muted-foreground text-xs pl-5 line-clamp-2",children:s.text}),s.event_code&&o&&e.jsxs("div",{className:"flex items-center gap-2 pl-5 text-xs text-muted-foreground flex-wrap",children:[e.jsxs("span",{children:["Actuel : ",e.jsx("span",{className:"font-mono",children:Se(o.time)})]}),o.date&&e.jsxs("span",{className:"text-muted-foreground/60",children:["(",et(o.date),")"]}),a!=null&&e.jsx("span",{className:a<=0?"text-emerald-600 font-medium":"text-amber-600",children:a<=0?"Objectif atteint !":`+${a.toFixed(2)}s`})]}),s.event_code&&!o&&e.jsx("p",{className:"text-[10px] text-muted-foreground italic pl-5",children:"Pas encore de temps enregistrÃ©"}),d!=null&&e.jsx("div",{className:"pl-5 pr-1",children:e.jsx("div",{className:"h-1.5 w-full rounded-full bg-muted overflow-hidden",children:e.jsx("div",{className:`h-full rounded-full transition-all duration-500 ${Fs(d)}`,style:{width:`${Math.min(d,100)}%`}})})}),v&&e.jsx("div",{className:"pl-5",children:e.jsxs(U,{variant:"outline",className:"border-orange-300 text-orange-600 dark:text-orange-400 text-[10px] px-1.5 py-0",children:[s.competition_name,f!=null&&f>0&&e.jsxs("span",{className:"ml-1 font-bold",children:["J-",f]})]})})]})},tt=({athleteId:s,athleteName:t})=>{const[n,r]=c.useState(!1),[l,o]=c.useState(null),{data:a,isLoading:d}=M({queryKey:["auth-uid",s],queryFn:()=>Xs(s),enabled:!!s}),{data:v=[]}=M({queryKey:["competitions"],queryFn:()=>h.getCompetitions()}),{data:f=[],isLoading:x}=M({queryKey:["objectives",a],queryFn:()=>h.getObjectives(a),enabled:!!a}),{data:b}=M({queryKey:["profile",s],queryFn:()=>h.getProfile({userId:s}),enabled:!!s}),_=b?.ffn_iuf??null,C=c.useMemo(()=>{const N=new Date;return N.setDate(N.getDate()-360),N.toISOString().slice(0,10)},[]),{data:y=[]}=M({queryKey:["swimmer-performances-recent",_],queryFn:()=>h.getSwimmerPerformances({iuf:_,fromDate:C}),enabled:!!_}),L=()=>{o(null),r(!0)},P=N=>{o(N),r(!0)},D=d,E=!!a&&!d;return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex justify-end",children:e.jsxs(F,{variant:"outline",size:"sm",onClick:L,disabled:!a,children:[e.jsx(oe,{className:"mr-1.5 h-3.5 w-3.5"}),"Ajouter un objectif"]})}),D&&e.jsx("div",{className:"space-y-2",children:[1,2,3].map(N=>e.jsx("div",{className:"rounded-xl border p-3 animate-pulse motion-reduce:animate-none",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-4 w-40 rounded bg-muted"}),e.jsx("div",{className:"ml-auto h-5 w-12 rounded bg-muted"})]})},N))}),E&&x&&e.jsx("div",{className:"space-y-2",children:[1,2].map(N=>e.jsx("div",{className:"rounded-xl border p-3 animate-pulse motion-reduce:animate-none",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-4 w-32 rounded bg-muted"}),e.jsx("div",{className:"ml-auto h-5 w-16 rounded bg-muted"})]})},N))}),E&&!x&&f.length===0&&e.jsxs("div",{className:"text-center py-12 space-y-3",children:[e.jsx(Pe,{className:"h-10 w-10 text-muted-foreground mx-auto"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Aucun objectif dÃ©fini pour ",t,"."]}),e.jsxs(F,{variant:"outline",size:"sm",onClick:L,children:[e.jsx(oe,{className:"mr-1.5 h-3.5 w-3.5"}),"CrÃ©er le premier objectif"]})]}),E&&!x&&f.length>0&&e.jsxs("div",{className:"space-y-2",children:[f.map(N=>e.jsx(st,{objective:N,performances:y,onEdit:P},N.id)),e.jsx("p",{className:"text-[10px] text-muted-foreground/60 italic text-center pt-1",children:"Les temps Â« Actuel Â» correspondent Ã  la meilleure performance des 360 derniers jours sur l'Ã©preuve."})]}),a&&e.jsx(Zs,{open:n,onOpenChange:r,objective:l,athleteName:t,athleteAuthId:a,competitions:v})]})},We="__today__";function Re(s,t){const n=[],r=new Date(s+"T00:00:00"),l=new Date(t+"T00:00:00"),o=new Date(r),a=o.getDay(),d=a===0?1:a===1?0:8-a;for(o.setDate(o.getDate()+d);o<=l;)n.push(o.toISOString().split("T")[0]),o.setDate(o.getDate()+7);return n}function we(s){return new Date(s+"T00:00:00").toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric"})}function ke(s){return new Date(s+"T00:00:00").toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit"})}function nt(s){const t=new Date(s+"T00:00:00");return t.setDate(t.getDate()+6),t.toISOString().split("T")[0]}function at(s){const t=new Date;t.setHours(0,0,0,0);const n=new Date(s+"T00:00:00"),r=new Date(s+"T00:00:00");return r.setDate(r.getDate()+6),t>=n&&t<=r}const rt=({athleteId:s})=>{const{toast:t}=ve(),n=be(),[r,l]=c.useState(null),[o,a]=c.useState(null),[d,v]=c.useState(""),[f,x]=c.useState(""),[b,_]=c.useState(!1),[C,y]=c.useState(!1),[L,P]=c.useState(!1),[D,E]=c.useState(""),[N,Q]=c.useState(""),[K,B]=c.useState(""),{data:m=[]}=M({queryKey:["athletes"],queryFn:()=>h.getAthletes()}),j=c.useMemo(()=>m.find(A=>A.id===s)?.group_id??null,[m,s]),{data:g=[],isLoading:O}=M({queryKey:["training-cycles","athlete",s],queryFn:()=>h.getTrainingCycles({athleteId:s})}),{data:p=[],isLoading:w}=M({queryKey:["training-cycles","group",j],queryFn:()=>h.getTrainingCycles({groupId:j}),enabled:j!=null}),T=g.length===0&&p.length>0,S=g.length>0?g:p;c.useEffect(()=>{S.length>0&&(!r||!S.find(i=>i.id===r))&&l(S[0].id)},[S,r]);const u=S.find(i=>i.id===r)??null,{data:z=[],isLoading:pe}=M({queryKey:["training-weeks",r],queryFn:()=>h.getTrainingWeeks(r),enabled:!!r}),{data:q=[]}=M({queryKey:["competitions"],queryFn:()=>h.getCompetitions()}),W=c.useMemo(()=>[...q].sort((i,A)=>i.date.localeCompare(A.date)),[q]),V=c.useMemo(()=>{const i=new Set;return z.forEach(A=>{A.week_type&&i.add(A.week_type)}),Array.from(i).sort()},[z]),I=u?.start_competition_date??u?.start_date??null,k=c.useMemo(()=>{if(!u)return[];const i=I,A=u.end_competition_date;return!i||!A?[]:Re(i,A)},[u,I]),de=c.useMemo(()=>{const i=new Map;return z.forEach(A=>i.set(A.week_start,A)),i},[z]),ge=O||w,je=R({mutationFn:async i=>{const A=await h.createTrainingCycle(i),G=i.start_date??q.find(J=>J.id===i.start_competition_id)?.date,H=q.find(J=>J.id===i.end_competition_id);if(G&&H){const J=Re(G,H.date);J.length>0&&await h.bulkUpsertTrainingWeeks(J.map(Ne=>({cycle_id:A.id,week_start:Ne})))}return A},onSuccess:i=>{t({title:"Cycle cree"}),l(i.id),_(!1),E(""),Q(""),B(""),n.invalidateQueries({queryKey:["training-cycles"]}),n.invalidateQueries({queryKey:["training-weeks",i.id]})},onError:i=>{t({title:"Erreur",description:i.message,variant:"destructive"})}}),fe=R({mutationFn:i=>h.deleteTrainingCycle(i),onSuccess:()=>{t({title:"Cycle supprime"}),l(null),y(!1),n.invalidateQueries({queryKey:["training-cycles"]})},onError:i=>{t({title:"Erreur",description:i.message,variant:"destructive"})}}),Ue=R({mutationFn:i=>h.upsertTrainingWeek(i),onSuccess:()=>{a(null),n.invalidateQueries({queryKey:["training-weeks",r]})},onError:i=>{t({title:"Erreur",description:i.message,variant:"destructive"})}}),Ve=R({mutationFn:async()=>{for(const i of p){const A=await h.createTrainingCycle({athlete_id:s,group_id:null,start_competition_id:i.start_competition_id,end_competition_id:i.end_competition_id,name:i.name,notes:i.notes}),G=await h.getTrainingWeeks(i.id);G.length>0&&await h.bulkUpsertTrainingWeeks(G.map(H=>({cycle_id:A.id,week_start:H.week_start,week_type:H.week_type,notes:H.notes})))}},onSuccess:()=>{t({title:"Planification personnalisee"}),P(!1),l(null),n.invalidateQueries({queryKey:["training-cycles"]})},onError:i=>{t({title:"Erreur",description:i.message,variant:"destructive"})}}),Ie=()=>{if(!D.trim()){t({title:"Nom requis",variant:"destructive"});return}if(!N||!K){t({title:"Dates requises",description:"Choisis un debut et une fin.",variant:"destructive"});return}const i=N===We,A=i?$e(new Date):null,G=i?null:q.find(Ne=>Ne.id===N),H=q.find(Ne=>Ne.id===K),J=i?A:G?.date;if(J&&H&&H.date<=J){t({title:"Dates invalides",description:"La fin doit etre apres le debut.",variant:"destructive"});return}je.mutate({athlete_id:s,group_id:null,start_competition_id:i?null:N,end_competition_id:K,start_date:A,name:D.trim()})},ps=i=>{a(i.id),v(i.week_type??""),x(i.notes??"")},gs=i=>{a(`new:${i}`),v(""),x("")},js=(i,A)=>{r&&Ue.mutate({cycle_id:r,week_start:i,week_type:d.trim()||null,notes:f.trim()||null})},fs=()=>{a(null)};return!ge&&S.length===0?e.jsxs("div",{className:"text-center py-12 space-y-3",children:[e.jsx(rs,{className:"h-10 w-10 text-muted-foreground mx-auto"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Aucun cycle pour ce nageur."}),e.jsxs(F,{variant:"outline",size:"sm",onClick:()=>_(!0),children:[e.jsx(oe,{className:"mr-1.5 h-3.5 w-3.5"}),"Nouveau cycle"]}),e.jsx(Ye,{open:b,onOpenChange:_,competitions:W,name:D,setName:E,startId:N,setStartId:Q,endId:K,setEndId:B,onSubmit:Ie,isPending:je.isPending})]}):ge?e.jsx("div",{className:"space-y-3",children:[1,2,3].map(i=>e.jsx("div",{className:"rounded-xl border p-3 animate-pulse motion-reduce:animate-none",children:e.jsx("div",{className:"h-4 w-48 rounded bg-muted"})},i))}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[S.length>1?e.jsxs(ue,{value:r??"",onValueChange:l,children:[e.jsx(me,{className:"w-auto min-w-[180px] h-8 text-sm",children:e.jsx(xe,{placeholder:"Choisir un cycle"})}),e.jsx(he,{children:S.map(i=>e.jsx(X,{value:i.id,children:i.name},i.id))})]}):u?e.jsx("span",{className:"text-sm font-semibold",children:u.name}):null,T&&e.jsx(U,{variant:"secondary",className:"text-[10px] px-1.5 py-0",children:"Planif. groupe"}),e.jsx("div",{className:"flex-1"}),T&&e.jsxs(F,{variant:"outline",size:"sm",className:"text-xs h-7",onClick:()=>P(!0),children:[e.jsx(Ps,{className:"mr-1 h-3 w-3"}),"Personnaliser"]}),e.jsxs(F,{variant:"outline",size:"sm",className:"text-xs h-7",onClick:()=>_(!0),children:[e.jsx(oe,{className:"mr-1 h-3 w-3"}),"Nouveau"]}),u&&!T&&e.jsx(F,{variant:"ghost",size:"sm",className:"text-xs h-7 text-destructive hover:text-destructive",onClick:()=>y(!0),children:e.jsx(Oe,{className:"h-3 w-3"})})]}),u&&e.jsxs("div",{className:"space-y-0",children:[e.jsxs("div",{className:"flex items-center gap-2 py-2 px-1",children:[e.jsx("span",{className:"text-base","aria-hidden":"true",children:u.start_competition_id?"ðŸŠ":"ðŸ“…"}),e.jsx("span",{className:"text-sm font-medium",children:u.start_competition_id?u.start_competition_name??"Competition":"Debut du cycle"}),I&&e.jsxs("span",{className:"text-xs text-muted-foreground",children:["(",we(I),")"]})]}),e.jsx("div",{className:"relative ml-3 border-l-2 border-border pl-4 space-y-1",children:pe?e.jsx("div",{className:"py-4",children:e.jsx("div",{className:"h-4 w-32 rounded bg-muted animate-pulse motion-reduce:animate-none"})}):k.map((i,A)=>{const G=de.get(i),H=at(i),J=o===(G?.id??`new:${i}`);return e.jsx(it,{monday:i,weekNumber:A+1,week:G,isCurrent:H,isEditing:J,isGroupPlan:T,editWeekType:d,setEditWeekType:v,editWeekNotes:f,setEditWeekNotes:x,existingWeekTypes:V,onStartEdit:()=>G?ps(G):gs(i),onSave:()=>js(i),onCancel:fs,isSaving:Ue.isPending},i)})}),e.jsxs("div",{className:"flex items-center gap-2 py-2 px-1",children:[e.jsx("span",{className:"text-base","aria-hidden":"true",children:"ðŸŽ¯"}),e.jsx("span",{className:"text-sm font-medium",children:u.end_competition_name??"Competition"}),u.end_competition_date&&e.jsxs("span",{className:"text-xs text-muted-foreground",children:["(",we(u.end_competition_date),")"]})]})]}),e.jsx(Ye,{open:b,onOpenChange:_,competitions:W,name:D,setName:E,startId:N,setStartId:Q,endId:K,setEndId:B,onSubmit:Ie,isPending:je.isPending}),e.jsx(se,{open:C,onOpenChange:y,children:e.jsxs(te,{children:[e.jsxs(ne,{children:[e.jsx(ae,{children:"Supprimer le cycle"}),e.jsx(re,{children:"Le cycle et ses semaines seront supprimes."})]}),e.jsxs(ie,{children:[e.jsx(le,{children:"Annuler"}),e.jsx(ce,{onClick:()=>r&&fe.mutate(r),className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Supprimer"})]})]})}),e.jsx(se,{open:L,onOpenChange:P,children:e.jsxs(te,{children:[e.jsxs(ne,{children:[e.jsx(ae,{children:"Personnaliser la planification"}),e.jsx(re,{children:"Copie le plan du groupe pour ce nageur. Tu pourras ensuite l'ajuster."})]}),e.jsxs(ie,{children:[e.jsx(le,{children:"Annuler"}),e.jsx(ce,{onClick:()=>Ve.mutate(),children:Ve.isPending?"Copie...":"Personnaliser"})]})]})})]})},it=({monday:s,weekNumber:t,week:n,isCurrent:r,isEditing:l,isGroupPlan:o,editWeekType:a,setEditWeekType:d,editWeekNotes:v,setEditWeekNotes:f,existingWeekTypes:x,onStartEdit:b,onSave:_,onCancel:C,isSaving:y})=>{const L=nt(s),P=`week-types-${s}`;return l?e.jsxs("div",{className:`rounded-lg border bg-card p-3 space-y-2 ${r?"ring-2 ring-primary":""}`,children:[e.jsxs("div",{className:"text-xs font-medium text-muted-foreground",children:["Sem. ",t," (",ke(s)," - ",ke(L),")"]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx($,{className:"text-xs",children:"Type de semaine"}),e.jsx(Z,{className:"h-7 text-sm",placeholder:"Ex : Foncier, Affutage",list:P,value:a,onChange:D=>d(D.target.value)}),e.jsx("datalist",{id:P,children:x.map(D=>e.jsx("option",{value:D},D))})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx($,{className:"text-xs",children:"Notes"}),e.jsx(ze,{className:"text-sm min-h-[48px]",placeholder:"Note optionnelle",rows:2,value:v,onChange:D=>f(D.target.value)})]}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsxs(F,{variant:"ghost",size:"sm",className:"h-7 text-xs",onClick:C,children:[e.jsx(bs,{className:"mr-1 h-3 w-3"}),"Annuler"]}),e.jsxs(F,{size:"sm",className:"h-7 text-xs",onClick:_,disabled:y,children:[e.jsx(Os,{className:"mr-1 h-3 w-3"}),y?"...":"Enregistrer"]})]})]}):e.jsxs("button",{type:"button",className:`w-full text-left rounded-lg border bg-card px-3 py-2 flex items-center gap-2 transition-colors ${o?"cursor-default":"hover:bg-muted/50"} ${r?"ring-2 ring-primary":""}`,onClick:o?void 0:b,disabled:o,children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs("span",{className:"text-xs font-medium text-muted-foreground whitespace-nowrap",children:["Sem. ",t]}),e.jsxs("span",{className:"text-[10px] text-muted-foreground/70 whitespace-nowrap",children:["(",ke(s)," - ",ke(L),")"]}),n?.week_type&&e.jsx(U,{className:"text-[10px] px-1.5 py-0 border-0",style:{backgroundColor:ls(n.week_type),color:is(n.week_type)},children:n.week_type})]}),n?.notes&&e.jsx("p",{className:"text-xs text-muted-foreground mt-0.5 line-clamp-1",children:n.notes})]}),!o&&e.jsx(Ls,{className:"h-3 w-3 text-muted-foreground/40 shrink-0"})]})},Ye=({open:s,onOpenChange:t,competitions:n,name:r,setName:l,startId:o,setStartId:a,endId:d,setEndId:v,onSubmit:f,isPending:x})=>(c.useEffect(()=>{s&&(l(""),a(""),v(""))},[s]),e.jsx(qe,{open:s,onOpenChange:t,children:e.jsxs(Fe,{side:"right",className:"w-full sm:max-w-md overflow-y-auto",children:[e.jsx(Ae,{children:e.jsx(Me,{children:"Nouveau cycle"})}),e.jsxs("div",{className:"mt-6 space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx($,{children:"Nom du cycle *"}),e.jsx(Z,{placeholder:"Ex : Preparation hiver",value:r,onChange:b=>l(b.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx($,{children:"Date de debut *"}),e.jsxs(ue,{value:o,onValueChange:a,children:[e.jsx(me,{children:e.jsx(xe,{placeholder:"Choisir..."})}),e.jsxs(he,{children:[e.jsxs(X,{value:We,children:["Aujourd'hui (",we($e(new Date)),")"]}),n.map(b=>e.jsxs(X,{value:b.id,children:[b.name," (",we(b.date),")"]},b.id))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx($,{children:"Competition de fin *"}),e.jsxs(ue,{value:d,onValueChange:v,children:[e.jsx(me,{children:e.jsx(xe,{placeholder:"Choisir..."})}),e.jsx(he,{children:n.map(b=>e.jsxs(X,{value:b.id,children:[b.name," (",we(b.date),")"]},b.id))})]})]}),o&&d&&(()=>{const _=o===We?$e(new Date):n.find(y=>y.id===o)?.date,C=n.find(y=>y.id===d);if(_&&C&&C.date>_){const y=Re(_,C.date).length;return e.jsxs("p",{className:"text-xs text-muted-foreground",children:[y," semaine",y>1?"s":""," seront generees."]})}return null})(),e.jsx(F,{className:"w-full",onClick:f,disabled:x,children:x?"Creation...":"Creer le cycle"})]})]})}));function ye(s){return new Date(s+"T12:00:00").toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric"})}function Te(s){return new Date(s+"T00:00:00").toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit"})}function lt(s){const t=new Date(s+"T00:00:00");return t.setDate(t.getDate()+6),t.toISOString().split("T")[0]}function ct(s){const t=new Date;t.setHours(0,0,0,0);const n=new Date(s+"T00:00:00"),r=new Date(s+"T00:00:00");return r.setDate(r.getDate()+6),t>=n&&t<=r}function Ke(s,t){const n=[],r=new Date(s+"T00:00:00"),l=new Date(t+"T00:00:00"),o=new Date(r),a=o.getDay(),d=a===0?1:a===1?0:8-a;for(o.setDate(o.getDate()+d);o<=l;)n.push(o.toISOString().split("T")[0]),o.setDate(o.getDate()+7);return n}function Xe(s,t){const n=new Date(s+"T00:00:00"),r=new Date(t+"T00:00:00");return Math.round((r.getTime()-n.getTime())/(1e3*60*60*24))}const ot={draft_athlete:{label:"En attente nageur",variant:"secondary",className:"bg-amber-100 text-amber-800 dark:bg-amber-900/40 dark:text-amber-300 border-amber-200 dark:border-amber-800"},draft_coach:{label:"PrÃ©paration coach",variant:"secondary",className:"bg-blue-100 text-blue-800 dark:bg-blue-900/40 dark:text-blue-300 border-blue-200 dark:border-blue-800"},sent:{label:"EnvoyÃ©",variant:"secondary",className:"bg-green-100 text-green-800 dark:bg-green-900/40 dark:text-green-300 border-green-200 dark:border-green-800"},signed:{label:"SignÃ©",variant:"secondary",className:"bg-slate-100 text-slate-600 dark:bg-slate-800/40 dark:text-slate-300 border-slate-200 dark:border-slate-700"}};function dt(s){const t=ot[s];return e.jsx(U,{variant:t.variant,className:`text-[10px] px-1.5 py-0 ${t.className}`,children:t.label})}async function ut(s){const{data:t,error:n}=await ns.rpc("get_auth_uid_for_user",{p_user_id:s});return n?(console.error("[interviews-tab] Failed to resolve auth UUID:",n.message),null):t}const ee=({label:s,text:t})=>e.jsxs("div",{className:"border-l-4 border-blue-400 rounded-r-lg bg-blue-50/50 dark:bg-blue-950/20 p-3 space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(vs,{className:"h-3.5 w-3.5 text-blue-500"}),e.jsx("p",{className:"text-xs font-bold uppercase tracking-widest text-muted-foreground",children:s})]}),e.jsx("p",{className:"text-sm whitespace-pre-wrap",children:t?.trim()||e.jsx("span",{className:"italic text-muted-foreground",children:"Non renseignÃ©"})})]}),De=({label:s,text:t})=>e.jsxs("div",{className:"border-l-4 border-amber-400 rounded-r-lg bg-amber-50/50 dark:bg-amber-950/20 p-3 space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(cs,{className:"h-3.5 w-3.5 text-amber-500"}),e.jsx("p",{className:"text-xs font-bold uppercase tracking-widest text-muted-foreground",children:s})]}),e.jsx("p",{className:"text-sm whitespace-pre-wrap",children:t?.trim()||e.jsx("span",{className:"italic text-muted-foreground",children:"Non renseignÃ©"})})]}),Ee=({label:s,value:t,onChange:n,onBlur:r,placeholder:l,rows:o=3})=>e.jsxs("div",{className:"border-l-4 border-amber-400 rounded-r-lg bg-amber-50/50 dark:bg-amber-950/20 p-3 space-y-1.5",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(cs,{className:"h-3.5 w-3.5 text-amber-500"}),e.jsx("p",{className:"text-xs font-bold uppercase tracking-widest text-muted-foreground",children:s})]}),e.jsx(ze,{className:"bg-white dark:bg-background",placeholder:l,value:t,onChange:a=>n(a.target.value),onBlur:r,rows:o})]}),Y=({label:s})=>e.jsxs("div",{className:"flex items-center gap-2 pt-3",children:[e.jsx("div",{className:"h-px flex-1 bg-border"}),e.jsx("span",{className:"text-xs font-bold uppercase tracking-widest text-muted-foreground",children:s}),e.jsx("div",{className:"h-px flex-1 bg-border"})]}),Ze=({objective:s,performances:t=[]})=>{const n=!!s.event_code,r=!!s.text,l=n?os(s.event_code):null,o=l?ms[l]??"":"",a=n?ds(t,s.event_code,s.pool_length):null;let d=null;return a&&s.target_time_seconds!=null&&s.event_code&&(d=a.time-s.target_time_seconds,us(a.time,s.target_time_seconds,s.event_code)),e.jsxs("div",{className:`rounded-lg border bg-card p-2.5 text-sm space-y-1 ${n?`border-l-4 ${o}`:""}`,children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx(Pe,{className:"h-3.5 w-3.5 text-muted-foreground shrink-0"}),e.jsx("span",{className:"font-medium",children:n?Qe(s.event_code):""}),s.pool_length&&e.jsxs(U,{variant:"secondary",className:"text-[10px] px-1.5 py-0",children:[s.pool_length,"m"]}),s.target_time_seconds!=null&&e.jsx(U,{variant:"outline",className:"text-[10px] px-1.5 py-0 font-mono",children:Se(s.target_time_seconds)})]}),r&&e.jsx("p",{className:"text-muted-foreground line-clamp-2 pl-5",children:s.text}),a&&e.jsxs("div",{className:"flex items-center gap-2 pl-5 text-xs text-muted-foreground flex-wrap",children:[e.jsxs("span",{children:["Actuel : ",e.jsx("span",{className:"font-mono",children:Se(a.time)})]}),a.date&&e.jsxs("span",{className:"text-muted-foreground/60",children:["(",ye(a.date),")"]}),d!=null&&e.jsx("span",{className:d<=0?"text-emerald-600 font-medium":"text-amber-600",children:d<=0?"Objectif atteint !":`+${d.toFixed(2)}s`})]}),!a&&n&&s.target_time_seconds!=null&&e.jsx("p",{className:"text-[10px] text-muted-foreground italic pl-5",children:"Pas encore de temps enregistrÃ©"})]})},es=({prevInterview:s,commitmentReview:t})=>{const[n,r]=c.useState(!1);return e.jsxs(Ks,{open:n,onOpenChange:r,children:[e.jsx($s,{asChild:!0,children:e.jsxs("button",{type:"button",className:"w-full flex items-center gap-2 rounded-xl border bg-muted/30 px-3 py-2.5 text-left transition-colors hover:bg-muted/50",children:[e.jsx(Vs,{className:`h-3.5 w-3.5 text-muted-foreground shrink-0 transition-transform ${n?"rotate-90":""}`}),e.jsx("span",{className:"text-xs font-bold uppercase tracking-widest text-muted-foreground",children:"Rappel engagements prÃ©cÃ©dents"}),e.jsx(U,{variant:"secondary",className:"text-[10px] px-1.5 py-0 ml-auto",children:ye(s.date)})]})}),e.jsx(Ws,{children:e.jsxs("div",{className:"rounded-b-xl border border-t-0 bg-muted/30 px-3 pb-3 space-y-2",children:[s.athlete_commitments&&e.jsxs("div",{className:"border-l-4 border-blue-400 rounded-r-lg bg-blue-50/50 dark:bg-blue-950/20 p-2",children:[e.jsx("p",{className:"text-[10px] font-semibold text-muted-foreground",children:"Engagements nageur"}),e.jsx("p",{className:"text-xs whitespace-pre-wrap",children:s.athlete_commitments})]}),s.coach_actions&&e.jsxs("div",{className:"border-l-4 border-amber-400 rounded-r-lg bg-amber-50/50 dark:bg-amber-950/20 p-2",children:[e.jsx("p",{className:"text-[10px] font-semibold text-muted-foreground",children:"Actions coach"}),e.jsx("p",{className:"text-xs whitespace-pre-wrap",children:s.coach_actions})]}),t&&e.jsxs("div",{className:"border-l-4 border-blue-400 rounded-r-lg bg-blue-50/80 dark:bg-blue-950/30 p-2",children:[e.jsx("p",{className:"text-[10px] font-semibold text-muted-foreground",children:"Bilan du nageur"}),e.jsx("p",{className:"text-xs whitespace-pre-wrap",children:t})]})]})})]})},ss=({athleteId:s,interviewDate:t})=>{const{toast:n}=ve(),r=be(),{data:l=[]}=M({queryKey:["competitions"],queryFn:()=>h.getCompetitions()}),{data:o=[]}=M({queryKey:["my-competition-ids",s],queryFn:()=>h.getMyCompetitionIds(s)}),a=c.useMemo(()=>{const m=new Set(o);return l.filter(j=>m.has(j.id)).sort((j,g)=>j.date.localeCompare(g.date))},[l,o]),d=c.useMemo(()=>a.filter(m=>m.date>=t),[a,t]),{data:v=[]}=M({queryKey:["training-cycles","athlete",s],queryFn:()=>h.getTrainingCycles({athleteId:s})}),f=c.useMemo(()=>{const m=new Map;return v.slice().sort((j,g)=>(j.end_competition_date??"").localeCompare(g.end_competition_date??"")).forEach(j=>{j.end_competition_id&&!m.has(j.end_competition_id)&&m.set(j.end_competition_id,j)}),m},[v]),x=c.useMemo(()=>{const m=new Set;return d.map(j=>f.get(j.id)??null).filter(j=>!j||m.has(j.id)?!1:(m.add(j.id),!0))},[d,f]),b=ys({queries:x.map(m=>({queryKey:["training-weeks",m.id],queryFn:()=>h.getTrainingWeeks(m.id),enabled:!!m.id}))}),[_,C]=c.useState(null),[y,L]=c.useState(""),P=c.useMemo(()=>{const m=new Map;return x.forEach((j,g)=>{m.set(j.id,b[g]?.data??[])}),m},[x,b]),D=c.useMemo(()=>{const m=new Set;return P.forEach(j=>{j.forEach(g=>{g.week_type&&m.add(g.week_type)})}),Array.from(m).sort()},[P]),E=d[0]??null,N=c.useMemo(()=>new Date().toISOString().split("T")[0],[]),Q=E?Xe(N,E.date):null,K=R({mutationFn:async m=>{const j=a.find(S=>S.id===m);if(!j)throw new Error("Pas de compÃ©tition");const g=a.findIndex(S=>S.id===m),O=g>0?a[g-1]:null,p=O?.date??t,w=await h.createTrainingCycle({athlete_id:s,group_id:null,start_competition_id:O?.id??null,start_date:O?null:t,end_competition_id:j.id,name:`PrÃ©paration ${j.name}`}),T=Ke(p,j.date);return T.length>0&&await h.bulkUpsertTrainingWeeks(T.map(S=>({cycle_id:w.id,week_start:S}))),w},onSuccess:()=>{n({title:"Planification crÃ©Ã©e"}),r.invalidateQueries({queryKey:["training-cycles"]}),r.invalidateQueries({queryKey:["training-weeks"]})},onError:m=>{n({title:"Erreur",description:m.message,variant:"destructive"})}}),B=R({mutationFn:m=>h.upsertTrainingWeek(m),onSuccess:()=>{C(null),r.invalidateQueries({queryKey:["training-weeks"]})},onError:m=>{n({title:"Erreur",description:m.message,variant:"destructive"})}});return E?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"rounded-xl border bg-muted/20 p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm flex-wrap",children:[e.jsx(Ns,{className:"h-4 w-4 text-amber-500 shrink-0"}),e.jsxs("span",{className:"font-medium",children:[d.length," Ã©chÃ©ance",d.length>1?"s":""," Ã  planifier"]}),Q!=null&&e.jsxs(U,{variant:"secondary",className:"text-[10px]",children:["prochaine J-",Q]})]}),e.jsx("p",{className:"mt-1 text-xs text-muted-foreground",children:"Une carte par compÃ©tition cible pour construire et piloter plusieurs macrocycles Ã  l'avance."})]}),e.jsx("div",{className:"space-y-3",children:d.map((m,j)=>{const g=f.get(m.id)??null,O=g?P.get(g.id)??[]:[],p=new Map(O.map(q=>[q.week_start,q])),w=g?.start_date??g?.start_competition_date??t,T=w>t?w:t,S=g?Ke(T,m.date):[],u=g?Ke(w,m.date):[],z=Math.max(u.length-S.length,0),pe=Xe(N,m.date);return e.jsxs("div",{className:"rounded-xl border bg-card shadow-sm overflow-hidden",children:[e.jsxs("div",{className:"border-b border-border bg-muted/20 px-3 py-2.5",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"text-sm font-semibold",children:m.name}),j===0&&e.jsx(U,{className:"text-[10px] bg-primary/10 text-primary border-primary/20",children:"PrioritÃ©"}),e.jsx(U,{variant:"secondary",className:"text-[10px]",children:ye(m.date)}),e.jsxs(U,{variant:"outline",className:"text-[10px]",children:["J-",pe]})]}),g?e.jsxs("div",{className:"mt-1 flex items-center gap-2 flex-wrap text-xs text-muted-foreground",children:[e.jsx("span",{className:"font-medium text-foreground",children:g.name}),g.start_competition_name&&e.jsxs("span",{children:["depuis ",g.start_competition_name]}),e.jsxs("span",{children:[u.length," sem."]}),z>0&&e.jsxs("span",{children:[z," dÃ©jÃ  passÃ©es"]})]}):e.jsx("p",{className:"mt-1 text-xs text-muted-foreground",children:"Aucun macrocycle crÃ©Ã© pour cette Ã©chÃ©ance."})]}),g?S.length===0?e.jsx("div",{className:"px-3 py-3 text-xs text-muted-foreground italic",children:"Aucune semaine future Ã  afficher sur ce macrocycle."}):e.jsx("div",{className:"px-3 py-3",children:e.jsx("div",{className:"relative ml-2 border-l-2 border-border pl-3 space-y-1.5",children:S.map((q,W)=>{const V=p.get(q),I=ct(q),k=lt(q),de=`${g.id}:${q}`,ge=_===de,je=`inline-week-${g.id}-${q}`;return ge?e.jsxs("div",{className:`rounded-lg border bg-card p-2 space-y-1.5 ${I?"ring-2 ring-primary":""}`,children:[e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Sem. ",z+W+1," (",Te(q)," - ",Te(k),")"]}),e.jsx(Z,{className:"h-7 text-sm",placeholder:"Foncier, Techni., AffÃ»tage...",list:je,value:y,onChange:fe=>L(fe.target.value)}),e.jsx("datalist",{id:je,children:D.map(fe=>e.jsx("option",{value:fe},fe))}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx(F,{variant:"ghost",size:"sm",className:"h-6 text-xs px-2",onClick:()=>C(null),children:"Annuler"}),e.jsx(F,{size:"sm",className:"h-6 text-xs px-2",onClick:()=>{B.mutate({cycle_id:g.id,week_start:q,week_type:y.trim()||null,notes:V?.notes??null})},disabled:B.isPending,children:"OK"})]})]},q):e.jsxs("button",{type:"button",className:`w-full text-left rounded-lg border bg-card px-2.5 py-2 text-xs transition-colors hover:bg-muted/50 ${I?"ring-2 ring-primary bg-primary/5":""}`,onClick:()=>{C(de),L(V?.week_type??"")},children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:`h-2 w-2 rounded-full shrink-0 ${I?"bg-primary":V?.week_type?"bg-muted-foreground/40":"bg-muted-foreground/20"}`}),e.jsxs("span",{className:"text-muted-foreground whitespace-nowrap",children:["Sem. ",z+W+1]}),e.jsxs("span",{className:"text-muted-foreground/70 whitespace-nowrap",children:[Te(q)," - ",Te(k)]}),V?.week_type&&e.jsx(U,{className:"text-[10px] px-1.5 py-0 border-0 ml-auto",style:{backgroundColor:ls(V.week_type),color:is(V.week_type)},children:V.week_type})]}),V?.notes&&e.jsx("p",{className:"mt-1 pl-4 text-[11px] text-muted-foreground line-clamp-2",children:V.notes})]},q)})})}):e.jsxs("div",{className:"px-3 py-3 space-y-2",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"CrÃ©ez un macrocycle dÃ©diÃ© pour donner de la visibilitÃ© long terme sur cette cible."}),e.jsx(F,{variant:"outline",size:"sm",className:"w-full text-xs",onClick:()=>K.mutate(m.id),disabled:K.isPending,children:K.isPending?"CrÃ©ation...":"CrÃ©er ce macrocycle"})]})]},m.id)})})]}):e.jsx("div",{className:"text-center py-4",children:e.jsx("p",{className:"text-xs text-muted-foreground italic",children:"Aucune compÃ©tition assignÃ©e Ã  venir â€” planification non disponible."})})},mt=({interview:s,athleteId:t,athleteName:n,athletePhone:r,objectives:l,performances:o})=>{const{toast:a}=ve(),d=be(),[v,f]=c.useState(!1),[x,b]=c.useState(s.coach_comment_successes??""),[_,C]=c.useState(s.coach_comment_difficulties??""),[y,L]=c.useState(s.coach_comment_goals??""),P=s.coach_review??"",D=s.coach_objectives??"",[E,N]=c.useState(s.coach_actions??""),[Q,K]=c.useState(!1),[B,m]=c.useState(!1),[j,g]=c.useState(!1),O=c.useRef(!1),{data:p}=M({queryKey:["previous-interview",t,s.date,s.id],queryFn:()=>h.getPreviousInterview(t,s.date,s.id),enabled:!!s.date}),w=c.useCallback(()=>({coach_comment_successes:x.trim()||null,coach_comment_difficulties:_.trim()||null,coach_comment_goals:y.trim()||null,coach_review:P.trim()||null,coach_objectives:D.trim()||null,coach_actions:E.trim()||null}),[E,_,y,x,D,P]),T=c.useCallback(()=>{const k=w();return(s.coach_comment_successes??null)!==k.coach_comment_successes||(s.coach_comment_difficulties??null)!==k.coach_comment_difficulties||(s.coach_comment_goals??null)!==k.coach_comment_goals||(s.coach_review??null)!==k.coach_review||(s.coach_objectives??null)!==k.coach_objectives||(s.coach_actions??null)!==k.coach_actions},[w,s]),S=R({mutationFn:k=>h.updateInterviewCoachSections(s.id,k),onSuccess:()=>{d.invalidateQueries({queryKey:["interviews",t]})},onError:k=>{a({title:"Erreur",description:k.message,variant:"destructive"})}}),u=R({mutationFn:async()=>(await h.updateInterviewCoachSections(s.id,w()),h.sendInterviewToAthlete(s.id)),onSuccess:()=>{a({title:"Entretien envoyÃ© au nageur"}),d.invalidateQueries({queryKey:["interviews",t]}),g(!0)},onError:k=>{a({title:"Erreur",description:k.message,variant:"destructive"})}}),z=()=>{if(!r)return;const de=`Bonjour ${n.split(" ")[0]}, ton entretien est disponible. Consulte-le ici : https://erstein-aquatic-club.github.io/competition/#/profile`,ge=zs([r],de);Qs()?window.location.href=ge:navigator.clipboard.writeText(`${r}
${de}`).then(()=>{a({title:"CopiÃ©",description:"NumÃ©ro et message copiÃ©s dans le presse-papiers."})}).catch(()=>{a({title:"Erreur",description:"Impossible de copier.",variant:"destructive"})}),g(!1)},pe=R({mutationFn:()=>h.deleteInterview(s.id),onSuccess:()=>{a({title:"Entretien supprimÃ©"}),d.invalidateQueries({queryKey:["interviews",t]})},onError:k=>{a({title:"Erreur",description:k.message,variant:"destructive"})}}),q=S.isPending||u.isPending||pe.isPending,W=s.status,V=W==="draft_athlete"?"border-amber-300 dark:border-amber-700 border-l-4":W==="draft_coach"?"border-blue-300 dark:border-blue-700 border-l-4":W==="sent"?"border-emerald-300 dark:border-emerald-700 border-l-4":"",I=c.useCallback(()=>{W!=="draft_coach"||O.current||q||!T()||(O.current=!0,S.mutate(w()),window.setTimeout(()=>{O.current=!1},500))},[w,T,q,S,W]);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:`rounded-xl border bg-card shadow-sm ${V}`,children:[e.jsxs("button",{type:"button",className:"w-full flex items-center justify-between p-4 text-left",onClick:()=>f(k=>!k),children:[e.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[e.jsx("span",{className:"text-sm font-semibold",children:ye(s.date)}),dt(W),W==="signed"&&s.signed_at&&e.jsxs("span",{className:"text-xs text-muted-foreground",children:["le ",ye(s.signed_at.slice(0,10))]})]}),v?e.jsx(Bs,{className:"h-4 w-4 text-muted-foreground shrink-0"}):e.jsx(Us,{className:"h-4 w-4 text-muted-foreground shrink-0"})]}),v&&e.jsxs("div",{className:"px-4 pb-4 space-y-5",children:[W==="draft_athlete"&&e.jsxs("div",{className:"rounded-xl border border-dashed border-amber-300 bg-amber-50/50 dark:bg-amber-950/20 p-6 text-center space-y-2",children:[e.jsx(Be,{className:"h-8 w-8 mx-auto text-amber-500"}),e.jsx("p",{className:"text-sm font-medium",children:"En attente de la prÃ©paration du nageur"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Le contenu n'est pas encore visible. Le nageur doit d'abord remplir ses sections."})]}),W==="draft_coach"&&e.jsxs(e.Fragment,{children:[p&&e.jsx(es,{prevInterview:p,commitmentReview:s.athlete_commitment_review}),e.jsx(Y,{label:"RÃ©ussites"}),e.jsx(ee,{label:"Nageur",text:s.athlete_successes}),e.jsx(Ee,{label:"Coach",value:x,onChange:b,onBlur:I,placeholder:"Votre commentaire sur les rÃ©ussites..."}),e.jsx(Y,{label:"DifficultÃ©s"}),e.jsx(ee,{label:"Nageur",text:s.athlete_difficulties}),e.jsx(Ee,{label:"Coach",value:_,onChange:C,onBlur:I,placeholder:"Votre commentaire sur les difficultÃ©s..."}),e.jsx(Y,{label:"Objectifs"}),l.length>0&&e.jsx("div",{className:"space-y-1.5",children:l.map(k=>e.jsx(Ze,{objective:k,performances:o},k.id))}),e.jsx(ee,{label:"Nageur",text:s.athlete_goals}),e.jsx(Ee,{label:"Coach",value:y,onChange:L,onBlur:I,placeholder:"Objectifs complÃ©mentaires, commentaires..."}),e.jsx(Y,{label:"Planification"}),e.jsx(ss,{athleteId:t,interviewDate:s.date}),e.jsx(Y,{label:"Engagements & Actions"}),e.jsxs("div",{className:"rounded-xl bg-card border shadow-sm p-4 space-y-3",children:[e.jsx(ee,{label:"Engagements du nageur",text:s.athlete_commitments}),e.jsx(Ee,{label:"Actions du coach",value:E,onChange:N,onBlur:I,placeholder:"Actions concrÃ¨tes, points de suivi..."})]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:S.isPending?"Sauvegarde...":"Sauvegarde automatique a la sortie d'un champ."})]}),(W==="sent"||W==="signed")&&e.jsxs(e.Fragment,{children:[p&&e.jsx(es,{prevInterview:p,commitmentReview:s.athlete_commitment_review}),e.jsx(Y,{label:"RÃ©ussites"}),e.jsx(ee,{label:"Nageur",text:s.athlete_successes}),e.jsx(De,{label:"Coach",text:s.coach_comment_successes||s.coach_review}),e.jsx(Y,{label:"DifficultÃ©s"}),e.jsx(ee,{label:"Nageur",text:s.athlete_difficulties}),e.jsx(De,{label:"Coach",text:s.coach_comment_difficulties}),e.jsx(Y,{label:"Objectifs"}),l.length>0&&e.jsx("div",{className:"space-y-1.5",children:l.map(k=>e.jsx(Ze,{objective:k,performances:o},k.id))}),e.jsx(ee,{label:"Nageur",text:s.athlete_goals}),e.jsx(De,{label:"Coach",text:s.coach_comment_goals||s.coach_objectives}),e.jsx(Y,{label:"Planification"}),e.jsx(ss,{athleteId:t,interviewDate:s.date}),e.jsx(Y,{label:"Engagements & Actions"}),e.jsxs("div",{className:"rounded-xl bg-card border shadow-sm p-4 space-y-3",children:[e.jsx(ee,{label:"Engagements du nageur",text:s.athlete_commitments}),e.jsx(De,{label:"Actions du coach",text:s.coach_actions})]})]}),e.jsxs("div",{className:"space-y-2 pt-2 border-t",children:[W==="draft_coach"&&e.jsxs(F,{className:"w-full",onClick:()=>m(!0),disabled:q,children:[e.jsx(Ge,{className:"mr-1.5 h-3.5 w-3.5"}),"Envoyer au nageur"]}),e.jsxs(F,{variant:"outline",className:"w-full text-destructive hover:text-destructive",onClick:()=>K(!0),disabled:q,children:[e.jsx(Oe,{className:"mr-1.5 h-3.5 w-3.5"}),"Supprimer"]})]})]})]}),e.jsx(se,{open:Q,onOpenChange:K,children:e.jsxs(te,{children:[e.jsxs(ne,{children:[e.jsx(ae,{children:"Supprimer l'entretien"}),e.jsxs(re,{children:["Cette action est irrÃ©versible. L'entretien du ",s.date?ye(s.date):""," sera supprimÃ© dÃ©finitivement."]})]}),e.jsxs(ie,{children:[e.jsx(le,{children:"Annuler"}),e.jsx(ce,{onClick:()=>{pe.mutate(),K(!1)},className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Supprimer"})]})]})}),e.jsx(se,{open:B,onOpenChange:m,children:e.jsxs(te,{children:[e.jsxs(ne,{children:[e.jsx(ae,{children:"Envoyer au nageur"}),e.jsx(re,{children:"L'entretien sera envoyÃ© au nageur pour consultation. Les sections coach seront enregistrÃ©es automatiquement."})]}),e.jsxs(ie,{children:[e.jsx(le,{children:"Annuler"}),e.jsxs(ce,{onClick:()=>{u.mutate(),m(!1)},children:[e.jsx(Ge,{className:"mr-1.5 h-3.5 w-3.5"}),"Envoyer"]})]})]})}),e.jsx(se,{open:j,onOpenChange:g,children:e.jsxs(te,{children:[e.jsxs(ne,{children:[e.jsx(ae,{children:"Entretien envoyÃ©"}),e.jsx(re,{children:r?e.jsxs(e.Fragment,{children:["L'entretien a bien Ã©tÃ© envoyÃ© Ã  ",e.jsx("strong",{children:n}),". Voulez-vous le notifier par SMS ?"]}):e.jsxs(e.Fragment,{children:["L'entretien a bien Ã©tÃ© envoyÃ© Ã  ",e.jsx("strong",{children:n}),". Aucun numÃ©ro de tÃ©lÃ©phone enregistrÃ© pour ce nageur."]})})]}),e.jsxs(ie,{children:[e.jsx(le,{children:"Plus tard"}),e.jsxs(ce,{onClick:z,disabled:!r,children:[e.jsx(Rs,{className:"mr-1.5 h-3.5 w-3.5"}),"Envoyer le SMS"]})]})]})})]})},xt=({athleteId:s,athleteName:t})=>{const{toast:n}=ve(),r=be(),{data:l}=M({queryKey:["auth-uid",s],queryFn:()=>ut(s),enabled:!!s}),{data:o=[]}=M({queryKey:["objectives",l],queryFn:()=>h.getObjectives(l),enabled:!!l}),{data:a}=M({queryKey:["athlete-profile",s],queryFn:()=>h.getProfile({userId:s}),enabled:!!s}),d=a?.ffn_iuf??null,v=a?.phone??null,f=c.useMemo(()=>{const y=new Date;return y.setDate(y.getDate()-360),y.toISOString().slice(0,10)},[]),{data:x=[]}=M({queryKey:["swimmer-performances-recent",d],queryFn:()=>h.getSwimmerPerformances({iuf:d,fromDate:f}),enabled:!!d}),{data:b=[],isLoading:_}=M({queryKey:["interviews",s],queryFn:()=>h.getInterviews(s),enabled:!!s}),C=R({mutationFn:()=>h.createInterview({athlete_id:s}),onSuccess:()=>{n({title:"Entretien crÃ©Ã©"}),r.invalidateQueries({queryKey:["interviews",s]})},onError:y=>{n({title:"Erreur",description:y.message,variant:"destructive"})}});return _?e.jsx("div",{className:"space-y-2",children:[1,2,3].map(y=>e.jsx("div",{className:"rounded-xl border p-3 animate-pulse motion-reduce:animate-none",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-4 w-24 rounded bg-muted"}),e.jsx("div",{className:"ml-auto h-5 w-20 rounded bg-muted"})]})},y))}):b.length===0?e.jsxs("div",{className:"text-center py-12 space-y-3",children:[e.jsx(xs,{className:"h-10 w-10 text-muted-foreground mx-auto"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Aucun entretien pour ",t,"."]}),e.jsxs(F,{variant:"outline",size:"sm",onClick:()=>C.mutate(),disabled:C.isPending,children:[e.jsx(oe,{className:"mr-1.5 h-3.5 w-3.5"}),C.isPending?"CrÃ©ation...":"Nouvel entretien"]})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"text-sm font-semibold",children:"Entretiens"}),e.jsx(U,{variant:"secondary",className:"text-[10px] px-1.5 py-0",children:b.length})]}),e.jsxs(F,{variant:"outline",size:"sm",onClick:()=>C.mutate(),disabled:C.isPending,children:[e.jsx(oe,{className:"mr-1.5 h-3.5 w-3.5"}),C.isPending?"CrÃ©ation...":"Nouvel entretien"]})]}),e.jsx("div",{className:"space-y-2",children:b.map(y=>e.jsx(mt,{interview:y,athleteId:s,athleteName:t,athletePhone:v,objectives:o,performances:x},y.id))})]})},hs=["Lundi","Mardi","Mercredi","Jeudi","Vendredi","Samedi","Dimanche"];function ht({athleteId:s,athleteName:t,groupId:n}){const{userId:r}=as(),{toast:l}=ve(),o=be(),{data:a,isLoading:d}=M({queryKey:["swimmer-slots",s],queryFn:()=>h.getSwimmerSlots(s)}),{data:v}=M({queryKey:["swimmer-slots-exists",s],queryFn:()=>h.hasCustomSlots(s)}),{data:f=[]}=M({queryKey:["training-slots","group",n],queryFn:()=>h.getTrainingSlotsForGroup(n)}),x=v===!0,b=x?a??[]:[],_=()=>{o.invalidateQueries({queryKey:["swimmer-slots",s]}),o.invalidateQueries({queryKey:["swimmer-slots-exists",s]})},C=R({mutationFn:()=>h.initSwimmerSlots(s,n,r),onSuccess:()=>{_(),l({title:"Planning personnalisÃ© crÃ©Ã©"})},onError:p=>l({title:"Erreur",description:p.message,variant:"destructive"})}),y=R({mutationFn:()=>h.resetSwimmerSlots(s,n,r),onSuccess:()=>{_(),l({title:"Planning rÃ©initialisÃ©"})},onError:p=>l({title:"Erreur",description:p.message,variant:"destructive"})}),L=R({mutationFn:p=>h.deleteSwimmerSlot(p),onSuccess:()=>{_(),l({title:"CrÃ©neau supprimÃ©"})}}),P=R({mutationFn:p=>h.createSwimmerSlot(p,r),onSuccess:()=>{_(),l({title:"CrÃ©neau ajoutÃ©"})},onError:p=>l({title:"Erreur",description:p.message,variant:"destructive"})}),D=R({mutationFn:({slotId:p,input:w})=>h.updateSwimmerSlot(p,w),onSuccess:()=>{_(),l({title:"CrÃ©neau modifiÃ©"})},onError:p=>l({title:"Erreur",description:p.message,variant:"destructive"})}),[E,N]=c.useState(null),[Q,K]=c.useState(!1),[B,m]=c.useState(!1),[j,g]=c.useState(null),O=c.useMemo(()=>{const p=x?b:f,w=new Map;for(const T of p){const S=w.get(T.day_of_week)??[];S.push(T),w.set(T.day_of_week,S)}return w},[x,b,f]);return d?e.jsx("div",{className:"space-y-3",children:Array.from({length:5}).map((p,w)=>e.jsx(_s,{className:"h-14 rounded-lg"},w))}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between gap-2",children:x?e.jsxs(e.Fragment,{children:[e.jsxs(F,{size:"sm",variant:"outline",onClick:()=>K(!0),children:[e.jsx(oe,{className:"h-3.5 w-3.5 mr-1"}),"Ajouter"]}),e.jsxs(F,{size:"sm",variant:"ghost",onClick:()=>m(!0),children:[e.jsx(Cs,{className:"h-3.5 w-3.5 mr-1"}),"RÃ©initialiser"]})]}):e.jsxs(F,{size:"sm",onClick:()=>C.mutate(),disabled:C.isPending,children:[e.jsx(oe,{className:"h-3.5 w-3.5 mr-1"}),"Personnaliser le planning"]})}),!x&&f.length>0&&e.jsx("div",{className:"rounded-lg border border-blue-200 bg-blue-50 dark:border-blue-800 dark:bg-blue-950/30 px-3 py-2 text-sm text-blue-700 dark:text-blue-300",children:"HÃ©rite du planning du groupe. Cliquez sur Â« Personnaliser Â» pour ajuster."}),[1,2,3,4,5,6,7].map(p=>{const w=O.get(p);return!w||w.length===0?null:e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("h3",{className:"text-xs font-semibold text-muted-foreground uppercase tracking-wider",children:hs[p-1]}),w.map(T=>e.jsxs("button",{type:"button",className:"w-full flex items-center gap-3 rounded-lg border border-border bg-card px-3 py-2 text-left hover:bg-muted/50 transition",onClick:()=>x?N(T):void 0,children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-sm font-mono tabular-nums",children:[e.jsx(Be,{className:"h-3.5 w-3.5 text-muted-foreground"}),T.start_time.slice(0,5)," â€“ ",T.end_time.slice(0,5)]}),e.jsxs("div",{className:"flex items-center gap-1.5 text-sm text-muted-foreground truncate",children:[e.jsx(Is,{className:"h-3.5 w-3.5"}),T.location]}),x&&T.source_assignment_id&&e.jsx(Ys,{className:"h-3.5 w-3.5 text-blue-500 ml-auto flex-shrink-0"})]},T.id))]},p)}),O.size===0&&e.jsx("p",{className:"text-center text-sm text-muted-foreground py-8",children:"Aucun crÃ©neau configurÃ©."}),e.jsx(se,{open:B,onOpenChange:m,children:e.jsxs(te,{children:[e.jsxs(ne,{children:[e.jsx(ae,{children:"RÃ©initialiser le planning ?"}),e.jsx(re,{children:"Tous les crÃ©neaux personnalisÃ©s seront supprimÃ©s et remplacÃ©s par ceux du groupe."})]}),e.jsxs(ie,{children:[e.jsx(le,{children:"Annuler"}),e.jsx(ce,{onClick:()=>{y.mutate(),m(!1)},children:"RÃ©initialiser"})]})]})}),e.jsx(se,{open:!!j,onOpenChange:()=>g(null),children:e.jsxs(te,{children:[e.jsxs(ne,{children:[e.jsx(ae,{children:"Supprimer ce crÃ©neau ?"}),e.jsx(re,{children:"Le crÃ©neau sera retirÃ© du planning personnel."})]}),e.jsxs(ie,{children:[e.jsx(le,{children:"Annuler"}),e.jsx(ce,{onClick:()=>{j&&L.mutate(j),g(null)},className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Supprimer"})]})]})}),e.jsx(qe,{open:!!E,onOpenChange:p=>!p&&N(null),children:e.jsxs(Fe,{side:"bottom",className:"max-h-[80vh]",children:[e.jsxs(Ae,{children:[e.jsx(Me,{children:"Modifier le crÃ©neau"}),e.jsx(He,{children:"Ajustez les horaires ou le lieu"})]}),E&&e.jsx(pt,{slot:E,onSave:p=>{D.mutate({slotId:E.id,input:p}),N(null)},onDelete:()=>{g(E.id),N(null)},isPending:D.isPending})]})}),e.jsx(qe,{open:Q,onOpenChange:K,children:e.jsxs(Fe,{side:"bottom",className:"max-h-[80vh]",children:[e.jsxs(Ae,{children:[e.jsx(Me,{children:"Ajouter un crÃ©neau"}),e.jsx(He,{children:"Nouveau crÃ©neau personnalisÃ©"})]}),e.jsx(gt,{onSave:p=>{P.mutate({...p,user_id:s}),K(!1)},isPending:P.isPending})]})})]})}function pt({slot:s,onSave:t,onDelete:n,isPending:r}){const[l,o]=c.useState(s.start_time.slice(0,5)),[a,d]=c.useState(s.end_time.slice(0,5)),[v,f]=c.useState(s.location);return e.jsxs("div",{className:"space-y-4 pt-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx($,{children:"DÃ©but"}),e.jsx(Z,{type:"time",value:l,onChange:x=>o(x.target.value)})]}),e.jsxs("div",{children:[e.jsx($,{children:"Fin"}),e.jsx(Z,{type:"time",value:a,onChange:x=>d(x.target.value)})]})]}),e.jsxs("div",{children:[e.jsx($,{children:"Lieu"}),e.jsx(Z,{value:v,onChange:x=>f(x.target.value)})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(F,{className:"flex-1",onClick:()=>t({start_time:l,end_time:a,location:v}),disabled:r,children:"Enregistrer"}),e.jsx(F,{variant:"destructive",size:"icon",onClick:n,children:e.jsx(Oe,{className:"h-4 w-4"})})]})]})}function gt({onSave:s,isPending:t}){const[n,r]=c.useState("1"),[l,o]=c.useState("08:00"),[a,d]=c.useState("10:00"),[v,f]=c.useState("");return e.jsxs("div",{className:"space-y-4 pt-4",children:[e.jsxs("div",{children:[e.jsx($,{children:"Jour"}),e.jsxs(ue,{value:n,onValueChange:r,children:[e.jsx(me,{children:e.jsx(xe,{})}),e.jsx(he,{children:hs.map((x,b)=>e.jsx(X,{value:String(b+1),children:x},b+1))})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx($,{children:"DÃ©but"}),e.jsx(Z,{type:"time",value:l,onChange:x=>o(x.target.value)})]}),e.jsxs("div",{children:[e.jsx($,{children:"Fin"}),e.jsx(Z,{type:"time",value:a,onChange:x=>d(x.target.value)})]})]}),e.jsxs("div",{children:[e.jsx($,{children:"Lieu"}),e.jsx(Z,{value:v,onChange:x=>f(x.target.value),placeholder:"Piscine, Salle..."})]}),e.jsx(F,{className:"w-full",onClick:()=>s({day_of_week:Number(n),start_time:l,end_time:a,location:v}),disabled:t||!v,children:"Ajouter"})]})}function Zt(){const[,s]=ws("/coach/swimmer/:id"),[,t]=Ss(),{selectedAthleteId:n,selectedAthleteName:r}=as(),l=s?.id?Number(s.id):n,o=r,{data:a}=M({queryKey:["profile",l],queryFn:()=>h.getProfile({userId:l}),enabled:l!=null}),d=a?.display_name??o??"Nageur",v=a?.avatar_url??null,f=a?.group_label??null;return l?e.jsxs("div",{className:"mx-auto max-w-3xl px-4 py-4 space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{type:"button",onClick:()=>t("/coach?section=swimmers"),className:"h-9 w-9 rounded-xl border border-border bg-card flex items-center justify-center hover:bg-muted transition","aria-label":"Retour",children:e.jsx(Ms,{className:"h-4 w-4"})}),v?e.jsx("img",{src:v,alt:"",className:"h-10 w-10 rounded-full object-cover border border-border"}):e.jsx("div",{className:"h-10 w-10 rounded-full bg-primary/10 flex items-center justify-center text-sm font-bold text-primary",children:d.charAt(0).toUpperCase()}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h1",{className:"text-lg font-bold truncate",children:d}),f&&e.jsx(U,{variant:"secondary",className:"text-[10px] px-1.5 py-0",children:f})]})]}),e.jsxs(ks,{defaultValue:"ressentis",children:[e.jsxs(Ts,{className:"w-full grid grid-cols-5",children:[e.jsxs(_e,{value:"ressentis",className:"text-xs gap-1",children:[e.jsx(Be,{className:"h-3.5 w-3.5"}),e.jsx("span",{className:"hidden sm:inline",children:"Ressentis"})]}),e.jsxs(_e,{value:"objectifs",className:"text-xs gap-1",children:[e.jsx(Pe,{className:"h-3.5 w-3.5"}),e.jsx("span",{className:"hidden sm:inline",children:"Objectifs"})]}),e.jsxs(_e,{value:"planification",className:"text-xs gap-1",children:[e.jsx(rs,{className:"h-3.5 w-3.5"}),e.jsx("span",{className:"hidden sm:inline",children:"Planif."})]}),e.jsxs(_e,{value:"entretiens",className:"text-xs gap-1",children:[e.jsx(xs,{className:"h-3.5 w-3.5"}),e.jsx("span",{className:"hidden sm:inline",children:"Entretiens"})]}),e.jsxs(_e,{value:"creneaux",className:"text-xs gap-1",children:[e.jsx(Hs,{className:"h-3.5 w-3.5"}),e.jsx("span",{className:"hidden sm:inline",children:"CrÃ©neaux"})]})]}),e.jsx(Ce,{value:"ressentis",className:"mt-4",children:e.jsx(Ds,{athleteId:l,athleteName:d})}),e.jsx(Ce,{value:"objectifs",className:"mt-4",children:e.jsx(tt,{athleteId:l,athleteName:d})}),e.jsx(Ce,{value:"planification",className:"mt-4",children:e.jsx(rt,{athleteId:l})}),e.jsx(Ce,{value:"entretiens",className:"mt-4",children:e.jsx(xt,{athleteId:l,athleteName:d})}),e.jsx(Ce,{value:"creneaux",className:"mt-4",children:e.jsx(ht,{athleteId:l,athleteName:d,groupId:a?.group_id??0})})]})]}):e.jsxs("div",{className:"p-4 text-center text-muted-foreground",children:[e.jsx("p",{children:"Aucun nageur sÃ©lectionnÃ©."}),e.jsx("button",{type:"button",onClick:()=>t("/coach?section=swimmers"),className:"mt-2 text-primary underline",children:"Retour au dashboard"})]})}export{Zt as default};
