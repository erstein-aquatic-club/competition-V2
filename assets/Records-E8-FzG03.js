import{r as x,j as e,c as cs,u as A,d as z}from"./vendor-query-BiSH4r2z.js";import{Q as ms,V as us,Y as xs,a as ps,u as hs,d as fs,W as B,B as N,T as re,D as gs,m as _,E as we,Z as js,C as W,g as H,L as E,I,X as Y}from"./index-5sN5s7qj.js";import{a as y}from"./api-DtltJWQs.js";import{T as vs}from"./objectiveHelpers-R2ccLFQL.js";import{T as Ns,a as bs,b as Se,c as _e}from"./tabs-Dfj1Ctfy.js";import{S as ys,a as ws,b as Ss,c as _s,d as Ce}from"./select-BtbJaBbJ.js";import{shouldShowRecords as Cs}from"./Profile-DVpcyTDm.js";import{I as ke}from"./InlineBanner-rBJbcNyq.js";import{c as ks,f as Ee,s as ie,l as ae}from"./animations-CrcLFysI.js";import{C as oe}from"./circle-alert-Dcep_298.js";import{C as Es}from"./clock-BYPld0Oh.js";import{C as X}from"./index-oPRx-KM6.js";import{P as Fe}from"./pen-oLmido6K.js";import{C as Ie}from"./chevron-down-DBo-6sBV.js";import{r as Fs,X as Te,Y as Le,s as Is,R as Rs,T as Ms}from"./generateCategoricalChart-DTId2WKm.js";import{L as Pe}from"./Line-DFup-JqZ.js";import{C as Ts}from"./CartesianGrid-Bzl92cy8.js";import{S as Ls}from"./sticky-note-D5ExE_sV.js";import"./vendor-react-BzrpNAyj.js";import"./vendor-supabase-DFPLkPj_.js";import"./swim-CnnTQ68L.js";import"./index-DYIvXBZd.js";import"./index-CTPVgSlQ.js";import"./index-DtDPrpVF.js";import"./chevron-up-B6yzAc_5.js";import"./avatar-D9dYwy58.js";import"./badge-C_hdSkQB.js";import"./alert-dialog-kh6AhXn4.js";import"./index-BihCIVho.js";import"./dialog-37SENO_1.js";import"./types-Ca14D1uM.js";import"./toggle-group-B7GZHhRw.js";import"./plus-pm2xBUMe.js";import"./trash-2-Bel4vWd8.js";import"./weekTypeColor-4oPZQ3O7.js";import"./collapsible-DqGqVn-G.js";import"./circle-check-BkNoZl1G.js";import"./chevron-right-Cd4JjGqf.js";import"./flame-DdOOVmQM.js";import"./save-BV8h9KAU.js";import"./design-tokens-CKgCpdH6.js";function Ps(){!ms.current&&us();const[r]=x.useState(xs.current);return r}var As=Fs({chartName:"LineChart",GraphicalChild:Pe,axisComponents:[{axisType:"xAxis",AxisComp:Te},{axisType:"yAxis",AxisComp:Le}],formatAxisMap:Is});const zs=r=>r.toLowerCase().replace(/\./g,"").replace(/\s+/g," ").trim();function Re(r){const t=zs(r);return t.includes("nl")||t.includes("nage libre")?0:t.includes("dos")?1:t.includes("bra")||t.includes("brasse")?2:t.includes("pap")||t.includes("papillon")?3:t.includes("4n")||t.includes("4 n")||t.includes("4 nages")?4:99}function Me(r){const t=r.match(/^(\d+)/);return t?Number(t[1]):Number.POSITIVE_INFINITY}function $s(r,t){const h=Re(r),u=Re(t);return h!==u?h-u:Me(r)-Me(t)}function qs({children:r,className:t}){return e.jsx("div",{className:ps("sticky top-0 z-overlay -mx-4 backdrop-blur-md bg-background/90 border-b border-primary/15",t),children:e.jsx("div",{className:"px-4 py-2.5 flex items-center justify-between",children:r})})}const F=(...r)=>r.filter(Boolean).join(" ");function U(r){if(!r)return"—";const t=new Date(r);return Number.isNaN(t.getTime())?r:t.toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"2-digit"})}function $(r){if(r==null)return"—";const t=Math.round(Math.max(0,r*1e3)),h=Math.floor(t/6e4),u=Math.floor(t%6e4/1e3),j=Math.floor(t%1e3/10);return h>0?`${h}:${String(u).padStart(2,"0")}.${String(j).padStart(2,"0")}`:`${u}.${String(j).padStart(2,"0")}`}function Ds(r){const t=r.trim();if(!t)return null;if(t.includes(":")){const[u,j]=t.split(":"),f=Number(u);if(!Number.isFinite(f)||f<0)return null;const w=j.replace(",","."),S=Number(w);return!Number.isFinite(S)||S<0?null:f*60+S}const h=Number(t.replace(",","."));return!Number.isFinite(h)||h<0?null:h}function Ks(r){if(!r)return null;const t=r.match(/FFN\s*\((\d+)\s*pts\)/i);if(!t)return null;const h=Number(t[1]);return Number.isFinite(h)?h:null}function Qs({value:r,placeholder:t,onSave:h,onCancel:u,inputMode:j="decimal",hint:f}){const[w,S]=x.useState(r);return x.useEffect(()=>{S(r)},[r]),e.jsx("div",{className:"w-full",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(I,{value:w,onChange:G=>S(G.target.value),placeholder:t,inputMode:j,className:"h-10 rounded-xl",autoFocus:!0}),f?e.jsx("div",{className:"mt-1 text-xs text-muted-foreground",children:f}):null]}),e.jsx(N,{type:"button",onClick:()=>h(w),className:"h-10 w-10 p-0 rounded-xl","aria-label":"Valider",children:e.jsx(X,{className:"h-5 w-5"})}),e.jsx(N,{type:"button",variant:"outline",onClick:u,className:"h-10 w-10 p-0 rounded-xl","aria-label":"Annuler",children:e.jsx(Y,{className:"h-5 w-5"})})]})})}const C=()=>e.jsx("div",{className:"h-10 rounded-xl bg-muted animate-pulse motion-reduce:animate-none"});function Rt(){const{user:r,userId:t,role:h}=hs(),{toast:u}=fs(),j=cs(),f=Ps(),w={id:null,event_name:"",pool_length:"",time_seconds:"",record_date:"",notes:""},[S,G]=x.useState(()=>{const s=window.location.hash,n=s.indexOf("?");return n>=0&&new URLSearchParams(s.substring(n)).get("tab")==="1rm"?"1rm":"swim"}),[d,v]=x.useState(w),[c,Ae]=x.useState("training"),[L,ze]=x.useState(25),[le,q]=x.useState(null),[$e,de]=x.useState(null),[qe,ce]=x.useState(""),[De,Ke]=x.useState(null),[Qe,P]=x.useState(null),[me,R]=x.useState(""),[D,Oe]=x.useState(25),[K,Ve]=x.useState(null),[Be,ue]=x.useState(!1),M=Cs(h);x.useEffect(()=>{window.scrollTo({top:0,left:0,behavior:"auto"})},[]);const xe=s=>{const n=s?.pool_length??s?.poolLength??s?.poolLen??s?.pool;if(n==null)return null;if(typeof n=="number")return n===25||n===50?n:null;const o=String(n).match(/\b(25|50)\b/);if(!o)return null;const a=Number(o[1]);return a===25||a===50?a:null},Z=A({queryKey:["1rm",r,t],queryFn:()=>y.get1RM({athleteName:r,athleteId:t}),enabled:!!r&&M}),J=A({queryKey:["exercises"],queryFn:()=>y.getExercises(),enabled:M}),ee=A({queryKey:["swim-records",t,r],queryFn:()=>y.getSwimRecords({athleteId:t??void 0,athleteName:r??void 0}),enabled:!!r&&M}),T=A({queryKey:["profile",t],queryFn:()=>y.getProfile({userId:t??void 0}),enabled:!!t&&M}),k=String(T.data?.ffn_iuf??"").trim(),pe=Z.error||J.error||ee.error||T.error,We=()=>{Z.refetch(),J.refetch(),ee.refetch(),T.refetch()},se=A({queryKey:["swimmer-performances",t,k,D],queryFn:()=>y.getSwimmerPerformances({userId:t??void 0,iuf:k||void 0,poolLength:D}),enabled:!!k&&M&&c==="history"}),{data:te,isLoading:He,isError:Ue}=se,Q=z({mutationFn:()=>{if(!k)throw new Error("IUF FFN manquant. Ajoutez-le dans votre profil.");return y.importSwimmerPerformances({iuf:k,userId:t??void 0})},onSuccess:s=>{j.invalidateQueries({queryKey:["swimmer-performances"]}),u({title:"Import terminé",description:`${s.total_found} trouvée(s), ${s.new_imported} importée(s), ${s.already_existed} déjà existante(s)`}),ue(!0),setTimeout(()=>ue(!1),2e3)},onError:s=>{u({title:"Import impossible",description:String(s?.message||s),variant:"destructive"})}}),O=x.useMemo(()=>{if(!te?.length)return[];const s=new Map;for(const a of te){const i=s.get(a.event_code)??[];i.push(a),s.set(a.event_code,i)}const n=a=>a.toLowerCase().replace(/\./g,"").replace(/\s+/g," ").trim(),l=a=>{const i=n(a);return i.includes("nl")||i.includes("nage libre")?0:i.includes("dos")?1:i.includes("bra")||i.includes("brasse")?2:i.includes("pap")||i.includes("papillon")?3:i.includes("4n")||i.includes("4 n")||i.includes("4 nages")?4:99},o=a=>{const i=a.match(/^(\d+)/);return i?Number(i[1]):1/0};return[...s.entries()].map(([a,i])=>{const p=[...i].sort((b,m)=>(m.competition_date??"").localeCompare(b.competition_date??"")),g=p.reduce((b,m)=>m.time_seconds<b.time_seconds?m:b,p[0]);return{eventCode:a,performances:p,bestTime:g.time_seconds,bestId:g.id}}).sort((a,i)=>{const p=l(a.eventCode),g=l(i.eventCode);return p!==g?p-g:o(a.eventCode)-o(i.eventCode)})},[te]),he=x.useMemo(()=>{if(!K)return[];const s=O.find(n=>n.eventCode===K);return s?[...s.performances].filter(n=>n.competition_date).sort((n,l)=>(n.competition_date??"").localeCompare(l.competition_date??"")).map(n=>({date:U(n.competition_date),time:n.time_seconds,display:n.time_display??$(n.time_seconds)})):[]},[K,O]),{data:Ye,isLoading:Xe,isError:Ge}=Z,{data:Ze,isLoading:Je,isError:es}=J,{data:fe,isLoading:ss,isFetching:Os,isError:ts,refetch:ns}=ee,rs=()=>{ns()};x.useEffect(()=>{c==="comp"&&rs()},[c]);const ge=z({mutationFn:s=>y.update1RM({...s,athlete_id:t,athlete_name:r}),onSuccess:()=>{j.invalidateQueries({queryKey:["1rm"]}),u({title:"1RM mis à jour"})}}),je=z({mutationFn:s=>y.updateExerciseNote({athlete_id:t,exercise_id:s.exercise_id,notes:s.notes}),onSuccess:()=>{j.invalidateQueries({queryKey:["1rm"]}),u({title:"Note mise à jour"})}}),ne=z({mutationFn:s=>y.upsertSwimRecord(s),onSuccess:()=>{j.invalidateQueries({queryKey:["swim-records"]}),v(w),q(null),u({title:"Record mis à jour"})}});z({mutationFn:s=>y.syncFfnSwimRecords({athleteId:t??void 0,athleteName:r??void 0,iuf:s}),onSuccess:s=>{j.invalidateQueries({queryKey:["swim-records"]}),u({title:"Synchro FFN terminée",description:`${s?.inserted??0} ajouté(s), ${s?.updated??0} mis à jour, ${s?.skipped??0} inchangé(s)`})},onError:s=>{u({title:"Synchro FFN impossible",description:String(s?.message||s),variant:"destructive"})}});const V=()=>{v(w),q(null)},is=s=>{const n=xe(s);v({id:s.id,event_name:s.event_name??"",pool_length:n?String(n):"",time_seconds:s.time_seconds!=null?$(Number(s.time_seconds)):"",record_date:s.record_date?String(s.record_date).split("T")[0]:"",notes:s.notes??""}),q(s.id)},ve=()=>{if(!d.event_name.trim()){u({title:"Nom d'épreuve requis",variant:"destructive"});return}if(!d.pool_length){u({title:"Bassin requis",variant:"destructive"});return}const s=Ds(d.time_seconds);if(s===null){u({title:"Temps invalide",description:"Ex: 1:02.34 ou 62.34",variant:"destructive"});return}ne.mutate({id:d.id||null,athlete_id:t,athleteName:r,athlete_name:r,event_name:d.event_name,pool_length:parseInt(d.pool_length,10),time_seconds:s,record_date:d.record_date||null,notes:d.notes||null,record_type:c})},as=s=>{s.preventDefault(),ve()},Ne=x.useMemo(()=>(fe?.records??[]).filter(l=>{const o=xe(l);if(!o||o!==L)return!1;const a=String(l.record_type??"training");return c==="comp"?a==="comp":a==="training"}).sort((l,o)=>$s(String(l.event_name??""),String(o.event_name??""))),[fe,L,c]),be=()=>{v({...w,pool_length:String(L)}),q("add")},os=s=>{Ae(s),V()},ls=(s,n)=>{de(s),ce(n!=null&&Number(n)>0?String(n):"")},ye=()=>{de(null),ce("")},ds=(s,n)=>{const l=Number(String(n??"").replace(",","."));if(!Number.isFinite(l)||l<=0){u({title:"Valeur invalide",description:"Entrez un nombre > 0",variant:"destructive"});return}ge.mutate({exercise_id:s,one_rm:l}),ye()};return M?pe?e.jsx("div",{className:"min-h-[100dvh]",children:e.jsxs("div",{className:"mx-auto max-w-lg px-4 pt-16 pb-10 text-center",children:[e.jsx(oe,{className:"h-10 w-10 mx-auto text-destructive/60"}),e.jsx("p",{className:"mt-3 text-sm font-semibold",children:"Impossible de charger les données"}),e.jsx("p",{className:"mt-1 text-xs text-muted-foreground",children:pe.message}),e.jsx(N,{onClick:We,size:"sm",className:"mt-4 rounded-2xl",children:"Réessayer"})]})}):e.jsx("div",{className:"min-h-[100dvh]",children:e.jsxs("div",{className:"mx-auto max-w-lg",children:[e.jsx(qs,{className:"-mx-0",children:e.jsxs("div",{className:"flex items-center gap-2.5",children:[e.jsx("div",{className:"flex items-center justify-center h-7 w-7 rounded-lg bg-primary text-primary-foreground",children:e.jsx(re,{className:"h-3.5 w-3.5"})}),e.jsx("h1",{className:"text-lg font-display font-bold uppercase italic tracking-tight text-primary",children:"Mes Records"})]})}),e.jsx("div",{className:"px-3 pt-3",children:e.jsxs(Ns,{value:S,onValueChange:s=>G(s),children:[e.jsxs(bs,{className:"w-full rounded-2xl bg-muted/50 border border-border p-1 flex",children:[e.jsxs(Se,{value:"swim","aria-label":"Records de natation",className:`flex-1 rounded-xl px-3 py-2 text-sm font-bold uppercase tracking-wide gap-1.5
                  data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm
                  data-[state=inactive]:text-muted-foreground`,children:[e.jsx(B,{className:"h-4 w-4"}),"Natation"]}),e.jsxs(Se,{value:"1rm","aria-label":"Records de musculation",className:`flex-1 rounded-xl px-3 py-2 text-sm font-bold uppercase tracking-wide gap-1.5
                  data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm
                  data-[state=inactive]:text-muted-foreground`,children:[e.jsx(gs,{className:"h-4 w-4"}),"Musculation"]})]}),S==="swim"?e.jsxs("div",{className:"mt-2.5 space-y-2",children:[e.jsx("div",{className:"flex rounded-xl bg-muted/20 border border-border/50 p-0.5",children:["training","comp","history"].map(s=>{const n=s==="training"?"Entraîn.":s==="comp"?"Compétition":"Historique",l=s==="training"?re:s==="comp"?B:Es;return e.jsxs("button",{type:"button",onClick:()=>os(s),className:F("flex-1 rounded-lg px-2 py-1.5 text-xs max-[360px]:text-[10px] font-bold transition inline-flex items-center justify-center gap-1 whitespace-nowrap",c===s?"bg-background text-foreground shadow-sm":"text-muted-foreground hover:text-foreground"),"aria-pressed":c===s,children:[e.jsx(l,{className:"h-3.5 w-3.5 max-[360px]:hidden"}),n]},s)})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"inline-flex rounded-xl border border-border bg-muted/30 p-0.5",children:[25,50].map(s=>e.jsxs("button",{type:"button",onClick:()=>{c==="history"?Oe(s):(ze(s),V())},className:F("px-3 py-1 text-xs font-bold rounded-lg tabular-nums transition",(c==="history"?D:L)===s?"bg-background text-foreground shadow-sm":"text-muted-foreground hover:text-foreground"),children:[s,"m"]},s))}),e.jsxs("div",{className:"flex items-center gap-2",children:[c==="training"&&e.jsx(N,{type:"button",size:"sm",onClick:be,className:"rounded-xl text-xs h-8 gap-1",children:"Ajouter"}),c==="comp"&&e.jsx("span",{className:"text-[10px] text-muted-foreground uppercase tracking-widest font-semibold",children:"Données FFN"}),c==="history"&&e.jsx(_.div,{variants:ks,animate:Be?"visible":"hidden",children:e.jsxs(N,{type:"button",size:"sm",onClick:()=>Q.mutate(),disabled:Q.isPending||!k,className:"rounded-xl text-xs h-8 gap-1",children:[Q.isPending?e.jsx(we,{className:"h-3 w-3 animate-spin"}):e.jsx(js,{className:"h-3 w-3"}),Q.isPending?"Import...":"Importer FFN"]})})]})]})]}):null,e.jsxs(_e,{value:"swim",className:"mt-0",children:[c!=="history"?e.jsx(e.Fragment,{children:e.jsxs("div",{className:"mt-3",children:[c==="training"&&le==="add"?e.jsx(_.div,{variants:Ee,initial:"hidden",animate:"visible",className:"mb-3",children:e.jsx("form",{onSubmit:as,children:e.jsx(W,{className:"rounded-2xl",children:e.jsxs(H,{className:"p-3 space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"col-span-2",children:[e.jsx(E,{className:"text-xs mb-1.5 block",children:"Épreuve"}),e.jsx(I,{value:d.event_name,onChange:s=>v({...d,event_name:s.target.value}),placeholder:"Ex: 100 NL, 200 Dos",className:"h-9 rounded-lg"})]}),e.jsxs("div",{children:[e.jsx(E,{className:"text-xs mb-1.5 block",children:"Bassin"}),e.jsxs(ys,{value:d.pool_length,onValueChange:s=>v({...d,pool_length:s}),children:[e.jsx(ws,{className:"h-9 rounded-lg",children:e.jsx(Ss,{placeholder:"—"})}),e.jsxs(_s,{children:[e.jsx(Ce,{value:"25",children:"25m"}),e.jsx(Ce,{value:"50",children:"50m"})]})]})]}),e.jsxs("div",{children:[e.jsx(E,{className:"text-xs mb-1.5 block",children:"Temps"}),e.jsx(I,{value:d.time_seconds,inputMode:"decimal",placeholder:"1:02.34",onChange:s=>v({...d,time_seconds:s.target.value}),className:"h-9 rounded-lg"})]}),e.jsxs("div",{children:[e.jsx(E,{className:"text-xs mb-1.5 block",children:"Date"}),e.jsx(I,{type:"date",value:d.record_date,onChange:s=>v({...d,record_date:s.target.value}),className:"h-9 rounded-lg"})]}),e.jsxs("div",{children:[e.jsx(E,{className:"text-xs mb-1.5 block",children:"Notes"}),e.jsx(I,{value:d.notes,onChange:s=>v({...d,notes:s.target.value}),placeholder:"Optionnel",className:"h-9 rounded-lg"})]})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsxs(N,{type:"button",size:"sm",variant:"outline",onClick:V,className:"rounded-xl h-8 text-xs gap-1",children:[e.jsx(Y,{className:"h-3 w-3"}),"Annuler"]}),e.jsxs(N,{type:"submit",size:"sm",disabled:ne.isPending,className:"rounded-xl h-8 text-xs gap-1",children:[e.jsx(X,{className:"h-3 w-3"}),"Ajouter"]})]})]})})})}):null,e.jsx(W,{className:"w-full min-w-0 rounded-2xl",children:e.jsx(H,{className:"p-0",children:ss?e.jsxs("div",{className:"p-4 grid gap-3",children:[e.jsx(C,{}),e.jsx(C,{}),e.jsx(C,{})]}):ts?e.jsx("div",{className:"mx-4 my-4 rounded-lg border border-destructive/20 bg-destructive/10 p-4 text-sm text-destructive",children:"Impossible de charger les records natation."}):Ne.length===0?e.jsxs("div",{className:"py-8 text-center",children:[e.jsx(B,{className:"h-8 w-8 mx-auto text-muted-foreground/30"}),e.jsxs("p",{className:"mt-2 text-sm text-muted-foreground",children:["Aucun record en ",L,"m"]}),c==="training"&&e.jsx(N,{type:"button",size:"sm",variant:"outline",onClick:be,className:"mt-3 rounded-xl text-xs h-8",children:"Ajouter un record"})]}):e.jsx(_.div,{className:"divide-y divide-border motion-reduce:animate-none",variants:f?void 0:ie,initial:f?!1:"hidden",animate:f?!1:"visible",children:Ne.map(s=>{const n=le===s.id,l=$(s.time_seconds),o=U(s.record_date),a=(s.notes??"").trim(),i=s?.ffn_points??s?.ffnPoints??s?.points??s?.pts??null,p=i==null?NaN:Number(i),g=Number.isFinite(p)?p:Ks(s?.notes),b=(s?.meet??s?.meet_name??s?.meetName??s?.competition??"").trim?.()??"";return e.jsxs(_.div,{className:"px-3 py-2.5 motion-reduce:animate-none",variants:ae,children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("span",{className:"text-sm font-semibold truncate",children:s.event_name}),e.jsxs("div",{className:"flex items-center gap-2 shrink-0",children:[e.jsx("span",{className:"font-mono text-primary font-bold tabular-nums text-sm",children:l}),c==="training"&&e.jsx("button",{type:"button",onClick:()=>is(s),className:"inline-flex items-center justify-center h-8 w-8 rounded-xl text-muted-foreground hover:text-foreground hover:bg-muted/60 transition","aria-label":`Modifier ${s.event_name}`,children:e.jsx(Fe,{className:"h-3.5 w-3.5"})})]})]}),e.jsxs("div",{className:"flex items-center gap-3 mt-0.5 text-xs text-muted-foreground",children:[c==="comp"&&g!=null&&e.jsxs("span",{className:"tabular-nums",children:[String(g)," pts"]}),e.jsx("span",{className:"tabular-nums",children:o}),c==="comp"&&b&&e.jsx("span",{className:"truncate",children:b}),c==="training"&&a&&e.jsx("span",{className:"truncate italic",children:a})]}),c==="training"&&n?e.jsx(_.div,{className:"mt-3",variants:Ee,initial:"hidden",animate:"visible",children:e.jsxs("div",{className:"rounded-2xl bg-muted/30 border border-border p-4 space-y-4",children:[e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(E,{children:"Temps"}),e.jsx(I,{value:d.time_seconds,inputMode:"decimal",placeholder:"1:02.34",onChange:m=>v({...d,time_seconds:m.target.value}),className:"rounded-xl"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Format: mm:ss.cc ou secondes"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(E,{children:"Date"}),e.jsx(I,{type:"date",value:d.record_date,onChange:m=>v({...d,record_date:m.target.value}),className:"rounded-xl"})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(E,{children:"Notes"}),e.jsx(vs,{value:d.notes,onChange:m=>v({...d,notes:m.target.value}),rows:2,className:"rounded-xl"})]}),e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsxs(N,{type:"button",size:"sm",variant:"outline",onClick:V,className:"rounded-2xl gap-2",children:[e.jsx(Y,{className:"h-4 w-4"}),"Annuler"]}),e.jsxs(N,{type:"button",size:"sm",onClick:ve,disabled:ne.isPending,className:"rounded-2xl gap-2",children:[e.jsx(X,{className:"h-4 w-4"}),"Enregistrer"]})]})]})}):null]},s.id)})})})})]})}):null,c==="history"?e.jsxs("div",{className:"mt-3 space-y-3",children:[e.jsx(ke,{variant:"destructive",icon:e.jsx(oe,{}),label:"Impossible de charger votre profil",visible:T.isError,animate:!1}),e.jsx(ke,{variant:"yellow",icon:e.jsx(oe,{}),label:"IUF FFN non renseigné",sublabel:e.jsxs(e.Fragment,{children:["Renseignez votre numéro dans ",e.jsx("a",{href:"/#/profile",className:"underline font-medium hover:text-foreground",children:"votre profil"})]}),visible:!T.isError&&!k&&!T.isLoading,animate:!1}),He?e.jsxs("div",{className:"grid gap-3",children:[e.jsx(C,{}),e.jsx(C,{}),e.jsx(C,{})]}):Ue?e.jsxs("div",{className:"rounded-lg border border-destructive/20 bg-destructive/10 p-4 text-sm text-destructive",children:[e.jsx("p",{className:"font-semibold",children:"Impossible de charger les performances"}),e.jsx("p",{className:"mt-1 text-xs",children:se.error instanceof Error?se.error.message:"Vérifiez votre connexion internet et réessayez."})]}):O.length===0?e.jsx("div",{className:"px-4 py-6 text-sm text-muted-foreground",children:k?'Aucune performance trouvée. Cliquez sur "Importer" pour récupérer vos données FFN.':"Ajoutez votre IUF FFN dans votre profil pour commencer."}):e.jsx(_.div,{className:"space-y-2 motion-reduce:animate-none",variants:f?void 0:ie,initial:f?!1:"hidden",animate:f?!1:"visible",children:O.map(s=>{const n=K===s.eventCode,l=()=>Ve(n?null:s.eventCode);return e.jsx(_.div,{variants:ae,children:e.jsx(W,{className:"rounded-2xl",children:e.jsxs(H,{className:"p-0",children:[e.jsxs("button",{type:"button",onClick:l,className:"w-full flex items-center justify-between gap-2 px-3 py-3 text-left cursor-pointer",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[e.jsx(Ie,{className:F("h-4 w-4 shrink-0 text-muted-foreground transition-transform",n&&"rotate-180")}),e.jsx("span",{className:"text-sm font-semibold truncate",children:s.eventCode})]}),e.jsxs("div",{className:"flex items-center gap-2 shrink-0",children:[e.jsx("span",{className:"font-mono text-primary font-bold tabular-nums text-sm",children:$(s.bestTime)}),e.jsx("span",{className:"inline-flex items-center justify-center h-5 min-w-5 px-1.5 rounded-full bg-muted text-xs font-semibold tabular-nums text-muted-foreground",children:s.performances.length})]})]}),n?e.jsxs("div",{className:"border-t border-border",children:[he.length>1?e.jsxs("div",{className:"px-2 pt-3 pb-1",children:[e.jsxs("div",{className:"text-xs text-muted-foreground mb-2 px-2",children:["Progression (",D,"m)"]}),e.jsx(Rs,{width:"100%",height:160,children:e.jsxs(As,{data:he,margin:{top:5,right:10,left:0,bottom:5},children:[e.jsx(Ts,{strokeDasharray:"3 3",className:"stroke-border"}),e.jsx(Te,{dataKey:"date",tick:{fontSize:10},className:"text-muted-foreground"}),e.jsx(Le,{domain:["auto","auto"],tick:{fontSize:10},className:"text-muted-foreground",reversed:!0,tickFormatter:o=>{const a=Math.floor(o/60),i=Math.floor(o%60),p=Math.round(o%1*100);return a>0?`${a}:${String(i).padStart(2,"0")}`:`${i}.${String(p).padStart(2,"0")}`}}),e.jsx(Ms,{formatter:o=>{const a=Math.floor(o/60),i=Math.floor(o%60),p=Math.round(o%1*100);return[a>0?`${a}:${String(i).padStart(2,"0")}.${String(p).padStart(2,"0")}`:`${i}.${String(p).padStart(2,"0")}`,"Temps"]},labelStyle:{fontSize:11},contentStyle:{borderRadius:12,fontSize:12}}),e.jsx(Pe,{type:"monotone",dataKey:"time",stroke:"hsl(var(--primary))",strokeWidth:2,dot:{r:3},activeDot:{r:5}})]})})]}):null,e.jsx("div",{className:"divide-y divide-border",children:s.performances.map(o=>{const a=o.id===s.bestId;return e.jsxs("div",{className:F("px-3 py-2.5",a&&"bg-primary/5"),children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex items-center gap-1.5 min-w-0",children:[a&&e.jsx(re,{className:"h-3.5 w-3.5 text-primary shrink-0"}),e.jsx("span",{className:"text-xs text-muted-foreground tabular-nums",children:U(o.competition_date)})]}),e.jsx("span",{className:F("font-mono tabular-nums text-sm shrink-0",a?"text-primary font-bold":"font-medium"),children:o.time_display??$(o.time_seconds)})]}),e.jsxs("div",{className:"flex items-center gap-3 mt-0.5 text-xs text-muted-foreground",children:[o.ffn_points!=null&&e.jsxs("span",{className:"tabular-nums",children:[String(o.ffn_points)," pts"]}),o.competition_name&&e.jsx("span",{className:"truncate",children:o.competition_name})]})]},o.id)})})]}):null]})})},s.eventCode)})})]}):null,e.jsx("div",{className:"h-6"})]}),e.jsxs(_e,{value:"1rm",className:"mt-0",children:[e.jsx("div",{className:"mt-3",children:e.jsx(W,{className:"w-full min-w-0 rounded-2xl",children:e.jsxs(H,{className:"p-0",children:[Xe||Je?e.jsxs("div",{className:"p-4 grid gap-3",children:[e.jsx(C,{}),e.jsx(C,{}),e.jsx(C,{})]}):Ge||es?e.jsx("div",{className:"p-4 text-sm text-muted-foreground",children:"Impossible de charger les records musculation."}):e.jsx(_.div,{className:"divide-y divide-border motion-reduce:animate-none",variants:f?void 0:ie,initial:f?!1:"hidden",animate:f?!1:"visible",children:Ze?.filter(s=>s.exercise_type!=="warmup").map(s=>{const n=Ye?.find(m=>m.exercise_id===s.id),l=Number(n?.weight??0),o=l>0?`${l} kg`:"—",a=n?.recorded_at??n?.date??null,i=n?.notes??null,p=$e===s.id,g=De===s.id,b=Qe===s.id;return e.jsxs(_.div,{className:"px-3 py-2.5 motion-reduce:animate-none",variants:ae,children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("span",{className:"text-sm font-semibold truncate",children:s.nom_exercice}),e.jsxs("div",{className:"flex items-center gap-2 shrink-0",children:[e.jsx("span",{className:F("font-mono font-bold tabular-nums text-sm",l>0?"text-primary":"text-muted-foreground"),children:o}),!p&&e.jsx("button",{type:"button",onClick:()=>ls(s.id,n?.weight??null),className:"inline-flex items-center justify-center h-8 w-8 rounded-xl text-muted-foreground hover:text-foreground hover:bg-muted/60 transition","aria-label":`Modifier ${s.nom_exercice}`,children:e.jsx(Fe,{className:"h-3.5 w-3.5"})})]})]}),e.jsxs("div",{className:"flex items-center justify-between mt-0.5",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground min-w-0",children:[e.jsx("span",{className:"tabular-nums shrink-0",children:U(a)}),i&&!b?e.jsx("button",{type:"button",onClick:()=>{P(s.id),R(i??"")},className:"truncate italic hover:text-foreground transition text-left",title:"Modifier la note",children:i}):null]}),e.jsxs("div",{className:"flex items-center gap-1 shrink-0",children:[e.jsx("button",{type:"button",onClick:()=>{b?(P(null),R("")):(P(s.id),R(i??""))},className:F("inline-flex items-center justify-center h-7 w-7 rounded-lg transition",i?"text-primary hover:text-primary/80":"text-muted-foreground/40 hover:text-muted-foreground"),"aria-label":i?"Modifier la note":"Ajouter une note",children:e.jsx(Ls,{className:"h-3.5 w-3.5"})}),l>0&&!p?e.jsxs("button",{type:"button",onClick:()=>Ke(g?null:s.id),className:"inline-flex items-center gap-0.5 h-7 px-1.5 rounded-lg text-xs text-muted-foreground hover:text-foreground transition","aria-label":"Table des pourcentages",children:[e.jsx(Ie,{className:F("h-3.5 w-3.5 transition-transform",g&&"rotate-180")}),e.jsx("span",{className:"text-[10px] font-bold",children:"%"})]}):null]})]}),p?e.jsx("div",{className:"mt-3",children:e.jsx(Qs,{value:qe,placeholder:"Ex: 100",inputMode:"decimal",hint:"Charge max (kg).",onCancel:ye,onSave:m=>ds(s.id,m)})}):null,b?e.jsx("div",{className:"mt-3",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(I,{value:me,onChange:m=>R(m.target.value),placeholder:"Machine n°3, cran 5...",className:"h-9 rounded-lg text-sm flex-1",autoFocus:!0}),e.jsx(N,{type:"button",size:"sm",onClick:()=>{const m=me.trim()||null;je.mutate({exercise_id:s.id,notes:m}),P(null),R("")},disabled:je.isPending,className:"rounded-lg h-9 w-9 p-0 shrink-0","aria-label":"Enregistrer",children:e.jsx(X,{className:"h-4 w-4"})}),e.jsx(N,{type:"button",size:"sm",variant:"outline",onClick:()=>{P(null),R("")},className:"rounded-lg h-9 w-9 p-0 shrink-0","aria-label":"Annuler",children:e.jsx(Y,{className:"h-4 w-4"})})]})}):null,g&&l>0?e.jsx("div",{className:"mt-3 rounded-xl bg-muted/30 border border-border p-3",children:e.jsx("div",{className:"grid grid-cols-5 gap-2 text-center text-xs",children:[50,60,70,80,90].map(m=>e.jsxs("div",{className:"space-y-0.5",children:[e.jsxs("div",{className:"text-[10px] text-muted-foreground font-medium",children:[m,"%"]}),e.jsx("div",{className:"font-bold tabular-nums font-mono",children:Math.round(l*m/10)/10})]},m))})}):null]},s.id)})}),ge.isPending?e.jsxs("div",{className:"px-4 pb-4 text-xs text-muted-foreground flex items-center gap-2",children:[e.jsx(we,{className:"h-3 w-3 animate-spin"})," Mise à jour..."]}):null]})})}),e.jsx("div",{className:"h-6"})]})]})})]})}):e.jsx("div",{className:"min-h-[100dvh]",children:e.jsxs("div",{className:"mx-auto max-w-lg px-4 pt-16 pb-10 text-center",children:[e.jsx(B,{className:"h-10 w-10 mx-auto text-muted-foreground/30"}),e.jsx("p",{className:"mt-3 text-sm text-muted-foreground",children:"Cette page est réservée aux nageurs."})]})})}export{Rt as default};
