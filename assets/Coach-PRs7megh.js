const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/StrengthCatalog-IOzSmYyP.js","assets/vendor-query-BiSH4r2z.js","assets/vendor-react-BzrpNAyj.js","assets/api-Co6exKwR.js","assets/index-Dm3SzHfx.js","assets/vendor-supabase-DFPLkPj_.js","assets/index-CvpCOdBH.css","assets/swim-BW1Hd6td.js","assets/index-BIx1lmEv.js","assets/index-DnMXTEkQ.js","assets/index-fh39PRN_.js","assets/select-jxDxI7r7.js","assets/index-Dwh2gPk0.js","assets/chevron-down-EvTvp7Cv.js","assets/chevron-up-QOusOpIj.js","assets/CalendarGrid-zF3qKrap.js","assets/chevron-left-C95jZMwJ.js","assets/chevron-right-BPr1v7-t.js","assets/objectiveHelpers-CSu3km8c.js","assets/dialog-DmbCDscj.js","assets/index-2kZIjqxy.js","assets/checkbox-CYtuykeF.js","assets/alert-dialog-L_oQGHNz.js","assets/tabs-Bm2RHQqV.js","assets/SessionListView-DVaBpcQX.js","assets/play-Doos4HBb.js","assets/save-C4H9alKO.js","assets/circle-alert-CdocIJGN.js","assets/pencil-CZfkrj_C.js","assets/share-2-BvlygocU.js","assets/trash-2-Dnn9zDHj.js","assets/drawer-BsMwj3BP.js","assets/plus-DgIReocw.js","assets/loader-circle-DVUs4jxK.js","assets/search-DofV1hsu.js","assets/pen-C1SVbmGv.js","assets/toggle-group-DPtJRI4m.js","assets/badge-CTeJgXGc.js","assets/copy-CaHVuSI0.js","assets/InlineBanner-BDLbL9E1.js","assets/separator-Bzm1b7ca.js","assets/collapsible-CNJUPpNJ.js","assets/user-plus-C3XXUHgj.js","assets/switch-SxF2OwTf.js","assets/map-pin-oi0vMsQL.js","assets/SwimCatalog-BkFAVMfY.js","assets/SwimSessionTimeline-4fOXfpCy.js","assets/swimConsultationUtils-Cxr-7PfS.js","assets/timer-BRX7lrLk.js","assets/eye-C3mcN_je.js","assets/clock-B3gdQNPf.js","assets/date-NdbyDBh_.js","assets/format-B9mPVj_w.js"])))=>i.map(i=>d[i]);
import{c as we,B as K,d as se,C as ke,i as _e,k as Ae,l as Me,g as De,L as Q,I as je,n as be,o as gs,p as Mt,R as fs,q as vs,r as Dt,P as ne,t as Pt,v as Et,w as js,x as bs,y as ys,z as Ns,a as le,X as gt,s as ct,W as Rt,D as Ft,E as ws,U as ye,G as Cs,H as Ss,T as st,u as ft,b as ks,J as vt,_ as Tt}from"./index-Dm3SzHfx.js";import{j as e,r,u as U,R as _s,c as qe,d as X}from"./vendor-query-BiSH4r2z.js";import{a as I}from"./api-Co6exKwR.js";import{T as dt,a as de}from"./toggle-group-DPtJRI4m.js";import{A as Qe,T as ut,M as mt,a as nt,e as $t,f as Ot,F as As,p as jt}from"./objectiveHelpers-CSu3km8c.js";import{B as te}from"./badge-CTeJgXGc.js";import{S as re,a as ae,b as oe,c as ie,d as J}from"./select-jxDxI7r7.js";import{h as Ms,R as Ds,u as Ps,F as Es,C as bt}from"./index-Dwh2gPk0.js";import{u as pe}from"./index-fh39PRN_.js";import{R as Rs,P as Fs,O as Ts,C as $s}from"./index-2kZIjqxy.js";import"./dialog-DmbCDscj.js";import{S as Os}from"./search-DofV1hsu.js";import{C as Is}from"./copy-CaHVuSI0.js";import{a as qs,b as zs,P as Ls}from"./CalendarGrid-zF3qKrap.js";import{S as ze,a as Le,b as Ke,c as Ge,d as pt,A as Pe,e as Ee,f as Re,g as Fe,h as Te,i as $e,j as Oe,k as Ie}from"./alert-dialog-L_oQGHNz.js";import{I as Ks}from"./InlineBanner-BDLbL9E1.js";import{C as Gs}from"./circle-alert-CdocIJGN.js";import{T as It}from"./trash-2-Dnn9zDHj.js";import{C as qt}from"./checkbox-CYtuykeF.js";import{S as Vs}from"./separator-Bzm1b7ca.js";import{C as Bs,a as Us,b as Qs}from"./collapsible-CNJUPpNJ.js";import{P as he}from"./plus-DgIReocw.js";import{U as Hs,a as Ws}from"./user-plus-C3XXUHgj.js";import{C as zt}from"./chevron-down-EvTvp7Cv.js";import{S as Ys}from"./switch-SxF2OwTf.js";import{M as Js}from"./map-pin-oi0vMsQL.js";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xs=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 18h.01",key:"lrp35t"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M16 18h.01",key:"kzsmim"}]],rt=we("calendar-days",Xs);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zs=[["path",{d:"m7 15 5 5 5-5",key:"1hf1tw"}],["path",{d:"m7 9 5-5 5 5",key:"sgt6xg"}]],en=we("chevrons-up-down",Zs);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tn=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]],Lt=we("external-link",tn);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sn=[["path",{d:"M2 9.5a5.5 5.5 0 0 1 9.591-3.676.56.56 0 0 0 .818 0A5.49 5.49 0 0 1 22 9.5c0 2.29-1.5 4-3 5.5l-5.492 5.313a2 2 0 0 1-3 .019L5 15c-1.5-1.5-3-3.2-3-5.5",key:"mvr1a0"}],["path",{d:"M3.22 13H9.5l.5-1 2 4.5 2-7 1.5 3.5h5.27",key:"auskq0"}]],nn=we("heart-pulse",sn);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rn=[["path",{d:"m22 7-8.991 5.727a2 2 0 0 1-2.009 0L2 7",key:"132q7q"}],["rect",{x:"2",y:"4",width:"20",height:"16",rx:"2",key:"izxlao"}]],Kt=we("mail",rn);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const an=[["path",{d:"M18 21a8 8 0 0 0-16 0",key:"3ypg7q"}],["circle",{cx:"10",cy:"8",r:"5",key:"o932ke"}],["path",{d:"M22 20c0-3.37-2-6.5-4-8a5 5 0 0 0-.45-8.3",key:"10s06x"}]],Gt=we("users-round",an),ce=({title:t,description:n,onBack:s,actions:o})=>e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs(K,{variant:"ghost",size:"sm",className:"-ml-2",onClick:s,children:[e.jsx(Qe,{className:"mr-2 h-4 w-4"}),"Retour"]}),e.jsx("h2",{className:"text-2xl font-display font-semibold uppercase italic text-primary",children:t}),n?e.jsx("p",{className:"text-sm text-muted-foreground",children:n}):null]}),o?e.jsx("div",{className:"flex items-center gap-2",children:o}):null]});function on(t){if(t.length===0)return null;const n=t[0],s=n.effort,o=n.fatigue,a=n.performance,c=n.engagement,d=[];return s!=null&&d.push((11-s)/2),o!=null&&d.push((11-o)/2),a!=null&&d.push(a/2),c!=null&&d.push(c/2),d.length===0?null:Math.round(d.reduce((i,h)=>i+h,0)/d.length*10)/10}function ln(t){return t==null?{label:"—",className:"bg-muted text-muted-foreground"}:t>=3.5?{label:`${t.toFixed(1)}`,className:"bg-emerald-100 text-emerald-800 dark:bg-emerald-900/30 dark:text-emerald-400"}:t>=2.5?{label:`${t.toFixed(1)}`,className:"bg-amber-100 text-amber-800 dark:bg-amber-900/30 dark:text-amber-400"}:{label:`${t.toFixed(1)}`,className:"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400"}}function cn({athletes:t,athletesLoading:n,onBack:s,onOpenAthlete:o}){const[a,c]=r.useState(null),[d,i]=r.useState("name"),{data:h=[]}=U({queryKey:["recent-sessions-all",30],queryFn:()=>I.getRecentSessionsAllAthletes(30),enabled:t.length>0,staleTime:300*1e3}),{data:u}=U({queryKey:["objectives-counts-by-user"],queryFn:()=>I.getObjectivesCountsByUser(),enabled:t.length>0,staleTime:300*1e3}),g=r.useMemo(()=>{const p=new Map;return t.forEach(l=>{l.group_id&&l.group_label&&p.set(l.group_id,l.group_label)}),Array.from(p.entries()).map(([l,f])=>({id:l,name:f})).sort((l,f)=>l.name.localeCompare(f.name,"fr"))},[t]),m=r.useMemo(()=>{const p=new Map,l=new Map;for(const f of h){if(f.athlete_id==null)continue;const P=l.get(f.athlete_id)??[];P.push(f),l.set(f.athlete_id,P)}for(const f of t){if(f.id==null)continue;const P=l.get(f.id)??[],v=on(P),N=P.length>0?P[0].session_date:null;p.set(f.id,{forme:v,lastSessionDate:N,sessionsCount30d:P.length,assiduity:null,objectivesTotal:u?.get(f.id)??0,objectivesAchieved:0})}return p},[t,h,u]),j=r.useMemo(()=>{let p=[...t];switch(a!=null&&(p=p.filter(l=>l.group_id===a)),d){case"forme":p.sort((l,f)=>{const P=l.id!=null?m.get(l.id)?.forme??99:99,v=f.id!=null?m.get(f.id)?.forme??99:99;return P-v});break;case"assiduity":p.sort((l,f)=>{const P=l.id!=null?m.get(l.id)?.sessionsCount30d??99:99,v=f.id!=null?m.get(f.id)?.sessionsCount30d??99:99;return P-v});break;default:p.sort((l,f)=>l.display_name.localeCompare(f.display_name,"fr"))}return p},[t,a,d,m]);return e.jsxs("div",{className:"space-y-4",children:[e.jsx(ce,{title:"Nageurs",description:n?"Chargement…":`${t.length} nageur${t.length!==1?"s":""}`,onBack:s}),g.length>1&&e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{type:"button",onClick:()=>c(null),className:`rounded-full px-3 py-1 text-xs font-medium border transition ${a==null?"bg-foreground text-background border-foreground":"bg-card text-foreground border-border hover:bg-muted"}`,children:"Tous"}),g.map(p=>e.jsx("button",{type:"button",onClick:()=>c(a===p.id?null:p.id),className:`rounded-full px-3 py-1 text-xs font-medium border transition ${a===p.id?"bg-foreground text-background border-foreground":"bg-card text-foreground border-border hover:bg-muted"}`,children:p.name},p.id))]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"Trier :"}),[{key:"name",label:"Nom"},{key:"forme",label:"Forme"},{key:"assiduity",label:"Activité"}].map(p=>e.jsx("button",{type:"button",onClick:()=>i(p.key),className:`rounded-full px-2.5 py-0.5 text-xs font-medium border transition ${d===p.key?"bg-primary/10 text-primary border-primary/30":"bg-card text-muted-foreground border-border hover:bg-muted"}`,children:p.label},p.key))]}),n?e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3",children:[1,2,3,4,5,6].map(p=>e.jsxs("div",{className:"rounded-2xl border bg-card p-4 animate-pulse motion-reduce:animate-none",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-muted"}),e.jsxs("div",{className:"space-y-1.5 flex-1",children:[e.jsx("div",{className:"h-4 w-24 rounded bg-muted"}),e.jsx("div",{className:"h-3 w-16 rounded bg-muted"})]})]}),e.jsxs("div",{className:"mt-3 space-y-2",children:[e.jsx("div",{className:"h-3 w-full rounded bg-muted"}),e.jsx("div",{className:"h-3 w-2/3 rounded bg-muted"})]})]},p))}):j.length===0?e.jsx("p",{className:"text-sm text-muted-foreground text-center py-8",children:a!=null?"Aucun nageur dans ce groupe.":"Aucun nageur disponible."}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3",children:j.map(p=>{const l=p.id!=null?m.get(p.id):null,f=ln(l?.forme??null);return e.jsxs("button",{type:"button",onClick:()=>o(p),className:"rounded-2xl border bg-card p-4 text-left hover:shadow-md hover:border-primary/20 transition-all",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[p.avatar_url?e.jsx("img",{src:p.avatar_url,alt:"",className:"h-10 w-10 rounded-full object-cover border border-border"}):e.jsx("div",{className:"h-10 w-10 rounded-full bg-primary/10 flex items-center justify-center text-sm font-bold text-primary",children:p.display_name.charAt(0).toUpperCase()}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-sm font-semibold truncate",children:p.display_name}),p.group_label&&e.jsx(te,{variant:"secondary",className:"text-[10px] px-1.5 py-0 mt-0.5",children:p.group_label})]})]}),e.jsxs("div",{className:"mt-3 grid grid-cols-3 gap-2",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-[10px] font-medium text-muted-foreground mb-1",children:"Forme"}),e.jsx("span",{className:`inline-block rounded-full px-2 py-0.5 text-xs font-semibold ${f.className}`,children:f.label})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-[10px] font-medium text-muted-foreground mb-1",children:"30j"}),e.jsx("span",{className:"text-sm font-bold text-foreground",children:l?.sessionsCount30d??0}),e.jsx("span",{className:"text-[10px] text-muted-foreground ml-0.5",children:"séances"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-[10px] font-medium text-muted-foreground mb-1",children:"Objectifs"}),e.jsx("span",{className:"text-sm font-bold text-foreground",children:l?.objectivesTotal??0})]})]}),l?.lastSessionDate&&e.jsxs("div",{className:"mt-2 text-[10px] text-muted-foreground",children:["Dernier ressenti : ",new Date(l.lastSessionDate).toLocaleDateString("fr-FR",{day:"numeric",month:"short"})]})]},p.id??p.display_name)})})]})}const dn=({onBack:t,athletes:n,groups:s,athletesLoading:o})=>{const{toast:a}=se(),[c,d]=r.useState(""),[i,h]=r.useState(""),u=r.useMemo(()=>n.filter(l=>l.id&&l.email).map(l=>({value:`user:${l.id}`,label:l.group_label?`${l.display_name} · ${l.group_label}`:l.display_name,email:l.email})),[n]),g=r.useMemo(()=>s.map(l=>({value:`group:${l.id}`,label:l.name,id:l.id})),[s]),m=()=>{if(!i)return[];if(i.startsWith("user:")){const l=u.find(f=>f.value===i);return l?[l.email]:[]}if(i.startsWith("group:")){const l=Number(i.split(":")[1]);return n.filter(f=>f.group_id===l&&f.email).map(f=>f.email)}return[]},j=()=>{const l=m();if(!l.length){a({title:"Aucune adresse email",description:"Aucun nageur avec une adresse email dans cette sélection."});return}const f=new URLSearchParams;f.set("bcc",l.join(",")),c.trim()&&f.set("subject",c.trim()),window.location.href=`mailto:?${f.toString()}`},p=m();return e.jsxs("div",{className:"space-y-6 pb-24",children:[e.jsx(ce,{title:"Contacter par email",description:"Ouvre votre application mail avec les destinataires en CCI.",onBack:t}),e.jsxs(ke,{className:"border-l-4 border-l-primary",children:[e.jsxs(_e,{children:[e.jsx(Ae,{children:"Destinataire"}),e.jsx(Me,{children:"Sélectionnez un nageur ou un groupe."})]}),e.jsxs(De,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(Q,{children:"Destinataire"}),e.jsxs(re,{value:i,onValueChange:h,children:[e.jsx(ae,{children:e.jsx(oe,{placeholder:o?"Chargement...":"Choisir un nageur ou un groupe"})}),e.jsxs(ie,{children:[g.length?e.jsxs(e.Fragment,{children:[e.jsx(J,{value:"section-group",disabled:!0,children:"Groupes"}),g.map(l=>e.jsx(J,{value:l.value,children:l.label},l.value))]}):null,u.length?e.jsxs(e.Fragment,{children:[e.jsx(J,{value:"section-athlete",disabled:!0,children:"Nageurs"}),u.map(l=>e.jsx(J,{value:l.value,children:l.label},l.value))]}):null]})]})]}),i&&p.length>0?e.jsxs("p",{className:"text-xs text-muted-foreground",children:[p.length," adresse",p.length>1?"s":""," email",p.length>1?" (envoi en CCI)":""]}):null,i&&p.length===0?e.jsx("p",{className:"text-xs text-destructive",children:"Aucune adresse email disponible pour cette sélection."}):null]})]}),e.jsxs(ke,{children:[e.jsxs(_e,{children:[e.jsx(Ae,{children:"Objet"}),e.jsx(Me,{children:"Optionnel — pré-rempli dans votre application mail."})]}),e.jsx(De,{children:e.jsx(je,{value:c,onChange:l=>d(l.target.value),placeholder:"Objet du mail…"})})]}),e.jsx("div",{className:"sticky bottom-0 z-10 -mx-4 border-t bg-background/95 p-4 backdrop-blur sm:static sm:mx-0 sm:border-0 sm:p-0",children:e.jsxs(K,{className:"w-full sm:w-auto",onClick:j,disabled:!i||p.length===0,children:[e.jsx(Kt,{className:"mr-2 h-4 w-4"}),"Ouvrir dans l'app mail",e.jsx(Lt,{className:"ml-2 h-3 w-3"})]})})]})};function Se(t,n,{checkForDefaultPrevented:s=!0}={}){return function(a){if(t?.(a),s===!1||!a.defaultPrevented)return n?.(a)}}function un(t){const n=mn(t),s=r.forwardRef((o,a)=>{const{children:c,...d}=o,i=r.Children.toArray(c),h=i.find(hn);if(h){const u=h.props.children,g=i.map(m=>m===h?r.Children.count(u)>1?r.Children.only(null):r.isValidElement(u)?u.props.children:null:m);return e.jsx(n,{...d,ref:a,children:r.isValidElement(u)?r.cloneElement(u,void 0,g):null})}return e.jsx(n,{...d,ref:a,children:c})});return s.displayName=`${t}.Slot`,s}function mn(t){const n=r.forwardRef((s,o)=>{const{children:a,...c}=s;if(r.isValidElement(a)){const d=gn(a),i=xn(c,a.props);return a.type!==r.Fragment&&(i.ref=o?be(o,d):d),r.cloneElement(a,i)}return r.Children.count(a)>1?r.Children.only(null):null});return n.displayName=`${t}.SlotClone`,n}var pn=Symbol("radix.slottable");function hn(t){return r.isValidElement(t)&&typeof t.type=="function"&&"__radixId"in t.type&&t.type.__radixId===pn}function xn(t,n){const s={...n};for(const o in n){const a=t[o],c=n[o];/^on[A-Z]/.test(o)?a&&c?s[o]=(...i)=>{const h=c(...i);return a(...i),h}:a&&(s[o]=a):o==="style"?s[o]={...a,...c}:o==="className"&&(s[o]=[a,c].filter(Boolean).join(" "))}return{...t,...s}}function gn(t){let n=Object.getOwnPropertyDescriptor(t.props,"ref")?.get,s=n&&"isReactWarning"in n&&n.isReactWarning;return s?t.ref:(n=Object.getOwnPropertyDescriptor(t,"ref")?.get,s=n&&"isReactWarning"in n&&n.isReactWarning,s?t.props.ref:t.props.ref||t.ref)}var fn=_s[" useInsertionEffect ".trim().toString()]||gs;function vn({prop:t,defaultProp:n,onChange:s=()=>{},caller:o}){const[a,c,d]=jn({defaultProp:n,onChange:s}),i=t!==void 0,h=i?t:a;{const g=r.useRef(t!==void 0);r.useEffect(()=>{const m=g.current;m!==i&&console.warn(`${o} is changing from ${m?"controlled":"uncontrolled"} to ${i?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),g.current=i},[i,o])}const u=r.useCallback(g=>{if(i){const m=bn(g)?g(t):g;m!==t&&d.current?.(m)}else c(g)},[i,t,c,d]);return[h,u]}function jn({defaultProp:t,onChange:n}){const[s,o]=r.useState(t),a=r.useRef(s),c=r.useRef(n);return fn(()=>{c.current=n},[n]),r.useEffect(()=>{a.current!==s&&(c.current?.(s),a.current=s)},[s,a]),[s,o,c]}function bn(t){return typeof t=="function"}var He="Popover",[Vt]=vs(He,[Mt]),Ve=Mt(),[yn,me]=Vt(He),Bt=t=>{const{__scopePopover:n,children:s,open:o,defaultOpen:a,onOpenChange:c,modal:d=!1}=t,i=Ve(n),h=r.useRef(null),[u,g]=r.useState(!1),[m,j]=vn({prop:o,defaultProp:a??!1,onChange:c,caller:He});return e.jsx(fs,{...i,children:e.jsx(yn,{scope:n,contentId:pe(),triggerRef:h,open:m,onOpenChange:j,onOpenToggle:r.useCallback(()=>j(p=>!p),[j]),hasCustomAnchor:u,onCustomAnchorAdd:r.useCallback(()=>g(!0),[]),onCustomAnchorRemove:r.useCallback(()=>g(!1),[]),modal:d,children:s})})};Bt.displayName=He;var Ut="PopoverAnchor",Nn=r.forwardRef((t,n)=>{const{__scopePopover:s,...o}=t,a=me(Ut,s),c=Ve(s),{onCustomAnchorAdd:d,onCustomAnchorRemove:i}=a;return r.useEffect(()=>(d(),()=>i()),[d,i]),e.jsx(Pt,{...c,...o,ref:n})});Nn.displayName=Ut;var Qt="PopoverTrigger",Ht=r.forwardRef((t,n)=>{const{__scopePopover:s,...o}=t,a=me(Qt,s),c=Ve(s),d=Dt(n,a.triggerRef),i=e.jsx(ne.button,{type:"button","aria-haspopup":"dialog","aria-expanded":a.open,"aria-controls":a.contentId,"data-state":Zt(a.open),...o,ref:d,onClick:Se(t.onClick,a.onOpenToggle)});return a.hasCustomAnchor?i:e.jsx(Pt,{asChild:!0,...c,children:i})});Ht.displayName=Qt;var ht="PopoverPortal",[wn,Cn]=Vt(ht,{forceMount:void 0}),Wt=t=>{const{__scopePopover:n,forceMount:s,children:o,container:a}=t,c=me(ht,n);return e.jsx(wn,{scope:n,forceMount:s,children:e.jsx(Et,{present:s||c.open,children:e.jsx(js,{asChild:!0,container:a,children:o})})})};Wt.displayName=ht;var Ne="PopoverContent",Yt=r.forwardRef((t,n)=>{const s=Cn(Ne,t.__scopePopover),{forceMount:o=s.forceMount,...a}=t,c=me(Ne,t.__scopePopover);return e.jsx(Et,{present:o||c.open,children:c.modal?e.jsx(kn,{...a,ref:n}):e.jsx(_n,{...a,ref:n})})});Yt.displayName=Ne;var Sn=un("PopoverContent.RemoveScroll"),kn=r.forwardRef((t,n)=>{const s=me(Ne,t.__scopePopover),o=r.useRef(null),a=Dt(n,o),c=r.useRef(!1);return r.useEffect(()=>{const d=o.current;if(d)return Ms(d)},[]),e.jsx(Ds,{as:Sn,allowPinchZoom:!0,children:e.jsx(Jt,{...t,ref:a,trapFocus:s.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:Se(t.onCloseAutoFocus,d=>{d.preventDefault(),c.current||s.triggerRef.current?.focus()}),onPointerDownOutside:Se(t.onPointerDownOutside,d=>{const i=d.detail.originalEvent,h=i.button===0&&i.ctrlKey===!0,u=i.button===2||h;c.current=u},{checkForDefaultPrevented:!1}),onFocusOutside:Se(t.onFocusOutside,d=>d.preventDefault(),{checkForDefaultPrevented:!1})})})}),_n=r.forwardRef((t,n)=>{const s=me(Ne,t.__scopePopover),o=r.useRef(!1),a=r.useRef(!1);return e.jsx(Jt,{...t,ref:n,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:c=>{t.onCloseAutoFocus?.(c),c.defaultPrevented||(o.current||s.triggerRef.current?.focus(),c.preventDefault()),o.current=!1,a.current=!1},onInteractOutside:c=>{t.onInteractOutside?.(c),c.defaultPrevented||(o.current=!0,c.detail.originalEvent.type==="pointerdown"&&(a.current=!0));const d=c.target;s.triggerRef.current?.contains(d)&&c.preventDefault(),c.detail.originalEvent.type==="focusin"&&a.current&&c.preventDefault()}})}),Jt=r.forwardRef((t,n)=>{const{__scopePopover:s,trapFocus:o,onOpenAutoFocus:a,onCloseAutoFocus:c,disableOutsidePointerEvents:d,onEscapeKeyDown:i,onPointerDownOutside:h,onFocusOutside:u,onInteractOutside:g,...m}=t,j=me(Ne,s),p=Ve(s);return Ps(),e.jsx(Es,{asChild:!0,loop:!0,trapped:o,onMountAutoFocus:a,onUnmountAutoFocus:c,children:e.jsx(bs,{asChild:!0,disableOutsidePointerEvents:d,onInteractOutside:g,onEscapeKeyDown:i,onPointerDownOutside:h,onFocusOutside:u,onDismiss:()=>j.onOpenChange(!1),children:e.jsx(ys,{"data-state":Zt(j.open),role:"dialog",id:j.contentId,...p,...m,ref:n,style:{...m.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}})})})}),Xt="PopoverClose",An=r.forwardRef((t,n)=>{const{__scopePopover:s,...o}=t,a=me(Xt,s);return e.jsx(ne.button,{type:"button",...o,ref:n,onClick:Se(t.onClick,()=>a.onOpenChange(!1))})});An.displayName=Xt;var Mn="PopoverArrow",Dn=r.forwardRef((t,n)=>{const{__scopePopover:s,...o}=t,a=Ve(s);return e.jsx(Ns,{...a,...o,ref:n})});Dn.displayName=Mn;function Zt(t){return t?"open":"closed"}var Pn=Bt,En=Ht,Rn=Wt,es=Yt;const Fn=Pn,Tn=En,ts=r.forwardRef(({className:t,align:n="center",sideOffset:s=4,...o},a)=>e.jsx(Rn,{children:e.jsx(es,{ref:a,align:n,sideOffset:s,className:le("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-popover-content-transform-origin]",t),...o})}));ts.displayName=es.displayName;var yt=1,$n=.9,On=.8,In=.17,Ye=.1,Je=.999,qn=.9999,zn=.99,Ln=/[\\\/_+.#"@\[\(\{&]/,Kn=/[\\\/_+.#"@\[\(\{&]/g,Gn=/[\s-]/,ss=/[\s-]/g;function at(t,n,s,o,a,c,d){if(c===n.length)return a===t.length?yt:zn;var i=`${a},${c}`;if(d[i]!==void 0)return d[i];for(var h=o.charAt(c),u=s.indexOf(h,a),g=0,m,j,p,l;u>=0;)m=at(t,n,s,o,u+1,c+1,d),m>g&&(u===a?m*=yt:Ln.test(t.charAt(u-1))?(m*=On,p=t.slice(a,u-1).match(Kn),p&&a>0&&(m*=Math.pow(Je,p.length))):Gn.test(t.charAt(u-1))?(m*=$n,l=t.slice(a,u-1).match(ss),l&&a>0&&(m*=Math.pow(Je,l.length))):(m*=In,a>0&&(m*=Math.pow(Je,u-a))),t.charAt(u)!==n.charAt(c)&&(m*=qn)),(m<Ye&&s.charAt(u-1)===o.charAt(c+1)||o.charAt(c+1)===o.charAt(c)&&s.charAt(u-1)!==o.charAt(c))&&(j=at(t,n,s,o,u+1,c+2,d),j*Ye>m&&(m=j*Ye)),m>g&&(g=m),u=s.indexOf(h,u+1);return d[i]=g,g}function Nt(t){return t.toLowerCase().replace(ss," ")}function Vn(t,n,s){return t=s&&s.length>0?`${t+" "+s.join(" ")}`:t,at(t,n,Nt(t),Nt(n),0,0,{})}var Ce='[cmdk-group=""]',Xe='[cmdk-group-items=""]',Bn='[cmdk-group-heading=""]',ns='[cmdk-item=""]',wt=`${ns}:not([aria-disabled="true"])`,ot="cmdk-item-select",fe="data-value",Un=(t,n,s)=>Vn(t,n,s),rs=r.createContext(void 0),Be=()=>r.useContext(rs),as=r.createContext(void 0),xt=()=>r.useContext(as),os=r.createContext(void 0),is=r.forwardRef((t,n)=>{let s=ve(()=>{var x,A;return{search:"",value:(A=(x=t.value)!=null?x:t.defaultValue)!=null?A:"",selectedItemId:void 0,filtered:{count:0,items:new Map,groups:new Set}}}),o=ve(()=>new Set),a=ve(()=>new Map),c=ve(()=>new Map),d=ve(()=>new Set),i=ls(t),{label:h,children:u,value:g,onValueChange:m,filter:j,shouldFilter:p,loop:l,disablePointerSelection:f=!1,vimBindings:P=!0,...v}=t,N=pe(),q=pe(),$=pe(),S=r.useRef(null),w=nr();xe(()=>{if(g!==void 0){let x=g.trim();s.current.value=x,E.emit()}},[g]),xe(()=>{w(6,F)},[]);let E=r.useMemo(()=>({subscribe:x=>(d.current.add(x),()=>d.current.delete(x)),snapshot:()=>s.current,setState:(x,A,C)=>{var k,L,V,W;if(!Object.is(s.current[x],A)){if(s.current[x]=A,x==="search")B(),R(),w(1,O);else if(x==="value"){if(document.activeElement.hasAttribute("cmdk-input")||document.activeElement.hasAttribute("cmdk-root")){let Y=document.getElementById($);Y?Y.focus():(k=document.getElementById(N))==null||k.focus()}if(w(7,()=>{var Y;s.current.selectedItemId=(Y=_())==null?void 0:Y.id,E.emit()}),C||w(5,F),((L=i.current)==null?void 0:L.value)!==void 0){let Y=A??"";(W=(V=i.current).onValueChange)==null||W.call(V,Y);return}}E.emit()}},emit:()=>{d.current.forEach(x=>x())}}),[]),D=r.useMemo(()=>({value:(x,A,C)=>{var k;A!==((k=c.current.get(x))==null?void 0:k.value)&&(c.current.set(x,{value:A,keywords:C}),s.current.filtered.items.set(x,y(A,C)),w(2,()=>{R(),E.emit()}))},item:(x,A)=>(o.current.add(x),A&&(a.current.has(A)?a.current.get(A).add(x):a.current.set(A,new Set([x]))),w(3,()=>{B(),R(),s.current.value||O(),E.emit()}),()=>{c.current.delete(x),o.current.delete(x),s.current.filtered.items.delete(x);let C=_();w(4,()=>{B(),C?.getAttribute("id")===x&&O(),E.emit()})}),group:x=>(a.current.has(x)||a.current.set(x,new Set),()=>{c.current.delete(x),a.current.delete(x)}),filter:()=>i.current.shouldFilter,label:h||t["aria-label"],getDisablePointerSelection:()=>i.current.disablePointerSelection,listId:N,inputId:$,labelId:q,listInnerRef:S}),[]);function y(x,A){var C,k;let L=(k=(C=i.current)==null?void 0:C.filter)!=null?k:Un;return x?L(x,s.current.search,A):0}function R(){if(!s.current.search||i.current.shouldFilter===!1)return;let x=s.current.filtered.items,A=[];s.current.filtered.groups.forEach(k=>{let L=a.current.get(k),V=0;L.forEach(W=>{let Y=x.get(W);V=Math.max(Y,V)}),A.push([k,V])});let C=S.current;b().sort((k,L)=>{var V,W;let Y=k.getAttribute("id"),Ue=L.getAttribute("id");return((V=x.get(Ue))!=null?V:0)-((W=x.get(Y))!=null?W:0)}).forEach(k=>{let L=k.closest(Xe);L?L.appendChild(k.parentElement===L?k:k.closest(`${Xe} > *`)):C.appendChild(k.parentElement===C?k:k.closest(`${Xe} > *`))}),A.sort((k,L)=>L[1]-k[1]).forEach(k=>{var L;let V=(L=S.current)==null?void 0:L.querySelector(`${Ce}[${fe}="${encodeURIComponent(k[0])}"]`);V?.parentElement.appendChild(V)})}function O(){let x=b().find(C=>C.getAttribute("aria-disabled")!=="true"),A=x?.getAttribute(fe);E.setState("value",A||void 0)}function B(){var x,A,C,k;if(!s.current.search||i.current.shouldFilter===!1){s.current.filtered.count=o.current.size;return}s.current.filtered.groups=new Set;let L=0;for(let V of o.current){let W=(A=(x=c.current.get(V))==null?void 0:x.value)!=null?A:"",Y=(k=(C=c.current.get(V))==null?void 0:C.keywords)!=null?k:[],Ue=y(W,Y);s.current.filtered.items.set(V,Ue),Ue>0&&L++}for(let[V,W]of a.current)for(let Y of W)if(s.current.filtered.items.get(Y)>0){s.current.filtered.groups.add(V);break}s.current.filtered.count=L}function F(){var x,A,C;let k=_();k&&(((x=k.parentElement)==null?void 0:x.firstChild)===k&&((C=(A=k.closest(Ce))==null?void 0:A.querySelector(Bn))==null||C.scrollIntoView({block:"nearest"})),k.scrollIntoView({block:"nearest"}))}function _(){var x;return(x=S.current)==null?void 0:x.querySelector(`${ns}[aria-selected="true"]`)}function b(){var x;return Array.from(((x=S.current)==null?void 0:x.querySelectorAll(wt))||[])}function T(x){let A=b()[x];A&&E.setState("value",A.getAttribute(fe))}function z(x){var A;let C=_(),k=b(),L=k.findIndex(W=>W===C),V=k[L+x];(A=i.current)!=null&&A.loop&&(V=L+x<0?k[k.length-1]:L+x===k.length?k[0]:k[L+x]),V&&E.setState("value",V.getAttribute(fe))}function G(x){let A=_(),C=A?.closest(Ce),k;for(;C&&!k;)C=x>0?tr(C,Ce):sr(C,Ce),k=C?.querySelector(wt);k?E.setState("value",k.getAttribute(fe)):z(x)}let ee=()=>T(b().length-1),M=x=>{x.preventDefault(),x.metaKey?ee():x.altKey?G(1):z(1)},H=x=>{x.preventDefault(),x.metaKey?T(0):x.altKey?G(-1):z(-1)};return r.createElement(ne.div,{ref:n,tabIndex:-1,...v,"cmdk-root":"",onKeyDown:x=>{var A;(A=v.onKeyDown)==null||A.call(v,x);let C=x.nativeEvent.isComposing||x.keyCode===229;if(!(x.defaultPrevented||C))switch(x.key){case"n":case"j":{P&&x.ctrlKey&&M(x);break}case"ArrowDown":{M(x);break}case"p":case"k":{P&&x.ctrlKey&&H(x);break}case"ArrowUp":{H(x);break}case"Home":{x.preventDefault(),T(0);break}case"End":{x.preventDefault(),ee();break}case"Enter":{x.preventDefault();let k=_();if(k){let L=new Event(ot);k.dispatchEvent(L)}}}}},r.createElement("label",{"cmdk-label":"",htmlFor:D.inputId,id:D.labelId,style:ar},h),We(t,x=>r.createElement(as.Provider,{value:E},r.createElement(rs.Provider,{value:D},x))))}),Qn=r.forwardRef((t,n)=>{var s,o;let a=pe(),c=r.useRef(null),d=r.useContext(os),i=Be(),h=ls(t),u=(o=(s=h.current)==null?void 0:s.forceMount)!=null?o:d?.forceMount;xe(()=>{if(!u)return i.item(a,d?.id)},[u]);let g=cs(a,c,[t.value,t.children,c],t.keywords),m=xt(),j=ue(w=>w.value&&w.value===g.current),p=ue(w=>u||i.filter()===!1?!0:w.search?w.filtered.items.get(a)>0:!0);r.useEffect(()=>{let w=c.current;if(!(!w||t.disabled))return w.addEventListener(ot,l),()=>w.removeEventListener(ot,l)},[p,t.onSelect,t.disabled]);function l(){var w,E;f(),(E=(w=h.current).onSelect)==null||E.call(w,g.current)}function f(){m.setState("value",g.current,!0)}if(!p)return null;let{disabled:P,value:v,onSelect:N,forceMount:q,keywords:$,...S}=t;return r.createElement(ne.div,{ref:be(c,n),...S,id:a,"cmdk-item":"",role:"option","aria-disabled":!!P,"aria-selected":!!j,"data-disabled":!!P,"data-selected":!!j,onPointerMove:P||i.getDisablePointerSelection()?void 0:f,onClick:P?void 0:l},t.children)}),Hn=r.forwardRef((t,n)=>{let{heading:s,children:o,forceMount:a,...c}=t,d=pe(),i=r.useRef(null),h=r.useRef(null),u=pe(),g=Be(),m=ue(p=>a||g.filter()===!1?!0:p.search?p.filtered.groups.has(d):!0);xe(()=>g.group(d),[]),cs(d,i,[t.value,t.heading,h]);let j=r.useMemo(()=>({id:d,forceMount:a}),[a]);return r.createElement(ne.div,{ref:be(i,n),...c,"cmdk-group":"",role:"presentation",hidden:m?void 0:!0},s&&r.createElement("div",{ref:h,"cmdk-group-heading":"","aria-hidden":!0,id:u},s),We(t,p=>r.createElement("div",{"cmdk-group-items":"",role:"group","aria-labelledby":s?u:void 0},r.createElement(os.Provider,{value:j},p))))}),Wn=r.forwardRef((t,n)=>{let{alwaysRender:s,...o}=t,a=r.useRef(null),c=ue(d=>!d.search);return!s&&!c?null:r.createElement(ne.div,{ref:be(a,n),...o,"cmdk-separator":"",role:"separator"})}),Yn=r.forwardRef((t,n)=>{let{onValueChange:s,...o}=t,a=t.value!=null,c=xt(),d=ue(u=>u.search),i=ue(u=>u.selectedItemId),h=Be();return r.useEffect(()=>{t.value!=null&&c.setState("search",t.value)},[t.value]),r.createElement(ne.input,{ref:n,...o,"cmdk-input":"",autoComplete:"off",autoCorrect:"off",spellCheck:!1,"aria-autocomplete":"list",role:"combobox","aria-expanded":!0,"aria-controls":h.listId,"aria-labelledby":h.labelId,"aria-activedescendant":i,id:h.inputId,type:"text",value:a?t.value:d,onChange:u=>{a||c.setState("search",u.target.value),s?.(u.target.value)}})}),Jn=r.forwardRef((t,n)=>{let{children:s,label:o="Suggestions",...a}=t,c=r.useRef(null),d=r.useRef(null),i=ue(u=>u.selectedItemId),h=Be();return r.useEffect(()=>{if(d.current&&c.current){let u=d.current,g=c.current,m,j=new ResizeObserver(()=>{m=requestAnimationFrame(()=>{let p=u.offsetHeight;g.style.setProperty("--cmdk-list-height",p.toFixed(1)+"px")})});return j.observe(u),()=>{cancelAnimationFrame(m),j.unobserve(u)}}},[]),r.createElement(ne.div,{ref:be(c,n),...a,"cmdk-list":"",role:"listbox",tabIndex:-1,"aria-activedescendant":i,"aria-label":o,id:h.listId},We(t,u=>r.createElement("div",{ref:be(d,h.listInnerRef),"cmdk-list-sizer":""},u)))}),Xn=r.forwardRef((t,n)=>{let{open:s,onOpenChange:o,overlayClassName:a,contentClassName:c,container:d,...i}=t;return r.createElement(Rs,{open:s,onOpenChange:o},r.createElement(Fs,{container:d},r.createElement(Ts,{"cmdk-overlay":"",className:a}),r.createElement($s,{"aria-label":t.label,"cmdk-dialog":"",className:c},r.createElement(is,{ref:n,...i}))))}),Zn=r.forwardRef((t,n)=>ue(s=>s.filtered.count===0)?r.createElement(ne.div,{ref:n,...t,"cmdk-empty":"",role:"presentation"}):null),er=r.forwardRef((t,n)=>{let{progress:s,children:o,label:a="Loading...",...c}=t;return r.createElement(ne.div,{ref:n,...c,"cmdk-loading":"",role:"progressbar","aria-valuenow":s,"aria-valuemin":0,"aria-valuemax":100,"aria-label":a},We(t,d=>r.createElement("div",{"aria-hidden":!0},d)))}),Z=Object.assign(is,{List:Jn,Item:Qn,Input:Yn,Group:Hn,Separator:Wn,Dialog:Xn,Empty:Zn,Loading:er});function tr(t,n){let s=t.nextElementSibling;for(;s;){if(s.matches(n))return s;s=s.nextElementSibling}}function sr(t,n){let s=t.previousElementSibling;for(;s;){if(s.matches(n))return s;s=s.previousElementSibling}}function ls(t){let n=r.useRef(t);return xe(()=>{n.current=t}),n}var xe=typeof window>"u"?r.useEffect:r.useLayoutEffect;function ve(t){let n=r.useRef();return n.current===void 0&&(n.current=t()),n}function ue(t){let n=xt(),s=()=>t(n.snapshot());return r.useSyncExternalStore(n.subscribe,s,s)}function cs(t,n,s,o=[]){let a=r.useRef(),c=Be();return xe(()=>{var d;let i=(()=>{var u;for(let g of s){if(typeof g=="string")return g.trim();if(typeof g=="object"&&"current"in g)return g.current?(u=g.current.textContent)==null?void 0:u.trim():a.current}})(),h=o.map(u=>u.trim());c.value(t,i,h),(d=n.current)==null||d.setAttribute(fe,i),a.current=i}),a}var nr=()=>{let[t,n]=r.useState(),s=ve(()=>new Map);return xe(()=>{s.current.forEach(o=>o()),s.current=new Map},[t]),(o,a)=>{s.current.set(o,a),n({})}};function rr(t){let n=t.type;return typeof n=="function"?n(t.props):"render"in n?n.render(t.props):t}function We({asChild:t,children:n},s){return t&&r.isValidElement(n)?r.cloneElement(rr(n),{ref:n.ref},s(n.props.children)):s(n)}var ar={position:"absolute",width:"1px",height:"1px",padding:"0",margin:"-1px",overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",borderWidth:"0"};const ds=r.forwardRef(({className:t,...n},s)=>e.jsx(Z,{ref:s,className:le("flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground",t),...n}));ds.displayName=Z.displayName;const us=r.forwardRef(({className:t,...n},s)=>e.jsxs("div",{className:"flex items-center border-b px-3","cmdk-input-wrapper":"",children:[e.jsx(Os,{className:"mr-2 h-4 w-4 shrink-0 opacity-50"}),e.jsx(Z.Input,{ref:s,className:le("flex h-10 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50",t),...n})]}));us.displayName=Z.Input.displayName;const ms=r.forwardRef(({className:t,...n},s)=>e.jsx(Z.List,{ref:s,className:le("max-h-[300px] overflow-y-auto overflow-x-hidden",t),...n}));ms.displayName=Z.List.displayName;const ps=r.forwardRef((t,n)=>e.jsx(Z.Empty,{ref:n,className:"py-6 text-center text-sm",...t}));ps.displayName=Z.Empty.displayName;const it=r.forwardRef(({className:t,...n},s)=>e.jsx(Z.Group,{ref:s,className:le("overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground",t),...n}));it.displayName=Z.Group.displayName;const or=r.forwardRef(({className:t,...n},s)=>e.jsx(Z.Separator,{ref:s,className:le("-mx-1 h-px bg-border",t),...n}));or.displayName=Z.Separator.displayName;const lt=r.forwardRef(({className:t,...n},s)=>e.jsx(Z.Item,{ref:s,className:le("relative flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected=true]:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",t),...n}));lt.displayName=Z.Item.displayName;const ir=({onBack:t,athletes:n,groups:s,athletesLoading:o})=>{const{toast:a}=se(),[c,d]=r.useState(""),[i,h]=r.useState(new Set),[u,g]=r.useState(new Set),[m,j]=r.useState(!1),{data:p}=U({queryKey:["athlete-phones"],queryFn:async()=>{const{data:y}=await ct.from("user_profiles").select("user_id, phone").not("phone","is",null);return new Map((y??[]).map(R=>[R.user_id,R.phone]))}}),l=r.useMemo(()=>n.filter(y=>y.id!=null).map(y=>({id:y.id,display_name:y.display_name,group_id:y.group_id??null,group_label:y.group_label??null})),[n]),f=y=>{h(R=>{const O=new Set(R);return O.has(y)?O.delete(y):O.add(y),O})},P=y=>{g(R=>{const O=new Set(R);return O.has(y)?O.delete(y):O.add(y),O})},v=()=>{h(new Set),g(new Set)},{selectedPhones:N,selectedTotal:q,missingCount:$}=r.useMemo(()=>{if(!p)return{selectedPhones:[],selectedTotal:0,missingCount:0};const y=new Set;for(const B of i)for(const F of l)F.group_id===B&&y.add(F.id);for(const B of u)y.add(B);const R=y.size,O=[];for(const B of y){const F=p.get(B);F&&F.trim().length>0&&O.push(F)}return{selectedPhones:O,selectedTotal:R,missingCount:R-O.length}},[i,u,l,p]),S=i.size+u.size,w=r.useMemo(()=>{const y=[];return i.size>0&&y.push(`${i.size} groupe${i.size>1?"s":""}`),u.size>0&&y.push(`${u.size} nageur${u.size>1?"s":""}`),y.join(", ")},[i.size,u.size]),E=()=>{if(N.length===0){a({title:"Aucun numéro",description:"Aucun nageur avec un numéro de téléphone dans cette sélection.",variant:"destructive"});return}if(/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)){const R=c.trim()?encodeURIComponent(c.trim()):"",O=/iPhone|iPad|iPod/i.test(navigator.userAgent);let B;if(O){const F=N.join(",");B=R?`sms:/open?addresses=${F}&body=${R}`:`sms:/open?addresses=${F}`}else B=R?`sms:${N.join(",")}?body=${R}`:`sms:${N.join(",")}`;window.location.href=B}else navigator.clipboard.writeText(N.join(", ")).then(()=>{a({title:"Numéros copiés",description:`${N.length} numéro${N.length>1?"s":""} copié${N.length>1?"s":""} dans le presse-papiers.`})}).catch(()=>{a({title:"Erreur",description:"Impossible de copier les numéros.",variant:"destructive"})})},D=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent);return e.jsxs("div",{className:"space-y-6 pb-24",children:[e.jsx(ce,{title:"Envoyer un SMS",description:"Ouvre votre application SMS ou copie les numéros.",onBack:t}),e.jsxs(ke,{className:"border-l-4 border-l-primary",children:[e.jsxs(_e,{children:[e.jsx(Ae,{children:"Destinataires"}),e.jsx(Me,{children:"Sélectionnez des groupes et/ou des nageurs."})]}),e.jsxs(De,{className:"space-y-3",children:[e.jsx(Q,{children:"Destinataires"}),e.jsxs(Fn,{open:m,onOpenChange:j,children:[e.jsx(Tn,{asChild:!0,children:e.jsxs(K,{variant:"outline",role:"combobox","aria-expanded":m,className:"w-full justify-between font-normal",children:[e.jsx("span",{className:"truncate",children:S>0?w:o?"Chargement...":"Choisir des destinataires"}),e.jsx(en,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),e.jsx(ts,{className:"w-[var(--radix-popover-trigger-width)] p-0",align:"start",children:e.jsxs(ds,{children:[e.jsx(us,{placeholder:"Rechercher..."}),e.jsxs(ms,{children:[e.jsx(ps,{children:"Aucun résultat."}),s.length>0&&e.jsx(it,{heading:"Groupes",children:s.map(y=>e.jsxs(lt,{value:`groupe ${y.name}`,onSelect:()=>f(y.id),children:[e.jsx(bt,{className:le("mr-2 h-4 w-4",i.has(y.id)?"opacity-100":"opacity-0")}),y.name]},`group:${y.id}`))}),l.length>0&&e.jsx(it,{heading:"Nageurs",children:l.map(y=>e.jsxs(lt,{value:`nageur ${y.display_name} ${y.group_label??""}`,onSelect:()=>P(y.id),children:[e.jsx(bt,{className:le("mr-2 h-4 w-4",u.has(y.id)?"opacity-100":"opacity-0")}),e.jsx("span",{className:"truncate",children:y.display_name}),y.group_label&&e.jsx("span",{className:"ml-auto text-xs text-muted-foreground",children:y.group_label})]},`user:${y.id}`))})]})]})})]}),S>0&&e.jsxs("div",{className:"flex flex-wrap items-center gap-1.5",children:[[...i].map(y=>{const R=s.find(O=>O.id===y);return R?e.jsxs(te,{variant:"secondary",className:"gap-1 pr-1",children:[R.name,e.jsx("button",{type:"button",onClick:()=>f(y),className:"ml-0.5 rounded-full p-0.5 hover:bg-muted",children:e.jsx(gt,{className:"h-3 w-3"})})]},`g:${y}`):null}),[...u].map(y=>{const R=l.find(O=>O.id===y);return R?e.jsxs(te,{variant:"outline",className:"gap-1 pr-1",children:[R.display_name,e.jsx("button",{type:"button",onClick:()=>P(y),className:"ml-0.5 rounded-full p-0.5 hover:bg-muted",children:e.jsx(gt,{className:"h-3 w-3"})})]},`u:${y}`):null}),S>1&&e.jsx("button",{type:"button",onClick:v,className:"text-xs text-muted-foreground underline hover:text-foreground",children:"Tout effacer"})]}),S>0&&N.length>0&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:[N.length," numéro",N.length>1?"s":""," trouvé",N.length>1?"s":"",$>0&&e.jsxs("span",{className:"text-destructive",children:[" · ",$," sans téléphone"]})]}),S>0&&N.length===0&&e.jsx("p",{className:"text-xs text-destructive",children:"Aucun numéro de téléphone disponible pour cette sélection."})]})]}),e.jsxs(ke,{children:[e.jsxs(_e,{children:[e.jsx(Ae,{children:"Message"}),e.jsx(Me,{children:"Optionnel — pré-rempli dans votre application SMS."})]}),e.jsx(De,{children:e.jsx(ut,{value:c,onChange:y=>d(y.target.value),placeholder:"Contenu du SMS…",rows:3})})]}),e.jsx("div",{className:"sticky bottom-0 z-10 -mx-4 border-t bg-background/95 p-4 backdrop-blur sm:static sm:mx-0 sm:border-0 sm:p-0",children:e.jsx(K,{className:"w-full sm:w-auto",onClick:E,disabled:S===0||N.length===0,children:D?e.jsxs(e.Fragment,{children:[e.jsx(mt,{className:"mr-2 h-4 w-4"}),"Ouvrir dans l'app SMS",e.jsx(Lt,{className:"ml-2 h-3 w-3"})]}):e.jsxs(e.Fragment,{children:[e.jsx(Is,{className:"mr-2 h-4 w-4"}),"Copier les numéros"]})})})]})};function Ct(t){return String(t).padStart(2,"0")}function ge(t){return`${t.getFullYear()}-${Ct(t.getMonth()+1)}-${Ct(t.getDate())}`}function Ze(t){return new Date(t.getFullYear(),t.getMonth(),1)}function St(t,n){const s=new Date(t);return s.setDate(s.getDate()+n),s}function lr(t){return(t.getDay()+6)%7}function et(t){if(!t)return"AM";const n=t.toLowerCase();return n==="evening"||n.includes("soir")||n==="pm"?"PM":"AM"}const cr=[{key:"swim-morning",label:"Nage — Matin",type:"swim",scheduledSlot:"morning"},{key:"swim-evening",label:"Nage — Soir",type:"swim",scheduledSlot:"evening"},{key:"strength",label:"Musculation",type:"strength",scheduledSlot:null}];function dr({groupId:t,userId:n,enabled:s}){const o=r.useMemo(()=>new Date,[]),[a,c]=r.useState(()=>Ze(new Date)),[d,i]=r.useState(()=>ge(new Date)),[h,u]=r.useState(null),[g,m]=r.useState(!1),j=r.useMemo(()=>Ze(a),[a]),p=r.useMemo(()=>{const b=lr(j),T=St(j,-b),z=[];for(let G=0;G<42;G++)z.push(St(T,G));return z},[j]),l=r.useMemo(()=>{const b=ge(p[0]),T=ge(p[p.length-1]);return{from:b,to:T}},[p]),f=!!(t||n),{data:P=[],isLoading:v}=U({queryKey:["coach-calendar-assignments",t,n,l.from,l.to],queryFn:()=>I.getCoachAssignments({groupId:t??null,userId:n??null,from:l.from,to:l.to}),enabled:f}),N=r.useMemo(()=>{const b=new Map;for(const T of P){const z=T.scheduledDate?.slice(0,10);z&&(b.has(z)||b.set(z,[]),b.get(z).push(T))}return b},[P]),q=r.useMemo(()=>{const b={};for(const T of p){const z=ge(T),G=N.get(z)??[],ee=G.some(A=>et(A.scheduledSlot)==="AM"),M=G.some(A=>et(A.scheduledSlot)==="PM"),H=(ee?1:0)+(M?1:0),x=[{slotKey:"AM",expected:ee,completed:ee,absent:!1},{slotKey:"PM",expected:M,completed:M,absent:!1}];b[z]={completed:H,total:H,slots:x}}return b},[p,N]),$=r.useMemo(()=>{const[b,T,z]=d.split("-").map(Number);return new Date(b,T-1,z)},[d]),S=r.useMemo(()=>N.get(d)??[],[N,d]),w=r.useMemo(()=>{const b=S;return cr.map(T=>{const z=b.filter(M=>T.type!==M.type?!1:T.type==="swim"?et(M.scheduledSlot)===(T.scheduledSlot==="morning"?"AM":"PM"):!0),G=z.find(M=>M.targetType==="user"),ee=z.find(M=>M.targetType==="group");return{...T,assignment:G??ee??null}})},[S]),{data:E=[]}=U({queryKey:["planned-absences-coach",n,l.from,l.to],queryFn:()=>I.getPlannedAbsences({userId:n,from:l.from,to:l.to}),enabled:!!n}),D=r.useMemo(()=>new Set(E.map(b=>b.date)),[E]),y=r.useMemo(()=>{const b={};for(const T of p){const z=ge(T),G=N.get(z)??[];b[z]=G.some(ee=>ee.type==="strength")}return b},[p,N]),R=q[d]??{completed:0,total:0,slots:[{slotKey:"AM",expected:!1,completed:!1,absent:!1},{slotKey:"PM",expected:!1,completed:!1,absent:!1}]},O=r.useCallback(()=>{c(b=>new Date(b.getFullYear(),b.getMonth()-1,1))},[]),B=r.useCallback(()=>{c(b=>new Date(b.getFullYear(),b.getMonth()+1,1))},[]),F=r.useCallback(()=>{c(Ze(new Date)),i(ge(new Date))},[]),_=r.useCallback(b=>{i(b),m(!0)},[]);return{today:o,monthCursor:a,selectedISO:d,selectedDayIndex:h,drawerOpen:g,gridDates:p,completionByISO:q,selectedDate:$,selectedDayStatus:R,assignmentsForSelectedDay:S,slotsForSelectedDay:w,hasStrengthByISO:y,absenceDates:D,isLoading:v,hasFilter:f,setSelectedISO:i,setSelectedDayIndex:u,setDrawerOpen:m,prevMonth:O,nextMonth:B,jumpToday:F,openDay:_}}function ur(t){const[n,s,o]=t.split("-").map(Number);return new Date(n,s-1,o).toLocaleDateString("fr-FR",{weekday:"long",day:"numeric",month:"long"})}function mr({onBack:t,athletes:n,groups:s,swimSessions:o,strengthSessions:a}){const[c,d]=r.useState("group"),[i,h]=r.useState(""),[u,g]=r.useState(""),m=c==="group"&&i?Number(i):null,j=c==="user"&&u?Number(u):null,{today:p,monthCursor:l,selectedISO:f,selectedDayIndex:P,drawerOpen:v,gridDates:N,completionByISO:q,selectedDayStatus:$,slotsForSelectedDay:S,hasStrengthByISO:w,absenceDates:E,hasFilter:D,setSelectedISO:y,setSelectedDayIndex:R,setDrawerOpen:O,prevMonth:B,nextMonth:F,jumpToday:_,openDay:b}=dr({groupId:m,userId:j,enabled:!0}),T=qe(),z=X({mutationFn:M=>I.assignments_create(M),onSuccess:()=>{T.invalidateQueries({queryKey:["coach-calendar-assignments"]})}}),G=X({mutationFn:M=>I.assignments_delete(M),onSuccess:()=>{T.invalidateQueries({queryKey:["coach-calendar-assignments"]})}}),ee=(M,H)=>{let x=H;if(M.key==="ArrowLeft"&&(x=Math.max(0,H-1)),M.key==="ArrowRight"&&(x=Math.min(N.length-1,H+1)),M.key==="ArrowUp"&&(x=Math.max(0,H-7)),M.key==="ArrowDown"&&(x=Math.min(N.length-1,H+7)),x!==H){M.preventDefault(),R(x);const A=L=>String(L).padStart(2,"0"),C=N[x],k=`${C.getFullYear()}-${A(C.getMonth()+1)}-${A(C.getDate())}`;y(k)}if(M.key==="Enter"||M.key===" "){M.preventDefault();const A=L=>String(L).padStart(2,"0"),C=N[H],k=`${C.getFullYear()}-${A(C.getMonth()+1)}-${A(C.getDate())}`;b(k)}};return e.jsxs("div",{className:"space-y-4",children:[e.jsx(ce,{title:"Calendrier",description:"Vue mensuelle des assignations",onBack:t}),e.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center",children:[e.jsxs(dt,{type:"single",value:c,onValueChange:M=>{(M==="group"||M==="user")&&d(M)},className:"shrink-0",children:[e.jsx(de,{value:"group",className:"text-xs px-3",children:"Groupe"}),e.jsx(de,{value:"user",className:"text-xs px-3",children:"Nageur"})]}),c==="group"?e.jsxs(re,{value:i,onValueChange:h,children:[e.jsx(ae,{className:"w-full sm:w-56",children:e.jsx(oe,{placeholder:"Choisir un groupe"})}),e.jsx(ie,{children:s.map(M=>e.jsx(J,{value:String(M.id),children:M.name},String(M.id)))})]}):e.jsxs(re,{value:u,onValueChange:g,children:[e.jsx(ae,{className:"w-full sm:w-56",children:e.jsx(oe,{placeholder:"Choisir un nageur"})}),e.jsx(ie,{children:n.filter(M=>M.id!=null).map(M=>e.jsxs(J,{value:String(M.id),children:[M.display_name,M.group_label?` · ${M.group_label}`:""]},String(M.id)))})]})]}),D?e.jsxs("div",{className:"rounded-2xl border bg-card shadow-sm",children:[e.jsx(qs,{monthCursor:l,selectedDayStatus:$,onPrevMonth:B,onNextMonth:F,onJumpToday:_}),e.jsx(zs,{monthCursor:l,gridDates:N,completionByISO:q,strengthByISO:w,absenceDates:E,selectedISO:f,selectedDayIndex:P,today:p,onDayClick:b,onKeyDown:ee})]}):e.jsx("div",{className:"py-12 text-center text-sm text-muted-foreground",children:"Sélectionnez un groupe ou un nageur pour afficher le calendrier."}),e.jsx(ze,{open:v,onOpenChange:O,children:e.jsxs(Le,{side:"bottom",className:"max-h-[70vh] overflow-y-auto rounded-t-2xl",children:[e.jsxs(Ke,{className:"pb-3",children:[e.jsx(Ge,{className:"capitalize text-left",children:ur(f)}),e.jsx(pt,{className:"sr-only",children:"Gérer les assignations pour cette journée"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(Ks,{variant:"red",icon:e.jsx(Gs,{}),label:"Absence prévue",visible:E.has(f),animate:!1}),S.map(M=>{const H=M.assignment?.targetType==="group",x=c==="user";return e.jsx(pr,{slot:M,swimSessions:o,strengthSessions:a,isGroupAssignment:H&&x,onAssign:A=>{z.mutate({assignment_type:M.type,session_id:A,scheduled_date:f,scheduled_slot:M.scheduledSlot??void 0,target_group_id:m,target_user_id:j})},onDelete:A=>{G.mutate(A)},onReplace:(A,C)=>{H&&x?z.mutate({assignment_type:M.type,session_id:C,scheduled_date:f,scheduled_slot:M.scheduledSlot??void 0,target_user_id:j}):G.mutate(A,{onSuccess:()=>{z.mutate({assignment_type:M.type,session_id:C,scheduled_date:f,scheduled_slot:M.scheduledSlot??void 0,target_group_id:m,target_user_id:j})}})},isPending:z.isPending||G.isPending},M.key)})]})]})})]})}function pr({slot:t,swimSessions:n,strengthSessions:s,isGroupAssignment:o,onAssign:a,onDelete:c,onReplace:d,isPending:i}){const[h,u]=r.useState(!1),g=t.type==="swim",m=g?(n??[]).map(l=>({id:l.id,label:l.name})):(s??[]).map(l=>({id:l.id,label:l.title})),j=t.assignment!==null,p=l=>{const f=Number(l);f&&(j&&h?(d(t.assignment.id,f),u(!1)):a(f))};return e.jsxs("div",{className:"rounded-xl border p-3 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[g?e.jsx(Rt,{className:"h-4 w-4 text-blue-500 shrink-0"}):e.jsx(Ft,{className:"h-4 w-4 text-orange-500 shrink-0"}),e.jsx("span",{className:"text-xs font-semibold text-muted-foreground uppercase tracking-wide",children:t.label})]}),j&&!h?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("p",{className:"text-sm font-semibold truncate flex-1",children:[t.assignment.title,o&&e.jsx("span",{className:"ml-1.5 text-[10px] font-medium text-muted-foreground bg-muted px-1.5 py-0.5 rounded-full align-middle",children:"Groupe"})]}),e.jsx(K,{type:"button",size:"icon",variant:"ghost",className:"h-7 w-7 shrink-0",disabled:i,onClick:()=>u(!0),title:o?"Personnaliser":"Changer",children:e.jsx(ws,{className:"h-3.5 w-3.5"})}),!o&&e.jsx(K,{type:"button",size:"icon",variant:"ghost",className:"h-7 w-7 shrink-0 text-destructive hover:text-destructive",disabled:i,onClick:()=>c(t.assignment.id),title:"Supprimer",children:e.jsx(It,{className:"h-3.5 w-3.5"})})]}):e.jsxs(re,{value:"",onValueChange:p,disabled:i||m.length===0,children:[e.jsx(ae,{className:"h-9 text-xs",children:e.jsx(oe,{placeholder:h?o?"Personnaliser pour ce nageur":"Choisir le remplacement":"Choisir une séance"})}),e.jsx(ie,{children:m.map(l=>e.jsx(J,{value:String(l.id),children:l.label},l.id))})]}),h?e.jsx("button",{type:"button",className:"text-xs text-muted-foreground hover:text-foreground",onClick:()=>u(!1),children:"Annuler"}):null]})}const hs=({athletes:t,selected:n,onToggle:s,filterToUserIds:o})=>{const[a,c]=r.useState(""),d=r.useMemo(()=>{let h=t.filter(u=>u.id!=null);if(o&&(h=h.filter(u=>o.has(u.id))),a.trim()){const u=a.toLowerCase();h=h.filter(g=>g.display_name.toLowerCase().includes(u))}return h},[t,o,a]),i=r.useMemo(()=>{const h=new Map;for(const u of d){const g=u.group_label||"Sans groupe";h.has(g)||h.set(g,[]),h.get(g).push(u)}return[...h.entries()].sort(([u],[g])=>u.localeCompare(g,"fr"))},[d]);return e.jsxs("div",{className:"space-y-3",children:[e.jsx(je,{placeholder:"Rechercher un nageur...",value:a,onChange:h=>c(h.target.value)}),e.jsxs("div",{className:"max-h-[50vh] overflow-y-auto space-y-3",children:[i.map(([h,u])=>e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-semibold uppercase tracking-wider text-muted-foreground mb-1.5",children:h}),e.jsx("div",{className:"space-y-1",children:u.map(g=>e.jsxs("label",{className:"flex items-center gap-2.5 rounded-lg border px-3 py-2 cursor-pointer hover:bg-muted/50 transition-colors",children:[e.jsx(qt,{checked:n.has(g.id),onCheckedChange:()=>s(g.id)}),e.jsx("span",{className:"text-sm",children:g.display_name})]},g.id))})]},h)),i.length===0&&e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"Aucun nageur trouvé."})]}),n.size>0&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:[n.size," nageur",n.size>1?"s":""," ","sélectionné",n.size>1?"s":""]})]})},xs=({open:t,onOpenChange:n,athletes:s,parentGroupId:o,parentMembers:a,onCreated:c})=>{const{toast:d}=se(),[i,h]=r.useState(""),[u,g]=r.useState(new Set),m=l=>{g(f=>{const P=new Set(f);return P.has(l)?P.delete(l):P.add(l),P})},j=X({mutationFn:()=>I.createTemporaryGroup({name:i.trim(),member_user_ids:[...u],parent_group_id:o??void 0}),onSuccess:()=>{d({title:"Groupe créé",description:`Le groupe "${i.trim()}" a été créé avec ${u.size} nageur${u.size>1?"s":""}.`}),h(""),g(new Set),n(!1),c()},onError:l=>{d({title:"Erreur",description:l.message,variant:"destructive"})}}),p=()=>{if(!i.trim()){d({title:"Nom requis",description:"Veuillez saisir un nom pour le groupe.",variant:"destructive"});return}j.mutate()};return e.jsx(ze,{open:t,onOpenChange:n,children:e.jsxs(Le,{side:"right",className:"w-full sm:max-w-md overflow-y-auto",children:[e.jsxs(Ke,{children:[e.jsx(Ge,{children:o?"Créer un sous-groupe":"Créer un groupe"}),e.jsx(pt,{children:o?"Sélectionnez des nageurs du groupe parent pour ce sous-groupe.":"Créez un groupe temporaire (stage, compétition) avec des nageurs de différents groupes."})]}),e.jsxs("div",{className:"mt-6 space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(Q,{htmlFor:"group-name",children:"Nom du groupe"}),e.jsx(je,{id:"group-name",placeholder:"Ex : Stage Pâques 2026",value:i,onChange:l=>h(l.target.value)})]}),e.jsx(Vs,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Q,{children:"Nageurs"}),e.jsx(hs,{athletes:s,selected:u,onToggle:m,filterToUserIds:a??null})]}),e.jsx(K,{className:"w-full",onClick:p,disabled:j.isPending||!i.trim(),children:j.isPending?"Création...":"Créer le groupe"})]})]})})},hr=({open:t,onOpenChange:n,groupId:s,athletes:o,existingMemberIds:a,onAdded:c})=>{const{toast:d}=se(),[i,h]=r.useState(new Set),u=r.useMemo(()=>o.filter(j=>j.id!=null&&!a.has(j.id)),[o,a]),g=j=>{h(p=>{const l=new Set(p);return l.has(j)?l.delete(j):l.add(j),l})},m=X({mutationFn:()=>I.addTemporaryGroupMembers(s,[...i]),onSuccess:()=>{d({title:"Nageurs ajoutés",description:`${i.size} nageur${i.size>1?"s":""} ajouté${i.size>1?"s":""}.`}),h(new Set),n(!1),c()},onError:j=>{d({title:"Erreur",description:j.message,variant:"destructive"})}});return e.jsx(ze,{open:t,onOpenChange:n,children:e.jsxs(Le,{side:"right",className:"w-full sm:max-w-md overflow-y-auto",children:[e.jsxs(Ke,{children:[e.jsx(Ge,{children:"Ajouter des nageurs"}),e.jsx(pt,{children:"Sélectionnez les nageurs à ajouter au groupe."})]}),e.jsxs("div",{className:"mt-6 space-y-4",children:[e.jsx(hs,{athletes:u,selected:i,onToggle:g}),e.jsx(K,{className:"w-full",onClick:()=>m.mutate(),disabled:m.isPending||i.size===0,children:m.isPending?"Ajout...":`Ajouter ${i.size} nageur${i.size>1?"s":""}`})]})]})})},xr=({groupId:t,athletes:n,onBack:s})=>{const{toast:o}=se(),a=qe(),[c,d]=r.useState(!1),[i,h]=r.useState(!1),[u,g]=r.useState(null),{data:m,isLoading:j}=U({queryKey:["temp-group-detail",t],queryFn:()=>I.getTemporaryGroupDetail(t)}),p=X({mutationFn:v=>I.removeTemporaryGroupMember(t,v),onSuccess:()=>{o({title:"Nageur retiré"}),a.invalidateQueries({queryKey:["temp-group-detail",t]}),a.invalidateQueries({queryKey:["temp-groups"]})},onError:v=>{o({title:"Erreur",description:v.message,variant:"destructive"})}}),l=()=>{a.invalidateQueries({queryKey:["temp-group-detail",t]}),a.invalidateQueries({queryKey:["temp-groups"]})},f=r.useMemo(()=>new Set((m?.members??[]).map(v=>v.user_id)),[m]),P=r.useMemo(()=>new Set((m?.members??[]).map(v=>v.user_id)),[m]);return j?e.jsxs("div",{className:"space-y-4",children:[e.jsxs(K,{variant:"ghost",size:"sm",className:"-ml-2",onClick:s,children:[e.jsx(Qe,{className:"mr-2 h-4 w-4"}),"Retour aux groupes"]}),e.jsx("div",{className:"space-y-2",children:[1,2,3].map(v=>e.jsx("div",{className:"rounded-xl border p-3 animate-pulse motion-reduce:animate-none",children:e.jsx("div",{className:"h-4 w-32 rounded bg-muted"})},v))})]}):m?e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs(K,{variant:"ghost",size:"sm",className:"-ml-2",onClick:s,children:[e.jsx(Qe,{className:"mr-2 h-4 w-4"}),"Retour aux groupes"]}),e.jsx("h2",{className:"text-2xl font-display font-semibold uppercase italic text-primary",children:m.name}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(te,{variant:m.is_active?"default":"secondary",children:m.is_active?"Actif":"Terminé"}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:[m.members.length," membre",m.members.length!==1?"s":""]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-xs font-semibold uppercase tracking-[0.15em] text-muted-foreground",children:"Membres"}),m.is_active&&e.jsxs(K,{size:"sm",variant:"outline",onClick:()=>d(!0),children:[e.jsx(Hs,{className:"mr-1.5 h-3.5 w-3.5"}),"Ajouter"]})]}),m.members.length===0?e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"Aucun membre dans ce groupe."}):e.jsx("div",{className:"space-y-1.5",children:m.members.map(v=>e.jsxs("div",{className:"flex items-center gap-3 rounded-xl border bg-card p-3",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-sm font-semibold truncate",children:v.display_name}),v.permanent_group_label&&e.jsx(te,{variant:"secondary",className:"text-[10px] px-1.5 py-0 mt-0.5",children:v.permanent_group_label})]}),m.is_active&&e.jsx(K,{size:"icon",variant:"ghost",className:"h-8 w-8 text-muted-foreground hover:text-destructive",onClick:()=>g({userId:v.user_id,name:v.display_name}),title:"Retirer du groupe",children:e.jsx(Ws,{className:"h-4 w-4"})})]},v.user_id))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-xs font-semibold uppercase tracking-[0.15em] text-muted-foreground",children:"Sous-groupes"}),m.is_active&&e.jsxs(K,{size:"sm",variant:"outline",onClick:()=>h(!0),children:[e.jsx(he,{className:"mr-1.5 h-3.5 w-3.5"}),"Sous-groupe"]})]}),m.subgroups.length===0?e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"Aucun sous-groupe."}):e.jsx("div",{className:"space-y-2",children:m.subgroups.map(v=>e.jsxs(Bs,{children:[e.jsxs(Us,{className:"flex w-full items-center justify-between rounded-xl border bg-card p-3 text-left hover:bg-muted/50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Gt,{className:"h-4 w-4 text-primary"}),e.jsx("span",{className:"text-sm font-semibold",children:v.name}),e.jsx(te,{variant:"secondary",className:"text-[10px] px-1.5 py-0",children:v.members.length})]}),e.jsx(zt,{className:"h-4 w-4 text-muted-foreground transition-transform [[data-state=open]_&]:rotate-180"})]}),e.jsx(Qs,{children:e.jsxs("div",{className:"ml-4 mt-1 space-y-1",children:[v.members.map(N=>e.jsx("div",{className:"flex items-center gap-2 rounded-lg border px-3 py-2",children:e.jsx("span",{className:"text-sm",children:N.display_name})},N.user_id)),v.members.length===0&&e.jsx("p",{className:"text-xs text-muted-foreground py-2",children:"Aucun membre."})]})})]},v.id))})]}),e.jsx(hr,{open:c,onOpenChange:d,groupId:t,athletes:n,existingMemberIds:f,onAdded:l}),e.jsx(xs,{open:i,onOpenChange:h,athletes:n,parentGroupId:t,parentMembers:P,onCreated:l}),e.jsx(Pe,{open:!!u,onOpenChange:v=>{v||g(null)},children:e.jsxs(Ee,{children:[e.jsxs(Re,{children:[e.jsx(Fe,{children:"Retirer du groupe"}),e.jsxs(Te,{children:["Voulez-vous retirer ",u?.name," de ce groupe ?",m.subgroups.length>0?" Le nageur sera aussi retiré des sous-groupes.":""]})]}),e.jsxs($e,{children:[e.jsx(Oe,{children:"Annuler"}),e.jsx(Ie,{onClick:()=>{u&&(p.mutate(u.userId),g(null))},className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Retirer"})]})]})})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs(K,{variant:"ghost",size:"sm",className:"-ml-2",onClick:s,children:[e.jsx(Qe,{className:"mr-2 h-4 w-4"}),"Retour aux groupes"]}),e.jsx("p",{className:"text-sm text-muted-foreground text-center py-8",children:"Groupe introuvable."})]})},kt=({group:t,onManage:n,onDeactivate:s,onReactivate:o,onDelete:a})=>{const c=new Date(t.created_at).toLocaleDateString("fr-FR",{day:"numeric",month:"short",year:"numeric"});return e.jsxs("div",{className:"rounded-xl border bg-card p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-sm font-bold truncate",children:t.name}),e.jsxs("div",{className:"flex items-center gap-2 mt-1 flex-wrap",children:[e.jsxs("span",{className:"text-xs text-muted-foreground",children:[t.member_count," membre",t.member_count!==1?"s":""]}),t.subgroup_count>0&&e.jsxs("span",{className:"text-xs text-muted-foreground",children:[t.subgroup_count," sous-groupe",t.subgroup_count!==1?"s":""]}),e.jsx("span",{className:"text-xs text-muted-foreground",children:c})]})]}),e.jsx(te,{variant:t.is_active?"default":"secondary",children:t.is_active?"Actif":"Terminé"})]}),e.jsx("div",{className:"flex items-center gap-2 flex-wrap",children:t.is_active?e.jsxs(e.Fragment,{children:[e.jsxs(K,{size:"sm",variant:"outline",onClick:()=>n(t.id),children:[e.jsx(Cs,{className:"mr-1.5 h-3.5 w-3.5"}),"Gérer"]}),e.jsxs(K,{size:"sm",variant:"outline",onClick:()=>s(t.id),children:[e.jsx(Ls,{className:"mr-1.5 h-3.5 w-3.5"}),"Terminer"]})]}):e.jsxs(e.Fragment,{children:[e.jsxs(K,{size:"sm",variant:"outline",onClick:()=>o(t.id),children:[e.jsx(Ss,{className:"mr-1.5 h-3.5 w-3.5"}),"Réactiver"]}),e.jsxs(K,{size:"sm",variant:"outline",className:"text-destructive hover:text-destructive",onClick:()=>a(t.id),children:[e.jsx(It,{className:"mr-1.5 h-3.5 w-3.5"}),"Supprimer"]})]})})]})},gr=({onBack:t,athletes:n,athletesLoading:s})=>{const{toast:o}=se(),a=qe(),[c,d]=r.useState("list"),[i,h]=r.useState(null),[u,g]=r.useState(!1),[m,j]=r.useState(null),[p,l]=r.useState(null),{data:f=[],isLoading:P}=U({queryKey:["temp-groups"],queryFn:()=>I.getTemporaryGroups()}),v=r.useMemo(()=>f.filter(D=>D.is_active),[f]),N=r.useMemo(()=>f.filter(D=>!D.is_active),[f]),q=X({mutationFn:D=>I.deactivateTemporaryGroup(D),onSuccess:()=>{o({title:"Groupe terminé"}),a.invalidateQueries({queryKey:["temp-groups"]})},onError:D=>{o({title:"Erreur",description:D.message,variant:"destructive"})}}),$=X({mutationFn:D=>I.reactivateTemporaryGroup(D),onSuccess:()=>{o({title:"Groupe réactivé"}),a.invalidateQueries({queryKey:["temp-groups"]})},onError:D=>{o({title:"Erreur",description:D.message,variant:"destructive"})}}),S=X({mutationFn:D=>I.deleteTemporaryGroup(D),onSuccess:()=>{o({title:"Groupe supprimé"}),a.invalidateQueries({queryKey:["temp-groups"]})},onError:D=>{o({title:"Erreur",description:D.message,variant:"destructive"})}}),w=D=>{h(D),d("detail")},E=()=>{h(null),d("list"),a.invalidateQueries({queryKey:["temp-groups"]})};return c==="detail"&&i!=null?e.jsx(xr,{groupId:i,athletes:n,onBack:E}):e.jsxs("div",{className:"space-y-6 pb-24",children:[e.jsx(ce,{title:"Groupes temporaires",description:"Créez et gérez des groupes pour les stages, compétitions ou événements.",onBack:t,actions:e.jsxs(K,{size:"sm",onClick:()=>g(!0),children:[e.jsx(he,{className:"mr-1.5 h-3.5 w-3.5"}),"Créer un groupe"]})}),P||s?e.jsx("div",{className:"space-y-2",children:[1,2,3].map(D=>e.jsx("div",{className:"rounded-xl border p-4 animate-pulse motion-reduce:animate-none",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-4 w-40 rounded bg-muted"}),e.jsx("div",{className:"ml-auto h-6 w-16 rounded bg-muted"})]})},D))}):f.length===0?e.jsxs("div",{className:"text-center py-12 space-y-3",children:[e.jsx(ye,{className:"h-10 w-10 text-muted-foreground mx-auto"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Aucun groupe temporaire pour le moment."}),e.jsxs(K,{variant:"outline",size:"sm",onClick:()=>g(!0),children:[e.jsx(he,{className:"mr-1.5 h-3.5 w-3.5"}),"Créer le premier groupe"]})]}):e.jsxs(e.Fragment,{children:[v.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h3",{className:"text-xs font-semibold uppercase tracking-[0.15em] text-muted-foreground",children:["Actifs (",v.length,")"]}),v.map(D=>e.jsx(kt,{group:D,onManage:w,onDeactivate:y=>j(y),onReactivate:y=>$.mutate(y),onDelete:y=>l(y)},D.id))]}),N.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h3",{className:"text-xs font-semibold uppercase tracking-[0.15em] text-muted-foreground",children:["Terminés (",N.length,")"]}),N.map(D=>e.jsx(kt,{group:D,onManage:w,onDeactivate:y=>j(y),onReactivate:y=>$.mutate(y),onDelete:y=>l(y)},D.id))]})]}),e.jsx(xs,{open:u,onOpenChange:g,athletes:n,onCreated:()=>{a.invalidateQueries({queryKey:["temp-groups"]})}}),e.jsx(Pe,{open:m!=null,onOpenChange:D=>{D||j(null)},children:e.jsxs(Ee,{children:[e.jsxs(Re,{children:[e.jsx(Fe,{children:"Terminer le groupe"}),e.jsx(Te,{children:"Voulez-vous marquer ce groupe comme terminé ? Les sous-groupes seront aussi désactivés. Vous pourrez le réactiver plus tard si nécessaire."})]}),e.jsxs($e,{children:[e.jsx(Oe,{children:"Annuler"}),e.jsx(Ie,{onClick:()=>{m!=null&&(q.mutate(m),j(null))},children:"Terminer"})]})]})}),e.jsx(Pe,{open:p!=null,onOpenChange:D=>{D||l(null)},children:e.jsxs(Ee,{children:[e.jsxs(Re,{children:[e.jsx(Fe,{children:"Supprimer le groupe"}),e.jsx(Te,{children:"Cette action est irréversible. Le groupe et tous ses sous-groupes seront supprimés définitivement."})]}),e.jsxs($e,{children:[e.jsx(Oe,{children:"Annuler"}),e.jsx(Ie,{onClick:()=>{p!=null&&(S.mutate(p),l(null))},className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Supprimer"})]})]})})]})};function tt(t){return new Date(t+"T00:00:00").toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric"})}function fr(t){const n=new Date;n.setHours(0,0,0,0);const s=new Date(t+"T00:00:00");return Math.ceil((s.getTime()-n.getTime())/(1e3*60*60*24))}const vr=({open:t,onOpenChange:n,competition:s})=>{const{toast:o}=se(),a=qe(),c=!!s,[d,i]=r.useState(""),[h,u]=r.useState(""),[g,m]=r.useState(""),[j,p]=r.useState(!0),[l,f]=r.useState(""),[P,v]=r.useState(""),[N,q]=r.useState(!1),[$,S]=r.useState(new Set),{data:w=[]}=U({queryKey:["athletes"],queryFn:()=>I.getAthletes()}),{data:E=[]}=U({queryKey:["groups"],queryFn:()=>I.getGroups()}),{data:D}=U({queryKey:["competition-assignments",s?.id],queryFn:()=>I.getCompetitionAssignments(s.id),enabled:!!s?.id});r.useEffect(()=>{t&&(s?(i(s.name),u(s.date),m(s.end_date??""),p(!!s.end_date),f(s.location??""),v(s.description??""),D&&S(new Set(D.map(_=>_.athlete_id)))):(i(""),u(""),m(""),p(!0),f(""),v(""),S(new Set)))},[t,s,D]);const y=X({mutationFn:_=>I.createCompetition(_),onSuccess:async _=>{if($.size>0)try{await I.setCompetitionAssignments(_.id,Array.from($))}catch(b){console.warn("[EAC] Failed to save competition assignments:",b)}o({title:"Competition creee"}),a.invalidateQueries({queryKey:["competitions"]}),a.invalidateQueries({queryKey:["competition-assignments"]}),n(!1)},onError:_=>{o({title:"Erreur",description:_.message,variant:"destructive"})}}),R=X({mutationFn:_=>I.updateCompetition(s.id,_),onSuccess:async()=>{try{await I.setCompetitionAssignments(s.id,Array.from($))}catch(_){console.warn("[EAC] Failed to save competition assignments:",_)}o({title:"Competition mise a jour"}),a.invalidateQueries({queryKey:["competitions"]}),a.invalidateQueries({queryKey:["competition-assignments"]}),n(!1)},onError:_=>{o({title:"Erreur",description:_.message,variant:"destructive"})}}),O=X({mutationFn:()=>I.deleteCompetition(s.id),onSuccess:()=>{o({title:"Competition supprimee"}),a.invalidateQueries({queryKey:["competitions"]}),n(!1)},onError:_=>{o({title:"Erreur",description:_.message,variant:"destructive"})}}),B=()=>{if(!d.trim()){o({title:"Nom requis",description:"Veuillez saisir un nom pour la competition.",variant:"destructive"});return}if(!h){o({title:"Date requise",description:"Veuillez saisir une date.",variant:"destructive"});return}const _={name:d.trim(),date:h,end_date:j&&g?g:null,location:l.trim()||null,description:P.trim()||null};c?R.mutate(_):y.mutate(_)},F=y.isPending||R.isPending||O.isPending;return e.jsxs(e.Fragment,{children:[e.jsx(ze,{open:t,onOpenChange:n,children:e.jsxs(Le,{side:"right",className:"w-full sm:max-w-md overflow-y-auto",children:[e.jsx(Ke,{children:e.jsx(Ge,{children:c?"Modifier la competition":"Nouvelle competition"})}),e.jsxs("div",{className:"mt-6 space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(Q,{htmlFor:"comp-name",children:"Nom *"}),e.jsx(je,{id:"comp-name",placeholder:"Ex : Championnats Regionaux",value:d,onChange:_=>i(_.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Q,{htmlFor:"comp-date",children:"Date *"}),e.jsx("input",{id:"comp-date",type:"date",value:h,onChange:_=>u(_.target.value),className:"flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(Q,{htmlFor:"comp-multiday",children:"Multi-jours"}),e.jsx(Ys,{id:"comp-multiday",checked:j,onCheckedChange:p})]}),j&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(Q,{htmlFor:"comp-end-date",children:"Date de fin"}),e.jsx("input",{id:"comp-end-date",type:"date",value:g,onChange:_=>m(_.target.value),min:h||void 0,className:"flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Q,{htmlFor:"comp-location",children:"Lieu"}),e.jsx(je,{id:"comp-location",placeholder:"Ex : Piscine de Strasbourg",value:l,onChange:_=>f(_.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Q,{htmlFor:"comp-description",children:"Description"}),e.jsx(ut,{id:"comp-description",placeholder:"Notes, informations complementaires...",value:P,onChange:_=>v(_.target.value),rows:3})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ye,{className:"h-4 w-4 text-muted-foreground"}),e.jsx(Q,{children:"Nageurs assignes"})]}),e.jsxs(re,{value:"",onValueChange:_=>{const b=w.filter(T=>T.group_id===Number(_));S(T=>{const z=new Set(T);return b.forEach(G=>{G.id!=null&&z.add(G.id)}),z})},children:[e.jsx(ae,{children:e.jsx(oe,{placeholder:"Ajouter un groupe..."})}),e.jsx(ie,{children:E.filter(_=>!_.is_temporary).map(_=>e.jsx(J,{value:String(_.id),children:_.name},_.id))})]}),e.jsx("div",{className:"max-h-48 overflow-y-auto rounded-md border p-2 space-y-1",children:w.map(_=>{if(_.id==null)return null;const b=$.has(_.id);return e.jsxs("label",{className:"flex items-center gap-2 py-1 px-1 rounded hover:bg-muted/50 cursor-pointer",children:[e.jsx(qt,{checked:b,onCheckedChange:T=>{S(z=>{const G=new Set(z);return T?G.add(_.id):G.delete(_.id),G})}}),e.jsx("span",{className:"text-sm",children:_.display_name}),_.group_label&&e.jsx("span",{className:"text-xs text-muted-foreground ml-auto",children:_.group_label})]},_.id)})}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[$.size," nageur",$.size>1?"s":""," assigne",$.size>1?"s":""]})]}),e.jsxs("div",{className:"space-y-2 pt-2",children:[e.jsx(K,{className:"w-full",onClick:B,disabled:F||!d.trim()||!h,children:F?"Enregistrement...":c?"Enregistrer":"Creer"}),c&&e.jsx(K,{variant:"outline",className:"w-full text-destructive hover:text-destructive",onClick:()=>q(!0),disabled:F,children:"Supprimer cette competition"})]})]})]})}),e.jsx(Pe,{open:N,onOpenChange:q,children:e.jsxs(Ee,{children:[e.jsxs(Re,{children:[e.jsx(Fe,{children:"Supprimer la competition"}),e.jsxs(Te,{children:["Cette action est irreversible. La competition «"," ",s?.name," » sera supprimee definitivement."]})]}),e.jsxs($e,{children:[e.jsx(Oe,{children:"Annuler"}),e.jsx(Ie,{onClick:()=>{O.mutate(),q(!1)},className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Supprimer"})]})]})})]})},_t=({competition:t,onEdit:n,onSendSms:s})=>{const{data:o=[]}=U({queryKey:["competition-assignments",t.id],queryFn:()=>I.getCompetitionAssignments(t.id)}),a=fr(t.date),c=a<0,d=a>=0,i=t.end_date?`du ${tt(t.date)} au ${tt(t.end_date)}`:tt(t.date);return e.jsxs("button",{type:"button",className:`w-full text-left rounded-xl border bg-card p-3 space-y-1 transition-colors hover:bg-muted/50 ${c?"opacity-60":""}`,onClick:()=>n(t),children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-sm font-semibold truncate",children:t.name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:i})]}),e.jsxs("div",{className:"flex items-center gap-1.5 shrink-0",children:[d&&e.jsxs(te,{variant:"outline",className:"border-orange-300 text-orange-600 dark:text-orange-400 text-[10px] px-1.5 py-0",children:["J-",a]}),c&&e.jsx(te,{variant:"secondary",className:"text-[10px] px-1.5 py-0",children:"Passee"})]})]}),t.location&&e.jsxs("div",{className:"flex items-center gap-1 text-xs text-muted-foreground",children:[e.jsx(Js,{className:"h-3 w-3 shrink-0"}),e.jsx("span",{className:"truncate",children:t.location})]}),o.length>0&&e.jsxs("div",{className:"flex items-center gap-1 text-xs text-muted-foreground",children:[e.jsx(ye,{className:"h-3 w-3 shrink-0"}),e.jsxs("span",{children:[o.length," nageur",o.length>1?"s":""]})]}),o.length>0&&s&&e.jsxs("button",{type:"button",className:"flex items-center gap-1 text-xs text-primary hover:underline",onClick:h=>{h.stopPropagation(),s(t,o)},children:[e.jsx(mt,{className:"h-3 w-3"}),"SMS"]})]})},jr=({onBack:t})=>{const{toast:n}=se(),[s,o]=r.useState(!1),[a,c]=r.useState(null),{data:d=[],isLoading:i}=U({queryKey:["competitions"],queryFn:()=>I.getCompetitions()}),{data:h}=U({queryKey:["athlete-phones"],queryFn:async()=>{const{data:v}=await ct.from("user_profiles").select("user_id, phone").not("phone","is",null);return new Map((v??[]).map(N=>[N.user_id,N.phone]))}}),[u,g]=r.useState(!1),{upcoming:m,past:j}=r.useMemo(()=>{const v=new Date;v.setHours(0,0,0,0);const N=v.getTime(),q=[],$=[];for(const S of d)new Date(S.date+"T00:00:00").getTime()>=N?q.push(S):$.push(S);return q.sort((S,w)=>new Date(S.date+"T00:00:00").getTime()-new Date(w.date+"T00:00:00").getTime()),$.sort((S,w)=>new Date(w.date+"T00:00:00").getTime()-new Date(S.date+"T00:00:00").getTime()),{upcoming:q,past:$}},[d]),p=()=>{c(null),o(!0)},l=v=>{c(v),o(!0)},f=(v,N)=>{if(!h)return;const q=N.map(S=>h.get(S.athlete_id)).filter(S=>!!S&&S.trim().length>0);if(q.length===0){n({title:"Aucun numero",description:"Aucun nageur assigne n'a renseigne de numero de telephone.",variant:"destructive"});return}if(/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)){const S=encodeURIComponent(`[${v.name}] `);/iPhone|iPad|iPod/i.test(navigator.userAgent)?window.location.href=`sms:/open?addresses=${q.join(",")}&body=${S}`:window.location.href=`sms:${q.join(",")}?body=${S}`}else navigator.clipboard.writeText(q.join(", ")).then(()=>{n({title:"Numeros copies",description:`${q.length} numero${q.length>1?"s":""} copie${q.length>1?"s":""} dans le presse-papiers. Utilisez votre telephone pour envoyer le SMS.`})}).catch(()=>{n({title:"Erreur",description:"Impossible de copier les numéros.",variant:"destructive"})})},P=d.length===0?"Gerez les competitions du club.":`${d.length} competition${d.length>1?"s":""}`;return e.jsxs("div",{className:"space-y-6 pb-24",children:[e.jsx(ce,{title:"Competitions",description:P,onBack:t,actions:e.jsxs(K,{variant:"outline",size:"sm",onClick:p,children:[e.jsx(he,{className:"mr-1.5 h-3.5 w-3.5"}),"Ajouter"]})}),i?e.jsx("div",{className:"space-y-2",children:[1,2,3].map(v=>e.jsx("div",{className:"rounded-xl border p-3 animate-pulse motion-reduce:animate-none",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-4 w-40 rounded bg-muted"}),e.jsx("div",{className:"ml-auto h-5 w-12 rounded bg-muted"})]})},v))}):d.length===0?e.jsxs("div",{className:"text-center py-12 space-y-3",children:[e.jsx(st,{className:"h-10 w-10 text-muted-foreground mx-auto"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Aucune competition creee."}),e.jsxs(K,{variant:"outline",size:"sm",onClick:p,children:[e.jsx(he,{className:"mr-1.5 h-3.5 w-3.5"}),"Creer la premiere competition"]})]}):e.jsxs("div",{className:"space-y-2",children:[m.map(v=>e.jsx(_t,{competition:v,onEdit:l,onSendSms:f},v.id)),j.length>0&&e.jsxs("div",{className:"rounded-xl border bg-card",children:[e.jsxs("button",{type:"button",className:"w-full flex items-center justify-between px-3 py-2.5 text-left hover:bg-muted/50 rounded-xl transition-colors",onClick:()=>g(v=>!v),children:[e.jsxs("span",{className:"text-xs font-medium text-muted-foreground",children:["Passees (",j.length,")"]}),e.jsx(zt,{className:`h-3.5 w-3.5 text-muted-foreground transition-transform ${u?"rotate-180":""}`})]}),u&&e.jsx("div",{className:"px-2 pb-2 space-y-1.5",children:j.map(v=>e.jsx(_t,{competition:v,onEdit:l,onSendSms:f},v.id))})]})]}),e.jsx(vr,{open:s,onOpenChange:o,competition:a})]})};async function br(t){const{data:n,error:s}=await ct.rpc("get_auth_uid_for_user",{p_user_id:t});return s?(console.error("[objectives] Failed to resolve auth UUID:",s.message),null):n}const yr=({open:t,onOpenChange:n,objective:s,athleteName:o,athleteAuthId:a,competitions:c})=>{const{toast:d}=se(),i=qe(),h=!!s,[u,g]=r.useState("chrono"),[m,j]=r.useState(""),[p,l]=r.useState("25"),[f,P]=r.useState(""),[v,N]=r.useState(""),[q,$]=r.useState(""),[S,w]=r.useState(!1);r.useEffect(()=>{if(t)if(s){const b=!!s.event_code,T=!!s.text;g(b&&T?"both":T?"texte":"chrono"),j(s.event_code??""),l(String(s.pool_length??25)),P(s.target_time_seconds!=null?Ot(s.target_time_seconds):""),N(s.text??""),$(s.competition_id??"")}else g("chrono"),j(""),l("25"),P(""),N(""),$("")},[t,s]);const E=X({mutationFn:b=>I.createObjective(b),onSuccess:()=>{d({title:"Objectif cree"}),i.invalidateQueries({queryKey:["objectives"]}),n(!1)},onError:b=>{d({title:"Erreur",description:b.message,variant:"destructive"})}}),D=X({mutationFn:b=>I.updateObjective(s.id,b),onSuccess:()=>{d({title:"Objectif mis a jour"}),i.invalidateQueries({queryKey:["objectives"]}),n(!1)},onError:b=>{d({title:"Erreur",description:b.message,variant:"destructive"})}}),y=X({mutationFn:()=>I.deleteObjective(s.id),onSuccess:()=>{d({title:"Objectif supprime"}),i.invalidateQueries({queryKey:["objectives"]}),n(!1)},onError:b=>{d({title:"Erreur",description:b.message,variant:"destructive"})}}),R=u==="chrono"||u==="both",O=u==="texte"||u==="both",B=()=>{if(R&&!m){d({title:"Epreuve requise",description:"Veuillez selectionner une epreuve.",variant:"destructive"});return}if(R&&f&&jt(f)===null){d({title:"Format invalide",description:"Le temps doit être au format m:ss:cc (ex: 1:05:30)",variant:"destructive"});return}if(O&&!v.trim()){d({title:"Texte requis",description:"Veuillez saisir un objectif texte.",variant:"destructive"});return}const b={athlete_id:a,competition_id:q&&q!=="none"?q:null,event_code:R?m:null,pool_length:R?Number(p):null,target_time_seconds:R&&f?jt(f):null,text:O?v.trim():null};h?D.mutate(b):E.mutate(b)},F=E.isPending||D.isPending||y.isPending,_=r.useMemo(()=>{const b=new Date;return b.setHours(0,0,0,0),c.filter(T=>new Date(T.date+"T00:00:00").getTime()>=b.getTime())},[c]);return e.jsxs(e.Fragment,{children:[e.jsx(ze,{open:t,onOpenChange:n,children:e.jsxs(Le,{side:"right",className:"w-full sm:max-w-md overflow-y-auto",children:[e.jsx(Ke,{children:e.jsx(Ge,{children:h?"Modifier l'objectif":"Nouvel objectif"})}),e.jsxs("div",{className:"mt-6 space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(Q,{children:"Nageur"}),e.jsx("p",{className:"text-sm font-medium",children:o})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Q,{children:"Type d'objectif"}),e.jsxs(dt,{type:"single",variant:"outline",value:u,onValueChange:b=>{b&&g(b)},className:"justify-start",children:[e.jsx(de,{value:"chrono",className:"text-xs",children:"Chrono"}),e.jsx(de,{value:"texte",className:"text-xs",children:"Texte"}),e.jsx(de,{value:"both",className:"text-xs",children:"Les deux"})]})]}),R&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(Q,{children:"Epreuve *"}),e.jsxs(re,{value:m,onValueChange:j,children:[e.jsx(ae,{children:e.jsx(oe,{placeholder:"Choisir une epreuve"})}),e.jsx(ie,{children:As.map(b=>e.jsx(J,{value:b,children:$t(b)},b))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Q,{children:"Bassin"}),e.jsxs(re,{value:p,onValueChange:l,children:[e.jsx(ae,{children:e.jsx(oe,{})}),e.jsxs(ie,{children:[e.jsx(J,{value:"25",children:"25m"}),e.jsx(J,{value:"50",children:"50m"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Q,{children:"Temps cible (min:sec:centièmes)"}),e.jsx(je,{placeholder:"Ex : 1:05:30",value:f,onChange:b=>P(b.target.value)})]})]}),O&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(Q,{children:"Objectif texte *"}),e.jsx(ut,{placeholder:"Ex : Ameliorer la coulée de dos",value:v,onChange:b=>N(b.target.value),rows:3})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Q,{children:"Lier a une competition"}),e.jsxs(re,{value:q,onValueChange:$,children:[e.jsx(ae,{children:e.jsx(oe,{placeholder:"Aucune"})}),e.jsxs(ie,{children:[e.jsx(J,{value:"none",children:"Aucune"}),_.map(b=>e.jsxs(J,{value:b.id,children:[b.name," (",b.date,")"]},b.id))]})]})]}),e.jsxs("div",{className:"space-y-2 pt-2",children:[e.jsx(K,{className:"w-full",onClick:B,disabled:F,children:F?"Enregistrement...":h?"Enregistrer":"Creer"}),h&&e.jsx(K,{variant:"outline",className:"w-full text-destructive hover:text-destructive",onClick:()=>w(!0),disabled:F,children:"Supprimer cet objectif"})]})]})]})}),e.jsx(Pe,{open:S,onOpenChange:w,children:e.jsxs(Ee,{children:[e.jsxs(Re,{children:[e.jsx(Fe,{children:"Supprimer l'objectif"}),e.jsx(Te,{children:"Cette action est irreversible. L'objectif sera supprime definitivement."})]}),e.jsxs($e,{children:[e.jsx(Oe,{children:"Annuler"}),e.jsx(Ie,{onClick:()=>{y.mutate(),w(!1)},className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Supprimer"})]})]})})]})},Nr=({objective:t,onEdit:n})=>{const s=!!t.event_code,o=!!t.text;return e.jsxs("button",{type:"button",className:"w-full text-left rounded-xl border bg-card p-3 space-y-1.5 transition-colors hover:bg-muted/50",onClick:()=>n(t),children:[s&&e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"text-sm font-semibold",children:$t(t.event_code)}),t.pool_length&&e.jsxs(te,{variant:"secondary",className:"text-[10px] px-1.5 py-0",children:[t.pool_length,"m"]}),t.target_time_seconds!=null&&e.jsx(te,{variant:"outline",className:"text-[10px] px-1.5 py-0 font-mono",children:Ot(t.target_time_seconds)})]}),o&&e.jsx("p",{className:"text-sm text-muted-foreground line-clamp-2",children:t.text}),t.competition_name&&e.jsx(te,{variant:"outline",className:"border-orange-300 text-orange-600 dark:text-orange-400 text-[10px] px-1.5 py-0",children:t.competition_name})]})},wr=({onBack:t,athletes:n,athletesLoading:s})=>{const{toast:o}=se(),[a,c]=r.useState(""),[d,i]=r.useState(!1),[h,u]=r.useState(null),g=r.useMemo(()=>a?n.find(S=>S.id!=null&&String(S.id)===a)??null:null,[n,a]),{data:m,isLoading:j}=U({queryKey:["auth-uid",a],queryFn:()=>br(Number(a)),enabled:!!a}),{data:p=[]}=U({queryKey:["competitions"],queryFn:()=>I.getCompetitions()}),{data:l=[],isLoading:f}=U({queryKey:["objectives",m],queryFn:()=>I.getObjectives(m),enabled:!!m}),P=r.useMemo(()=>{const S=n.filter(E=>E.id!=null),w=new Map;for(const E of S){const D=E.group_label||"Sans groupe";w.has(D)||w.set(D,[]),w.get(D).push(E)}return[...w.entries()].sort(([E],[D])=>E.localeCompare(D,"fr"))},[n]),v=()=>{if(!m){o({title:"Nageur requis",description:"Veuillez selectionner un nageur.",variant:"destructive"});return}u(null),i(!0)},N=S=>{u(S),i(!0)},q=s||!!a&&j,$=!!m&&!j;return e.jsxs("div",{className:"space-y-6 pb-24",children:[e.jsx(ce,{title:"Objectifs",description:"Definissez des objectifs chrono ou texte pour chaque nageur.",onBack:t,actions:e.jsxs(K,{variant:"outline",size:"sm",onClick:v,disabled:!m,children:[e.jsx(he,{className:"mr-1.5 h-3.5 w-3.5"}),"Ajouter"]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Q,{children:"Nageur"}),e.jsxs(re,{value:a,onValueChange:c,children:[e.jsx(ae,{children:e.jsx(oe,{placeholder:"Selectionner un nageur"})}),e.jsx(ie,{children:P.map(([S,w])=>e.jsxs("div",{children:[e.jsx("div",{className:"px-2 py-1.5 text-xs font-semibold uppercase tracking-wider text-muted-foreground",children:S}),w.map(E=>e.jsx(J,{value:String(E.id),children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:E.display_name}),E.group_label&&e.jsx(te,{variant:"secondary",className:"text-[10px] px-1.5 py-0",children:E.group_label})]})},E.id))]},S))})]})]}),!a&&e.jsxs("div",{className:"text-center py-12 space-y-3",children:[e.jsx(nt,{className:"h-10 w-10 text-muted-foreground mx-auto"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Selectionnez un nageur pour voir et gerer ses objectifs."})]}),q&&a&&e.jsx("div",{className:"space-y-2",children:[1,2,3].map(S=>e.jsx("div",{className:"rounded-xl border p-3 animate-pulse motion-reduce:animate-none",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-4 w-40 rounded bg-muted"}),e.jsx("div",{className:"ml-auto h-5 w-12 rounded bg-muted"})]})},S))}),$&&f&&e.jsx("div",{className:"space-y-2",children:[1,2].map(S=>e.jsx("div",{className:"rounded-xl border p-3 animate-pulse motion-reduce:animate-none",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-4 w-32 rounded bg-muted"}),e.jsx("div",{className:"ml-auto h-5 w-16 rounded bg-muted"})]})},S))}),$&&!f&&l.length===0&&e.jsxs("div",{className:"text-center py-12 space-y-3",children:[e.jsx(nt,{className:"h-10 w-10 text-muted-foreground mx-auto"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Aucun objectif defini pour ",g?.display_name,"."]}),e.jsxs(K,{variant:"outline",size:"sm",onClick:v,children:[e.jsx(he,{className:"mr-1.5 h-3.5 w-3.5"}),"Creer le premier objectif"]})]}),$&&!f&&l.length>0&&e.jsx("div",{className:"space-y-2",children:l.map(S=>e.jsx(Nr,{objective:S,onEdit:N},S.id))}),m&&g&&e.jsx(yr,{open:d,onOpenChange:i,objective:h,athleteName:g.display_name,athleteAuthId:m,competitions:p})]})},Cr=r.lazy(()=>Tt(()=>import("./StrengthCatalog-IOzSmYyP.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44]))),Sr=r.lazy(()=>Tt(()=>import("./SwimCatalog-BkFAVMfY.js"),__vite__mapDeps([45,1,2,3,4,5,6,7,19,20,10,12,22,17,46,47,14,48,49,13,50,24,16,25,26,9,8,15,27,28,29,30,18,11,38,32,51,52,34]))),kr=({onNavigate:t,onOpenRecordsAdmin:n,onOpenRecordsClub:s,athletes:o,athletesLoading:a,upcomingBirthdays:c,birthdaysLoading:d,kpiLoading:i,kpiPeriod:h,onKpiPeriodChange:u,fatigueAlerts:g,mostLoadedAthlete:m,swimSessionCount:j,strengthSessionCount:p})=>{const l=new Date().getHours(),f=l<12?"Bonjour":l<18?"Bon après-midi":"Bonsoir",P=new Date().toLocaleDateString("fr-FR",{weekday:"long",day:"numeric",month:"long"}),v=g.length>0;return e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-display font-bold uppercase italic",children:[f,", ",e.jsx("span",{className:"text-primary",children:"Coach"})]}),e.jsx("p",{className:"text-sm text-muted-foreground capitalize",children:P})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h2",{className:"text-xs font-semibold uppercase tracking-[0.15em] text-muted-foreground",children:["Signaux · ",h,"j"]}),e.jsxs(dt,{type:"single",size:"sm",variant:"outline",value:String(h),onValueChange:N=>{N&&u(Number(N))},children:[e.jsx(de,{value:"7",className:"h-7 px-2 text-xs","aria-label":"7 jours",children:"7j"}),e.jsx(de,{value:"30",className:"h-7 px-2 text-xs","aria-label":"30 jours",children:"30j"}),e.jsx(de,{value:"365",className:"h-7 px-2 text-xs","aria-label":"1 an",children:"1an"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:`rounded-xl border p-3 ${v?"border-destructive/30 bg-destructive/5":"bg-muted/30"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-[11px] text-muted-foreground",children:"Fatigue 5/5"}),e.jsx(nn,{className:`h-3.5 w-3.5 ${v?"text-destructive":"text-muted-foreground"}`})]}),e.jsx("p",{className:"text-xl font-bold tabular-nums",children:i?"–":g.length}),e.jsx("p",{className:"text-[11px] text-muted-foreground truncate",children:i?"Chargement…":v?g.slice(0,2).map(N=>N.athleteName.split(" ")[0]).join(", "):"Aucune alerte"})]}),e.jsxs("div",{className:"rounded-xl border bg-muted/30 p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-[11px] text-muted-foreground",children:"Plus chargé"}),e.jsx(ye,{className:"h-3.5 w-3.5 text-muted-foreground"})]}),e.jsx("p",{className:"text-xl font-bold truncate",children:i?"–":m?.athleteName?.split(" ")[0]??"–"}),e.jsx("p",{className:"text-[11px] text-muted-foreground",children:i?"Calcul…":m?`Charge ${Math.round(m.loadScore)}`:"Pas de données"})]})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs("button",{type:"button",onClick:()=>t("calendar"),className:"flex items-center gap-1.5 rounded-full bg-primary text-primary-foreground px-3.5 py-2 text-sm font-semibold active:opacity-80 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",children:[e.jsx(rt,{className:"h-3.5 w-3.5"}),"Assigner"]}),e.jsxs("button",{type:"button",onClick:()=>t("messaging"),className:"flex items-center gap-1.5 rounded-full border px-3.5 py-2 text-sm font-semibold active:bg-muted focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",children:[e.jsx(Kt,{className:"h-3.5 w-3.5"}),"Email"]}),e.jsxs("button",{type:"button",onClick:()=>t("sms"),className:"flex items-center gap-1.5 rounded-full border px-3.5 py-2 text-sm font-semibold active:bg-muted focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",children:[e.jsx(mt,{className:"h-3.5 w-3.5"}),"SMS"]}),e.jsxs("button",{type:"button",onClick:()=>t("groups"),className:"flex items-center gap-1.5 rounded-full border px-3.5 py-2 text-sm font-semibold active:bg-muted focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",children:[e.jsx(Gt,{className:"h-3.5 w-3.5"}),"Groupes"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("button",{type:"button",onClick:()=>t("swim"),className:"rounded-xl border bg-card p-4 text-left shadow-sm active:bg-muted/50 transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",children:[e.jsx(Rt,{className:"h-5 w-5 text-primary mb-2"}),e.jsx("p",{className:"text-sm font-bold",children:"Natation"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:j!=null?`${j} séance${j!==1?"s":""}`:"Bibliothèque"})]}),e.jsxs("button",{type:"button",onClick:()=>t("strength"),className:"rounded-xl border bg-card p-4 text-left shadow-sm active:bg-muted/50 transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",children:[e.jsx(Ft,{className:"h-5 w-5 text-primary mb-2"}),e.jsx("p",{className:"text-sm font-bold",children:"Musculation"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:p!=null?`${p} séance${p!==1?"s":""}`:"Bibliothèque"})]}),e.jsxs("button",{type:"button",onClick:()=>t("swimmers"),className:"rounded-xl border bg-card p-4 text-left shadow-sm active:bg-muted/50 transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",children:[e.jsx(ye,{className:"h-5 w-5 text-primary mb-2"}),e.jsx("p",{className:"text-sm font-bold",children:"Nageurs"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:a?"Chargement…":`${o.length} nageur${o.length!==1?"s":""}`})]}),e.jsxs("button",{type:"button",onClick:n,className:"rounded-xl border bg-card p-4 text-left shadow-sm active:bg-muted/50 transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",children:[e.jsx(st,{className:"h-5 w-5 text-primary mb-2"}),e.jsx("p",{className:"text-sm font-bold",children:"Records club"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Import & administration"})]}),e.jsxs("button",{type:"button",onClick:()=>t("competitions"),className:"rounded-xl border bg-card p-4 text-left shadow-sm active:bg-muted/50 transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",children:[e.jsx(st,{className:"h-5 w-5 text-amber-500 mb-2"}),e.jsx("p",{className:"text-sm font-bold",children:"Compétitions"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Échéances & calendrier"})]}),e.jsxs("button",{type:"button",onClick:()=>t("objectives"),className:"rounded-xl border bg-card p-4 text-left shadow-sm active:bg-muted/50 transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",children:[e.jsx(nt,{className:"h-5 w-5 text-primary mb-2"}),e.jsx("p",{className:"text-sm font-bold",children:"Objectifs"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Temps cibles & objectifs"})]})]}),e.jsx("button",{type:"button",onClick:s,className:"w-full text-center text-sm text-primary font-semibold py-1 active:opacity-70 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring rounded",children:"Voir les records du club"}),!d&&c&&c.length>0?e.jsxs("div",{className:"space-y-2",children:[e.jsx("h2",{className:"text-xs font-semibold uppercase tracking-[0.15em] text-muted-foreground",children:"Anniversaires"}),e.jsx("div",{className:"space-y-1.5",children:c.slice(0,3).map(N=>e.jsxs("div",{className:"flex items-center justify-between gap-2 rounded-lg border px-3 py-2",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("span",{className:"text-sm font-medium truncate block",children:N.display_name}),e.jsx("span",{className:"text-[11px] text-muted-foreground",children:_r(N.next_birthday)})]}),e.jsxs("span",{className:"text-xs font-bold text-primary shrink-0",children:["J-",N.days_until]})]},N.id))})]}):null]})},_r=t=>{if(!t)return"-";const n=new Date(t);return Number.isNaN(n.getTime())?t:n.toLocaleDateString("fr-FR")},At=t=>t.toISOString().split("T")[0],Ar=t=>new Date(t.completed_at||t.started_at||t.date||t.created_at||0).getTime(),Mr=t=>{if(!t.length)return null;const n=t.reduce((o,a)=>o+a,0)/t.length,s=Math.min(5,Math.max(1,Math.round(n/10*5)));return{average:n,rating:s}};function Dr(){const t=ft(w=>w.role),n=ft(w=>w.setSelectedAthlete),[,s]=ks(),[o,a]=r.useState(()=>window.location.hash.match(/[?&]section=([^&]+)/)?.[1]||"home"),[c,d]=r.useState(7);r.useEffect(()=>{const w=()=>a("home");return window.addEventListener("nav:reset",w),()=>window.removeEventListener("nav:reset",w)},[]);const i=t==="coach"||t==="admin",h=o==="home"||o==="calendar",u=o==="home"||o==="messaging"||o==="sms"||o==="swimmers"||o==="calendar"||o==="groups"||o==="objectives",g=o==="messaging"||o==="sms"||o==="calendar"||o==="groups",m=o==="home"||o==="swimmers",{data:j}=U({queryKey:["swim_catalog"],queryFn:()=>I.getSwimCatalog(),enabled:i&&h}),{data:p}=U({queryKey:["strength_catalog"],queryFn:()=>I.getStrengthSessions(),enabled:i&&h}),{data:l=[],isLoading:f}=U({queryKey:["athletes"],queryFn:()=>I.getAthletes(),enabled:i&&u}),P=r.useMemo(()=>l.slice(0,5),[l]),{data:v=[]}=U({queryKey:["groups"],queryFn:()=>I.getGroups(),enabled:i&&g}),N=U({queryKey:["upcoming-birthdays"],queryFn:()=>I.getUpcomingBirthdays({days:30}),enabled:i&&m}),q=N.data,$=U({queryKey:["coach-kpis",c,P.map(w=>w.id??w.display_name)],enabled:i&&o==="home"&&P.length>0,queryFn:async()=>{const w=c,E=new Date;E.setDate(E.getDate()-w);const D=At(E),y=At(new Date),R=await Promise.all(P.map(async F=>{const[_,b]=await Promise.all([I.getSessions(F.display_name,F.id),I.getStrengthHistory(F.display_name,{athleteId:F.id,limit:50,from:D,to:y})]),T=_.filter(C=>new Date(C.date).getTime()>=E.getTime()),z=T.map(C=>C.fatigue??C.feeling).filter(C=>Number.isFinite(C)),G=T.reduce((C,k)=>C+(Number(k.duration)||0)*(Number(k.effort)||0),0),M=(b?.runs??[]).filter(C=>Ar(C)>=E.getTime()),H=M.map(C=>C.fatigue??C.feeling??C.rpe).filter(C=>Number.isFinite(Number(C))).map(C=>Number(C)),x=M.reduce((C,k)=>{const L=Number(k.feeling??k.rpe??0),V=Number(k.duration??0);if(V>0&&L>0)return C+V*L;const W=Array.isArray(k.logs)?k.logs.length:0;return C+W*5},0),A=Mr([...z,...H]);return{athleteName:F.display_name,loadScore:G+x,fatigueRating:A}})),O=R.filter(F=>F.fatigueRating?.rating===5).map(F=>({athleteName:F.athleteName,rating:F.fatigueRating?.rating??0})),B=R.filter(F=>F.loadScore>0).sort((F,_)=>_.loadScore-F.loadScore)[0];return{fatigueAlerts:O,mostLoadedAthlete:B??null}}}),S=w=>{n({id:w.id??null,name:w.display_name}),s(w.id!=null?`/coach/swimmer/${w.id}`:"/progress")};return se(),i?e.jsxs("div",{className:"space-y-6",children:[o==="home"?e.jsx(kr,{onNavigate:a,onOpenRecordsAdmin:()=>s("/records-admin"),onOpenRecordsClub:()=>s("/records-club"),athletes:l,athletesLoading:f,upcomingBirthdays:q,birthdaysLoading:N.isLoading,kpiLoading:$.isLoading,kpiPeriod:c,onKpiPeriodChange:d,fatigueAlerts:$.data?.fatigueAlerts??[],mostLoadedAthlete:$.data?.mostLoadedAthlete??null,swimSessionCount:j?.length,strengthSessionCount:p?.length}):null,o==="swim"?e.jsxs("div",{className:"space-y-6",children:[e.jsx(ce,{title:"Bibliothèque natation",description:"Accédez aux séances et aux templates natation.",onBack:()=>a("home"),actions:e.jsxs(K,{variant:"outline",size:"sm",onClick:()=>a("calendar"),children:[e.jsx(rt,{className:"mr-1.5 h-3.5 w-3.5"}),"Assigner"]})}),e.jsx(r.Suspense,{fallback:e.jsx(vt,{}),children:e.jsx(Sr,{})})]}):null,o==="strength"?e.jsxs("div",{className:"space-y-6",children:[e.jsx(ce,{title:"Bibliothèque musculation",description:"Consultez et créez des séances musculation.",onBack:()=>a("home"),actions:e.jsxs(K,{variant:"outline",size:"sm",onClick:()=>a("calendar"),children:[e.jsx(rt,{className:"mr-1.5 h-3.5 w-3.5"}),"Assigner"]})}),e.jsx(r.Suspense,{fallback:e.jsx(vt,{}),children:e.jsx(Cr,{})})]}):null,o==="swimmers"?e.jsx(cn,{athletes:l,athletesLoading:f,onBack:()=>a("home"),onOpenAthlete:S}):null,o==="messaging"?e.jsx(dn,{onBack:()=>a("home"),athletes:l,groups:v,athletesLoading:f}):null,o==="sms"?e.jsx(ir,{onBack:()=>a("home"),athletes:l,groups:v,athletesLoading:f}):null,o==="calendar"?e.jsx(mr,{onBack:()=>a("home"),athletes:l,groups:v,swimSessions:j,strengthSessions:p}):null,o==="groups"?e.jsx(gr,{onBack:()=>a("home"),athletes:l,groups:v,athletesLoading:f}):null,o==="competitions"?e.jsx(jr,{onBack:()=>a("home")}):null,o==="objectives"?e.jsx(wr,{onBack:()=>a("home"),athletes:l,athletesLoading:f}):null]}):e.jsx("div",{className:"flex items-center justify-center min-h-[60vh] animate-in fade-in motion-reduce:animate-none",children:e.jsxs(ke,{className:"w-full max-w-sm shadow-xl border-t-4 border-t-primary",children:[e.jsxs(_e,{children:[e.jsxs(Ae,{className:"flex items-center gap-2 uppercase italic",children:[e.jsx(ye,{className:"h-5 w-5 text-primary"}),"Accès Coach"]}),e.jsx(Me,{children:"Cette section est réservée aux coachs et administrateurs."})]}),e.jsx(De,{children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"Connectez-vous avec un compte autorisé pour accéder aux outils de gestion."})})]})})}const na=Object.freeze(Object.defineProperty({__proto__:null,default:Dr},Symbol.toStringTag,{value:"Module"}));export{ds as C,Fn as P,us as a,ms as b,ps as c,it as d,lt as e,Tn as f,ts as g,na as h};
