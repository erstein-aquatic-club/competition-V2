import{l as ue,r as l,m as ss,n as ts,o as Ys,j as e,p as He,P as xe,q as we,s as js,t as jr,v as vr,w as F,x as yr,y as Zs,z as br,A as Nr,E as wr,F as _r,G as Cr,H as Sr,I as et,O as Ar,J as kr,K as st,M as rs,N as tt,a as de,Q as ne,U as Pe,V as Me,X as ds,Y as us,Z as A,_ as O,B as S,C as q,g as H,h as Q,i as K,S as ae,b as ie,d as le,e as oe,f as G,$ as pe,a0 as J,k as L,u as Qe,a1 as Rr,R as ce,a2 as Dr,a3 as Er,a4 as rt,a5 as Pr,a6 as Mr,a7 as nt,a8 as Tr,a9 as $r,aa as Fr,ab as Vr,ac as Or,ad as Ir,ae as qr,af as zr,ag as Gr,ah as ns,ai as Lr,aj as Je,W as Rs,D as Br,T as Kr}from"./index-C8viRVtP.js";import{d as as,R as at,I as it,T as Hr,a as Wr,b as Ur,c as Qr}from"./tabs-Cpct4CM0.js";import{T as Te}from"./textarea-Bg5ZgUpI.js";import{C as hs}from"./checkbox-Dkc5HWKf.js";import{S as Xe,P as Ds}from"./save-CczI9iQ-.js";import{c as lt,i as Es,g as Jr,S as Ps,R as Xr,L as Yr}from"./SwimSessionConsultation-DrfIhZE8.js";import{f as Zr}from"./format-B9mPVj_w.js";import{P as Ms}from"./play-CWs_U4jX.js";import{S as en}from"./search-BlAnrWpI.js";import{T as sn}from"./timer-B7FaVYC4.js";import{T as tn,a as rn,b as Ts,c as ms,d as nn,e as ps}from"./table-B-g5e5XD.js";import{B as an}from"./badge-CD3tYq7o.js";import{A as ln}from"./arrow-left-WvZMs0q6.js";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const on=[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8",key:"1s80jp"}],["path",{d:"M10 12h4",key:"a56b0p"}]],cn=ue("archive",on);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dn=[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]],$s=ue("arrow-down",dn);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const un=[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]],Fs=ue("arrow-up",un);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mn=[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326",key:"11g9vi"}]],Ve=ue("bell",mn);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pn=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],xn=ue("eye",pn);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hn=[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]],gn=ue("funnel",hn);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fn=[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]],ot=ue("grip-vertical",fn);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jn=[["path",{d:"M2 9.5a5.5 5.5 0 0 1 9.591-3.676.56.56 0 0 0 .818 0A5.49 5.49 0 0 1 22 9.5c0 2.29-1.5 4-3 5.5l-5.492 5.313a2 2 0 0 1-3 .019L5 15c-1.5-1.5-3-3.2-3-5.5",key:"mvr1a0"}],["path",{d:"M3.22 13H9.5l.5-1 2 4.5 2-7 1.5 3.5h5.27",key:"auskq0"}]],Vs=ue("heart-pulse",jn);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vn=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]],yn=ue("pencil",vn);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bn=[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],je=ue("trash-2",bn);function gs(s,t,{checkForDefaultPrevented:r=!0}={}){return function(n){if(s?.(n),r===!1||!n.defaultPrevented)return t?.(n)}}var Nn=ss[" useInsertionEffect ".trim().toString()]||ts;function wn({prop:s,defaultProp:t,onChange:r=()=>{},caller:a}){const[n,i,o]=_n({defaultProp:t,onChange:r}),d=s!==void 0,f=d?s:n;{const x=l.useRef(s!==void 0);l.useEffect(()=>{const p=x.current;p!==d&&console.warn(`${a} is changing from ${p?"controlled":"uncontrolled"} to ${d?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),x.current=d},[d,a])}const m=l.useCallback(x=>{if(d){const p=Cn(x)?x(s):x;p!==s&&o.current?.(p)}else i(x)},[d,s,i,o]);return[f,m]}function _n({defaultProp:s,onChange:t}){const[r,a]=l.useState(s),n=l.useRef(r),i=l.useRef(t);return Nn(()=>{i.current=t},[t]),l.useEffect(()=>{n.current!==r&&(i.current?.(r),n.current=r)},[r,n]),[r,a,i]}function Cn(s){return typeof s=="function"}var vs="Radio",[Sn,ct]=He(vs),[An,kn]=Sn(vs),dt=l.forwardRef((s,t)=>{const{__scopeRadio:r,name:a,checked:n=!1,required:i,disabled:o,value:d="on",onCheck:f,form:m,...x}=s,[p,g]=l.useState(null),C=we(t,v=>g(v)),N=l.useRef(!1),I=p?m||!!p.closest("form"):!0;return e.jsxs(An,{scope:r,checked:n,disabled:o,children:[e.jsx(xe.button,{type:"button",role:"radio","aria-checked":n,"data-state":xt(n),"data-disabled":o?"":void 0,disabled:o,value:d,...x,ref:C,onClick:gs(s.onClick,v=>{n||f?.(),I&&(N.current=v.isPropagationStopped(),N.current||v.stopPropagation())})}),I&&e.jsx(pt,{control:p,bubbles:!N.current,name:a,value:d,checked:n,required:i,disabled:o,form:m,style:{transform:"translateX(-100%)"}})]})});dt.displayName=vs;var ut="RadioIndicator",mt=l.forwardRef((s,t)=>{const{__scopeRadio:r,forceMount:a,...n}=s,i=kn(ut,r);return e.jsx(js,{present:a||i.checked,children:e.jsx(xe.span,{"data-state":xt(i.checked),"data-disabled":i.disabled?"":void 0,...n,ref:t})})});mt.displayName=ut;var Rn="RadioBubbleInput",pt=l.forwardRef(({__scopeRadio:s,control:t,checked:r,bubbles:a=!0,...n},i)=>{const o=l.useRef(null),d=we(o,i),f=jr(r),m=vr(t);return l.useEffect(()=>{const x=o.current;if(!x)return;const p=window.HTMLInputElement.prototype,C=Object.getOwnPropertyDescriptor(p,"checked").set;if(f!==r&&C){const N=new Event("click",{bubbles:a});C.call(x,r),x.dispatchEvent(N)}},[f,r,a]),e.jsx(xe.input,{type:"radio","aria-hidden":!0,defaultChecked:r,...n,tabIndex:-1,ref:d,style:{...n.style,...m,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});pt.displayName=Rn;function xt(s){return s?"checked":"unchecked"}var Dn=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],is="RadioGroup",[En]=He(is,[as,ct]),ht=as(),gt=ct(),[Pn,Mn]=En(is),ft=l.forwardRef((s,t)=>{const{__scopeRadioGroup:r,name:a,defaultValue:n,value:i,required:o=!1,disabled:d=!1,orientation:f,dir:m,loop:x=!0,onValueChange:p,...g}=s,C=ht(r),N=Ys(m),[I,v]=wn({prop:i,defaultProp:n??null,onChange:p,caller:is});return e.jsx(Pn,{scope:r,name:a,required:o,disabled:d,value:I,onValueChange:v,children:e.jsx(at,{asChild:!0,...C,orientation:f,dir:N,loop:x,children:e.jsx(xe.div,{role:"radiogroup","aria-required":o,"aria-orientation":f,"data-disabled":d?"":void 0,dir:N,...g,ref:t})})})});ft.displayName=is;var jt="RadioGroupItem",vt=l.forwardRef((s,t)=>{const{__scopeRadioGroup:r,disabled:a,...n}=s,i=Mn(jt,r),o=i.disabled||a,d=ht(r),f=gt(r),m=l.useRef(null),x=we(t,m),p=i.value===n.value,g=l.useRef(!1);return l.useEffect(()=>{const C=I=>{Dn.includes(I.key)&&(g.current=!0)},N=()=>g.current=!1;return document.addEventListener("keydown",C),document.addEventListener("keyup",N),()=>{document.removeEventListener("keydown",C),document.removeEventListener("keyup",N)}},[]),e.jsx(it,{asChild:!0,...d,focusable:!o,active:p,children:e.jsx(dt,{disabled:o,required:i.required,checked:p,...f,...n,name:i.name,ref:x,onCheck:()=>i.onValueChange(n.value),onKeyDown:gs(C=>{C.key==="Enter"&&C.preventDefault()}),onFocus:gs(n.onFocus,()=>{g.current&&m.current?.click()})})})});vt.displayName=jt;var Tn="RadioGroupIndicator",yt=l.forwardRef((s,t)=>{const{__scopeRadioGroup:r,...a}=s,n=gt(r);return e.jsx(mt,{...n,...a,ref:t})});yt.displayName=Tn;var bt=ft,Nt=vt,$n=yt;const wt=l.forwardRef(({className:s,...t},r)=>e.jsx(bt,{className:F("grid gap-2",s),...t,ref:r}));wt.displayName=bt.displayName;const fs=l.forwardRef(({className:s,...t},r)=>e.jsx(Nt,{ref:r,className:F("aspect-square h-4 w-4 rounded-full border border-primary text-primary shadow focus:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",s),...t,children:e.jsx($n,{className:"flex items-center justify-center",children:e.jsx(yr,{className:"h-3.5 w-3.5 fill-primary"})})}));fs.displayName=Nt.displayName;function _t(s){l.useEffect(()=>{if(!s)return;const t=r=>{r.preventDefault()};return window.addEventListener("beforeunload",t),()=>window.removeEventListener("beforeunload",t)},[s])}function Fn(s,t,{checkForDefaultPrevented:r=!0}={}){return function(n){if(s?.(n),r===!1||!n.defaultPrevented)return t?.(n)}}var Vn=Symbol("radix.slottable");function On(s){const t=({children:r})=>e.jsx(e.Fragment,{children:r});return t.displayName=`${s}.Slottable`,t.__radixId=Vn,t}var Ct="AlertDialog",[In]=He(Ct,[Zs]),he=Zs(),St=s=>{const{__scopeAlertDialog:t,...r}=s,a=he(t);return e.jsx(br,{...a,...r,modal:!0})};St.displayName=Ct;var qn="AlertDialogTrigger",zn=l.forwardRef((s,t)=>{const{__scopeAlertDialog:r,...a}=s,n=he(r);return e.jsx(kr,{...n,...a,ref:t})});zn.displayName=qn;var Gn="AlertDialogPortal",At=s=>{const{__scopeAlertDialog:t,...r}=s,a=he(t);return e.jsx(Nr,{...a,...r})};At.displayName=Gn;var Ln="AlertDialogOverlay",kt=l.forwardRef((s,t)=>{const{__scopeAlertDialog:r,...a}=s,n=he(r);return e.jsx(Ar,{...n,...a,ref:t})});kt.displayName=Ln;var Ce="AlertDialogContent",[Bn,Kn]=In(Ce),Hn=On("AlertDialogContent"),Rt=l.forwardRef((s,t)=>{const{__scopeAlertDialog:r,children:a,...n}=s,i=he(r),o=l.useRef(null),d=we(t,o),f=l.useRef(null);return e.jsx(wr,{contentName:Ce,titleName:Dt,docsSlug:"alert-dialog",children:e.jsx(Bn,{scope:r,cancelRef:f,children:e.jsxs(_r,{role:"alertdialog",...i,...n,ref:d,onOpenAutoFocus:Fn(n.onOpenAutoFocus,m=>{m.preventDefault(),f.current?.focus({preventScroll:!0})}),onPointerDownOutside:m=>m.preventDefault(),onInteractOutside:m=>m.preventDefault(),children:[e.jsx(Hn,{children:a}),e.jsx(Un,{contentRef:o})]})})})});Rt.displayName=Ce;var Dt="AlertDialogTitle",Et=l.forwardRef((s,t)=>{const{__scopeAlertDialog:r,...a}=s,n=he(r);return e.jsx(Cr,{...n,...a,ref:t})});Et.displayName=Dt;var Pt="AlertDialogDescription",Mt=l.forwardRef((s,t)=>{const{__scopeAlertDialog:r,...a}=s,n=he(r);return e.jsx(Sr,{...n,...a,ref:t})});Mt.displayName=Pt;var Wn="AlertDialogAction",Tt=l.forwardRef((s,t)=>{const{__scopeAlertDialog:r,...a}=s,n=he(r);return e.jsx(et,{...n,...a,ref:t})});Tt.displayName=Wn;var $t="AlertDialogCancel",Ft=l.forwardRef((s,t)=>{const{__scopeAlertDialog:r,...a}=s,{cancelRef:n}=Kn($t,r),i=he(r),o=we(t,n);return e.jsx(et,{...i,...a,ref:o})});Ft.displayName=$t;var Un=({contentRef:s})=>{const t=`\`${Ce}\` requires a description for the component to be accessible for screen reader users.

You can add a description to the \`${Ce}\` by passing a \`${Pt}\` component as a child, which also benefits sighted users by adding visible context to the dialog.

Alternatively, you can use your own component as a description by assigning it an \`id\` and passing the same value to the \`aria-describedby\` prop in \`${Ce}\`. If the description is confusing or duplicative for sighted users, you can use the \`@radix-ui/react-visually-hidden\` primitive as a wrapper around your description component.

For more information, see https://radix-ui.com/primitives/docs/components/alert-dialog`;return l.useEffect(()=>{document.getElementById(s.current?.getAttribute("aria-describedby"))||console.warn(t)},[t,s]),null},Qn=St,Jn=At,Vt=kt,Ot=Rt,It=Tt,qt=Ft,zt=Et,Gt=Mt;const Ze=Qn,Xn=Jn,Lt=l.forwardRef(({className:s,...t},r)=>e.jsx(Vt,{className:F("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s),...t,ref:r}));Lt.displayName=Vt.displayName;const Oe=l.forwardRef(({className:s,...t},r)=>e.jsxs(Xn,{children:[e.jsx(Lt,{}),e.jsx(Ot,{ref:r,className:F("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",s),...t})]}));Oe.displayName=Ot.displayName;const Ie=({className:s,...t})=>e.jsx("div",{className:F("flex flex-col space-y-2 text-center sm:text-left",s),...t});Ie.displayName="AlertDialogHeader";const qe=({className:s,...t})=>e.jsx("div",{className:F("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",s),...t});qe.displayName="AlertDialogFooter";const ze=l.forwardRef(({className:s,...t},r)=>e.jsx(zt,{ref:r,className:F("text-lg font-semibold",s),...t}));ze.displayName=zt.displayName;const Ge=l.forwardRef(({className:s,...t},r)=>e.jsx(Gt,{ref:r,className:F("text-sm text-muted-foreground",s),...t}));Ge.displayName=Gt.displayName;const Le=l.forwardRef(({className:s,...t},r)=>e.jsx(It,{ref:r,className:F(st(),s),...t}));Le.displayName=It.displayName;const Be=l.forwardRef(({className:s,...t},r)=>e.jsx(qt,{ref:r,className:F(st({variant:"outline"}),"mt-2 sm:mt-0",s),...t}));Be.displayName=qt.displayName;const Os=[{key:"endurance",label:"Endurance",fieldSuffix:"endurance"},{key:"hypertrophie",label:"Hypertrophie",fieldSuffix:"hypertrophie"},{key:"force",label:"Force",fieldSuffix:"force"}],Is=s=>s==="endurance"||s==="hypertrophie"||s==="force"?s:"endurance",qs=({exercise:s,onChange:t,disabled:r=!1})=>e.jsxs(Hr,{defaultValue:"endurance",className:"w-full",children:[e.jsx(Wr,{className:"grid w-full grid-cols-3",children:Os.map(a=>e.jsx(Ur,{value:a.key,children:a.label},a.key))}),Os.map(a=>{const n=`pct_1rm_${a.fieldSuffix}`,i=`Nb_series_${a.fieldSuffix}`,o=`Nb_reps_${a.fieldSuffix}`,d=`recup_${a.fieldSuffix}`,f=`recup_exercices_${a.fieldSuffix}`;return e.jsxs(Qr,{value:a.key,className:`space-y-3 rounded-lg border p-3 ${r?"opacity-60":""}`,children:[e.jsx("p",{className:"text-sm font-semibold",children:a.label}),e.jsxs("div",{className:"grid gap-3 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{children:"% 1RM"}),e.jsx(O,{type:"number",value:s[n]??"",disabled:r,onChange:m=>t({[n]:m.target.value===""?null:Number(m.target.value)})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{children:"Nb sÃ©ries"}),e.jsx(O,{type:"number",value:s[i]??"",disabled:r,onChange:m=>t({[i]:m.target.value===""?null:Number(m.target.value)})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{children:"Nb reps"}),e.jsx(O,{type:"number",value:s[o]??"",disabled:r,onChange:m=>t({[o]:m.target.value===""?null:Number(m.target.value)})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{children:"RÃ©cup. sÃ©ries (s)"}),e.jsx(O,{type:"number",value:s[d]??"",disabled:r,onChange:m=>t({[d]:m.target.value===""?null:Number(m.target.value)})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{children:"RÃ©cup. exercices (s)"}),e.jsx(O,{type:"number",value:s[f]??"",disabled:r,onChange:m=>t({[f]:m.target.value===""?null:Number(m.target.value)})})]})]})]},a.key)})]}),Yn={pct_1rm_endurance:60,pct_1rm_hypertrophie:75,pct_1rm_force:85,Nb_series_endurance:4,Nb_series_hypertrophie:3,Nb_series_force:3,Nb_reps_endurance:16,Nb_reps_hypertrophie:8,Nb_reps_force:3,recup_endurance:120,recup_hypertrophie:200,recup_force:300,recup_exercices_endurance:300,recup_exercices_hypertrophie:400,recup_exercices_force:500},Ue=s=>{const t=Number(s);return Number.isFinite(t)?t:0},zs=(s,t,r,a)=>{const n=t==="force"?"force":t==="hypertrophie"?"hypertrophie":"endurance",i=`Nb_series_${n}`,o=`Nb_reps_${n}`,d=`pct_1rm_${n}`,f=`recup_${n}`;return{exercise_id:s.id,order_index:r,sets:Ue(s[i]),reps:Ue(s[o]),rest_seconds:Ue(s[f]),percent_1rm:Ue(s[d]),cycle_type:t,notes:a?.notes??""}},Zn=()=>({nom_exercice:"",description:null,illustration_gif:null,exercise_type:"strength",warmup_reps:null,warmup_duration:null,...Yn}),Gs=({exercise:s,warmupMode:t,onChange:r,onWarmupModeChange:a,idPrefix:n})=>e.jsxs("div",{className:"space-y-3 rounded-lg border p-3",children:[e.jsx("p",{className:"text-sm font-semibold",children:"ParamÃ¨tres dâ€™Ã©chauffement"}),e.jsxs(wt,{value:t,onValueChange:i=>{a(i==="duration"?"duration":"reps"),r(i==="duration"?{warmup_reps:null,warmup_duration:s.warmup_duration??0}:{warmup_duration:null,warmup_reps:s.warmup_reps??0})},className:"grid gap-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(fs,{value:"reps",id:`${n}-warmup-reps`}),e.jsx(A,{htmlFor:`${n}-warmup-reps`,children:"Nombre de rÃ©pÃ©titions"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(fs,{value:"duration",id:`${n}-warmup-duration`}),e.jsx(A,{htmlFor:`${n}-warmup-duration`,children:"DurÃ©e (secondes)"})]})]}),t==="duration"?e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{children:"DurÃ©e (s)"}),e.jsx(O,{type:"number",value:s.warmup_duration??"",onChange:i=>r({warmup_duration:i.target.value===""?null:Number(i.target.value)})})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{children:"Nombre de rÃ©pÃ©titions"}),e.jsx(O,{type:"number",value:s.warmup_reps??"",onChange:i=>r({warmup_reps:i.target.value===""?null:Number(i.target.value)})})]})]});function ea(){const{toast:s}=rs(),t=tt(),[r,a]=l.useState(!1),[n,i]=l.useState(null);_t(r||n!==null);const[o,d]=l.useState("all"),[f,m]=l.useState(!1),[x,p]=l.useState(!1),[g,C]=l.useState(null),[N,I]=l.useState(null),[v,Y]=l.useState(!1),[X,w]=l.useState(null),[T,re]=l.useState(null),[E,ee]=l.useState(null),[be,h]=l.useState("reps"),[M,W]=l.useState("reps"),[k,_]=l.useState({title:"",description:"",cycle:"endurance",items:[]}),[D,U]=l.useState({...Zn()});l.useEffect(()=>{g&&W(g.warmup_duration!=null?"duration":"reps")},[g]);const{data:B,isLoading:me}=de({queryKey:["exercises"],queryFn:()=>L.getExercises()}),{data:ge,isLoading:_e}=de({queryKey:["strength_catalog"],queryFn:()=>L.getStrengthSessions()}),Ne=l.useMemo(()=>new Map((B??[]).map(c=>[c.id,c])),[B]),Ae=ne({mutationFn:c=>L.createExercise(c),onSuccess:()=>{t.invalidateQueries({queryKey:["exercises"]}),m(!1),s({title:"Exercice ajoutÃ©"})}}),ke=ne({mutationFn:c=>L.createStrengthSession(c),onSuccess:()=>{t.invalidateQueries({queryKey:["strength_catalog"]}),a(!1),_({title:"",description:"",cycle:"endurance",items:[]}),s({title:"SÃ©ance crÃ©Ã©e avec succÃ¨s"})}}),Re=ne({mutationFn:c=>L.updateExercise(c),onSuccess:()=>{t.invalidateQueries({queryKey:["exercises"]}),t.invalidateQueries({queryKey:["strength_catalog"]}),p(!1),C(null),s({title:"Exercice mis Ã  jour"})}}),V=ne({mutationFn:c=>L.deleteExercise(c),onSuccess:()=>{t.invalidateQueries({queryKey:["exercises"]}),t.invalidateQueries({queryKey:["strength_catalog"]}),re(null),s({title:"Exercice supprimÃ©"})}}),Z=ne({mutationFn:c=>L.deleteStrengthSession(c),onSuccess:()=>{t.invalidateQueries({queryKey:["strength_catalog"]}),w(null),s({title:"SÃ©ance supprimÃ©e"})}}),u=ne({mutationFn:c=>L.updateStrengthSession(c),onSuccess:()=>{t.invalidateQueries({queryKey:["strength_catalog"]}),a(!1),i(null),_({title:"",description:"",cycle:"endurance",items:[]}),s({title:"SÃ©ance mise Ã  jour"})}}),j=ne({mutationFn:c=>L.persistStrengthSessionOrder(c)}),b=()=>{a(!1),i(null),_({title:"",description:"",cycle:"endurance",items:[]})},$=c=>{i(c.id),_({title:c.title??"",description:c.description??"",cycle:Is(c.cycle),items:c.items?.map(y=>({exercise_id:y.exercise_id,order_index:y.order_index??y.ordre??0,sets:y.sets,reps:y.reps,rest_seconds:y.rest_seconds,percent_1rm:y.percent_1rm,cycle_type:y.cycle_type,notes:y.notes??""}))??[]}),a(!0)},z=c=>{C(c),p(!0)},se=()=>{const c={...k,items:P(k.items)};n?u.mutate({...c,id:n}):ke.mutate(c)},P=c=>c.map((y,R)=>({...y,order_index:R})),De=()=>{const c=B?.[0];_(y=>({...y,items:[...y.items,c?zs(c,y.cycle,y.items.length):{exercise_id:1,order_index:y.items.length,sets:0,reps:0,rest_seconds:0,percent_1rm:0}]}))},fe=(c,y,R)=>{const te=[...k.items];if(y==="exercise_id"){const Ee=B?.find(fr=>fr.id===R);Ee?te[c]=zs(Ee,k.cycle,te[c].order_index??c,te[c]):te[c]={...te[c],exercise_id:R}}else te[c]={...te[c],[y]:R};_({...k,items:te})},os=c=>{const y=P(k.items.filter((R,te)=>te!==c));_({...k,items:y})},cs=(c,y)=>{if(c===y)return;const R=[...k.items],[te]=R.splice(c,1);R.splice(y,0,te);const Ee=P(R);_({...k,items:Ee}),n&&j.mutate({id:n,title:k.title,description:k.description,cycle:k.cycle,items:Ee})},gr=new Set(k.items.map(c=>c.exercise_id)),ws=B?.filter(c=>o==="all"||gr.has(c.id)?!0:c.exercise_type===o)??[],_s=e.jsx(Pe,{open:x,onOpenChange:p,children:e.jsxs(Me,{className:"sm:max-w-3xl max-h-[85vh] overflow-y-auto pb-safe",children:[e.jsx(ds,{children:e.jsx(us,{children:"Modifier lâ€™exercice"})}),g&&e.jsxs("div",{className:"space-y-4",children:[g.exercise_type==="warmup"?e.jsx(Gs,{exercise:g,warmupMode:M,onChange:c=>C(y=>y&&{...y,...c}),onWarmupModeChange:W,idPrefix:"edit"}):null,e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{children:"Nom"}),e.jsx(O,{value:g.nom_exercice,onChange:c=>C({...g,nom_exercice:c.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{children:"Description"}),e.jsx(Te,{value:g.description??"",onChange:c=>C({...g,description:c.target.value===""?null:c.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{children:"Illustration (GIF)"}),e.jsx(O,{value:g.illustration_gif??"",onChange:c=>C({...g,illustration_gif:c.target.value===""?null:c.target.value}),placeholder:"https://..."})]}),g.exercise_type!=="warmup"?e.jsx(qs,{exercise:g,onChange:c=>C(y=>y&&{...y,...c})}):null,e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(hs,{id:"warmup-flag-edit",checked:g.exercise_type==="warmup",onCheckedChange:c=>C({...g,exercise_type:c===!0?"warmup":"strength"})}),e.jsx(A,{htmlFor:"warmup-flag-edit",children:"Exercice dâ€™Ã©chauffement (warmup)"})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(S,{variant:"outline",onClick:()=>{p(!1),C(null)},children:"Annuler"}),e.jsxs(S,{onClick:()=>{g?.id&&Re.mutate(g)},disabled:!g.nom_exercice.trim(),children:[e.jsx(Xe,{className:"mr-2 h-4 w-4"})," Enregistrer"]})]})]})]})}),Cs=e.jsx(Pe,{open:f,onOpenChange:m,children:e.jsxs(Me,{className:"sm:max-w-3xl max-h-[85vh] overflow-y-auto pb-safe",children:[e.jsx(ds,{children:e.jsx(us,{children:"CrÃ©er un exercice"})}),e.jsxs("div",{className:"space-y-4",children:[D.exercise_type==="warmup"?e.jsx(Gs,{exercise:D,warmupMode:be,onChange:c=>U(y=>({...y,...c})),onWarmupModeChange:h,idPrefix:"create"}):null,e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{children:"Nom"}),e.jsx(O,{value:D.nom_exercice,onChange:c=>U({...D,nom_exercice:c.target.value}),placeholder:"ex: Rotations Ã‰lastique"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{children:"Description"}),e.jsx(Te,{value:D.description??"",onChange:c=>U({...D,description:c.target.value===""?null:c.target.value}),placeholder:"DÃ©tails, consignes..."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{children:"Illustration (GIF)"}),e.jsx(O,{value:D.illustration_gif??"",onChange:c=>U({...D,illustration_gif:c.target.value===""?null:c.target.value}),placeholder:"https://..."})]}),D.exercise_type!=="warmup"?e.jsx(qs,{exercise:D,onChange:c=>U(y=>({...y,...c}))}):null,e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(hs,{id:"warmup-flag",checked:D.exercise_type==="warmup",onCheckedChange:c=>U({...D,exercise_type:c===!0?"warmup":"strength"})}),e.jsx(A,{htmlFor:"warmup-flag",children:"Exercice dâ€™Ã©chauffement (warmup)"})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(S,{variant:"outline",onClick:()=>m(!1),children:"Annuler"}),e.jsxs(S,{onClick:()=>Ae.mutate(D),disabled:!D.nom_exercice.trim(),children:[e.jsx(Xe,{className:"mr-2 h-4 w-4"})," Enregistrer"]})]})]})]})}),Ss=e.jsx(Pe,{open:v,onOpenChange:c=>{Y(c),c||I(null)},children:e.jsxs(Me,{className:"sm:max-w-3xl",children:[e.jsx(ds,{children:e.jsx(us,{children:"DÃ©tails de la sÃ©ance"})}),N&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-lg font-semibold",children:N.title}),e.jsx("p",{className:"text-sm text-muted-foreground",children:N.description||"â€”"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Cycle : ",N.cycle]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm font-semibold",children:"Exercices"}),e.jsx("div",{className:"space-y-2",children:(N.items??[]).slice().sort((c,y)=>(c.order_index??0)-(y.order_index??0)).map((c,y)=>{const R=Ne.get(c.exercise_id);return e.jsxs("div",{className:"rounded-md border px-3 py-2 text-sm",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("span",{className:"font-medium",children:[y+1,". ",R?.nom_exercice??c.exercise_name??"Exercice"]}),e.jsx("span",{className:"text-xs text-muted-foreground",children:R?.exercise_type==="warmup"||c.category==="warmup"?"Ã‰chauffement":"Travail"})]}),e.jsxs("div",{className:"mt-1 text-xs text-muted-foreground",children:[c.sets," sÃ©ries â€¢ ",c.reps," reps â€¢ ",c.percent_1rm,"% 1RM â€¢ ",c.rest_seconds,"s"]})]},`${c.exercise_id}-${y}`)})})]})]})]})}),As=e.jsx(Ze,{open:!!X,onOpenChange:c=>{c||w(null)},children:e.jsxs(Oe,{children:[e.jsxs(Ie,{children:[e.jsx(ze,{children:"Supprimer la sÃ©ance ?"}),e.jsxs(Ge,{children:['Cette action est dÃ©finitive. La sÃ©ance "',X?.title,'" sera supprimÃ©e.']})]}),e.jsxs(qe,{children:[e.jsx(Be,{children:"Annuler"}),e.jsx(Le,{onClick:()=>{X?.id&&Z.mutate(X.id)},children:"Supprimer"})]})]})}),ks=e.jsx(Ze,{open:!!T,onOpenChange:c=>{c||re(null)},children:e.jsxs(Oe,{children:[e.jsxs(Ie,{children:[e.jsx(ze,{children:"Supprimer lâ€™exercice ?"}),e.jsxs(Ge,{children:['Cette action est dÃ©finitive. Lâ€™exercice "',T?.nom_exercice,'" sera supprimÃ©.']})]}),e.jsxs(qe,{children:[e.jsx(Be,{children:"Annuler"}),e.jsx(Le,{onClick:()=>{T?.id&&V.mutate(T.id)},children:"Supprimer"})]})]})});return r?e.jsxs("div",{className:"space-y-6 animate-in slide-in-from-bottom-4 motion-reduce:animate-none",children:[Cs,_s,Ss,As,ks,e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-bold uppercase",children:n?"Modifier SÃ©ance Muscu":"Nouvelle SÃ©ance Muscu"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(S,{variant:"outline",onClick:b,children:"Annuler"}),e.jsxs(S,{onClick:se,children:[e.jsx(Xe,{className:"mr-2 h-4 w-4"})," Enregistrer"]})]})]}),e.jsxs(q,{children:[e.jsx(H,{children:e.jsx(Q,{children:"Informations GÃ©nÃ©rales"})}),e.jsxs(K,{className:"space-y-4",children:[e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{children:"Titre"}),e.jsx(O,{value:k.title,onChange:c=>_({...k,title:c.target.value}),placeholder:"ex: Full Body A"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{children:"Cycle"}),e.jsxs(ae,{value:k.cycle,onValueChange:c=>_({...k,cycle:Is(c)}),children:[e.jsx(ie,{children:e.jsx(le,{})}),e.jsxs(oe,{children:[e.jsx(G,{value:"endurance",children:"Endurance"}),e.jsx(G,{value:"hypertrophie",children:"Hypertrophie"}),e.jsx(G,{value:"force",children:"Force"})]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{children:"Description"}),e.jsx(Te,{value:k.description,onChange:c=>_({...k,description:c.target.value})})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-bold",children:"Exercices"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(S,{size:"sm",variant:"outline",onClick:()=>m(!0),children:[e.jsx(pe,{className:"mr-2 h-4 w-4"})," Nouvel exercice"]}),e.jsxs(S,{size:"sm",onClick:De,children:[e.jsx(pe,{className:"mr-2 h-4 w-4"})," Ajouter"]})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-[220px_1fr] items-end",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(A,{className:"flex items-center gap-2",children:[e.jsx(gn,{className:"h-4 w-4"})," Filtre exercices"]}),e.jsxs(ae,{value:o,onValueChange:c=>d(c),children:[e.jsx(ie,{children:e.jsx(le,{})}),e.jsxs(oe,{children:[e.jsx(G,{value:"all",children:"Tous"}),e.jsx(G,{value:"strength",children:"SÃ©ries de travail"}),e.jsx(G,{value:"warmup",children:"Ã‰chauffement"})]})]})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Les exercices marquÃ©s warmup sont affichÃ©s dans les sÃ©ances avec le badge Â« Ã‰chauffement Â»."})]}),k.items.map((c,y)=>e.jsxs(q,{className:"relative",onDragOver:R=>R.preventDefault(),onDrop:()=>{E!==null&&(cs(E,y),ee(null))},children:[e.jsx(S,{variant:"ghost",size:"icon",className:"absolute top-2 right-2 text-destructive",onClick:()=>os(y),"aria-label":"Supprimer l'exercice",children:e.jsx(je,{className:"h-4 w-4"})}),e.jsxs(K,{className:"pt-6 grid md:grid-cols-12 gap-4 items-end",children:[e.jsx("div",{className:"md:col-span-1 flex items-center justify-center",children:e.jsx("button",{type:"button",className:"cursor-grab rounded-md border p-1 text-muted-foreground hover:text-foreground",draggable:!0,onDragStart:()=>ee(y),onDragEnd:()=>ee(null),"aria-label":"RÃ©ordonner",children:e.jsx(ot,{className:"h-4 w-4"})})}),e.jsxs("div",{className:"md:col-span-3 space-y-2",children:[e.jsx(A,{children:"Exercice"}),e.jsxs(ae,{value:c.exercise_id.toString(),onValueChange:R=>fe(y,"exercise_id",parseInt(R)),children:[e.jsx(ie,{children:e.jsx(le,{})}),e.jsx(oe,{children:ws.length?ws.map(R=>e.jsxs(G,{value:R.id.toString(),children:[R.nom_exercice,R.exercise_type==="warmup"?" â€¢ Ã‰chauffement":""]},R.id)):e.jsx(G,{value:"no-exercise",disabled:!0,children:"Aucun exercice disponible"})})]})]}),e.jsxs("div",{className:"md:col-span-2 space-y-2",children:[e.jsx(A,{children:"SÃ©ries"}),e.jsx(O,{type:"number",value:c.sets===0?"":c.sets,onChange:R=>fe(y,"sets",R.target.value===""?0:Number(R.target.value))})]}),e.jsxs("div",{className:"md:col-span-2 space-y-2",children:[e.jsx(A,{children:"Reps"}),e.jsx(O,{type:"number",value:c.reps===0?"":c.reps,onChange:R=>fe(y,"reps",R.target.value===""?0:Number(R.target.value))})]}),e.jsxs("div",{className:"md:col-span-2 space-y-2",children:[e.jsx(A,{children:"% 1RM"}),e.jsx(O,{type:"number",value:c.percent_1rm===0?"":c.percent_1rm,onChange:R=>fe(y,"percent_1rm",R.target.value===""?0:Number(R.target.value))})]}),e.jsxs("div",{className:"md:col-span-2 space-y-2",children:[e.jsx(A,{children:"Repos (s)"}),e.jsx(O,{type:"number",value:c.rest_seconds===0?"":c.rest_seconds,onChange:R=>fe(y,"rest_seconds",R.target.value===""?0:Number(R.target.value))})]})]})]},`${c.exercise_id}-${y}`))]})]}):e.jsxs("div",{className:"space-y-4",children:[Cs,_s,Ss,As,ks,e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"font-bold text-lg",children:"Catalogue SÃ©ances Musculation"}),e.jsxs(S,{onClick:()=>{i(null),_({title:"",description:"",cycle:"endurance",items:[]}),a(!0)},children:[e.jsx(pe,{className:"mr-2 h-4 w-4"})," CrÃ©er"]})]}),_e?e.jsx("div",{className:"grid gap-4 md:grid-cols-2",children:[1,2,3,4].map(c=>e.jsxs(q,{children:[e.jsxs(H,{children:[e.jsx("div",{className:"h-5 w-3/4 rounded-lg bg-muted animate-pulse"}),e.jsx("div",{className:"mt-2 h-4 w-1/2 rounded-lg bg-muted animate-pulse"})]}),e.jsx(K,{children:e.jsx("div",{className:"h-9 w-32 rounded-lg bg-muted animate-pulse"})})]},c))}):e.jsx("div",{className:"grid gap-4 md:grid-cols-2",children:ge?.map(c=>e.jsxs(q,{children:[e.jsxs(H,{children:[e.jsx(Q,{children:c.title}),e.jsxs(J,{children:[c.items?.length||0," exercices â€¢ ",c.cycle]})]}),e.jsx(K,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(S,{variant:"outline",size:"icon","aria-label":"Voir dÃ©tails",onClick:()=>{I(c),Y(!0)},children:e.jsx(xn,{className:"h-4 w-4"})}),e.jsx(S,{variant:"secondary",size:"icon","aria-label":"Modifier",onClick:()=>$(c),children:e.jsx(Ds,{className:"h-4 w-4"})}),e.jsx(S,{variant:"destructive",size:"icon","aria-label":"Supprimer",onClick:()=>w(c),children:e.jsx(je,{className:"h-4 w-4"})})]})})]},c.id))}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-bold text-lg",children:"Catalogue Exercices"}),e.jsxs(S,{variant:"outline",onClick:()=>m(!0),children:[e.jsx(pe,{className:"mr-2 h-4 w-4"})," Ajouter un exercice"]})]}),me?e.jsx("div",{className:"grid gap-3 md:grid-cols-2",children:[1,2,3,4,5,6].map(c=>e.jsx(q,{children:e.jsxs(H,{children:[e.jsx("div",{className:"h-5 w-2/3 rounded-lg bg-muted animate-pulse"}),e.jsx("div",{className:"mt-2 h-4 w-1/3 rounded-lg bg-muted animate-pulse"})]})},c))}):e.jsx("div",{className:"grid gap-3 md:grid-cols-2",children:B?.map(c=>e.jsx(q,{children:e.jsxs(K,{className:"flex flex-col gap-3 py-4 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[c.illustration_gif?e.jsx("img",{src:c.illustration_gif,alt:`Illustration ${c.nom_exercice}`,className:"h-14 w-14 rounded-md object-cover"}):null,e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:c.nom_exercice}),e.jsx("p",{className:"text-sm text-muted-foreground",children:c.exercise_type==="warmup"?"Ã‰chauffement":"SÃ©ries de travail"})]})]}),e.jsxs("div",{className:"flex w-full gap-2 sm:w-auto",children:[e.jsx(S,{variant:"outline",size:"icon","aria-label":"Modifier",onClick:()=>z(c),children:e.jsx(Ds,{className:"h-4 w-4"})}),e.jsx(S,{variant:"destructive",size:"icon","aria-label":"Supprimer",onClick:()=>re(c),children:e.jsx(je,{className:"h-4 w-4"})})]})]})},c.id))})]})]})}const Ls=["V0","V1","V2","V3","Max"],sa={V0:"bg-emerald-500",V1:"bg-green-500",V2:"bg-yellow-500",V3:"bg-orange-500",Max:"bg-red-600"},Bs={souple:"V0",facile:"V0",relache:"V0",relÃ¢chÃ©:"V0"},ta=s=>{if(!s)return"V0";const t=s.trim();if(!t)return"V0";const r=t.toLowerCase();if(Bs[r])return Bs[r];const a=t.toUpperCase();if(a==="MAX")return"Max";if(a.startsWith("V")){const n=a.replace("V","V");return n==="V4"||n==="V5"?"Max":n}return t};function ra({value:s,onChange:t,className:r,ariaLabel:a="SÃ©lection d'intensitÃ©"}){const n=ta(s),i=Ls.includes(n)?n:"Max";return e.jsx("div",{role:"radiogroup","aria-label":a,className:F("flex flex-wrap items-center gap-2",r),children:Ls.map(o=>{const d=i===o;return e.jsxs("button",{type:"button",role:"radio","aria-checked":d,"aria-label":`IntensitÃ© ${o==="Max"?"MAX":o}`,onClick:()=>t(o),className:F("flex flex-col items-center gap-1 rounded-full px-2 py-1 text-[10px] font-semibold text-muted-foreground transition","focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary",d?"text-foreground":"hover:text-foreground"),children:[e.jsx("span",{className:F("h-3 w-3 rounded-full",d?sa[o]??"bg-primary":"bg-slate-200")}),e.jsx("span",{children:o==="Max"?"MAX":o})]},o)})})}function Ks(s){return`SÃ©ance du ${Zr(s,"dd/MM/yyyy")} - Soir - Matin`}const Hs={souple:"V0",facile:"V0",relache:"V0",relÃ¢chÃ©:"V0"},na=["V0","V1","V2","V3","Max"],Ke=s=>{if(!s)return"V0";const t=s.trim();if(!t)return"V0";const r=t.toLowerCase();if(Hs[r])return Hs[r];const a=t.toUpperCase();if(a==="MAX")return"Max";if(a.startsWith("V")){const n=Number.parseInt(a.slice(1),10);if(Number.isFinite(n)&&n>=4)return"Max";if(na.includes(a))return a}return t},Ws=s=>s==="Max"?"MAX":s,xs=s=>{let t=0;return s.flatMap((r,a)=>r.exercises.map((n,i)=>{const o={block_title:r.title,block_description:r.description||null,block_order:a,block_repetitions:r.repetitions??null,block_modalities:r.modalities||null,block_equipment:r.equipment??[],exercise_repetitions:n.repetitions??null,exercise_rest:n.rest??null,exercise_stroke:n.stroke||null,exercise_stroke_type:n.strokeType||null,exercise_intensity:n.intensity?Ke(n.intensity):null,exercise_modalities:n.modalities||null,exercise_equipment:n.equipment??[],exercise_order:i},d=n.repetitions&&n.distance?`${n.repetitions}x${n.distance}m`:n.distance?`${n.distance}m`:null;return{ordre:t++,label:d,distance:n.distance??null,duration:null,intensity:n.intensity?Ke(n.intensity):null,notes:n.modalities||null,raw_payload:o}}))},aa=(s=[])=>{const t=new Map;return s.forEach(r=>{const a=r.raw_payload??{},n=a.block_title||a.section||"Bloc",i=Number(a.block_order??0),o=`${i}-${n}`,d=a.block_equipment??a.equipment??[],f=(Array.isArray(d)?d:String(d).split(",")).map(g=>String(g)).map(g=>Us(g)).filter(Boolean);t.has(o)||t.set(o,{title:n,repetitions:a.block_repetitions??null,description:a.block_description??"",modalities:a.block_modalities??a.modalities??"",equipment:f,exercises:[],order:Number.isFinite(i)?i:0,exerciseOrder:new Map});const m=t.get(o),x=Number(a.exercise_order??r.ordre??m.exercises.length),p=Ke(a.exercise_intensity??r.intensity??"V1");m.exerciseOrder.set(x,{repetitions:a.exercise_repetitions??null,distance:r.distance??null,rest:a.exercise_rest??null,stroke:a.exercise_stroke??a.stroke??"crawl",strokeType:a.exercise_stroke_type??a.stroke_type??"nc",intensity:p,modalities:a.exercise_modalities??r.notes??"",equipment:Array.isArray(a.exercise_equipment)?a.exercise_equipment.map(g=>Us(g)):[]})}),Array.from(t.values()).sort((r,a)=>r.order-a.order).map(r=>({title:r.title,repetitions:r.repetitions,description:r.description,modalities:r.modalities,equipment:r.equipment,exercises:Array.from(r.exerciseOrder.entries()).sort(([a],[n])=>a-n).map(([,a])=>a)}))},ia=s=>s?s.length>48?`${s.slice(0,45).trim()}â€¦`:s:"",Us=s=>{const t=s.trim().toLowerCase();return t&&(t.startsWith("plaquette")?"plaquettes":t.startsWith("palm")?"palmes":t.startsWith("tuba")?"tuba":t.startsWith("pull")?"pull":t.startsWith("elas")?"elastique":t)},la=(s=[])=>new Set(s.map(r=>{const a=r.raw_payload;return a?.block_title||a?.section||"Bloc"})).size,oa=s=>{const t=lt(s.items??[]),a=s.items?.some(i=>i.duration!=null)??!1?s.items?.reduce((i,o)=>i+(o.duration??0),0)??0:null,n=la(s.items??[]);return{totalDistance:t,totalDuration:a,blockCount:n}},Qs="swim_catalog_archived_ids",ca=(s,t)=>t===null?!1:!t.some(r=>r.session_type==="swim"&&r.session_id===s);function da(){const{toast:s}=rs(),t=tt(),{userId:r,role:a}=Qe(),[n,i]=l.useState(!1);_t(n);const[o,d]=l.useState(null),[f,m]=l.useState(null),[x,p]=l.useState(null),[g,C]=l.useState(""),[N,I]=l.useState("compact"),[v,Y]=l.useState(new Set),X=()=>({id:null,name:Ks(new Date),description:"",estimatedDuration:0,blocks:[]}),[w,T]=l.useState(X),{data:re}=de({queryKey:["swim_catalog"],queryFn:()=>L.getSwimCatalog()}),{data:E}=de({queryKey:["coach-assignments"],queryFn:()=>L.getAssignmentsForCoach(),enabled:a==="coach"||a==="admin"});l.useEffect(()=>{if(typeof window>"u")return;const u=window.localStorage.getItem(Qs);if(u)try{const j=JSON.parse(u);Array.isArray(j)&&Y(new Set(j.map(b=>Number(b)).filter(b=>Number.isFinite(b))))}catch{return}},[]),l.useEffect(()=>{typeof window>"u"||window.localStorage.setItem(Qs,JSON.stringify(Array.from(v.values())))},[v]);const be=l.useMemo(()=>{const u=g.trim().toLowerCase();return u?(re??[]).filter(j=>j.name.toLowerCase().includes(u)):re??[]},[re,g]).filter(u=>!v.has(u.id)),h=ne({mutationFn:u=>L.createSwimSession(u),onSuccess:(u,j)=>{t.invalidateQueries({queryKey:["swim_catalog"]}),i(!1),T(X()),s({title:j?.id?"SÃ©ance natation mise Ã  jour":"SÃ©ance natation crÃ©Ã©e"})}}),M=ne({mutationFn:u=>L.deleteSwimSession(u),onSuccess:()=>{t.invalidateQueries({queryKey:["swim_catalog"]}),m(null),s({title:"SÃ©ance supprimÃ©e"})},onError:()=>{s({title:"Suppression impossible",description:"Cette sÃ©ance est utilisÃ©e dans une assignation.",variant:"destructive"})}}),W=()=>{T(u=>({...u,blocks:[...u.blocks,{title:"Nouveau bloc",repetitions:1,description:"",modalities:"",equipment:[],exercises:[{repetitions:4,distance:50,rest:null,stroke:"crawl",strokeType:"nc",intensity:"V2",modalities:"",equipment:[]}]}]}))},k=(u,j,b)=>{const $=[...w.blocks];$[u]={...$[u],[j]:b},T({...w,blocks:$})},_=u=>{const j=w.blocks.filter((b,$)=>$!==u);T({...w,blocks:j})},D=(u,j)=>{const b=j==="up"?u-1:u+1;if(b<0||b>=w.blocks.length)return;const $=[...w.blocks],[z]=$.splice(u,1);$.splice(b,0,z),T({...w,blocks:$})},U=u=>{const j=[...w.blocks];j[u].exercises.push({repetitions:4,distance:50,rest:null,stroke:"crawl",strokeType:"nc",intensity:"V2",modalities:"",equipment:[]}),T({...w,blocks:j})},B=(u,j,b,$)=>{const z=[...w.blocks],se=[...z[u].exercises];se[j]={...se[j],[b]:$},z[u]={...z[u],exercises:se},T({...w,blocks:z})},me=(u,j)=>{const b=[...w.blocks];b[u].exercises=b[u].exercises.filter(($,z)=>z!==j),T({...w,blocks:b})},ge=[{value:"palmes",label:"Palmes"},{value:"tuba",label:"Tuba"},{value:"plaquettes",label:"Plaquettes"},{value:"pull",label:"Pull"},{value:"elastique",label:"Ã‰lastique"}],_e=[{value:"pap",label:"Papillon"},{value:"dos",label:"Dos"},{value:"brasse",label:"Brasse"},{value:"crawl",label:"Crawl"},{value:"4n",label:"4 nages"},{value:"spe",label:"SpÃ©"}],Ne=[{value:"nc",label:"NC"},{value:"educ",label:"Educ"},{value:"jambes",label:"Jambes"}];_e.reduce((u,j)=>(u[j.value]=j.label,u),{});const Ae=Ne.reduce((u,j)=>(u[j.value]=j.label,u),{});w.id;const ke=l.useMemo(()=>lt(xs(w.blocks)),[w.blocks]),Re={nc:"bg-sky-100 text-sky-900 ring-sky-200",educ:"bg-violet-100 text-violet-900 ring-violet-200",jambes:"bg-teal-100 text-teal-900 ring-teal-200"},V={V0:"text-emerald-800",V1:"text-lime-800",V2:"text-yellow-800",V3:"text-orange-800",Max:"text-red-900"},Z={V0:"ring-emerald-200",V1:"ring-lime-200",V2:"ring-yellow-200",V3:"ring-orange-200",Max:"ring-red-300"};return n?e.jsxs("div",{className:"animate-in slide-in-from-bottom-4 motion-reduce:animate-none",children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-border px-4 py-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{type:"button",onClick:()=>{i(!1),T(X())},className:"inline-flex h-9 w-9 items-center justify-center rounded-full hover:bg-muted","aria-label":"Retour",children:e.jsx(Rr,{className:"h-4 w-4"})}),e.jsx("div",{className:"text-base font-semibold",children:"Ã‰dition"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:()=>d({id:w.id??Date.now(),name:w.name,description:w.description,created_by:r??null,items:xs(w.blocks)}),className:"inline-flex h-9 w-9 items-center justify-center rounded-full hover:bg-muted","aria-label":"AperÃ§u nageur",title:"AperÃ§u nageur",children:e.jsx(Ms,{className:"h-4 w-4"})}),e.jsxs("button",{type:"button",onClick:()=>{if(!w.name.trim()){s({title:"Titre requis",description:"Ajoutez un nom de sÃ©ance avant d'enregistrer.",variant:"destructive"});return}h.mutate({id:w.id??void 0,name:w.name,description:w.description,estimated_duration:w.estimatedDuration||null,items:xs(w.blocks),created_by:r})},className:"inline-flex items-center gap-2 rounded-full bg-primary px-3 py-2 text-xs font-semibold text-primary-foreground",children:[e.jsx(Xe,{className:"h-4 w-4"})," Sauver"]})]})]}),e.jsxs("div",{className:"space-y-4 p-4",children:[e.jsx(q,{className:"rounded-2xl border-border",children:e.jsxs("div",{className:"space-y-3 p-4",children:[e.jsx("div",{className:"text-sm font-semibold",children:"Infos sÃ©ance"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"col-span-2",children:[e.jsx("div",{className:"text-xs font-semibold text-muted-foreground",children:"Nom"}),e.jsx("div",{className:"mt-1",children:e.jsx(O,{value:w.name,onChange:u=>T({...w,name:u.target.value}),placeholder:"Nom de la sÃ©ance",className:"rounded-2xl"})})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-semibold text-muted-foreground",children:"DurÃ©e estimÃ©e (min)"}),e.jsx("div",{className:"mt-1",children:e.jsx(O,{type:"number",min:0,value:w.estimatedDuration||"",onChange:u=>T({...w,estimatedDuration:u.target.value===""?0:Number(u.target.value)}),placeholder:"55",className:"rounded-2xl"})})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-semibold text-muted-foreground",children:"Distance totale"}),e.jsxs("div",{className:"mt-1 rounded-2xl border border-border bg-muted px-3 py-2 text-sm font-semibold",children:[ke,"m"]})]})]})]})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-sm font-semibold",children:"Vue coach"}),e.jsxs("div",{className:"inline-flex rounded-full border border-border bg-card p-1 text-xs font-semibold",children:[e.jsx("button",{type:"button",onClick:()=>I("compact"),className:F("rounded-full px-3 py-1",N==="compact"?"bg-primary text-primary-foreground":"text-muted-foreground"),children:"CondensÃ©"}),e.jsx("button",{type:"button",onClick:()=>I("detailed"),className:F("rounded-full px-3 py-1",N==="detailed"?"bg-primary text-primary-foreground":"text-muted-foreground"),children:"DÃ©tail"})]})]}),N==="compact"?e.jsx(q,{className:"rounded-2xl border-border",children:e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold",children:"Plan (ultra compact)"}),e.jsx("div",{className:"mt-1 text-xs text-muted-foreground",children:"Manipule les blocs vite. Passe en â€œDÃ©tailâ€ pour Ã©diter."})]}),e.jsxs(S,{variant:"secondary",size:"sm",onClick:W,className:"h-9 rounded-full px-3 text-xs",children:[e.jsx(pe,{className:"h-4 w-4"})," Bloc"]})]}),e.jsxs("div",{className:"mt-3 space-y-2",children:[w.blocks.map((u,j)=>e.jsx("div",{className:"rounded-2xl border border-border bg-card px-3 py-2",children:e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-primary px-2 py-0.5 text-[11px] font-semibold text-primary-foreground",children:["ðŸ” ",u.repetitions??1,"x"]}),e.jsx("div",{className:"truncate text-xs font-semibold",children:u.title?u.title:`Bloc ${j+1}`}),e.jsxs("div",{className:"text-[11px] text-muted-foreground",children:["Â· ",u.exercises.length," ex"]})]}),e.jsxs("div",{className:"mt-1 flex flex-wrap gap-1",children:[u.exercises.slice(0,4).map((b,$)=>{const z=Ke(b.intensity),se=Ae[b.strokeType]??b.strokeType;return e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-muted px-2 py-0.5 text-[11px] font-semibold text-muted-foreground",title:b.modalities?ia(b.modalities):"",children:[b.repetitions&&b.distance?`${b.repetitions}x`:"",b.distance?`${b.distance}m`:"â€”",e.jsx("span",{className:F("ml-1 inline-flex items-center rounded-full px-2 py-0.5 ring-1",Re[b.strokeType]??"bg-muted text-muted-foreground ring-border"),children:se}),e.jsxs("span",{className:F("ml-1 inline-flex items-center gap-1 rounded-full bg-card px-2 py-0.5 ring-1",Z[z],V[z]),children:[e.jsx("span",{className:F("h-2 w-2 rounded-full",Es[z]??"bg-slate-300")}),Ws(z)]})]},`${j}-${$}`)}),u.exercises.length>4?e.jsxs("span",{className:"text-[11px] text-muted-foreground",children:["+",u.exercises.length-4]}):null]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{type:"button",onClick:()=>D(j,"up"),className:"inline-flex h-9 w-9 items-center justify-center rounded-full hover:bg-muted disabled:opacity-40","aria-label":"Monter",title:"Monter",disabled:j===0,children:e.jsx(Fs,{className:"h-4 w-4"})}),e.jsx("button",{type:"button",onClick:()=>D(j,"down"),className:"inline-flex h-9 w-9 items-center justify-center rounded-full hover:bg-muted disabled:opacity-40","aria-label":"Descendre",title:"Descendre",disabled:j===w.blocks.length-1,children:e.jsx($s,{className:"h-4 w-4"})}),e.jsx("button",{type:"button",onClick:()=>_(j),className:"inline-flex h-9 w-9 items-center justify-center rounded-full text-destructive hover:bg-destructive/10","aria-label":"Supprimer bloc",title:"Supprimer bloc",children:e.jsx(je,{className:"h-4 w-4"})})]})]})},j)),w.blocks.length?null:e.jsx("div",{className:"rounded-2xl border border-dashed border-border bg-muted px-3 py-6 text-center text-sm text-muted-foreground",children:"Aucun bloc. Ajoute un bloc pour commencer."})]})]})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-sm font-semibold",children:"Ã‰dition dÃ©taillÃ©e"}),e.jsxs(S,{variant:"secondary",size:"sm",onClick:W,className:"h-9 rounded-full px-3 text-xs",children:[e.jsx(pe,{className:"h-4 w-4"})," Ajouter bloc"]})]}),e.jsx("div",{className:"space-y-4",children:w.blocks.map((u,j)=>e.jsx(q,{className:"rounded-2xl border-border",children:e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("span",{className:"mt-1 inline-flex h-9 w-9 items-center justify-center rounded-2xl bg-muted text-muted-foreground",children:e.jsx(ot,{className:"h-4 w-4"})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-xs font-semibold text-muted-foreground",children:"Titre bloc"}),e.jsx(O,{value:u.title,onChange:b=>k(j,"title",b.target.value),placeholder:`Bloc ${j+1}`,className:"rounded-2xl"})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{type:"button",onClick:()=>D(j,"up"),className:"inline-flex h-9 w-9 items-center justify-center rounded-full hover:bg-muted disabled:opacity-40","aria-label":"Monter",title:"Monter",disabled:j===0,children:e.jsx(Fs,{className:"h-4 w-4"})}),e.jsx("button",{type:"button",onClick:()=>D(j,"down"),className:"inline-flex h-9 w-9 items-center justify-center rounded-full hover:bg-muted disabled:opacity-40","aria-label":"Descendre",title:"Descendre",disabled:j===w.blocks.length-1,children:e.jsx($s,{className:"h-4 w-4"})}),e.jsx("button",{type:"button",onClick:()=>_(j),className:"inline-flex h-9 w-9 items-center justify-center rounded-full text-destructive hover:bg-destructive/10","aria-label":"Supprimer bloc",title:"Supprimer bloc",children:e.jsx(je,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"mt-3 grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-semibold text-muted-foreground",children:"RÃ©pÃ©titions du bloc"}),e.jsx("div",{className:"mt-1",children:e.jsx(O,{type:"number",min:1,value:u.repetitions??"",onChange:b=>k(j,"repetitions",b.target.value===""?null:Number(b.target.value)),placeholder:"1",className:"rounded-2xl"})})]}),e.jsx("div",{className:"flex items-end justify-end",children:e.jsxs(S,{variant:"secondary",size:"sm",onClick:()=>U(j),className:"h-9 rounded-full px-3 text-xs",children:[e.jsx(pe,{className:"h-4 w-4"})," Exercice"]})})]}),e.jsx("div",{className:"mt-4 space-y-3",children:u.exercises.map((b,$)=>{const z=Ke(b.intensity),se=b.modalities??"";return e.jsx("div",{className:"rounded-2xl border border-border bg-card p-3",children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"grid flex-1 grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-[11px] font-semibold text-muted-foreground",children:"RÃ©pÃ©titions"}),e.jsx("div",{className:"mt-1",children:e.jsx(O,{type:"number",min:1,value:b.repetitions??"",onChange:P=>B(j,$,"repetitions",P.target.value===""?null:Number(P.target.value)),className:"rounded-2xl"})})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-[11px] font-semibold text-muted-foreground",children:"Distance (m)"}),e.jsx("div",{className:"mt-1",children:e.jsx(O,{type:"number",min:0,value:b.distance??"",onChange:P=>B(j,$,"distance",P.target.value===""?null:Number(P.target.value)),className:"rounded-2xl"})})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-[11px] font-semibold text-muted-foreground",children:"Nage"}),e.jsx("div",{className:"mt-1",children:e.jsxs(ae,{value:b.stroke,onValueChange:P=>B(j,$,"stroke",P),children:[e.jsx(ie,{className:"rounded-2xl",children:e.jsx(le,{})}),e.jsx(oe,{children:_e.map(P=>e.jsx(G,{value:P.value,children:P.label},P.value))})]})})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-[11px] font-semibold text-muted-foreground",children:"Type"}),e.jsx("div",{className:"mt-1",children:e.jsxs(ae,{value:b.strokeType,onValueChange:P=>B(j,$,"strokeType",P),children:[e.jsx(ie,{className:"rounded-2xl",children:e.jsx(le,{})}),e.jsx(oe,{children:Ne.map(P=>e.jsx(G,{value:P.value,children:P.label},P.value))})]})})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-[11px] font-semibold text-muted-foreground",children:"IntensitÃ© (clic sur points)"}),e.jsxs("span",{className:F("inline-flex items-center gap-2 rounded-full bg-card px-2.5 py-1 text-xs font-semibold ring-1",Z[z],V[z]),children:[e.jsx("span",{className:F("h-2 w-2 rounded-full",Es[z]??"bg-slate-300")}),Ws(z)]})]}),e.jsx("div",{className:"mt-2 flex items-center justify-between gap-2",children:e.jsx(ra,{value:b.intensity,onChange:P=>B(j,$,"intensity",P)})})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("div",{className:"text-[11px] font-semibold text-muted-foreground",children:"Ã‰quipements"}),e.jsx("div",{className:"mt-2 flex flex-wrap gap-2",children:ge.map(P=>{const De=b.equipment.includes(P.value),fe=Jr(P.value);return e.jsxs("button",{type:"button",onClick:()=>{const os=De?b.equipment.filter(cs=>cs!==P.value):[...b.equipment,P.value];B(j,$,"equipment",os)},className:F("inline-flex items-center gap-2 rounded-full border px-3 py-2 text-xs font-semibold",De?"border-primary bg-primary text-primary-foreground":"border-border bg-card text-muted-foreground hover:bg-muted"),children:[e.jsx("span",{className:F("inline-flex h-7 w-7 items-center justify-center rounded-full",De?"bg-white/10":"bg-muted"),children:fe?e.jsx("img",{src:fe,alt:"",className:"h-4 w-4","aria-hidden":"true"}):null}),P.label]},P.value)})})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("div",{className:"text-[11px] font-semibold text-muted-foreground",children:"ModalitÃ©s"}),e.jsx("div",{className:"mt-1",children:e.jsx(Te,{value:se,onChange:P=>B(j,$,"modalities",P.target.value),placeholder:"Une modalitÃ© par ligne",rows:3,className:"rounded-2xl"})})]})]}),e.jsx("button",{type:"button",onClick:()=>me(j,$),className:"inline-flex h-9 w-9 items-center justify-center rounded-full text-destructive hover:bg-destructive/10","aria-label":"Supprimer exercice",title:"Supprimer exercice",children:e.jsx(je,{className:"h-4 w-4"})})]})},$)})}),e.jsxs("div",{className:"mt-4 flex items-center justify-between",children:[e.jsxs(S,{variant:"secondary",size:"sm",onClick:()=>U(j),className:"h-9 rounded-full px-3 text-xs",children:[e.jsx(pe,{className:"h-4 w-4"})," Ajouter exercice"]}),e.jsxs(S,{variant:"destructive",size:"sm",onClick:()=>_(j),className:"h-9 rounded-full px-3 text-xs",children:[e.jsx(je,{className:"h-4 w-4"})," Supprimer bloc"]})]})]})},j))})]}),e.jsx("div",{className:"h-8"})]}),e.jsx(Pe,{open:!!o,onOpenChange:u=>{u||d(null)},children:e.jsx(Me,{className:"max-w-4xl",children:e.jsx(Ps,{title:o?.name??"",description:o?.description??void 0,items:o?.items})})})]}):e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-border px-4 py-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-base font-semibold",children:"Coach"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"CrÃ©ation"})]}),e.jsxs("button",{type:"button",onClick:()=>{T(X()),I("compact"),i(!0)},className:"inline-flex items-center gap-2 rounded-full bg-primary px-3 py-2 text-xs font-semibold text-primary-foreground",children:[e.jsx(pe,{className:"h-4 w-4"})," Nouvelle"]})]}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 rounded-2xl border border-border bg-card px-3 py-2",children:[e.jsx(en,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("input",{className:"w-full bg-transparent text-sm outline-none placeholder:text-muted-foreground",placeholder:"Rechercher une sÃ©ance",value:g,onChange:u=>C(u.target.value)})]}),e.jsx("div",{className:"mt-4 space-y-3",children:be.map(u=>{const{totalDistance:j,totalDuration:b,blockCount:$}=oa(u),z=ca(u.id,E??null),se=!z||M.isPending;return e.jsx(q,{className:"rounded-2xl border-border",children:e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-base font-semibold tracking-tight",children:u.name}),e.jsxs("div",{className:"mt-1 flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx(Xr,{className:"h-3.5 w-3.5"}),j,"m"]}),e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx(sn,{className:"h-3.5 w-3.5"}),"~",b??"â€”"," min"]}),e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx(Yr,{className:"h-3.5 w-3.5"}),$]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:()=>d(u),className:"inline-flex h-9 w-9 items-center justify-center rounded-full hover:bg-muted","aria-label":"AperÃ§u nageur",title:"AperÃ§u nageur",children:e.jsx(Ms,{className:"h-4 w-4"})}),e.jsx("button",{type:"button",onClick:()=>{T({id:u.id??null,name:u.name??Ks(new Date),description:u.description??"",estimatedDuration:Number(u.estimated_duration??0),blocks:aa(u.items??[])}),I("compact"),i(!0)},className:"inline-flex h-9 w-9 items-center justify-center rounded-full hover:bg-muted","aria-label":"Modifier",title:"Modifier",children:e.jsx(yn,{className:"h-4 w-4"})}),e.jsx("button",{type:"button",onClick:()=>p(u),className:"inline-flex h-9 w-9 items-center justify-center rounded-full hover:bg-muted","aria-label":"Archiver",title:"Archiver",children:e.jsx(cn,{className:"h-4 w-4"})}),e.jsx("button",{type:"button",onClick:()=>{se||m(u)},className:F("inline-flex h-9 w-9 items-center justify-center rounded-full hover:bg-muted",se&&"cursor-not-allowed text-muted-foreground"),"aria-label":"Supprimer",title:E===null?"Suppression dÃ©sactivÃ©e":z?"Supprimer":"SÃ©ance dÃ©jÃ  assignÃ©e",children:e.jsx(je,{className:"h-4 w-4"})})]})]})})},u.id)})}),e.jsx("div",{className:"h-8"})]}),e.jsx(Pe,{open:!!o,onOpenChange:u=>{u||d(null)},children:e.jsx(Me,{className:"max-w-4xl",children:e.jsx(Ps,{title:o?.name??"",description:o?.description??void 0,items:o?.items})})}),e.jsx(Ze,{open:!!x,onOpenChange:u=>{u||p(null)},children:e.jsxs(Oe,{children:[e.jsxs(Ie,{children:[e.jsx(ze,{children:"Archiver la sÃ©ance ?"}),e.jsx(Ge,{children:"La sÃ©ance sera masquÃ©e du catalogue (sans suppression)."})]}),e.jsxs(qe,{children:[e.jsx(Be,{children:"Annuler"}),e.jsx(Le,{onClick:()=>{x&&(Y(u=>new Set([...Array.from(u),x.id])),p(null),s({title:"SÃ©ance archivÃ©e"}))},children:"Archiver"})]})]})}),e.jsx(Ze,{open:!!f,onOpenChange:u=>{u||m(null)},children:e.jsxs(Oe,{children:[e.jsxs(Ie,{children:[e.jsx(ze,{children:"Supprimer la sÃ©ance ?"}),e.jsx(Ge,{children:"Cette action est dÃ©finitive. La sÃ©ance sera supprimÃ©e du catalogue."})]}),e.jsxs(qe,{children:[e.jsx(Be,{children:"Annuler"}),e.jsx(Le,{onClick:()=>{f&&M.mutate(f.id)},children:"Supprimer"})]})]})})]})}function ua(s,t,{checkForDefaultPrevented:r=!0}={}){return function(n){if(s?.(n),r===!1||!n.defaultPrevented)return t?.(n)}}var ma=ss[" useInsertionEffect ".trim().toString()]||ts;function pa({prop:s,defaultProp:t,onChange:r=()=>{},caller:a}){const[n,i,o]=xa({defaultProp:t,onChange:r}),d=s!==void 0,f=d?s:n;{const x=l.useRef(s!==void 0);l.useEffect(()=>{const p=x.current;p!==d&&console.warn(`${a} is changing from ${p?"controlled":"uncontrolled"} to ${d?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),x.current=d},[d,a])}const m=l.useCallback(x=>{if(d){const p=ha(x)?x(s):x;p!==s&&o.current?.(p)}else i(x)},[d,s,i,o]);return[f,m]}function xa({defaultProp:s,onChange:t}){const[r,a]=l.useState(s),n=l.useRef(r),i=l.useRef(t);return ma(()=>{i.current=t},[t]),l.useEffect(()=>{n.current!==r&&(i.current?.(r),n.current=r)},[r,n]),[r,a,i]}function ha(s){return typeof s=="function"}var Bt="Toggle",ys=l.forwardRef((s,t)=>{const{pressed:r,defaultPressed:a,onPressedChange:n,...i}=s,[o,d]=pa({prop:r,onChange:n,defaultProp:a??!1,caller:Bt});return e.jsx(xe.button,{type:"button","aria-pressed":o,"data-state":o?"on":"off","data-disabled":s.disabled?"":void 0,...i,ref:t,onClick:ua(s.onClick,()=>{s.disabled||d(!o)})})});ys.displayName=Bt;var Kt=ys,ga=ss[" useInsertionEffect ".trim().toString()]||ts;function Ht({prop:s,defaultProp:t,onChange:r=()=>{},caller:a}){const[n,i,o]=fa({defaultProp:t,onChange:r}),d=s!==void 0,f=d?s:n;{const x=l.useRef(s!==void 0);l.useEffect(()=>{const p=x.current;p!==d&&console.warn(`${a} is changing from ${p?"controlled":"uncontrolled"} to ${d?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),x.current=d},[d,a])}const m=l.useCallback(x=>{if(d){const p=ja(x)?x(s):x;p!==s&&o.current?.(p)}else i(x)},[d,s,i,o]);return[f,m]}function fa({defaultProp:s,onChange:t}){const[r,a]=l.useState(s),n=l.useRef(r),i=l.useRef(t);return ga(()=>{i.current=t},[t]),l.useEffect(()=>{n.current!==r&&(i.current?.(r),n.current=r)},[r,n]),[r,a,i]}function ja(s){return typeof s=="function"}var ve="ToggleGroup",[Wt]=He(ve,[as]),Ut=as(),bs=ce.forwardRef((s,t)=>{const{type:r,...a}=s;if(r==="single"){const n=a;return e.jsx(va,{...n,ref:t})}if(r==="multiple"){const n=a;return e.jsx(ya,{...n,ref:t})}throw new Error(`Missing prop \`type\` expected on \`${ve}\``)});bs.displayName=ve;var[Qt,Jt]=Wt(ve),va=ce.forwardRef((s,t)=>{const{value:r,defaultValue:a,onValueChange:n=()=>{},...i}=s,[o,d]=Ht({prop:r,defaultProp:a??"",onChange:n,caller:ve});return e.jsx(Qt,{scope:s.__scopeToggleGroup,type:"single",value:ce.useMemo(()=>o?[o]:[],[o]),onItemActivate:d,onItemDeactivate:ce.useCallback(()=>d(""),[d]),children:e.jsx(Xt,{...i,ref:t})})}),ya=ce.forwardRef((s,t)=>{const{value:r,defaultValue:a,onValueChange:n=()=>{},...i}=s,[o,d]=Ht({prop:r,defaultProp:a??[],onChange:n,caller:ve}),f=ce.useCallback(x=>d((p=[])=>[...p,x]),[d]),m=ce.useCallback(x=>d((p=[])=>p.filter(g=>g!==x)),[d]);return e.jsx(Qt,{scope:s.__scopeToggleGroup,type:"multiple",value:o,onItemActivate:f,onItemDeactivate:m,children:e.jsx(Xt,{...i,ref:t})})});bs.displayName=ve;var[ba,Na]=Wt(ve),Xt=ce.forwardRef((s,t)=>{const{__scopeToggleGroup:r,disabled:a=!1,rovingFocus:n=!0,orientation:i,dir:o,loop:d=!0,...f}=s,m=Ut(r),x=Ys(o),p={role:"group",dir:x,...f};return e.jsx(ba,{scope:r,rovingFocus:n,disabled:a,children:n?e.jsx(at,{asChild:!0,...m,orientation:i,dir:x,loop:d,children:e.jsx(xe.div,{...p,ref:t})}):e.jsx(xe.div,{...p,ref:t})})}),es="ToggleGroupItem",Yt=ce.forwardRef((s,t)=>{const r=Jt(es,s.__scopeToggleGroup),a=Na(es,s.__scopeToggleGroup),n=Ut(s.__scopeToggleGroup),i=r.value.includes(s.value),o=a.disabled||s.disabled,d={...s,pressed:i,disabled:o},f=ce.useRef(null);return a.rovingFocus?e.jsx(it,{asChild:!0,...n,focusable:!o,active:i,ref:f,children:e.jsx(Js,{...d,ref:t})}):e.jsx(Js,{...d,ref:t})});Yt.displayName=es;var Js=ce.forwardRef((s,t)=>{const{__scopeToggleGroup:r,value:a,...n}=s,i=Jt(es,r),o={role:"radio","aria-checked":s.pressed,"aria-pressed":void 0},d=i.type==="single"?o:void 0;return e.jsx(ys,{...d,...n,ref:t,onPressedChange:f=>{f?i.onItemActivate(a):i.onItemDeactivate(a)}})}),Zt=bs,er=Yt;const sr=Dr("inline-flex items-center justify-center gap-2 rounded-md text-sm font-medium transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-transparent",outline:"border border-input bg-transparent shadow-sm hover:bg-accent hover:text-accent-foreground"},size:{default:"h-9 px-2 min-w-9",sm:"h-8 px-1.5 min-w-8",lg:"h-10 px-2.5 min-w-10"}},defaultVariants:{variant:"default",size:"default"}}),wa=l.forwardRef(({className:s,variant:t,size:r,...a},n)=>e.jsx(Kt,{ref:n,className:F(sr({variant:t,size:r,className:s})),...a}));wa.displayName=Kt.displayName;const tr=l.createContext({size:"default",variant:"default"}),rr=l.forwardRef(({className:s,variant:t,size:r,children:a,...n},i)=>e.jsx(Zt,{ref:i,className:F("flex items-center justify-center gap-1",s),...n,children:e.jsx(tr.Provider,{value:{variant:t,size:r},children:a})}));rr.displayName=Zt.displayName;const Ye=l.forwardRef(({className:s,children:t,variant:r,size:a,...n},i)=>{const o=l.useContext(tr);return e.jsx(er,{ref:i,className:F(sr({variant:o.variant||r,size:o.size||a}),s),...n,children:t})});Ye.displayName=er.displayName;const $e=({title:s,description:t,onBack:r,actions:a})=>e.jsxs("div",{className:"flex flex-wrap items-start justify-between gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs(S,{variant:"ghost",size:"sm",className:"-ml-2",onClick:r,children:[e.jsx(ln,{className:"mr-2 h-4 w-4"}),"Retour Ã  l'accueil"]}),e.jsx("h2",{className:"text-2xl font-display font-semibold uppercase italic text-primary",children:s}),t?e.jsx("p",{className:"text-sm text-muted-foreground",children:t}):null]}),a?e.jsx("div",{className:"flex items-center gap-2",children:a}):null]});function Fe(s,t,{checkForDefaultPrevented:r=!0}={}){return function(n){if(s?.(n),r===!1||!n.defaultPrevented)return t?.(n)}}function _a(s){const t=Ca(s),r=l.forwardRef((a,n)=>{const{children:i,...o}=a,d=l.Children.toArray(i),f=d.find(Aa);if(f){const m=f.props.children,x=d.map(p=>p===f?l.Children.count(m)>1?l.Children.only(null):l.isValidElement(m)?m.props.children:null:p);return e.jsx(t,{...o,ref:n,children:l.isValidElement(m)?l.cloneElement(m,void 0,x):null})}return e.jsx(t,{...o,ref:n,children:i})});return r.displayName=`${s}.Slot`,r}function Ca(s){const t=l.forwardRef((r,a)=>{const{children:n,...i}=r;if(l.isValidElement(n)){const o=Ra(n),d=ka(i,n.props);return n.type!==l.Fragment&&(d.ref=a?Er(a,o):o),l.cloneElement(n,d)}return l.Children.count(n)>1?l.Children.only(null):null});return t.displayName=`${s}.SlotClone`,t}var Sa=Symbol("radix.slottable");function Aa(s){return l.isValidElement(s)&&typeof s.type=="function"&&"__radixId"in s.type&&s.type.__radixId===Sa}function ka(s,t){const r={...t};for(const a in t){const n=s[a],i=t[a];/^on[A-Z]/.test(a)?n&&i?r[a]=(...d)=>{const f=i(...d);return n(...d),f}:n&&(r[a]=n):a==="style"?r[a]={...n,...i}:a==="className"&&(r[a]=[n,i].filter(Boolean).join(" "))}return{...s,...r}}function Ra(s){let t=Object.getOwnPropertyDescriptor(s.props,"ref")?.get,r=t&&"isReactWarning"in t&&t.isReactWarning;return r?s.ref:(t=Object.getOwnPropertyDescriptor(s,"ref")?.get,r=t&&"isReactWarning"in t&&t.isReactWarning,r?s.props.ref:s.props.ref||s.ref)}var Da=ss[" useInsertionEffect ".trim().toString()]||ts;function Ea({prop:s,defaultProp:t,onChange:r=()=>{},caller:a}){const[n,i,o]=Pa({defaultProp:t,onChange:r}),d=s!==void 0,f=d?s:n;{const x=l.useRef(s!==void 0);l.useEffect(()=>{const p=x.current;p!==d&&console.warn(`${a} is changing from ${p?"controlled":"uncontrolled"} to ${d?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),x.current=d},[d,a])}const m=l.useCallback(x=>{if(d){const p=Ma(x)?x(s):x;p!==s&&o.current?.(p)}else i(x)},[d,s,i,o]);return[f,m]}function Pa({defaultProp:s,onChange:t}){const[r,a]=l.useState(s),n=l.useRef(r),i=l.useRef(t);return Da(()=>{i.current=t},[t]),l.useEffect(()=>{n.current!==r&&(i.current?.(r),n.current=r)},[r,n]),[r,a,i]}function Ma(s){return typeof s=="function"}var ls="Popover",[nr]=He(ls,[rt]),We=rt(),[Ta,ye]=nr(ls),ar=s=>{const{__scopePopover:t,children:r,open:a,defaultOpen:n,onOpenChange:i,modal:o=!1}=s,d=We(t),f=l.useRef(null),[m,x]=l.useState(!1),[p,g]=Ea({prop:a,defaultProp:n??!1,onChange:i,caller:ls});return e.jsx(Pr,{...d,children:e.jsx(Ta,{scope:t,contentId:Mr(),triggerRef:f,open:p,onOpenChange:g,onOpenToggle:l.useCallback(()=>g(C=>!C),[g]),hasCustomAnchor:m,onCustomAnchorAdd:l.useCallback(()=>x(!0),[]),onCustomAnchorRemove:l.useCallback(()=>x(!1),[]),modal:o,children:r})})};ar.displayName=ls;var ir="PopoverAnchor",$a=l.forwardRef((s,t)=>{const{__scopePopover:r,...a}=s,n=ye(ir,r),i=We(r),{onCustomAnchorAdd:o,onCustomAnchorRemove:d}=n;return l.useEffect(()=>(o(),()=>d()),[o,d]),e.jsx(nt,{...i,...a,ref:t})});$a.displayName=ir;var lr="PopoverTrigger",or=l.forwardRef((s,t)=>{const{__scopePopover:r,...a}=s,n=ye(lr,r),i=We(r),o=we(t,n.triggerRef),d=e.jsx(xe.button,{type:"button","aria-haspopup":"dialog","aria-expanded":n.open,"aria-controls":n.contentId,"data-state":pr(n.open),...a,ref:o,onClick:Fe(s.onClick,n.onOpenToggle)});return n.hasCustomAnchor?d:e.jsx(nt,{asChild:!0,...i,children:d})});or.displayName=lr;var Ns="PopoverPortal",[Fa,Va]=nr(Ns,{forceMount:void 0}),cr=s=>{const{__scopePopover:t,forceMount:r,children:a,container:n}=s,i=ye(Ns,t);return e.jsx(Fa,{scope:t,forceMount:r,children:e.jsx(js,{present:r||i.open,children:e.jsx(Tr,{asChild:!0,container:n,children:a})})})};cr.displayName=Ns;var Se="PopoverContent",dr=l.forwardRef((s,t)=>{const r=Va(Se,s.__scopePopover),{forceMount:a=r.forceMount,...n}=s,i=ye(Se,s.__scopePopover);return e.jsx(js,{present:a||i.open,children:i.modal?e.jsx(Ia,{...n,ref:t}):e.jsx(qa,{...n,ref:t})})});dr.displayName=Se;var Oa=_a("PopoverContent.RemoveScroll"),Ia=l.forwardRef((s,t)=>{const r=ye(Se,s.__scopePopover),a=l.useRef(null),n=we(t,a),i=l.useRef(!1);return l.useEffect(()=>{const o=a.current;if(o)return $r(o)},[]),e.jsx(Fr,{as:Oa,allowPinchZoom:!0,children:e.jsx(ur,{...s,ref:n,trapFocus:r.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:Fe(s.onCloseAutoFocus,o=>{o.preventDefault(),i.current||r.triggerRef.current?.focus()}),onPointerDownOutside:Fe(s.onPointerDownOutside,o=>{const d=o.detail.originalEvent,f=d.button===0&&d.ctrlKey===!0,m=d.button===2||f;i.current=m},{checkForDefaultPrevented:!1}),onFocusOutside:Fe(s.onFocusOutside,o=>o.preventDefault(),{checkForDefaultPrevented:!1})})})}),qa=l.forwardRef((s,t)=>{const r=ye(Se,s.__scopePopover),a=l.useRef(!1),n=l.useRef(!1);return e.jsx(ur,{...s,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:i=>{s.onCloseAutoFocus?.(i),i.defaultPrevented||(a.current||r.triggerRef.current?.focus(),i.preventDefault()),a.current=!1,n.current=!1},onInteractOutside:i=>{s.onInteractOutside?.(i),i.defaultPrevented||(a.current=!0,i.detail.originalEvent.type==="pointerdown"&&(n.current=!0));const o=i.target;r.triggerRef.current?.contains(o)&&i.preventDefault(),i.detail.originalEvent.type==="focusin"&&n.current&&i.preventDefault()}})}),ur=l.forwardRef((s,t)=>{const{__scopePopover:r,trapFocus:a,onOpenAutoFocus:n,onCloseAutoFocus:i,disableOutsidePointerEvents:o,onEscapeKeyDown:d,onPointerDownOutside:f,onFocusOutside:m,onInteractOutside:x,...p}=s,g=ye(Se,r),C=We(r);return Vr(),e.jsx(Or,{asChild:!0,loop:!0,trapped:a,onMountAutoFocus:n,onUnmountAutoFocus:i,children:e.jsx(Ir,{asChild:!0,disableOutsidePointerEvents:o,onInteractOutside:x,onEscapeKeyDown:d,onPointerDownOutside:f,onFocusOutside:m,onDismiss:()=>g.onOpenChange(!1),children:e.jsx(qr,{"data-state":pr(g.open),role:"dialog",id:g.contentId,...C,...p,ref:t,style:{...p.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}})})})}),mr="PopoverClose",za=l.forwardRef((s,t)=>{const{__scopePopover:r,...a}=s,n=ye(mr,r);return e.jsx(xe.button,{type:"button",...a,ref:t,onClick:Fe(s.onClick,()=>n.onOpenChange(!1))})});za.displayName=mr;var Ga="PopoverArrow",La=l.forwardRef((s,t)=>{const{__scopePopover:r,...a}=s,n=We(r);return e.jsx(zr,{...n,...a,ref:t})});La.displayName=Ga;function pr(s){return s?"open":"closed"}var Ba=ar,Ka=or,Ha=cr,xr=dr;const Wa=Ba,Ua=Ka,hr=l.forwardRef(({className:s,align:t="center",sideOffset:r=4,...a},n)=>e.jsx(Ha,{children:e.jsx(xr,{ref:n,align:t,sideOffset:r,className:F("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-popover-content-transform-origin]",s),...a})}));hr.displayName=xr.displayName;const Qa=({onBack:s,swimSessions:t,strengthSessions:r,athletes:a,groups:n})=>{const{toast:i}=rs(),[o,d]=l.useState({session_type:"swim",session_id:"",assigned_date:new Date().toISOString().split("T")[0],assigned_slot:"morning"}),[f,m]=l.useState(!1),[x,p]=l.useState("user"),[g,C]=l.useState(""),[N,I]=l.useState([]),v=h=>{const M=typeof h=="number"?h:Number(h);return Number.isFinite(M)&&M>0?M:null},Y=l.useMemo(()=>a.map(h=>({value:h.id?`id:${h.id}`:`name:${h.display_name}`,label:h.group_label?`${h.display_name} Â· ${h.group_label}`:h.display_name,id:h.id,name:h.display_name})),[a]),X=l.useMemo(()=>new Map(Y.map(h=>[h.value,h])),[Y]),w=l.useMemo(()=>n.map(h=>{const M=v(h.id);return M?{...h,gid:M}:null}).filter(h=>!!h),[n]),T=l.useMemo(()=>w.filter(h=>N.includes(h.gid)),[w,N]),re=l.useMemo(()=>{if(T.length===0)return"Choisir des groupes";const h=T.slice(0,2).map(W=>W.name).join(", "),M=T.length>2?` +${T.length-2}`:"";return`${h}${M}`},[T]),E=ne({mutationFn:async h=>L.assignments_create(h),onSuccess:()=>{i({title:"SÃ©ance assignÃ©e & notifiÃ©e"})},onError:h=>{const M="Impossible d'assigner la sÃ©ance. VÃ©rifiez les champs et rÃ©essayez.",W=h instanceof Error?h.message:typeof h=="string"?h:M;let k=W;const _=W.match(/HTTP \d+:\s*(\{.*\})/);if(_)try{k=JSON.parse(_[1])?.error||M}catch{k=M}i({title:"Erreur d'assignation",description:k})}}),ee=async()=>{const h=Number(o.session_id);if(!Number.isInteger(h)||h<=0){i({title:"SÃ©ance invalide",description:"SÃ©lectionnez une sÃ©ance valide."});return}if(x==="group"){if(N.length===0){i({title:"Groupe manquant",description:"SÃ©lectionnez au moins un groupe."});return}m(!0);try{const D={assignment_type:o.session_type,session_id:h,scheduled_date:o.assigned_date,scheduled_slot:o.assigned_slot},U=Array.from(new Set(N));await Promise.all(U.map(B=>L.assignments_create({...D,target_group_id:B}))),i({title:"SÃ©ance assignÃ©e & notifiÃ©e"})}catch(D){const U="Impossible d'assigner la sÃ©ance. VÃ©rifiez les champs et rÃ©essayez.",B=D instanceof Error?D.message:typeof D=="string"?D:U;let me=B;const ge=B.match(/HTTP \d+:\s*(\{.*\})/);if(ge)try{me=JSON.parse(ge[1])?.error||U}catch{me=U}i({title:"Erreur d'assignation",description:me})}finally{m(!1)}return}const M=g.trim();if(!M){i({title:"Nageur manquant",description:"SÃ©lectionnez un nageur."});return}const W=X.get(M),k=W?.id??(Number.isFinite(Number(M))&&Number(M)>0?Number(M):void 0);if(!Number.isFinite(k)||Number(k)<=0){i({title:"Nageur invalide",description:"SÃ©lectionnez un nageur avec un identifiant valide."});return}const _=W?.name??M.replace(/^name:/,"");E.mutate({assignment_type:o.session_type,session_id:h,target_athlete:_,target_user_id:k,scheduled_date:o.assigned_date,scheduled_slot:o.assigned_slot})},be=!o.session_id||(x==="group"?N.length===0:!g.trim())||E.isPending||f;return e.jsxs("div",{className:"space-y-6 pb-24",children:[e.jsx($e,{title:"Assigner une sÃ©ance",description:"Planifiez une sÃ©ance pour un nageur ou un ou plusieurs groupes.",onBack:s}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-2",children:[e.jsxs(q,{className:"border-l-4 border-l-primary",children:[e.jsxs(H,{children:[e.jsx(Q,{children:"SÃ©ance"}),e.jsx(J,{children:"Choisissez le type et la sÃ©ance Ã  envoyer."})]}),e.jsxs(K,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{children:"Type"}),e.jsxs(ae,{value:o.session_type,onValueChange:h=>d({...o,session_type:h,session_id:""}),children:[e.jsx(ie,{children:e.jsx(le,{})}),e.jsxs(oe,{children:[e.jsx(G,{value:"swim",children:"Natation"}),e.jsx(G,{value:"strength",children:"Musculation"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{children:"SÃ©ance"}),e.jsxs(ae,{value:o.session_id,onValueChange:h=>d({...o,session_id:h}),children:[e.jsx(ie,{children:e.jsx(le,{placeholder:"Choisir..."})}),e.jsx(oe,{children:o.session_type==="swim"?t?.map(h=>e.jsx(G,{value:h.id.toString(),children:h.name},h.id)):r?.map(h=>e.jsx(G,{value:h.id.toString(),children:h.title},h.id))})]})]})]})]}),e.jsxs(q,{children:[e.jsxs(H,{children:[e.jsx(Q,{children:"Cible & planification"}),e.jsx(J,{children:"DÃ©finissez le destinataire, la date et le crÃ©neau."})]}),e.jsxs(K,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{children:"Cible"}),e.jsxs(ae,{value:x,onValueChange:h=>{p(h),C(""),I([])},children:[e.jsx(ie,{children:e.jsx(le,{})}),e.jsxs(oe,{children:[e.jsx(G,{value:"user",children:"Nageur"}),e.jsx(G,{value:"group",children:"Groupe(s)"})]})]})]}),x==="user"?e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{children:"Nageur"}),Y.length>0?e.jsxs(ae,{value:g,onValueChange:C,children:[e.jsx(ie,{children:e.jsx(le,{placeholder:"Choisir un nageur"})}),e.jsx(oe,{children:Y.map(h=>e.jsx(G,{value:h.value,children:h.label},h.value))})]}):e.jsx(O,{value:g,onChange:h=>C(h.target.value),placeholder:"ex: Camille"})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{children:"Groupes"}),n.length>0?e.jsxs(Wa,{children:[e.jsx(Ua,{asChild:!0,children:e.jsxs(S,{type:"button",variant:"outline",className:"w-full justify-between","aria-label":"SÃ©lection des groupes",children:[e.jsx("span",{className:"truncate",children:re}),e.jsx(Gr,{className:"ml-2 h-4 w-4 opacity-50"})]})}),e.jsxs(hr,{className:"w-[--radix-popover-trigger-width] p-2",align:"start",children:[e.jsx("div",{className:"max-h-64 overflow-auto",children:e.jsx("div",{className:"space-y-1",children:w.map(h=>{const M=N.includes(h.gid);return e.jsxs("label",{className:"flex cursor-pointer items-center gap-2 rounded-md px-2 py-1.5 hover:bg-muted",children:[e.jsx(hs,{checked:M,onCheckedChange:W=>{const k=W===!0;I(_=>k?_.includes(h.gid)?_:[..._,h.gid]:_.filter(D=>D!==h.gid))}}),e.jsx("span",{className:"text-sm",children:h.name})]},h.gid)})})}),N.length>0?e.jsx(S,{type:"button",variant:"ghost",size:"sm",className:"mt-2 w-full",onClick:()=>I([]),children:"Tout dÃ©sÃ©lectionner"}):null]})]}):e.jsx("div",{className:"text-xs text-muted-foreground",children:"Aucun groupe disponible."}),N.length>0?e.jsxs("div",{className:"text-xs text-muted-foreground",children:[N.length," groupe",N.length>1?"s":""," sÃ©lectionnÃ©",N.length>1?"s":"","."]}):null]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{children:"Date"}),e.jsx(O,{type:"date",value:o.assigned_date,onChange:h=>d({...o,assigned_date:h.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{children:"CrÃ©neau"}),e.jsxs(ae,{value:o.assigned_slot,onValueChange:h=>d({...o,assigned_slot:h}),children:[e.jsx(ie,{children:e.jsx(le,{placeholder:"Choisir..."})}),e.jsxs(oe,{children:[e.jsx(G,{value:"morning",children:"Matin"}),e.jsx(G,{value:"evening",children:"Soir"})]})]})]})]})]})]}),e.jsx("div",{className:"sticky bottom-0 z-10 -mx-4 border-t bg-background/95 p-4 backdrop-blur sm:static sm:mx-0 sm:border-0 sm:p-0",children:e.jsxs(S,{className:"w-full sm:w-auto",onClick:ee,disabled:be,children:[e.jsx(Ve,{className:"mr-2 h-4 w-4"}),E.isPending||f?"Assignation...":"Assigner & notifier"]})})]})},Ja=({onBack:s,athletes:t,groups:r,athletesLoading:a})=>{const{toast:n}=rs(),[i,o]=l.useState(""),[d,f]=l.useState("Message Coach"),[m,x]=l.useState(""),p=l.useMemo(()=>t.filter(v=>v.id).map(v=>({value:`user:${v.id}`,label:v.group_label?`${v.display_name} Â· ${v.group_label}`:v.display_name,id:v.id})),[t]),g=l.useMemo(()=>r.map(v=>({value:`group:${v.id}`,label:v.name,id:v.id})),[r]),C=l.useMemo(()=>new Map([...p,...g].map(v=>[v.value,v])),[p,g]),N=ne({mutationFn:v=>L.notifications_send({...v,type:"message"}),onSuccess:()=>{n({title:"Message envoyÃ©"}),o("")}}),I=()=>{if(!d.trim()||!i.trim()){n({title:"Message incomplet",description:"Ajoutez un titre et un contenu."});return}if(!m){n({title:"Destinataire manquant",description:"SÃ©lectionnez un nageur ou un groupe."});return}const v=C.get(m);if(!v?.id){n({title:"Destinataire invalide",description:"SÃ©lectionnez un destinataire valide."});return}if(m.startsWith("group:")){N.mutate({title:d,body:i,targets:[{target_group_id:v.id}]});return}N.mutate({title:d,body:i,targets:[{target_user_id:v.id}]})};return e.jsxs("div",{className:"space-y-6 pb-24",children:[e.jsx($e,{title:"Messagerie rapide",description:"Envoyez un message ciblÃ© Ã  vos nageurs.",onBack:s}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-2",children:[e.jsxs(q,{className:"border-l-4 border-l-primary",children:[e.jsxs(H,{children:[e.jsx(Q,{children:"Destinataire"}),e.jsx(J,{children:"SÃ©lectionnez un nageur ou un groupe Ã  prÃ©venir."})]}),e.jsx(K,{className:"space-y-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{children:"Destinataire"}),e.jsxs(ae,{value:m,onValueChange:x,children:[e.jsx(ie,{children:e.jsx(le,{placeholder:a?"Chargement...":"Choisir un nageur ou un groupe"})}),e.jsxs(oe,{children:[g.length?e.jsxs(e.Fragment,{children:[e.jsx(G,{value:"section-group",disabled:!0,children:"Groupes"}),g.map(v=>e.jsx(G,{value:v.value,children:v.label},v.value))]}):null,p.length?e.jsxs(e.Fragment,{children:[e.jsx(G,{value:"section-athlete",disabled:!0,children:"Nageurs"}),p.map(v=>e.jsx(G,{value:v.value,children:v.label},v.value))]}):null]})]})]})})]}),e.jsxs(q,{children:[e.jsxs(H,{children:[e.jsx(Q,{children:"Contenu"}),e.jsx(J,{children:"RÃ©digez votre message en quelques lignes."})]}),e.jsxs(K,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{htmlFor:"msg-title",children:"Titre"}),e.jsx(O,{id:"msg-title",value:d,onChange:v=>f(v.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{htmlFor:"msg-body",children:"Message"}),e.jsx(Te,{id:"msg-body",placeholder:"Message...",value:i,onChange:v=>o(v.target.value),rows:5,maxLength:500}),e.jsxs("div",{className:"text-xs text-muted-foreground text-right",children:[i.length,"/500"]})]})]})]})]}),e.jsx("div",{className:"sticky bottom-0 z-10 -mx-4 border-t bg-background/95 p-4 backdrop-blur sm:static sm:mx-0 sm:border-0 sm:p-0",children:e.jsxs(S,{className:"w-full sm:w-auto",onClick:I,disabled:N.isPending,children:[e.jsx(ns,{className:"mr-2 h-4 w-4"}),N.isPending?"Envoi...":"Envoyer"]})})]})},Xa=({onNavigate:s})=>e.jsxs(q,{className:"border-l-4 border-l-primary",children:[e.jsxs(H,{children:[e.jsx(Q,{children:"Actions rapides"}),e.jsx(J,{children:"AccÃ©lÃ©rez vos tÃ¢ches les plus frÃ©quentes."})]}),e.jsxs(K,{className:"grid gap-3 sm:grid-cols-2",children:[e.jsxs(S,{className:"justify-start",variant:"outline",onClick:()=>s("assignments"),children:[e.jsx(Ve,{className:"mr-2 h-4 w-4"}),"Assigner une sÃ©ance"]}),e.jsxs(S,{className:"justify-start",variant:"outline",onClick:()=>s("messaging"),children:[e.jsx(ns,{className:"mr-2 h-4 w-4"}),"Message rapide"]})]})]}),Ya=({onNavigate:s,onOpenRecordsAdmin:t,athletes:r,athletesLoading:a,upcomingBirthdays:n,birthdaysLoading:i,kpiLoading:o,kpiPeriod:d,onKpiPeriodChange:f,fatigueAlerts:m,mostLoadedAthlete:x})=>e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("h1",{className:"text-3xl font-display font-bold uppercase italic text-primary",children:"Espace Coach"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Votre tableau de bord pour gÃ©rer les sÃ©ances, les nageurs et la communication."})]}),e.jsxs("div",{className:"space-y-3 sm:hidden",children:[e.jsx("div",{children:e.jsx("h2",{className:"text-sm font-semibold uppercase tracking-[0.2em] text-muted-foreground",children:"Par oÃ¹ commencer"})}),e.jsxs("div",{className:"grid gap-3",children:[e.jsx("button",{type:"button",onClick:()=>s("swim"),className:"rounded-xl border bg-white p-4 text-left shadow-sm transition hover:border-primary focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold",children:"CrÃ©er une sÃ©ance natation"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Structurer un nouveau plan."})]}),e.jsx(Rs,{className:"h-5 w-5 text-primary"})]})}),e.jsx("button",{type:"button",onClick:()=>s("assignments"),className:"rounded-xl border bg-white p-4 text-left shadow-sm transition hover:border-primary focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold",children:"Assigner une sÃ©ance"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Envoyer une sÃ©ance Ã  un nageur."})]}),e.jsx(Ve,{className:"h-5 w-5 text-primary"})]})}),e.jsx("button",{type:"button",onClick:()=>s("messaging"),className:"rounded-xl border bg-white p-4 text-left shadow-sm transition hover:border-primary focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold",children:"Envoyer un message"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Relancer ou fÃ©liciter un nageur."})]}),e.jsx(ns,{className:"h-5 w-5 text-primary"})]})})]})]}),e.jsx("div",{className:"hidden sm:block",children:e.jsx(Xa,{onNavigate:s})}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsxs(q,{className:"shadow-sm",children:[e.jsxs(H,{children:[e.jsxs(Q,{className:"flex items-center gap-2",children:[e.jsx(Rs,{className:"h-5 w-5 text-primary"}),"Natation"]}),e.jsx(J,{children:"Consultez et crÃ©ez des sÃ©ances natation."})]}),e.jsx(K,{children:e.jsx(S,{className:"w-full",onClick:()=>s("swim"),children:"AccÃ©der Ã  la bibliothÃ¨que"})})]}),e.jsxs(q,{className:"shadow-sm",children:[e.jsxs(H,{children:[e.jsxs(Q,{className:"flex items-center gap-2",children:[e.jsx(Br,{className:"h-5 w-5 text-primary"}),"Musculation"]}),e.jsx(J,{children:"PrÃ©parez les plans muscu et les suivis."})]}),e.jsx(K,{children:e.jsx(S,{className:"w-full",onClick:()=>s("strength"),children:"AccÃ©der Ã  la bibliothÃ¨que"})})]}),e.jsxs(q,{className:"shadow-sm",children:[e.jsxs(H,{children:[e.jsxs(Q,{className:"flex items-center gap-2",children:[e.jsx(Je,{className:"h-5 w-5 text-primary"}),"Mes nageurs"]}),e.jsx(J,{children:"AccÃ©dez aux fiches individuelles et aux groupes."})]}),e.jsx(K,{children:e.jsx(S,{className:"w-full",onClick:()=>s("swimmers"),children:"Voir les nageurs"})})]}),e.jsxs(q,{className:"shadow-sm",children:[e.jsxs(H,{children:[e.jsxs(Q,{className:"flex items-center gap-2",children:[e.jsx(Kr,{className:"h-5 w-5 text-primary"}),"Records club"]}),e.jsx(J,{children:"Importer les performances FFN et reconstruire les records."})]}),e.jsx(K,{children:e.jsx(S,{className:"w-full",variant:"outline",onClick:t,children:"Administration des records"})})]})]}),e.jsxs("div",{className:"grid gap-4 lg:grid-cols-2",children:[e.jsxs(q,{className:"sm:hidden bg-primary text-primary-foreground",children:[e.jsxs(H,{className:"space-y-1",children:[e.jsx(Q,{className:"text-base",children:"Indicateurs clÃ©s"}),e.jsx(J,{className:"text-primary-foreground/70",children:"SynthÃ¨se rapide pour aujourd'hui."})]}),e.jsxs(K,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between rounded-lg border border-primary-foreground/10 bg-primary-foreground/5 p-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.2em] text-primary-foreground/70",children:"Fatigue 5/5"}),e.jsx("p",{className:"text-2xl font-semibold",children:o?"â€¦":m.length}),e.jsx("p",{className:"text-xs text-primary-foreground/70",children:o?"Chargement...":m.length?m.slice(0,2).map(p=>p.athleteName).join(", "):"Aucune alerte"})]}),e.jsx(Vs,{className:"h-5 w-5 text-primary-foreground/70"})]}),e.jsxs("div",{className:"flex items-center justify-between rounded-lg border border-primary-foreground/10 bg-primary-foreground/5 p-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.2em] text-primary-foreground/70",children:"Nageur le plus chargÃ©"}),e.jsx("p",{className:"text-lg font-semibold",children:o?"â€¦":x?.athleteName??"-"}),e.jsx("p",{className:"text-xs text-primary-foreground/70",children:o?"Calcul en cours":x?`Charge ${Math.round(x.loadScore)}`:"Pas de donnÃ©es rÃ©centes"})]}),e.jsx(Je,{className:"h-5 w-5 text-primary-foreground/70"})]})]})]}),e.jsxs(q,{className:"hidden sm:block",children:[e.jsx(H,{className:"space-y-2",children:e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(Q,{children:"Signaux clÃ©s"}),e.jsx(J,{children:"Vue d'ensemble rapide de votre groupe."})]}),e.jsxs(rr,{type:"single",size:"sm",variant:"outline",value:String(d),onValueChange:p=>{p&&f(Number(p))},children:[e.jsx(Ye,{value:"7","aria-label":"PÃ©riode 7 jours",children:"7j"}),e.jsx(Ye,{value:"30","aria-label":"PÃ©riode 30 jours",children:"30j"}),e.jsx(Ye,{value:"365","aria-label":"PÃ©riode 365 jours",children:"365j"})]})]})}),e.jsxs(K,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between rounded-lg border bg-muted/30 p-3",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Fatigue 5/5 (",d,"j)"]}),e.jsx("p",{className:"text-xl font-semibold",children:o?"â€¦":m.length}),e.jsx("p",{className:"text-xs text-muted-foreground",children:o?"Chargement...":m.length?m.slice(0,2).map(p=>p.athleteName).join(", "):"Aucune alerte"})]}),e.jsx(Vs,{className:"h-5 w-5 text-muted-foreground"})]}),e.jsxs("div",{className:"flex items-center justify-between rounded-lg border bg-muted/30 p-3",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Nageur le plus chargÃ© (",d,"j)"]}),e.jsx("p",{className:"text-xl font-semibold",children:o?"â€¦":x?.athleteName??"-"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:o?"Calcul en cours":x?`Charge ${Math.round(x.loadScore)}`:"Pas de donnÃ©es rÃ©centes"})]}),e.jsx(Je,{className:"h-5 w-5 text-muted-foreground"})]})]})]}),e.jsxs(q,{children:[e.jsxs(H,{children:[e.jsx(Q,{children:"Anniversaires Ã  venir"}),e.jsx(J,{children:"Les 30 prochains jours."})]}),e.jsxs(K,{className:"space-y-3",children:[i?e.jsx("p",{className:"text-sm text-muted-foreground",children:"Chargement..."}):n&&n.length>0?n.slice(0,3).map(p=>e.jsxs("div",{className:"flex items-center justify-between rounded-lg border p-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:p.display_name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:Za(p.next_birthday)})]}),e.jsxs("span",{className:"text-xs font-semibold text-primary",children:["J-",p.days_until]})]},p.id)):e.jsx("p",{className:"text-sm text-muted-foreground",children:"Aucun anniversaire dans les 30 prochains jours."}),e.jsx(S,{variant:"outline",className:"w-full",onClick:()=>s("swimmers"),children:"Voir tous les nageurs"})]})]})]})]}),Za=s=>{if(!s)return"-";const t=new Date(s);return Number.isNaN(t.getTime())?s:t.toLocaleDateString("fr-FR")},Xs=s=>s.toISOString().split("T")[0],ei=s=>new Date(s.completed_at||s.started_at||s.date||s.created_at||0).getTime(),si=s=>{if(!s.length)return null;const t=s.reduce((a,n)=>a+n,0)/s.length,r=Math.min(5,Math.max(1,Math.round(t/10*5)));return{average:t,rating:r}};function hi(){const s=Qe(E=>E.role);Qe(E=>E.selectedAthleteId);const t=Qe(E=>E.setSelectedAthlete),[,r]=Lr(),[a,n]=l.useState("home"),[i,o]=l.useState(7),d=s==="coach"||s==="admin",f=a==="assignments",m=a==="home"||a==="assignments"||a==="messaging"||a==="swimmers",x=a==="assignments"||a==="messaging",p=a==="home"||a==="swimmers",{data:g}=de({queryKey:["swim_catalog"],queryFn:()=>L.getSwimCatalog(),enabled:d&&f}),{data:C}=de({queryKey:["strength_catalog"],queryFn:()=>L.getStrengthSessions(),enabled:d&&f}),{data:N=[],isLoading:I}=de({queryKey:["athletes"],queryFn:()=>L.getAthletes(),enabled:d&&m}),v=l.useMemo(()=>N.slice(0,5),[N]),{data:Y=[]}=de({queryKey:["groups"],queryFn:()=>L.getGroups(),enabled:d&&x}),X=de({queryKey:["upcoming-birthdays"],queryFn:()=>L.getUpcomingBirthdays({days:30}),enabled:d&&p}),w=X.data,T=de({queryKey:["coach-kpis",i,v.map(E=>E.id??E.display_name)],enabled:d&&a==="home"&&v.length>0,queryFn:async()=>{const E=i,ee=new Date;ee.setDate(ee.getDate()-E);const be=Xs(ee),h=Xs(new Date),M=await Promise.all(v.map(async _=>{const[D,U]=await Promise.all([L.getSessions(_.display_name,_.id),L.getStrengthHistory(_.display_name,{athleteId:_.id,limit:50,from:be,to:h})]),B=D.filter(V=>new Date(V.date).getTime()>=ee.getTime()),me=B.map(V=>V.fatigue??V.feeling).filter(V=>Number.isFinite(V)),ge=B.reduce((V,Z)=>V+(Number(Z.duration)||0)*(Number(Z.effort)||0),0),Ne=(U?.runs??[]).filter(V=>ei(V)>=ee.getTime()),Ae=Ne.map(V=>V.fatigue??V.feeling??V.rpe).filter(V=>Number.isFinite(Number(V))).map(V=>Number(V)),ke=Ne.reduce((V,Z)=>{const u=Number(Z.feeling??Z.rpe??0),j=Number(Z.duration??0);if(j>0&&u>0)return V+j*u;const b=Array.isArray(Z.logs)?Z.logs.length:0;return V+b*5},0),Re=si([...me,...Ae]);return{athleteName:_.display_name,loadScore:ge+ke,fatigueRating:Re}})),W=M.filter(_=>_.fatigueRating?.rating===5).map(_=>({athleteName:_.athleteName,rating:_.fatigueRating?.rating??0})),k=M.filter(_=>_.loadScore>0).sort((_,D)=>D.loadScore-_.loadScore)[0];return{fatigueAlerts:W,mostLoadedAthlete:k??null}}}),re=E=>{t({id:E.id??null,name:E.display_name}),r("/progress")};return d?e.jsxs("div",{className:"space-y-6",children:[a==="home"?e.jsx(Ya,{onNavigate:n,onOpenRecordsAdmin:()=>r("/records-admin"),athletes:N,athletesLoading:I,upcomingBirthdays:w,birthdaysLoading:X.isLoading,kpiLoading:T.isLoading,kpiPeriod:i,onKpiPeriodChange:o,fatigueAlerts:T.data?.fatigueAlerts??[],mostLoadedAthlete:T.data?.mostLoadedAthlete??null}):null,a==="assignments"?e.jsx(Qa,{onBack:()=>n("home"),swimSessions:g,strengthSessions:C,athletes:N,groups:Y}):null,a==="swim"?e.jsxs("div",{className:"space-y-6",children:[e.jsx($e,{title:"BibliothÃ¨que natation",description:"AccÃ©dez aux sÃ©ances et aux templates natation.",onBack:()=>n("home"),actions:e.jsxs(S,{variant:"outline",onClick:()=>n("assignments"),children:[e.jsx(Ve,{className:"mr-2 h-4 w-4"}),"Nouvelle assignation"]})}),e.jsx(da,{})]}):null,a==="strength"?e.jsxs("div",{className:"space-y-6",children:[e.jsx($e,{title:"BibliothÃ¨que musculation",description:"Consultez et crÃ©ez des sÃ©ances musculation.",onBack:()=>n("home"),actions:e.jsxs(S,{variant:"outline",onClick:()=>n("assignments"),children:[e.jsx(Ve,{className:"mr-2 h-4 w-4"}),"Nouvelle assignation"]})}),e.jsx(ea,{})]}):null,a==="swimmers"?e.jsxs("div",{className:"space-y-6",children:[e.jsx($e,{title:"Nageurs",description:"AccÃ©dez aux fiches individuelles des nageurs.",onBack:()=>n("home"),actions:e.jsxs(S,{variant:"outline",onClick:()=>n("messaging"),children:[e.jsx(ns,{className:"mr-2 h-4 w-4"}),"Message rapide"]})}),e.jsxs(q,{children:[e.jsxs(H,{children:[e.jsx(Q,{children:"Suivi des Nageurs"}),e.jsx(J,{children:"AccÃ©dez aux fiches individuelles des nageurs."})]}),e.jsx(K,{children:I?e.jsx("div",{className:"space-y-3 p-2",children:[1,2,3,4,5].map(E=>e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-4 w-1/3 rounded-lg bg-muted animate-pulse"}),e.jsx("div",{className:"h-4 w-1/4 rounded-lg bg-muted animate-pulse"}),e.jsx("div",{className:"ml-auto h-8 w-16 rounded-lg bg-muted animate-pulse"})]},E))}):N.length?e.jsx("div",{className:"w-full overflow-x-auto",children:e.jsxs(tn,{children:[e.jsx(rn,{children:e.jsxs(Ts,{children:[e.jsx(ms,{children:"Nageur"}),e.jsx(ms,{children:"Groupe"}),e.jsx(ms,{className:"text-right",children:"Fiche"})]})}),e.jsx(nn,{children:N.map(E=>e.jsxs(Ts,{children:[e.jsx(ps,{className:"font-medium",children:E.display_name}),e.jsx(ps,{children:E.group_label?e.jsx(an,{variant:"secondary",children:E.group_label}):e.jsx("span",{className:"text-xs text-muted-foreground",children:"Sans groupe"})}),e.jsx(ps,{className:"text-right",children:e.jsx(S,{size:"sm",variant:"outline",onClick:()=>re(E),children:"Voir la fiche"})})]},E.id??E.display_name))})]})}):e.jsx("p",{className:"text-sm text-muted-foreground",children:"Aucun nageur disponible."})})]})]}):null,a==="messaging"?e.jsx(Ja,{onBack:()=>n("home"),athletes:N,groups:Y,athletesLoading:I}):null]}):e.jsx("div",{className:"flex items-center justify-center min-h-[60vh] animate-in fade-in motion-reduce:animate-none",children:e.jsxs(q,{className:"w-full max-w-sm shadow-xl border-t-4 border-t-primary",children:[e.jsxs(H,{children:[e.jsxs(Q,{className:"flex items-center gap-2 uppercase italic",children:[e.jsx(Je,{className:"h-5 w-5 text-primary"}),"AccÃ¨s Coach"]}),e.jsx(J,{children:"Cette section est rÃ©servÃ©e aux coachs et administrateurs."})]}),e.jsx(K,{children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"Connectez-vous avec un compte autorisÃ© pour accÃ©der aux outils de gestion."})})]})})}export{hi as default};
