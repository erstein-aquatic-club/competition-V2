import{R as u,T as Ts,L as ks,G as Ds,H as Ms,J as As,r as m,O as Is,j as e}from"./vendor-ui-C9ymspZo.js";import{b as Os,u as mt,d as $s,c as lt}from"./vendor-query-kM2vrB_e.js";import{i as Wt,c as je,j as as,D as nt,B as F,C as Xe,b as Ct,d as Pt,f as is,g as Rt,L as ct,p as Ps,X as Et,q as Ls,u as Fs,I as Dt,h as Re}from"./index-DyhSvoHd.js";import{S as Lt,a as Ft,b as Ht,c as zt,d as Hs}from"./sheet-CyPl_99Z.js";import{S as Bt}from"./switch-BAFmqKci.js";import{S as zs,a as Bs,b as qs,c as Vs,d as wt}from"./select-DcrLHPk3.js";import{T as Us,a as Ws,b as Qt,c as Yt}from"./tabs-CNqrY0-T.js";import{B as gt}from"./badge-D5tL-BqK.js";import{S as we}from"./skeleton-zjyCU9Pc.js";import{A as Ks,a as Qs,b as Ys,c as Xs,d as Gs,e as Js,f as Zs,g as en,P as Xt}from"./alert-dialog-CjZHxN22.js";import{B as os,C as qt,I as tn}from"./BottomActionBar-qrLud0NW.js";import{L as sn}from"./loader-circle-CQzZdFsl.js";import{C as nn}from"./circle-check-CsAwvxZ7.js";import{S as rn}from"./sticky-note-CruxHw7p.js";import{C as Gt}from"./check-Cvl0kt7P.js";import{T as an}from"./timer-CJxxSLjU.js";import{C as on}from"./circle-alert-BODcF10m.js";import{S as ln}from"./search-DpVOzh3L.js";import{C as Jt}from"./chevron-left-BWeGGh-L.js";import{f as jt}from"./fr-CqUxEDd2.js";import{f as Nt}from"./vendor-date-cQbdWov0.js";import"./vendor-react-BzrpNAyj.js";import"./vendor-charts-DSuxWnoS.js";import"./vendor-supabase-B2MyMyC0.js";import"./chevron-up-CaiKzshX.js";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cn=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],dn=Wt("calendar",cn);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const un=[["rect",{x:"14",y:"3",width:"5",height:"18",rx:"1",key:"kaeet6"}],["rect",{x:"5",y:"3",width:"5",height:"18",rx:"1",key:"1wsw3u"}]],mn=Wt("pause",un);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fn=[["path",{d:"M10 5H3",key:"1qgfaw"}],["path",{d:"M12 19H3",key:"yhmn1j"}],["path",{d:"M14 3v4",key:"1sua03"}],["path",{d:"M16 17v4",key:"1q0r14"}],["path",{d:"M21 12h-9",key:"1o4lsq"}],["path",{d:"M21 19h-5",key:"1rlt1p"}],["path",{d:"M21 5h-7",key:"1oszz2"}],["path",{d:"M8 10v4",key:"tgpxqk"}],["path",{d:"M8 12H3",key:"a7s4jb"}]],hn=Wt("sliders-horizontal",fn);function pn(t){if(typeof document>"u")return;let n=document.head||document.getElementsByTagName("head")[0],r=document.createElement("style");r.type="text/css",n.appendChild(r),r.styleSheet?r.styleSheet.cssText=t:r.appendChild(document.createTextNode(t))}const ls=u.createContext({drawerRef:{current:null},overlayRef:{current:null},onPress:()=>{},onRelease:()=>{},onDrag:()=>{},onNestedDrag:()=>{},onNestedOpenChange:()=>{},onNestedRelease:()=>{},openProp:void 0,dismissible:!1,isOpen:!1,isDragging:!1,keyboardIsOpen:{current:!1},snapPointsOffset:null,snapPoints:null,handleOnly:!1,modal:!1,shouldFade:!1,activeSnapPoint:null,onOpenChange:()=>{},setActiveSnapPoint:()=>{},closeDrawer:()=>{},direction:"bottom",shouldAnimate:{current:!0},shouldScaleBackground:!1,setBackgroundColorOnScale:!0,noBodyStyles:!1,container:null,autoFocus:!1}),vt=()=>{const t=u.useContext(ls);if(!t)throw new Error("useDrawerContext must be used within a Drawer.Root");return t};pn(`[data-vaul-drawer]{touch-action:none;will-change:transform;transition:transform .5s cubic-bezier(.32, .72, 0, 1);animation-duration:.5s;animation-timing-function:cubic-bezier(0.32,0.72,0,1)}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=bottom][data-state=open]{animation-name:slideFromBottom}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=bottom][data-state=closed]{animation-name:slideToBottom}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=top][data-state=open]{animation-name:slideFromTop}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=top][data-state=closed]{animation-name:slideToTop}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=left][data-state=open]{animation-name:slideFromLeft}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=left][data-state=closed]{animation-name:slideToLeft}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=right][data-state=open]{animation-name:slideFromRight}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=right][data-state=closed]{animation-name:slideToRight}[data-vaul-drawer][data-vaul-snap-points=true][data-vaul-drawer-direction=bottom]{transform:translate3d(0,var(--initial-transform,100%),0)}[data-vaul-drawer][data-vaul-snap-points=true][data-vaul-drawer-direction=top]{transform:translate3d(0,calc(var(--initial-transform,100%) * -1),0)}[data-vaul-drawer][data-vaul-snap-points=true][data-vaul-drawer-direction=left]{transform:translate3d(calc(var(--initial-transform,100%) * -1),0,0)}[data-vaul-drawer][data-vaul-snap-points=true][data-vaul-drawer-direction=right]{transform:translate3d(var(--initial-transform,100%),0,0)}[data-vaul-drawer][data-vaul-delayed-snap-points=true][data-vaul-drawer-direction=top]{transform:translate3d(0,var(--snap-point-height,0),0)}[data-vaul-drawer][data-vaul-delayed-snap-points=true][data-vaul-drawer-direction=bottom]{transform:translate3d(0,var(--snap-point-height,0),0)}[data-vaul-drawer][data-vaul-delayed-snap-points=true][data-vaul-drawer-direction=left]{transform:translate3d(var(--snap-point-height,0),0,0)}[data-vaul-drawer][data-vaul-delayed-snap-points=true][data-vaul-drawer-direction=right]{transform:translate3d(var(--snap-point-height,0),0,0)}[data-vaul-overlay][data-vaul-snap-points=false]{animation-duration:.5s;animation-timing-function:cubic-bezier(0.32,0.72,0,1)}[data-vaul-overlay][data-vaul-snap-points=false][data-state=open]{animation-name:fadeIn}[data-vaul-overlay][data-state=closed]{animation-name:fadeOut}[data-vaul-animate=false]{animation:none!important}[data-vaul-overlay][data-vaul-snap-points=true]{opacity:0;transition:opacity .5s cubic-bezier(.32, .72, 0, 1)}[data-vaul-overlay][data-vaul-snap-points=true]{opacity:1}[data-vaul-drawer]:not([data-vaul-custom-container=true])::after{content:'';position:absolute;background:inherit;background-color:inherit}[data-vaul-drawer][data-vaul-drawer-direction=top]::after{top:initial;bottom:100%;left:0;right:0;height:200%}[data-vaul-drawer][data-vaul-drawer-direction=bottom]::after{top:100%;bottom:initial;left:0;right:0;height:200%}[data-vaul-drawer][data-vaul-drawer-direction=left]::after{left:initial;right:100%;top:0;bottom:0;width:200%}[data-vaul-drawer][data-vaul-drawer-direction=right]::after{left:100%;right:initial;top:0;bottom:0;width:200%}[data-vaul-overlay][data-vaul-snap-points=true]:not([data-vaul-snap-points-overlay=true]):not(
[data-state=closed]
){opacity:0}[data-vaul-overlay][data-vaul-snap-points-overlay=true]{opacity:1}[data-vaul-handle]{display:block;position:relative;opacity:.7;background:#e2e2e4;margin-left:auto;margin-right:auto;height:5px;width:32px;border-radius:1rem;touch-action:pan-y}[data-vaul-handle]:active,[data-vaul-handle]:hover{opacity:1}[data-vaul-handle-hitarea]{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);width:max(100%,2.75rem);height:max(100%,2.75rem);touch-action:inherit}@media (hover:hover) and (pointer:fine){[data-vaul-drawer]{user-select:none}}@media (pointer:fine){[data-vaul-handle-hitarea]:{width:100%;height:100%}}@keyframes fadeIn{from{opacity:0}to{opacity:1}}@keyframes fadeOut{to{opacity:0}}@keyframes slideFromBottom{from{transform:translate3d(0,var(--initial-transform,100%),0)}to{transform:translate3d(0,0,0)}}@keyframes slideToBottom{to{transform:translate3d(0,var(--initial-transform,100%),0)}}@keyframes slideFromTop{from{transform:translate3d(0,calc(var(--initial-transform,100%) * -1),0)}to{transform:translate3d(0,0,0)}}@keyframes slideToTop{to{transform:translate3d(0,calc(var(--initial-transform,100%) * -1),0)}}@keyframes slideFromLeft{from{transform:translate3d(calc(var(--initial-transform,100%) * -1),0,0)}to{transform:translate3d(0,0,0)}}@keyframes slideToLeft{to{transform:translate3d(calc(var(--initial-transform,100%) * -1),0,0)}}@keyframes slideFromRight{from{transform:translate3d(var(--initial-transform,100%),0,0)}to{transform:translate3d(0,0,0)}}@keyframes slideToRight{to{transform:translate3d(var(--initial-transform,100%),0,0)}}`);function xn(){const t=navigator.userAgent;return typeof window<"u"&&(/Firefox/.test(t)&&/Mobile/.test(t)||/FxiOS/.test(t))}function gn(){return Kt(/^Mac/)}function vn(){return Kt(/^iPhone/)}function Zt(){return/^((?!chrome|android).)*safari/i.test(navigator.userAgent)}function yn(){return Kt(/^iPad/)||gn()&&navigator.maxTouchPoints>1}function cs(){return vn()||yn()}function Kt(t){return typeof window<"u"&&window.navigator!=null?t.test(window.navigator.platform):void 0}const bn=24,wn=typeof window<"u"?m.useLayoutEffect:m.useEffect;function es(...t){return(...n)=>{for(let r of t)typeof r=="function"&&r(...n)}}const Mt=typeof document<"u"&&window.visualViewport;function ts(t){let n=window.getComputedStyle(t);return/(auto|scroll)/.test(n.overflow+n.overflowX+n.overflowY)}function ds(t){for(ts(t)&&(t=t.parentElement);t&&!ts(t);)t=t.parentElement;return t||document.scrollingElement||document.documentElement}const jn=new Set(["checkbox","radio","range","color","file","image","button","submit","reset"]);let St=0,At;function Nn(t={}){let{isDisabled:n}=t;wn(()=>{if(!n)return St++,St===1&&cs()&&(At=Sn()),()=>{St--,St===0&&At?.()}},[n])}function Sn(){let t,n=0,r=S=>{t=ds(S.target),!(t===document.documentElement&&t===document.body)&&(n=S.changedTouches[0].pageY)},i=S=>{if(!t||t===document.documentElement||t===document.body){S.preventDefault();return}let w=S.changedTouches[0].pageY,B=t.scrollTop,U=t.scrollHeight-t.clientHeight;U!==0&&((B<=0&&w>n||B>=U&&w<n)&&S.preventDefault(),n=w)},l=S=>{let w=S.target;Vt(w)&&w!==document.activeElement&&(S.preventDefault(),w.style.transform="translateY(-2000px)",w.focus(),requestAnimationFrame(()=>{w.style.transform=""}))},o=S=>{let w=S.target;Vt(w)&&(w.style.transform="translateY(-2000px)",requestAnimationFrame(()=>{w.style.transform="",Mt&&(Mt.height<window.innerHeight?requestAnimationFrame(()=>{ss(w)}):Mt.addEventListener("resize",()=>ss(w),{once:!0}))}))},p=()=>{window.scrollTo(0,0)},x=window.pageXOffset,f=window.pageYOffset,T=es(_n(document.documentElement,"paddingRight",`${window.innerWidth-document.documentElement.clientWidth}px`));window.scrollTo(0,0);let v=es(ft(document,"touchstart",r,{passive:!1,capture:!0}),ft(document,"touchmove",i,{passive:!1,capture:!0}),ft(document,"touchend",l,{passive:!1,capture:!0}),ft(document,"focus",o,!0),ft(window,"scroll",p));return()=>{T(),v(),window.scrollTo(x,f)}}function _n(t,n,r){let i=t.style[n];return t.style[n]=r,()=>{t.style[n]=i}}function ft(t,n,r,i){return t.addEventListener(n,r,i),()=>{t.removeEventListener(n,r,i)}}function ss(t){let n=document.scrollingElement||document.documentElement;for(;t&&t!==n;){let r=ds(t);if(r!==document.documentElement&&r!==document.body&&r!==t){let i=r.getBoundingClientRect().top,l=t.getBoundingClientRect().top,o=t.getBoundingClientRect().bottom;const p=r.getBoundingClientRect().bottom+bn;o>p&&(r.scrollTop+=l-i)}t=r.parentElement}}function Vt(t){return t instanceof HTMLInputElement&&!jn.has(t.type)||t instanceof HTMLTextAreaElement||t instanceof HTMLElement&&t.isContentEditable}function Cn(t,n){typeof t=="function"?t(n):t!=null&&(t.current=n)}function Rn(...t){return n=>t.forEach(r=>Cn(r,n))}function us(...t){return m.useCallback(Rn(...t),t)}const ms=new WeakMap;function ae(t,n,r=!1){if(!t||!(t instanceof HTMLElement))return;let i={};Object.entries(n).forEach(([l,o])=>{if(l.startsWith("--")){t.style.setProperty(l,o);return}i[l]=t.style[l],t.style[l]=o}),!r&&ms.set(t,i)}function En(t,n){if(!t||!(t instanceof HTMLElement))return;let r=ms.get(t);r&&(t.style[n]=r[n])}const ne=t=>{switch(t){case"top":case"bottom":return!0;case"left":case"right":return!1;default:return t}};function _t(t,n){if(!t)return null;const r=window.getComputedStyle(t),i=r.transform||r.webkitTransform||r.mozTransform;let l=i.match(/^matrix3d\((.+)\)$/);return l?parseFloat(l[1].split(", ")[ne(n)?13:12]):(l=i.match(/^matrix\((.+)\)$/),l?parseFloat(l[1].split(", ")[ne(n)?5:4]):null)}function Tn(t){return 8*(Math.log(t+1)-2)}function It(t,n){if(!t)return()=>{};const r=t.style.cssText;return Object.assign(t.style,n),()=>{t.style.cssText=r}}function kn(...t){return(...n)=>{for(const r of t)typeof r=="function"&&r(...n)}}const X={DURATION:.5,EASE:[.32,.72,0,1]},fs=.4,Dn=.25,Mn=100,hs=8,tt=16,Ut=26,Ot="vaul-dragging";function ps(t){const n=u.useRef(t);return u.useEffect(()=>{n.current=t}),u.useMemo(()=>(...r)=>n.current==null?void 0:n.current.call(n,...r),[])}function An({defaultProp:t,onChange:n}){const r=u.useState(t),[i]=r,l=u.useRef(i),o=ps(n);return u.useEffect(()=>{l.current!==i&&(o(i),l.current=i)},[i,l,o]),r}function xs({prop:t,defaultProp:n,onChange:r=()=>{}}){const[i,l]=An({defaultProp:n,onChange:r}),o=t!==void 0,p=o?t:i,x=ps(r),f=u.useCallback(T=>{if(o){const S=typeof T=="function"?T(t):T;S!==t&&x(S)}else l(T)},[o,t,l,x]);return[p,f]}function In({activeSnapPointProp:t,setActiveSnapPointProp:n,snapPoints:r,drawerRef:i,overlayRef:l,fadeFromIndex:o,onSnapPointChange:p,direction:x="bottom",container:f,snapToSequentialPoint:T}){const[v,S]=xs({prop:t,defaultProp:r?.[0],onChange:n}),[w,B]=u.useState(typeof window<"u"?{innerWidth:window.innerWidth,innerHeight:window.innerHeight}:void 0);u.useEffect(()=>{function d(){B({innerWidth:window.innerWidth,innerHeight:window.innerHeight})}return window.addEventListener("resize",d),()=>window.removeEventListener("resize",d)},[]);const U=u.useMemo(()=>v===r?.[r.length-1]||null,[r,v]),k=u.useMemo(()=>{var d;return(d=r?.findIndex(D=>D===v))!=null?d:null},[r,v]),Z=r&&r.length>0&&(o||o===0)&&!Number.isNaN(o)&&r[o]===v||!r,j=u.useMemo(()=>{const d=f?{width:f.getBoundingClientRect().width,height:f.getBoundingClientRect().height}:typeof window<"u"?{width:window.innerWidth,height:window.innerHeight}:{width:0,height:0};var D;return(D=r?.map(M=>{const te=typeof M=="string";let se=0;if(te&&(se=parseInt(M,10)),ne(x)){const h=te?se:w?M*d.height:0;return w?x==="bottom"?d.height-h:-d.height+h:h}const $=te?se:w?M*d.width:0;return w?x==="right"?d.width-$:-d.width+$:$}))!=null?D:[]},[r,w,f]),C=u.useMemo(()=>k!==null?j?.[k]:null,[j,k]),O=u.useCallback(d=>{var D;const M=(D=j?.findIndex(te=>te===d))!=null?D:null;p(M),ae(i.current,{transition:`transform ${X.DURATION}s cubic-bezier(${X.EASE.join(",")})`,transform:ne(x)?`translate3d(0, ${d}px, 0)`:`translate3d(${d}px, 0, 0)`}),j&&M!==j.length-1&&o!==void 0&&M!==o&&M<o?ae(l.current,{transition:`opacity ${X.DURATION}s cubic-bezier(${X.EASE.join(",")})`,opacity:"0"}):ae(l.current,{transition:`opacity ${X.DURATION}s cubic-bezier(${X.EASE.join(",")})`,opacity:"1"}),S(r?.[Math.max(M,0)])},[i.current,r,j,o,l,S]);u.useEffect(()=>{if(v||t){var d;const D=(d=r?.findIndex(M=>M===t||M===v))!=null?d:-1;j&&D!==-1&&typeof j[D]=="number"&&O(j[D])}},[v,t,r,j,O]);function N({draggedDistance:d,closeDrawer:D,velocity:M,dismissible:te}){if(o===void 0)return;const se=x==="bottom"||x==="right"?(C??0)-d:(C??0)+d,$=k===o-1,h=k===0,Q=d>0;if($&&ae(l.current,{transition:`opacity ${X.DURATION}s cubic-bezier(${X.EASE.join(",")})`}),!T&&M>2&&!Q){te?D():O(j[0]);return}if(!T&&M>2&&Q&&j&&r){O(j[r.length-1]);return}const G=j?.reduce((W,K)=>typeof W!="number"||typeof K!="number"?W:Math.abs(K-se)<Math.abs(W-se)?K:W),ee=ne(x)?window.innerHeight:window.innerWidth;if(M>fs&&Math.abs(d)<ee*.4){const W=Q?1:-1;if(W>0&&U&&r){O(j[r.length-1]);return}if(h&&W<0&&te&&D(),k===null)return;O(j[k+W]);return}O(G)}function re({draggedDistance:d}){if(C===null)return;const D=x==="bottom"||x==="right"?C-d:C+d;(x==="bottom"||x==="right")&&D<j[j.length-1]||(x==="top"||x==="left")&&D>j[j.length-1]||ae(i.current,{transform:ne(x)?`translate3d(0, ${D}px, 0)`:`translate3d(${D}px, 0, 0)`})}function pe(d,D){if(!r||typeof k!="number"||!j||o===void 0)return null;const M=k===o-1;if(k>=o&&D)return 0;if(M&&!D)return 1;if(!Z&&!M)return null;const se=M?k+1:k-1,$=M?j[se]-j[se-1]:j[se+1]-j[se],h=d/Math.abs($);return M?1-h:h}return{isLastSnapPoint:U,activeSnapPoint:v,shouldFade:Z,getPercentageDragged:pe,setActiveSnapPoint:S,activeSnapPointIndex:k,onRelease:N,onDrag:re,snapPointsOffset:j}}const On=()=>()=>{};function $n(){const{direction:t,isOpen:n,shouldScaleBackground:r,setBackgroundColorOnScale:i,noBodyStyles:l}=vt(),o=u.useRef(null),p=m.useMemo(()=>document.body.style.backgroundColor,[]);function x(){return(window.innerWidth-Ut)/window.innerWidth}u.useEffect(()=>{if(n&&r){o.current&&clearTimeout(o.current);const f=document.querySelector("[data-vaul-drawer-wrapper]")||document.querySelector("[vaul-drawer-wrapper]");if(!f)return;kn(i&&!l?It(document.body,{background:"black"}):On,It(f,{transformOrigin:ne(t)?"top":"left",transitionProperty:"transform, border-radius",transitionDuration:`${X.DURATION}s`,transitionTimingFunction:`cubic-bezier(${X.EASE.join(",")})`}));const T=It(f,{borderRadius:`${hs}px`,overflow:"hidden",...ne(t)?{transform:`scale(${x()}) translate3d(0, calc(env(safe-area-inset-top) + 14px), 0)`}:{transform:`scale(${x()}) translate3d(calc(env(safe-area-inset-top) + 14px), 0, 0)`}});return()=>{T(),o.current=window.setTimeout(()=>{p?document.body.style.background=p:document.body.style.removeProperty("background")},X.DURATION*1e3)}}},[n,r,p])}let ht=null;function Pn({isOpen:t,modal:n,nested:r,hasBeenOpened:i,preventScrollRestoration:l,noBodyStyles:o}){const[p,x]=u.useState(()=>typeof window<"u"?window.location.href:""),f=u.useRef(0),T=u.useCallback(()=>{if(Zt()&&ht===null&&t&&!o){ht={position:document.body.style.position,top:document.body.style.top,left:document.body.style.left,height:document.body.style.height,right:"unset"};const{scrollX:S,innerHeight:w}=window;document.body.style.setProperty("position","fixed","important"),Object.assign(document.body.style,{top:`${-f.current}px`,left:`${-S}px`,right:"0px",height:"auto"}),window.setTimeout(()=>window.requestAnimationFrame(()=>{const B=w-window.innerHeight;B&&f.current>=w&&(document.body.style.top=`${-(f.current+B)}px`)}),300)}},[t]),v=u.useCallback(()=>{if(Zt()&&ht!==null&&!o){const S=-parseInt(document.body.style.top,10),w=-parseInt(document.body.style.left,10);Object.assign(document.body.style,ht),window.requestAnimationFrame(()=>{if(l&&p!==window.location.href){x(window.location.href);return}window.scrollTo(w,S)}),ht=null}},[p]);return u.useEffect(()=>{function S(){f.current=window.scrollY}return S(),window.addEventListener("scroll",S),()=>{window.removeEventListener("scroll",S)}},[]),u.useEffect(()=>{if(n)return()=>{typeof document>"u"||document.querySelector("[data-vaul-drawer]")||v()}},[n,v]),u.useEffect(()=>{r||!i||(t?(!window.matchMedia("(display-mode: standalone)").matches&&T(),n||window.setTimeout(()=>{v()},500)):v())},[t,i,p,n,r,T,v]),{restorePositionSetting:v}}function Ln({open:t,onOpenChange:n,children:r,onDrag:i,onRelease:l,snapPoints:o,shouldScaleBackground:p=!1,setBackgroundColorOnScale:x=!0,closeThreshold:f=Dn,scrollLockTimeout:T=Mn,dismissible:v=!0,handleOnly:S=!1,fadeFromIndex:w=o&&o.length-1,activeSnapPoint:B,setActiveSnapPoint:U,fixed:k,modal:Z=!0,onClose:j,nested:C,noBodyStyles:O=!1,direction:N="bottom",defaultOpen:re=!1,disablePreventScroll:pe=!0,snapToSequentialPoint:d=!1,preventScrollRestoration:D=!1,repositionInputs:M=!0,onAnimationEnd:te,container:se,autoFocus:$=!1}){var h,Q;const[G=!1,ee]=xs({defaultProp:re,prop:t,onChange:g=>{n?.(g),!g&&!C&&Ke(),setTimeout(()=>{te?.(g)},X.DURATION*1e3),g&&!Z&&typeof window<"u"&&window.requestAnimationFrame(()=>{document.body.style.pointerEvents="auto"}),g||(document.body.style.pointerEvents="auto")}}),[W,K]=u.useState(!1),[xe,Ae]=u.useState(!1),[Ie,Ve]=u.useState(!1),J=u.useRef(null),Ne=u.useRef(null),Ee=u.useRef(null),Oe=u.useRef(null),$e=u.useRef(null),Pe=u.useRef(!1),q=u.useRef(null),Te=u.useRef(0),ke=u.useRef(!1),Ue=u.useRef(!re),Ge=u.useRef(0),_=u.useRef(null),ie=u.useRef(((h=_.current)==null?void 0:h.getBoundingClientRect().height)||0),Je=u.useRef(((Q=_.current)==null?void 0:Q.getBoundingClientRect().width)||0),Se=u.useRef(0),ge=u.useCallback(g=>{o&&g===fe.length-1&&(Ne.current=new Date)},[]),{activeSnapPoint:rt,activeSnapPointIndex:me,setActiveSnapPoint:De,onRelease:We,snapPointsOffset:fe,onDrag:Ze,shouldFade:dt,getPercentageDragged:Y}=In({snapPoints:o,activeSnapPointProp:B,setActiveSnapPointProp:U,drawerRef:_,fadeFromIndex:w,overlayRef:J,onSnapPointChange:ge,direction:N,container:se,snapToSequentialPoint:d});Nn({isDisabled:!G||xe||!Z||Ie||!W||!M||!pe});const{restorePositionSetting:Ke}=Pn({isOpen:G,modal:Z,nested:C??!1,hasBeenOpened:W,preventScrollRestoration:D,noBodyStyles:O});function Fe(){return(window.innerWidth-Ut)/window.innerWidth}function at(g){var E,L;!v&&!o||_.current&&!_.current.contains(g.target)||(ie.current=((E=_.current)==null?void 0:E.getBoundingClientRect().height)||0,Je.current=((L=_.current)==null?void 0:L.getBoundingClientRect().width)||0,Ae(!0),Ee.current=new Date,cs()&&window.addEventListener("touchend",()=>Pe.current=!1,{once:!0}),g.target.setPointerCapture(g.pointerId),Te.current=ne(N)?g.pageY:g.pageX)}function Qe(g,E){var L;let A=g;const I=(L=window.getSelection())==null?void 0:L.toString(),P=_.current?_t(_.current,N):null,H=new Date;if(A.tagName==="SELECT"||A.hasAttribute("data-vaul-no-drag")||A.closest("[data-vaul-no-drag]"))return!1;if(N==="right"||N==="left")return!0;if(Ne.current&&H.getTime()-Ne.current.getTime()<500)return!1;if(P!==null&&(N==="bottom"?P>0:P<0))return!0;if(I&&I.length>0)return!1;if($e.current&&H.getTime()-$e.current.getTime()<T&&P===0||E)return $e.current=H,!1;for(;A;){if(A.scrollHeight>A.clientHeight){if(A.scrollTop!==0)return $e.current=new Date,!1;if(A.getAttribute("role")==="dialog")return!0}A=A.parentNode}return!0}function oe(g){if(_.current&&xe){const E=N==="bottom"||N==="right"?1:-1,L=(Te.current-(ne(N)?g.pageY:g.pageX))*E,A=L>0,I=o&&!v&&!A;if(I&&me===0)return;const P=Math.abs(L),H=document.querySelector("[data-vaul-drawer-wrapper]"),ve=N==="bottom"||N==="top"?ie.current:Je.current;let ce=P/ve;const ye=Y(P,A);if(ye!==null&&(ce=ye),I&&ce>=1||!Pe.current&&!Qe(g.target,A))return;if(_.current.classList.add(Ot),Pe.current=!0,ae(_.current,{transition:"none"}),ae(J.current,{transition:"none"}),o&&Ze({draggedDistance:L}),A&&!o){const ue=Tn(L),et=Math.min(ue*-1,0)*E;ae(_.current,{transform:ne(N)?`translate3d(0, ${et}px, 0)`:`translate3d(${et}px, 0, 0)`});return}const Ce=1-ce;if((dt||w&&me===w-1)&&(i?.(g,ce),ae(J.current,{opacity:`${Ce}`,transition:"none"},!0)),H&&J.current&&p){const ue=Math.min(Fe()+ce*(1-Fe()),1),et=8-ce*8,s=Math.max(0,14-ce*14);ae(H,{borderRadius:`${et}px`,transform:ne(N)?`scale(${ue}) translate3d(0, ${s}px, 0)`:`scale(${ue}) translate3d(${s}px, 0, 0)`,transition:"none"},!0)}if(!o){const ue=P*E;ae(_.current,{transform:ne(N)?`translate3d(0, ${ue}px, 0)`:`translate3d(${ue}px, 0, 0)`})}}}u.useEffect(()=>{window.requestAnimationFrame(()=>{Ue.current=!0})},[]),u.useEffect(()=>{var g;function E(){if(!_.current||!M)return;const L=document.activeElement;if(Vt(L)||ke.current){var A;const I=((A=window.visualViewport)==null?void 0:A.height)||0,P=window.innerHeight;let H=P-I;const ve=_.current.getBoundingClientRect().height||0,ce=ve>P*.8;Se.current||(Se.current=ve);const ye=_.current.getBoundingClientRect().top;if(Math.abs(Ge.current-H)>60&&(ke.current=!ke.current),o&&o.length>0&&fe&&me){const Ce=fe[me]||0;H+=Ce}if(Ge.current=H,ve>I||ke.current){const Ce=_.current.getBoundingClientRect().height;let ue=Ce;Ce>I&&(ue=I-(ce?ye:Ut)),k?_.current.style.height=`${Ce-Math.max(H,0)}px`:_.current.style.height=`${Math.max(ue,I-ye)}px`}else xn()||(_.current.style.height=`${Se.current}px`);o&&o.length>0&&!ke.current?_.current.style.bottom="0px":_.current.style.bottom=`${Math.max(H,0)}px`}}return(g=window.visualViewport)==null||g.addEventListener("resize",E),()=>{var L;return(L=window.visualViewport)==null?void 0:L.removeEventListener("resize",E)}},[me,o,fe]);function He(g){le(),j?.(),g||ee(!1),setTimeout(()=>{o&&De(o[0])},X.DURATION*1e3)}function R(){if(!_.current)return;const g=document.querySelector("[data-vaul-drawer-wrapper]"),E=_t(_.current,N);ae(_.current,{transform:"translate3d(0, 0, 0)",transition:`transform ${X.DURATION}s cubic-bezier(${X.EASE.join(",")})`}),ae(J.current,{transition:`opacity ${X.DURATION}s cubic-bezier(${X.EASE.join(",")})`,opacity:"1"}),p&&E&&E>0&&G&&ae(g,{borderRadius:`${hs}px`,overflow:"hidden",...ne(N)?{transform:`scale(${Fe()}) translate3d(0, calc(env(safe-area-inset-top) + 14px), 0)`,transformOrigin:"top"}:{transform:`scale(${Fe()}) translate3d(calc(env(safe-area-inset-top) + 14px), 0, 0)`,transformOrigin:"left"},transitionProperty:"transform, border-radius",transitionDuration:`${X.DURATION}s`,transitionTimingFunction:`cubic-bezier(${X.EASE.join(",")})`},!0)}function le(){!xe||!_.current||(_.current.classList.remove(Ot),Pe.current=!1,Ae(!1),Oe.current=new Date)}function _e(g){if(!xe||!_.current)return;_.current.classList.remove(Ot),Pe.current=!1,Ae(!1),Oe.current=new Date;const E=_t(_.current,N);if(!g||!Qe(g.target,!1)||!E||Number.isNaN(E)||Ee.current===null)return;const L=Oe.current.getTime()-Ee.current.getTime(),A=Te.current-(ne(N)?g.pageY:g.pageX),I=Math.abs(A)/L;if(I>.05&&(Ve(!0),setTimeout(()=>{Ve(!1)},200)),o){We({draggedDistance:A*(N==="bottom"||N==="right"?1:-1),closeDrawer:He,velocity:I,dismissible:v}),l?.(g,!0);return}if(N==="bottom"||N==="right"?A>0:A<0){R(),l?.(g,!0);return}if(I>fs){He(),l?.(g,!1);return}var P;const H=Math.min((P=_.current.getBoundingClientRect().height)!=null?P:0,window.innerHeight);var ve;const ce=Math.min((ve=_.current.getBoundingClientRect().width)!=null?ve:0,window.innerWidth),ye=N==="left"||N==="right";if(Math.abs(E)>=(ye?ce:H)*f){He(),l?.(g,!1);return}l?.(g,!0),R()}u.useEffect(()=>(G&&(ae(document.documentElement,{scrollBehavior:"auto"}),Ne.current=new Date),()=>{En(document.documentElement,"scrollBehavior")}),[G]);function Ye(g){const E=g?(window.innerWidth-tt)/window.innerWidth:1,L=g?-tt:0;q.current&&window.clearTimeout(q.current),ae(_.current,{transition:`transform ${X.DURATION}s cubic-bezier(${X.EASE.join(",")})`,transform:ne(N)?`scale(${E}) translate3d(0, ${L}px, 0)`:`scale(${E}) translate3d(${L}px, 0, 0)`}),!g&&_.current&&(q.current=setTimeout(()=>{const A=_t(_.current,N);ae(_.current,{transition:"none",transform:ne(N)?`translate3d(0, ${A}px, 0)`:`translate3d(${A}px, 0, 0)`})},500))}function it(g,E){if(E<0)return;const L=(window.innerWidth-tt)/window.innerWidth,A=L+E*(1-L),I=-tt+E*tt;ae(_.current,{transform:ne(N)?`scale(${A}) translate3d(0, ${I}px, 0)`:`scale(${A}) translate3d(${I}px, 0, 0)`,transition:"none"})}function Le(g,E){const L=ne(N)?window.innerHeight:window.innerWidth,A=E?(L-tt)/L:1,I=E?-tt:0;E&&ae(_.current,{transition:`transform ${X.DURATION}s cubic-bezier(${X.EASE.join(",")})`,transform:ne(N)?`scale(${A}) translate3d(0, ${I}px, 0)`:`scale(${A}) translate3d(${I}px, 0, 0)`})}return u.useEffect(()=>{Z||window.requestAnimationFrame(()=>{document.body.style.pointerEvents="auto"})},[Z]),u.createElement(Ds,{defaultOpen:re,onOpenChange:g=>{!v&&!g||(g?K(!0):He(!0),ee(g))},open:G},u.createElement(ls.Provider,{value:{activeSnapPoint:rt,snapPoints:o,setActiveSnapPoint:De,drawerRef:_,overlayRef:J,onOpenChange:n,onPress:at,onRelease:_e,onDrag:oe,dismissible:v,shouldAnimate:Ue,handleOnly:S,isOpen:G,isDragging:xe,shouldFade:dt,closeDrawer:He,onNestedDrag:it,onNestedOpenChange:Ye,onNestedRelease:Le,keyboardIsOpen:ke,modal:Z,snapPointsOffset:fe,activeSnapPointIndex:me,direction:N,shouldScaleBackground:p,setBackgroundColorOnScale:x,noBodyStyles:O,container:se,autoFocus:$}},r))}const gs=u.forwardRef(function({...t},n){const{overlayRef:r,snapPoints:i,onRelease:l,shouldFade:o,isOpen:p,modal:x,shouldAnimate:f}=vt(),T=us(n,r),v=i&&i.length>0;if(!x)return null;const S=u.useCallback(w=>l(w),[l]);return u.createElement(Is,{onMouseUp:S,ref:T,"data-vaul-overlay":"","data-vaul-snap-points":p&&v?"true":"false","data-vaul-snap-points-overlay":p&&o?"true":"false","data-vaul-animate":f?.current?"true":"false",...t})});gs.displayName="Drawer.Overlay";const vs=u.forwardRef(function({onPointerDownOutside:t,style:n,onOpenAutoFocus:r,...i},l){const{drawerRef:o,onPress:p,onRelease:x,onDrag:f,keyboardIsOpen:T,snapPointsOffset:v,activeSnapPointIndex:S,modal:w,isOpen:B,direction:U,snapPoints:k,container:Z,handleOnly:j,shouldAnimate:C,autoFocus:O}=vt(),[N,re]=u.useState(!1),pe=us(l,o),d=u.useRef(null),D=u.useRef(null),M=u.useRef(!1),te=k&&k.length>0;$n();const se=(h,Q,G=0)=>{if(M.current)return!0;const ee=Math.abs(h.y),W=Math.abs(h.x),K=W>ee,xe=["bottom","right"].includes(Q)?1:-1;if(Q==="left"||Q==="right"){if(!(h.x*xe<0)&&W>=0&&W<=G)return K}else if(!(h.y*xe<0)&&ee>=0&&ee<=G)return!K;return M.current=!0,!0};u.useEffect(()=>{te&&window.requestAnimationFrame(()=>{re(!0)})},[]);function $(h){d.current=null,M.current=!1,x(h)}return u.createElement(As,{"data-vaul-drawer-direction":U,"data-vaul-drawer":"","data-vaul-delayed-snap-points":N?"true":"false","data-vaul-snap-points":B&&te?"true":"false","data-vaul-custom-container":Z?"true":"false","data-vaul-animate":C?.current?"true":"false",...i,ref:pe,style:v&&v.length>0?{"--snap-point-height":`${v[S??0]}px`,...n}:n,onPointerDown:h=>{j||(i.onPointerDown==null||i.onPointerDown.call(i,h),d.current={x:h.pageX,y:h.pageY},p(h))},onOpenAutoFocus:h=>{r?.(h),O||h.preventDefault()},onPointerDownOutside:h=>{if(t?.(h),!w||h.defaultPrevented){h.preventDefault();return}T.current&&(T.current=!1)},onFocusOutside:h=>{if(!w){h.preventDefault();return}},onPointerMove:h=>{if(D.current=h,j||(i.onPointerMove==null||i.onPointerMove.call(i,h),!d.current))return;const Q=h.pageY-d.current.y,G=h.pageX-d.current.x,ee=h.pointerType==="touch"?10:2;se({x:G,y:Q},U,ee)?f(h):(Math.abs(G)>ee||Math.abs(Q)>ee)&&(d.current=null)},onPointerUp:h=>{i.onPointerUp==null||i.onPointerUp.call(i,h),d.current=null,M.current=!1,x(h)},onPointerOut:h=>{i.onPointerOut==null||i.onPointerOut.call(i,h),$(D.current)},onContextMenu:h=>{i.onContextMenu==null||i.onContextMenu.call(i,h),D.current&&$(D.current)}})});vs.displayName="Drawer.Content";const Fn=250,Hn=120,zn=u.forwardRef(function({preventCycle:t=!1,children:n,...r},i){const{closeDrawer:l,isDragging:o,snapPoints:p,activeSnapPoint:x,setActiveSnapPoint:f,dismissible:T,handleOnly:v,isOpen:S,onPress:w,onDrag:B}=vt(),U=u.useRef(null),k=u.useRef(!1);function Z(){if(k.current){O();return}window.setTimeout(()=>{j()},Hn)}function j(){if(o||t||k.current){O();return}if(O(),!p||p.length===0){T||l();return}if(x===p[p.length-1]&&T){l();return}const re=p.findIndex(d=>d===x);if(re===-1)return;const pe=p[re+1];f(pe)}function C(){U.current=window.setTimeout(()=>{k.current=!0},Fn)}function O(){U.current&&window.clearTimeout(U.current),k.current=!1}return u.createElement("div",{onClick:Z,onPointerCancel:O,onPointerDown:N=>{v&&w(N),C()},onPointerMove:N=>{v&&B(N)},ref:i,"data-vaul-drawer-visible":S?"true":"false","data-vaul-handle":"","aria-hidden":"true",...r},u.createElement("span",{"data-vaul-handle-hitarea":"","aria-hidden":"true"},n))});zn.displayName="Drawer.Handle";function Bn(t){const n=vt(),{container:r=n.container,...i}=t;return u.createElement(Ms,{container:r,...i})}const qe={Root:Ln,Content:vs,Overlay:gs,Portal:Bn,Title:Ts,Description:ks},ys=({shouldScaleBackground:t=!0,...n})=>e.jsx(qe.Root,{shouldScaleBackground:t,...n});ys.displayName="Drawer";const qn=qe.Portal,bs=m.forwardRef(({className:t,...n},r)=>e.jsx(qe.Overlay,{ref:r,className:je("fixed inset-0 z-50 bg-black/80",t),...n}));bs.displayName=qe.Overlay.displayName;const ws=m.forwardRef(({className:t,children:n,...r},i)=>e.jsxs(qn,{children:[e.jsx(bs,{}),e.jsxs(qe.Content,{ref:i,className:je("fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background",t),...r,children:[e.jsx("div",{className:"mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted"}),n]})]}));ws.displayName="DrawerContent";const js=({className:t,...n})=>e.jsx("div",{className:je("grid gap-1.5 p-4 text-center sm:text-left",t),...n});js.displayName="DrawerHeader";const Ns=m.forwardRef(({className:t,...n},r)=>e.jsx(qe.Title,{ref:r,className:je("text-lg font-semibold leading-none tracking-tight",t),...n}));Ns.displayName=qe.Title.displayName;const Ss=m.forwardRef(({className:t,...n},r)=>e.jsx(qe.Description,{ref:r,className:je("text-sm text-muted-foreground",t),...n}));Ss.displayName=qe.Description.displayName;const Vn=[1,2,3,4,5];function ns({value:t,onChange:n,className:r,disabled:i=!1,size:l="md",ariaLabel:o="Sélecteur d'échelle 1 à 5"}){const p=l==="sm"?"h-10 w-10 text-xs":"h-11 w-11 text-sm";return e.jsx("div",{className:je("flex items-center gap-2",r),role:"group","aria-label":o,children:Vn.map(x=>{const f=t===x;return e.jsx("button",{type:"button",className:je("flex items-center justify-center rounded-full border font-semibold transition",p,f?"border-primary bg-primary text-primary-foreground":"border-muted-foreground/30 bg-background text-foreground",i&&"opacity-60"),"aria-pressed":f,disabled:i,onClick:()=>{i||n?.(x)},children:x},x)})})}const Un=()=>{try{const t=new(window.AudioContext||window.webkitAudioContext),n=t.createOscillator(),r=t.createGain();n.connect(r),r.connect(t.destination),n.frequency.value=880,r.gain.value=.3,n.start(),n.stop(t.currentTime+.25);const i=t.createOscillator(),l=t.createGain();i.connect(l),l.connect(t.destination),i.frequency.value=1100,l.gain.value=.3,i.start(t.currentTime+.35),i.stop(t.currentTime+.6),i.onended=()=>t.close()}catch{}try{navigator.vibrate?.([200,100,200])}catch{}},Tt=(t,n)=>{const r=Number(t?.set_index??t?.set_number??t?.setIndex??n);return!Number.isFinite(r)||r<=0?n:r},_s=(t=[],n,r)=>{if(!t.length)return 0;const i=Array.isArray(n)?n:[];if(i.length>0){const p=new Map;i.forEach((f,T)=>{if(!f?.exercise_id)return;const v=p.get(f.exercise_id)??[];v.push({...f,set_index:Tt(f,T+1)}),p.set(f.exercise_id,v)});let x=t.length+1;for(let f=0;f<t.length;f+=1){const T=t[f];if((p.get(T.exercise_id)??[]).length<(T.sets??0)){x=f+1;break}}return x}const l=Number(r??0);if(!Number.isFinite(l)||l<=0)return 0;const o=Math.min(t.length,Math.max(0,Math.round(l/100*t.length)));return Math.min(t.length,o+1)},Be=(t,n)=>{const r=Number(t);return!Number.isFinite(r)||r<=0?"—":n?`${r}${n}`:String(r)};function Wn({session:t,exercises:n,oneRMs:r,onFinish:i,onStart:l,onLogSets:o,onProgress:p,initialLogs:x,isFinishing:f,initialStep:T,onStepChange:v,initialInputOpen:S,initialSeriesOpen:w,onExitFocus:B,exerciseNotes:U,onUpdateNote:k}){const{toast:Z}=as(),j=m.useRef(!1),[C,O]=m.useState(T??0),[N,re]=m.useState([]),[pe,d]=m.useState(0),[D,M]=m.useState(!0),te=m.useRef(Date.now()),se=m.useRef(0),[$,h]=m.useState(0),[Q,G]=m.useState(!1),[ee,W]=m.useState(!1),K=m.useRef(0),[xe,Ae]=m.useState(!0),[Ie,Ve]=m.useState(3),[J,Ne]=m.useState(3),[Ee,Oe]=m.useState(""),[$e,Pe]=m.useState(!1),[q,Te]=m.useState(1),[ke,Ue]=m.useState(w??!1),[Ge,_]=m.useState(S??!1),[ie,Je]=m.useState("weight"),[Se,ge]=m.useState(""),[rt,me]=m.useState(!1),[De,We]=m.useState(!1),[fe,Ze]=m.useState(!1),[dt,Y]=m.useState(!1),[Ke,Fe]=m.useState(!1),[at,Qe]=m.useState("");m.useEffect(()=>{if(!D)return;const a=()=>{const b=Math.floor((Date.now()-te.current)/1e3)+se.current;d(b)};a();const y=setInterval(a,1e3),V=()=>{document.visibilityState==="visible"&&a()};return document.addEventListener("visibilitychange",V),()=>{clearInterval(y),document.removeEventListener("visibilitychange",V)}},[D]),m.useEffect(()=>{if(!De)return;const a=y=>{y.key==="Escape"&&We(!1)};return window.addEventListener("keydown",a),()=>window.removeEventListener("keydown",a)},[De]),m.useEffect(()=>{if(!Q||ee)return;const a=()=>{if(K.current<=0)return;const b=Math.max(0,Math.ceil((K.current-Date.now())/1e3));h(b),b<=0&&(Un(),Z({title:"Temps de récupération terminé"}),G(!1),W(!1))};a();const y=setInterval(a,1e3),V=()=>{document.visibilityState==="visible"&&a()};return document.addEventListener("visibilitychange",V),()=>{clearInterval(y),document.removeEventListener("visibilitychange",V)}},[Q,ee]);const oe=t.items||[],He=C-1,R=C>0&&C<=oe.length?oe[He]:null,le=R?n.find(a=>a.id===R.exercise_id):null,_e=C<oe.length?oe[C]:null,Ye=_e?n.find(a=>a.id===_e.exercise_id):null,it=(()=>{const a=le?.muscle_groups??le?.muscles??le?.muscleGroups??[];return Array.isArray(a)?a:[]})(),Le=R?.rest_seconds??0,g=oe.length?Math.min(100,Math.max(0,Math.round((C-1)/oe.length*100))):0,E=Number(R?.percent_1rm),L=Number.isFinite(E)&&E>0,A=L&&r.find(a=>a.exercise_id===R?.exercise_id)?.weight||0,I=L?Math.round(A*(E/100)):0,[P,H]=m.useState({}),ve=m.useMemo(()=>{const a=new Map;return N.forEach((y,V)=>{const b=Tt(y,V+1);y.exercise_id&&a.set(`${y.exercise_id}-${b}`,y)}),a},[N]),ce=R?`${R.exercise_id}-${q}`:null,ye=ce?ve.get(ce):null,Ce=ye?.weight??P[q-1]?.weight??I,ue=ye?.reps??P[q-1]?.reps??R?.reps??"",et=()=>{if(typeof window>"u")return;const a=["#22c55e","#3b82f6","#f97316","#e11d48","#a855f7"],y=120;for(let V=0;V<y;V+=1){const b=document.createElement("div"),Me=Math.random()*6+6;b.style.position="fixed",b.style.top="-10px",b.style.left=`${Math.random()*100}vw`,b.style.width=`${Me}px`,b.style.height=`${Me*.6}px`,b.style.backgroundColor=a[V%a.length],b.style.opacity="0.9",b.style.pointerEvents="none",b.style.zIndex="9999",b.style.borderRadius="2px",document.body.appendChild(b);const ze=(Math.random()-.5)*200,ut=1200+Math.random()*800,bt=Math.random()*360;b.animate([{transform:"translate3d(0, 0, 0) rotate(0deg)",opacity:1},{transform:`translate3d(${ze}px, ${window.innerHeight+200}px, 0) rotate(${bt}deg)`,opacity:0}],{duration:ut,easing:"ease-out"}).onfinish=()=>b.remove()}};m.useEffect(()=>{if(j.current){x&&re(x);return}if(!x){re(b=>b.length?[]:b),H(b=>Object.keys(b).length?{}:b);return}if(re(x),!x.length){H(b=>Object.keys(b).length?{}:b),O(b=>b===0?b:0);return}const a=t.items||[];if(!a.length)return;const y=new Map;x.forEach((b,Me)=>{if(!b.exercise_id)return;const ze=y.get(b.exercise_id)??[];ze.push({...b,set_index:Tt(b,Me+1)}),y.set(b.exercise_id,ze)});const V=_s(a,x);if(V>0&&V<=a.length){const b=a[V-1],Me=y.get(b.exercise_id)??[],ze=Me.reduce((bt,kt,Rs)=>{const Es=Tt(kt,Rs+1);return bt[Es-1]={reps:kt.reps??void 0,weight:kt.weight??void 0},bt},{});H(ze);const ut=Math.min(b.sets??1,Me.length+1);Te(ut)}else H({}),Te(1);O(b=>b===V?b:V)},[x,t.items]),m.useEffect(()=>{C<=oe.length||$e||(et(),Pe(!0))},[C,oe.length,$e]);const s=a=>{O(a),v?.(a)},c=a=>{a<=0||(K.current=Date.now()+a*1e3,h(a),G(!0),W(!1))},z=async()=>{window.scrollTo({top:0,behavior:"smooth"});const a=C+1;Te(1),H({}),s(a);const y=Math.round(Math.min(a-1,oe.length)/oe.length*100);try{await p?.(y)}catch{Z({title:"Erreur de sauvegarde",description:"Réessayez",variant:"destructive"})}},de=async()=>{if(!R)return;if(ye){q>=R.sets?await z():Te(y=>Math.min(R.sets,y+1));return}const a={exercise_id:R.exercise_id,set_number:q,reps:P[q-1]?.reps||R.reps,weight:P[q-1]?.weight||I};re(y=>[...y,a]),j.current=!0;try{await o?.([a])}catch{Z({title:"Erreur de sauvegarde",description:"Réessayez",variant:"destructive"})}finally{j.current=!1}if(xe&&R.rest_seconds>0&&c(R.rest_seconds),q>=R.sets){await z();return}Te(y=>Math.min(R.sets,y+1))},he=a=>{Je(a);const y=a==="weight"?P[q-1]?.weight??I??"":P[q-1]?.reps??R?.reps??"";ge(y?String(y):""),me(!!y),_(!0)},be=()=>{if(!R)return;const a=Number(ie==="weight"?Se.replace(",","."):Se);Number.isFinite(a)&&(H(y=>({...y,[q-1]:{...y[q-1],[ie]:a}})),_(!1))},ot=a=>{if(rt){me(!1),ge(a);return}ge(y=>a==="."&&y.includes(".")?y:y+a)},yt=a=>{if(!R)return;Je(a);const y=a==="weight"?P[q-1]?.weight??I??"":P[q-1]?.reps??R?.reps??"";ge(y?String(y):""),me(!!y)};return C===0?e.jsxs("div",{className:"space-y-6 text-center py-8 animate-in zoom-in duration-300",children:[e.jsx("div",{className:"h-24 w-24 bg-primary/10 rounded-full flex items-center justify-center mx-auto animate-pulse",children:e.jsx(nt,{className:"h-10 w-10 text-primary ml-1"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold font-display uppercase",children:t.title}),e.jsx("p",{className:"text-muted-foreground text-lg",children:t.description}),e.jsxs("div",{className:"flex gap-2 justify-center mt-4",children:[e.jsx(gt,{variant:"outline",className:"text-sm px-3 py-1",children:t.cycle}),e.jsxs(gt,{variant:"secondary",className:"text-sm px-3 py-1",children:[oe.length," Exercices"]})]})]}),e.jsx(F,{size:"lg",className:"w-full text-xl h-14 font-bold uppercase tracking-wider shadow-lg hover:scale-[1.02] transition-transform",disabled:fe,onClick:async()=>{Ze(!0);try{await l?.(),s(1)}finally{Ze(!1)}},children:fe?e.jsxs(e.Fragment,{children:[e.jsx(sn,{className:"mr-2 h-5 w-5 animate-spin"}),"CHARGEMENT..."]}):"COMMENCER SÉANCE"})]}):C>oe.length?e.jsx("div",{className:"space-y-6 animate-in fade-in",children:e.jsxs(Xe,{className:"border-t-8 border-t-primary shadow-xl",children:[e.jsxs(Ct,{className:"text-center pb-2",children:[e.jsx("div",{className:"mx-auto bg-primary/10 p-4 rounded-full w-fit mb-4",children:e.jsx(nn,{className:"h-12 w-12 text-primary"})}),e.jsx(Pt,{className:"text-3xl uppercase font-display italic",children:"Séance Terminée !"}),e.jsxs(is,{className:"text-lg",children:["Durée totale: ",Math.floor(pe/60),"m ",pe%60,"s"]})]}),e.jsxs(Rt,{className:"space-y-6 pt-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-center",children:[e.jsxs("div",{className:"bg-muted p-4 rounded-lg",children:[e.jsx("div",{className:"text-xs uppercase font-bold text-muted-foreground",children:"Volume"}),e.jsxs("div",{className:"text-2xl font-mono font-bold",children:[N.reduce((a,y)=>a+(Number(y.weight)||0)*(Number(y.reps)||0),0)," kg"]})]}),e.jsxs("div",{className:"bg-muted p-4 rounded-lg",children:[e.jsx("div",{className:"text-xs uppercase font-bold text-muted-foreground",children:"Séries"}),e.jsx("div",{className:"text-2xl font-mono font-bold",children:N.length})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(ct,{className:"uppercase font-bold text-xs text-muted-foreground",children:"Difficulté de la séance"}),e.jsxs("div",{className:"flex items-center justify-between text-[11px] font-semibold text-muted-foreground",children:[e.jsx("span",{children:"Facile"}),e.jsx("span",{children:"Très dur"})]}),e.jsx(ns,{value:Ie,onChange:Ve})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(ct,{className:"uppercase font-bold text-xs text-muted-foreground",children:"Fatigue fin de séance"}),e.jsxs("div",{className:"flex items-center justify-between text-[11px] font-semibold text-muted-foreground",children:[e.jsx("span",{children:"Frais"}),e.jsx("span",{children:"Épuisé"})]}),e.jsx(ns,{value:J,onChange:Ne})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ct,{className:"uppercase font-bold text-xs text-muted-foreground",children:"Notes"}),e.jsx("textarea",{placeholder:"Sensations, douleurs...",value:Ee,onChange:a=>Oe(a.target.value),rows:3,className:"flex w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 resize-none"})]})]}),e.jsx(Ps,{children:e.jsx(F,{className:"w-full h-14 text-lg font-bold uppercase",disabled:f,onClick:()=>{f||i({duration:Math.floor(pe/60),feeling:Ie,fatigue:J,comments:Ee,logs:N})},children:f?"ENREGISTREMENT...":"ENREGISTRER & FERMER"})})]})}):e.jsxs("div",{className:"space-y-6 pb-32",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{type:"button","aria-label":"Voir l’animation de l’exercice",onClick:()=>{le?.illustration_gif&&We(!0)},className:"flex h-12 w-12 items-center justify-center overflow-hidden rounded-full border bg-card shadow-sm",children:le?.illustration_gif?e.jsx("img",{src:le.illustration_gif,alt:"",className:"h-full w-full object-cover",loading:"lazy",decoding:"async"}):e.jsx(nt,{className:"h-5 w-5 text-muted-foreground"})}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs("span",{className:"rounded-full bg-muted px-3 py-1 text-xs font-semibold",children:["Ex ",C,"/",oe.length]}),e.jsxs("span",{className:"rounded-full bg-muted px-3 py-1 text-xs font-semibold",children:["S ",q,"/",Be(R?.sets)]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"text-xs font-semibold text-muted-foreground",children:"Séance"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-2 w-28 overflow-hidden rounded-full bg-muted",children:e.jsx("div",{className:"h-full rounded-full bg-primary",style:{width:`${g}%`}})}),e.jsxs("div",{className:"text-sm font-semibold",children:[g,"%"]})]}),B?e.jsx(F,{variant:"ghost",size:"icon","aria-label":"Quitter le focus",onClick:()=>{N.length>0?Y(!0):B()},children:e.jsx(Et,{className:"h-4 w-4"})}):null]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h2",{className:"text-2xl font-semibold tracking-tight",children:le?.nom_exercice??"Exercice"}),k&&R&&e.jsx(F,{variant:"ghost",size:"icon",className:"h-8 w-8 shrink-0",onClick:()=>{Qe(U?.[R.exercise_id]??""),Fe(!0)},"aria-label":"Notes personnelles",children:e.jsx(rn,{className:je("h-4 w-4",U?.[R?.exercise_id]?"text-primary":"text-muted-foreground")})})]}),R&&U?.[R.exercise_id]&&e.jsx("p",{className:"mt-1 text-xs italic text-muted-foreground line-clamp-2",children:U[R.exercise_id]}),it.length>0&&e.jsx("div",{className:"mt-3 flex flex-wrap gap-2",children:it.map(a=>e.jsx("span",{className:"rounded-full bg-muted px-3 py-1 text-xs font-semibold text-muted-foreground",children:a},a))})]}),e.jsxs(Xe,{className:"rounded-3xl border bg-card p-4 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-base font-semibold",children:"Série en cours"}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(Bt,{checked:xe,onCheckedChange:Ae}),"Auto repos"]})]}),e.jsxs("div",{className:"mt-4 rounded-2xl border bg-muted/20 p-4",children:[e.jsx("div",{className:"text-sm font-semibold",children:"En cours"}),e.jsxs("div",{className:"mt-2 text-lg font-semibold",children:["Série ",q,"/",Be(R?.sets)," · Objectif"," ",Be(R?.reps)," reps"]}),e.jsx("div",{className:"mt-2 text-sm text-muted-foreground",children:"Appuie sur une tuile pour saisir."})]}),e.jsxs("div",{className:"mt-4 grid grid-cols-2 gap-3",children:[e.jsxs("button",{type:"button",className:"group relative rounded-2xl border-2 border-primary/20 bg-gradient-to-br from-card to-muted/30 p-4 text-left shadow-sm transition-all active:scale-[0.98] hover:border-primary/40 hover:shadow-md",onClick:()=>he("weight"),children:[e.jsx("div",{className:"text-[10px] font-bold uppercase tracking-wide text-muted-foreground",children:"Charge"}),e.jsxs("div",{className:"mt-1 flex items-baseline gap-0.5",children:[e.jsx("span",{className:"text-3xl font-bold tabular-nums tracking-tight",children:Ce||"—"}),e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"kg"})]})]}),e.jsxs("button",{type:"button",className:"group relative rounded-2xl border-2 border-primary/20 bg-gradient-to-br from-card to-muted/30 p-4 text-left shadow-sm transition-all active:scale-[0.98] hover:border-primary/40 hover:shadow-md",onClick:()=>he("reps"),children:[e.jsx("div",{className:"text-[10px] font-bold uppercase tracking-wide text-muted-foreground",children:"Reps"}),e.jsxs("div",{className:"mt-1 flex items-baseline gap-0.5",children:[e.jsx("span",{className:"text-3xl font-bold tabular-nums tracking-tight",children:ue||"—"}),e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"reps"})]})]})]}),e.jsxs("div",{className:"mt-4 rounded-2xl border bg-muted/10 p-4",children:[e.jsx("div",{className:"text-sm font-semibold",children:"Notes"}),e.jsx("div",{className:"mt-2 text-sm text-muted-foreground",children:R?.notes||le?.description||"Aucune note spécifique."})]}),e.jsx(F,{type:"button",variant:"outline",className:"mt-4 w-full rounded-2xl",onClick:()=>Ue(!0),children:"Voir les séries"})]}),!Ge&&!Q?e.jsxs(os,{className:"bottom-0 z-[60]",containerClassName:"gap-3 py-4",children:[e.jsxs(F,{className:"flex-1 min-w-0 h-12 rounded-xl text-sm font-bold shadow-lg active:scale-95 transition-transform",onClick:de,children:[e.jsx(Gt,{className:"mr-2 h-5 w-5"})," Valider série"]}),e.jsx(F,{type:"button",variant:"outline",className:"h-12 w-12 rounded-xl p-0 active:scale-95 transition-transform",onClick:()=>{Le<=0||c(Le)},"aria-label":"Démarrer le repos",children:e.jsx(an,{className:"h-5 w-5"})}),e.jsx(F,{type:"button",variant:"outline",className:"h-12 w-12 rounded-xl p-0 active:scale-95 transition-transform",onClick:()=>z(),"aria-label":"Exercice suivant",children:e.jsx(qt,{className:"h-5 w-5"})})]}):null,Q&&e.jsxs("div",{className:"fixed inset-0 z-50 flex flex-col bg-background/95 pb-[env(safe-area-inset-bottom)]",children:[e.jsxs("div",{className:"flex items-start justify-between border-b px-6 py-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-semibold text-muted-foreground",children:"Timer"}),e.jsx("div",{className:"text-lg font-semibold",children:"Transition inter-exercice"}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Prochain exercice : ",Ye?.nom_exercice??"À venir"]})]}),e.jsx(F,{variant:"ghost",size:"icon",onClick:()=>{G(!1),W(!1)},"aria-label":"Fermer le timer de repos",children:e.jsx(Et,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"flex flex-1 flex-col items-center justify-center gap-6 px-6 py-8",children:[e.jsxs(Xe,{className:"w-full max-w-sm rounded-3xl border p-6 shadow-sm",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Temps restant"}),e.jsxs("div",{className:"mt-2 text-5xl font-semibold tracking-tight",children:[Math.floor($/60),":",String($%60).padStart(2,"0")]}),e.jsx("div",{className:"mt-6 h-3 w-full overflow-hidden rounded-full bg-muted",children:e.jsx("div",{className:"h-full rounded-full bg-primary",style:{width:Le?`${$/Le*100}%`:"0%"}})}),e.jsxs("div",{className:"mt-6 flex flex-wrap gap-3",children:[e.jsx(F,{variant:"outline",className:"rounded-full",onClick:()=>{K.current+=15*1e3,h(a=>a+15)},children:"+15s"}),e.jsx(F,{variant:"outline",className:"rounded-full",onClick:()=>{K.current+=30*1e3,h(a=>a+30)},children:"+30s"}),e.jsx(F,{variant:"outline",className:"rounded-full",onClick:()=>{K.current=Math.max(Date.now(),K.current-15*1e3),h(a=>Math.max(0,a-15))},children:"-15s"}),e.jsxs(F,{variant:"outline",className:"ml-auto rounded-full",onClick:()=>{K.current=Date.now()+Le*1e3,h(Le)},children:[e.jsx(Ls,{className:"mr-2 h-4 w-4"}),"Reset"]})]})]}),e.jsxs("div",{className:"flex w-full max-w-sm flex-wrap gap-3",children:[e.jsxs(F,{className:"flex-1 rounded-full py-6 text-base font-semibold",onClick:()=>{ee&&(K.current=Date.now()+$*1e3),W(a=>!a)},children:[e.jsx(mn,{className:"mr-2 h-4 w-4"})," ",ee?"Reprendre":"Pause"]}),e.jsxs(F,{variant:"outline",className:"rounded-full px-6 py-6 text-base font-semibold",onClick:()=>{K.current=0,G(!1),h(0),W(!1)},children:["Passer ",e.jsx(qt,{className:"ml-2 h-4 w-4"})]})]})]})]}),De&&le?.illustration_gif&&e.jsx("div",{className:"fixed inset-0 z-50 bg-black/50",onClick:()=>We(!1),children:e.jsx("div",{className:"fixed inset-0 flex items-center justify-center p-4",onClick:a=>a.stopPropagation(),children:e.jsxs("div",{className:"relative",children:[e.jsx("button",{type:"button","aria-label":"Fermer",className:"absolute -right-3 -top-3 rounded-full bg-background p-2 shadow",onClick:()=>We(!1),children:e.jsx(Et,{className:"h-4 w-4"})}),e.jsx("img",{src:le.illustration_gif,alt:"",className:"max-h-[80vh] w-auto max-w-[92vw] rounded-2xl",loading:"lazy"})]})})}),e.jsx(Lt,{open:ke,onOpenChange:Ue,children:e.jsxs(Ft,{side:"bottom",className:"max-h-[80vh] overflow-y-auto",children:[e.jsx(Ht,{children:e.jsx(zt,{children:"Aperçu séance"})}),e.jsx("div",{className:"mt-4 space-y-4",children:oe.map((a,y)=>{const V=n.find(ze=>ze.id===a.exercise_id),b=Array.from({length:a.sets}).filter((ze,ut)=>ve.get(`${a.exercise_id}-${ut+1}`)).length,Me=a.sets?Math.round(b/a.sets*100):0;return e.jsxs(Xe,{className:"rounded-3xl border bg-muted/10 p-4 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-base font-semibold",children:V?.nom_exercice??a.exercise_name}),e.jsxs("div",{className:"mt-1 text-sm text-muted-foreground",children:[Be(a.sets),"x",Be(a.reps)," ·"," ",a.percent_1rm?`${Be(a.percent_1rm)} 1RM`:"—"]})]}),e.jsxs("div",{className:"rounded-full bg-muted px-3 py-1 text-sm font-semibold",children:[b,"/",Be(a.sets)]})]}),e.jsx("div",{className:"mt-4 h-3 w-full overflow-hidden rounded-full bg-muted",children:e.jsx("div",{className:"h-full rounded-full bg-primary",style:{width:`${Me}%`}})})]},`${a.exercise_id}-${y}`)})})]})}),e.jsx(ys,{open:Ge,onOpenChange:_,children:e.jsx(ws,{className:"max-h-[90vh]",children:e.jsxs("div",{className:"mx-auto w-full max-w-md px-4 pb-8",children:[e.jsxs(js,{className:"pb-2",children:[e.jsx(Ns,{className:"text-center",children:ie==="weight"?"Charge":"Répétitions"}),e.jsxs(Ss,{className:"text-center",children:["Série ",q,"/",Be(R?.sets)," · Objectif"," ",Be(R?.reps)," reps"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-4",children:[e.jsxs("button",{type:"button",className:je("rounded-xl border-2 p-4 text-center transition-all",ie==="weight"?"border-primary bg-primary/10 shadow-sm":"border-muted bg-card hover:border-muted-foreground/30"),onClick:()=>yt("weight"),children:[e.jsx("div",{className:"text-xs font-semibold uppercase text-muted-foreground",children:"Charge"}),e.jsxs("div",{className:"mt-1 text-2xl font-bold tabular-nums",children:[ie==="weight"?Se||"—":String(P[q-1]?.weight??I??"—"),e.jsx("span",{className:"ml-1 text-base font-normal text-muted-foreground",children:"kg"})]})]}),e.jsxs("button",{type:"button",className:je("rounded-xl border-2 p-4 text-center transition-all",ie==="reps"?"border-primary bg-primary/10 shadow-sm":"border-muted bg-card hover:border-muted-foreground/30"),onClick:()=>yt("reps"),children:[e.jsx("div",{className:"text-xs font-semibold uppercase text-muted-foreground",children:"Reps"}),e.jsxs("div",{className:"mt-1 text-2xl font-bold tabular-nums",children:[ie==="reps"?Se||"—":String(P[q-1]?.reps??R?.reps??"—"),e.jsx("span",{className:"ml-1 text-base font-normal text-muted-foreground",children:"reps"})]})]})]}),ie==="weight"&&I>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"text-xs font-semibold text-muted-foreground mb-2",children:"Suggestions"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:[I-10,I-5,I,I+5,I+10].filter(a=>a>0).map(a=>e.jsxs(F,{variant:Number(Se)===a?"default":"outline",size:"sm",className:"rounded-full px-4 h-10 text-sm font-semibold",onClick:()=>ge(String(a)),children:[a," kg"]},a))})]}),ie==="reps"&&e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"text-xs font-semibold text-muted-foreground mb-2",children:"Suggestions"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:[6,8,10,12,15,20].map(a=>e.jsx(F,{variant:Number(Se)===a?"default":"outline",size:"sm",className:"rounded-full px-4 h-10 text-sm font-semibold",onClick:()=>ge(String(a)),children:a},a))})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 mb-4",children:[[1,2,3,4,5,6,7,8,9].map(a=>e.jsx(F,{variant:"outline",className:"h-14 text-xl font-semibold rounded-xl active:scale-95 transition-transform",onClick:()=>ot(String(a)),children:a},a)),e.jsx(F,{variant:"outline",className:"h-14 text-xl font-semibold rounded-xl active:scale-95 transition-transform",onClick:()=>ot("."),children:","}),e.jsx(F,{variant:"outline",className:"h-14 text-xl font-semibold rounded-xl active:scale-95 transition-transform",onClick:()=>ot("0"),children:"0"}),e.jsx(F,{variant:"outline",className:"h-14 text-xl font-semibold rounded-xl active:scale-95 transition-transform",onClick:()=>{me(!1),ge(a=>a.slice(0,-1))},children:"⌫"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(F,{variant:"outline",className:"flex-1 h-14 text-base font-semibold rounded-xl",onClick:()=>{me(!1),ge("")},children:"Effacer"}),e.jsxs(F,{className:"flex-1 h-14 text-base font-semibold rounded-xl",onClick:be,children:[e.jsx(Gt,{className:"mr-2 h-5 w-5"}),"Valider"]})]})]})})}),B&&e.jsx(Ks,{open:dt,onOpenChange:Y,children:e.jsxs(Qs,{children:[e.jsxs(Ys,{children:[e.jsx(Xs,{children:"Quitter la séance ?"}),e.jsx(Gs,{children:"Les séries enregistrées seront conservées."})]}),e.jsxs(Js,{children:[e.jsx(Zs,{children:"Annuler"}),e.jsx(en,{onClick:()=>{Y(!1),B()},children:"Quitter"})]})]})}),k&&e.jsx(Lt,{open:Ke,onOpenChange:a=>{if(!a&&R){const y=at.trim()||null,V=U?.[R.exercise_id]??null;y!==V&&k(R.exercise_id,y)}Fe(a)},children:e.jsxs(Ft,{side:"bottom",className:"max-h-[60vh]",children:[e.jsx(Ht,{children:e.jsxs(zt,{children:["Notes — ",le?.nom_exercice]})}),e.jsx("textarea",{value:at,onChange:a=>Qe(a.target.value),placeholder:"Réglages machine, repères personnels...",rows:4,className:"flex w-full rounded-md border border-input bg-background px-3 py-2 text-sm mt-4 resize-none ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring"})]})})]})}const st=t=>t==="endurance"||t==="hypertrophie"||t==="force"?t:"endurance",pt=t=>{const n=Number(t);return!Number.isFinite(n)||n<=0?null:n},Kn=(t,n)=>{if(!t)return{sets:null,reps:null,percent1rm:null,restSeries:null,restExercise:null};const r={endurance:{sets:t.Nb_series_endurance,reps:t.Nb_reps_endurance,percent1rm:t.pct_1rm_endurance,restSeries:t.recup_endurance,restExercise:t.recup_exercices_endurance},hypertrophie:{sets:t.Nb_series_hypertrophie,reps:t.Nb_reps_hypertrophie,percent1rm:t.pct_1rm_hypertrophie,restSeries:t.recup_hypertrophie,restExercise:t.recup_exercices_hypertrophie},force:{sets:t.Nb_series_force,reps:t.Nb_reps_force,percent1rm:t.pct_1rm_force,restSeries:t.recup_force,restExercise:t.recup_exercices_force}}[n];return{sets:pt(r.sets),reps:pt(r.reps),percent1rm:pt(r.percent1rm),restSeries:pt(r.restSeries),restExercise:pt(r.restExercise)}},xt=(t=[],n,r)=>Yn(t,n).map(i=>{const l=Kn(r.get(i.exercise_id),n);return{...i,sets:l.sets??0,reps:l.reps??0,rest_seconds:l.restSeries??0,percent_1rm:l.percent1rm??0}}),rs=t=>{const n=Number(t);return!Number.isFinite(n)||n<=0?"—":String(n)},Qn=t=>{const n=Number(t);return!Number.isFinite(n)||n<=0?"—":`${n}s`},Cs=(t=[])=>{if(!t.length)return t;const n=t.map((i,l)=>{const o=Number(i.order_index);return{item:i,index:l,order:Number.isFinite(o)?o:null}});return n.some(i=>i.order!==null)?n.sort((i,l)=>i.order===null&&l.order===null?i.index-l.index:i.order===null?1:l.order===null?-1:i.order===l.order?i.index-l.index:i.order-l.order).map(i=>i.item):t},Yn=(t=[],n)=>{const r=t.filter(l=>l.cycle_type===n),i=r.length?r:t;return Cs(i)},Xn=t=>{t.setActiveSession(null),t.setActiveAssignment(null),t.setActiveRunId(null),t.setActiveRunLogs(null),t.setActiveRunnerStep(0),t.setScreenMode("list")},Gn=({runId:t,assignmentId:n,startedAt:r})=>({id:t,assignment_id:n??null,started_at:r,progress_pct:0,status:"in_progress",logs:[]}),$t=t=>({runs:t?[t]:[],pagination:{limit:1,offset:0,total:t?1:0},exercise_summary:[]});function Nr(){const{user:t,userId:n,role:r,selectedAthleteId:i,selectedAthleteName:l}=Fs(),{toast:o}=as(),p=Os(),x="strength-preferences",[f,T]=m.useState(null),[v,S]=m.useState(null),[w,B]=m.useState(null),[U,k]=m.useState(null),[Z,j]=m.useState(0),[C,O]=m.useState("list"),[N,re]=m.useState(!1),[pe,d]=m.useState("idle"),[D,M]=m.useState({poolMode:!1,largeText:!1}),[te,se]=m.useState(""),[$,h]=m.useState("endurance"),[Q,G]=m.useState("all"),[ee,W]=m.useState(""),[K,xe]=m.useState(""),Ae=(r==="coach"||r==="admin")&&(i!==null||!!l),Ie=Ae?l:t,Ve=Ae?i:n,J=Ve??Ie,Ne=m.useMemo(()=>`strength-focus-state-${J??"anonymous"}`,[J]),{poolMode:Ee,largeText:Oe}=D;m.useEffect(()=>{if(typeof window>"u")return;const s=window.localStorage.getItem(x);if(s)try{const c=JSON.parse(s);M(z=>({...z,...c??{}}))}catch{return}},[]),m.useEffect(()=>{typeof window>"u"||window.localStorage.setItem(x,JSON.stringify(D))},[x,D]),m.useEffect(()=>{if(!(typeof document>"u")){if(C==="focus")return document.body.dataset.focusMode="strength",()=>{document.body.dataset.focusMode==="strength"&&delete document.body.dataset.focusMode};document.body.dataset.focusMode==="strength"&&delete document.body.dataset.focusMode}},[C]),m.useEffect(()=>{if(typeof window>"u"||f)return;const s=window.localStorage.getItem(Ne);if(s)try{const c=JSON.parse(s),z=c?.screenMode==="focus"?"focus":c?.screenMode==="reader"?"reader":null;if(!z||!c?.session)return;T(c.session),S(c.assignment??null),B(typeof c.runId=="number"?c.runId:null),k(Array.isArray(c.runLogs)?c.runLogs:null),j(Number.isFinite(c.runnerStep)?c.runnerStep:0),c.cycleType&&h(st(c.cycleType)),O(z)}catch{return}},[f,Ne]),m.useEffect(()=>{if(typeof window>"u")return;if(!(C==="focus"||C==="reader")||!f){window.localStorage.removeItem(Ne);return}const c={screenMode:C,session:f,assignment:v,runId:w,runLogs:U,runnerStep:Z,cycleType:$};window.localStorage.setItem(Ne,JSON.stringify(c))},[v,w,U,Z,f,$,Ne,C]);const{data:$e,isLoading:Pe,error:q,refetch:Te}=mt({queryKey:["assignments",t,"strength"],queryFn:()=>Re.getAssignments(t,n,{assignmentType:"strength"}),enabled:!!t}),{data:ke,isLoading:Ue,error:Ge,refetch:_}=mt({queryKey:["strength_catalog"],queryFn:()=>Re.getStrengthSessions()}),{data:ie,error:Je,refetch:Se}=mt({queryKey:["exercises"],queryFn:()=>Re.getExercises()}),ge=Pe||Ue,rt=q||Ge||Je,me=()=>{Te(),_(),Se()},{data:De}=mt({queryKey:["1rm",t,n],queryFn:()=>Re.get1RM({athleteName:t,athleteId:n}),enabled:!!t}),We=m.useMemo(()=>{const s={};return(De??[]).forEach(c=>{c.notes&&(s[c.exercise_id]=c.notes)}),s},[De]),fe=$s({queryKey:["strength_history",J,Q,ee,K],queryFn:({pageParam:s=0})=>Re.getStrengthHistory(Ie,{athleteId:Ve,limit:10,offset:s,order:"desc",status:Q==="all"?void 0:Q,from:ee||void 0,to:K||void 0}),enabled:!!Ie,getNextPageParam:s=>{const c=s.pagination.offset+s.pagination.limit;return c<s.pagination.total?c:void 0},initialPageParam:0}),Ze=fe.data?.pages.flatMap(s=>s.runs)??[],Y=mt({queryKey:["strength_run_in_progress",J],queryFn:()=>Re.getStrengthHistory(Ie,{limit:1,offset:0,order:"desc",status:"in_progress",athleteId:Ve}),enabled:!!Ie}).data?.runs?.[0]??null,Ke=Y?.status==="completed"||(Y?.progress_pct??0)>=100,Fe=lt({mutationFn:s=>Re.startStrengthRun(s),onMutate:()=>{d("saving")},onSuccess:s=>{if(d("saved"),setTimeout(()=>d("idle"),2e3),s?.run_id&&(B(s.run_id),k(c=>c??[]),J)){const c=Gn({runId:s.run_id,assignmentId:v?.id??null,startedAt:new Date().toISOString()});p.setQueryData(["strength_run_in_progress",J],$t(c))}p.invalidateQueries({queryKey:["assignments",t,"strength"]}),p.invalidateQueries({queryKey:["strength_run_in_progress",J]}),p.invalidateQueries({queryKey:["strength_history"]})},onError:()=>{d("error"),setTimeout(()=>d("idle"),3e3),o({title:"Erreur",description:"Impossible de démarrer la séance.",variant:"destructive"})}}),at=lt({mutationFn:s=>Re.logStrengthSet(s),onMutate:()=>{d("saving")},onSuccess:s=>{d("saved"),setTimeout(()=>d("idle"),2e3),s?.one_rm_updated&&(p.invalidateQueries({queryKey:["1rm",t,n]}),o({title:"Nouveau 1RM détecté",description:"Ton record vient d'être mis à jour."}))},onError:()=>{d("error"),setTimeout(()=>d("idle"),3e3),o({title:"Erreur",description:"Impossible d'enregistrer une série.",variant:"destructive"})}}),Qe=lt({mutationFn:s=>Re.updateStrengthRun(s),onMutate:()=>{d("saving")},onSuccess:(s,c)=>{d("saved"),setTimeout(()=>d("idle"),2e3),re(!1),p.invalidateQueries({queryKey:["strength_history"]}),c?.status==="completed"&&(J&&p.setQueryData(["strength_run_in_progress",J],$t(null)),p.invalidateQueries({queryKey:["assignments",t]}),p.invalidateQueries({queryKey:["assignments",t,"strength"]}),p.invalidateQueries({queryKey:["1rm",t,n]}),S(null),B(null),T(null),k(null),O("list"),o({title:"Séance sauvegardée",description:"Bravo pour l'effort !"}))},onError:(s,c)=>{d("error"),setTimeout(()=>d("idle"),3e3),c?.status==="completed"&&(re(!1),o({title:"Erreur",description:"Impossible d'enregistrer la séance. Réessayez.",variant:"destructive"}))}}),oe=lt({mutationFn:s=>Re.updateExerciseNote({athlete_id:n??0,exercise_id:s.exercise_id,notes:s.notes}),onMutate:()=>{d("saving")},onSuccess:()=>{d("saved"),setTimeout(()=>d("idle"),2e3),p.invalidateQueries({queryKey:["1rm",t,n]})},onError:()=>{d("error"),setTimeout(()=>d("idle"),3e3),o({title:"Erreur",description:"Impossible de sauvegarder la note.",variant:"destructive"})}});lt({mutationFn:s=>Re.startStrengthRun(s),onError:()=>{o({title:"Erreur",description:"Impossible de mettre à jour la séance.",variant:"destructive"})}});const He=(s,c)=>{const z=s.items??[],de=st(c??s.cycle??z.find(be=>be.cycle_type)?.cycle_type),he=xt(z,de,E);S(s),T({...s,title:s.title,description:s.description,cycle:de,items:he}),B(null),k(null),j(0),O("reader")},le=($e?.filter(s=>s.session_type==="strength")||[]).filter(s=>s.status!=="completed"),_e=Y?le.find(s=>s.id===Y.assignment_id)??null:null,Ye=Y&&!_e?ke?.find(s=>s.id===Y.session_id)??null:null,it=(!!_e?.items?.length||!!Ye?.items?.length)&&!Ke,Le=le.map(s=>({...s,session:{id:s.session_id,title:s.title,description:s.description,cycle:st(s.cycle),items:s.items??[]}})),g=[{value:"endurance",label:"Endurance"},{value:"hypertrophie",label:"Hypertrophie"},{value:"force",label:"Force"}],E=m.useMemo(()=>ie?new Map(ie.map(s=>[s.id,s])):new Map,[ie]),L=Le.map(s=>{const c=xt(s.items??[],$,E);return{key:`assignment-${s.id}`,title:s.title,description:s.description,type:"assignment",assignedDate:s.assigned_date,session:{id:s.session_id,title:s.title,description:s.description,cycle:st(s.cycle),items:c},assignment:s,exerciseCount:c.length}}),A=(ke??[]).map(s=>{const c=xt(s.items??[],$,E);return{key:`catalog-${s.id}`,title:s.title,description:s.description,type:"catalog",session:{...s,items:c,cycle:$},exerciseCount:c.length}}),I=te.trim().toLowerCase(),P=[...L,...A].filter(s=>I?`${s.title} ${s.description}`.toLowerCase().includes(I):!0),H=m.useMemo(()=>f?xt(f.items??[],$,E):[],[f,$,E]),ve=s=>{if((s.items??[]).length===0){o({title:"Séance vide",description:"Aucun exercice n'est disponible pour cette séance."});return}He(s,$),B(null),k(null)},ce=s=>{const c=s.items??[],de=c.filter(be=>be.cycle_type===$).length>0?$:st(s.cycle??c.find(be=>be.cycle_type)?.cycle_type),he=xt(c,de,E);if(he.length===0){o({title:"Séance vide",description:"Aucun exercice n'est disponible pour cette séance."});return}T({...s,cycle:de,items:he}),S(null),B(null),k(null),j(0),O("reader")},ye=()=>{if(f){if(H.length===0){o({title:"Séance vide",description:"Aucun exercice n'est disponible pour cette séance."});return}T({...f,cycle:$,items:H}),j(0),O("focus")}},Ce=()=>{Xn({setActiveSession:T,setActiveAssignment:S,setActiveRunId:B,setActiveRunLogs:k,setActiveRunnerStep:j,setScreenMode:O})},ue=lt({mutationFn:s=>Re.deleteStrengthRun(s),onMutate:()=>{d("saving")},onSuccess:s=>{d("saved"),setTimeout(()=>d("idle"),2e3),Ce(),J&&p.setQueryData(["strength_run_in_progress",J],$t(null)),p.invalidateQueries({queryKey:["strength_run_in_progress",J]}),p.invalidateQueries({queryKey:["strength_history"]}),p.invalidateQueries({queryKey:["assignments",t,"strength"]});const c=s?.source==="local"?"Suppression locale : le serveur n'est pas disponible.":void 0;o({title:"Séance supprimée",description:c})},onError:()=>{d("error"),setTimeout(()=>d("idle"),3e3),o({title:"Erreur",description:"Impossible de supprimer la séance en cours.",variant:"destructive"})}});return Pe||Ue?e.jsxs("div",{className:"space-y-4 md:space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(we,{className:"h-8 w-32"}),e.jsx(we,{className:"h-10 w-10 rounded-full"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(we,{className:"h-10 w-32"}),e.jsx(we,{className:"h-10 w-32"})]}),e.jsxs("div",{className:"flex gap-2 overflow-x-auto pb-2",children:[e.jsx(we,{className:"h-9 w-28 rounded-full"}),e.jsx(we,{className:"h-9 w-32 rounded-full"}),e.jsx(we,{className:"h-9 w-24 rounded-full"})]}),e.jsx(we,{className:"h-10 w-full rounded-lg"}),e.jsx("div",{className:"space-y-3",children:Array.from({length:3}).map((s,c)=>e.jsxs(Xe,{className:"overflow-hidden",children:[e.jsx(Ct,{children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx(we,{className:"h-5 w-48"}),e.jsx(we,{className:"h-4 w-32"})]}),e.jsx(we,{className:"h-6 w-20 rounded-full"})]})}),e.jsxs(Rt,{className:"space-y-2",children:[e.jsx(we,{className:"h-4 w-full"}),e.jsx(we,{className:"h-4 w-3/4"})]})]},`skeleton-${c}`))})]}):rt?e.jsxs("div",{className:"flex flex-col items-center justify-center p-8 text-center",children:[e.jsx(on,{className:"h-12 w-12 text-destructive mb-4"}),e.jsx("h3",{className:"font-semibold",children:"Impossible de charger les données"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:rt.message}),e.jsx(F,{onClick:()=>me(),className:"mt-4",children:"Réessayer"})]}):e.jsx("div",{className:je("space-y-4 md:space-y-6",Ee&&"dark bg-background text-foreground contrast-125",Oe&&"text-lg leading-relaxed [&_.text-xs]:text-sm [&_.text-sm]:text-base"),children:C==="focus"&&f?ie?e.jsx("div",{className:"animate-in fade-in motion-reduce:animate-none",children:e.jsx(Wn,{session:f,exercises:ie,oneRMs:De||[],exerciseNotes:We,onUpdateNote:(s,c)=>oe.mutate({exercise_id:s,notes:c}),initialLogs:U,initialStep:Z,isFinishing:N,onStepChange:s=>j(s),onExitFocus:()=>O("reader"),onStart:async()=>{if(w)return;const s=v?.session_id??f?.id??null;if(!s){o({title:"Session manquante",description:"Impossible de démarrer sans session associée.",variant:"destructive"});return}const c={assignment_id:v?.id??null,athlete_id:n??null,athleteName:t??void 0,progress_pct:0,session_id:s,cycle_type:f?.cycle};try{const z=await Fe.mutateAsync(c);z?.run_id&&B(z.run_id)}catch{return}},onLogSets:async s=>{w&&(k(c=>[...c??[],...s]),await Promise.all(s.map((c,z)=>at.mutateAsync({run_id:w,exercise_id:c.exercise_id,set_index:c.set_number??z+1,reps:c.reps??null,weight:c.weight??null,athlete_id:n??null,athlete_name:t??null}))))},onProgress:async s=>{w&&await Qe.mutateAsync({run_id:w,progress_pct:s,status:"in_progress"})},onFinish:s=>{w&&(re(!0),Qe.mutate({assignment_id:v?.id??void 0,run_id:w,session_id:v?.session_id??f?.id??void 0,athlete_id:n??void 0,date:new Date().toISOString(),progress_pct:100,status:"completed",...s}))}})}):e.jsxs("div",{className:"space-y-4 py-10",children:[e.jsx("div",{className:"mx-auto h-8 w-48 rounded-lg bg-muted animate-pulse motion-reduce:animate-none"}),e.jsx("div",{className:"mx-auto h-4 w-32 rounded-lg bg-muted animate-pulse motion-reduce:animate-none"}),e.jsx("div",{className:"space-y-3 pt-4",children:[1,2,3].map(s=>e.jsx("div",{className:"h-20 w-full rounded-xl bg-muted animate-pulse motion-reduce:animate-none"},s))})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-3xl font-display font-bold uppercase italic text-primary",children:"Musculation"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(F,{variant:"ghost",size:"sm","aria-label":"Informations sur le calcul du 1RM",onClick:()=>{window.location.hash="#/records?tab=1rm"},className:"text-muted-foreground",children:[e.jsx(nt,{className:"mr-2 h-4 w-4"})," Info 1RM"]}),e.jsx(F,{variant:"ghost",size:"icon",onClick:()=>O("settings"),className:"rounded-full border border-muted/50 text-muted-foreground","aria-label":"Paramètres",children:e.jsx(hn,{className:"h-4 w-4"})})]})]}),e.jsxs(Us,{defaultValue:"start",className:"w-full",children:[e.jsxs(Ws,{className:"grid w-full grid-cols-2",children:[e.jsx(Qt,{value:"start",children:"S'entraîner"}),e.jsx(Qt,{value:"history",children:"Historique"})]}),e.jsxs(Yt,{value:"start",className:"space-y-5 pt-4",children:[C==="list"&&ge&&e.jsxs("div",{className:"space-y-5 pt-4",children:[e.jsx("div",{className:"flex justify-center gap-2",children:[1,2,3].map(s=>e.jsx("div",{className:"h-10 w-28 rounded-full bg-muted animate-pulse"},s))}),e.jsx("div",{className:"h-12 rounded-2xl bg-muted/30 animate-pulse"}),e.jsx("div",{className:"space-y-3",children:[1,2,3,4].map(s=>e.jsx("div",{className:"rounded-2xl border bg-card p-4 shadow-sm",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"h-12 w-12 shrink-0 rounded-xl bg-muted animate-pulse"}),e.jsxs("div",{className:"flex-1 min-w-0 space-y-2",children:[e.jsx("div",{className:"h-4 w-3/4 rounded bg-muted animate-pulse"}),e.jsx("div",{className:"h-3 w-1/2 rounded bg-muted animate-pulse"})]}),e.jsx("div",{className:"h-10 w-10 shrink-0 rounded-full bg-muted animate-pulse"})]})},s))})]}),C==="list"&&!ge&&e.jsxs("div",{className:"space-y-5 animate-in fade-in motion-reduce:animate-none",children:[e.jsxs("p",{className:"text-center text-sm text-muted-foreground py-1",children:[P.length," séance",P.length>1?"s":""," disponible",P.length>1?"s":""]}),e.jsx("div",{className:"flex justify-center gap-2",children:g.map(s=>e.jsx("button",{type:"button",onClick:()=>h(st(s.value)),className:je("px-5 py-2.5 rounded-full text-sm font-semibold transition-all active:scale-95",$===s.value?"bg-primary text-primary-foreground shadow-md":"bg-muted/50 text-muted-foreground hover:bg-muted"),children:s.label},s.value))}),e.jsxs("div",{className:"relative",children:[e.jsx(ln,{className:"absolute left-4 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground pointer-events-none"}),e.jsx(Dt,{placeholder:"Rechercher une séance...",className:"h-12 rounded-2xl bg-muted/30 pl-11 pr-4 border-0 shadow-sm focus-visible:ring-2",value:te,onChange:s=>se(s.target.value),"aria-label":"Rechercher une séance"})]}),Y&&e.jsxs("div",{className:"relative overflow-hidden rounded-2xl bg-gradient-to-br from-primary/10 via-primary/5 to-transparent border-2 border-primary/30 p-5",children:[e.jsx("div",{className:"absolute top-0 right-0 w-24 h-24 bg-primary/10 rounded-full blur-2xl -mr-8 -mt-8"}),e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsxs("span",{className:"relative flex h-3 w-3",children:[e.jsx("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-primary opacity-75"}),e.jsx("span",{className:"relative inline-flex rounded-full h-3 w-3 bg-primary"})]}),e.jsx("span",{className:"text-xs font-bold uppercase tracking-wider text-primary",children:Ke?"Complétée":"En cours"})]}),e.jsx("h3",{className:"text-xl font-bold tracking-tight mb-1",children:_e?.title??"Séance en cours"}),e.jsxs("p",{className:"text-sm text-muted-foreground mb-4",children:["Démarrée le ",Nt(new Date(Y.started_at||new Date),"dd MMMM",{locale:jt})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex justify-between text-xs font-semibold mb-1.5",children:[e.jsx("span",{className:"text-muted-foreground",children:"Progression"}),e.jsxs("span",{className:"text-primary",children:[Math.round(Y.progress_pct??0),"%"]})]}),e.jsx("div",{className:"h-2 rounded-full bg-muted overflow-hidden",children:e.jsx("div",{className:"h-full rounded-full bg-primary transition-all duration-500",style:{width:`${Y.progress_pct??0}%`}})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(F,{className:"flex-1 h-12 rounded-xl font-semibold",disabled:!it,onClick:()=>{const s=_e??Ye;if(!s)return;const c=_e?.items??Ye?.items??[],z=st(_e?.cycle??Ye?.cycle??c.find(be=>be.cycle_type)?.cycle_type),de=c.filter(be=>be.cycle_type===z),he=Cs(de.length?de:c);S(_e??null),T({...s,title:s.title,description:s.description??null,cycle:z,items:he}),B(Y.id),k(Y.logs??[]),j(_s(he,Y.logs??[],Y.progress_pct)),O("focus")},children:Ke?"Voir le résumé":"Reprendre"}),!Ke&&e.jsx(F,{variant:"outline",className:"h-12 w-12 rounded-xl p-0",disabled:ue.isPending,onClick:()=>{!Y||!window.confirm("Supprimer la séance en cours ?")||ue.mutate(Y.id)},"aria-label":"Supprimer la séance",children:e.jsx(Et,{className:"h-5 w-5"})})]})]})]}),!Y&&P.length>0&&e.jsxs("div",{className:"flex items-center gap-2 pt-2",children:[e.jsx(nt,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-xs font-semibold uppercase tracking-wider text-muted-foreground",children:"Choisir une séance"})]}),P.length>0?e.jsx("div",{className:"space-y-3",children:P.map(s=>e.jsx("button",{type:"button",className:"group w-full rounded-2xl border bg-card p-4 text-left shadow-sm transition-all active:scale-[0.98] hover:shadow-md hover:border-primary/30",onClick:()=>{if(s.type==="assignment"){ve(s.assignment);return}ce(s.session)},children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:je("flex h-12 w-12 shrink-0 items-center justify-center rounded-xl",s.type==="assignment"?"bg-primary/10 text-primary":"bg-muted text-muted-foreground"),children:e.jsx(nt,{className:"h-5 w-5"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-0.5",children:[s.type==="assignment"&&e.jsx("span",{className:"inline-flex items-center rounded-full bg-primary/10 px-2 py-0.5 text-[10px] font-bold uppercase text-primary",children:"Assignée"}),s.type==="assignment"&&s.assignedDate&&e.jsx("span",{className:"text-xs text-muted-foreground",children:Nt(new Date(s.assignedDate),"dd MMM",{locale:jt})})]}),e.jsx("h3",{className:"font-semibold tracking-tight truncate",children:s.title}),e.jsxs("p",{className:"text-sm text-muted-foreground truncate",children:[s.exerciseCount," exercice",s.exerciseCount>1?"s":"",s.description?` · ${s.description}`:""]})]}),e.jsx("div",{className:"flex h-10 w-10 shrink-0 items-center justify-center rounded-full bg-muted/50 text-muted-foreground transition-colors group-hover:bg-primary group-hover:text-primary-foreground",children:e.jsx(Xt,{className:"h-4 w-4 ml-0.5"})})]})},s.key))}):e.jsxs("div",{className:"py-12 text-center",children:[e.jsx("div",{className:"mx-auto mb-4 flex h-16 w-16 items-center justify-center rounded-full bg-muted",children:e.jsx(nt,{className:"h-7 w-7 text-muted-foreground"})}),e.jsx("h3",{className:"font-semibold",children:"Aucune séance"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Essayez un autre mot-clé ou changez de cycle."})]})]}),C==="settings"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[e.jsxs(F,{variant:"ghost",size:"sm",onClick:()=>O("list"),className:"gap-2",children:[e.jsx(Jt,{className:"h-4 w-4"}),"Retour"]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.3em] text-muted-foreground",children:"Préférences"}),e.jsx("h2",{className:"text-2xl font-display font-bold uppercase text-primary",children:"Paramètres"})]})]}),e.jsxs(Xe,{className:"border border-muted/60 shadow-sm",children:[e.jsxs(Ct,{children:[e.jsx(Pt,{className:"text-lg uppercase",children:"Lisibilité & contrastes"}),e.jsx(is,{children:"Ajuste l'écran pour rester lisible en bassin comme en extérieur."})]}),e.jsxs(Rt,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-4 rounded-lg border bg-muted/30 p-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm font-semibold uppercase",children:"Mode piscine"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Contraste renforcé et lisibilité optimisée."})]}),e.jsx(Bt,{checked:Ee,onCheckedChange:s=>M(c=>({...c,poolMode:s}))})]}),e.jsxs("div",{className:"flex items-center justify-between gap-4 rounded-lg border bg-muted/30 p-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm font-semibold uppercase",children:"Texte grand"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Police plus large pour lire pendant l'effort."})]}),e.jsx(Bt,{checked:Oe,onCheckedChange:s=>M(c=>({...c,largeText:s}))})]})]})]}),e.jsx(Xe,{className:"border border-muted/60 shadow-sm",children:e.jsxs(Rt,{className:"space-y-3 pt-6",children:[e.jsxs("div",{className:"flex items-center gap-3 text-sm text-muted-foreground",children:[e.jsx(tn,{className:"h-4 w-4"}),e.jsx("span",{children:"Les préférences sont enregistrées sur cet appareil."})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 text-xs font-semibold uppercase text-muted-foreground",children:[Ee&&e.jsx(gt,{variant:"secondary",children:"Mode piscine activé"}),Oe&&e.jsx(gt,{variant:"secondary",children:"Texte grand activé"}),!Ee&&!Oe&&e.jsx(gt,{variant:"outline",children:"Réglages par défaut"})]})]})})]}),C==="reader"&&f&&e.jsxs("div",{className:"space-y-5 animate-in fade-in motion-reduce:animate-none pb-40",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{type:"button",onClick:()=>O("list"),className:"flex h-10 w-10 items-center justify-center rounded-full bg-muted/50 text-muted-foreground transition-colors hover:bg-muted active:scale-95","aria-label":"Retour",children:e.jsx(Jt,{className:"h-5 w-5"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-xs font-semibold uppercase tracking-wider text-muted-foreground truncate",children:g.find(s=>s.value===$)?.label}),e.jsx("h1",{className:"text-xl font-bold tracking-tight truncate",children:f.title})]})]}),e.jsxs("div",{className:"relative overflow-hidden rounded-2xl bg-gradient-to-br from-primary/10 via-primary/5 to-transparent border border-primary/20 p-5",children:[e.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-primary/10 rounded-full blur-3xl -mr-12 -mt-12"}),e.jsxs("div",{className:"relative space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[v&&e.jsxs("span",{className:"inline-flex items-center gap-1.5 rounded-full bg-primary/20 px-3 py-1 text-xs font-bold uppercase text-primary",children:[e.jsx("span",{className:"h-1.5 w-1.5 rounded-full bg-primary"}),"Assignée"]}),!v&&e.jsx("span",{className:"inline-flex items-center rounded-full bg-muted px-3 py-1 text-xs font-semibold text-muted-foreground",children:"Catalogue"}),v?.assigned_date&&e.jsxs("span",{className:"text-xs text-muted-foreground",children:["Prévue le ",Nt(new Date(v.assigned_date),"dd MMM",{locale:jt})]})]}),f.description&&e.jsx("p",{className:"text-sm text-muted-foreground leading-relaxed",children:f.description}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex h-9 w-9 items-center justify-center rounded-xl bg-background/80",children:e.jsx(nt,{className:"h-4 w-4 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-bold leading-none",children:H.length}),e.jsx("p",{className:"text-[10px] uppercase text-muted-foreground font-semibold",children:"Exercices"})]})]}),e.jsx("div",{className:"h-8 w-px bg-border"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex h-9 w-9 items-center justify-center rounded-xl bg-background/80",children:e.jsx(dn,{className:"h-4 w-4 text-muted-foreground"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-bold leading-none",children:g.find(s=>s.value===$)?.label}),e.jsx("p",{className:"text-[10px] uppercase text-muted-foreground font-semibold",children:"Cycle"})]})]})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between gap-2 pt-1",children:[e.jsxs("span",{className:"text-xs font-semibold uppercase tracking-wider text-muted-foreground",children:[H.length," exercice",H.length>1?"s":""]}),e.jsx("div",{className:"flex-1 h-px bg-border"})]}),e.jsxs("div",{className:"space-y-2",children:[H.map((s,c)=>{const z=E.get(s.exercise_id),de=Number(s.percent_1rm),he=Number.isFinite(de)&&de>0,be=he?De?.find(Me=>Me.exercise_id===s.exercise_id)?.weight??0:0,ot=he?Math.round(be*(de/100)):0,yt=he?ot>0?`${ot} kg (${de}% 1RM)`:`${de}% 1RM`:null,a=s.notes?.trim(),y=rs(s.sets),V=rs(s.reps),b=Qn(s.rest_seconds);return e.jsxs(Lt,{children:[e.jsx(Hs,{asChild:!0,children:e.jsxs("button",{type:"button",className:"w-full flex items-center gap-3 rounded-xl border bg-card px-3 py-3 text-left transition-all active:scale-[0.98] hover:border-primary/50 hover:shadow-sm",children:[e.jsx("div",{className:"flex h-7 w-7 shrink-0 items-center justify-center rounded-full bg-primary text-xs font-bold text-primary-foreground",children:c+1}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsx("p",{className:"font-semibold text-sm truncate",children:z?.nom_exercice??s.exercise_name??"Exercice"})}),e.jsxs("div",{className:"flex items-center gap-2 shrink-0 text-xs font-medium text-muted-foreground",children:[e.jsxs("span",{className:"font-mono",children:[y,"×",V]}),e.jsx("span",{className:"text-border",children:"|"}),e.jsx("span",{className:"font-mono",children:b}),e.jsx(qt,{className:"h-4 w-4 text-muted-foreground/50"})]})]})}),e.jsxs(Ft,{side:"bottom",className:"max-h-[90vh] overflow-y-auto rounded-t-3xl pb-8",children:[e.jsx(Ht,{className:"text-left pb-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex h-10 w-10 shrink-0 items-center justify-center rounded-full bg-primary text-sm font-bold text-primary-foreground",children:c+1}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx(zt,{className:"text-xl leading-tight",children:z?.nom_exercice??s.exercise_name??"Exercice"}),z?.exercise_type&&e.jsx("p",{className:"text-sm text-muted-foreground mt-0.5",children:z.exercise_type})]})]})}),e.jsxs("div",{className:"space-y-4",children:[z?.illustration_gif&&e.jsx("div",{className:"rounded-xl overflow-hidden bg-muted/20 border aspect-video flex items-center justify-center",children:e.jsx("img",{src:z.illustration_gif,alt:z.nom_exercice??"Exercice",className:"w-full h-full max-h-36 object-contain",loading:"lazy",decoding:"async"})}),z?.description&&e.jsx("div",{className:"text-sm text-muted-foreground leading-relaxed",children:z.description}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:"rounded-xl bg-muted/40 p-3 text-center",children:[e.jsx("p",{className:"text-2xl font-bold leading-none",children:y}),e.jsx("p",{className:"text-[10px] uppercase text-muted-foreground font-semibold mt-1",children:"Séries"})]}),e.jsxs("div",{className:"rounded-xl bg-muted/40 p-3 text-center",children:[e.jsx("p",{className:"text-2xl font-bold leading-none",children:V}),e.jsx("p",{className:"text-[10px] uppercase text-muted-foreground font-semibold mt-1",children:"Reps"})]}),e.jsxs("div",{className:"rounded-xl bg-muted/40 p-3 text-center",children:[e.jsx("p",{className:"text-lg font-bold leading-none",children:yt??"—"}),e.jsx("p",{className:"text-[10px] uppercase text-muted-foreground font-semibold mt-1",children:"Charge"})]}),e.jsxs("div",{className:"rounded-xl bg-muted/40 p-3 text-center",children:[e.jsx("p",{className:"text-lg font-bold leading-none",children:b}),e.jsx("p",{className:"text-[10px] uppercase text-muted-foreground font-semibold mt-1",children:"Repos"})]})]}),a&&e.jsxs("div",{className:"rounded-xl bg-primary/5 border border-primary/20 p-4",children:[e.jsx("div",{className:"text-[10px] uppercase text-primary font-semibold mb-1",children:"Notes coach"}),e.jsx("div",{className:"text-sm text-foreground",children:a})]})]})]})]},`${s.exercise_id}-${c}`)}),H.length===0&&e.jsx("div",{className:"p-6 border-2 border-dashed rounded-xl text-center text-muted-foreground",children:"Aucun exercice disponible pour cette séance."})]}),e.jsx(os,{saveState:pe,children:e.jsxs(F,{className:"flex-1 h-14 rounded-xl font-bold text-base bg-primary hover:bg-primary/90 shadow-lg",onClick:ye,children:[e.jsx(Xt,{className:"h-5 w-5 mr-2"}),"Lancer la séance"]})})]})]}),e.jsxs(Yt,{value:"history",className:"space-y-4 pt-4",children:[e.jsxs("div",{className:"grid gap-3 md:grid-cols-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(ct,{htmlFor:"strength-history-status",children:"Statut"}),e.jsxs(zs,{value:Q,onValueChange:G,children:[e.jsx(Bs,{id:"strength-history-status",children:e.jsx(qs,{placeholder:"Tous"})}),e.jsxs(Vs,{children:[e.jsx(wt,{value:"all",children:"Tous"}),e.jsx(wt,{value:"in_progress",children:"En cours"}),e.jsx(wt,{value:"completed",children:"Terminé"}),e.jsx(wt,{value:"abandoned",children:"Abandonné"})]})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(ct,{htmlFor:"strength-history-from",children:"Du"}),e.jsx(Dt,{id:"strength-history-from",type:"date",value:ee,onChange:s=>W(s.target.value)})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(ct,{htmlFor:"strength-history-to",children:"Au"}),e.jsx(Dt,{id:"strength-history-to",type:"date",value:K,onChange:s=>xe(s.target.value)})]})]}),Ze.map(s=>e.jsx(Xe,{className:"group hover:border-primary/50 transition-colors",children:e.jsxs(Ct,{className:"pb-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx(Pt,{className:"text-base font-bold uppercase",children:Nt(new Date(s.started_at||s.date||s.created_at||new Date),"dd MMM yyyy",{locale:jt})}),e.jsxs("div",{className:"text-sm font-mono font-bold text-muted-foreground group-hover:text-primary",children:[s.duration??0," min"]})]}),e.jsxs("div",{className:"flex gap-2 text-xs font-bold text-muted-foreground",children:[e.jsxs("span",{children:["Difficulté ",s.feeling??s.rpe??0,"/5"]}),e.jsx("span",{children:"•"}),e.jsxs("span",{children:[s.logs?.length||0," Séries"]})]})]})},s.id)),Ze.length===0&&e.jsx("div",{className:"text-center text-muted-foreground py-10",children:"Aucun historique."}),fe.hasNextPage&&e.jsx(F,{variant:"outline",size:"sm",className:"w-full",onClick:()=>fe.fetchNextPage(),disabled:fe.isFetchingNextPage,children:fe.isFetchingNextPage?"Chargement...":"Charger plus"})]})]})]})})}export{$t as buildInProgressRunCache,Gn as createInProgressRun,Nr as default,Cs as orderStrengthItems,Xn as resetStrengthRunState};
