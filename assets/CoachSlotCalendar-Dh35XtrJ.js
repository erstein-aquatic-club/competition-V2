import{r as x,u as k,j as e}from"./vendor-query-DyA9aSKS.js";import{c as F,B as j,f as b,P as z}from"./index-DPCrbPMY.js";import{B as A}from"./badge-DwsWgr9I.js";import{d as B,e as O,f as R}from"./api-LV3LAkiz.js";import{C as $}from"./chevron-left-BwKdUs0s.js";import{C as W}from"./chevron-right-_FPi2332.js";import{C as T}from"./zap-BtspBvsO.js";import{C as q}from"./clock-DOjtLAXT.js";import{M as I}from"./map-pin-CD6QDtTk.js";import"./vendor-react-BzrpNAyj.js";import"./vendor-charts-BrQ8X25f.js";import"./vendor-supabase-DFPLkPj_.js";import"./vendor-motion-lao-Njgm.js";import"./swim-CfmlSP2N.js";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const E=[["path",{d:"M12 7v14",key:"1akyts"}],["path",{d:"M3 18a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4 4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3 3 3 0 0 0-3-3z",key:"ruj8y"}]],K=F("book-open",E);function _(t){return String(t).padStart(2,"0")}function N(t){return`${t.getFullYear()}-${_(t.getMonth()+1)}-${_(t.getDate())}`}function P(t){const a=new Date,s=a.getDay(),r=s===0?-6:1-s,n=new Date(a);return n.setHours(0,0,0,0),n.setDate(a.getDate()+r+t*7),N(n)}function V(t,a){return t?t.visible_from===null||t.visible_from===void 0||t.visible_from<=a?"published":"draft":"empty"}function Y(t,a){const[s,r,n]=a.split("-").map(Number),d=new Date(s,r-1,n),o=new Date(d);return o.setDate(d.getDate()+t),N(o)}function G(t,a,s,r){const n=N(new Date),d=new Map;for(const l of s)d.set(`${l.slot_id}:${l.override_date}`,l);const o=new Map;for(const l of a){if(!l.training_slot_id)continue;const c=`${l.training_slot_id}:${l.scheduled_date}`;o.has(c)||o.set(c,l)}const i=[];for(const l of t){const c=Y(l.day_of_week,r),u=`${l.id}:${c}`,g=d.get(u),f=`${l.id}:${c}`,h=o.get(f);let m;g?.status==="cancelled"?m="cancelled":m=V(h,n),i.push({date:c,slot:l,groups:l.assignments,state:m,assignment:h,override:g})}return i.sort((l,c)=>{const u=l.date.localeCompare(c.date);return u!==0?u:l.slot.start_time.localeCompare(c.slot.start_time)}),i}function H(t){const[a,s,r]=t.split("-").map(Number),n=new Date(a,s-1,r);return n.setDate(n.getDate()+6),N(n)}function J(t){const[a,s,r]=t.split("-").map(Number),n=new Date(a,s-1,r),d=[];for(let o=0;o<7;o++){const i=new Date(n);i.setDate(n.getDate()+o),d.push(N(i))}return d}function Q(){const[t,a]=x.useState(0),s=x.useMemo(()=>P(t),[t]),r=x.useMemo(()=>H(s),[s]),n=x.useMemo(()=>J(s),[s]),{data:d=[],isLoading:o}=k({queryKey:["training-slots"],queryFn:()=>B(),staleTime:300*1e3}),{data:i=[],isLoading:l}=k({queryKey:["slot-assignments",s,r],queryFn:()=>O({from:s,to:r}),staleTime:120*1e3}),{data:c=[],isLoading:u}=k({queryKey:["slot-overrides",s],queryFn:()=>R({fromDate:s}),staleTime:300*1e3}),g=o||l||u,f=x.useMemo(()=>G(d,i,c,s),[d,i,c,s]),h=x.useMemo(()=>{const p=new Map;for(const y of f){const C=p.get(y.date)??[];C.push(y),p.set(y.date,C)}return p},[f]),m=x.useCallback(()=>a(0),[]),v=x.useCallback(()=>a(p=>p-1),[]),w=x.useCallback(()=>a(p=>p+1),[]);return{weekOffset:t,mondayIso:s,sundayIso:r,weekDates:n,instances:f,instancesByDate:h,isLoading:g,navigateToday:m,prevWeek:v,nextWeek:w}}const U=["Lun.","Mar.","Mer.","Jeu.","Ven.","Sam.","Dim."];function X(t,a){const[,s,r]=t.split("-").map(Number),[,n,d]=a.split("-").map(Number),o=new Date(Number(t.split("-")[0]),s-1,r),i=new Date(Number(a.split("-")[0]),n-1,d),l=o.toLocaleDateString("fr-FR",{month:"long"}),c=i.toLocaleDateString("fr-FR",{month:"long"}),u=i.getFullYear();return l===c?`${r} – ${d} ${l} ${u}`:`${r} ${l} – ${d} ${c} ${u}`}function Z(t){const[a,s,r]=t.split("-").map(Number),n=new Date(a,s-1,r),d=(n.getDay()+6)%7,o=U[d],i=n.toLocaleDateString("fr-FR",{month:"long"});return{abbrev:o,label:`${r} ${i}`}}function M(t,a){return`${t.slice(0,5)} – ${a.slice(0,5)}`}function ee(){const t=new Date,a=s=>String(s).padStart(2,"0");return`${t.getFullYear()}-${a(t.getMonth()+1)}-${a(t.getDate())}`}const te={empty:{label:"Aucune séance",badgeClass:"",cardClass:"border-dashed border-border/60 bg-card/40"},draft:{label:"Brouillon",badgeClass:"bg-amber-500/15 text-amber-600 dark:text-amber-400 border-amber-500/25",cardClass:"border-amber-500/30 bg-card"},published:{label:"Publié",badgeClass:"bg-emerald-500/15 text-emerald-600 dark:text-emerald-400 border-emerald-500/25",cardClass:"border-emerald-500/30 bg-card"},cancelled:{label:"Annulé",badgeClass:"bg-muted text-muted-foreground border-border/50",cardClass:"border-border/40 bg-muted/30"}};function S(){return e.jsxs("div",{className:"rounded-2xl border border-border/50 bg-card p-4 space-y-3 animate-pulse motion-reduce:animate-none",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(b,{className:"h-4 w-20 rounded-md"}),e.jsx(b,{className:"h-5 w-16 rounded-full"})]}),e.jsx(b,{className:"h-4 w-3/4 rounded-md"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(b,{className:"h-3 w-24 rounded-md"}),e.jsx(b,{className:"h-5 w-14 rounded-full"})]})]})}function D(){return e.jsxs("div",{className:"space-y-2.5",children:[e.jsx(b,{className:"h-5 w-32 rounded-md"}),e.jsx(S,{}),e.jsx(S,{})]})}function L({name:t,color:a}){return e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full px-2 py-0.5 text-[10px] font-medium border border-border/50 bg-muted/60 text-muted-foreground",children:[a&&e.jsx("span",{className:"h-1.5 w-1.5 rounded-full shrink-0",style:{backgroundColor:a}}),t]})}function se({instance:t,onTap:a}){return e.jsxs("button",{type:"button",onClick:a,className:"w-full rounded-2xl border-2 border-dashed border-border/50 bg-card/30 p-4 transition-all duration-150 active:scale-[0.98] active:bg-muted/40 hover:border-border",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex h-10 w-10 shrink-0 items-center justify-center rounded-xl bg-muted/50",children:e.jsx(z,{className:"h-5 w-5 text-muted-foreground/60"})}),e.jsxs("div",{className:"min-w-0 flex-1 text-left",children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground/80",children:"Aucune séance"}),e.jsxs("p",{className:"text-xs text-muted-foreground/50 mt-0.5",children:[M(t.slot.start_time,t.slot.end_time)," · ",t.slot.location]})]})]}),t.groups.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1 mt-2.5",children:t.groups.map(s=>e.jsx(L,{name:s.group_name},s.id))})]})}function ae({instance:t,onTap:a}){const s=te[t.state],r=t.state==="cancelled";return e.jsxs("button",{type:"button",onClick:a,className:`
        w-full rounded-2xl border p-4 text-left transition-all duration-150
        active:scale-[0.98] hover:shadow-md
        ${s.cardClass}
        ${r?"opacity-60":"shadow-sm"}
      `,children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-xs text-muted-foreground",children:[e.jsx(q,{className:"h-3 w-3 opacity-60"}),e.jsx("span",{className:r?"line-through":"",children:M(t.slot.start_time,t.slot.end_time)})]}),e.jsx(A,{variant:"outline",className:`text-[10px] px-2 py-0.5 font-medium leading-none ${s.badgeClass}`,children:s.label})]}),t.assignment?.session_name&&e.jsxs("p",{className:`text-sm font-semibold mt-2 leading-snug ${r?"line-through text-muted-foreground":"text-foreground"}`,children:[t.assignment.session_name,t.assignment.session_distance!=null&&t.assignment.session_distance>0&&e.jsxs("span",{className:"font-normal text-xs text-muted-foreground ml-1.5",children:[t.assignment.session_distance,"m"]})]}),e.jsxs("div",{className:"flex items-center gap-1.5 mt-1.5 text-xs text-muted-foreground",children:[e.jsx(I,{className:"h-3 w-3 opacity-50"}),e.jsx("span",{className:r?"line-through":"",children:t.slot.location})]}),t.groups.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1 mt-2.5",children:t.groups.map(n=>e.jsx(L,{name:n.group_name},n.id))}),t.state==="draft"&&t.assignment?.visible_from&&e.jsxs("p",{className:"text-[10px] text-amber-600 dark:text-amber-400 mt-2 italic",children:["Visible le ",new Date(t.assignment.visible_from).toLocaleDateString("fr-FR",{day:"numeric",month:"short"})]}),r&&t.override?.reason&&e.jsx("p",{className:"text-[10px] text-muted-foreground mt-2 italic",children:t.override.reason})]})}function ye({onBack:t,onOpenLibrary:a,onOpenSlot:s}){const{weekOffset:r,mondayIso:n,sundayIso:d,weekDates:o,instancesByDate:i,isLoading:l,navigateToday:c,prevWeek:u,nextWeek:g}=Q(),f=x.useMemo(()=>ee(),[]),h=x.useMemo(()=>X(n,d),[n,d]);return e.jsxs("div",{className:"space-y-0 pb-24",children:[e.jsxs("div",{className:"sticky top-0 z-20 -mx-4 bg-background/95 backdrop-blur border-b px-4 pb-3 pt-3 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(j,{variant:"ghost",size:"sm",className:"-ml-2",onClick:t,children:[e.jsx($,{className:"mr-1 h-4 w-4"}),"Retour"]}),e.jsx("h1",{className:"text-lg font-bold tracking-tight",style:{fontFamily:"var(--font-display, 'Oswald', sans-serif)"},children:"Séances"}),e.jsxs(j,{variant:"ghost",size:"sm",className:"-mr-2 text-primary",onClick:a,children:[e.jsx(K,{className:"mr-1.5 h-3.5 w-3.5"}),"Bibliothèque"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(j,{variant:"ghost",size:"icon",className:"h-9 w-9 shrink-0",onClick:u,children:e.jsx($,{className:"h-4 w-4"})}),e.jsx("p",{className:"flex-1 text-center text-sm font-semibold capitalize tabular-nums",children:h}),e.jsx(j,{variant:"ghost",size:"icon",className:"h-9 w-9 shrink-0",onClick:g,children:e.jsx(W,{className:"h-4 w-4"})}),r!==0&&e.jsx(j,{variant:"outline",size:"sm",className:"rounded-full text-xs px-3",onClick:c,children:"Aujourd'hui"})]})]}),e.jsx("div",{className:"space-y-5 pt-4",children:l?e.jsxs(e.Fragment,{children:[e.jsx(D,{}),e.jsx(D,{}),e.jsx(D,{})]}):o.map(m=>{const v=i.get(m)??[],w=m===f,{abbrev:p,label:y}=Z(m);return e.jsx(re,{dateIso:m,abbrev:p,label:y,isToday:w,slots:v,onOpenSlot:s},m)})}),!l&&Array.from(i.values()).every(m=>m.length===0)&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-16 text-center",children:[e.jsx("div",{className:"flex h-14 w-14 items-center justify-center rounded-2xl bg-muted/50 mb-4",children:e.jsx(T,{className:"h-7 w-7 text-muted-foreground/40"})}),e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Aucun créneau cette semaine"}),e.jsx("p",{className:"text-xs text-muted-foreground/60 mt-1 max-w-[260px]",children:"Configurez vos créneaux récurrents dans les paramètres pour les voir apparaître ici"})]})]})}function re({dateIso:t,abbrev:a,label:s,isToday:r,slots:n,onOpenSlot:d}){return n.length===0?null:e.jsxs("div",{className:`
        relative rounded-2xl transition-colors
        ${r?"bg-primary/[0.03]":""}
      `,children:[r&&e.jsx("div",{className:"absolute left-0 top-2 bottom-2 w-[3px] rounded-full bg-primary"}),e.jsxs("div",{className:r?"pl-3":"",children:[e.jsxs("div",{className:"flex items-center gap-2 pb-2",children:[e.jsx("span",{className:`text-xs font-bold uppercase tracking-wider ${r?"text-primary":"text-muted-foreground"}`,children:a}),e.jsx("span",{className:`text-sm font-semibold capitalize ${r?"text-foreground":"text-foreground/80"}`,children:s}),r&&e.jsx("span",{className:"text-[9px] font-bold uppercase tracking-widest text-primary bg-primary/10 px-2 py-0.5 rounded-full",children:"Aujourd'hui"})]}),e.jsx("div",{className:"space-y-2",children:n.map(o=>o.state==="empty"?e.jsx(se,{instance:o,onTap:()=>d(o)},`${o.slot.id}-${o.date}`):e.jsx(ae,{instance:o,onTap:()=>d(o)},`${o.slot.id}-${o.date}`))})]})]})}export{ye as default};
