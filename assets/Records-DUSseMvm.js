import{c as ps,r as m,u as K,d as W,j as e}from"./vendor-query-DyA9aSKS.js";import{u as te,d as hs,W as ne,B as v,D as fs,x as Ce,y as gs,L as k,I as F,C as re,e as ie,X as de}from"./index-CUos1rRD.js";import{a as S}from"./api-D9Gfe0uM.js";import{T as js}from"./textarea-WsmGICzB.js";import{S as Ee,a as ke,b as Ie,c as Fe,d as Me}from"./sheet-BQiDV6SP.js";import{T as vs,a as bs,b as Re,c as Te}from"./tabs-CymkGL5L.js";import{S as Ns,a as ys,b as ws,c as Ss,d as Pe}from"./select-Bg07NZHP.js";import{shouldShowRecords as _s}from"./Profile-BJBwwA0x.js";import{I as Le}from"./InlineBanner-IGQWKONZ.js";import{c as Cs,s as ae,l as oe,f as Es}from"./animations-CrcLFysI.js";import{P as ks}from"./PageHeader-DpKIPheT.js";import{c as Is,m as I}from"./vendor-motion-lao-Njgm.js";import{C as le}from"./circle-alert-DFQMAMxk.js";import{T as qe}from"./trophy-lQcgCgqC.js";import{P as $e}from"./pen-D6iqbkU5.js";import{C as ce}from"./index-CGgHmOFd.js";import{C as Fs}from"./chevron-right-B42QYOtr.js";import{a as Ms,i as Rs,h as Ts,X as Ps,Y as Ls,T as qs,g as $s}from"./vendor-charts-BrQ8X25f.js";import{S as Ds}from"./sticky-note-Ur5uTmK9.js";import{C as zs}from"./chevron-down-EBGdHI-u.js";import"./vendor-react-BzrpNAyj.js";import"./vendor-supabase-DFPLkPj_.js";import"./swim-DLElfTdy.js";import"./index-DMyzeoUP.js";import"./index-BuRyRpt6.js";import"./index-CcJ68pHL.js";import"./index-DCX2sNhR.js";import"./chevron-up-oJVECagM.js";import"./avatar-eGlwda8U.js";import"./badge-BQwhA_3Q.js";import"./dialog-CEOVzbFk.js";import"./types-g3FhkFPf.js";import"./arrow-left-2SdrGi-C.js";import"./bell-ring-C2sgPEO2.js";import"./trash-2-XvyL_gJF.js";import"./flame-Ds7naNuh.js";import"./save-CmrYMDwa.js";import"./clock-Iej45qEf.js";import"./design-tokens-CKgCpdH6.js";import"./chevron-left-C18Ul1dh.js";const As=r=>r.toLowerCase().replace(/\./g,"").replace(/\s+/g," ").trim();function De(r){const n=As(r);return n.includes("nl")||n.includes("nage libre")?0:n.includes("dos")?1:n.includes("bra")||n.includes("brasse")?2:n.includes("pap")||n.includes("papillon")?3:n.includes("4n")||n.includes("4 n")||n.includes("4 nages")?4:99}function ze(r){const n=r.match(/^(\d+)/);return n?Number(n[1]):Number.POSITIVE_INFINITY}function Ks(r,n){const p=De(r),u=De(n);return p!==u?p-u:ze(r)-ze(n)}const M=(...r)=>r.filter(Boolean).join(" ");function q(r){if(!r)return"—";const n=new Date(r);return Number.isNaN(n.getTime())?r:n.toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"2-digit"})}function O(r){if(r==null)return"—";const n=Math.round(Math.max(0,r*1e3)),p=Math.floor(n/6e4),u=Math.floor(n%6e4/1e3),b=Math.floor(n%1e3/10);return p>0?`${p}:${String(u).padStart(2,"0")}.${String(b).padStart(2,"0")}`:`${u}.${String(b).padStart(2,"0")}`}function Os(r){const n=r.trim();if(!n)return null;if(n.includes(":")){const[u,b]=n.split(":"),h=Number(u);if(!Number.isFinite(h)||h<0)return null;const y=b.replace(",","."),w=Number(y);return!Number.isFinite(w)||w<0?null:h*60+w}const p=Number(n.replace(",","."));return!Number.isFinite(p)||p<0?null:p}function Qs(r){if(!r)return null;const n=r.match(/FFN\s*\((\d+)\s*pts\)/i);if(!n)return null;const p=Number(n[1]);return Number.isFinite(p)?p:null}function Bs({value:r,placeholder:n,onSave:p,onCancel:u,inputMode:b="decimal",hint:h}){const[y,w]=m.useState(r);return m.useEffect(()=>{w(r)},[r]),e.jsx("div",{className:"w-full",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(F,{value:y,onChange:U=>w(U.target.value),placeholder:n,inputMode:b,className:"h-10 rounded-xl",autoFocus:!0}),h?e.jsx("div",{className:"mt-1 text-xs text-muted-foreground",children:h}):null]}),e.jsx(v,{type:"button",onClick:()=>p(y),className:"h-10 w-10 p-0 rounded-xl","aria-label":"Valider",children:e.jsx(ce,{className:"h-5 w-5"})}),e.jsx(v,{type:"button",variant:"outline",onClick:u,className:"h-10 w-10 p-0 rounded-xl","aria-label":"Annuler",children:e.jsx(de,{className:"h-5 w-5"})})]})})}const _=()=>e.jsx("div",{className:"h-10 rounded-xl bg-muted animate-pulse motion-reduce:animate-none"});function Rt(){const r=te(s=>s.user),n=te(s=>s.userId),p=te(s=>s.role),{toast:u}=hs(),b=ps(),h=Is(),y={id:null,event_name:"",pool_length:"",time_seconds:"",record_date:"",notes:""},[w,U]=m.useState(()=>{const s=window.location.hash,t=s.indexOf("?");return t>=0&&new URLSearchParams(s.substring(t)).get("tab")==="1rm"?"1rm":"swim"}),[l,g]=m.useState(y),[o,Ae]=m.useState("training"),[$,Ke]=m.useState(25),[X,Q]=m.useState(null),[Oe,me]=m.useState(null),[Qe,ue]=m.useState(""),[Be,He]=m.useState(null),[Ve,D]=m.useState(null),[xe,R]=m.useState(""),[B,We]=m.useState(25),[z,Y]=m.useState(null),[Ue,pe]=m.useState(!1),T=_s(p);m.useEffect(()=>{window.scrollTo({top:0,left:0,behavior:"auto"})},[]);const he=s=>{const t=s?.pool_length??s?.poolLength??s?.poolLen??s?.pool;if(t==null)return null;if(typeof t=="number")return t===25||t===50?t:null;const x=String(t).match(/\b(25|50)\b/);if(!x)return null;const d=Number(x[1]);return d===25||d===50?d:null},G=K({queryKey:["1rm",r,n],queryFn:()=>S.get1RM({athleteName:r,athleteId:n}),enabled:!!r&&T}),J=K({queryKey:["exercises"],queryFn:()=>S.getExercises(),enabled:T}),Z=K({queryKey:["swim-records",n,r,o],queryFn:()=>S.getSwimRecords({athleteId:n??void 0,athleteName:r??void 0,recordType:o==="comp"?"comp":"training"}),enabled:!!r&&T}),P=K({queryKey:["profile",n],queryFn:()=>S.getProfile({userId:n??void 0}),enabled:!!n&&T}),C=String(P.data?.ffn_iuf??"").trim(),fe=G.error||J.error||Z.error||P.error,Xe=()=>{G.refetch(),J.refetch(),Z.refetch(),P.refetch()},ee=K({queryKey:["swimmer-performances",n,C,B],queryFn:()=>S.getSwimmerPerformances({userId:n??void 0,iuf:C||void 0,poolLength:B}),enabled:!!C&&T&&o==="history"}),{data:se,isLoading:Ye,isError:Ge}=ee,H=W({mutationFn:()=>{if(!C)throw new Error("IUF FFN manquant. Ajoutez-le dans votre profil.");return S.importSwimmerPerformances({iuf:C,userId:n??void 0})},onSuccess:s=>{b.invalidateQueries({queryKey:["swimmer-performances"]}),u({title:"Import terminé",description:`${s.total_found} trouvée(s), ${s.new_imported} importée(s), ${s.already_existed} déjà existante(s)`}),pe(!0),setTimeout(()=>pe(!1),2e3)},onError:s=>{u({title:"Import impossible",description:String(s?.message||s),variant:"destructive"})}}),L=m.useMemo(()=>{if(!se?.length)return[];const s=new Map;for(const d of se){const a=s.get(d.event_code)??[];a.push(d),s.set(d.event_code,a)}const t=d=>d.toLowerCase().replace(/\./g,"").replace(/\s+/g," ").trim(),i=d=>{const a=t(d);return a.includes("nl")||a.includes("nage libre")?0:a.includes("dos")?1:a.includes("bra")||a.includes("brasse")?2:a.includes("pap")||a.includes("papillon")?3:a.includes("4n")||a.includes("4 n")||a.includes("4 nages")?4:99},x=d=>{const a=d.match(/^(\d+)/);return a?Number(a[1]):1/0};return[...s.entries()].map(([d,a])=>{const f=[...a].sort((N,c)=>(c.competition_date??"").localeCompare(N.competition_date??"")),j=f.reduce((N,c)=>c.time_seconds<N.time_seconds?c:N,f[0]);return{eventCode:d,performances:f,bestTime:j.time_seconds,bestId:j.id}}).sort((d,a)=>{const f=i(d.eventCode),j=i(a.eventCode);return f!==j?f-j:x(d.eventCode)-x(a.eventCode)})},[se]),ge=m.useMemo(()=>{if(!z)return[];const s=L.find(t=>t.eventCode===z);return s?[...s.performances].filter(t=>t.competition_date).sort((t,i)=>(t.competition_date??"").localeCompare(i.competition_date??"")).map(t=>({date:q(t.competition_date),time:t.time_seconds,display:t.time_display??O(t.time_seconds)})):[]},[z,L]),E=m.useMemo(()=>L.find(s=>s.eventCode===z)??null,[L,z]),{data:Je,isLoading:Ze,isError:es}=G,{data:ss,isLoading:ts,isError:ns}=J,{data:je,isLoading:rs,isFetching:Hs,isError:is,refetch:as}=Z,os=()=>{as()};m.useEffect(()=>{o==="comp"&&os()},[o]);const ve=o==="history"?B:$,ls=o==="training"?"Entraînement":o==="comp"?"Compétition":"Historique",be=W({mutationFn:s=>S.update1RM({...s,athlete_id:n,athlete_name:r}),onSuccess:()=>{b.invalidateQueries({queryKey:["1rm"]}),u({title:"1RM mis à jour"})}}),Ne=W({mutationFn:s=>S.updateExerciseNote({athlete_id:n,exercise_id:s.exercise_id,notes:s.notes}),onSuccess:()=>{b.invalidateQueries({queryKey:["1rm"]}),u({title:"Note mise à jour"})}}),V=W({mutationFn:s=>S.upsertSwimRecord(s),onSuccess:()=>{b.invalidateQueries({queryKey:["swim-records"]}),g(y),Q(null),u({title:"Record mis à jour"})}}),A=()=>{g(y),Q(null)},ds=s=>{const t=he(s);g({id:s.id,event_name:s.event_name??"",pool_length:t?String(t):"",time_seconds:s.time_seconds!=null?O(Number(s.time_seconds)):"",record_date:s.record_date?String(s.record_date).split("T")[0]:"",notes:s.notes??""}),Q(s.id)},ye=()=>{if(!l.event_name.trim()){u({title:"Nom d'épreuve requis",variant:"destructive"});return}if(!l.pool_length){u({title:"Bassin requis",variant:"destructive"});return}const s=Os(l.time_seconds);if(s===null){u({title:"Temps invalide",description:"Ex: 1:02.34 ou 62.34",variant:"destructive"});return}V.mutate({id:l.id||null,athlete_id:n,athleteName:r,athlete_name:r,event_name:l.event_name,pool_length:parseInt(l.pool_length,10),time_seconds:s,record_date:l.record_date||null,notes:l.notes||null,record_type:o})},cs=s=>{s.preventDefault(),ye()},we=m.useMemo(()=>(je?.records??[]).filter(i=>he(i)===$).sort((i,x)=>Ks(String(i.event_name??""),String(x.event_name??""))),[je,$,o]),Se=()=>{g({...y,pool_length:String($)}),Q("add")},ms=s=>{Ae(s),A()},us=(s,t)=>{me(s),ue(t!=null&&Number(t)>0?String(t):"")},_e=()=>{me(null),ue("")},xs=(s,t)=>{const i=Number(String(t??"").replace(",","."));if(!Number.isFinite(i)||i<=0){u({title:"Valeur invalide",description:"Entrez un nombre > 0",variant:"destructive"});return}be.mutate({exercise_id:s,one_rm:i}),_e()};return T?fe?e.jsx("div",{className:"min-h-[100dvh]",children:e.jsxs("div",{className:"mx-auto max-w-lg px-4 pt-16 pb-10 text-center",children:[e.jsx(le,{className:"h-10 w-10 mx-auto text-destructive/60"}),e.jsx("p",{className:"mt-3 text-sm font-semibold",children:"Impossible de charger les données"}),e.jsx("p",{className:"mt-1 text-xs text-muted-foreground",children:fe.message}),e.jsx(v,{onClick:Xe,size:"sm",className:"mt-4 rounded-2xl",children:"Réessayer"})]})}):e.jsx("div",{className:"min-h-[100dvh]",children:e.jsxs("div",{className:"mx-auto max-w-lg",children:[e.jsx(ks,{className:"-mx-0",title:"Mes Records",icon:e.jsx(qe,{className:"h-3.5 w-3.5"}),backHref:"/profile",backLabel:"Retour au profil"}),e.jsx("div",{className:"px-3 pt-3",children:e.jsxs(vs,{value:w,onValueChange:s=>U(s),children:[e.jsxs(bs,{className:"w-full rounded-2xl bg-muted/50 border border-border p-1 flex",children:[e.jsxs(Re,{value:"swim","aria-label":"Records de natation",className:`flex-1 rounded-xl px-3 py-2 text-sm font-bold uppercase tracking-wide gap-1.5
                  data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm
                  data-[state=inactive]:text-muted-foreground`,children:[e.jsx(ne,{className:"h-4 w-4"}),"Natation"]}),e.jsxs(Re,{value:"1rm","aria-label":"Records de musculation",className:`flex-1 rounded-xl px-3 py-2 text-sm font-bold uppercase tracking-wide gap-1.5
                  data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm
                  data-[state=inactive]:text-muted-foreground`,children:[e.jsx(fs,{className:"h-4 w-4"}),"Musculation"]})]}),w==="swim"?e.jsxs("div",{className:"mt-2.5 rounded-2xl border border-border/60 bg-muted/20 px-3 py-3",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-[10px] font-semibold uppercase tracking-[0.14em] text-muted-foreground",children:"Vue active"}),e.jsxs("p",{className:"truncate text-sm font-semibold text-foreground",children:[ls," · ",ve,"m"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[o==="training"?e.jsx(v,{type:"button",size:"sm",onClick:Se,className:"rounded-xl text-xs h-8 gap-1",children:"Ajouter"}):null,o==="history"?e.jsx(I.div,{variants:Cs,animate:Ue?"visible":"hidden",children:e.jsxs(v,{type:"button",size:"sm",onClick:()=>H.mutate(),disabled:H.isPending||!C,className:"rounded-xl text-xs h-8 gap-1",children:[H.isPending?e.jsx(Ce,{className:"h-3 w-3 animate-spin"}):e.jsx(gs,{className:"h-3 w-3"}),H.isPending?"Import...":"Importer"]})}):null]})]}),e.jsx("div",{className:"mt-3 flex flex-wrap gap-2",children:["training","comp","history"].map(s=>{const t=s==="training"?"Entraînement":s==="comp"?"Compétition":"Historique";return e.jsx("button",{type:"button",onClick:()=>{ms(s),s!=="history"&&Y(null)},className:M("rounded-xl border px-3 py-1.5 text-xs font-semibold transition",o===s?"border-primary/30 bg-primary/5 text-primary":"border-border text-muted-foreground hover:border-primary/30 hover:text-foreground"),"aria-pressed":o===s,children:t},s)})}),e.jsxs("div",{className:"mt-2 flex flex-wrap items-center gap-2",children:[[25,50].map(s=>e.jsxs("button",{type:"button",onClick:()=>{o==="history"?We(s):(Ke(s),A())},className:M("rounded-xl border px-3 py-1.5 text-xs font-semibold transition",ve===s?"border-primary/30 bg-primary/5 text-primary":"border-border text-muted-foreground hover:border-primary/30 hover:text-foreground"),children:[s,"m"]},s)),o==="comp"?e.jsx("span",{className:"text-[11px] text-muted-foreground",children:"Données FFN synchronisées"}):null]})]}):null,e.jsx(Ee,{open:o==="training"&&X==="add",onOpenChange:s=>{!s&&X==="add"&&A()},children:e.jsxs(ke,{side:"bottom",className:"max-h-[90vh] overflow-y-auto rounded-t-3xl",children:[e.jsxs(Ie,{className:"text-left",children:[e.jsx(Fe,{children:"Ajouter un record"}),e.jsx(Me,{children:"Saisis rapidement un meilleur temps d'entraînement sans quitter la liste."})]}),e.jsx("form",{onSubmit:cs,className:"mt-5",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"col-span-2",children:[e.jsx(k,{className:"text-xs mb-1.5 block",children:"Épreuve"}),e.jsx(F,{value:l.event_name,onChange:s=>g({...l,event_name:s.target.value}),placeholder:"Ex: 100 NL, 200 Dos",className:"h-10 rounded-xl"})]}),e.jsxs("div",{children:[e.jsx(k,{className:"text-xs mb-1.5 block",children:"Bassin"}),e.jsxs(Ns,{value:l.pool_length,onValueChange:s=>g({...l,pool_length:s}),children:[e.jsx(ys,{className:"h-10 rounded-xl",children:e.jsx(ws,{placeholder:"—"})}),e.jsxs(Ss,{children:[e.jsx(Pe,{value:"25",children:"25m"}),e.jsx(Pe,{value:"50",children:"50m"})]})]})]}),e.jsxs("div",{children:[e.jsx(k,{className:"text-xs mb-1.5 block",children:"Temps"}),e.jsx(F,{value:l.time_seconds,inputMode:"decimal",placeholder:"1:02.34",onChange:s=>g({...l,time_seconds:s.target.value}),className:"h-10 rounded-xl"})]}),e.jsxs("div",{children:[e.jsx(k,{className:"text-xs mb-1.5 block",children:"Date"}),e.jsx(F,{type:"date",value:l.record_date,onChange:s=>g({...l,record_date:s.target.value}),className:"h-10 rounded-xl"})]}),e.jsxs("div",{children:[e.jsx(k,{className:"text-xs mb-1.5 block",children:"Notes"}),e.jsx(F,{value:l.notes,onChange:s=>g({...l,notes:s.target.value}),placeholder:"Optionnel",className:"h-10 rounded-xl"})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 pb-2",children:[e.jsx(v,{type:"button",variant:"outline",onClick:A,className:"rounded-xl",children:"Annuler"}),e.jsx(v,{type:"submit",disabled:V.isPending,className:"rounded-xl",children:V.isPending?"Ajout...":"Ajouter"})]})]})})]})}),e.jsxs(Te,{value:"swim",className:"mt-0",children:[o!=="history"?e.jsx(e.Fragment,{children:e.jsx("div",{className:"mt-3",children:e.jsx(re,{className:"w-full min-w-0 rounded-2xl",children:e.jsx(ie,{className:"p-0",children:rs?e.jsxs("div",{className:"p-4 grid gap-3",children:[e.jsx(_,{}),e.jsx(_,{}),e.jsx(_,{})]}):is?e.jsx("div",{className:"mx-4 my-4 rounded-lg border border-destructive/20 bg-destructive/10 p-4 text-sm text-destructive",children:"Impossible de charger les records natation."}):we.length===0?e.jsxs("div",{className:"py-8 text-center",children:[e.jsx(ne,{className:"h-8 w-8 mx-auto text-muted-foreground/30"}),e.jsxs("p",{className:"mt-2 text-sm text-muted-foreground",children:["Aucun record en ",$,"m"]}),o==="training"&&e.jsx(v,{type:"button",size:"sm",variant:"outline",onClick:Se,className:"mt-3 rounded-xl text-xs h-8",children:"Ajouter un record"})]}):e.jsx(I.div,{className:"divide-y divide-border motion-reduce:animate-none",variants:h?void 0:ae,initial:h?!1:"hidden",animate:h?!1:"visible",children:we.map(s=>{const t=X===s.id,i=O(s.time_seconds),x=q(s.record_date),d=(s.notes??"").trim(),a=s?.ffn_points??s?.ffnPoints??s?.points??s?.pts??null,f=a==null?NaN:Number(a),j=Number.isFinite(f)?f:Qs(s?.notes),N=(s?.meet??s?.meet_name??s?.meetName??s?.competition??"").trim?.()??"";return e.jsxs(I.div,{className:"px-3 py-2.5 motion-reduce:animate-none",variants:oe,children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("span",{className:"text-sm font-semibold truncate",children:s.event_name}),e.jsxs("div",{className:"flex items-center gap-2 shrink-0",children:[e.jsx("span",{className:"font-mono text-primary font-bold tabular-nums text-sm",children:i}),o==="training"&&e.jsx("button",{type:"button",onClick:()=>ds(s),className:"inline-flex items-center justify-center h-8 w-8 rounded-xl text-muted-foreground hover:text-foreground hover:bg-muted/60 transition","aria-label":`Modifier ${s.event_name}`,children:e.jsx($e,{className:"h-3.5 w-3.5"})})]})]}),e.jsxs("div",{className:"flex items-center gap-3 mt-0.5 text-xs text-muted-foreground",children:[o==="comp"&&j!=null&&e.jsxs("span",{className:"tabular-nums",children:[String(j)," pts"]}),e.jsx("span",{className:"tabular-nums",children:x}),o==="comp"&&N&&e.jsx("span",{className:"truncate",children:N}),o==="training"&&d&&e.jsx("span",{className:"truncate italic",children:d})]}),o==="training"&&t?e.jsx(I.div,{className:"mt-3",variants:Es,initial:"hidden",animate:"visible",children:e.jsxs("div",{className:"rounded-2xl bg-muted/30 border border-border p-4 space-y-4",children:[e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(k,{children:"Temps"}),e.jsx(F,{value:l.time_seconds,inputMode:"decimal",placeholder:"1:02.34",onChange:c=>g({...l,time_seconds:c.target.value}),className:"rounded-xl"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Format: mm:ss.cc ou secondes"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(k,{children:"Date"}),e.jsx(F,{type:"date",value:l.record_date,onChange:c=>g({...l,record_date:c.target.value}),className:"rounded-xl"})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(k,{children:"Notes"}),e.jsx(js,{value:l.notes,onChange:c=>g({...l,notes:c.target.value}),rows:2,className:"rounded-xl"})]}),e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsxs(v,{type:"button",size:"sm",variant:"outline",onClick:A,className:"rounded-2xl gap-2",children:[e.jsx(de,{className:"h-4 w-4"}),"Annuler"]}),e.jsxs(v,{type:"button",size:"sm",onClick:ye,disabled:V.isPending,className:"rounded-2xl gap-2",children:[e.jsx(ce,{className:"h-4 w-4"}),"Enregistrer"]})]})]})}):null]},s.id)})})})})})}):null,o==="history"?e.jsxs("div",{className:"mt-3 space-y-3",children:[e.jsx(Le,{variant:"destructive",icon:e.jsx(le,{}),label:"Impossible de charger votre profil",visible:P.isError,animate:!1}),e.jsx(Le,{variant:"yellow",icon:e.jsx(le,{}),label:"IUF FFN non renseigné",sublabel:e.jsxs(e.Fragment,{children:["Renseignez votre numéro dans ",e.jsx("a",{href:"/#/profile",className:"underline font-medium hover:text-foreground",children:"votre profil"})]}),visible:!P.isError&&!C&&!P.isLoading,animate:!1}),Ye?e.jsxs("div",{className:"grid gap-3",children:[e.jsx(_,{}),e.jsx(_,{}),e.jsx(_,{})]}):Ge?e.jsxs("div",{className:"rounded-lg border border-destructive/20 bg-destructive/10 p-4 text-sm text-destructive",children:[e.jsx("p",{className:"font-semibold",children:"Impossible de charger les performances"}),e.jsx("p",{className:"mt-1 text-xs",children:ee.error instanceof Error?ee.error.message:"Vérifiez votre connexion internet et réessayez."})]}):L.length===0?e.jsx("div",{className:"px-4 py-6 text-sm text-muted-foreground",children:C?'Aucune performance trouvée. Cliquez sur "Importer" pour récupérer vos données FFN.':"Ajoutez votre IUF FFN dans votre profil pour commencer."}):e.jsx(I.div,{className:"space-y-2 motion-reduce:animate-none",variants:h?void 0:ae,initial:h?!1:"hidden",animate:h?!1:"visible",children:L.map(s=>{const t=s.performances.find(x=>x.id===s.bestId)??s.performances[0],i=s.performances[0];return e.jsx(I.div,{variants:oe,children:e.jsx(re,{className:"rounded-2xl",children:e.jsx(ie,{className:"p-0",children:e.jsxs("button",{type:"button",onClick:()=>Y(s.eventCode),className:"w-full flex items-center justify-between gap-3 px-3 py-3 text-left cursor-pointer",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[e.jsx("span",{className:"text-sm font-semibold truncate",children:s.eventCode}),e.jsx("span",{className:"inline-flex items-center justify-center h-5 min-w-5 px-1.5 rounded-full bg-muted text-xs font-semibold tabular-nums text-muted-foreground",children:s.performances.length})]}),e.jsxs("div",{className:"mt-1 flex items-center gap-3 text-xs text-muted-foreground",children:[e.jsxs("span",{children:["Meilleur: ",q(t?.competition_date)]}),i?.competition_date&&i.id!==t?.id?e.jsxs("span",{children:["Dernier: ",q(i.competition_date)]}):null]})]}),e.jsxs("div",{className:"flex items-center gap-2 shrink-0",children:[e.jsx("span",{className:"font-mono text-primary font-bold tabular-nums text-sm",children:O(s.bestTime)}),e.jsx(Fs,{className:"h-4 w-4 text-muted-foreground"})]})]})})})},s.eventCode)})}),e.jsx(Ee,{open:!!E,onOpenChange:s=>{s||Y(null)},children:e.jsxs(ke,{side:"bottom",className:"max-h-[90vh] overflow-y-auto rounded-t-3xl",children:[e.jsxs(Ie,{className:"text-left",children:[e.jsx(Fe,{children:E?.eventCode??"Historique"}),e.jsx(Me,{children:E?`${E.performances.length} performance${E.performances.length>1?"s":""} en bassin ${B}m`:"Historique détaillé"})]}),E?e.jsxs("div",{className:"mt-5 space-y-4",children:[ge.length>1?e.jsxs("div",{className:"rounded-2xl border border-border bg-muted/20 px-2 pt-3 pb-1",children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-2 px-2",children:"Courbe de progression"}),e.jsx(Ms,{width:"100%",height:180,children:e.jsxs(Rs,{data:ge,margin:{top:5,right:10,left:0,bottom:5},children:[e.jsx(Ts,{strokeDasharray:"3 3",className:"stroke-border"}),e.jsx(Ps,{dataKey:"date",tick:{fontSize:10},className:"text-muted-foreground"}),e.jsx(Ls,{domain:["auto","auto"],tick:{fontSize:10},className:"text-muted-foreground",reversed:!0,tickFormatter:s=>{const t=Math.floor(s/60),i=Math.floor(s%60),x=Math.round(s%1*100);return t>0?`${t}:${String(i).padStart(2,"0")}`:`${i}.${String(x).padStart(2,"0")}`}}),e.jsx(qs,{formatter:s=>{const t=Math.floor(s/60),i=Math.floor(s%60),x=Math.round(s%1*100);return[t>0?`${t}:${String(i).padStart(2,"0")}.${String(x).padStart(2,"0")}`:`${i}.${String(x).padStart(2,"0")}`,"Temps"]},labelStyle:{fontSize:11},contentStyle:{borderRadius:12,fontSize:12}}),e.jsx($s,{type:"monotone",dataKey:"time",stroke:"hsl(var(--primary))",strokeWidth:2,dot:{r:3},activeDot:{r:5}})]})})]}):null,e.jsx("div",{className:"overflow-hidden rounded-2xl border border-border",children:e.jsx("div",{className:"divide-y divide-border",children:E.performances.map(s=>{const t=s.id===E.bestId;return e.jsxs("div",{className:M("px-3 py-2.5",t&&"bg-primary/5"),children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex items-center gap-1.5 min-w-0",children:[t?e.jsx(qe,{className:"h-3.5 w-3.5 text-primary shrink-0"}):null,e.jsx("span",{className:"text-xs text-muted-foreground tabular-nums",children:q(s.competition_date)})]}),e.jsx("span",{className:M("font-mono tabular-nums text-sm shrink-0",t?"text-primary font-bold":"font-medium"),children:s.time_display??O(s.time_seconds)})]}),e.jsxs("div",{className:"flex items-center gap-3 mt-0.5 text-xs text-muted-foreground",children:[s.ffn_points!=null?e.jsxs("span",{className:"tabular-nums",children:[String(s.ffn_points)," pts"]}):null,s.competition_name?e.jsx("span",{className:"truncate",children:s.competition_name}):null]})]},s.id)})})})]}):null]})})]}):null,e.jsx("div",{className:"h-6"})]}),e.jsxs(Te,{value:"1rm",className:"mt-0",children:[e.jsx("div",{className:"mt-3",children:e.jsx(re,{className:"w-full min-w-0 rounded-2xl",children:e.jsxs(ie,{className:"p-0",children:[Ze||ts?e.jsxs("div",{className:"p-4 grid gap-3",children:[e.jsx(_,{}),e.jsx(_,{}),e.jsx(_,{})]}):es||ns?e.jsx("div",{className:"p-4 text-sm text-muted-foreground",children:"Impossible de charger les records musculation."}):e.jsx(I.div,{className:"divide-y divide-border motion-reduce:animate-none",variants:h?void 0:ae,initial:h?!1:"hidden",animate:h?!1:"visible",children:ss?.filter(s=>s.exercise_type!=="warmup").map(s=>{const t=Je?.find(c=>c.exercise_id===s.id),i=Number(t?.weight??0),x=i>0?`${i} kg`:"—",d=t?.recorded_at??t?.date??null,a=t?.notes??null,f=Oe===s.id,j=Be===s.id,N=Ve===s.id;return e.jsxs(I.div,{className:"px-3 py-2.5 motion-reduce:animate-none",variants:oe,children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("span",{className:"text-sm font-semibold truncate",children:s.nom_exercice}),e.jsxs("div",{className:"flex items-center gap-2 shrink-0",children:[e.jsx("span",{className:M("font-mono font-bold tabular-nums text-sm",i>0?"text-primary":"text-muted-foreground"),children:x}),!f&&e.jsx("button",{type:"button",onClick:()=>us(s.id,t?.weight??null),className:"inline-flex items-center justify-center h-8 w-8 rounded-xl text-muted-foreground hover:text-foreground hover:bg-muted/60 transition","aria-label":`Modifier ${s.nom_exercice}`,children:e.jsx($e,{className:"h-3.5 w-3.5"})})]})]}),e.jsxs("div",{className:"flex items-center justify-between mt-0.5",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground min-w-0",children:[e.jsx("span",{className:"tabular-nums shrink-0",children:q(d)}),a&&!N?e.jsx("button",{type:"button",onClick:()=>{D(s.id),R(a??"")},className:"truncate italic hover:text-foreground transition text-left",title:"Modifier la note",children:a}):null]}),e.jsxs("div",{className:"flex items-center gap-1 shrink-0",children:[e.jsx("button",{type:"button",onClick:()=>{N?(D(null),R("")):(D(s.id),R(a??""))},className:M("inline-flex items-center justify-center h-7 w-7 rounded-lg transition",a?"text-primary hover:text-primary/80":"text-muted-foreground/40 hover:text-muted-foreground"),"aria-label":a?"Modifier la note":"Ajouter une note",children:e.jsx(Ds,{className:"h-3.5 w-3.5"})}),i>0&&!f?e.jsxs("button",{type:"button",onClick:()=>He(j?null:s.id),className:"inline-flex items-center gap-0.5 h-7 px-1.5 rounded-lg text-xs text-muted-foreground hover:text-foreground transition","aria-label":"Table des pourcentages",children:[e.jsx(zs,{className:M("h-3.5 w-3.5 transition-transform",j&&"rotate-180")}),e.jsx("span",{className:"text-[10px] font-bold",children:"%"})]}):null]})]}),f?e.jsx("div",{className:"mt-3",children:e.jsx(Bs,{value:Qe,placeholder:"Ex: 100",inputMode:"decimal",hint:"Charge max (kg).",onCancel:_e,onSave:c=>xs(s.id,c)})}):null,N?e.jsx("div",{className:"mt-3",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(F,{value:xe,onChange:c=>R(c.target.value),placeholder:"Machine n°3, cran 5...",className:"h-9 rounded-lg text-sm flex-1",autoFocus:!0}),e.jsx(v,{type:"button",size:"sm",onClick:()=>{const c=xe.trim()||null;Ne.mutate({exercise_id:s.id,notes:c}),D(null),R("")},disabled:Ne.isPending,className:"rounded-lg h-9 w-9 p-0 shrink-0","aria-label":"Enregistrer",children:e.jsx(ce,{className:"h-4 w-4"})}),e.jsx(v,{type:"button",size:"sm",variant:"outline",onClick:()=>{D(null),R("")},className:"rounded-lg h-9 w-9 p-0 shrink-0","aria-label":"Annuler",children:e.jsx(de,{className:"h-4 w-4"})})]})}):null,j&&i>0?e.jsx("div",{className:"mt-3 rounded-xl bg-muted/30 border border-border p-3",children:e.jsx("div",{className:"grid grid-cols-5 gap-2 text-center text-xs",children:[50,60,70,80,90].map(c=>e.jsxs("div",{className:"space-y-0.5",children:[e.jsxs("div",{className:"text-[10px] text-muted-foreground font-medium",children:[c,"%"]}),e.jsx("div",{className:"font-bold tabular-nums font-mono",children:Math.round(i*c/10)/10})]},c))})}):null]},s.id)})}),be.isPending?e.jsxs("div",{className:"px-4 pb-4 text-xs text-muted-foreground flex items-center gap-2",children:[e.jsx(Ce,{className:"h-3 w-3 animate-spin"})," Mise à jour..."]}):null]})})}),e.jsx("div",{className:"h-6"})]})]})})]})}):e.jsx("div",{className:"min-h-[100dvh]",children:e.jsxs("div",{className:"mx-auto max-w-lg px-4 pt-16 pb-10 text-center",children:[e.jsx(ne,{className:"h-10 w-10 mx-auto text-muted-foreground/30"}),e.jsx("p",{className:"mt-3 text-sm text-muted-foreground",children:"Cette page est réservée aux nageurs."})]})})}export{Rt as default};
