import{c as fs,r as m,u as O,d as K,j as e}from"./vendor-query-DyA9aSKS.js";import{u as ne,d as gs,W as re,B as g,T as Me,D as js,v as Te,w as vs,L as y,I,C as ie,e as ae,X as he}from"./index-DEw8lXrn.js";import{a as w}from"./api-DgHNrwix.js";import{T as bs}from"./textarea-Baqpdi0x.js";import{S as oe,a as le,b as de,c as ce,d as me}from"./sheet-DDucIX1O.js";import{T as Ns,a as ys,b as Le,c as Pe}from"./tabs-wFWituNE.js";import{S as ws,a as Ss,b as _s,c as Cs,d as qe}from"./select-D2kYCL9W.js";import{shouldShowRecords as ks}from"./Profile-DaYx_Jh0.js";import{I as $e}from"./InlineBanner-mxHriW89.js";import{c as Fs,s as ue,l as xe,f as Es}from"./animations-CrcLFysI.js";import{P as Is}from"./PageHeader-BWdT6OVz.js";import{u as Rs,m as E}from"./vendor-motion-CMsaQ8FX.js";import{C as pe}from"./circle-alert-Di0VRNg9.js";import{S as Ms}from"./sliders-horizontal-D4jt2W6h.js";import{P as ze}from"./pen-CjUFs6Zk.js";import{C as fe}from"./check-BRJSkYfr.js";import{C as Ts}from"./chevron-right-CWRkl4DF.js";import{a as Ls,i as Ps,h as qs,X as $s,Y as zs,T as Ds,g as As}from"./vendor-charts-BrQ8X25f.js";import{S as Os}from"./sticky-note-CMkOF5mA.js";import{C as Ks}from"./chevron-down-3Nhh0smy.js";import"./vendor-react-BzrpNAyj.js";import"./vendor-supabase-DFPLkPj_.js";import"./swim-BadMaWRd.js";import"./index-Mlw1bK_H.js";import"./index-BE3EncBH.js";import"./index-C74tTsj8.js";import"./index-C9wGSa99.js";import"./index-DCX2sNhR.js";import"./chevron-up-DLYeD34z.js";import"./avatar-B1EtdDOM.js";import"./badge-BYZrxhk6.js";import"./dialog-C48qdOKD.js";import"./types-g3FhkFPf.js";import"./toggle-group-BFP1NRCm.js";import"./alert-dialog-B0vpuNR9.js";import"./objectiveHelpers-BZkbUkU3.js";import"./target-BBJMQ_TL.js";import"./trash-2-C5Nr309v.js";import"./SwimmerFeedbackTab-CcJbKNKv.js";import"./chart-column-DSb1zrzg.js";import"./collapsible-Dd1xq-gT.js";import"./clock-DTwvmZwq.js";import"./circle-check-D3Pv0KIL.js";import"./sparkles-BNbV8PxL.js";import"./bell-ring-DRARtLix.js";import"./flame-BPGw_DCi.js";import"./save-iUAEC792.js";import"./design-tokens-CKgCpdH6.js";import"./chevron-left-CtHJ-HcN.js";const Hs=r=>r.toLowerCase().replace(/\./g,"").replace(/\s+/g," ").trim();function De(r){const n=Hs(r);return n.includes("nl")||n.includes("nage libre")?0:n.includes("dos")?1:n.includes("bra")||n.includes("brasse")?2:n.includes("pap")||n.includes("papillon")?3:n.includes("4n")||n.includes("4 n")||n.includes("4 nages")?4:99}function Ae(r){const n=r.match(/^(\d+)/);return n?Number(n[1]):Number.POSITIVE_INFINITY}function Qs(r,n){const p=De(r),u=De(n);return p!==u?p-u:Ae(r)-Ae(n)}const R=(...r)=>r.filter(Boolean).join(" ");function q(r){if(!r)return"—";const n=new Date(r);return Number.isNaN(n.getTime())?r:n.toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"2-digit"})}function H(r){if(r==null)return"—";const n=Math.round(Math.max(0,r*1e3)),p=Math.floor(n/6e4),u=Math.floor(n%6e4/1e3),j=Math.floor(n%1e3/10);return p>0?`${p}:${String(u).padStart(2,"0")}.${String(j).padStart(2,"0")}`:`${u}.${String(j).padStart(2,"0")}`}function Bs(r){const n=r.trim();if(!n)return null;if(n.includes(":")){const[u,j]=n.split(":"),h=Number(u);if(!Number.isFinite(h)||h<0)return null;const S=j.replace(",","."),_=Number(S);return!Number.isFinite(_)||_<0?null:h*60+_}const p=Number(n.replace(",","."));return!Number.isFinite(p)||p<0?null:p}function Vs(r){if(!r)return null;const n=r.match(/FFN\s*\((\d+)\s*pts\)/i);if(!n)return null;const p=Number(n[1]);return Number.isFinite(p)?p:null}function Ws({value:r,placeholder:n,onSave:p,onCancel:u,inputMode:j="decimal",hint:h}){const[S,_]=m.useState(r);return m.useEffect(()=>{_(r)},[r]),e.jsx("div",{className:"w-full",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(I,{value:S,onChange:X=>_(X.target.value),placeholder:n,inputMode:j,className:"h-10 rounded-xl",autoFocus:!0}),h?e.jsx("div",{className:"mt-1 text-xs text-muted-foreground",children:h}):null]}),e.jsx(g,{type:"button",onClick:()=>p(S),className:"h-10 w-10 p-0 rounded-xl","aria-label":"Valider",children:e.jsx(fe,{className:"h-5 w-5"})}),e.jsx(g,{type:"button",variant:"outline",onClick:u,className:"h-10 w-10 p-0 rounded-xl","aria-label":"Annuler",children:e.jsx(he,{className:"h-5 w-5"})})]})})}const C=()=>e.jsx("div",{className:"h-10 rounded-xl bg-muted animate-pulse motion-reduce:animate-none"});function Qt(){const r=ne(s=>s.user),n=ne(s=>s.userId),p=ne(s=>s.role),{toast:u}=gs(),j=fs(),h=Rs(),S={id:null,event_name:"",pool_length:"",time_seconds:"",record_date:"",notes:""},[_,X]=m.useState(()=>{const s=window.location.hash,t=s.indexOf("?");return t>=0&&new URLSearchParams(s.substring(t)).get("tab")==="1rm"?"1rm":"swim"}),[l,v]=m.useState(S),[d,Oe]=m.useState("training"),[$,Ke]=m.useState(25),[Y,Q]=m.useState(null),[He,B]=m.useState(!1),[Qe,ge]=m.useState(null),[Be,je]=m.useState(""),[Ve,We]=m.useState(null),[Ue,z]=m.useState(null),[ve,M]=m.useState(""),[V,Xe]=m.useState(25),[D,G]=m.useState(null),[Ye,be]=m.useState(!1),T=ks(p);m.useEffect(()=>{window.scrollTo({top:0,left:0,behavior:"auto"})},[]);const Ne=s=>{const t=s?.pool_length??s?.poolLength??s?.poolLen??s?.pool;if(t==null)return null;if(typeof t=="number")return t===25||t===50?t:null;const x=String(t).match(/\b(25|50)\b/);if(!x)return null;const o=Number(x[1]);return o===25||o===50?o:null},J=O({queryKey:["1rm",r,n],queryFn:()=>w.get1RM({athleteName:r,athleteId:n}),enabled:!!r&&T}),Z=O({queryKey:["exercises"],queryFn:()=>w.getExercises(),enabled:T}),ee=O({queryKey:["swim-records",n,r],queryFn:()=>w.getSwimRecords({athleteId:n??void 0,athleteName:r??void 0}),enabled:!!r&&T}),L=O({queryKey:["profile",n],queryFn:()=>w.getProfile({userId:n??void 0}),enabled:!!n&&T}),k=String(L.data?.ffn_iuf??"").trim(),ye=J.error||Z.error||ee.error||L.error,Ge=()=>{J.refetch(),Z.refetch(),ee.refetch(),L.refetch()},se=O({queryKey:["swimmer-performances",n,k,V],queryFn:()=>w.getSwimmerPerformances({userId:n??void 0,iuf:k||void 0,poolLength:V}),enabled:!!k&&T&&d==="history"}),{data:te,isLoading:Je,isError:Ze}=se,W=K({mutationFn:()=>{if(!k)throw new Error("IUF FFN manquant. Ajoutez-le dans votre profil.");return w.importSwimmerPerformances({iuf:k,userId:n??void 0})},onSuccess:s=>{j.invalidateQueries({queryKey:["swimmer-performances"]}),u({title:"Import terminé",description:`${s.total_found} trouvée(s), ${s.new_imported} importée(s), ${s.already_existed} déjà existante(s)`}),be(!0),setTimeout(()=>be(!1),2e3)},onError:s=>{u({title:"Import impossible",description:String(s?.message||s),variant:"destructive"})}}),P=m.useMemo(()=>{if(!te?.length)return[];const s=new Map;for(const o of te){const a=s.get(o.event_code)??[];a.push(o),s.set(o.event_code,a)}const t=o=>o.toLowerCase().replace(/\./g,"").replace(/\s+/g," ").trim(),i=o=>{const a=t(o);return a.includes("nl")||a.includes("nage libre")?0:a.includes("dos")?1:a.includes("bra")||a.includes("brasse")?2:a.includes("pap")||a.includes("papillon")?3:a.includes("4n")||a.includes("4 n")||a.includes("4 nages")?4:99},x=o=>{const a=o.match(/^(\d+)/);return a?Number(a[1]):1/0};return[...s.entries()].map(([o,a])=>{const f=[...a].sort((N,c)=>(c.competition_date??"").localeCompare(N.competition_date??"")),b=f.reduce((N,c)=>c.time_seconds<N.time_seconds?c:N,f[0]);return{eventCode:o,performances:f,bestTime:b.time_seconds,bestId:b.id}}).sort((o,a)=>{const f=i(o.eventCode),b=i(a.eventCode);return f!==b?f-b:x(o.eventCode)-x(a.eventCode)})},[te]),we=m.useMemo(()=>{if(!D)return[];const s=P.find(t=>t.eventCode===D);return s?[...s.performances].filter(t=>t.competition_date).sort((t,i)=>(t.competition_date??"").localeCompare(i.competition_date??"")).map(t=>({date:q(t.competition_date),time:t.time_seconds,display:t.time_display??H(t.time_seconds)})):[]},[D,P]),F=m.useMemo(()=>P.find(s=>s.eventCode===D)??null,[P,D]),{data:es,isLoading:ss,isError:ts}=J,{data:ns,isLoading:rs,isError:is}=Z,{data:Se,isLoading:as,isFetching:Us,isError:os,refetch:ls}=ee,ds=()=>{ls()};m.useEffect(()=>{d==="comp"&&ds()},[d]);const _e=d==="history"?V:$,cs=d==="training"?"Entraînement":d==="comp"?"Compétition":"Historique",Ce=K({mutationFn:s=>w.update1RM({...s,athlete_id:n,athlete_name:r}),onSuccess:()=>{j.invalidateQueries({queryKey:["1rm"]}),u({title:"1RM mis à jour"})}}),ke=K({mutationFn:s=>w.updateExerciseNote({athlete_id:n,exercise_id:s.exercise_id,notes:s.notes}),onSuccess:()=>{j.invalidateQueries({queryKey:["1rm"]}),u({title:"Note mise à jour"})}}),U=K({mutationFn:s=>w.upsertSwimRecord(s),onSuccess:()=>{j.invalidateQueries({queryKey:["swim-records"]}),v(S),Q(null),u({title:"Record mis à jour"})}});K({mutationFn:s=>w.syncFfnSwimRecords({athleteId:n??void 0,athleteName:r??void 0,iuf:s}),onSuccess:s=>{j.invalidateQueries({queryKey:["swim-records"]}),u({title:"Synchro FFN terminée",description:`${s?.inserted??0} ajouté(s), ${s?.updated??0} mis à jour, ${s?.skipped??0} inchangé(s)`})},onError:s=>{u({title:"Synchro FFN impossible",description:String(s?.message||s),variant:"destructive"})}});const A=()=>{v(S),Q(null)},ms=s=>{const t=Ne(s);v({id:s.id,event_name:s.event_name??"",pool_length:t?String(t):"",time_seconds:s.time_seconds!=null?H(Number(s.time_seconds)):"",record_date:s.record_date?String(s.record_date).split("T")[0]:"",notes:s.notes??""}),Q(s.id)},Fe=()=>{if(!l.event_name.trim()){u({title:"Nom d'épreuve requis",variant:"destructive"});return}if(!l.pool_length){u({title:"Bassin requis",variant:"destructive"});return}const s=Bs(l.time_seconds);if(s===null){u({title:"Temps invalide",description:"Ex: 1:02.34 ou 62.34",variant:"destructive"});return}U.mutate({id:l.id||null,athlete_id:n,athleteName:r,athlete_name:r,event_name:l.event_name,pool_length:parseInt(l.pool_length,10),time_seconds:s,record_date:l.record_date||null,notes:l.notes||null,record_type:d})},us=s=>{s.preventDefault(),Fe()},Ee=m.useMemo(()=>(Se?.records??[]).filter(i=>{const x=Ne(i);if(!x||x!==$)return!1;const o=String(i.record_type??"training");return d==="comp"?o==="comp":o==="training"}).sort((i,x)=>Qs(String(i.event_name??""),String(x.event_name??""))),[Se,$,d]),Ie=()=>{v({...S,pool_length:String($)}),Q("add")},xs=s=>{Oe(s),A()},ps=(s,t)=>{ge(s),je(t!=null&&Number(t)>0?String(t):"")},Re=()=>{ge(null),je("")},hs=(s,t)=>{const i=Number(String(t??"").replace(",","."));if(!Number.isFinite(i)||i<=0){u({title:"Valeur invalide",description:"Entrez un nombre > 0",variant:"destructive"});return}Ce.mutate({exercise_id:s,one_rm:i}),Re()};return T?ye?e.jsx("div",{className:"min-h-[100dvh]",children:e.jsxs("div",{className:"mx-auto max-w-lg px-4 pt-16 pb-10 text-center",children:[e.jsx(pe,{className:"h-10 w-10 mx-auto text-destructive/60"}),e.jsx("p",{className:"mt-3 text-sm font-semibold",children:"Impossible de charger les données"}),e.jsx("p",{className:"mt-1 text-xs text-muted-foreground",children:ye.message}),e.jsx(g,{onClick:Ge,size:"sm",className:"mt-4 rounded-2xl",children:"Réessayer"})]})}):e.jsx("div",{className:"min-h-[100dvh]",children:e.jsxs("div",{className:"mx-auto max-w-lg",children:[e.jsx(Is,{className:"-mx-0",title:"Mes Records",icon:e.jsx(Me,{className:"h-3.5 w-3.5"}),backHref:"/profile",backLabel:"Retour au profil"}),e.jsx("div",{className:"px-3 pt-3",children:e.jsxs(Ns,{value:_,onValueChange:s=>X(s),children:[e.jsxs(ys,{className:"w-full rounded-2xl bg-muted/50 border border-border p-1 flex",children:[e.jsxs(Le,{value:"swim","aria-label":"Records de natation",className:`flex-1 rounded-xl px-3 py-2 text-sm font-bold uppercase tracking-wide gap-1.5
                  data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm
                  data-[state=inactive]:text-muted-foreground`,children:[e.jsx(re,{className:"h-4 w-4"}),"Natation"]}),e.jsxs(Le,{value:"1rm","aria-label":"Records de musculation",className:`flex-1 rounded-xl px-3 py-2 text-sm font-bold uppercase tracking-wide gap-1.5
                  data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm
                  data-[state=inactive]:text-muted-foreground`,children:[e.jsx(js,{className:"h-4 w-4"}),"Musculation"]})]}),_==="swim"?e.jsxs("div",{className:"mt-2.5 flex items-center justify-between gap-2 rounded-2xl border border-border/60 bg-muted/20 px-3 py-2",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-[10px] font-semibold uppercase tracking-[0.14em] text-muted-foreground",children:"Vue active"}),e.jsxs("p",{className:"truncate text-sm font-semibold text-foreground",children:[cs," · ",_e,"m"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[d==="training"?e.jsx(g,{type:"button",size:"sm",onClick:Ie,className:"rounded-xl text-xs h-8 gap-1",children:"Ajouter"}):null,d==="history"?e.jsx(E.div,{variants:Fs,animate:Ye?"visible":"hidden",children:e.jsxs(g,{type:"button",size:"sm",onClick:()=>W.mutate(),disabled:W.isPending||!k,className:"rounded-xl text-xs h-8 gap-1",children:[W.isPending?e.jsx(Te,{className:"h-3 w-3 animate-spin"}):e.jsx(vs,{className:"h-3 w-3"}),W.isPending?"Import...":"Importer"]})}):null,e.jsxs(g,{type:"button",size:"sm",variant:"outline",onClick:()=>B(!0),className:"rounded-xl text-xs h-8 gap-1",children:[e.jsx(Ms,{className:"h-3.5 w-3.5"}),"Filtres"]})]})]}):null,e.jsx(oe,{open:He,onOpenChange:B,children:e.jsxs(le,{side:"bottom",className:"max-h-[85vh] overflow-y-auto rounded-t-3xl",children:[e.jsxs(de,{className:"text-left",children:[e.jsx(ce,{children:"Filtres natation"}),e.jsx(me,{children:"Choisis le type de records et le bassin sans surcharger l'écran principal."})]}),e.jsxs("div",{className:"mt-5 space-y-5",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{className:"text-xs uppercase tracking-[0.12em] text-muted-foreground",children:"Type"}),e.jsx("div",{className:"grid grid-cols-1 gap-2",children:["training","comp","history"].map(s=>{const t=s==="training"?"Entraînement":s==="comp"?"Compétition":"Historique FFN",i=s==="training"?"Tes meilleurs temps saisis dans l'app":s==="comp"?"Les performances validées en compétition":"Historique détaillé importé depuis la FFN";return e.jsxs("button",{type:"button",onClick:()=>{xs(s),s!=="history"&&G(null),B(!1)},className:R("rounded-2xl border px-4 py-3 text-left transition",d===s?"border-primary/30 bg-primary/5":"border-border bg-background hover:bg-muted/40"),"aria-pressed":d===s,children:[e.jsx("p",{className:"text-sm font-semibold",children:t}),e.jsx("p",{className:"mt-1 text-xs text-muted-foreground",children:i})]},s)})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{className:"text-xs uppercase tracking-[0.12em] text-muted-foreground",children:"Bassin"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:[25,50].map(s=>e.jsxs("button",{type:"button",onClick:()=>{d==="history"?Xe(s):(Ke(s),A()),B(!1)},className:R("rounded-2xl border px-4 py-3 text-sm font-semibold transition",_e===s?"border-primary/30 bg-primary/5 text-foreground":"border-border bg-background text-muted-foreground hover:text-foreground hover:bg-muted/40"),children:[s,"m"]},s))})]}),d==="comp"?e.jsx("div",{className:"rounded-2xl border border-border bg-muted/30 px-4 py-3 text-xs text-muted-foreground",children:"Les records compétition sont affichés à partir des données synchronisées FFN."}):null]})]})}),e.jsx(oe,{open:d==="training"&&Y==="add",onOpenChange:s=>{!s&&Y==="add"&&A()},children:e.jsxs(le,{side:"bottom",className:"max-h-[90vh] overflow-y-auto rounded-t-3xl",children:[e.jsxs(de,{className:"text-left",children:[e.jsx(ce,{children:"Ajouter un record"}),e.jsx(me,{children:"Saisis rapidement un meilleur temps d'entraînement sans quitter la liste."})]}),e.jsx("form",{onSubmit:us,className:"mt-5",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"col-span-2",children:[e.jsx(y,{className:"text-xs mb-1.5 block",children:"Épreuve"}),e.jsx(I,{value:l.event_name,onChange:s=>v({...l,event_name:s.target.value}),placeholder:"Ex: 100 NL, 200 Dos",className:"h-10 rounded-xl"})]}),e.jsxs("div",{children:[e.jsx(y,{className:"text-xs mb-1.5 block",children:"Bassin"}),e.jsxs(ws,{value:l.pool_length,onValueChange:s=>v({...l,pool_length:s}),children:[e.jsx(Ss,{className:"h-10 rounded-xl",children:e.jsx(_s,{placeholder:"—"})}),e.jsxs(Cs,{children:[e.jsx(qe,{value:"25",children:"25m"}),e.jsx(qe,{value:"50",children:"50m"})]})]})]}),e.jsxs("div",{children:[e.jsx(y,{className:"text-xs mb-1.5 block",children:"Temps"}),e.jsx(I,{value:l.time_seconds,inputMode:"decimal",placeholder:"1:02.34",onChange:s=>v({...l,time_seconds:s.target.value}),className:"h-10 rounded-xl"})]}),e.jsxs("div",{children:[e.jsx(y,{className:"text-xs mb-1.5 block",children:"Date"}),e.jsx(I,{type:"date",value:l.record_date,onChange:s=>v({...l,record_date:s.target.value}),className:"h-10 rounded-xl"})]}),e.jsxs("div",{children:[e.jsx(y,{className:"text-xs mb-1.5 block",children:"Notes"}),e.jsx(I,{value:l.notes,onChange:s=>v({...l,notes:s.target.value}),placeholder:"Optionnel",className:"h-10 rounded-xl"})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 pb-2",children:[e.jsx(g,{type:"button",variant:"outline",onClick:A,className:"rounded-xl",children:"Annuler"}),e.jsx(g,{type:"submit",disabled:U.isPending,className:"rounded-xl",children:U.isPending?"Ajout...":"Ajouter"})]})]})})]})}),e.jsxs(Pe,{value:"swim",className:"mt-0",children:[d!=="history"?e.jsx(e.Fragment,{children:e.jsx("div",{className:"mt-3",children:e.jsx(ie,{className:"w-full min-w-0 rounded-2xl",children:e.jsx(ae,{className:"p-0",children:as?e.jsxs("div",{className:"p-4 grid gap-3",children:[e.jsx(C,{}),e.jsx(C,{}),e.jsx(C,{})]}):os?e.jsx("div",{className:"mx-4 my-4 rounded-lg border border-destructive/20 bg-destructive/10 p-4 text-sm text-destructive",children:"Impossible de charger les records natation."}):Ee.length===0?e.jsxs("div",{className:"py-8 text-center",children:[e.jsx(re,{className:"h-8 w-8 mx-auto text-muted-foreground/30"}),e.jsxs("p",{className:"mt-2 text-sm text-muted-foreground",children:["Aucun record en ",$,"m"]}),d==="training"&&e.jsx(g,{type:"button",size:"sm",variant:"outline",onClick:Ie,className:"mt-3 rounded-xl text-xs h-8",children:"Ajouter un record"})]}):e.jsx(E.div,{className:"divide-y divide-border motion-reduce:animate-none",variants:h?void 0:ue,initial:h?!1:"hidden",animate:h?!1:"visible",children:Ee.map(s=>{const t=Y===s.id,i=H(s.time_seconds),x=q(s.record_date),o=(s.notes??"").trim(),a=s?.ffn_points??s?.ffnPoints??s?.points??s?.pts??null,f=a==null?NaN:Number(a),b=Number.isFinite(f)?f:Vs(s?.notes),N=(s?.meet??s?.meet_name??s?.meetName??s?.competition??"").trim?.()??"";return e.jsxs(E.div,{className:"px-3 py-2.5 motion-reduce:animate-none",variants:xe,children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("span",{className:"text-sm font-semibold truncate",children:s.event_name}),e.jsxs("div",{className:"flex items-center gap-2 shrink-0",children:[e.jsx("span",{className:"font-mono text-primary font-bold tabular-nums text-sm",children:i}),d==="training"&&e.jsx("button",{type:"button",onClick:()=>ms(s),className:"inline-flex items-center justify-center h-8 w-8 rounded-xl text-muted-foreground hover:text-foreground hover:bg-muted/60 transition","aria-label":`Modifier ${s.event_name}`,children:e.jsx(ze,{className:"h-3.5 w-3.5"})})]})]}),e.jsxs("div",{className:"flex items-center gap-3 mt-0.5 text-xs text-muted-foreground",children:[d==="comp"&&b!=null&&e.jsxs("span",{className:"tabular-nums",children:[String(b)," pts"]}),e.jsx("span",{className:"tabular-nums",children:x}),d==="comp"&&N&&e.jsx("span",{className:"truncate",children:N}),d==="training"&&o&&e.jsx("span",{className:"truncate italic",children:o})]}),d==="training"&&t?e.jsx(E.div,{className:"mt-3",variants:Es,initial:"hidden",animate:"visible",children:e.jsxs("div",{className:"rounded-2xl bg-muted/30 border border-border p-4 space-y-4",children:[e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(y,{children:"Temps"}),e.jsx(I,{value:l.time_seconds,inputMode:"decimal",placeholder:"1:02.34",onChange:c=>v({...l,time_seconds:c.target.value}),className:"rounded-xl"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Format: mm:ss.cc ou secondes"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(y,{children:"Date"}),e.jsx(I,{type:"date",value:l.record_date,onChange:c=>v({...l,record_date:c.target.value}),className:"rounded-xl"})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(y,{children:"Notes"}),e.jsx(bs,{value:l.notes,onChange:c=>v({...l,notes:c.target.value}),rows:2,className:"rounded-xl"})]}),e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsxs(g,{type:"button",size:"sm",variant:"outline",onClick:A,className:"rounded-2xl gap-2",children:[e.jsx(he,{className:"h-4 w-4"}),"Annuler"]}),e.jsxs(g,{type:"button",size:"sm",onClick:Fe,disabled:U.isPending,className:"rounded-2xl gap-2",children:[e.jsx(fe,{className:"h-4 w-4"}),"Enregistrer"]})]})]})}):null]},s.id)})})})})})}):null,d==="history"?e.jsxs("div",{className:"mt-3 space-y-3",children:[e.jsx($e,{variant:"destructive",icon:e.jsx(pe,{}),label:"Impossible de charger votre profil",visible:L.isError,animate:!1}),e.jsx($e,{variant:"yellow",icon:e.jsx(pe,{}),label:"IUF FFN non renseigné",sublabel:e.jsxs(e.Fragment,{children:["Renseignez votre numéro dans ",e.jsx("a",{href:"/#/profile",className:"underline font-medium hover:text-foreground",children:"votre profil"})]}),visible:!L.isError&&!k&&!L.isLoading,animate:!1}),Je?e.jsxs("div",{className:"grid gap-3",children:[e.jsx(C,{}),e.jsx(C,{}),e.jsx(C,{})]}):Ze?e.jsxs("div",{className:"rounded-lg border border-destructive/20 bg-destructive/10 p-4 text-sm text-destructive",children:[e.jsx("p",{className:"font-semibold",children:"Impossible de charger les performances"}),e.jsx("p",{className:"mt-1 text-xs",children:se.error instanceof Error?se.error.message:"Vérifiez votre connexion internet et réessayez."})]}):P.length===0?e.jsx("div",{className:"px-4 py-6 text-sm text-muted-foreground",children:k?'Aucune performance trouvée. Cliquez sur "Importer" pour récupérer vos données FFN.':"Ajoutez votre IUF FFN dans votre profil pour commencer."}):e.jsx(E.div,{className:"space-y-2 motion-reduce:animate-none",variants:h?void 0:ue,initial:h?!1:"hidden",animate:h?!1:"visible",children:P.map(s=>{const t=s.performances.find(x=>x.id===s.bestId)??s.performances[0],i=s.performances[0];return e.jsx(E.div,{variants:xe,children:e.jsx(ie,{className:"rounded-2xl",children:e.jsx(ae,{className:"p-0",children:e.jsxs("button",{type:"button",onClick:()=>G(s.eventCode),className:"w-full flex items-center justify-between gap-3 px-3 py-3 text-left cursor-pointer",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[e.jsx("span",{className:"text-sm font-semibold truncate",children:s.eventCode}),e.jsx("span",{className:"inline-flex items-center justify-center h-5 min-w-5 px-1.5 rounded-full bg-muted text-xs font-semibold tabular-nums text-muted-foreground",children:s.performances.length})]}),e.jsxs("div",{className:"mt-1 flex items-center gap-3 text-xs text-muted-foreground",children:[e.jsxs("span",{children:["Meilleur: ",q(t?.competition_date)]}),i?.competition_date&&i.id!==t?.id?e.jsxs("span",{children:["Dernier: ",q(i.competition_date)]}):null]})]}),e.jsxs("div",{className:"flex items-center gap-2 shrink-0",children:[e.jsx("span",{className:"font-mono text-primary font-bold tabular-nums text-sm",children:H(s.bestTime)}),e.jsx(Ts,{className:"h-4 w-4 text-muted-foreground"})]})]})})})},s.eventCode)})}),e.jsx(oe,{open:!!F,onOpenChange:s=>{s||G(null)},children:e.jsxs(le,{side:"bottom",className:"max-h-[90vh] overflow-y-auto rounded-t-3xl",children:[e.jsxs(de,{className:"text-left",children:[e.jsx(ce,{children:F?.eventCode??"Historique"}),e.jsx(me,{children:F?`${F.performances.length} performance${F.performances.length>1?"s":""} en bassin ${V}m`:"Historique détaillé"})]}),F?e.jsxs("div",{className:"mt-5 space-y-4",children:[we.length>1?e.jsxs("div",{className:"rounded-2xl border border-border bg-muted/20 px-2 pt-3 pb-1",children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-2 px-2",children:"Courbe de progression"}),e.jsx(Ls,{width:"100%",height:180,children:e.jsxs(Ps,{data:we,margin:{top:5,right:10,left:0,bottom:5},children:[e.jsx(qs,{strokeDasharray:"3 3",className:"stroke-border"}),e.jsx($s,{dataKey:"date",tick:{fontSize:10},className:"text-muted-foreground"}),e.jsx(zs,{domain:["auto","auto"],tick:{fontSize:10},className:"text-muted-foreground",reversed:!0,tickFormatter:s=>{const t=Math.floor(s/60),i=Math.floor(s%60),x=Math.round(s%1*100);return t>0?`${t}:${String(i).padStart(2,"0")}`:`${i}.${String(x).padStart(2,"0")}`}}),e.jsx(Ds,{formatter:s=>{const t=Math.floor(s/60),i=Math.floor(s%60),x=Math.round(s%1*100);return[t>0?`${t}:${String(i).padStart(2,"0")}.${String(x).padStart(2,"0")}`:`${i}.${String(x).padStart(2,"0")}`,"Temps"]},labelStyle:{fontSize:11},contentStyle:{borderRadius:12,fontSize:12}}),e.jsx(As,{type:"monotone",dataKey:"time",stroke:"hsl(var(--primary))",strokeWidth:2,dot:{r:3},activeDot:{r:5}})]})})]}):null,e.jsx("div",{className:"overflow-hidden rounded-2xl border border-border",children:e.jsx("div",{className:"divide-y divide-border",children:F.performances.map(s=>{const t=s.id===F.bestId;return e.jsxs("div",{className:R("px-3 py-2.5",t&&"bg-primary/5"),children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex items-center gap-1.5 min-w-0",children:[t?e.jsx(Me,{className:"h-3.5 w-3.5 text-primary shrink-0"}):null,e.jsx("span",{className:"text-xs text-muted-foreground tabular-nums",children:q(s.competition_date)})]}),e.jsx("span",{className:R("font-mono tabular-nums text-sm shrink-0",t?"text-primary font-bold":"font-medium"),children:s.time_display??H(s.time_seconds)})]}),e.jsxs("div",{className:"flex items-center gap-3 mt-0.5 text-xs text-muted-foreground",children:[s.ffn_points!=null?e.jsxs("span",{className:"tabular-nums",children:[String(s.ffn_points)," pts"]}):null,s.competition_name?e.jsx("span",{className:"truncate",children:s.competition_name}):null]})]},s.id)})})})]}):null]})})]}):null,e.jsx("div",{className:"h-6"})]}),e.jsxs(Pe,{value:"1rm",className:"mt-0",children:[e.jsx("div",{className:"mt-3",children:e.jsx(ie,{className:"w-full min-w-0 rounded-2xl",children:e.jsxs(ae,{className:"p-0",children:[ss||rs?e.jsxs("div",{className:"p-4 grid gap-3",children:[e.jsx(C,{}),e.jsx(C,{}),e.jsx(C,{})]}):ts||is?e.jsx("div",{className:"p-4 text-sm text-muted-foreground",children:"Impossible de charger les records musculation."}):e.jsx(E.div,{className:"divide-y divide-border motion-reduce:animate-none",variants:h?void 0:ue,initial:h?!1:"hidden",animate:h?!1:"visible",children:ns?.filter(s=>s.exercise_type!=="warmup").map(s=>{const t=es?.find(c=>c.exercise_id===s.id),i=Number(t?.weight??0),x=i>0?`${i} kg`:"—",o=t?.recorded_at??t?.date??null,a=t?.notes??null,f=Qe===s.id,b=Ve===s.id,N=Ue===s.id;return e.jsxs(E.div,{className:"px-3 py-2.5 motion-reduce:animate-none",variants:xe,children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("span",{className:"text-sm font-semibold truncate",children:s.nom_exercice}),e.jsxs("div",{className:"flex items-center gap-2 shrink-0",children:[e.jsx("span",{className:R("font-mono font-bold tabular-nums text-sm",i>0?"text-primary":"text-muted-foreground"),children:x}),!f&&e.jsx("button",{type:"button",onClick:()=>ps(s.id,t?.weight??null),className:"inline-flex items-center justify-center h-8 w-8 rounded-xl text-muted-foreground hover:text-foreground hover:bg-muted/60 transition","aria-label":`Modifier ${s.nom_exercice}`,children:e.jsx(ze,{className:"h-3.5 w-3.5"})})]})]}),e.jsxs("div",{className:"flex items-center justify-between mt-0.5",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground min-w-0",children:[e.jsx("span",{className:"tabular-nums shrink-0",children:q(o)}),a&&!N?e.jsx("button",{type:"button",onClick:()=>{z(s.id),M(a??"")},className:"truncate italic hover:text-foreground transition text-left",title:"Modifier la note",children:a}):null]}),e.jsxs("div",{className:"flex items-center gap-1 shrink-0",children:[e.jsx("button",{type:"button",onClick:()=>{N?(z(null),M("")):(z(s.id),M(a??""))},className:R("inline-flex items-center justify-center h-7 w-7 rounded-lg transition",a?"text-primary hover:text-primary/80":"text-muted-foreground/40 hover:text-muted-foreground"),"aria-label":a?"Modifier la note":"Ajouter une note",children:e.jsx(Os,{className:"h-3.5 w-3.5"})}),i>0&&!f?e.jsxs("button",{type:"button",onClick:()=>We(b?null:s.id),className:"inline-flex items-center gap-0.5 h-7 px-1.5 rounded-lg text-xs text-muted-foreground hover:text-foreground transition","aria-label":"Table des pourcentages",children:[e.jsx(Ks,{className:R("h-3.5 w-3.5 transition-transform",b&&"rotate-180")}),e.jsx("span",{className:"text-[10px] font-bold",children:"%"})]}):null]})]}),f?e.jsx("div",{className:"mt-3",children:e.jsx(Ws,{value:Be,placeholder:"Ex: 100",inputMode:"decimal",hint:"Charge max (kg).",onCancel:Re,onSave:c=>hs(s.id,c)})}):null,N?e.jsx("div",{className:"mt-3",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(I,{value:ve,onChange:c=>M(c.target.value),placeholder:"Machine n°3, cran 5...",className:"h-9 rounded-lg text-sm flex-1",autoFocus:!0}),e.jsx(g,{type:"button",size:"sm",onClick:()=>{const c=ve.trim()||null;ke.mutate({exercise_id:s.id,notes:c}),z(null),M("")},disabled:ke.isPending,className:"rounded-lg h-9 w-9 p-0 shrink-0","aria-label":"Enregistrer",children:e.jsx(fe,{className:"h-4 w-4"})}),e.jsx(g,{type:"button",size:"sm",variant:"outline",onClick:()=>{z(null),M("")},className:"rounded-lg h-9 w-9 p-0 shrink-0","aria-label":"Annuler",children:e.jsx(he,{className:"h-4 w-4"})})]})}):null,b&&i>0?e.jsx("div",{className:"mt-3 rounded-xl bg-muted/30 border border-border p-3",children:e.jsx("div",{className:"grid grid-cols-5 gap-2 text-center text-xs",children:[50,60,70,80,90].map(c=>e.jsxs("div",{className:"space-y-0.5",children:[e.jsxs("div",{className:"text-[10px] text-muted-foreground font-medium",children:[c,"%"]}),e.jsx("div",{className:"font-bold tabular-nums font-mono",children:Math.round(i*c/10)/10})]},c))})}):null]},s.id)})}),Ce.isPending?e.jsxs("div",{className:"px-4 pb-4 text-xs text-muted-foreground flex items-center gap-2",children:[e.jsx(Te,{className:"h-3 w-3 animate-spin"})," Mise à jour..."]}):null]})})}),e.jsx("div",{className:"h-6"})]})]})})]})}):e.jsx("div",{className:"min-h-[100dvh]",children:e.jsxs("div",{className:"mx-auto max-w-lg px-4 pt-16 pb-10 text-center",children:[e.jsx(re,{className:"h-10 w-10 mx-auto text-muted-foreground/30"}),e.jsx("p",{className:"mt-3 text-sm text-muted-foreground",children:"Cette page est réservée aux nageurs."})]})})}export{Qt as default};
