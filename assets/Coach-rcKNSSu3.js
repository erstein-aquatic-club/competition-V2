const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/StrengthCatalog-BvKhpE1X.js","assets/vendor-query-BiSH4r2z.js","assets/vendor-react-BzrpNAyj.js","assets/api-B_OEeDiQ.js","assets/index-ChcPlEtA.js","assets/vendor-supabase-DFPLkPj_.js","assets/index-OehbwvzC.css","assets/swim-DaZOFCa1.js","assets/index-ivd9Utcw.js","assets/index-1Ny1V6_M.js","assets/index-B7g79BHL.js","assets/select-DZCKkCig.js","assets/index-CkD_67mg.js","assets/chevron-down-BcdgH4lN.js","assets/chevron-up-CK82fEWp.js","assets/CalendarGrid-D7afFPmR.js","assets/chevron-left-hOnrWNqI.js","assets/chevron-right-D1MfhDXW.js","assets/objectiveHelpers-BfkBd0EK.js","assets/dialog-BZyEUXXI.js","assets/index-594iQi9S.js","assets/checkbox-CXozEw7u.js","assets/alert-dialog-C6DkBdF7.js","assets/tabs-DIGaVyI9.js","assets/SessionListView-CfaZx29W.js","assets/play-Bkqezw_P.js","assets/save-DkuRqSL1.js","assets/circle-alert-CKB1E6xx.js","assets/pencil-BYGDmFRr.js","assets/share-2-BLiAkuwG.js","assets/trash-2-BeZYAWTC.js","assets/drawer-CWqHTUNK.js","assets/plus-DDgLJJhm.js","assets/loader-circle-D2npnFkp.js","assets/search-C_YrDpOw.js","assets/pen-DB-5rjcz.js","assets/badge-ljrGz9E5.js","assets/toggle-group-DZg6gURG.js","assets/separator-CnSdSjwU.js","assets/collapsible-Bydc9F4H.js","assets/user-plus-D-acx_2O.js","assets/switch-BVTeEb9f.js","assets/map-pin-CNqmmi_Q.js","assets/SwimCatalog-Cl9M4bNf.js","assets/SwimSessionTimeline--lu_qQhh.js","assets/swimConsultationUtils-eaBEXtoJ.js","assets/timer-Bc3j5pes.js","assets/eye-BdvV5l2g.js","assets/clock-DInN8kLF.js","assets/format-B9mPVj_w.js"])))=>i.map(i=>d[i]);
import{c as me,B as L,d as se,C as Ae,i as Me,k as De,l as Ee,g as Pe,L as H,I as ye,m as Ne,n as xs,o as Mt,R as gs,p as fs,q as Dt,P as ne,A as Et,r as Pt,t as vs,v as js,w as bs,x as ys,a as ce,X as ft,s as ct,W as Rt,D as Ft,y as Ns,U as we,z as ws,E as Cs,T as st,u as vt,b as Ss,G as jt,H as _s,_ as Tt}from"./index-ChcPlEtA.js";import{j as e,r,R as ks,u as Q,c as Se,d as X}from"./vendor-query-BiSH4r2z.js";import{a as I}from"./api-B_OEeDiQ.js";import{B as te}from"./badge-ljrGz9E5.js";import{T as dt,a as de}from"./toggle-group-DZg6gURG.js";import{A as Qe,T as ut,a as nt,e as $t,f as Ot,F as As,p as bt}from"./objectiveHelpers-BfkBd0EK.js";import{S as re,a as ae,b as oe,c as ie,d as Z}from"./select-DZCKkCig.js";import{h as Ms,R as Ds,u as Es,F as Ps,C as yt}from"./index-CkD_67mg.js";import{u as xe}from"./index-B7g79BHL.js";import{R as Rs,P as Fs,O as Ts,C as $s}from"./index-594iQi9S.js";import"./dialog-BZyEUXXI.js";import{S as Os}from"./search-C_YrDpOw.js";import{a as Is,b as qs,P as zs}from"./CalendarGrid-D7afFPmR.js";import{S as Le,a as Ke,b as Ve,c as Ge,d as mt,A as Re,e as Fe,f as Te,g as $e,h as Oe,i as Ie,j as qe,k as ze}from"./alert-dialog-C6DkBdF7.js";import{T as It}from"./trash-2-BeZYAWTC.js";import{C as qt}from"./checkbox-CXozEw7u.js";import{S as Ls}from"./separator-CnSdSjwU.js";import{C as Ks,a as Vs,b as Gs}from"./collapsible-Bydc9F4H.js";import{P as ge}from"./plus-DDgLJJhm.js";import{U as Bs,a as Us}from"./user-plus-D-acx_2O.js";import{C as Qs}from"./chevron-down-BcdgH4lN.js";import{S as Hs}from"./switch-BVTeEb9f.js";import{M as Ws}from"./map-pin-CNqmmi_Q.js";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ys=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 18h.01",key:"lrp35t"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M16 18h.01",key:"kzsmim"}]],rt=me("calendar-days",Ys);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Js=[["path",{d:"m7 15 5 5 5-5",key:"1hf1tw"}],["path",{d:"m7 9 5-5 5 5",key:"sgt6xg"}]],Xs=me("chevrons-up-down",Js);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zs=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],en=me("copy",Zs);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tn=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]],zt=me("external-link",tn);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sn=[["path",{d:"M2 9.5a5.5 5.5 0 0 1 9.591-3.676.56.56 0 0 0 .818 0A5.49 5.49 0 0 1 22 9.5c0 2.29-1.5 4-3 5.5l-5.492 5.313a2 2 0 0 1-3 .019L5 15c-1.5-1.5-3-3.2-3-5.5",key:"mvr1a0"}],["path",{d:"M3.22 13H9.5l.5-1 2 4.5 2-7 1.5 3.5h5.27",key:"auskq0"}]],nn=me("heart-pulse",sn);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rn=[["path",{d:"m22 7-8.991 5.727a2 2 0 0 1-2.009 0L2 7",key:"132q7q"}],["rect",{x:"2",y:"4",width:"20",height:"16",rx:"2",key:"izxlao"}]],pt=me("mail",rn);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const an=[["path",{d:"M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z",key:"18887p"}]],ht=me("message-square",an);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const on=[["path",{d:"M18 21a8 8 0 0 0-16 0",key:"3ypg7q"}],["circle",{cx:"10",cy:"8",r:"5",key:"o932ke"}],["path",{d:"M22 20c0-3.37-2-6.5-4-8a5 5 0 0 0-.45-8.3",key:"10s06x"}]],Lt=me("users-round",on),le=({title:t,description:n,onBack:s,actions:o})=>e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs(L,{variant:"ghost",size:"sm",className:"-ml-2",onClick:s,children:[e.jsx(Qe,{className:"mr-2 h-4 w-4"}),"Retour"]}),e.jsx("h2",{className:"text-2xl font-display font-semibold uppercase italic text-primary",children:t}),n?e.jsx("p",{className:"text-sm text-muted-foreground",children:n}):null]}),o?e.jsx("div",{className:"flex items-center gap-2",children:o}):null]}),ln=({onBack:t,athletes:n,groups:s,athletesLoading:o})=>{const{toast:a}=se(),[l,u]=r.useState(""),[i,x]=r.useState(""),d=r.useMemo(()=>n.filter(c=>c.id&&c.email).map(c=>({value:`user:${c.id}`,label:c.group_label?`${c.display_name} · ${c.group_label}`:c.display_name,email:c.email})),[n]),g=r.useMemo(()=>s.map(c=>({value:`group:${c.id}`,label:c.name,id:c.id})),[s]),p=()=>{if(!i)return[];if(i.startsWith("user:")){const c=d.find(y=>y.value===i);return c?[c.email]:[]}if(i.startsWith("group:")){const c=Number(i.split(":")[1]);return n.filter(y=>y.group_id===c&&y.email).map(y=>y.email)}return[]},v=()=>{const c=p();if(!c.length){a({title:"Aucune adresse email",description:"Aucun nageur avec une adresse email dans cette sélection."});return}const y=new URLSearchParams;y.set("bcc",c.join(",")),l.trim()&&y.set("subject",l.trim()),window.location.href=`mailto:?${y.toString()}`},b=p();return e.jsxs("div",{className:"space-y-6 pb-24",children:[e.jsx(le,{title:"Contacter par email",description:"Ouvre votre application mail avec les destinataires en CCI.",onBack:t}),e.jsxs(Ae,{className:"border-l-4 border-l-primary",children:[e.jsxs(Me,{children:[e.jsx(De,{children:"Destinataire"}),e.jsx(Ee,{children:"Sélectionnez un nageur ou un groupe."})]}),e.jsxs(Pe,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(H,{children:"Destinataire"}),e.jsxs(re,{value:i,onValueChange:x,children:[e.jsx(ae,{children:e.jsx(oe,{placeholder:o?"Chargement...":"Choisir un nageur ou un groupe"})}),e.jsxs(ie,{children:[g.length?e.jsxs(e.Fragment,{children:[e.jsx(Z,{value:"section-group",disabled:!0,children:"Groupes"}),g.map(c=>e.jsx(Z,{value:c.value,children:c.label},c.value))]}):null,d.length?e.jsxs(e.Fragment,{children:[e.jsx(Z,{value:"section-athlete",disabled:!0,children:"Nageurs"}),d.map(c=>e.jsx(Z,{value:c.value,children:c.label},c.value))]}):null]})]})]}),i&&b.length>0?e.jsxs("p",{className:"text-xs text-muted-foreground",children:[b.length," adresse",b.length>1?"s":""," email",b.length>1?" (envoi en CCI)":""]}):null,i&&b.length===0?e.jsx("p",{className:"text-xs text-destructive",children:"Aucune adresse email disponible pour cette sélection."}):null]})]}),e.jsxs(Ae,{children:[e.jsxs(Me,{children:[e.jsx(De,{children:"Objet"}),e.jsx(Ee,{children:"Optionnel — pré-rempli dans votre application mail."})]}),e.jsx(Pe,{children:e.jsx(ye,{value:l,onChange:c=>u(c.target.value),placeholder:"Objet du mail…"})})]}),e.jsx("div",{className:"sticky bottom-0 z-10 -mx-4 border-t bg-background/95 p-4 backdrop-blur sm:static sm:mx-0 sm:border-0 sm:p-0",children:e.jsxs(L,{className:"w-full sm:w-auto",onClick:v,disabled:!i||b.length===0,children:[e.jsx(pt,{className:"mr-2 h-4 w-4"}),"Ouvrir dans l'app mail",e.jsx(zt,{className:"ml-2 h-3 w-3"})]})})]})};function ke(t,n,{checkForDefaultPrevented:s=!0}={}){return function(a){if(t?.(a),s===!1||!a.defaultPrevented)return n?.(a)}}function cn(t){const n=dn(t),s=r.forwardRef((o,a)=>{const{children:l,...u}=o,i=r.Children.toArray(l),x=i.find(mn);if(x){const d=x.props.children,g=i.map(p=>p===x?r.Children.count(d)>1?r.Children.only(null):r.isValidElement(d)?d.props.children:null:p);return e.jsx(n,{...u,ref:a,children:r.isValidElement(d)?r.cloneElement(d,void 0,g):null})}return e.jsx(n,{...u,ref:a,children:l})});return s.displayName=`${t}.Slot`,s}function dn(t){const n=r.forwardRef((s,o)=>{const{children:a,...l}=s;if(r.isValidElement(a)){const u=hn(a),i=pn(l,a.props);return a.type!==r.Fragment&&(i.ref=o?Ne(o,u):u),r.cloneElement(a,i)}return r.Children.count(a)>1?r.Children.only(null):null});return n.displayName=`${t}.SlotClone`,n}var un=Symbol("radix.slottable");function mn(t){return r.isValidElement(t)&&typeof t.type=="function"&&"__radixId"in t.type&&t.type.__radixId===un}function pn(t,n){const s={...n};for(const o in n){const a=t[o],l=n[o];/^on[A-Z]/.test(o)?a&&l?s[o]=(...i)=>{const x=l(...i);return a(...i),x}:a&&(s[o]=a):o==="style"?s[o]={...a,...l}:o==="className"&&(s[o]=[a,l].filter(Boolean).join(" "))}return{...t,...s}}function hn(t){let n=Object.getOwnPropertyDescriptor(t.props,"ref")?.get,s=n&&"isReactWarning"in n&&n.isReactWarning;return s?t.ref:(n=Object.getOwnPropertyDescriptor(t,"ref")?.get,s=n&&"isReactWarning"in n&&n.isReactWarning,s?t.props.ref:t.props.ref||t.ref)}var xn=ks[" useInsertionEffect ".trim().toString()]||xs;function gn({prop:t,defaultProp:n,onChange:s=()=>{},caller:o}){const[a,l,u]=fn({defaultProp:n,onChange:s}),i=t!==void 0,x=i?t:a;{const g=r.useRef(t!==void 0);r.useEffect(()=>{const p=g.current;p!==i&&console.warn(`${o} is changing from ${p?"controlled":"uncontrolled"} to ${i?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),g.current=i},[i,o])}const d=r.useCallback(g=>{if(i){const p=vn(g)?g(t):g;p!==t&&u.current?.(p)}else l(g)},[i,t,l,u]);return[x,d]}function fn({defaultProp:t,onChange:n}){const[s,o]=r.useState(t),a=r.useRef(s),l=r.useRef(n);return xn(()=>{l.current=n},[n]),r.useEffect(()=>{a.current!==s&&(l.current?.(s),a.current=s)},[s,a]),[s,o,l]}function vn(t){return typeof t=="function"}var He="Popover",[Kt]=fs(He,[Mt]),Be=Mt(),[jn,pe]=Kt(He),Vt=t=>{const{__scopePopover:n,children:s,open:o,defaultOpen:a,onOpenChange:l,modal:u=!1}=t,i=Be(n),x=r.useRef(null),[d,g]=r.useState(!1),[p,v]=gn({prop:o,defaultProp:a??!1,onChange:l,caller:He});return e.jsx(gs,{...i,children:e.jsx(jn,{scope:n,contentId:xe(),triggerRef:x,open:p,onOpenChange:v,onOpenToggle:r.useCallback(()=>v(b=>!b),[v]),hasCustomAnchor:d,onCustomAnchorAdd:r.useCallback(()=>g(!0),[]),onCustomAnchorRemove:r.useCallback(()=>g(!1),[]),modal:u,children:s})})};Vt.displayName=He;var Gt="PopoverAnchor",bn=r.forwardRef((t,n)=>{const{__scopePopover:s,...o}=t,a=pe(Gt,s),l=Be(s),{onCustomAnchorAdd:u,onCustomAnchorRemove:i}=a;return r.useEffect(()=>(u(),()=>i()),[u,i]),e.jsx(Et,{...l,...o,ref:n})});bn.displayName=Gt;var Bt="PopoverTrigger",Ut=r.forwardRef((t,n)=>{const{__scopePopover:s,...o}=t,a=pe(Bt,s),l=Be(s),u=Dt(n,a.triggerRef),i=e.jsx(ne.button,{type:"button","aria-haspopup":"dialog","aria-expanded":a.open,"aria-controls":a.contentId,"data-state":Jt(a.open),...o,ref:u,onClick:ke(t.onClick,a.onOpenToggle)});return a.hasCustomAnchor?i:e.jsx(Et,{asChild:!0,...l,children:i})});Ut.displayName=Bt;var xt="PopoverPortal",[yn,Nn]=Kt(xt,{forceMount:void 0}),Qt=t=>{const{__scopePopover:n,forceMount:s,children:o,container:a}=t,l=pe(xt,n);return e.jsx(yn,{scope:n,forceMount:s,children:e.jsx(Pt,{present:s||l.open,children:e.jsx(vs,{asChild:!0,container:a,children:o})})})};Qt.displayName=xt;var Ce="PopoverContent",Ht=r.forwardRef((t,n)=>{const s=Nn(Ce,t.__scopePopover),{forceMount:o=s.forceMount,...a}=t,l=pe(Ce,t.__scopePopover);return e.jsx(Pt,{present:o||l.open,children:l.modal?e.jsx(Cn,{...a,ref:n}):e.jsx(Sn,{...a,ref:n})})});Ht.displayName=Ce;var wn=cn("PopoverContent.RemoveScroll"),Cn=r.forwardRef((t,n)=>{const s=pe(Ce,t.__scopePopover),o=r.useRef(null),a=Dt(n,o),l=r.useRef(!1);return r.useEffect(()=>{const u=o.current;if(u)return Ms(u)},[]),e.jsx(Ds,{as:wn,allowPinchZoom:!0,children:e.jsx(Wt,{...t,ref:a,trapFocus:s.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:ke(t.onCloseAutoFocus,u=>{u.preventDefault(),l.current||s.triggerRef.current?.focus()}),onPointerDownOutside:ke(t.onPointerDownOutside,u=>{const i=u.detail.originalEvent,x=i.button===0&&i.ctrlKey===!0,d=i.button===2||x;l.current=d},{checkForDefaultPrevented:!1}),onFocusOutside:ke(t.onFocusOutside,u=>u.preventDefault(),{checkForDefaultPrevented:!1})})})}),Sn=r.forwardRef((t,n)=>{const s=pe(Ce,t.__scopePopover),o=r.useRef(!1),a=r.useRef(!1);return e.jsx(Wt,{...t,ref:n,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:l=>{t.onCloseAutoFocus?.(l),l.defaultPrevented||(o.current||s.triggerRef.current?.focus(),l.preventDefault()),o.current=!1,a.current=!1},onInteractOutside:l=>{t.onInteractOutside?.(l),l.defaultPrevented||(o.current=!0,l.detail.originalEvent.type==="pointerdown"&&(a.current=!0));const u=l.target;s.triggerRef.current?.contains(u)&&l.preventDefault(),l.detail.originalEvent.type==="focusin"&&a.current&&l.preventDefault()}})}),Wt=r.forwardRef((t,n)=>{const{__scopePopover:s,trapFocus:o,onOpenAutoFocus:a,onCloseAutoFocus:l,disableOutsidePointerEvents:u,onEscapeKeyDown:i,onPointerDownOutside:x,onFocusOutside:d,onInteractOutside:g,...p}=t,v=pe(Ce,s),b=Be(s);return Es(),e.jsx(Ps,{asChild:!0,loop:!0,trapped:o,onMountAutoFocus:a,onUnmountAutoFocus:l,children:e.jsx(js,{asChild:!0,disableOutsidePointerEvents:u,onInteractOutside:g,onEscapeKeyDown:i,onPointerDownOutside:x,onFocusOutside:d,onDismiss:()=>v.onOpenChange(!1),children:e.jsx(bs,{"data-state":Jt(v.open),role:"dialog",id:v.contentId,...b,...p,ref:n,style:{...p.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}})})})}),Yt="PopoverClose",_n=r.forwardRef((t,n)=>{const{__scopePopover:s,...o}=t,a=pe(Yt,s);return e.jsx(ne.button,{type:"button",...o,ref:n,onClick:ke(t.onClick,()=>a.onOpenChange(!1))})});_n.displayName=Yt;var kn="PopoverArrow",An=r.forwardRef((t,n)=>{const{__scopePopover:s,...o}=t,a=Be(s);return e.jsx(ys,{...a,...o,ref:n})});An.displayName=kn;function Jt(t){return t?"open":"closed"}var Mn=Vt,Dn=Ut,En=Qt,Xt=Ht;const Pn=Mn,Rn=Dn,Zt=r.forwardRef(({className:t,align:n="center",sideOffset:s=4,...o},a)=>e.jsx(En,{children:e.jsx(Xt,{ref:a,align:n,sideOffset:s,className:ce("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-popover-content-transform-origin]",t),...o})}));Zt.displayName=Xt.displayName;var Nt=1,Fn=.9,Tn=.8,$n=.17,Ye=.1,Je=.999,On=.9999,In=.99,qn=/[\\\/_+.#"@\[\(\{&]/,zn=/[\\\/_+.#"@\[\(\{&]/g,Ln=/[\s-]/,es=/[\s-]/g;function at(t,n,s,o,a,l,u){if(l===n.length)return a===t.length?Nt:In;var i=`${a},${l}`;if(u[i]!==void 0)return u[i];for(var x=o.charAt(l),d=s.indexOf(x,a),g=0,p,v,b,c;d>=0;)p=at(t,n,s,o,d+1,l+1,u),p>g&&(d===a?p*=Nt:qn.test(t.charAt(d-1))?(p*=Tn,b=t.slice(a,d-1).match(zn),b&&a>0&&(p*=Math.pow(Je,b.length))):Ln.test(t.charAt(d-1))?(p*=Fn,c=t.slice(a,d-1).match(es),c&&a>0&&(p*=Math.pow(Je,c.length))):(p*=$n,a>0&&(p*=Math.pow(Je,d-a))),t.charAt(d)!==n.charAt(l)&&(p*=On)),(p<Ye&&s.charAt(d-1)===o.charAt(l+1)||o.charAt(l+1)===o.charAt(l)&&s.charAt(d-1)!==o.charAt(l))&&(v=at(t,n,s,o,d+1,l+2,u),v*Ye>p&&(p=v*Ye)),p>g&&(g=p),d=s.indexOf(x,d+1);return u[i]=g,g}function wt(t){return t.toLowerCase().replace(es," ")}function Kn(t,n,s){return t=s&&s.length>0?`${t+" "+s.join(" ")}`:t,at(t,n,wt(t),wt(n),0,0,{})}var _e='[cmdk-group=""]',Xe='[cmdk-group-items=""]',Vn='[cmdk-group-heading=""]',ts='[cmdk-item=""]',Ct=`${ts}:not([aria-disabled="true"])`,ot="cmdk-item-select",je="data-value",Gn=(t,n,s)=>Kn(t,n,s),ss=r.createContext(void 0),Ue=()=>r.useContext(ss),ns=r.createContext(void 0),gt=()=>r.useContext(ns),rs=r.createContext(void 0),as=r.forwardRef((t,n)=>{let s=be(()=>{var h,C;return{search:"",value:(C=(h=t.value)!=null?h:t.defaultValue)!=null?C:"",selectedItemId:void 0,filtered:{count:0,items:new Map,groups:new Set}}}),o=be(()=>new Set),a=be(()=>new Map),l=be(()=>new Map),u=be(()=>new Set),i=os(t),{label:x,children:d,value:g,onValueChange:p,filter:v,shouldFilter:b,loop:c,disablePointerSelection:y=!1,vimBindings:A=!0,...N}=t,j=xe(),K=xe(),q=xe(),D=r.useRef(null),E=tr();fe(()=>{if(g!==void 0){let h=g.trim();s.current.value=h,T.emit()}},[g]),fe(()=>{E(6,V)},[]);let T=r.useMemo(()=>({subscribe:h=>(u.current.add(h),()=>u.current.delete(h)),snapshot:()=>s.current,setState:(h,C,R)=>{var S,z,F,U;if(!Object.is(s.current[h],C)){if(s.current[h]=C,h==="search")B(),P(),E(1,$);else if(h==="value"){if(document.activeElement.hasAttribute("cmdk-input")||document.activeElement.hasAttribute("cmdk-root")){let Y=document.getElementById(q);Y?Y.focus():(S=document.getElementById(j))==null||S.focus()}if(E(7,()=>{var Y;s.current.selectedItemId=(Y=w())==null?void 0:Y.id,T.emit()}),R||E(5,V),((z=i.current)==null?void 0:z.value)!==void 0){let Y=C??"";(U=(F=i.current).onValueChange)==null||U.call(F,Y);return}}T.emit()}},emit:()=>{u.current.forEach(h=>h())}}),[]),_=r.useMemo(()=>({value:(h,C,R)=>{var S;C!==((S=l.current.get(h))==null?void 0:S.value)&&(l.current.set(h,{value:C,keywords:R}),s.current.filtered.items.set(h,m(C,R)),E(2,()=>{P(),T.emit()}))},item:(h,C)=>(o.current.add(h),C&&(a.current.has(C)?a.current.get(C).add(h):a.current.set(C,new Set([h]))),E(3,()=>{B(),P(),s.current.value||$(),T.emit()}),()=>{l.current.delete(h),o.current.delete(h),s.current.filtered.items.delete(h);let R=w();E(4,()=>{B(),R?.getAttribute("id")===h&&$(),T.emit()})}),group:h=>(a.current.has(h)||a.current.set(h,new Set),()=>{l.current.delete(h),a.current.delete(h)}),filter:()=>i.current.shouldFilter,label:x||t["aria-label"],getDisablePointerSelection:()=>i.current.disablePointerSelection,listId:j,inputId:q,labelId:K,listInnerRef:D}),[]);function m(h,C){var R,S;let z=(S=(R=i.current)==null?void 0:R.filter)!=null?S:Gn;return h?z(h,s.current.search,C):0}function P(){if(!s.current.search||i.current.shouldFilter===!1)return;let h=s.current.filtered.items,C=[];s.current.filtered.groups.forEach(S=>{let z=a.current.get(S),F=0;z.forEach(U=>{let Y=h.get(U);F=Math.max(Y,F)}),C.push([S,F])});let R=D.current;f().sort((S,z)=>{var F,U;let Y=S.getAttribute("id"),he=z.getAttribute("id");return((F=h.get(he))!=null?F:0)-((U=h.get(Y))!=null?U:0)}).forEach(S=>{let z=S.closest(Xe);z?z.appendChild(S.parentElement===z?S:S.closest(`${Xe} > *`)):R.appendChild(S.parentElement===R?S:S.closest(`${Xe} > *`))}),C.sort((S,z)=>z[1]-S[1]).forEach(S=>{var z;let F=(z=D.current)==null?void 0:z.querySelector(`${_e}[${je}="${encodeURIComponent(S[0])}"]`);F?.parentElement.appendChild(F)})}function $(){let h=f().find(R=>R.getAttribute("aria-disabled")!=="true"),C=h?.getAttribute(je);T.setState("value",C||void 0)}function B(){var h,C,R,S;if(!s.current.search||i.current.shouldFilter===!1){s.current.filtered.count=o.current.size;return}s.current.filtered.groups=new Set;let z=0;for(let F of o.current){let U=(C=(h=l.current.get(F))==null?void 0:h.value)!=null?C:"",Y=(S=(R=l.current.get(F))==null?void 0:R.keywords)!=null?S:[],he=m(U,Y);s.current.filtered.items.set(F,he),he>0&&z++}for(let[F,U]of a.current)for(let Y of U)if(s.current.filtered.items.get(Y)>0){s.current.filtered.groups.add(F);break}s.current.filtered.count=z}function V(){var h,C,R;let S=w();S&&(((h=S.parentElement)==null?void 0:h.firstChild)===S&&((R=(C=S.closest(_e))==null?void 0:C.querySelector(Vn))==null||R.scrollIntoView({block:"nearest"})),S.scrollIntoView({block:"nearest"}))}function w(){var h;return(h=D.current)==null?void 0:h.querySelector(`${ts}[aria-selected="true"]`)}function f(){var h;return Array.from(((h=D.current)==null?void 0:h.querySelectorAll(Ct))||[])}function M(h){let C=f()[h];C&&T.setState("value",C.getAttribute(je))}function O(h){var C;let R=w(),S=f(),z=S.findIndex(U=>U===R),F=S[z+h];(C=i.current)!=null&&C.loop&&(F=z+h<0?S[S.length-1]:z+h===S.length?S[0]:S[z+h]),F&&T.setState("value",F.getAttribute(je))}function G(h){let C=w(),R=C?.closest(_e),S;for(;R&&!S;)R=h>0?Zn(R,_e):er(R,_e),S=R?.querySelector(Ct);S?T.setState("value",S.getAttribute(je)):O(h)}let J=()=>M(f().length-1),k=h=>{h.preventDefault(),h.metaKey?J():h.altKey?G(1):O(1)},W=h=>{h.preventDefault(),h.metaKey?M(0):h.altKey?G(-1):O(-1)};return r.createElement(ne.div,{ref:n,tabIndex:-1,...N,"cmdk-root":"",onKeyDown:h=>{var C;(C=N.onKeyDown)==null||C.call(N,h);let R=h.nativeEvent.isComposing||h.keyCode===229;if(!(h.defaultPrevented||R))switch(h.key){case"n":case"j":{A&&h.ctrlKey&&k(h);break}case"ArrowDown":{k(h);break}case"p":case"k":{A&&h.ctrlKey&&W(h);break}case"ArrowUp":{W(h);break}case"Home":{h.preventDefault(),M(0);break}case"End":{h.preventDefault(),J();break}case"Enter":{h.preventDefault();let S=w();if(S){let z=new Event(ot);S.dispatchEvent(z)}}}}},r.createElement("label",{"cmdk-label":"",htmlFor:_.inputId,id:_.labelId,style:nr},x),We(t,h=>r.createElement(ns.Provider,{value:T},r.createElement(ss.Provider,{value:_},h))))}),Bn=r.forwardRef((t,n)=>{var s,o;let a=xe(),l=r.useRef(null),u=r.useContext(rs),i=Ue(),x=os(t),d=(o=(s=x.current)==null?void 0:s.forceMount)!=null?o:u?.forceMount;fe(()=>{if(!d)return i.item(a,u?.id)},[d]);let g=is(a,l,[t.value,t.children,l],t.keywords),p=gt(),v=ue(E=>E.value&&E.value===g.current),b=ue(E=>d||i.filter()===!1?!0:E.search?E.filtered.items.get(a)>0:!0);r.useEffect(()=>{let E=l.current;if(!(!E||t.disabled))return E.addEventListener(ot,c),()=>E.removeEventListener(ot,c)},[b,t.onSelect,t.disabled]);function c(){var E,T;y(),(T=(E=x.current).onSelect)==null||T.call(E,g.current)}function y(){p.setState("value",g.current,!0)}if(!b)return null;let{disabled:A,value:N,onSelect:j,forceMount:K,keywords:q,...D}=t;return r.createElement(ne.div,{ref:Ne(l,n),...D,id:a,"cmdk-item":"",role:"option","aria-disabled":!!A,"aria-selected":!!v,"data-disabled":!!A,"data-selected":!!v,onPointerMove:A||i.getDisablePointerSelection()?void 0:y,onClick:A?void 0:c},t.children)}),Un=r.forwardRef((t,n)=>{let{heading:s,children:o,forceMount:a,...l}=t,u=xe(),i=r.useRef(null),x=r.useRef(null),d=xe(),g=Ue(),p=ue(b=>a||g.filter()===!1?!0:b.search?b.filtered.groups.has(u):!0);fe(()=>g.group(u),[]),is(u,i,[t.value,t.heading,x]);let v=r.useMemo(()=>({id:u,forceMount:a}),[a]);return r.createElement(ne.div,{ref:Ne(i,n),...l,"cmdk-group":"",role:"presentation",hidden:p?void 0:!0},s&&r.createElement("div",{ref:x,"cmdk-group-heading":"","aria-hidden":!0,id:d},s),We(t,b=>r.createElement("div",{"cmdk-group-items":"",role:"group","aria-labelledby":s?d:void 0},r.createElement(rs.Provider,{value:v},b))))}),Qn=r.forwardRef((t,n)=>{let{alwaysRender:s,...o}=t,a=r.useRef(null),l=ue(u=>!u.search);return!s&&!l?null:r.createElement(ne.div,{ref:Ne(a,n),...o,"cmdk-separator":"",role:"separator"})}),Hn=r.forwardRef((t,n)=>{let{onValueChange:s,...o}=t,a=t.value!=null,l=gt(),u=ue(d=>d.search),i=ue(d=>d.selectedItemId),x=Ue();return r.useEffect(()=>{t.value!=null&&l.setState("search",t.value)},[t.value]),r.createElement(ne.input,{ref:n,...o,"cmdk-input":"",autoComplete:"off",autoCorrect:"off",spellCheck:!1,"aria-autocomplete":"list",role:"combobox","aria-expanded":!0,"aria-controls":x.listId,"aria-labelledby":x.labelId,"aria-activedescendant":i,id:x.inputId,type:"text",value:a?t.value:u,onChange:d=>{a||l.setState("search",d.target.value),s?.(d.target.value)}})}),Wn=r.forwardRef((t,n)=>{let{children:s,label:o="Suggestions",...a}=t,l=r.useRef(null),u=r.useRef(null),i=ue(d=>d.selectedItemId),x=Ue();return r.useEffect(()=>{if(u.current&&l.current){let d=u.current,g=l.current,p,v=new ResizeObserver(()=>{p=requestAnimationFrame(()=>{let b=d.offsetHeight;g.style.setProperty("--cmdk-list-height",b.toFixed(1)+"px")})});return v.observe(d),()=>{cancelAnimationFrame(p),v.unobserve(d)}}},[]),r.createElement(ne.div,{ref:Ne(l,n),...a,"cmdk-list":"",role:"listbox",tabIndex:-1,"aria-activedescendant":i,"aria-label":o,id:x.listId},We(t,d=>r.createElement("div",{ref:Ne(u,x.listInnerRef),"cmdk-list-sizer":""},d)))}),Yn=r.forwardRef((t,n)=>{let{open:s,onOpenChange:o,overlayClassName:a,contentClassName:l,container:u,...i}=t;return r.createElement(Rs,{open:s,onOpenChange:o},r.createElement(Fs,{container:u},r.createElement(Ts,{"cmdk-overlay":"",className:a}),r.createElement($s,{"aria-label":t.label,"cmdk-dialog":"",className:l},r.createElement(as,{ref:n,...i}))))}),Jn=r.forwardRef((t,n)=>ue(s=>s.filtered.count===0)?r.createElement(ne.div,{ref:n,...t,"cmdk-empty":"",role:"presentation"}):null),Xn=r.forwardRef((t,n)=>{let{progress:s,children:o,label:a="Loading...",...l}=t;return r.createElement(ne.div,{ref:n,...l,"cmdk-loading":"",role:"progressbar","aria-valuenow":s,"aria-valuemin":0,"aria-valuemax":100,"aria-label":a},We(t,u=>r.createElement("div",{"aria-hidden":!0},u)))}),ee=Object.assign(as,{List:Wn,Item:Bn,Input:Hn,Group:Un,Separator:Qn,Dialog:Yn,Empty:Jn,Loading:Xn});function Zn(t,n){let s=t.nextElementSibling;for(;s;){if(s.matches(n))return s;s=s.nextElementSibling}}function er(t,n){let s=t.previousElementSibling;for(;s;){if(s.matches(n))return s;s=s.previousElementSibling}}function os(t){let n=r.useRef(t);return fe(()=>{n.current=t}),n}var fe=typeof window>"u"?r.useEffect:r.useLayoutEffect;function be(t){let n=r.useRef();return n.current===void 0&&(n.current=t()),n}function ue(t){let n=gt(),s=()=>t(n.snapshot());return r.useSyncExternalStore(n.subscribe,s,s)}function is(t,n,s,o=[]){let a=r.useRef(),l=Ue();return fe(()=>{var u;let i=(()=>{var d;for(let g of s){if(typeof g=="string")return g.trim();if(typeof g=="object"&&"current"in g)return g.current?(d=g.current.textContent)==null?void 0:d.trim():a.current}})(),x=o.map(d=>d.trim());l.value(t,i,x),(u=n.current)==null||u.setAttribute(je,i),a.current=i}),a}var tr=()=>{let[t,n]=r.useState(),s=be(()=>new Map);return fe(()=>{s.current.forEach(o=>o()),s.current=new Map},[t]),(o,a)=>{s.current.set(o,a),n({})}};function sr(t){let n=t.type;return typeof n=="function"?n(t.props):"render"in n?n.render(t.props):t}function We({asChild:t,children:n},s){return t&&r.isValidElement(n)?r.cloneElement(sr(n),{ref:n.ref},s(n.props.children)):s(n)}var nr={position:"absolute",width:"1px",height:"1px",padding:"0",margin:"-1px",overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",borderWidth:"0"};const ls=r.forwardRef(({className:t,...n},s)=>e.jsx(ee,{ref:s,className:ce("flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground",t),...n}));ls.displayName=ee.displayName;const cs=r.forwardRef(({className:t,...n},s)=>e.jsxs("div",{className:"flex items-center border-b px-3","cmdk-input-wrapper":"",children:[e.jsx(Os,{className:"mr-2 h-4 w-4 shrink-0 opacity-50"}),e.jsx(ee.Input,{ref:s,className:ce("flex h-10 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50",t),...n})]}));cs.displayName=ee.Input.displayName;const ds=r.forwardRef(({className:t,...n},s)=>e.jsx(ee.List,{ref:s,className:ce("max-h-[300px] overflow-y-auto overflow-x-hidden",t),...n}));ds.displayName=ee.List.displayName;const us=r.forwardRef((t,n)=>e.jsx(ee.Empty,{ref:n,className:"py-6 text-center text-sm",...t}));us.displayName=ee.Empty.displayName;const it=r.forwardRef(({className:t,...n},s)=>e.jsx(ee.Group,{ref:s,className:ce("overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground",t),...n}));it.displayName=ee.Group.displayName;const rr=r.forwardRef(({className:t,...n},s)=>e.jsx(ee.Separator,{ref:s,className:ce("-mx-1 h-px bg-border",t),...n}));rr.displayName=ee.Separator.displayName;const lt=r.forwardRef(({className:t,...n},s)=>e.jsx(ee.Item,{ref:s,className:ce("relative flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected=true]:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",t),...n}));lt.displayName=ee.Item.displayName;const ar=({onBack:t,athletes:n,groups:s,athletesLoading:o})=>{const{toast:a}=se(),[l,u]=r.useState(""),[i,x]=r.useState(new Set),[d,g]=r.useState(new Set),[p,v]=r.useState(!1),{data:b}=Q({queryKey:["athlete-phones"],queryFn:async()=>{const{data:m}=await ct.from("user_profiles").select("user_id, phone").not("phone","is",null);return new Map((m??[]).map(P=>[P.user_id,P.phone]))}}),c=r.useMemo(()=>n.filter(m=>m.id!=null).map(m=>({id:m.id,display_name:m.display_name,group_id:m.group_id??null,group_label:m.group_label??null})),[n]),y=m=>{x(P=>{const $=new Set(P);return $.has(m)?$.delete(m):$.add(m),$})},A=m=>{g(P=>{const $=new Set(P);return $.has(m)?$.delete(m):$.add(m),$})},N=()=>{x(new Set),g(new Set)},{selectedPhones:j,selectedTotal:K,missingCount:q}=r.useMemo(()=>{if(!b)return{selectedPhones:[],selectedTotal:0,missingCount:0};const m=new Set;for(const B of i)for(const V of c)V.group_id===B&&m.add(V.id);for(const B of d)m.add(B);const P=m.size,$=[];for(const B of m){const V=b.get(B);V&&V.trim().length>0&&$.push(V)}return{selectedPhones:$,selectedTotal:P,missingCount:P-$.length}},[i,d,c,b]),D=i.size+d.size,E=r.useMemo(()=>{const m=[];return i.size>0&&m.push(`${i.size} groupe${i.size>1?"s":""}`),d.size>0&&m.push(`${d.size} nageur${d.size>1?"s":""}`),m.join(", ")},[i.size,d.size]),T=()=>{if(j.length===0){a({title:"Aucun numéro",description:"Aucun nageur avec un numéro de téléphone dans cette sélection.",variant:"destructive"});return}if(/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)){const P=l.trim()?encodeURIComponent(l.trim()):"",$=/iPhone|iPad|iPod/i.test(navigator.userAgent);let B;if($){const V=j.join(",");B=P?`sms:/open?addresses=${V}&body=${P}`:`sms:/open?addresses=${V}`}else B=P?`sms:${j.join(",")}?body=${P}`:`sms:${j.join(",")}`;window.location.href=B}else navigator.clipboard.writeText(j.join(", ")).then(()=>{a({title:"Numéros copiés",description:`${j.length} numéro${j.length>1?"s":""} copié${j.length>1?"s":""} dans le presse-papiers.`})}).catch(()=>{a({title:"Erreur",description:"Impossible de copier les numéros.",variant:"destructive"})})},_=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent);return e.jsxs("div",{className:"space-y-6 pb-24",children:[e.jsx(le,{title:"Envoyer un SMS",description:"Ouvre votre application SMS ou copie les numéros.",onBack:t}),e.jsxs(Ae,{className:"border-l-4 border-l-primary",children:[e.jsxs(Me,{children:[e.jsx(De,{children:"Destinataires"}),e.jsx(Ee,{children:"Sélectionnez des groupes et/ou des nageurs."})]}),e.jsxs(Pe,{className:"space-y-3",children:[e.jsx(H,{children:"Destinataires"}),e.jsxs(Pn,{open:p,onOpenChange:v,children:[e.jsx(Rn,{asChild:!0,children:e.jsxs(L,{variant:"outline",role:"combobox","aria-expanded":p,className:"w-full justify-between font-normal",children:[e.jsx("span",{className:"truncate",children:D>0?E:o?"Chargement...":"Choisir des destinataires"}),e.jsx(Xs,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),e.jsx(Zt,{className:"w-[var(--radix-popover-trigger-width)] p-0",align:"start",children:e.jsxs(ls,{children:[e.jsx(cs,{placeholder:"Rechercher..."}),e.jsxs(ds,{children:[e.jsx(us,{children:"Aucun résultat."}),s.length>0&&e.jsx(it,{heading:"Groupes",children:s.map(m=>e.jsxs(lt,{value:`groupe ${m.name}`,onSelect:()=>y(m.id),children:[e.jsx(yt,{className:ce("mr-2 h-4 w-4",i.has(m.id)?"opacity-100":"opacity-0")}),m.name]},`group:${m.id}`))}),c.length>0&&e.jsx(it,{heading:"Nageurs",children:c.map(m=>e.jsxs(lt,{value:`nageur ${m.display_name} ${m.group_label??""}`,onSelect:()=>A(m.id),children:[e.jsx(yt,{className:ce("mr-2 h-4 w-4",d.has(m.id)?"opacity-100":"opacity-0")}),e.jsx("span",{className:"truncate",children:m.display_name}),m.group_label&&e.jsx("span",{className:"ml-auto text-xs text-muted-foreground",children:m.group_label})]},`user:${m.id}`))})]})]})})]}),D>0&&e.jsxs("div",{className:"flex flex-wrap items-center gap-1.5",children:[[...i].map(m=>{const P=s.find($=>$.id===m);return P?e.jsxs(te,{variant:"secondary",className:"gap-1 pr-1",children:[P.name,e.jsx("button",{type:"button",onClick:()=>y(m),className:"ml-0.5 rounded-full p-0.5 hover:bg-muted",children:e.jsx(ft,{className:"h-3 w-3"})})]},`g:${m}`):null}),[...d].map(m=>{const P=c.find($=>$.id===m);return P?e.jsxs(te,{variant:"outline",className:"gap-1 pr-1",children:[P.display_name,e.jsx("button",{type:"button",onClick:()=>A(m),className:"ml-0.5 rounded-full p-0.5 hover:bg-muted",children:e.jsx(ft,{className:"h-3 w-3"})})]},`u:${m}`):null}),D>1&&e.jsx("button",{type:"button",onClick:N,className:"text-xs text-muted-foreground underline hover:text-foreground",children:"Tout effacer"})]}),D>0&&j.length>0&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:[j.length," numéro",j.length>1?"s":""," trouvé",j.length>1?"s":"",q>0&&e.jsxs("span",{className:"text-destructive",children:[" · ",q," sans téléphone"]})]}),D>0&&j.length===0&&e.jsx("p",{className:"text-xs text-destructive",children:"Aucun numéro de téléphone disponible pour cette sélection."})]})]}),e.jsxs(Ae,{children:[e.jsxs(Me,{children:[e.jsx(De,{children:"Message"}),e.jsx(Ee,{children:"Optionnel — pré-rempli dans votre application SMS."})]}),e.jsx(Pe,{children:e.jsx(ut,{value:l,onChange:m=>u(m.target.value),placeholder:"Contenu du SMS…",rows:3})})]}),e.jsx("div",{className:"sticky bottom-0 z-10 -mx-4 border-t bg-background/95 p-4 backdrop-blur sm:static sm:mx-0 sm:border-0 sm:p-0",children:e.jsx(L,{className:"w-full sm:w-auto",onClick:T,disabled:D===0||j.length===0,children:_?e.jsxs(e.Fragment,{children:[e.jsx(ht,{className:"mr-2 h-4 w-4"}),"Ouvrir dans l'app SMS",e.jsx(zt,{className:"ml-2 h-3 w-3"})]}):e.jsxs(e.Fragment,{children:[e.jsx(en,{className:"mr-2 h-4 w-4"}),"Copier les numéros"]})})})]})};function St(t){return String(t).padStart(2,"0")}function ve(t){return`${t.getFullYear()}-${St(t.getMonth()+1)}-${St(t.getDate())}`}function Ze(t){return new Date(t.getFullYear(),t.getMonth(),1)}function _t(t,n){const s=new Date(t);return s.setDate(s.getDate()+n),s}function or(t){return(t.getDay()+6)%7}function et(t){if(!t)return"AM";const n=t.toLowerCase();return n==="evening"||n.includes("soir")||n==="pm"?"PM":"AM"}const ir=[{key:"swim-morning",label:"Nage — Matin",type:"swim",scheduledSlot:"morning"},{key:"swim-evening",label:"Nage — Soir",type:"swim",scheduledSlot:"evening"},{key:"strength",label:"Musculation",type:"strength",scheduledSlot:null}];function lr({groupId:t,userId:n,enabled:s}){const o=r.useMemo(()=>new Date,[]),[a,l]=r.useState(()=>Ze(new Date)),[u,i]=r.useState(()=>ve(new Date)),[x,d]=r.useState(null),[g,p]=r.useState(!1),v=r.useMemo(()=>Ze(a),[a]),b=r.useMemo(()=>{const f=or(v),M=_t(v,-f),O=[];for(let G=0;G<42;G++)O.push(_t(M,G));return O},[v]),c=r.useMemo(()=>{const f=ve(b[0]),M=ve(b[b.length-1]);return{from:f,to:M}},[b]),y=!!(t||n),{data:A=[],isLoading:N}=Q({queryKey:["coach-calendar-assignments",t,n,c.from,c.to],queryFn:()=>I.getCoachAssignments({groupId:t??null,userId:n??null,from:c.from,to:c.to}),enabled:y}),j=r.useMemo(()=>{const f=new Map;for(const M of A){const O=M.scheduledDate?.slice(0,10);O&&(f.has(O)||f.set(O,[]),f.get(O).push(M))}return f},[A]),K=r.useMemo(()=>{const f={};for(const M of b){const O=ve(M),G=j.get(O)??[],J=G.some(C=>et(C.scheduledSlot)==="AM"),k=G.some(C=>et(C.scheduledSlot)==="PM"),W=(J?1:0)+(k?1:0),h=[{slotKey:"AM",expected:J,completed:J,absent:!1},{slotKey:"PM",expected:k,completed:k,absent:!1}];f[O]={completed:W,total:W,slots:h}}return f},[b,j]),q=r.useMemo(()=>{const[f,M,O]=u.split("-").map(Number);return new Date(f,M-1,O)},[u]),D=r.useMemo(()=>j.get(u)??[],[j,u]),E=r.useMemo(()=>{const f=D;return ir.map(M=>{const O=f.filter(k=>M.type!==k.type?!1:M.type==="swim"?et(k.scheduledSlot)===(M.scheduledSlot==="morning"?"AM":"PM"):!0),G=O.find(k=>k.targetType==="user"),J=O.find(k=>k.targetType==="group");return{...M,assignment:G??J??null}})},[D]),{data:T=[]}=Q({queryKey:["planned-absences-coach",n,c.from,c.to],queryFn:()=>I.getPlannedAbsences({userId:n,from:c.from,to:c.to}),enabled:!!n}),_=r.useMemo(()=>new Set(T.map(f=>f.date)),[T]),m=r.useMemo(()=>{const f={};for(const M of b){const O=ve(M),G=j.get(O)??[];f[O]=G.some(J=>J.type==="strength")}return f},[b,j]),P=K[u]??{completed:0,total:0,slots:[{slotKey:"AM",expected:!1,completed:!1,absent:!1},{slotKey:"PM",expected:!1,completed:!1,absent:!1}]},$=r.useCallback(()=>{l(f=>new Date(f.getFullYear(),f.getMonth()-1,1))},[]),B=r.useCallback(()=>{l(f=>new Date(f.getFullYear(),f.getMonth()+1,1))},[]),V=r.useCallback(()=>{l(Ze(new Date)),i(ve(new Date))},[]),w=r.useCallback(f=>{i(f),p(!0)},[]);return{today:o,monthCursor:a,selectedISO:u,selectedDayIndex:x,drawerOpen:g,gridDates:b,completionByISO:K,selectedDate:q,selectedDayStatus:P,assignmentsForSelectedDay:D,slotsForSelectedDay:E,hasStrengthByISO:m,absenceDates:_,isLoading:N,hasFilter:y,setSelectedISO:i,setSelectedDayIndex:d,setDrawerOpen:p,prevMonth:$,nextMonth:B,jumpToday:V,openDay:w}}function cr(t){const[n,s,o]=t.split("-").map(Number);return new Date(n,s-1,o).toLocaleDateString("fr-FR",{weekday:"long",day:"numeric",month:"long"})}function dr({onBack:t,athletes:n,groups:s,swimSessions:o,strengthSessions:a}){const[l,u]=r.useState("group"),[i,x]=r.useState(""),[d,g]=r.useState(""),p=l==="group"&&i?Number(i):null,v=l==="user"&&d?Number(d):null,{today:b,monthCursor:c,selectedISO:y,selectedDayIndex:A,drawerOpen:N,gridDates:j,completionByISO:K,selectedDayStatus:q,slotsForSelectedDay:D,hasStrengthByISO:E,absenceDates:T,hasFilter:_,setSelectedISO:m,setSelectedDayIndex:P,setDrawerOpen:$,prevMonth:B,nextMonth:V,jumpToday:w,openDay:f}=lr({groupId:p,userId:v,enabled:!0}),M=Se(),O=X({mutationFn:k=>I.assignments_create(k),onSuccess:()=>{M.invalidateQueries({queryKey:["coach-calendar-assignments"]})}}),G=X({mutationFn:k=>I.assignments_delete(k),onSuccess:()=>{M.invalidateQueries({queryKey:["coach-calendar-assignments"]})}}),J=(k,W)=>{let h=W;if(k.key==="ArrowLeft"&&(h=Math.max(0,W-1)),k.key==="ArrowRight"&&(h=Math.min(j.length-1,W+1)),k.key==="ArrowUp"&&(h=Math.max(0,W-7)),k.key==="ArrowDown"&&(h=Math.min(j.length-1,W+7)),h!==W){k.preventDefault(),P(h);const C=z=>String(z).padStart(2,"0"),R=j[h],S=`${R.getFullYear()}-${C(R.getMonth()+1)}-${C(R.getDate())}`;m(S)}if(k.key==="Enter"||k.key===" "){k.preventDefault();const C=z=>String(z).padStart(2,"0"),R=j[W],S=`${R.getFullYear()}-${C(R.getMonth()+1)}-${C(R.getDate())}`;f(S)}};return e.jsxs("div",{className:"space-y-4",children:[e.jsx(le,{title:"Calendrier",description:"Vue mensuelle des assignations",onBack:t}),e.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center",children:[e.jsxs(dt,{type:"single",value:l,onValueChange:k=>{(k==="group"||k==="user")&&u(k)},className:"shrink-0",children:[e.jsx(de,{value:"group",className:"text-xs px-3",children:"Groupe"}),e.jsx(de,{value:"user",className:"text-xs px-3",children:"Nageur"})]}),l==="group"?e.jsxs(re,{value:i,onValueChange:x,children:[e.jsx(ae,{className:"w-full sm:w-56",children:e.jsx(oe,{placeholder:"Choisir un groupe"})}),e.jsx(ie,{children:s.map(k=>e.jsx(Z,{value:String(k.id),children:k.name},String(k.id)))})]}):e.jsxs(re,{value:d,onValueChange:g,children:[e.jsx(ae,{className:"w-full sm:w-56",children:e.jsx(oe,{placeholder:"Choisir un nageur"})}),e.jsx(ie,{children:n.filter(k=>k.id!=null).map(k=>e.jsxs(Z,{value:String(k.id),children:[k.display_name,k.group_label?` · ${k.group_label}`:""]},String(k.id)))})]})]}),_?e.jsxs("div",{className:"rounded-2xl border bg-card shadow-sm",children:[e.jsx(Is,{monthCursor:c,selectedDayStatus:q,onPrevMonth:B,onNextMonth:V,onJumpToday:w}),e.jsx(qs,{monthCursor:c,gridDates:j,completionByISO:K,strengthByISO:E,absenceDates:T,selectedISO:y,selectedDayIndex:A,today:b,onDayClick:f,onKeyDown:J})]}):e.jsx("div",{className:"py-12 text-center text-sm text-muted-foreground",children:"Sélectionnez un groupe ou un nageur pour afficher le calendrier."}),e.jsx(Le,{open:N,onOpenChange:$,children:e.jsxs(Ke,{side:"bottom",className:"max-h-[70vh] overflow-y-auto rounded-t-2xl",children:[e.jsxs(Ve,{className:"pb-3",children:[e.jsx(Ge,{className:"capitalize text-left",children:cr(y)}),e.jsx(mt,{className:"sr-only",children:"Gérer les assignations pour cette journée"})]}),e.jsxs("div",{className:"space-y-3",children:[T.has(y)&&e.jsx("div",{className:"rounded-xl border border-red-200 bg-red-50 dark:bg-red-950/20 dark:border-red-900/40 px-3 py-2 flex items-center gap-2",children:e.jsx("span",{className:"text-[10px] font-bold text-red-500 uppercase tracking-wide",children:"Absence prévue"})}),D.map(k=>{const W=k.assignment?.targetType==="group",h=l==="user";return e.jsx(ur,{slot:k,swimSessions:o,strengthSessions:a,isGroupAssignment:W&&h,onAssign:C=>{O.mutate({assignment_type:k.type,session_id:C,scheduled_date:y,scheduled_slot:k.scheduledSlot??void 0,target_group_id:p,target_user_id:v})},onDelete:C=>{G.mutate(C)},onReplace:(C,R)=>{W&&h?O.mutate({assignment_type:k.type,session_id:R,scheduled_date:y,scheduled_slot:k.scheduledSlot??void 0,target_user_id:v}):G.mutate(C,{onSuccess:()=>{O.mutate({assignment_type:k.type,session_id:R,scheduled_date:y,scheduled_slot:k.scheduledSlot??void 0,target_group_id:p,target_user_id:v})}})},isPending:O.isPending||G.isPending},k.key)})]})]})})]})}function ur({slot:t,swimSessions:n,strengthSessions:s,isGroupAssignment:o,onAssign:a,onDelete:l,onReplace:u,isPending:i}){const[x,d]=r.useState(!1),g=t.type==="swim",p=g?(n??[]).map(c=>({id:c.id,label:c.name})):(s??[]).map(c=>({id:c.id,label:c.title})),v=t.assignment!==null,b=c=>{const y=Number(c);y&&(v&&x?(u(t.assignment.id,y),d(!1)):a(y))};return e.jsxs("div",{className:"rounded-xl border p-3 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[g?e.jsx(Rt,{className:"h-4 w-4 text-blue-500 shrink-0"}):e.jsx(Ft,{className:"h-4 w-4 text-orange-500 shrink-0"}),e.jsx("span",{className:"text-xs font-semibold text-muted-foreground uppercase tracking-wide",children:t.label})]}),v&&!x?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("p",{className:"text-sm font-semibold truncate flex-1",children:[t.assignment.title,o&&e.jsx("span",{className:"ml-1.5 text-[10px] font-medium text-muted-foreground bg-muted px-1.5 py-0.5 rounded-full align-middle",children:"Groupe"})]}),e.jsx(L,{type:"button",size:"icon",variant:"ghost",className:"h-7 w-7 shrink-0",disabled:i,onClick:()=>d(!0),title:o?"Personnaliser":"Changer",children:e.jsx(Ns,{className:"h-3.5 w-3.5"})}),!o&&e.jsx(L,{type:"button",size:"icon",variant:"ghost",className:"h-7 w-7 shrink-0 text-destructive hover:text-destructive",disabled:i,onClick:()=>l(t.assignment.id),title:"Supprimer",children:e.jsx(It,{className:"h-3.5 w-3.5"})})]}):e.jsxs(re,{value:"",onValueChange:b,disabled:i||p.length===0,children:[e.jsx(ae,{className:"h-9 text-xs",children:e.jsx(oe,{placeholder:x?o?"Personnaliser pour ce nageur":"Choisir le remplacement":"Choisir une séance"})}),e.jsx(ie,{children:p.map(c=>e.jsx(Z,{value:String(c.id),children:c.label},c.id))})]}),x?e.jsx("button",{type:"button",className:"text-xs text-muted-foreground hover:text-foreground",onClick:()=>d(!1),children:"Annuler"}):null]})}const ms=({athletes:t,selected:n,onToggle:s,filterToUserIds:o})=>{const[a,l]=r.useState(""),u=r.useMemo(()=>{let x=t.filter(d=>d.id!=null);if(o&&(x=x.filter(d=>o.has(d.id))),a.trim()){const d=a.toLowerCase();x=x.filter(g=>g.display_name.toLowerCase().includes(d))}return x},[t,o,a]),i=r.useMemo(()=>{const x=new Map;for(const d of u){const g=d.group_label||"Sans groupe";x.has(g)||x.set(g,[]),x.get(g).push(d)}return[...x.entries()].sort(([d],[g])=>d.localeCompare(g,"fr"))},[u]);return e.jsxs("div",{className:"space-y-3",children:[e.jsx(ye,{placeholder:"Rechercher un nageur...",value:a,onChange:x=>l(x.target.value)}),e.jsxs("div",{className:"max-h-[50vh] overflow-y-auto space-y-3",children:[i.map(([x,d])=>e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-semibold uppercase tracking-wider text-muted-foreground mb-1.5",children:x}),e.jsx("div",{className:"space-y-1",children:d.map(g=>e.jsxs("label",{className:"flex items-center gap-2.5 rounded-lg border px-3 py-2 cursor-pointer hover:bg-muted/50 transition-colors",children:[e.jsx(qt,{checked:n.has(g.id),onCheckedChange:()=>s(g.id)}),e.jsx("span",{className:"text-sm",children:g.display_name})]},g.id))})]},x)),i.length===0&&e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"Aucun nageur trouvé."})]}),n.size>0&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:[n.size," nageur",n.size>1?"s":""," ","sélectionné",n.size>1?"s":""]})]})},ps=({open:t,onOpenChange:n,athletes:s,parentGroupId:o,parentMembers:a,onCreated:l})=>{const{toast:u}=se(),[i,x]=r.useState(""),[d,g]=r.useState(new Set),p=c=>{g(y=>{const A=new Set(y);return A.has(c)?A.delete(c):A.add(c),A})},v=X({mutationFn:()=>I.createTemporaryGroup({name:i.trim(),member_user_ids:[...d],parent_group_id:o??void 0}),onSuccess:()=>{u({title:"Groupe créé",description:`Le groupe "${i.trim()}" a été créé avec ${d.size} nageur${d.size>1?"s":""}.`}),x(""),g(new Set),n(!1),l()},onError:c=>{u({title:"Erreur",description:c.message,variant:"destructive"})}}),b=()=>{if(!i.trim()){u({title:"Nom requis",description:"Veuillez saisir un nom pour le groupe.",variant:"destructive"});return}v.mutate()};return e.jsx(Le,{open:t,onOpenChange:n,children:e.jsxs(Ke,{side:"right",className:"w-full sm:max-w-md overflow-y-auto",children:[e.jsxs(Ve,{children:[e.jsx(Ge,{children:o?"Créer un sous-groupe":"Créer un groupe"}),e.jsx(mt,{children:o?"Sélectionnez des nageurs du groupe parent pour ce sous-groupe.":"Créez un groupe temporaire (stage, compétition) avec des nageurs de différents groupes."})]}),e.jsxs("div",{className:"mt-6 space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(H,{htmlFor:"group-name",children:"Nom du groupe"}),e.jsx(ye,{id:"group-name",placeholder:"Ex : Stage Pâques 2026",value:i,onChange:c=>x(c.target.value)})]}),e.jsx(Ls,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(H,{children:"Nageurs"}),e.jsx(ms,{athletes:s,selected:d,onToggle:p,filterToUserIds:a??null})]}),e.jsx(L,{className:"w-full",onClick:b,disabled:v.isPending||!i.trim(),children:v.isPending?"Création...":"Créer le groupe"})]})]})})},mr=({open:t,onOpenChange:n,groupId:s,athletes:o,existingMemberIds:a,onAdded:l})=>{const{toast:u}=se(),[i,x]=r.useState(new Set),d=r.useMemo(()=>o.filter(v=>v.id!=null&&!a.has(v.id)),[o,a]),g=v=>{x(b=>{const c=new Set(b);return c.has(v)?c.delete(v):c.add(v),c})},p=X({mutationFn:()=>I.addTemporaryGroupMembers(s,[...i]),onSuccess:()=>{u({title:"Nageurs ajoutés",description:`${i.size} nageur${i.size>1?"s":""} ajouté${i.size>1?"s":""}.`}),x(new Set),n(!1),l()},onError:v=>{u({title:"Erreur",description:v.message,variant:"destructive"})}});return e.jsx(Le,{open:t,onOpenChange:n,children:e.jsxs(Ke,{side:"right",className:"w-full sm:max-w-md overflow-y-auto",children:[e.jsxs(Ve,{children:[e.jsx(Ge,{children:"Ajouter des nageurs"}),e.jsx(mt,{children:"Sélectionnez les nageurs à ajouter au groupe."})]}),e.jsxs("div",{className:"mt-6 space-y-4",children:[e.jsx(ms,{athletes:d,selected:i,onToggle:g}),e.jsx(L,{className:"w-full",onClick:()=>p.mutate(),disabled:p.isPending||i.size===0,children:p.isPending?"Ajout...":`Ajouter ${i.size} nageur${i.size>1?"s":""}`})]})]})})},pr=({groupId:t,athletes:n,onBack:s})=>{const{toast:o}=se(),a=Se(),[l,u]=r.useState(!1),[i,x]=r.useState(!1),[d,g]=r.useState(null),{data:p,isLoading:v}=Q({queryKey:["temp-group-detail",t],queryFn:()=>I.getTemporaryGroupDetail(t)}),b=X({mutationFn:N=>I.removeTemporaryGroupMember(t,N),onSuccess:()=>{o({title:"Nageur retiré"}),a.invalidateQueries({queryKey:["temp-group-detail",t]}),a.invalidateQueries({queryKey:["temp-groups"]})},onError:N=>{o({title:"Erreur",description:N.message,variant:"destructive"})}}),c=()=>{a.invalidateQueries({queryKey:["temp-group-detail",t]}),a.invalidateQueries({queryKey:["temp-groups"]})},y=r.useMemo(()=>new Set((p?.members??[]).map(N=>N.user_id)),[p]),A=r.useMemo(()=>new Set((p?.members??[]).map(N=>N.user_id)),[p]);return v?e.jsxs("div",{className:"space-y-4",children:[e.jsxs(L,{variant:"ghost",size:"sm",className:"-ml-2",onClick:s,children:[e.jsx(Qe,{className:"mr-2 h-4 w-4"}),"Retour aux groupes"]}),e.jsx("div",{className:"space-y-2",children:[1,2,3].map(N=>e.jsx("div",{className:"rounded-xl border p-3 animate-pulse motion-reduce:animate-none",children:e.jsx("div",{className:"h-4 w-32 rounded bg-muted"})},N))})]}):p?e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs(L,{variant:"ghost",size:"sm",className:"-ml-2",onClick:s,children:[e.jsx(Qe,{className:"mr-2 h-4 w-4"}),"Retour aux groupes"]}),e.jsx("h2",{className:"text-2xl font-display font-semibold uppercase italic text-primary",children:p.name}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(te,{variant:p.is_active?"default":"secondary",children:p.is_active?"Actif":"Terminé"}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:[p.members.length," membre",p.members.length!==1?"s":""]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-xs font-semibold uppercase tracking-[0.15em] text-muted-foreground",children:"Membres"}),p.is_active&&e.jsxs(L,{size:"sm",variant:"outline",onClick:()=>u(!0),children:[e.jsx(Bs,{className:"mr-1.5 h-3.5 w-3.5"}),"Ajouter"]})]}),p.members.length===0?e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"Aucun membre dans ce groupe."}):e.jsx("div",{className:"space-y-1.5",children:p.members.map(N=>e.jsxs("div",{className:"flex items-center gap-3 rounded-xl border bg-card p-3",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-sm font-semibold truncate",children:N.display_name}),N.permanent_group_label&&e.jsx(te,{variant:"secondary",className:"text-[10px] px-1.5 py-0 mt-0.5",children:N.permanent_group_label})]}),p.is_active&&e.jsx(L,{size:"icon",variant:"ghost",className:"h-8 w-8 text-muted-foreground hover:text-destructive",onClick:()=>g({userId:N.user_id,name:N.display_name}),title:"Retirer du groupe",children:e.jsx(Us,{className:"h-4 w-4"})})]},N.user_id))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-xs font-semibold uppercase tracking-[0.15em] text-muted-foreground",children:"Sous-groupes"}),p.is_active&&e.jsxs(L,{size:"sm",variant:"outline",onClick:()=>x(!0),children:[e.jsx(ge,{className:"mr-1.5 h-3.5 w-3.5"}),"Sous-groupe"]})]}),p.subgroups.length===0?e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"Aucun sous-groupe."}):e.jsx("div",{className:"space-y-2",children:p.subgroups.map(N=>e.jsxs(Ks,{children:[e.jsxs(Vs,{className:"flex w-full items-center justify-between rounded-xl border bg-card p-3 text-left hover:bg-muted/50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Lt,{className:"h-4 w-4 text-primary"}),e.jsx("span",{className:"text-sm font-semibold",children:N.name}),e.jsx(te,{variant:"secondary",className:"text-[10px] px-1.5 py-0",children:N.members.length})]}),e.jsx(Qs,{className:"h-4 w-4 text-muted-foreground transition-transform [[data-state=open]_&]:rotate-180"})]}),e.jsx(Gs,{children:e.jsxs("div",{className:"ml-4 mt-1 space-y-1",children:[N.members.map(j=>e.jsx("div",{className:"flex items-center gap-2 rounded-lg border px-3 py-2",children:e.jsx("span",{className:"text-sm",children:j.display_name})},j.user_id)),N.members.length===0&&e.jsx("p",{className:"text-xs text-muted-foreground py-2",children:"Aucun membre."})]})})]},N.id))})]}),e.jsx(mr,{open:l,onOpenChange:u,groupId:t,athletes:n,existingMemberIds:y,onAdded:c}),e.jsx(ps,{open:i,onOpenChange:x,athletes:n,parentGroupId:t,parentMembers:A,onCreated:c}),e.jsx(Re,{open:!!d,onOpenChange:N=>{N||g(null)},children:e.jsxs(Fe,{children:[e.jsxs(Te,{children:[e.jsx($e,{children:"Retirer du groupe"}),e.jsxs(Oe,{children:["Voulez-vous retirer ",d?.name," de ce groupe ?",p.subgroups.length>0?" Le nageur sera aussi retiré des sous-groupes.":""]})]}),e.jsxs(Ie,{children:[e.jsx(qe,{children:"Annuler"}),e.jsx(ze,{onClick:()=>{d&&(b.mutate(d.userId),g(null))},className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Retirer"})]})]})})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs(L,{variant:"ghost",size:"sm",className:"-ml-2",onClick:s,children:[e.jsx(Qe,{className:"mr-2 h-4 w-4"}),"Retour aux groupes"]}),e.jsx("p",{className:"text-sm text-muted-foreground text-center py-8",children:"Groupe introuvable."})]})},kt=({group:t,onManage:n,onDeactivate:s,onReactivate:o,onDelete:a})=>{const l=new Date(t.created_at).toLocaleDateString("fr-FR",{day:"numeric",month:"short",year:"numeric"});return e.jsxs("div",{className:"rounded-xl border bg-card p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-sm font-bold truncate",children:t.name}),e.jsxs("div",{className:"flex items-center gap-2 mt-1 flex-wrap",children:[e.jsxs("span",{className:"text-xs text-muted-foreground",children:[t.member_count," membre",t.member_count!==1?"s":""]}),t.subgroup_count>0&&e.jsxs("span",{className:"text-xs text-muted-foreground",children:[t.subgroup_count," sous-groupe",t.subgroup_count!==1?"s":""]}),e.jsx("span",{className:"text-xs text-muted-foreground",children:l})]})]}),e.jsx(te,{variant:t.is_active?"default":"secondary",children:t.is_active?"Actif":"Terminé"})]}),e.jsx("div",{className:"flex items-center gap-2 flex-wrap",children:t.is_active?e.jsxs(e.Fragment,{children:[e.jsxs(L,{size:"sm",variant:"outline",onClick:()=>n(t.id),children:[e.jsx(ws,{className:"mr-1.5 h-3.5 w-3.5"}),"Gérer"]}),e.jsxs(L,{size:"sm",variant:"outline",onClick:()=>s(t.id),children:[e.jsx(zs,{className:"mr-1.5 h-3.5 w-3.5"}),"Terminer"]})]}):e.jsxs(e.Fragment,{children:[e.jsxs(L,{size:"sm",variant:"outline",onClick:()=>o(t.id),children:[e.jsx(Cs,{className:"mr-1.5 h-3.5 w-3.5"}),"Réactiver"]}),e.jsxs(L,{size:"sm",variant:"outline",className:"text-destructive hover:text-destructive",onClick:()=>a(t.id),children:[e.jsx(It,{className:"mr-1.5 h-3.5 w-3.5"}),"Supprimer"]})]})})]})},hr=({onBack:t,athletes:n,athletesLoading:s})=>{const{toast:o}=se(),a=Se(),[l,u]=r.useState("list"),[i,x]=r.useState(null),[d,g]=r.useState(!1),[p,v]=r.useState(null),[b,c]=r.useState(null),{data:y=[],isLoading:A}=Q({queryKey:["temp-groups"],queryFn:()=>I.getTemporaryGroups()}),N=r.useMemo(()=>y.filter(_=>_.is_active),[y]),j=r.useMemo(()=>y.filter(_=>!_.is_active),[y]),K=X({mutationFn:_=>I.deactivateTemporaryGroup(_),onSuccess:()=>{o({title:"Groupe terminé"}),a.invalidateQueries({queryKey:["temp-groups"]})},onError:_=>{o({title:"Erreur",description:_.message,variant:"destructive"})}}),q=X({mutationFn:_=>I.reactivateTemporaryGroup(_),onSuccess:()=>{o({title:"Groupe réactivé"}),a.invalidateQueries({queryKey:["temp-groups"]})},onError:_=>{o({title:"Erreur",description:_.message,variant:"destructive"})}}),D=X({mutationFn:_=>I.deleteTemporaryGroup(_),onSuccess:()=>{o({title:"Groupe supprimé"}),a.invalidateQueries({queryKey:["temp-groups"]})},onError:_=>{o({title:"Erreur",description:_.message,variant:"destructive"})}}),E=_=>{x(_),u("detail")},T=()=>{x(null),u("list"),a.invalidateQueries({queryKey:["temp-groups"]})};return l==="detail"&&i!=null?e.jsx(pr,{groupId:i,athletes:n,onBack:T}):e.jsxs("div",{className:"space-y-6 pb-24",children:[e.jsx(le,{title:"Groupes temporaires",description:"Créez et gérez des groupes pour les stages, compétitions ou événements.",onBack:t,actions:e.jsxs(L,{size:"sm",onClick:()=>g(!0),children:[e.jsx(ge,{className:"mr-1.5 h-3.5 w-3.5"}),"Créer un groupe"]})}),A||s?e.jsx("div",{className:"space-y-2",children:[1,2,3].map(_=>e.jsx("div",{className:"rounded-xl border p-4 animate-pulse motion-reduce:animate-none",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-4 w-40 rounded bg-muted"}),e.jsx("div",{className:"ml-auto h-6 w-16 rounded bg-muted"})]})},_))}):y.length===0?e.jsxs("div",{className:"text-center py-12 space-y-3",children:[e.jsx(we,{className:"h-10 w-10 text-muted-foreground mx-auto"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Aucun groupe temporaire pour le moment."}),e.jsxs(L,{variant:"outline",size:"sm",onClick:()=>g(!0),children:[e.jsx(ge,{className:"mr-1.5 h-3.5 w-3.5"}),"Créer le premier groupe"]})]}):e.jsxs(e.Fragment,{children:[N.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h3",{className:"text-xs font-semibold uppercase tracking-[0.15em] text-muted-foreground",children:["Actifs (",N.length,")"]}),N.map(_=>e.jsx(kt,{group:_,onManage:E,onDeactivate:m=>v(m),onReactivate:m=>q.mutate(m),onDelete:m=>c(m)},_.id))]}),j.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h3",{className:"text-xs font-semibold uppercase tracking-[0.15em] text-muted-foreground",children:["Terminés (",j.length,")"]}),j.map(_=>e.jsx(kt,{group:_,onManage:E,onDeactivate:m=>v(m),onReactivate:m=>q.mutate(m),onDelete:m=>c(m)},_.id))]})]}),e.jsx(ps,{open:d,onOpenChange:g,athletes:n,onCreated:()=>{a.invalidateQueries({queryKey:["temp-groups"]})}}),e.jsx(Re,{open:p!=null,onOpenChange:_=>{_||v(null)},children:e.jsxs(Fe,{children:[e.jsxs(Te,{children:[e.jsx($e,{children:"Terminer le groupe"}),e.jsx(Oe,{children:"Voulez-vous marquer ce groupe comme terminé ? Les sous-groupes seront aussi désactivés. Vous pourrez le réactiver plus tard si nécessaire."})]}),e.jsxs(Ie,{children:[e.jsx(qe,{children:"Annuler"}),e.jsx(ze,{onClick:()=>{p!=null&&(K.mutate(p),v(null))},children:"Terminer"})]})]})}),e.jsx(Re,{open:b!=null,onOpenChange:_=>{_||c(null)},children:e.jsxs(Fe,{children:[e.jsxs(Te,{children:[e.jsx($e,{children:"Supprimer le groupe"}),e.jsx(Oe,{children:"Cette action est irréversible. Le groupe et tous ses sous-groupes seront supprimés définitivement."})]}),e.jsxs(Ie,{children:[e.jsx(qe,{children:"Annuler"}),e.jsx(ze,{onClick:()=>{b!=null&&(D.mutate(b),c(null))},className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Supprimer"})]})]})})]})};function tt(t){return new Date(t+"T00:00:00").toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric"})}function xr(t){const n=new Date;n.setHours(0,0,0,0);const s=new Date(t+"T00:00:00");return Math.ceil((s.getTime()-n.getTime())/(1e3*60*60*24))}const gr=({open:t,onOpenChange:n,competition:s})=>{const{toast:o}=se(),a=Se(),l=!!s,[u,i]=r.useState(""),[x,d]=r.useState(""),[g,p]=r.useState(""),[v,b]=r.useState(!0),[c,y]=r.useState(""),[A,N]=r.useState(""),[j,K]=r.useState(!1),[q,D]=r.useState(new Set),{data:E=[]}=Q({queryKey:["athletes"],queryFn:()=>I.getAthletes()}),{data:T=[]}=Q({queryKey:["groups"],queryFn:()=>I.getGroups()}),{data:_}=Q({queryKey:["competition-assignments",s?.id],queryFn:()=>I.getCompetitionAssignments(s.id),enabled:!!s?.id});r.useEffect(()=>{t&&(s?(i(s.name),d(s.date),p(s.end_date??""),b(!!s.end_date),y(s.location??""),N(s.description??""),_&&D(new Set(_.map(w=>w.athlete_id)))):(i(""),d(""),p(""),b(!0),y(""),N(""),D(new Set)))},[t,s,_]);const m=X({mutationFn:w=>I.createCompetition(w),onSuccess:async w=>{if(q.size>0)try{await I.setCompetitionAssignments(w.id,Array.from(q))}catch(f){console.warn("[EAC] Failed to save competition assignments:",f)}o({title:"Competition creee"}),a.invalidateQueries({queryKey:["competitions"]}),a.invalidateQueries({queryKey:["competition-assignments"]}),n(!1)},onError:w=>{o({title:"Erreur",description:w.message,variant:"destructive"})}}),P=X({mutationFn:w=>I.updateCompetition(s.id,w),onSuccess:async()=>{try{await I.setCompetitionAssignments(s.id,Array.from(q))}catch(w){console.warn("[EAC] Failed to save competition assignments:",w)}o({title:"Competition mise a jour"}),a.invalidateQueries({queryKey:["competitions"]}),a.invalidateQueries({queryKey:["competition-assignments"]}),n(!1)},onError:w=>{o({title:"Erreur",description:w.message,variant:"destructive"})}}),$=X({mutationFn:()=>I.deleteCompetition(s.id),onSuccess:()=>{o({title:"Competition supprimee"}),a.invalidateQueries({queryKey:["competitions"]}),n(!1)},onError:w=>{o({title:"Erreur",description:w.message,variant:"destructive"})}}),B=()=>{if(!u.trim()){o({title:"Nom requis",description:"Veuillez saisir un nom pour la competition.",variant:"destructive"});return}if(!x){o({title:"Date requise",description:"Veuillez saisir une date.",variant:"destructive"});return}const w={name:u.trim(),date:x,end_date:v&&g?g:null,location:c.trim()||null,description:A.trim()||null};l?P.mutate(w):m.mutate(w)},V=m.isPending||P.isPending||$.isPending;return e.jsxs(e.Fragment,{children:[e.jsx(Le,{open:t,onOpenChange:n,children:e.jsxs(Ke,{side:"right",className:"w-full sm:max-w-md overflow-y-auto",children:[e.jsx(Ve,{children:e.jsx(Ge,{children:l?"Modifier la competition":"Nouvelle competition"})}),e.jsxs("div",{className:"mt-6 space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(H,{htmlFor:"comp-name",children:"Nom *"}),e.jsx(ye,{id:"comp-name",placeholder:"Ex : Championnats Regionaux",value:u,onChange:w=>i(w.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(H,{htmlFor:"comp-date",children:"Date *"}),e.jsx("input",{id:"comp-date",type:"date",value:x,onChange:w=>d(w.target.value),className:"flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(H,{htmlFor:"comp-multiday",children:"Multi-jours"}),e.jsx(Hs,{id:"comp-multiday",checked:v,onCheckedChange:b})]}),v&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(H,{htmlFor:"comp-end-date",children:"Date de fin"}),e.jsx("input",{id:"comp-end-date",type:"date",value:g,onChange:w=>p(w.target.value),min:x||void 0,className:"flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(H,{htmlFor:"comp-location",children:"Lieu"}),e.jsx(ye,{id:"comp-location",placeholder:"Ex : Piscine de Strasbourg",value:c,onChange:w=>y(w.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(H,{htmlFor:"comp-description",children:"Description"}),e.jsx(ut,{id:"comp-description",placeholder:"Notes, informations complementaires...",value:A,onChange:w=>N(w.target.value),rows:3})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(we,{className:"h-4 w-4 text-muted-foreground"}),e.jsx(H,{children:"Nageurs assignes"})]}),e.jsxs(re,{value:"",onValueChange:w=>{const f=E.filter(M=>M.group_id===Number(w));D(M=>{const O=new Set(M);return f.forEach(G=>{G.id!=null&&O.add(G.id)}),O})},children:[e.jsx(ae,{children:e.jsx(oe,{placeholder:"Ajouter un groupe..."})}),e.jsx(ie,{children:T.filter(w=>!w.is_temporary).map(w=>e.jsx(Z,{value:String(w.id),children:w.name},w.id))})]}),e.jsx("div",{className:"max-h-48 overflow-y-auto rounded-md border p-2 space-y-1",children:E.map(w=>{if(w.id==null)return null;const f=q.has(w.id);return e.jsxs("label",{className:"flex items-center gap-2 py-1 px-1 rounded hover:bg-muted/50 cursor-pointer",children:[e.jsx(qt,{checked:f,onCheckedChange:M=>{D(O=>{const G=new Set(O);return M?G.add(w.id):G.delete(w.id),G})}}),e.jsx("span",{className:"text-sm",children:w.display_name}),w.group_label&&e.jsx("span",{className:"text-xs text-muted-foreground ml-auto",children:w.group_label})]},w.id)})}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[q.size," nageur",q.size>1?"s":""," assigne",q.size>1?"s":""]})]}),e.jsxs("div",{className:"space-y-2 pt-2",children:[e.jsx(L,{className:"w-full",onClick:B,disabled:V||!u.trim()||!x,children:V?"Enregistrement...":l?"Enregistrer":"Creer"}),l&&e.jsx(L,{variant:"outline",className:"w-full text-destructive hover:text-destructive",onClick:()=>K(!0),disabled:V,children:"Supprimer cette competition"})]})]})]})}),e.jsx(Re,{open:j,onOpenChange:K,children:e.jsxs(Fe,{children:[e.jsxs(Te,{children:[e.jsx($e,{children:"Supprimer la competition"}),e.jsxs(Oe,{children:["Cette action est irreversible. La competition «"," ",s?.name," » sera supprimee definitivement."]})]}),e.jsxs(Ie,{children:[e.jsx(qe,{children:"Annuler"}),e.jsx(ze,{onClick:()=>{$.mutate(),K(!1)},className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Supprimer"})]})]})})]})},fr=({competition:t,onEdit:n,onSendSms:s})=>{const{data:o=[]}=Q({queryKey:["competition-assignments",t.id],queryFn:()=>I.getCompetitionAssignments(t.id)}),a=xr(t.date),l=a<0,u=a>=0,i=t.end_date?`du ${tt(t.date)} au ${tt(t.end_date)}`:tt(t.date);return e.jsxs("button",{type:"button",className:`w-full text-left rounded-xl border bg-card p-3 space-y-1 transition-colors hover:bg-muted/50 ${l?"opacity-60":""}`,onClick:()=>n(t),children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-sm font-semibold truncate",children:t.name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:i})]}),e.jsxs("div",{className:"flex items-center gap-1.5 shrink-0",children:[u&&e.jsxs(te,{variant:"outline",className:"border-orange-300 text-orange-600 dark:text-orange-400 text-[10px] px-1.5 py-0",children:["J-",a]}),l&&e.jsx(te,{variant:"secondary",className:"text-[10px] px-1.5 py-0",children:"Passee"})]})]}),t.location&&e.jsxs("div",{className:"flex items-center gap-1 text-xs text-muted-foreground",children:[e.jsx(Ws,{className:"h-3 w-3 shrink-0"}),e.jsx("span",{className:"truncate",children:t.location})]}),o.length>0&&e.jsxs("div",{className:"flex items-center gap-1 text-xs text-muted-foreground",children:[e.jsx(we,{className:"h-3 w-3 shrink-0"}),e.jsxs("span",{children:[o.length," nageur",o.length>1?"s":""]})]}),o.length>0&&s&&e.jsxs("button",{type:"button",className:"flex items-center gap-1 text-xs text-primary hover:underline",onClick:x=>{x.stopPropagation(),s(t,o)},children:[e.jsx(ht,{className:"h-3 w-3"}),"SMS"]})]})},vr=({onBack:t})=>{const{toast:n}=se(),[s,o]=r.useState(!1),[a,l]=r.useState(null),{data:u=[],isLoading:i}=Q({queryKey:["competitions"],queryFn:()=>I.getCompetitions()}),{data:x}=Q({queryKey:["athlete-phones"],queryFn:async()=>{const{data:c}=await ct.from("user_profiles").select("user_id, phone").not("phone","is",null);return new Map((c??[]).map(y=>[y.user_id,y.phone]))}}),d=r.useMemo(()=>{const c=new Date;c.setHours(0,0,0,0);const y=c.getTime(),A=[],N=[];for(const j of u)new Date(j.date+"T00:00:00").getTime()>=y?A.push(j):N.push(j);return A.sort((j,K)=>new Date(j.date+"T00:00:00").getTime()-new Date(K.date+"T00:00:00").getTime()),N.sort((j,K)=>new Date(K.date+"T00:00:00").getTime()-new Date(j.date+"T00:00:00").getTime()),[...A,...N]},[u]),g=()=>{l(null),o(!0)},p=c=>{l(c),o(!0)},v=(c,y)=>{if(!x)return;const A=y.map(j=>x.get(j.athlete_id)).filter(j=>!!j&&j.trim().length>0);if(A.length===0){n({title:"Aucun numero",description:"Aucun nageur assigne n'a renseigne de numero de telephone.",variant:"destructive"});return}if(/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)){const j=encodeURIComponent(`[${c.name}] `);/iPhone|iPad|iPod/i.test(navigator.userAgent)?window.location.href=`sms:/open?addresses=${A.join(",")}&body=${j}`:window.location.href=`sms:${A.join(",")}?body=${j}`}else navigator.clipboard.writeText(A.join(", ")).then(()=>{n({title:"Numeros copies",description:`${A.length} numero${A.length>1?"s":""} copie${A.length>1?"s":""} dans le presse-papiers. Utilisez votre telephone pour envoyer le SMS.`})}).catch(()=>{n({title:"Erreur",description:"Impossible de copier les numéros.",variant:"destructive"})})},b=u.length===0?"Gerez les competitions du club.":`${u.length} competition${u.length>1?"s":""}`;return e.jsxs("div",{className:"space-y-6 pb-24",children:[e.jsx(le,{title:"Competitions",description:b,onBack:t,actions:e.jsxs(L,{variant:"outline",size:"sm",onClick:g,children:[e.jsx(ge,{className:"mr-1.5 h-3.5 w-3.5"}),"Ajouter"]})}),i?e.jsx("div",{className:"space-y-2",children:[1,2,3].map(c=>e.jsx("div",{className:"rounded-xl border p-3 animate-pulse motion-reduce:animate-none",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-4 w-40 rounded bg-muted"}),e.jsx("div",{className:"ml-auto h-5 w-12 rounded bg-muted"})]})},c))}):d.length===0?e.jsxs("div",{className:"text-center py-12 space-y-3",children:[e.jsx(st,{className:"h-10 w-10 text-muted-foreground mx-auto"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Aucune competition creee."}),e.jsxs(L,{variant:"outline",size:"sm",onClick:g,children:[e.jsx(ge,{className:"mr-1.5 h-3.5 w-3.5"}),"Creer la premiere competition"]})]}):e.jsx("div",{className:"space-y-2",children:d.map(c=>e.jsx(fr,{competition:c,onEdit:p,onSendSms:v},c.id))}),e.jsx(gr,{open:s,onOpenChange:o,competition:a})]})};async function jr(t){const{data:n,error:s}=await ct.rpc("get_auth_uid_for_user",{p_user_id:t});return s?(console.error("[objectives] Failed to resolve auth UUID:",s.message),null):n}const br=({open:t,onOpenChange:n,objective:s,athleteName:o,athleteAuthId:a,competitions:l})=>{const{toast:u}=se(),i=Se(),x=!!s,[d,g]=r.useState("chrono"),[p,v]=r.useState(""),[b,c]=r.useState("25"),[y,A]=r.useState(""),[N,j]=r.useState(""),[K,q]=r.useState(""),[D,E]=r.useState(!1);r.useEffect(()=>{if(t)if(s){const f=!!s.event_code,M=!!s.text;g(f&&M?"both":M?"texte":"chrono"),v(s.event_code??""),c(String(s.pool_length??25)),A(s.target_time_seconds!=null?Ot(s.target_time_seconds):""),j(s.text??""),q(s.competition_id??"")}else g("chrono"),v(""),c("25"),A(""),j(""),q("")},[t,s]);const T=X({mutationFn:f=>I.createObjective(f),onSuccess:()=>{u({title:"Objectif cree"}),i.invalidateQueries({queryKey:["objectives"]}),n(!1)},onError:f=>{u({title:"Erreur",description:f.message,variant:"destructive"})}}),_=X({mutationFn:f=>I.updateObjective(s.id,f),onSuccess:()=>{u({title:"Objectif mis a jour"}),i.invalidateQueries({queryKey:["objectives"]}),n(!1)},onError:f=>{u({title:"Erreur",description:f.message,variant:"destructive"})}}),m=X({mutationFn:()=>I.deleteObjective(s.id),onSuccess:()=>{u({title:"Objectif supprime"}),i.invalidateQueries({queryKey:["objectives"]}),n(!1)},onError:f=>{u({title:"Erreur",description:f.message,variant:"destructive"})}}),P=d==="chrono"||d==="both",$=d==="texte"||d==="both",B=()=>{if(P&&!p){u({title:"Epreuve requise",description:"Veuillez selectionner une epreuve.",variant:"destructive"});return}if(P&&y&&bt(y)===null){u({title:"Format invalide",description:"Le temps doit être au format m:ss:cc (ex: 1:05:30)",variant:"destructive"});return}if($&&!N.trim()){u({title:"Texte requis",description:"Veuillez saisir un objectif texte.",variant:"destructive"});return}const f={athlete_id:a,competition_id:K&&K!=="none"?K:null,event_code:P?p:null,pool_length:P?Number(b):null,target_time_seconds:P&&y?bt(y):null,text:$?N.trim():null};x?_.mutate(f):T.mutate(f)},V=T.isPending||_.isPending||m.isPending,w=r.useMemo(()=>{const f=new Date;return f.setHours(0,0,0,0),l.filter(M=>new Date(M.date+"T00:00:00").getTime()>=f.getTime())},[l]);return e.jsxs(e.Fragment,{children:[e.jsx(Le,{open:t,onOpenChange:n,children:e.jsxs(Ke,{side:"right",className:"w-full sm:max-w-md overflow-y-auto",children:[e.jsx(Ve,{children:e.jsx(Ge,{children:x?"Modifier l'objectif":"Nouvel objectif"})}),e.jsxs("div",{className:"mt-6 space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(H,{children:"Nageur"}),e.jsx("p",{className:"text-sm font-medium",children:o})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(H,{children:"Type d'objectif"}),e.jsxs(dt,{type:"single",variant:"outline",value:d,onValueChange:f=>{f&&g(f)},className:"justify-start",children:[e.jsx(de,{value:"chrono",className:"text-xs",children:"Chrono"}),e.jsx(de,{value:"texte",className:"text-xs",children:"Texte"}),e.jsx(de,{value:"both",className:"text-xs",children:"Les deux"})]})]}),P&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(H,{children:"Epreuve *"}),e.jsxs(re,{value:p,onValueChange:v,children:[e.jsx(ae,{children:e.jsx(oe,{placeholder:"Choisir une epreuve"})}),e.jsx(ie,{children:As.map(f=>e.jsx(Z,{value:f,children:$t(f)},f))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(H,{children:"Bassin"}),e.jsxs(re,{value:b,onValueChange:c,children:[e.jsx(ae,{children:e.jsx(oe,{})}),e.jsxs(ie,{children:[e.jsx(Z,{value:"25",children:"25m"}),e.jsx(Z,{value:"50",children:"50m"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(H,{children:"Temps cible (min:sec:centièmes)"}),e.jsx(ye,{placeholder:"Ex : 1:05:30",value:y,onChange:f=>A(f.target.value)})]})]}),$&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(H,{children:"Objectif texte *"}),e.jsx(ut,{placeholder:"Ex : Ameliorer la coulée de dos",value:N,onChange:f=>j(f.target.value),rows:3})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(H,{children:"Lier a une competition"}),e.jsxs(re,{value:K,onValueChange:q,children:[e.jsx(ae,{children:e.jsx(oe,{placeholder:"Aucune"})}),e.jsxs(ie,{children:[e.jsx(Z,{value:"none",children:"Aucune"}),w.map(f=>e.jsxs(Z,{value:f.id,children:[f.name," (",f.date,")"]},f.id))]})]})]}),e.jsxs("div",{className:"space-y-2 pt-2",children:[e.jsx(L,{className:"w-full",onClick:B,disabled:V,children:V?"Enregistrement...":x?"Enregistrer":"Creer"}),x&&e.jsx(L,{variant:"outline",className:"w-full text-destructive hover:text-destructive",onClick:()=>E(!0),disabled:V,children:"Supprimer cet objectif"})]})]})]})}),e.jsx(Re,{open:D,onOpenChange:E,children:e.jsxs(Fe,{children:[e.jsxs(Te,{children:[e.jsx($e,{children:"Supprimer l'objectif"}),e.jsx(Oe,{children:"Cette action est irreversible. L'objectif sera supprime definitivement."})]}),e.jsxs(Ie,{children:[e.jsx(qe,{children:"Annuler"}),e.jsx(ze,{onClick:()=>{m.mutate(),E(!1)},className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Supprimer"})]})]})})]})},yr=({objective:t,onEdit:n})=>{const s=!!t.event_code,o=!!t.text;return e.jsxs("button",{type:"button",className:"w-full text-left rounded-xl border bg-card p-3 space-y-1.5 transition-colors hover:bg-muted/50",onClick:()=>n(t),children:[s&&e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"text-sm font-semibold",children:$t(t.event_code)}),t.pool_length&&e.jsxs(te,{variant:"secondary",className:"text-[10px] px-1.5 py-0",children:[t.pool_length,"m"]}),t.target_time_seconds!=null&&e.jsx(te,{variant:"outline",className:"text-[10px] px-1.5 py-0 font-mono",children:Ot(t.target_time_seconds)})]}),o&&e.jsx("p",{className:"text-sm text-muted-foreground line-clamp-2",children:t.text}),t.competition_name&&e.jsx(te,{variant:"outline",className:"border-orange-300 text-orange-600 dark:text-orange-400 text-[10px] px-1.5 py-0",children:t.competition_name})]})},Nr=({onBack:t,athletes:n,athletesLoading:s})=>{const{toast:o}=se(),[a,l]=r.useState(""),[u,i]=r.useState(!1),[x,d]=r.useState(null),g=r.useMemo(()=>a?n.find(D=>D.id!=null&&String(D.id)===a)??null:null,[n,a]),{data:p,isLoading:v}=Q({queryKey:["auth-uid",a],queryFn:()=>jr(Number(a)),enabled:!!a}),{data:b=[]}=Q({queryKey:["competitions"],queryFn:()=>I.getCompetitions()}),{data:c=[],isLoading:y}=Q({queryKey:["objectives",p],queryFn:()=>I.getObjectives(p),enabled:!!p}),A=r.useMemo(()=>{const D=n.filter(T=>T.id!=null),E=new Map;for(const T of D){const _=T.group_label||"Sans groupe";E.has(_)||E.set(_,[]),E.get(_).push(T)}return[...E.entries()].sort(([T],[_])=>T.localeCompare(_,"fr"))},[n]),N=()=>{if(!p){o({title:"Nageur requis",description:"Veuillez selectionner un nageur.",variant:"destructive"});return}d(null),i(!0)},j=D=>{d(D),i(!0)},K=s||!!a&&v,q=!!p&&!v;return e.jsxs("div",{className:"space-y-6 pb-24",children:[e.jsx(le,{title:"Objectifs",description:"Definissez des objectifs chrono ou texte pour chaque nageur.",onBack:t,actions:e.jsxs(L,{variant:"outline",size:"sm",onClick:N,disabled:!p,children:[e.jsx(ge,{className:"mr-1.5 h-3.5 w-3.5"}),"Ajouter"]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(H,{children:"Nageur"}),e.jsxs(re,{value:a,onValueChange:l,children:[e.jsx(ae,{children:e.jsx(oe,{placeholder:"Selectionner un nageur"})}),e.jsx(ie,{children:A.map(([D,E])=>e.jsxs("div",{children:[e.jsx("div",{className:"px-2 py-1.5 text-xs font-semibold uppercase tracking-wider text-muted-foreground",children:D}),E.map(T=>e.jsx(Z,{value:String(T.id),children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:T.display_name}),T.group_label&&e.jsx(te,{variant:"secondary",className:"text-[10px] px-1.5 py-0",children:T.group_label})]})},T.id))]},D))})]})]}),!a&&e.jsxs("div",{className:"text-center py-12 space-y-3",children:[e.jsx(nt,{className:"h-10 w-10 text-muted-foreground mx-auto"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Selectionnez un nageur pour voir et gerer ses objectifs."})]}),K&&a&&e.jsx("div",{className:"space-y-2",children:[1,2,3].map(D=>e.jsx("div",{className:"rounded-xl border p-3 animate-pulse motion-reduce:animate-none",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-4 w-40 rounded bg-muted"}),e.jsx("div",{className:"ml-auto h-5 w-12 rounded bg-muted"})]})},D))}),q&&y&&e.jsx("div",{className:"space-y-2",children:[1,2].map(D=>e.jsx("div",{className:"rounded-xl border p-3 animate-pulse motion-reduce:animate-none",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-4 w-32 rounded bg-muted"}),e.jsx("div",{className:"ml-auto h-5 w-16 rounded bg-muted"})]})},D))}),q&&!y&&c.length===0&&e.jsxs("div",{className:"text-center py-12 space-y-3",children:[e.jsx(nt,{className:"h-10 w-10 text-muted-foreground mx-auto"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Aucun objectif defini pour ",g?.display_name,"."]}),e.jsxs(L,{variant:"outline",size:"sm",onClick:N,children:[e.jsx(ge,{className:"mr-1.5 h-3.5 w-3.5"}),"Creer le premier objectif"]})]}),q&&!y&&c.length>0&&e.jsx("div",{className:"space-y-2",children:c.map(D=>e.jsx(yr,{objective:D,onEdit:j},D.id))}),p&&g&&e.jsx(br,{open:u,onOpenChange:i,objective:x,athleteName:g.display_name,athleteAuthId:p,competitions:b})]})},wr=r.lazy(()=>Tt(()=>import("./StrengthCatalog-BvKhpE1X.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42]))),Cr=r.lazy(()=>Tt(()=>import("./SwimCatalog-Cl9M4bNf.js"),__vite__mapDeps([43,1,2,3,4,5,6,7,19,20,10,12,22,17,44,45,14,46,47,13,48,24,16,25,26,9,8,15,27,28,29,30,18,11,32,49,34,36,37,21,38,39,40,41,42]))),Sr=({onNavigate:t,onOpenRecordsAdmin:n,onOpenRecordsClub:s,athletes:o,athletesLoading:a,upcomingBirthdays:l,birthdaysLoading:u,kpiLoading:i,kpiPeriod:x,onKpiPeriodChange:d,fatigueAlerts:g,mostLoadedAthlete:p,swimSessionCount:v,strengthSessionCount:b})=>{const c=new Date().getHours(),y=c<12?"Bonjour":c<18?"Bon après-midi":"Bonsoir",A=new Date().toLocaleDateString("fr-FR",{weekday:"long",day:"numeric",month:"long"}),N=g.length>0;return e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-display font-bold uppercase italic",children:[y,", ",e.jsx("span",{className:"text-primary",children:"Coach"})]}),e.jsx("p",{className:"text-sm text-muted-foreground capitalize",children:A})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h2",{className:"text-xs font-semibold uppercase tracking-[0.15em] text-muted-foreground",children:["Signaux · ",x,"j"]}),e.jsxs(dt,{type:"single",size:"sm",variant:"outline",value:String(x),onValueChange:j=>{j&&d(Number(j))},children:[e.jsx(de,{value:"7",className:"h-7 px-2 text-xs","aria-label":"7 jours",children:"7j"}),e.jsx(de,{value:"30",className:"h-7 px-2 text-xs","aria-label":"30 jours",children:"30j"}),e.jsx(de,{value:"365",className:"h-7 px-2 text-xs","aria-label":"1 an",children:"1an"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:`rounded-xl border p-3 ${N?"border-destructive/30 bg-destructive/5":"bg-muted/30"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-[11px] text-muted-foreground",children:"Fatigue 5/5"}),e.jsx(nn,{className:`h-3.5 w-3.5 ${N?"text-destructive":"text-muted-foreground"}`})]}),e.jsx("p",{className:"text-xl font-bold tabular-nums",children:i?"–":g.length}),e.jsx("p",{className:"text-[11px] text-muted-foreground truncate",children:i?"Chargement…":N?g.slice(0,2).map(j=>j.athleteName.split(" ")[0]).join(", "):"Aucune alerte"})]}),e.jsxs("div",{className:"rounded-xl border bg-muted/30 p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-[11px] text-muted-foreground",children:"Plus chargé"}),e.jsx(we,{className:"h-3.5 w-3.5 text-muted-foreground"})]}),e.jsx("p",{className:"text-xl font-bold truncate",children:i?"–":p?.athleteName?.split(" ")[0]??"–"}),e.jsx("p",{className:"text-[11px] text-muted-foreground",children:i?"Calcul…":p?`Charge ${Math.round(p.loadScore)}`:"Pas de données"})]})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs("button",{type:"button",onClick:()=>t("calendar"),className:"flex items-center gap-1.5 rounded-full bg-primary text-primary-foreground px-3.5 py-2 text-sm font-semibold active:opacity-80 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",children:[e.jsx(rt,{className:"h-3.5 w-3.5"}),"Assigner"]}),e.jsxs("button",{type:"button",onClick:()=>t("messaging"),className:"flex items-center gap-1.5 rounded-full border px-3.5 py-2 text-sm font-semibold active:bg-muted focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",children:[e.jsx(pt,{className:"h-3.5 w-3.5"}),"Email"]}),e.jsxs("button",{type:"button",onClick:()=>t("sms"),className:"flex items-center gap-1.5 rounded-full border px-3.5 py-2 text-sm font-semibold active:bg-muted focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",children:[e.jsx(ht,{className:"h-3.5 w-3.5"}),"SMS"]}),e.jsxs("button",{type:"button",onClick:()=>t("groups"),className:"flex items-center gap-1.5 rounded-full border px-3.5 py-2 text-sm font-semibold active:bg-muted focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",children:[e.jsx(Lt,{className:"h-3.5 w-3.5"}),"Groupes"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("button",{type:"button",onClick:()=>t("swim"),className:"rounded-xl border bg-card p-4 text-left shadow-sm active:bg-muted/50 transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",children:[e.jsx(Rt,{className:"h-5 w-5 text-primary mb-2"}),e.jsx("p",{className:"text-sm font-bold",children:"Natation"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:v!=null?`${v} séance${v!==1?"s":""}`:"Bibliothèque"})]}),e.jsxs("button",{type:"button",onClick:()=>t("strength"),className:"rounded-xl border bg-card p-4 text-left shadow-sm active:bg-muted/50 transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",children:[e.jsx(Ft,{className:"h-5 w-5 text-primary mb-2"}),e.jsx("p",{className:"text-sm font-bold",children:"Musculation"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:b!=null?`${b} séance${b!==1?"s":""}`:"Bibliothèque"})]}),e.jsxs("button",{type:"button",onClick:()=>t("swimmers"),className:"rounded-xl border bg-card p-4 text-left shadow-sm active:bg-muted/50 transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",children:[e.jsx(we,{className:"h-5 w-5 text-primary mb-2"}),e.jsx("p",{className:"text-sm font-bold",children:"Nageurs"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:a?"Chargement…":`${o.length} nageur${o.length!==1?"s":""}`})]}),e.jsxs("button",{type:"button",onClick:n,className:"rounded-xl border bg-card p-4 text-left shadow-sm active:bg-muted/50 transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",children:[e.jsx(st,{className:"h-5 w-5 text-primary mb-2"}),e.jsx("p",{className:"text-sm font-bold",children:"Records club"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Import & administration"})]}),e.jsxs("button",{type:"button",onClick:()=>t("competitions"),className:"rounded-xl border bg-card p-4 text-left shadow-sm active:bg-muted/50 transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",children:[e.jsx(st,{className:"h-5 w-5 text-amber-500 mb-2"}),e.jsx("p",{className:"text-sm font-bold",children:"Compétitions"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Échéances & calendrier"})]}),e.jsxs("button",{type:"button",onClick:()=>t("objectives"),className:"rounded-xl border bg-card p-4 text-left shadow-sm active:bg-muted/50 transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",children:[e.jsx(nt,{className:"h-5 w-5 text-primary mb-2"}),e.jsx("p",{className:"text-sm font-bold",children:"Objectifs"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Temps cibles & objectifs"})]})]}),e.jsx("button",{type:"button",onClick:s,className:"w-full text-center text-sm text-primary font-semibold py-1 active:opacity-70 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring rounded",children:"Voir les records du club"}),!u&&l&&l.length>0?e.jsxs("div",{className:"space-y-2",children:[e.jsx("h2",{className:"text-xs font-semibold uppercase tracking-[0.15em] text-muted-foreground",children:"Anniversaires"}),e.jsx("div",{className:"space-y-1.5",children:l.slice(0,3).map(j=>e.jsxs("div",{className:"flex items-center justify-between gap-2 rounded-lg border px-3 py-2",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("span",{className:"text-sm font-medium truncate block",children:j.display_name}),e.jsx("span",{className:"text-[11px] text-muted-foreground",children:_r(j.next_birthday)})]}),e.jsxs("span",{className:"text-xs font-bold text-primary shrink-0",children:["J-",j.days_until]})]},j.id))})]}):null]})},_r=t=>{if(!t)return"-";const n=new Date(t);return Number.isNaN(n.getTime())?t:n.toLocaleDateString("fr-FR")},At=t=>t.toISOString().split("T")[0],kr=t=>new Date(t.completed_at||t.started_at||t.date||t.created_at||0).getTime(),Ar=t=>{if(!t.length)return null;const n=t.reduce((o,a)=>o+a,0)/t.length,s=Math.min(5,Math.max(1,Math.round(n/10*5)));return{average:n,rating:s}};function Mr(){const t=vt(m=>m.role),n=vt(m=>m.setSelectedAthlete),[,s]=Ss(),[o,a]=r.useState("home"),[l,u]=r.useState(7);r.useEffect(()=>{const m=()=>a("home");return window.addEventListener("nav:reset",m),()=>window.removeEventListener("nav:reset",m)},[]);const i=t==="coach"||t==="admin",x=o==="home"||o==="calendar",d=o==="home"||o==="messaging"||o==="sms"||o==="swimmers"||o==="calendar"||o==="groups"||o==="objectives",g=o==="messaging"||o==="sms"||o==="calendar"||o==="groups",p=o==="home"||o==="swimmers",{data:v}=Q({queryKey:["swim_catalog"],queryFn:()=>I.getSwimCatalog(),enabled:i&&x}),{data:b}=Q({queryKey:["strength_catalog"],queryFn:()=>I.getStrengthSessions(),enabled:i&&x}),{data:c=[],isLoading:y}=Q({queryKey:["athletes"],queryFn:()=>I.getAthletes(),enabled:i&&d}),A=r.useMemo(()=>c.slice(0,5),[c]),{data:N=[]}=Q({queryKey:["groups"],queryFn:()=>I.getGroups(),enabled:i&&g}),j=Q({queryKey:["upcoming-birthdays"],queryFn:()=>I.getUpcomingBirthdays({days:30}),enabled:i&&p}),K=j.data,q=Q({queryKey:["coach-kpis",l,A.map(m=>m.id??m.display_name)],enabled:i&&o==="home"&&A.length>0,queryFn:async()=>{const m=l,P=new Date;P.setDate(P.getDate()-m);const $=At(P),B=At(new Date),V=await Promise.all(A.map(async M=>{const[O,G]=await Promise.all([I.getSessions(M.display_name,M.id),I.getStrengthHistory(M.display_name,{athleteId:M.id,limit:50,from:$,to:B})]),J=O.filter(F=>new Date(F.date).getTime()>=P.getTime()),k=J.map(F=>F.fatigue??F.feeling).filter(F=>Number.isFinite(F)),W=J.reduce((F,U)=>F+(Number(U.duration)||0)*(Number(U.effort)||0),0),C=(G?.runs??[]).filter(F=>kr(F)>=P.getTime()),R=C.map(F=>F.fatigue??F.feeling??F.rpe).filter(F=>Number.isFinite(Number(F))).map(F=>Number(F)),S=C.reduce((F,U)=>{const Y=Number(U.feeling??U.rpe??0),he=Number(U.duration??0);if(he>0&&Y>0)return F+he*Y;const hs=Array.isArray(U.logs)?U.logs.length:0;return F+hs*5},0),z=Ar([...k,...R]);return{athleteName:M.display_name,loadScore:W+S,fatigueRating:z}})),w=V.filter(M=>M.fatigueRating?.rating===5).map(M=>({athleteName:M.athleteName,rating:M.fatigueRating?.rating??0})),f=V.filter(M=>M.loadScore>0).sort((M,O)=>O.loadScore-M.loadScore)[0];return{fatigueAlerts:w,mostLoadedAthlete:f??null}}}),D=m=>{n({id:m.id??null,name:m.display_name}),s("/progress")},{toast:E}=se(),T=Se(),_=X({mutationFn:async m=>{const P=await I.importSingleSwimmer(m.iuf,m.name);return await I.recalculateClubRecords(),P},onSuccess:m=>{E({title:"Import terminé",description:`${m.total_found} trouvées, ${m.new_imported} nouvelles.`}),T.invalidateQueries({queryKey:["club-records"]})},onError:m=>{E({title:"Erreur import",description:m.message,variant:"destructive"})}});return i?e.jsxs("div",{className:"space-y-6",children:[o==="home"?e.jsx(Sr,{onNavigate:a,onOpenRecordsAdmin:()=>s("/records-admin"),onOpenRecordsClub:()=>s("/records-club"),athletes:c,athletesLoading:y,upcomingBirthdays:K,birthdaysLoading:j.isLoading,kpiLoading:q.isLoading,kpiPeriod:l,onKpiPeriodChange:u,fatigueAlerts:q.data?.fatigueAlerts??[],mostLoadedAthlete:q.data?.mostLoadedAthlete??null,swimSessionCount:v?.length,strengthSessionCount:b?.length}):null,o==="swim"?e.jsxs("div",{className:"space-y-6",children:[e.jsx(le,{title:"Bibliothèque natation",description:"Accédez aux séances et aux templates natation.",onBack:()=>a("home"),actions:e.jsxs(L,{variant:"outline",size:"sm",onClick:()=>a("calendar"),children:[e.jsx(rt,{className:"mr-1.5 h-3.5 w-3.5"}),"Assigner"]})}),e.jsx(r.Suspense,{fallback:e.jsx(jt,{}),children:e.jsx(Cr,{})})]}):null,o==="strength"?e.jsxs("div",{className:"space-y-6",children:[e.jsx(le,{title:"Bibliothèque musculation",description:"Consultez et créez des séances musculation.",onBack:()=>a("home"),actions:e.jsxs(L,{variant:"outline",size:"sm",onClick:()=>a("calendar"),children:[e.jsx(rt,{className:"mr-1.5 h-3.5 w-3.5"}),"Assigner"]})}),e.jsx(r.Suspense,{fallback:e.jsx(jt,{}),children:e.jsx(wr,{})})]}):null,o==="swimmers"?e.jsxs("div",{className:"space-y-4",children:[e.jsx(le,{title:"Nageurs",description:y?"Chargement…":`${c.length} nageur${c.length!==1?"s":""} inscrit${c.length!==1?"s":""}`,onBack:()=>a("home"),actions:e.jsxs(L,{variant:"outline",size:"sm",onClick:()=>a("messaging"),children:[e.jsx(pt,{className:"mr-1.5 h-3.5 w-3.5"}),"Email"]})}),y?e.jsx("div",{className:"space-y-2",children:[1,2,3,4,5].map(m=>e.jsx("div",{className:"rounded-xl border p-3 animate-pulse motion-reduce:animate-none",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-4 w-32 rounded bg-muted"}),e.jsx("div",{className:"ml-auto h-8 w-16 rounded bg-muted"})]})},m))}):c.length?e.jsx("div",{className:"space-y-2",children:c.map(m=>e.jsxs("div",{className:"flex items-center gap-3 rounded-xl border bg-card p-3",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-sm font-semibold truncate",children:m.display_name}),e.jsxs("div",{className:"flex items-center gap-2 mt-0.5",children:[m.group_label?e.jsx(te,{variant:"secondary",className:"text-[10px] px-1.5 py-0",children:m.group_label}):null,m.ffn_iuf?e.jsx("span",{className:"text-[10px] font-mono text-muted-foreground",children:m.ffn_iuf}):null]})]}),e.jsxs("div",{className:"flex items-center gap-1 shrink-0",children:[m.ffn_iuf?e.jsx(L,{size:"icon",variant:"ghost",className:"h-8 w-8",disabled:_.isPending,onClick:()=>_.mutate({iuf:m.ffn_iuf,name:m.display_name}),title:"Importer performances FFN",children:e.jsx(_s,{className:"h-4 w-4"})}):null,e.jsx(L,{size:"sm",variant:"outline",onClick:()=>D(m),children:"Fiche"})]})]},m.id??m.display_name))}):e.jsx("p",{className:"text-sm text-muted-foreground text-center py-8",children:"Aucun nageur disponible."})]}):null,o==="messaging"?e.jsx(ln,{onBack:()=>a("home"),athletes:c,groups:N,athletesLoading:y}):null,o==="sms"?e.jsx(ar,{onBack:()=>a("home"),athletes:c,groups:N,athletesLoading:y}):null,o==="calendar"?e.jsx(dr,{onBack:()=>a("home"),athletes:c,groups:N,swimSessions:v,strengthSessions:b}):null,o==="groups"?e.jsx(hr,{onBack:()=>a("home"),athletes:c,groups:N,athletesLoading:y}):null,o==="competitions"?e.jsx(vr,{onBack:()=>a("home")}):null,o==="objectives"?e.jsx(Nr,{onBack:()=>a("home"),athletes:c,athletesLoading:y}):null]}):e.jsx("div",{className:"flex items-center justify-center min-h-[60vh] animate-in fade-in motion-reduce:animate-none",children:e.jsxs(Ae,{className:"w-full max-w-sm shadow-xl border-t-4 border-t-primary",children:[e.jsxs(Me,{children:[e.jsxs(De,{className:"flex items-center gap-2 uppercase italic",children:[e.jsx(we,{className:"h-5 w-5 text-primary"}),"Accès Coach"]}),e.jsx(Ee,{children:"Cette section est réservée aux coachs et administrateurs."})]}),e.jsx(Pe,{children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"Connectez-vous avec un compte autorisé pour accéder aux outils de gestion."})})]})})}const Zr=Object.freeze(Object.defineProperty({__proto__:null,default:Mr},Symbol.toStringTag,{value:"Module"}));export{ls as C,Pn as P,cs as a,ds as b,us as c,it as d,lt as e,Rn as f,Zt as g,en as h,Zr as i};
