import{r as m,u as A,j as e,c as ve,d as M,R as At,a as F}from"./vendor-query-BiSH4r2z.js";import{c as Et,B as T,d as ye,L as E,I as Ae,s as Be,X as Tt,n as Dt,p as Pt,P as Ge,q as It,a as Ee,Y as qt,b as Ft,u as Rt}from"./index-YeJaZGYP.js";import{a as y}from"./api-BAJczdM0.js";import{T as Lt,a as Mt,b as ue,c as me}from"./tabs-GCAQ1KIx.js";import{B as V}from"./badge-BdM46Reb.js";import{C as Ye}from"./chevron-down-Ch8XWwJs.js";import{a as Xe,e as Te,f as De,F as Ot,T as te,p as ze,M as Je,A as Kt}from"./objectiveHelpers-C8OPnlv4.js";import{S as Y,a as X,b as J,c as Z,d as Q}from"./select-BFZk1Z4P.js";import{T as Wt,a as _e}from"./toggle-group-BFZgu61H.js";import{S as Pe,a as Ie,b as qe,c as Fe,A as ne,e as ae,f as re,g as ie,h as oe,i as ce,j as le,k as de}from"./alert-dialog-c9NgUzsU.js";import{P as ee}from"./plus-C60PINOP.js";import{C as Vt}from"./copy-255w98KA.js";import{T as Ze}from"./trash-2-B4J4XI7t.js";import{C as $t}from"./index-BN_HhlSL.js";import{P as zt}from"./pencil-BMEkM3qe.js";import{c as Ut,u as Ht}from"./index-Dw4WSryE.js";import{c as et,R as Qt,T as Bt,b as Gt}from"./index-BgSWwJFI.js";import{u as Yt}from"./index-BavNxb8U.js";import{C as tt}from"./clock-PKHV2S2K.js";import{C as Xt}from"./circle-check-BI6DZ0jd.js";import{S as Ue}from"./send-B0f_2TjN.js";import"./vendor-react-BzrpNAyj.js";import"./vendor-supabase-DFPLkPj_.js";import"./swim-14d9z5Se.js";import"./index-Bb5TNwP_.js";import"./chevron-up-pppRzde4.js";import"./index-AcYtHAXu.js";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jt=[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M16 2v4",key:"4m81vk"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M17 14h-6",key:"bkmgh3"}],["path",{d:"M13 18H7",key:"bb0bb7"}],["path",{d:"M7 14h.01",key:"1qa3f1"}],["path",{d:"M17 18h.01",key:"1bdyru"}]],st=Et("calendar-range",Jt);function He(...t){return t.filter(Boolean).join(" ")}const Zt=[{key:"effort",label:"Diff.",mode:"hard"},{key:"feeling",label:"Fat.",mode:"hard"},{key:"performance",label:"Perf",mode:"good"},{key:"engagement",label:"Eng.",mode:"good"}];function es(t,n){const s=Number(n);if(!Number.isFinite(s)||s<1||s>5)return"bg-muted text-muted-foreground";const a=t==="hard"?6-s:s;return a>=4?"bg-emerald-100 text-emerald-800 dark:bg-emerald-900/30 dark:text-emerald-400":a>=3?"bg-amber-100 text-amber-800 dark:bg-amber-900/30 dark:text-amber-400":"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400"}function ts({athleteId:t,athleteName:n}){const[s,a]=m.useState(20),[o,r]=m.useState(null),{data:i=[],isLoading:d}=A({queryKey:["sessions",t],queryFn:()=>y.getSessions(n,t)}),f=i.slice(0,s),p=i.length>s;return d?e.jsx("div",{className:"space-y-3",children:[1,2,3,4,5].map(u=>e.jsxs("div",{className:"rounded-2xl border bg-card p-3 animate-pulse motion-reduce:animate-none",children:[e.jsx("div",{className:"h-4 w-32 rounded bg-muted mb-2"}),e.jsx("div",{className:"h-3 w-full rounded bg-muted"})]},u))}):i.length===0?e.jsx("p",{className:"text-sm text-muted-foreground text-center py-8",children:"Aucun ressenti enregistre."}):e.jsxs("div",{className:"space-y-2",children:[f.map(u=>{const l=o===u.id;return e.jsxs("button",{type:"button",onClick:()=>r(l?null:u.id),className:"w-full rounded-2xl border bg-card p-3 text-left hover:border-primary/20 transition-all",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("span",{className:"text-sm font-semibold text-foreground",children:new Date(u.date).toLocaleDateString("fr-FR",{weekday:"short",day:"numeric",month:"short"})}),e.jsx("span",{className:"text-xs text-muted-foreground ml-1.5",children:u.slot})]}),e.jsx("div",{className:"flex items-center gap-1",children:Zt.map(x=>{const j=u[x.key];return e.jsx("span",{title:`${x.label}: ${j??"â€”"}`,className:He("inline-flex items-center justify-center h-6 w-6 rounded-lg text-[10px] font-bold",es(x.mode,j)),children:j??"â€”"},x.key)})})]}),e.jsxs("div",{className:"flex items-center justify-between mt-1.5",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:u.distance>0?`${u.distance}m`:"â€”"}),u.comments&&e.jsx(Ye,{className:He("h-3.5 w-3.5 text-muted-foreground transition-transform",l&&"rotate-180")})]}),l&&u.comments&&e.jsx("div",{className:"mt-2 pt-2 border-t border-border",children:e.jsx("p",{className:"text-xs text-foreground whitespace-pre-wrap",children:u.comments})})]},u.id)}),p&&e.jsxs("button",{type:"button",onClick:u=>{u.stopPropagation(),a(l=>l+20)},className:"w-full rounded-2xl border border-dashed border-border py-2 text-xs font-medium text-muted-foreground hover:bg-muted transition",children:["Charger plus (",i.length-s," restants)"]})]})}async function ss(t){const{data:n,error:s}=await Be.rpc("get_auth_uid_for_user",{p_user_id:t});return s?(console.error("[objectives-tab] Failed to resolve auth UUID:",s.message),null):n}const ns=({open:t,onOpenChange:n,objective:s,athleteName:a,athleteAuthId:o,competitions:r})=>{const{toast:i}=ye(),d=ve(),f=!!s,[p,u]=m.useState("chrono"),[l,x]=m.useState(""),[j,g]=m.useState("25"),[v,_]=m.useState(""),[N,C]=m.useState(""),[S,D]=m.useState(""),[P,q]=m.useState(!1);m.useEffect(()=>{if(t)if(s){const h=!!s.event_code,W=!!s.text;u(h&&W?"both":W?"texte":"chrono"),x(s.event_code??""),g(String(s.pool_length??25)),_(s.target_time_seconds!=null?De(s.target_time_seconds):""),C(s.text??""),D(s.competition_id??"")}else u("chrono"),x(""),g("25"),_(""),C(""),D("")},[t,s]);const R=M({mutationFn:h=>y.createObjective(h),onSuccess:()=>{i({title:"Objectif cree"}),d.invalidateQueries({queryKey:["objectives",o]}),n(!1)},onError:h=>{i({title:"Erreur",description:h.message,variant:"destructive"})}}),k=M({mutationFn:h=>y.updateObjective(s.id,h),onSuccess:()=>{i({title:"Objectif mis a jour"}),d.invalidateQueries({queryKey:["objectives",o]}),n(!1)},onError:h=>{i({title:"Erreur",description:h.message,variant:"destructive"})}}),w=M({mutationFn:()=>y.deleteObjective(s.id),onSuccess:()=>{i({title:"Objectif supprime"}),d.invalidateQueries({queryKey:["objectives",o]}),n(!1)},onError:h=>{i({title:"Erreur",description:h.message,variant:"destructive"})}}),$=p==="chrono"||p==="both",B=p==="texte"||p==="both",Ce=()=>{if($&&!l){i({title:"Epreuve requise",description:"Veuillez selectionner une epreuve.",variant:"destructive"});return}if($&&v&&ze(v)===null){i({title:"Format invalide",description:"Le temps doit etre au format m:ss:cc (ex: 1:05:30)",variant:"destructive"});return}if(B&&!N.trim()){i({title:"Texte requis",description:"Veuillez saisir un objectif texte.",variant:"destructive"});return}const h={athlete_id:o,competition_id:S&&S!=="none"?S:null,event_code:$?l:null,pool_length:$?Number(j):null,target_time_seconds:$&&v?ze(v):null,text:B?N.trim():null};f?k.mutate(h):R.mutate(h)},z=R.isPending||k.isPending||w.isPending,K=m.useMemo(()=>{const h=new Date;return h.setHours(0,0,0,0),r.filter(W=>new Date(W.date+"T00:00:00").getTime()>=h.getTime())},[r]);return e.jsxs(e.Fragment,{children:[e.jsx(Pe,{open:t,onOpenChange:n,children:e.jsxs(Ie,{side:"right",className:"w-full sm:max-w-md overflow-y-auto",children:[e.jsx(qe,{children:e.jsx(Fe,{children:f?"Modifier l'objectif":"Nouvel objectif"})}),e.jsxs("div",{className:"mt-6 space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{children:"Nageur"}),e.jsx("p",{className:"text-sm font-medium",children:a})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{children:"Type d'objectif"}),e.jsxs(Wt,{type:"single",variant:"outline",value:p,onValueChange:h=>{h&&u(h)},className:"justify-start",children:[e.jsx(_e,{value:"chrono",className:"text-xs",children:"Chrono"}),e.jsx(_e,{value:"texte",className:"text-xs",children:"Texte"}),e.jsx(_e,{value:"both",className:"text-xs",children:"Les deux"})]})]}),$&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{children:"Epreuve *"}),e.jsxs(Y,{value:l,onValueChange:x,children:[e.jsx(X,{children:e.jsx(J,{placeholder:"Choisir une epreuve"})}),e.jsx(Z,{children:Ot.map(h=>e.jsx(Q,{value:h,children:Te(h)},h))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{children:"Bassin"}),e.jsxs(Y,{value:j,onValueChange:g,children:[e.jsx(X,{children:e.jsx(J,{})}),e.jsxs(Z,{children:[e.jsx(Q,{value:"25",children:"25m"}),e.jsx(Q,{value:"50",children:"50m"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{children:"Temps cible (min:sec:centiemes)"}),e.jsx(Ae,{placeholder:"Ex : 1:05:30",value:v,onChange:h=>_(h.target.value)})]})]}),B&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{children:"Objectif texte *"}),e.jsx(te,{placeholder:"Ex : Ameliorer la coulee de dos",value:N,onChange:h=>C(h.target.value),rows:3})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{children:"Lier a une competition"}),e.jsxs(Y,{value:S,onValueChange:D,children:[e.jsx(X,{children:e.jsx(J,{placeholder:"Aucune"})}),e.jsxs(Z,{children:[e.jsx(Q,{value:"none",children:"Aucune"}),K.map(h=>e.jsxs(Q,{value:h.id,children:[h.name," (",h.date,")"]},h.id))]})]})]}),e.jsxs("div",{className:"space-y-2 pt-2",children:[e.jsx(T,{className:"w-full",onClick:Ce,disabled:z,children:z?"Enregistrement...":f?"Enregistrer":"Creer"}),f&&e.jsx(T,{variant:"outline",className:"w-full text-destructive hover:text-destructive",onClick:()=>q(!0),disabled:z,children:"Supprimer cet objectif"})]})]})]})}),e.jsx(ne,{open:P,onOpenChange:q,children:e.jsxs(ae,{children:[e.jsxs(re,{children:[e.jsx(ie,{children:"Supprimer l'objectif"}),e.jsx(oe,{children:"Cette action est irreversible. L'objectif sera supprime definitivement."})]}),e.jsxs(ce,{children:[e.jsx(le,{children:"Annuler"}),e.jsx(de,{onClick:()=>{w.mutate(),q(!1)},className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Supprimer"})]})]})})]})},as=({objective:t,onEdit:n})=>{const s=!!t.event_code,a=!!t.text;return e.jsxs("button",{type:"button",className:"w-full text-left rounded-xl border bg-card p-3 space-y-1.5 transition-colors hover:bg-muted/50",onClick:()=>n(t),children:[s&&e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"text-sm font-semibold",children:Te(t.event_code)}),t.pool_length&&e.jsxs(V,{variant:"secondary",className:"text-[10px] px-1.5 py-0",children:[t.pool_length,"m"]}),t.target_time_seconds!=null&&e.jsx(V,{variant:"outline",className:"text-[10px] px-1.5 py-0 font-mono",children:De(t.target_time_seconds)})]}),a&&e.jsx("p",{className:"text-sm text-muted-foreground line-clamp-2",children:t.text}),t.competition_name&&e.jsx(V,{variant:"outline",className:"border-orange-300 text-orange-600 dark:text-orange-400 text-[10px] px-1.5 py-0",children:t.competition_name})]})},rs=({athleteId:t,athleteName:n})=>{const[s,a]=m.useState(!1),[o,r]=m.useState(null),{data:i,isLoading:d}=A({queryKey:["auth-uid",t],queryFn:()=>ss(t),enabled:!!t}),{data:f=[]}=A({queryKey:["competitions"],queryFn:()=>y.getCompetitions()}),{data:p=[],isLoading:u}=A({queryKey:["objectives",i],queryFn:()=>y.getObjectives(i),enabled:!!i}),l=()=>{r(null),a(!0)},x=v=>{r(v),a(!0)},j=d,g=!!i&&!d;return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex justify-end",children:e.jsxs(T,{variant:"outline",size:"sm",onClick:l,disabled:!i,children:[e.jsx(ee,{className:"mr-1.5 h-3.5 w-3.5"}),"Ajouter un objectif"]})}),j&&e.jsx("div",{className:"space-y-2",children:[1,2,3].map(v=>e.jsx("div",{className:"rounded-xl border p-3 animate-pulse motion-reduce:animate-none",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-4 w-40 rounded bg-muted"}),e.jsx("div",{className:"ml-auto h-5 w-12 rounded bg-muted"})]})},v))}),g&&u&&e.jsx("div",{className:"space-y-2",children:[1,2].map(v=>e.jsx("div",{className:"rounded-xl border p-3 animate-pulse motion-reduce:animate-none",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-4 w-32 rounded bg-muted"}),e.jsx("div",{className:"ml-auto h-5 w-16 rounded bg-muted"})]})},v))}),g&&!u&&p.length===0&&e.jsxs("div",{className:"text-center py-12 space-y-3",children:[e.jsx(Xe,{className:"h-10 w-10 text-muted-foreground mx-auto"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Aucun objectif defini pour ",n,"."]}),e.jsxs(T,{variant:"outline",size:"sm",onClick:l,children:[e.jsx(ee,{className:"mr-1.5 h-3.5 w-3.5"}),"Creer le premier objectif"]})]}),g&&!u&&p.length>0&&e.jsx("div",{className:"space-y-2",children:p.map(v=>e.jsx(as,{objective:v,onEdit:x},v.id))}),i&&e.jsx(ns,{open:s,onOpenChange:a,objective:o,athleteName:n,athleteAuthId:i,competitions:f})]})};function Se(t,n){const s=[],a=new Date(t+"T00:00:00"),o=new Date(n+"T00:00:00"),r=new Date(a),i=r.getDay(),d=i===0?1:i===1?0:8-i;for(r.setDate(r.getDate()+d);r<=o;)s.push(r.toISOString().split("T")[0]),r.setDate(r.getDate()+7);return s}function is(t){let n=0;for(let a=0;a<t.length;a++)n=t.charCodeAt(a)+((n<<5)-n);return`hsl(${Math.abs(n)%360}, 70%, 85%)`}function os(t){let n=0;for(let a=0;a<t.length;a++)n=t.charCodeAt(a)+((n<<5)-n);return`hsl(${Math.abs(n)%360}, 60%, 30%)`}function fe(t){return new Date(t+"T00:00:00").toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric"})}function xe(t){return new Date(t+"T00:00:00").toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit"})}function cs(t){const n=new Date(t+"T00:00:00");return n.setDate(n.getDate()+6),n.toISOString().split("T")[0]}function ls(t){const n=new Date;n.setHours(0,0,0,0);const s=new Date(t+"T00:00:00"),a=new Date(t+"T00:00:00");return a.setDate(a.getDate()+6),n>=s&&n<=a}const ds=({athleteId:t})=>{const{toast:n}=ye(),s=ve(),[a,o]=m.useState(null),[r,i]=m.useState(null),[d,f]=m.useState(""),[p,u]=m.useState(""),[l,x]=m.useState(!1),[j,g]=m.useState(!1),[v,_]=m.useState(!1),[N,C]=m.useState(""),[S,D]=m.useState(""),[P,q]=m.useState(""),{data:R=[]}=A({queryKey:["athletes"],queryFn:()=>y.getAthletes()}),k=m.useMemo(()=>R.find(b=>b.id===t)?.group_id??null,[R,t]),{data:w=[],isLoading:$}=A({queryKey:["training-cycles","athlete",t],queryFn:()=>y.getTrainingCycles({athleteId:t})}),{data:B=[],isLoading:Ce}=A({queryKey:["training-cycles","group",k],queryFn:()=>y.getTrainingCycles({groupId:k}),enabled:k!=null}),z=w.length===0&&B.length>0,K=w.length>0?w:B;m.useEffect(()=>{K.length>0&&(!a||!K.find(c=>c.id===a))&&o(K[0].id)},[K,a]);const h=K.find(c=>c.id===a)??null,{data:W=[],isLoading:jt}=A({queryKey:["training-weeks",a],queryFn:()=>y.getTrainingWeeks(a),enabled:!!a}),{data:G=[]}=A({queryKey:["competitions"],queryFn:()=>y.getCompetitions()}),Oe=m.useMemo(()=>[...G].sort((c,b)=>c.date.localeCompare(b.date)),[G]),vt=m.useMemo(()=>{const c=new Set;return W.forEach(b=>{b.week_type&&c.add(b.week_type)}),Array.from(c).sort()},[W]),yt=m.useMemo(()=>{if(!h)return[];const c=h.start_competition_date,b=h.end_competition_date;return!c||!b?[]:Se(c,b)},[h]),bt=m.useMemo(()=>{const c=new Map;return W.forEach(b=>c.set(b.week_start,b)),c},[W]),Ke=$||Ce,we=M({mutationFn:async c=>{const b=await y.createTrainingCycle(c),I=G.find(H=>H.id===c.start_competition_id),U=G.find(H=>H.id===c.end_competition_id);if(I&&U){const H=Se(I.date,U.date);H.length>0&&await y.bulkUpsertTrainingWeeks(H.map(kt=>({cycle_id:b.id,week_start:kt})))}return b},onSuccess:c=>{n({title:"Cycle cree"}),o(c.id),x(!1),C(""),D(""),q(""),s.invalidateQueries({queryKey:["training-cycles"]}),s.invalidateQueries({queryKey:["training-weeks",c.id]})},onError:c=>{n({title:"Erreur",description:c.message,variant:"destructive"})}}),Nt=M({mutationFn:c=>y.deleteTrainingCycle(c),onSuccess:()=>{n({title:"Cycle supprime"}),o(null),g(!1),s.invalidateQueries({queryKey:["training-cycles"]})},onError:c=>{n({title:"Erreur",description:c.message,variant:"destructive"})}}),We=M({mutationFn:c=>y.upsertTrainingWeek(c),onSuccess:()=>{i(null),s.invalidateQueries({queryKey:["training-weeks",a]})},onError:c=>{n({title:"Erreur",description:c.message,variant:"destructive"})}}),Ve=M({mutationFn:async()=>{for(const c of B){const b=await y.createTrainingCycle({athlete_id:t,group_id:null,start_competition_id:c.start_competition_id,end_competition_id:c.end_competition_id,name:c.name,notes:c.notes}),I=await y.getTrainingWeeks(c.id);I.length>0&&await y.bulkUpsertTrainingWeeks(I.map(U=>({cycle_id:b.id,week_start:U.week_start,week_type:U.week_type,notes:U.notes})))}},onSuccess:()=>{n({title:"Planification personnalisee"}),_(!1),o(null),s.invalidateQueries({queryKey:["training-cycles"]})},onError:c=>{n({title:"Erreur",description:c.message,variant:"destructive"})}}),$e=()=>{if(!N.trim()){n({title:"Nom requis",variant:"destructive"});return}if(!S||!P){n({title:"Competitions requises",description:"Selectionnez les competitions de debut et fin.",variant:"destructive"});return}const c=G.find(I=>I.id===S),b=G.find(I=>I.id===P);if(c&&b&&b.date<=c.date){n({title:"Dates invalides",description:"La competition de fin doit etre apres celle de debut.",variant:"destructive"});return}we.mutate({athlete_id:t,group_id:null,start_competition_id:S,end_competition_id:P,name:N.trim()})},Ct=c=>{i(c.id),f(c.week_type??""),u(c.notes??"")},wt=c=>{i(`new:${c}`),f(""),u("")},_t=(c,b)=>{a&&We.mutate({cycle_id:a,week_start:c,week_type:d.trim()||null,notes:p.trim()||null})},St=()=>{i(null)};return!Ke&&K.length===0?e.jsxs("div",{className:"text-center py-12 space-y-3",children:[e.jsx(st,{className:"h-10 w-10 text-muted-foreground mx-auto"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Aucun cycle de planification."}),e.jsxs(T,{variant:"outline",size:"sm",onClick:()=>x(!0),children:[e.jsx(ee,{className:"mr-1.5 h-3.5 w-3.5"}),"Nouveau cycle"]}),e.jsx(Qe,{open:l,onOpenChange:x,competitions:Oe,name:N,setName:C,startId:S,setStartId:D,endId:P,setEndId:q,onSubmit:$e,isPending:we.isPending})]}):Ke?e.jsx("div",{className:"space-y-3",children:[1,2,3].map(c=>e.jsx("div",{className:"rounded-xl border p-3 animate-pulse motion-reduce:animate-none",children:e.jsx("div",{className:"h-4 w-48 rounded bg-muted"})},c))}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[K.length>1?e.jsxs(Y,{value:a??"",onValueChange:o,children:[e.jsx(X,{className:"w-auto min-w-[180px] h-8 text-sm",children:e.jsx(J,{placeholder:"Choisir un cycle"})}),e.jsx(Z,{children:K.map(c=>e.jsx(Q,{value:c.id,children:c.name},c.id))})]}):h?e.jsx("span",{className:"text-sm font-semibold",children:h.name}):null,z&&e.jsx(V,{variant:"secondary",className:"text-[10px] px-1.5 py-0",children:"Planif. groupe"}),e.jsx("div",{className:"flex-1"}),z&&e.jsxs(T,{variant:"outline",size:"sm",className:"text-xs h-7",onClick:()=>_(!0),children:[e.jsx(Vt,{className:"mr-1 h-3 w-3"}),"Personnaliser"]}),e.jsxs(T,{variant:"outline",size:"sm",className:"text-xs h-7",onClick:()=>x(!0),children:[e.jsx(ee,{className:"mr-1 h-3 w-3"}),"Nouveau"]}),h&&!z&&e.jsx(T,{variant:"ghost",size:"sm",className:"text-xs h-7 text-destructive hover:text-destructive",onClick:()=>g(!0),children:e.jsx(Ze,{className:"h-3 w-3"})})]}),h&&e.jsxs("div",{className:"space-y-0",children:[e.jsxs("div",{className:"flex items-center gap-2 py-2 px-1",children:[e.jsx("span",{className:"text-base","aria-hidden":"true",children:"ðŸŠ"}),e.jsx("span",{className:"text-sm font-medium",children:h.start_competition_name??"Competition"}),h.start_competition_date&&e.jsxs("span",{className:"text-xs text-muted-foreground",children:["(",fe(h.start_competition_date),")"]})]}),e.jsx("div",{className:"relative ml-3 border-l-2 border-border pl-4 space-y-1",children:jt?e.jsx("div",{className:"py-4",children:e.jsx("div",{className:"h-4 w-32 rounded bg-muted animate-pulse motion-reduce:animate-none"})}):yt.map((c,b)=>{const I=bt.get(c),U=ls(c),H=r===(I?.id??`new:${c}`);return e.jsx(us,{monday:c,weekNumber:b+1,week:I,isCurrent:U,isEditing:H,isGroupPlan:z,editWeekType:d,setEditWeekType:f,editWeekNotes:p,setEditWeekNotes:u,existingWeekTypes:vt,onStartEdit:()=>I?Ct(I):wt(c),onSave:()=>_t(c),onCancel:St,isSaving:We.isPending},c)})}),e.jsxs("div",{className:"flex items-center gap-2 py-2 px-1",children:[e.jsx("span",{className:"text-base","aria-hidden":"true",children:"ðŸŽ¯"}),e.jsx("span",{className:"text-sm font-medium",children:h.end_competition_name??"Competition"}),h.end_competition_date&&e.jsxs("span",{className:"text-xs text-muted-foreground",children:["(",fe(h.end_competition_date),")"]})]})]}),e.jsx(Qe,{open:l,onOpenChange:x,competitions:Oe,name:N,setName:C,startId:S,setStartId:D,endId:P,setEndId:q,onSubmit:$e,isPending:we.isPending}),e.jsx(ne,{open:j,onOpenChange:g,children:e.jsxs(ae,{children:[e.jsxs(re,{children:[e.jsx(ie,{children:"Supprimer le cycle"}),e.jsx(oe,{children:"Cette action est irreversible. Le cycle et toutes ses semaines seront supprimes."})]}),e.jsxs(ce,{children:[e.jsx(le,{children:"Annuler"}),e.jsx(de,{onClick:()=>a&&Nt.mutate(a),className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Supprimer"})]})]})}),e.jsx(ne,{open:v,onOpenChange:_,children:e.jsxs(ae,{children:[e.jsxs(re,{children:[e.jsx(ie,{children:"Personnaliser la planification"}),e.jsx(oe,{children:"Les cycles du groupe seront copies en tant que planification individuelle pour ce nageur. Vous pourrez ensuite les modifier independamment."})]}),e.jsxs(ce,{children:[e.jsx(le,{children:"Annuler"}),e.jsx(de,{onClick:()=>Ve.mutate(),children:Ve.isPending?"Copie...":"Personnaliser"})]})]})})]})},us=({monday:t,weekNumber:n,week:s,isCurrent:a,isEditing:o,isGroupPlan:r,editWeekType:i,setEditWeekType:d,editWeekNotes:f,setEditWeekNotes:p,existingWeekTypes:u,onStartEdit:l,onSave:x,onCancel:j,isSaving:g})=>{const v=cs(t),_=`week-types-${t}`;return o?e.jsxs("div",{className:`rounded-lg border bg-card p-3 space-y-2 ${a?"ring-2 ring-primary":""}`,children:[e.jsxs("div",{className:"text-xs font-medium text-muted-foreground",children:["Sem. ",n," (",xe(t)," - ",xe(v),")"]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(E,{className:"text-xs",children:"Type de semaine"}),e.jsx(Ae,{className:"h-7 text-sm",placeholder:"Ex : Foncier, Affutage, Recup...",list:_,value:i,onChange:N=>d(N.target.value)}),e.jsx("datalist",{id:_,children:u.map(N=>e.jsx("option",{value:N},N))})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(E,{className:"text-xs",children:"Notes"}),e.jsx(te,{className:"text-sm min-h-[48px]",placeholder:"Notes optionnelles...",rows:2,value:f,onChange:N=>p(N.target.value)})]}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsxs(T,{variant:"ghost",size:"sm",className:"h-7 text-xs",onClick:j,children:[e.jsx(Tt,{className:"mr-1 h-3 w-3"}),"Annuler"]}),e.jsxs(T,{size:"sm",className:"h-7 text-xs",onClick:x,disabled:g,children:[e.jsx($t,{className:"mr-1 h-3 w-3"}),g?"...":"Enregistrer"]})]})]}):e.jsxs("button",{type:"button",className:`w-full text-left rounded-lg border bg-card px-3 py-2 flex items-center gap-2 transition-colors ${r?"cursor-default":"hover:bg-muted/50"} ${a?"ring-2 ring-primary":""}`,onClick:r?void 0:l,disabled:r,children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs("span",{className:"text-xs font-medium text-muted-foreground whitespace-nowrap",children:["Sem. ",n]}),e.jsxs("span",{className:"text-[10px] text-muted-foreground/70 whitespace-nowrap",children:["(",xe(t)," - ",xe(v),")"]}),s?.week_type&&e.jsx(V,{className:"text-[10px] px-1.5 py-0 border-0",style:{backgroundColor:is(s.week_type),color:os(s.week_type)},children:s.week_type})]}),s?.notes&&e.jsx("p",{className:"text-xs text-muted-foreground mt-0.5 line-clamp-1",children:s.notes})]}),!r&&e.jsx(zt,{className:"h-3 w-3 text-muted-foreground/40 shrink-0"})]})},Qe=({open:t,onOpenChange:n,competitions:s,name:a,setName:o,startId:r,setStartId:i,endId:d,setEndId:f,onSubmit:p,isPending:u})=>(m.useEffect(()=>{t&&(o(""),i(""),f(""))},[t]),e.jsx(Pe,{open:t,onOpenChange:n,children:e.jsxs(Ie,{side:"right",className:"w-full sm:max-w-md overflow-y-auto",children:[e.jsx(qe,{children:e.jsx(Fe,{children:"Nouveau cycle"})}),e.jsxs("div",{className:"mt-6 space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{children:"Nom du cycle *"}),e.jsx(Ae,{placeholder:"Ex : Preparation hiver",value:a,onChange:l=>o(l.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{children:"Competition de debut *"}),e.jsxs(Y,{value:r,onValueChange:i,children:[e.jsx(X,{children:e.jsx(J,{placeholder:"Choisir..."})}),e.jsx(Z,{children:s.map(l=>e.jsxs(Q,{value:l.id,children:[l.name," (",fe(l.date),")"]},l.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{children:"Competition de fin *"}),e.jsxs(Y,{value:d,onValueChange:f,children:[e.jsx(X,{children:e.jsx(J,{placeholder:"Choisir..."})}),e.jsx(Z,{children:s.map(l=>e.jsxs(Q,{value:l.id,children:[l.name," (",fe(l.date),")"]},l.id))})]})]}),r&&d&&(()=>{const l=s.find(j=>j.id===r),x=s.find(j=>j.id===d);if(l&&x&&x.date>l.date){const j=Se(l.date,x.date).length;return e.jsxs("p",{className:"text-xs text-muted-foreground",children:[j," semaine",j>1?"s":""," seront generees."]})}return null})(),e.jsx(T,{className:"w-full",onClick:p,disabled:u,children:u?"Creation...":"Creer le cycle"})]})]})}));function ms(t,n,{checkForDefaultPrevented:s=!0}={}){return function(o){if(t?.(o),s===!1||!o.defaultPrevented)return n?.(o)}}var xs=At[" useInsertionEffect ".trim().toString()]||Dt;function nt({prop:t,defaultProp:n,onChange:s=()=>{},caller:a}){const[o,r,i]=hs({defaultProp:n,onChange:s}),d=t!==void 0,f=d?t:o;{const u=m.useRef(t!==void 0);m.useEffect(()=>{const l=u.current;l!==d&&console.warn(`${a} is changing from ${l?"controlled":"uncontrolled"} to ${d?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),u.current=d},[d,a])}const p=m.useCallback(u=>{if(d){const l=ps(u)?u(t):u;l!==t&&i.current?.(l)}else r(u)},[d,t,r,i]);return[f,p]}function hs({defaultProp:t,onChange:n}){const[s,a]=m.useState(t),o=m.useRef(s),r=m.useRef(n);return xs(()=>{r.current=n},[n]),m.useEffect(()=>{o.current!==s&&(r.current?.(s),o.current=s)},[s,o]),[s,a,r]}function ps(t){return typeof t=="function"}var O="Accordion",gs=["Home","End","ArrowDown","ArrowUp","ArrowLeft","ArrowRight"],[Re,fs,js]=Ut(O),[be]=Pt(O,[js,et]),Le=et(),at=F.forwardRef((t,n)=>{const{type:s,...a}=t,o=a,r=a;return e.jsx(Re.Provider,{scope:t.__scopeAccordion,children:s==="multiple"?e.jsx(Ns,{...r,ref:n}):e.jsx(bs,{...o,ref:n})})});at.displayName=O;var[rt,vs]=be(O),[it,ys]=be(O,{collapsible:!1}),bs=F.forwardRef((t,n)=>{const{value:s,defaultValue:a,onValueChange:o=()=>{},collapsible:r=!1,...i}=t,[d,f]=nt({prop:s,defaultProp:a??"",onChange:o,caller:O});return e.jsx(rt,{scope:t.__scopeAccordion,value:F.useMemo(()=>d?[d]:[],[d]),onItemOpen:f,onItemClose:F.useCallback(()=>r&&f(""),[r,f]),children:e.jsx(it,{scope:t.__scopeAccordion,collapsible:r,children:e.jsx(ot,{...i,ref:n})})})}),Ns=F.forwardRef((t,n)=>{const{value:s,defaultValue:a,onValueChange:o=()=>{},...r}=t,[i,d]=nt({prop:s,defaultProp:a??[],onChange:o,caller:O}),f=F.useCallback(u=>d((l=[])=>[...l,u]),[d]),p=F.useCallback(u=>d((l=[])=>l.filter(x=>x!==u)),[d]);return e.jsx(rt,{scope:t.__scopeAccordion,value:i,onItemOpen:f,onItemClose:p,children:e.jsx(it,{scope:t.__scopeAccordion,collapsible:!0,children:e.jsx(ot,{...r,ref:n})})})}),[Cs,Ne]=be(O),ot=F.forwardRef((t,n)=>{const{__scopeAccordion:s,disabled:a,dir:o,orientation:r="vertical",...i}=t,d=F.useRef(null),f=It(d,n),p=fs(s),l=Ht(o)==="ltr",x=ms(t.onKeyDown,j=>{if(!gs.includes(j.key))return;const g=j.target,v=p().filter(k=>!k.ref.current?.disabled),_=v.findIndex(k=>k.ref.current===g),N=v.length;if(_===-1)return;j.preventDefault();let C=_;const S=0,D=N-1,P=()=>{C=_+1,C>D&&(C=S)},q=()=>{C=_-1,C<S&&(C=D)};switch(j.key){case"Home":C=S;break;case"End":C=D;break;case"ArrowRight":r==="horizontal"&&(l?P():q());break;case"ArrowDown":r==="vertical"&&P();break;case"ArrowLeft":r==="horizontal"&&(l?q():P());break;case"ArrowUp":r==="vertical"&&q();break}const R=C%N;v[R].ref.current?.focus()});return e.jsx(Cs,{scope:s,disabled:a,direction:o,orientation:r,children:e.jsx(Re.Slot,{scope:s,children:e.jsx(Ge.div,{...i,"data-orientation":r,ref:f,onKeyDown:a?void 0:x})})})}),je="AccordionItem",[ws,Me]=be(je),ct=F.forwardRef((t,n)=>{const{__scopeAccordion:s,value:a,...o}=t,r=Ne(je,s),i=vs(je,s),d=Le(s),f=Yt(),p=a&&i.value.includes(a)||!1,u=r.disabled||t.disabled;return e.jsx(ws,{scope:s,open:p,disabled:u,triggerId:f,children:e.jsx(Qt,{"data-orientation":r.orientation,"data-state":ht(p),...d,...o,ref:n,disabled:u,open:p,onOpenChange:l=>{l?i.onItemOpen(a):i.onItemClose(a)}})})});ct.displayName=je;var lt="AccordionHeader",dt=F.forwardRef((t,n)=>{const{__scopeAccordion:s,...a}=t,o=Ne(O,s),r=Me(lt,s);return e.jsx(Ge.h3,{"data-orientation":o.orientation,"data-state":ht(r.open),"data-disabled":r.disabled?"":void 0,...a,ref:n})});dt.displayName=lt;var ke="AccordionTrigger",ut=F.forwardRef((t,n)=>{const{__scopeAccordion:s,...a}=t,o=Ne(O,s),r=Me(ke,s),i=ys(ke,s),d=Le(s);return e.jsx(Re.ItemSlot,{scope:s,children:e.jsx(Bt,{"aria-disabled":r.open&&!i.collapsible||void 0,"data-orientation":o.orientation,id:r.triggerId,...d,...a,ref:n})})});ut.displayName=ke;var mt="AccordionContent",xt=F.forwardRef((t,n)=>{const{__scopeAccordion:s,...a}=t,o=Ne(O,s),r=Me(mt,s),i=Le(s);return e.jsx(Gt,{role:"region","aria-labelledby":r.triggerId,"data-orientation":o.orientation,...i,...a,ref:n,style:{"--radix-accordion-content-height":"var(--radix-collapsible-content-height)","--radix-accordion-content-width":"var(--radix-collapsible-content-width)",...t.style}})});xt.displayName=mt;function ht(t){return t?"open":"closed"}var _s=at,Ss=ct,ks=dt,pt=ut,gt=xt;const As=_s,he=m.forwardRef(({className:t,...n},s)=>e.jsx(Ss,{ref:s,className:Ee("border-b",t),...n}));he.displayName="AccordionItem";const pe=m.forwardRef(({className:t,children:n,...s},a)=>e.jsx(ks,{className:"flex",children:e.jsxs(pt,{ref:a,className:Ee("flex flex-1 items-center justify-between py-4 text-sm font-medium transition-all hover:underline text-left [&[data-state=open]>svg]:rotate-180",t),...s,children:[n,e.jsx(Ye,{className:"h-4 w-4 shrink-0 text-muted-foreground transition-transform duration-200"})]})}));pe.displayName=pt.displayName;const ge=m.forwardRef(({className:t,children:n,...s},a)=>e.jsx(gt,{ref:a,className:"overflow-hidden text-sm data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down",...s,children:e.jsx("div",{className:Ee("pb-4 pt-0",t),children:n})}));ge.displayName=gt.displayName;function se(t){return new Date(t+"T12:00:00").toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric"})}const Es={draft_athlete:{label:"En attente nageur",variant:"secondary",className:"bg-amber-100 text-amber-800 dark:bg-amber-900/40 dark:text-amber-300 border-amber-200 dark:border-amber-800"},draft_coach:{label:"Preparation coach",variant:"secondary",className:"bg-blue-100 text-blue-800 dark:bg-blue-900/40 dark:text-blue-300 border-blue-200 dark:border-blue-800"},sent:{label:"Envoye",variant:"secondary",className:"bg-green-100 text-green-800 dark:bg-green-900/40 dark:text-green-300 border-green-200 dark:border-green-800"},signed:{label:"Signe",variant:"secondary",className:"bg-slate-100 text-slate-600 dark:bg-slate-800/40 dark:text-slate-300 border-slate-200 dark:border-slate-700"}};function ft(t){const n=Es[t];return e.jsx(V,{variant:n.variant,className:`text-[10px] px-1.5 py-0 ${n.className}`,children:n.label})}function Ts(t){const n=[t.athlete_successes,t.athlete_difficulties,t.athlete_goals,t.athlete_commitments,t.coach_review,t.coach_objectives,t.coach_actions];for(const s of n)if(s&&s.trim())return s.trim();return null}async function Ds(t){const{data:n,error:s}=await Be.rpc("get_auth_uid_for_user",{p_user_id:t});return s?(console.error("[interviews-tab] Failed to resolve auth UUID:",s.message),null):n}const L=({label:t,text:n})=>e.jsxs("div",{className:"space-y-1",children:[e.jsx(E,{className:"text-xs text-muted-foreground",children:t}),e.jsx("div",{className:"rounded-lg bg-muted/50 p-3 text-sm whitespace-pre-wrap",children:n?.trim()||e.jsx("span",{className:"text-muted-foreground italic",children:"Non renseigne"})})]}),Ps=({athleteId:t,athleteAuthId:n,interview:s})=>{const{data:a=[]}=A({queryKey:["objectives",n],queryFn:()=>y.getObjectives(n),enabled:!!n}),{data:o=[]}=A({queryKey:["training-cycles","athlete",t],queryFn:()=>y.getTrainingCycles({athleteId:t})}),r=s.current_cycle_id??(o.length>0?o[0].id:null),i=o.find(x=>x.id===r)??null,{data:d=[]}=A({queryKey:["training-weeks",r],queryFn:()=>y.getTrainingWeeks(r),enabled:!!r}),f=m.useMemo(()=>{const x=new Date;x.setHours(0,0,0,0);for(const j of d){const g=new Date(j.week_start+"T00:00:00"),v=new Date(j.week_start+"T00:00:00");if(v.setDate(v.getDate()+6),x>=g&&x<=v)return j}return null},[d]),{data:p=[]}=A({queryKey:["competitions"],queryFn:()=>y.getCompetitions()}),{data:u=[]}=A({queryKey:["my-competition-ids",t],queryFn:()=>y.getMyCompetitionIds(t)}),l=m.useMemo(()=>{const x=new Date;x.setHours(0,0,0,0);const j=new Set(u);return p.filter(g=>j.has(g.id)&&new Date(g.date+"T00:00:00")>=x).sort((g,v)=>g.date.localeCompare(v.date))},[p,u]);return e.jsxs(As,{type:"multiple",className:"mt-4",children:[e.jsxs(he,{value:"objectives",children:[e.jsxs(pe,{className:"text-sm py-3",children:["Objectifs (",a.length,")"]}),e.jsx(ge,{children:a.length===0?e.jsx("p",{className:"text-xs text-muted-foreground italic",children:"Aucun objectif defini."}):e.jsx("div",{className:"space-y-2",children:a.map(x=>e.jsx(Is,{objective:x},x.id))})})]}),e.jsxs(he,{value:"planning",children:[e.jsx(pe,{className:"text-sm py-3",children:"Planification"}),e.jsx(ge,{children:i?e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm font-medium",children:i.name}),f?e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Semaine en cours : ",f.week_type??"Non defini"]}):e.jsx("p",{className:"text-xs text-muted-foreground italic",children:"Pas de semaine en cours."})]}):e.jsx("p",{className:"text-xs text-muted-foreground italic",children:"Aucun cycle de planification."})})]}),e.jsxs(he,{value:"competitions",children:[e.jsxs(pe,{className:"text-sm py-3",children:["Competitions (",l.length,")"]}),e.jsx(ge,{children:l.length===0?e.jsx("p",{className:"text-xs text-muted-foreground italic",children:"Aucune competition assignee a venir."}):e.jsx("div",{className:"space-y-1.5",children:l.map(x=>e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{children:x.name}),e.jsx("span",{className:"text-xs text-muted-foreground",children:se(x.date)})]},x.id))})})]})]})},Is=({objective:t})=>{const n=!!t.event_code,s=!!t.text;return e.jsxs("div",{className:"rounded-lg border bg-card p-2.5 text-sm space-y-0.5",children:[n&&e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"font-medium",children:Te(t.event_code)}),t.pool_length&&e.jsxs(V,{variant:"secondary",className:"text-[10px] px-1.5 py-0",children:[t.pool_length,"m"]}),t.target_time_seconds!=null&&e.jsx(V,{variant:"outline",className:"text-[10px] px-1.5 py-0 font-mono",children:De(t.target_time_seconds)})]}),s&&e.jsx("p",{className:"text-muted-foreground line-clamp-2",children:t.text})]})},qs=({open:t,onOpenChange:n,interview:s,athleteId:a,athleteAuthId:o})=>{const{toast:r}=ye(),i=ve(),[d,f]=m.useState(""),[p,u]=m.useState(""),[l,x]=m.useState(""),[j,g]=m.useState(!1),[v,_]=m.useState(!1),[N,C]=m.useState(null);t&&s&&s.id!==N&&(f(s.coach_review??""),u(s.coach_objectives??""),x(s.coach_actions??""),C(s.id)),!t&&N!==null&&C(null);const S=M({mutationFn:w=>y.updateInterviewCoachSections(s.id,w),onSuccess:()=>{r({title:"Sections coach enregistrees"}),i.invalidateQueries({queryKey:["interviews",a]})},onError:w=>{r({title:"Erreur",description:w.message,variant:"destructive"})}}),D=M({mutationFn:async()=>(await y.updateInterviewCoachSections(s.id,{coach_review:d.trim()||null,coach_objectives:p.trim()||null,coach_actions:l.trim()||null}),y.sendInterviewToAthlete(s.id)),onSuccess:()=>{r({title:"Entretien envoye au nageur"}),i.invalidateQueries({queryKey:["interviews",a]}),n(!1)},onError:w=>{r({title:"Erreur",description:w.message,variant:"destructive"})}}),P=M({mutationFn:()=>y.deleteInterview(s.id),onSuccess:()=>{r({title:"Entretien supprime"}),i.invalidateQueries({queryKey:["interviews",a]}),n(!1)},onError:w=>{r({title:"Erreur",description:w.message,variant:"destructive"})}}),q=()=>{S.mutate({coach_review:d.trim()||null,coach_objectives:p.trim()||null,coach_actions:l.trim()||null})},R=S.isPending||D.isPending||P.isPending;if(!s)return null;const k=s.status;return e.jsxs(e.Fragment,{children:[e.jsx(Pe,{open:t,onOpenChange:n,children:e.jsxs(Ie,{side:"right",className:"w-full sm:max-w-lg overflow-y-auto",children:[e.jsx(qe,{children:e.jsxs(Fe,{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs("span",{children:["Entretien du ",se(s.date)]}),ft(k)]})}),e.jsxs("div",{className:"mt-6 space-y-5",children:[k==="draft_athlete"&&e.jsxs("div",{className:"rounded-xl border border-dashed border-amber-300 bg-amber-50/50 dark:bg-amber-950/20 p-6 text-center space-y-2",children:[e.jsx(tt,{className:"h-8 w-8 mx-auto text-amber-500"}),e.jsx("p",{className:"text-sm font-medium",children:"En attente de la preparation du nageur"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Le contenu n'est pas encore visible. Le nageur doit d'abord remplir ses sections."})]}),k==="draft_coach"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"text-sm font-semibold text-muted-foreground uppercase tracking-wide",children:"Preparation du nageur"}),e.jsx(L,{label:"Reussites",text:s.athlete_successes}),e.jsx(L,{label:"Difficultes",text:s.athlete_difficulties}),e.jsx(L,{label:"Objectifs personnels",text:s.athlete_goals}),e.jsx(L,{label:"Engagements",text:s.athlete_commitments})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"text-sm font-semibold text-muted-foreground uppercase tracking-wide",children:"Sections coach"}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(E,{className:"text-xs",children:"Commentaires du coach"}),e.jsx(te,{placeholder:"Votre analyse, points positifs, axes d'amelioration...",value:d,onChange:w=>f(w.target.value),rows:4})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(E,{className:"text-xs",children:"Objectifs ajoutes"}),e.jsx(te,{placeholder:"Objectifs complementaires pour le nageur...",value:p,onChange:w=>u(w.target.value),rows:3})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(E,{className:"text-xs",children:"Actions a suivre"}),e.jsx(te,{placeholder:"Actions concretes, points de suivi...",value:l,onChange:w=>x(w.target.value),rows:3})]})]}),e.jsx(Ps,{athleteId:a,athleteAuthId:o,interview:s})]}),(k==="sent"||k==="signed")&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"text-sm font-semibold text-muted-foreground uppercase tracking-wide",children:"Preparation du nageur"}),e.jsx(L,{label:"Reussites",text:s.athlete_successes}),e.jsx(L,{label:"Difficultes",text:s.athlete_difficulties}),e.jsx(L,{label:"Objectifs personnels",text:s.athlete_goals}),e.jsx(L,{label:"Engagements",text:s.athlete_commitments})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"text-sm font-semibold text-muted-foreground uppercase tracking-wide",children:"Sections coach"}),e.jsx(L,{label:"Commentaires du coach",text:s.coach_review}),e.jsx(L,{label:"Objectifs ajoutes",text:s.coach_objectives}),e.jsx(L,{label:"Actions a suivre",text:s.coach_actions})]}),k==="signed"&&s.signed_at&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(Xt,{className:"h-4 w-4 text-green-600"}),e.jsxs("span",{children:["Signe le ",se(s.signed_at.slice(0,10))]})]})]}),e.jsxs("div",{className:"space-y-2 pt-2 border-t",children:[k==="draft_coach"&&e.jsxs(e.Fragment,{children:[e.jsx(T,{className:"w-full",onClick:q,disabled:R,children:S.isPending?"Enregistrement...":"Enregistrer"}),e.jsxs(T,{className:"w-full",variant:"default",onClick:()=>_(!0),disabled:R,children:[e.jsx(Ue,{className:"mr-1.5 h-3.5 w-3.5"}),"Envoyer au nageur"]})]}),e.jsxs(T,{variant:"outline",className:"w-full text-destructive hover:text-destructive",onClick:()=>g(!0),disabled:R,children:[e.jsx(Ze,{className:"mr-1.5 h-3.5 w-3.5"}),"Supprimer"]})]})]})]})}),e.jsx(ne,{open:j,onOpenChange:g,children:e.jsxs(ae,{children:[e.jsxs(re,{children:[e.jsx(ie,{children:"Supprimer l'entretien"}),e.jsxs(oe,{children:["Cette action est irreversible. L'entretien du ",s.date?se(s.date):""," sera supprime definitivement."]})]}),e.jsxs(ce,{children:[e.jsx(le,{children:"Annuler"}),e.jsx(de,{onClick:()=>{P.mutate(),g(!1)},className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Supprimer"})]})]})}),e.jsx(ne,{open:v,onOpenChange:_,children:e.jsxs(ae,{children:[e.jsxs(re,{children:[e.jsx(ie,{children:"Envoyer au nageur"}),e.jsx(oe,{children:"L'entretien sera envoye au nageur pour consultation. Les sections coach seront enregistrees automatiquement."})]}),e.jsxs(ce,{children:[e.jsx(le,{children:"Annuler"}),e.jsxs(de,{onClick:()=>{D.mutate(),_(!1)},children:[e.jsx(Ue,{className:"mr-1.5 h-3.5 w-3.5"}),"Envoyer"]})]})]})})]})},Fs=({interview:t,onClick:n})=>{const s=Ts(t);return e.jsxs("button",{type:"button",className:"w-full text-left rounded-xl border bg-card p-3 space-y-1.5 transition-colors hover:bg-muted/50",onClick:n,children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"text-sm font-semibold",children:se(t.date)}),ft(t.status)]}),s&&e.jsx("p",{className:"text-xs text-muted-foreground line-clamp-2",children:s})]})},Rs=({athleteId:t,athleteName:n})=>{const{toast:s}=ye(),a=ve(),[o,r]=m.useState(null),[i,d]=m.useState(!1),{data:f}=A({queryKey:["auth-uid",t],queryFn:()=>Ds(t),enabled:!!t}),{data:p=[],isLoading:u}=A({queryKey:["interviews",t],queryFn:()=>y.getInterviews(t),enabled:!!t}),l=M({mutationFn:()=>y.createInterview({athlete_id:t}),onSuccess:g=>{s({title:"Entretien cree"}),a.invalidateQueries({queryKey:["interviews",t]}),r(g),d(!0)},onError:g=>{s({title:"Erreur",description:g.message,variant:"destructive"})}}),x=g=>{r(g),d(!0)},j=g=>{d(g),g||r(null)};return u?e.jsx("div",{className:"space-y-2",children:[1,2,3].map(g=>e.jsx("div",{className:"rounded-xl border p-3 animate-pulse motion-reduce:animate-none",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-4 w-24 rounded bg-muted"}),e.jsx("div",{className:"ml-auto h-5 w-20 rounded bg-muted"})]})},g))}):p.length===0?e.jsxs("div",{className:"text-center py-12 space-y-3",children:[e.jsx(Je,{className:"h-10 w-10 text-muted-foreground mx-auto"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Aucun entretien pour ",n,"."]}),e.jsxs(T,{variant:"outline",size:"sm",onClick:()=>l.mutate(),disabled:l.isPending,children:[e.jsx(ee,{className:"mr-1.5 h-3.5 w-3.5"}),l.isPending?"Creation...":"Nouvel entretien"]})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"text-sm font-semibold",children:"Entretiens"}),e.jsx(V,{variant:"secondary",className:"text-[10px] px-1.5 py-0",children:p.length})]}),e.jsxs(T,{variant:"outline",size:"sm",onClick:()=>l.mutate(),disabled:l.isPending,children:[e.jsx(ee,{className:"mr-1.5 h-3.5 w-3.5"}),l.isPending?"Creation...":"Nouvel entretien"]})]}),e.jsx("div",{className:"space-y-2",children:p.map(g=>e.jsx(Fs,{interview:g,onClick:()=>x(g)},g.id))}),e.jsx(qs,{open:i,onOpenChange:j,interview:o,athleteId:t,athleteAuthId:f??null})]})};function un(){const[,t]=qt("/coach/swimmer/:id"),[,n]=Ft(),{selectedAthleteId:s,selectedAthleteName:a}=Rt(),o=t?.id?Number(t.id):s,r=a,{data:i}=A({queryKey:["profile",o],queryFn:()=>y.getProfile({userId:o}),enabled:o!=null}),d=i?.display_name??r??"Nageur",f=i?.avatar_url??null,p=i?.group_label??null;return o?e.jsxs("div",{className:"mx-auto max-w-3xl px-4 py-4 space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{type:"button",onClick:()=>n("/coach?section=swimmers"),className:"h-9 w-9 rounded-xl border border-border bg-card flex items-center justify-center hover:bg-muted transition","aria-label":"Retour",children:e.jsx(Kt,{className:"h-4 w-4"})}),f?e.jsx("img",{src:f,alt:"",className:"h-10 w-10 rounded-full object-cover border border-border"}):e.jsx("div",{className:"h-10 w-10 rounded-full bg-primary/10 flex items-center justify-center text-sm font-bold text-primary",children:d.charAt(0).toUpperCase()}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h1",{className:"text-lg font-bold truncate",children:d}),p&&e.jsx(V,{variant:"secondary",className:"text-[10px] px-1.5 py-0",children:p})]})]}),e.jsxs(Lt,{defaultValue:"ressentis",children:[e.jsxs(Mt,{className:"w-full grid grid-cols-4",children:[e.jsxs(ue,{value:"ressentis",className:"text-xs gap-1",children:[e.jsx(tt,{className:"h-3.5 w-3.5"}),e.jsx("span",{className:"hidden sm:inline",children:"Ressentis"})]}),e.jsxs(ue,{value:"objectifs",className:"text-xs gap-1",children:[e.jsx(Xe,{className:"h-3.5 w-3.5"}),e.jsx("span",{className:"hidden sm:inline",children:"Objectifs"})]}),e.jsxs(ue,{value:"planification",className:"text-xs gap-1",children:[e.jsx(st,{className:"h-3.5 w-3.5"}),e.jsx("span",{className:"hidden sm:inline",children:"Planif."})]}),e.jsxs(ue,{value:"entretiens",className:"text-xs gap-1",children:[e.jsx(Je,{className:"h-3.5 w-3.5"}),e.jsx("span",{className:"hidden sm:inline",children:"Entretiens"})]})]}),e.jsx(me,{value:"ressentis",className:"mt-4",children:e.jsx(ts,{athleteId:o,athleteName:d})}),e.jsx(me,{value:"objectifs",className:"mt-4",children:e.jsx(rs,{athleteId:o,athleteName:d})}),e.jsx(me,{value:"planification",className:"mt-4",children:e.jsx(ds,{athleteId:o})}),e.jsx(me,{value:"entretiens",className:"mt-4",children:e.jsx(Rs,{athleteId:o,athleteName:d})})]})]}):e.jsxs("div",{className:"p-4 text-center text-muted-foreground",children:[e.jsx("p",{children:"Aucun nageur sÃ©lectionnÃ©."}),e.jsx("button",{type:"button",onClick:()=>n("/coach?section=swimmers"),className:"mt-2 text-primary underline",children:"Retour au dashboard"})]})}export{un as default};
