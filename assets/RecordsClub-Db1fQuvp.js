const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/export-records-pdf-3fq20nkp.js","assets/index-DsyO_7X-.js","assets/vendor-query-DyA9aSKS.js","assets/vendor-react-BzrpNAyj.js","assets/vendor-charts-BrQ8X25f.js","assets/vendor-supabase-DFPLkPj_.js","assets/vendor-motion-CMsaQ8FX.js","assets/index-Byj_haEW.css"])))=>i.map(i=>d[i]);
import{_ as se,B as P,w as te,T as S,a as _}from"./index-DsyO_7X-.js";import{r as u,u as T,j as e}from"./vendor-query-DyA9aSKS.js";import{a as E}from"./api-Cn-EMY5T.js";import{S as ae,a as ne,b as le,c as re,d as ie}from"./sheet-B9PSf2Xo.js";import{S as oe,a as ce,b as de,c as me,d as ue}from"./select-99sw7qO9.js";import{P as xe}from"./PageHeader-zu6CAMtP.js";import{S as ge}from"./sliders-horizontal-B01-gHYw.js";import{C as pe}from"./circle-alert-BKFROPew.js";import{C as O}from"./chevron-up-olq_juJw.js";import{C as he}from"./chevron-down-4Hx2ZXq9.js";import{C as be}from"./chevron-right-qB_Mu1QX.js";import"./vendor-react-BzrpNAyj.js";import"./vendor-charts-BrQ8X25f.js";import"./vendor-supabase-DFPLkPj_.js";import"./vendor-motion-CMsaQ8FX.js";import"./swim-DqLtdj3-.js";import"./index-BQvipP9s.js";import"./index-BkgruFcm.js";import"./index-xM6bjLsY.js";import"./index-DCX2sNhR.js";import"./chevron-left-5PHIhczB.js";const M=[{key:"25",label:"25m"},{key:"50",label:"50m"}],I=[{key:"M",label:"G"},{key:"F",label:"F"}],K=[{key:"ALL",label:"Tous les âges"},{key:"8",label:"≤ 8 ans"},{key:"9",label:"9 ans"},{key:"10",label:"10 ans"},{key:"11",label:"11 ans"},{key:"12",label:"12 ans"},{key:"13",label:"13 ans"},{key:"14",label:"14 ans"},{key:"15",label:"15 ans"},{key:"16",label:"16 ans"},{key:"17",label:"≥ 17 ans"}],fe=[{key:"FREE",label:"Nage Libre",events:[{id:"50_FREE",label:"50 NL"},{id:"100_FREE",label:"100 NL"},{id:"200_FREE",label:"200 NL"},{id:"400_FREE",label:"400 NL"},{id:"800_FREE",label:"800 NL"},{id:"1500_FREE",label:"1500 NL"}]},{key:"BACK",label:"Dos",events:[{id:"50_BACK",label:"50 Dos"},{id:"100_BACK",label:"100 Dos"},{id:"200_BACK",label:"200 Dos"}]},{key:"BREAST",label:"Brasse",events:[{id:"50_BREAST",label:"50 Br"},{id:"100_BREAST",label:"100 Br"},{id:"200_BREAST",label:"200 Br"}]},{key:"FLY",label:"Papillon",events:[{id:"50_FLY",label:"50 Pap"},{id:"100_FLY",label:"100 Pap"},{id:"200_FLY",label:"200 Pap"}]},{key:"IM",label:"4 Nages",events:[{id:"100_IM",label:"100 4N"},{id:"200_IM",label:"200 4N"},{id:"400_IM",label:"400 4N"}]}],A=s=>{if(!s&&s!==0)return"-";const n=Math.round(s/10),l=n%100,c=Math.floor(n/100),i=c%60,r=Math.floor(c/60),d=x=>String(x).padStart(2,"0");return r>0?`${r}:${d(i)}.${d(l)}`:`${i}.${d(l)}`},b=s=>{if(!s)return"";const n=new Date(s);return Number.isNaN(n.getTime())?"":String(n.getFullYear())},_e=s=>{if(!s)return null;const n=new Date(s);return Number.isNaN(n.getTime())?null:n.toLocaleDateString("fr-FR")+" à "+n.toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"})},j=s=>s===8?"≤8":s===17?"≥17":String(s);function D({options:s,value:n,onChange:l}){return e.jsx("div",{className:"inline-flex rounded-lg border bg-muted p-0.5",children:s.map(c=>e.jsx("button",{type:"button",onClick:()=>l(c.key),className:_("rounded-md px-3 py-1.5 text-sm font-medium transition-colors",n===c.key?"bg-background text-foreground shadow-sm":"text-muted-foreground hover:text-foreground"),children:c.label},c.key))})}function Ve(){const[s,n]=u.useState("50"),[l,c]=u.useState("M"),[i,r]=u.useState("17"),[d,x]=u.useState(null),[a,m]=u.useState(null),[p,f]=u.useState(!1),[L,N]=u.useState(!1),k=i==="ALL"?null:Number(i),q=M.find(t=>t.key===s)?.label??`${s}m`,H=I.find(t=>t.key===l)?.label??l,Y=K.find(t=>t.key===i)?.label??i,V=u.useCallback(t=>{n(t),x(null),m(null)},[]),z=u.useCallback(t=>{c(t),x(null),m(null)},[]),U=u.useCallback(t=>{r(t),x(null),m(null)},[]),{data:R}=T({queryKey:["last-import"],queryFn:()=>E.getImportLogs({limit:1})}),{data:F=[],isLoading:B,error:y,refetch:G}=T({queryKey:["club-records",s,l,i],queryFn:()=>E.getClubRecords({pool_m:Number(s),sex:l,age:k})}),w=u.useMemo(()=>d?k!==null?`${d}__${s}__${l}__${i}`:a:null,[d,k,a,s,l,i]),{data:J,isFetching:Q}=T({queryKey:["club-ranking",w],queryFn:()=>{if(!w)return[];const t=w.split("__");return E.getClubRanking({event_code:t[0],pool_m:Number(t[1]),sex:t[2],age:Number(t[3])})},enabled:!!w}),v=u.useMemo(()=>{const t=new Map;for(const o of F){const g=t.get(o.event_code)??[];g.push(o),t.set(o.event_code,g)}for(const o of t.values())o.sort((g,h)=>g.age-h.age);return t},[F]),X=u.useMemo(()=>{const t=new Map;for(const[o,g]of v){let h=g[0];for(const C of g)C.time_ms<h.time_ms&&(h=C);t.set(o,h)}return t},[v]),W=u.useCallback(t=>{x(o=>(m(null),o===t?null:t))},[]),Z=u.useCallback(t=>{const o=`${t.event_code}__${s}__${l}__${t.age}`;m(g=>g===o?null:o)},[s,l]),ee=u.useCallback(async()=>{f(!0);try{const t=await E.getClubRecords({}),{exportRecordsPdf:o}=await se(async()=>{const{exportRecordsPdf:g}=await import("./export-records-pdf-3fq20nkp.js").then(h=>h.e);return{exportRecordsPdf:g}},__vite__mapDeps([0,1,2,3,4,5,6,7]));await o(t)}catch{}finally{f(!1)}},[]),$=u.useMemo(()=>fe.map(t=>({...t,activeEvents:t.events.filter(o=>v.has(o.id))})).filter(t=>t.activeEvents.length>0),[v]);return e.jsxs("div",{className:"space-y-3",children:[e.jsx(xe,{title:"Records du club",subtitle:R?.[0]?.status==="success"?`MAJ : ${_e(R[0].completed_at??R[0].started_at)??"-"}`:void 0,icon:e.jsx(S,{className:"h-3.5 w-3.5"}),backHref:"/hall-of-fame",backLabel:"Retour aux classements",action:e.jsxs(P,{variant:"outline",size:"sm",onClick:ee,disabled:p,className:"border-primary/20 text-primary hover:bg-primary/5",children:[e.jsx(te,{className:"h-4 w-4 mr-1"}),p?"...":"PDF"]})}),e.jsx("div",{className:"rounded-2xl border border-border/70 bg-card/90 px-4 py-3 shadow-sm",children:e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-[11px] font-semibold uppercase tracking-[0.22em] text-muted-foreground",children:"Vue active"}),e.jsxs("p",{className:"mt-1 truncate text-sm font-semibold text-foreground",children:[q," · ",H," · ",Y]})]}),e.jsxs(P,{type:"button",variant:"outline",size:"sm",onClick:()=>N(!0),className:"gap-1.5 border-primary/20 text-primary hover:bg-primary/5",children:[e.jsx(ge,{className:"h-3.5 w-3.5"}),"Filtres"]})]})}),e.jsx(ae,{open:L,onOpenChange:N,children:e.jsxs(ne,{side:"bottom",className:"max-h-[85vh] overflow-y-auto rounded-t-3xl",children:[e.jsxs(le,{className:"text-left",children:[e.jsx(re,{children:"Filtrer les records du club"}),e.jsx(ie,{children:"Ajuste le bassin, le sexe et la tranche d'âge sans surcharger l'écran principal."})]}),e.jsxs("div",{className:"space-y-5 pt-5",children:[e.jsxs("section",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-foreground",children:"Bassin"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Choisis le format de compétition à afficher."})]}),e.jsx(D,{options:M,value:s,onChange:V})]}),e.jsxs("section",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-foreground",children:"Catégorie"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Bascule entre garçons et filles."})]}),e.jsx(D,{options:I,value:l,onChange:z})]}),e.jsxs("section",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-foreground",children:"Âge"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Affiche une génération précise ou tous les âges."})]}),e.jsxs(oe,{value:i,onValueChange:U,children:[e.jsx(ce,{className:"h-11 w-full text-sm",children:e.jsx(de,{})}),e.jsx(me,{children:K.map(t=>e.jsx(ue,{value:t.key,children:t.label},t.key))})]})]})]})]})}),B&&e.jsx("div",{className:"space-y-2 pt-2",children:[1,2,3,4,5].map(t=>e.jsx("div",{className:"h-14 w-full rounded-xl bg-muted animate-pulse motion-reduce:animate-none"},t))}),y&&e.jsxs("div",{className:"flex flex-col items-center justify-center p-8 text-center",children:[e.jsx(pe,{className:"h-12 w-12 text-destructive mb-4"}),e.jsx("h3",{className:"font-semibold",children:"Impossible de charger les données"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:y instanceof Error?y.message:"Une erreur s'est produite"}),e.jsx(P,{onClick:()=>G(),className:"mt-4",children:"Réessayer"})]}),!B&&!y&&F.length===0&&e.jsx("p",{className:"py-8 text-center text-sm text-muted-foreground",children:"Aucun record pour ces filtres."}),!B&&!y&&$.length>0&&e.jsx("div",{className:"space-y-5 pb-4",children:$.map(t=>e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"h-4 w-1 rounded-full bg-primary"}),e.jsx("h2",{className:"text-xs font-display font-bold uppercase tracking-wider text-muted-foreground",children:t.label}),e.jsx("div",{className:"flex-1 h-px bg-border"})]}),e.jsx("div",{className:"space-y-1.5",children:t.activeEvents.map(o=>{const g=X.get(o.id),h=v.get(o.id)??[],C=d===o.id;return e.jsx(je,{eventLabel:o.label,bestRecord:g,ageRecords:h,isExpanded:C,isAllAges:k===null,onToggle:()=>W(o.id),onAgeRowTap:Z,expandedAgeKey:a,rankingData:J,rankingLoading:Q,pool:s,sex:l},o.id)})})]},t.key))})]})}function je({eventLabel:s,bestRecord:n,ageRecords:l,isExpanded:c,isAllAges:i,onToggle:r,onAgeRowTap:d,expandedAgeKey:x,rankingData:a,rankingLoading:m,pool:p,sex:f}){return e.jsxs("div",{className:_("rounded-xl border overflow-hidden transition-colors",c?"border-primary/25 shadow-sm":"border-border"),children:[e.jsx("button",{type:"button",onClick:r,className:"w-full text-left px-3.5 py-3 hover:bg-muted/50 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx("span",{className:"text-sm font-semibold text-foreground",children:s}),e.jsxs("div",{className:"flex items-center gap-2.5",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("span",{className:"font-mono text-primary font-bold tabular-nums text-[15px] leading-none",children:A(n.time_ms)}),e.jsxs("div",{className:"flex items-center justify-end gap-1 mt-0.5",children:[e.jsx("span",{className:"text-[11px] text-muted-foreground truncate max-w-[120px]",children:n.athlete_name}),i&&e.jsxs("span",{className:"text-[10px] text-muted-foreground/60",children:[j(n.original_age??n.age),"a"]}),b(n.record_date)&&e.jsxs("span",{className:"text-[10px] text-muted-foreground/60",children:["(",b(n.record_date),")"]})]})]}),c?e.jsx(O,{className:"h-4 w-4 text-muted-foreground shrink-0"}):e.jsx(he,{className:"h-4 w-4 text-muted-foreground shrink-0"})]})]})}),c&&e.jsx("div",{className:"border-t border-border",children:i?e.jsx(Ne,{records:l,bestTime:n.time_ms,onAgeRowTap:d,expandedAgeKey:x,rankingData:a,rankingLoading:m,pool:p,sex:f}):e.jsx(ve,{record:n,eventLabel:s,rankingData:a,rankingLoading:m})})]})}function Ne({records:s,bestTime:n,onAgeRowTap:l,expandedAgeKey:c,rankingData:i,rankingLoading:r,pool:d,sex:x}){return e.jsx("div",{className:"divide-y divide-border/50",children:s.map(a=>{const m=a.time_ms===n,p=`${a.event_code}__${d}__${x}__${a.age}`,f=c===p,L=a.original_age!=null&&a.original_age!==a.age,N=a.original_age?j(a.original_age):null;return e.jsxs("div",{children:[e.jsxs("button",{type:"button",onClick:()=>l(a),className:_("w-full text-left px-3.5 py-2 flex items-center gap-2.5 hover:bg-muted/40 transition-colors",m&&"bg-primary/[0.03]"),children:[e.jsxs("span",{className:_("text-[11px] font-semibold w-7 text-center shrink-0 tabular-nums",m?"text-primary":"text-muted-foreground"),children:[j(a.age),"a"]}),e.jsx("span",{className:_("font-mono tabular-nums text-sm shrink-0",m?"text-primary font-bold":"text-foreground font-medium"),children:A(a.time_ms)}),e.jsxs("span",{className:"text-xs text-muted-foreground flex-1 truncate",children:[a.athlete_name,L&&N&&e.jsxs("span",{className:"ml-1 opacity-70",children:["(",N,"a)"]})]}),b(a.record_date)&&e.jsx("span",{className:"text-[10px] text-muted-foreground shrink-0",children:b(a.record_date)}),m&&e.jsx(S,{className:"h-3 w-3 text-rank-gold shrink-0"}),f?e.jsx(O,{className:"h-3 w-3 text-muted-foreground shrink-0"}):e.jsx(be,{className:"h-3 w-3 text-muted-foreground shrink-0"})]}),f&&e.jsx(ye,{record:a,rankingData:i,rankingLoading:r})]},a.age)})})}function ye({record:s,rankingData:n,rankingLoading:l}){const c=s.original_age!=null&&s.original_age!==s.age,i=u.useMemo(()=>{const r=n??[];return c?[{id:-1,athlete_name:s.athlete_name,swimmer_iuf:s.swimmer_iuf??null,sex:s.sex,pool_m:s.pool_m,event_code:s.event_code,event_label:s.event_label,age:s.original_age??s.age,actual_age:s.original_age??s.age,time_ms:s.time_ms,record_date:s.record_date},...r]:r},[n,s,c]);return e.jsxs("div",{className:"bg-muted/30 px-3.5 py-2 ml-7 border-l-2 border-primary/20",children:[e.jsxs("p",{className:"text-[10px] font-semibold uppercase tracking-wider text-muted-foreground mb-1.5",children:["Classement (",j(s.age)," ans)"]}),l?e.jsx("div",{className:"space-y-1.5",children:[1,2,3].map(r=>e.jsx("div",{className:"h-4 w-full rounded bg-muted animate-pulse motion-reduce:animate-none"},r))}):i.length===0?e.jsx("p",{className:"text-xs text-muted-foreground",children:"Aucune donnée."}):e.jsx("div",{className:"space-y-0.5",children:i.map((r,d)=>{const x=d===0&&c&&r.id===-1;return e.jsxs("div",{className:_("flex items-center gap-2 text-xs py-0.5",d===0&&"font-semibold text-primary"),children:[e.jsx("span",{className:"w-4 text-center shrink-0 text-[10px]",children:d===0?e.jsx(S,{className:"inline h-3 w-3 text-rank-gold"}):d+1}),e.jsx("span",{className:"font-mono tabular-nums w-14 shrink-0 text-[11px]",children:A(r.time_ms)}),e.jsxs("span",{className:"flex-1 truncate text-[11px]",children:[r.athlete_name,x&&e.jsx("span",{className:"ml-1 text-[9px] font-normal text-muted-foreground",children:"(record)"})]}),b(r.record_date)&&e.jsx("span",{className:"text-[10px] text-muted-foreground shrink-0",children:b(r.record_date)})]},r.id===-1?"record-holder":r.id)})})]})}function ve({record:s,eventLabel:n,rankingData:l,rankingLoading:c}){const i=s.original_age!=null&&s.original_age!==s.age,r=s.original_age?j(s.original_age):null,d=j(s.age),x=u.useMemo(()=>{const a=l??[];return i?[{id:-1,athlete_name:s.athlete_name,swimmer_iuf:s.swimmer_iuf??null,sex:s.sex,pool_m:s.pool_m,event_code:s.event_code,event_label:s.event_label,age:s.original_age??s.age,actual_age:s.original_age??s.age,time_ms:s.time_ms,record_date:s.record_date},...a]:a},[l,s,i]);return e.jsxs("div",{className:"bg-muted/20 px-3.5 py-2.5",children:[e.jsxs("p",{className:"text-[10px] font-semibold uppercase tracking-wider text-muted-foreground mb-2",children:["Classement — ",n," (",d," ans)"]}),c?e.jsx("div",{className:"space-y-1.5",children:[1,2,3].map(a=>e.jsx("div",{className:"h-5 w-full rounded bg-muted animate-pulse motion-reduce:animate-none"},a))}):x.length===0?e.jsx("p",{className:"text-xs text-muted-foreground",children:"Aucune donnée de classement."}):e.jsx("div",{className:"space-y-0.5",children:x.map((a,m)=>{const p=m===0&&i&&a.id===-1;return e.jsxs("div",{className:_("flex items-center gap-2 text-xs py-1 rounded-md px-1",m===0&&"font-semibold text-primary",p&&"bg-primary/5"),children:[e.jsx("span",{className:"w-5 text-center shrink-0",children:m===0?e.jsx(S,{className:"inline h-3 w-3 text-rank-gold"}):m+1}),e.jsx("span",{className:"font-mono tabular-nums w-16 shrink-0",children:A(a.time_ms)}),e.jsxs("span",{className:"flex-1 truncate",children:[a.athlete_name,p&&r&&e.jsxs("span",{className:"ml-1 text-[10px] font-normal text-muted-foreground",children:["(record ",r,"a)"]})]}),e.jsxs("span",{className:"text-muted-foreground shrink-0",children:[a.actual_age??a.age,"a"]}),b(a.record_date)&&e.jsx("span",{className:"text-[10px] text-muted-foreground shrink-0",children:b(a.record_date)})]},a.id===-1?"record-holder":a.id)})})]})}export{Ve as default};
