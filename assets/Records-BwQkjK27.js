import{c as pt,r as m,u as K,d as W,j as e}from"./vendor-query-DyA9aSKS.js";import{u as re,d as ht,W as ie,B as v,D as ft,x as Ee,y as gt,L as I,I as M,C as ae,e as oe,X as me}from"./index-C8n7RHvM.js";import{a as S}from"./api-B2vWtBIi.js";import{T as jt}from"./textarea-Dv6X0X9e.js";import{S as ke,a as Ie,b as Fe,c as Me,d as Re}from"./sheet-BRNG-zNr.js";import{T as vt,a as bt,b as Pe,c as Te}from"./tabs-BHhzs5HG.js";import{S as Nt,a as yt,b as wt,c as St,d as Le}from"./select-o9R-Uy3P.js";import{shouldShowRecords as _t}from"./Profile-r5D_sPqn.js";import{I as qe}from"./InlineBanner-DEKGNBSD.js";import{c as Ct,s as le,l as de,f as Et}from"./animations-CrcLFysI.js";import{P as kt}from"./PageHeader-CYj0tDTo.js";import{c as It,m as F}from"./vendor-motion-lao-Njgm.js";import{C as ce}from"./circle-alert-DTh18tCk.js";import{T as $e}from"./trophy-DAWqZUtL.js";import{P as De}from"./pen-CFOfHK6Y.js";import{C as ue}from"./index-Czez78S2.js";import{C as Ft}from"./chevron-right-BBe-i3EZ.js";import{a as Mt,i as Rt,h as Pt,X as Tt,Y as Lt,T as qt,g as $t}from"./vendor-charts-BrQ8X25f.js";import{S as Dt}from"./sticky-note-mawUjLqE.js";import{C as zt}from"./chevron-down-mWe9xaVK.js";import"./vendor-react-BzrpNAyj.js";import"./vendor-supabase-DFPLkPj_.js";import"./swim-Ur09MvRu.js";import"./index-Cp1GxP9-.js";import"./index-B72Prd0s.js";import"./index-CNvkI8ip.js";import"./index-DCX2sNhR.js";import"./chevron-up-5WRfms-N.js";import"./avatar-CXWNPh6_.js";import"./badge-eplu3J07.js";import"./dialog-C64CcAF4.js";import"./types-g3FhkFPf.js";import"./arrow-left-B2XQPNp9.js";import"./bell-ring-BoEdFDF5.js";import"./trash-2-DUbRsdUV.js";import"./flame-QCBARKds.js";import"./save-C4WwUm0I.js";import"./clock-_7noDjKb.js";import"./design-tokens-CKgCpdH6.js";import"./chevron-left-DHXEMWkM.js";const At=r=>r.toLowerCase().replace(/\./g,"").replace(/\s+/g," ").trim();function ze(r){const n=At(r);return n.includes("nl")||n.includes("nage libre")?0:n.includes("dos")?1:n.includes("bra")||n.includes("brasse")?2:n.includes("pap")||n.includes("papillon")?3:n.includes("4n")||n.includes("4 n")||n.includes("4 nages")?4:99}function Ae(r){const n=r.match(/^(\d+)/);return n?Number(n[1]):Number.POSITIVE_INFINITY}function Kt(r,n){const p=ze(r),u=ze(n);return p!==u?p-u:Ae(r)-Ae(n)}const _=(...r)=>r.filter(Boolean).join(" ");function q(r){if(!r)return"—";const n=new Date(r);return Number.isNaN(n.getTime())?r:n.toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"2-digit"})}function O(r){if(r==null)return"—";const n=Math.round(Math.max(0,r*1e3)),p=Math.floor(n/6e4),u=Math.floor(n%6e4/1e3),b=Math.floor(n%1e3/10);return p>0?`${p}:${String(u).padStart(2,"0")}.${String(b).padStart(2,"0")}`:`${u}.${String(b).padStart(2,"0")}`}function Ot(r){const n=r.trim();if(!n)return null;if(n.includes(":")){const[u,b]=n.split(":"),h=Number(u);if(!Number.isFinite(h)||h<0)return null;const y=b.replace(",","."),w=Number(y);return!Number.isFinite(w)||w<0?null:h*60+w}const p=Number(n.replace(",","."));return!Number.isFinite(p)||p<0?null:p}function Qt(r){if(!r)return null;const n=r.match(/FFN\s*\((\d+)\s*pts\)/i);if(!n)return null;const p=Number(n[1]);return Number.isFinite(p)?p:null}function Bt({value:r,placeholder:n,onSave:p,onCancel:u,inputMode:b="decimal",hint:h}){const[y,w]=m.useState(r);return m.useEffect(()=>{w(r)},[r]),e.jsx("div",{className:"w-full",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(M,{value:y,onChange:U=>w(U.target.value),placeholder:n,inputMode:b,className:"h-10 rounded-xl",autoFocus:!0}),h?e.jsx("div",{className:"mt-1 text-xs text-muted-foreground",children:h}):null]}),e.jsx(v,{type:"button",onClick:()=>p(y),className:"h-10 w-10 p-0 rounded-xl","aria-label":"Valider",children:e.jsx(ue,{className:"h-5 w-5"})}),e.jsx(v,{type:"button",variant:"outline",onClick:u,className:"h-10 w-10 p-0 rounded-xl","aria-label":"Annuler",children:e.jsx(me,{className:"h-5 w-5"})})]})})}const C=()=>e.jsx("div",{className:"h-10 rounded-xl bg-muted animate-pulse motion-reduce:animate-none"});function Rs(){const r=re(t=>t.user),n=re(t=>t.userId),p=re(t=>t.role),{toast:u}=ht(),b=pt(),h=It(),y={id:null,event_name:"",pool_length:"",time_seconds:"",record_date:"",notes:""},[w,U]=m.useState(()=>{const t=window.location.hash,s=t.indexOf("?");return s>=0&&new URLSearchParams(t.substring(s)).get("tab")==="1rm"?"1rm":"swim"}),[l,g]=m.useState(y),[o,Ke]=m.useState("training"),[$,Oe]=m.useState(25),[X,Q]=m.useState(null),[Qe,xe]=m.useState(null),[Be,pe]=m.useState(""),[He,Ve]=m.useState(null),[We,D]=m.useState(null),[he,R]=m.useState(""),[B,Ue]=m.useState(25),[z,Y]=m.useState(null),[Xe,fe]=m.useState(!1),P=_t(p);m.useEffect(()=>{window.scrollTo({top:0,left:0,behavior:"auto"})},[]);const ge=t=>{const s=t?.pool_length??t?.poolLength??t?.poolLen??t?.pool;if(s==null)return null;if(typeof s=="number")return s===25||s===50?s:null;const x=String(s).match(/\b(25|50)\b/);if(!x)return null;const d=Number(x[1]);return d===25||d===50?d:null},G=K({queryKey:["1rm",r,n],queryFn:()=>S.get1RM({athleteName:r,athleteId:n}),enabled:!!r&&P}),J=K({queryKey:["exercises"],queryFn:()=>S.getExercises(),enabled:P}),Z=K({queryKey:["swim-records",n,r,o],queryFn:()=>S.getSwimRecords({athleteId:n??void 0,athleteName:r??void 0,recordType:o==="comp"?"comp":"training"}),enabled:!!r&&P}),T=K({queryKey:["profile",n],queryFn:()=>S.getProfile({userId:n??void 0}),enabled:!!n&&P}),E=String(T.data?.ffn_iuf??"").trim(),je=G.error||J.error||Z.error||T.error,Ye=()=>{G.refetch(),J.refetch(),Z.refetch(),T.refetch()},ee=K({queryKey:["swimmer-performances",n,E,B],queryFn:()=>S.getSwimmerPerformances({userId:n??void 0,iuf:E||void 0,poolLength:B}),enabled:!!E&&P&&o==="history"}),{data:te,isLoading:Ge,isError:Je}=ee,H=W({mutationFn:()=>{if(!E)throw new Error("IUF FFN manquant. Ajoutez-le dans votre profil.");return S.importSwimmerPerformances({iuf:E,userId:n??void 0})},onSuccess:t=>{b.invalidateQueries({queryKey:["swimmer-performances"]}),u({title:"Import terminé",description:`${t.total_found} trouvée(s), ${t.new_imported} importée(s), ${t.already_existed} déjà existante(s)`}),fe(!0),setTimeout(()=>fe(!1),2e3)},onError:t=>{u({title:"Import impossible",description:String(t?.message||t),variant:"destructive"})}}),L=m.useMemo(()=>{if(!te?.length)return[];const t=new Map;for(const d of te){const a=t.get(d.event_code)??[];a.push(d),t.set(d.event_code,a)}const s=d=>d.toLowerCase().replace(/\./g,"").replace(/\s+/g," ").trim(),i=d=>{const a=s(d);return a.includes("nl")||a.includes("nage libre")?0:a.includes("dos")?1:a.includes("bra")||a.includes("brasse")?2:a.includes("pap")||a.includes("papillon")?3:a.includes("4n")||a.includes("4 n")||a.includes("4 nages")?4:99},x=d=>{const a=d.match(/^(\d+)/);return a?Number(a[1]):1/0};return[...t.entries()].map(([d,a])=>{const f=[...a].sort((N,c)=>(c.competition_date??"").localeCompare(N.competition_date??"")),j=f.reduce((N,c)=>c.time_seconds<N.time_seconds?c:N,f[0]);return{eventCode:d,performances:f,bestTime:j.time_seconds,bestId:j.id}}).sort((d,a)=>{const f=i(d.eventCode),j=i(a.eventCode);return f!==j?f-j:x(d.eventCode)-x(a.eventCode)})},[te]),ve=m.useMemo(()=>{if(!z)return[];const t=L.find(s=>s.eventCode===z);return t?[...t.performances].filter(s=>s.competition_date).sort((s,i)=>(s.competition_date??"").localeCompare(i.competition_date??"")).map(s=>({date:q(s.competition_date),time:s.time_seconds,display:s.time_display??O(s.time_seconds)})):[]},[z,L]),k=m.useMemo(()=>L.find(t=>t.eventCode===z)??null,[L,z]),{data:Ze,isLoading:et,isError:tt}=G,{data:st,isLoading:nt,isError:rt}=J,{data:be,isLoading:it,isFetching:Ht,isError:at,refetch:ot}=Z,lt=()=>{ot()};m.useEffect(()=>{o==="comp"&&lt()},[o]);const dt=o==="history"?B:$,se=o!=="history",Ne=W({mutationFn:t=>S.update1RM({...t,athlete_id:n,athlete_name:r}),onSuccess:()=>{b.invalidateQueries({queryKey:["1rm"]}),u({title:"1RM mis à jour"})}}),ye=W({mutationFn:t=>S.updateExerciseNote({athlete_id:n,exercise_id:t.exercise_id,notes:t.notes}),onSuccess:()=>{b.invalidateQueries({queryKey:["1rm"]}),u({title:"Note mise à jour"})}}),V=W({mutationFn:t=>S.upsertSwimRecord(t),onSuccess:()=>{b.invalidateQueries({queryKey:["swim-records"]}),g(y),Q(null),u({title:"Record mis à jour"})}}),A=()=>{g(y),Q(null)},ct=t=>{const s=ge(t);g({id:t.id,event_name:t.event_name??"",pool_length:s?String(s):"",time_seconds:t.time_seconds!=null?O(Number(t.time_seconds)):"",record_date:t.record_date?String(t.record_date).split("T")[0]:"",notes:t.notes??""}),Q(t.id)},we=()=>{if(!l.event_name.trim()){u({title:"Nom d'épreuve requis",variant:"destructive"});return}if(!l.pool_length){u({title:"Bassin requis",variant:"destructive"});return}const t=Ot(l.time_seconds);if(t===null){u({title:"Temps invalide",description:"Ex: 1:02.34 ou 62.34",variant:"destructive"});return}V.mutate({id:l.id||null,athlete_id:n,athleteName:r,athlete_name:r,event_name:l.event_name,pool_length:parseInt(l.pool_length,10),time_seconds:t,record_date:l.record_date||null,notes:l.notes||null,record_type:o})},mt=t=>{t.preventDefault(),we()},Se=m.useMemo(()=>(be?.records??[]).filter(i=>ge(i)===$).sort((i,x)=>Kt(String(i.event_name??""),String(x.event_name??""))),[be,$,o]),_e=()=>{g({...y,pool_length:String($)}),Q("add")},ne=t=>{Ke(t),A()},ut=(t,s)=>{xe(t),pe(s!=null&&Number(s)>0?String(s):"")},Ce=()=>{xe(null),pe("")},xt=(t,s)=>{const i=Number(String(s??"").replace(",","."));if(!Number.isFinite(i)||i<=0){u({title:"Valeur invalide",description:"Entrez un nombre > 0",variant:"destructive"});return}Ne.mutate({exercise_id:t,one_rm:i}),Ce()};return P?je?e.jsx("div",{className:"min-h-[100dvh]",children:e.jsxs("div",{className:"mx-auto max-w-lg px-4 pt-16 pb-10 text-center",children:[e.jsx(ce,{className:"h-10 w-10 mx-auto text-destructive/60"}),e.jsx("p",{className:"mt-3 text-sm font-semibold",children:"Impossible de charger les données"}),e.jsx("p",{className:"mt-1 text-xs text-muted-foreground",children:je.message}),e.jsx(v,{onClick:Ye,size:"sm",className:"mt-4 rounded-2xl",children:"Réessayer"})]})}):e.jsx("div",{className:"min-h-[100dvh]",children:e.jsxs("div",{className:"mx-auto max-w-lg",children:[e.jsx(kt,{className:"-mx-0",title:"Mes Records",icon:e.jsx($e,{className:"h-3.5 w-3.5"}),backHref:"/profile",backLabel:"Retour au profil"}),e.jsx("div",{className:"px-3 pt-3",children:e.jsxs(vt,{value:w,onValueChange:t=>U(t),children:[e.jsxs(bt,{className:"w-full rounded-2xl bg-muted/50 border border-border p-1 flex",children:[e.jsxs(Pe,{value:"swim","aria-label":"Records de natation",className:`flex-1 rounded-xl px-3 py-2 text-sm font-bold uppercase tracking-wide gap-1.5
                  data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm
                  data-[state=inactive]:text-muted-foreground`,children:[e.jsx(ie,{className:"h-4 w-4"}),"Natation"]}),e.jsxs(Pe,{value:"1rm","aria-label":"Records de musculation",className:`flex-1 rounded-xl px-3 py-2 text-sm font-bold uppercase tracking-wide gap-1.5
                  data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm
                  data-[state=inactive]:text-muted-foreground`,children:[e.jsx(ft,{className:"h-4 w-4"}),"Musculation"]})]}),w==="swim"?e.jsxs("div",{className:"mt-2.5 space-y-1.5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[["training","comp"].map(t=>{const s=t==="training"?"Entraînement":"Compétition";return e.jsx("button",{type:"button",onClick:()=>{ne(t),Y(null)},className:_("rounded-xl border px-3 py-1.5 text-xs font-semibold transition",o===t?"border-primary/30 bg-primary/5 text-primary":"border-border text-muted-foreground hover:border-primary/30 hover:text-foreground"),"aria-pressed":o===t,children:s},t)}),e.jsx("div",{className:"ml-auto flex gap-1.5",children:[25,50].map(t=>e.jsxs("button",{type:"button",onClick:()=>{o==="history"?Ue(t):(Oe(t),A())},className:_("rounded-xl border px-3 py-1.5 text-xs font-semibold transition",dt===t?"border-primary/30 bg-primary/5 text-primary":"border-border text-muted-foreground hover:border-primary/30 hover:text-foreground"),children:[t,"m"]},t))})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:()=>{se||ne("training")},className:_("rounded-xl border px-3 py-1.5 text-xs font-semibold transition",se?"border-primary/30 bg-primary/5 text-primary":"border-border text-muted-foreground hover:border-primary/30 hover:text-foreground"),"aria-pressed":se,children:"MPP"}),e.jsx("button",{type:"button",onClick:()=>{ne("history")},className:_("rounded-xl border px-3 py-1.5 text-xs font-semibold transition",o==="history"?"border-primary/30 bg-primary/5 text-primary":"border-border text-muted-foreground hover:border-primary/30 hover:text-foreground"),"aria-pressed":o==="history",children:"Historique"}),e.jsxs("div",{className:"ml-auto flex items-center gap-2",children:[o==="training"?e.jsx(v,{type:"button",size:"sm",onClick:_e,className:"rounded-xl text-xs h-8 gap-1",children:"Ajouter"}):null,o==="history"?e.jsx(F.div,{variants:Ct,animate:Xe?"visible":"hidden",children:e.jsxs(v,{type:"button",size:"sm",onClick:()=>H.mutate(),disabled:H.isPending||!E,className:"rounded-xl text-xs h-8 gap-1",children:[H.isPending?e.jsx(Ee,{className:"h-3 w-3 animate-spin"}):e.jsx(gt,{className:"h-3 w-3"}),H.isPending?"Import...":"Importer"]})}):null]})]})]}):null,e.jsx(ke,{open:o==="training"&&X==="add",onOpenChange:t=>{!t&&X==="add"&&A()},children:e.jsxs(Ie,{side:"bottom",className:"max-h-[90vh] overflow-y-auto rounded-t-3xl",children:[e.jsxs(Fe,{className:"text-left",children:[e.jsx(Me,{children:"Ajouter un record"}),e.jsx(Re,{children:"Saisis rapidement un meilleur temps d'entraînement sans quitter la liste."})]}),e.jsx("form",{onSubmit:mt,className:"mt-5",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"col-span-2",children:[e.jsx(I,{className:"text-xs mb-1.5 block",children:"Épreuve"}),e.jsx(M,{value:l.event_name,onChange:t=>g({...l,event_name:t.target.value}),placeholder:"Ex: 100 NL, 200 Dos",className:"h-10 rounded-xl"})]}),e.jsxs("div",{children:[e.jsx(I,{className:"text-xs mb-1.5 block",children:"Bassin"}),e.jsxs(Nt,{value:l.pool_length,onValueChange:t=>g({...l,pool_length:t}),children:[e.jsx(yt,{className:"h-10 rounded-xl",children:e.jsx(wt,{placeholder:"—"})}),e.jsxs(St,{children:[e.jsx(Le,{value:"25",children:"25m"}),e.jsx(Le,{value:"50",children:"50m"})]})]})]}),e.jsxs("div",{children:[e.jsx(I,{className:"text-xs mb-1.5 block",children:"Temps"}),e.jsx(M,{value:l.time_seconds,inputMode:"decimal",placeholder:"1:02.34",onChange:t=>g({...l,time_seconds:t.target.value}),className:"h-10 rounded-xl"})]}),e.jsxs("div",{children:[e.jsx(I,{className:"text-xs mb-1.5 block",children:"Date"}),e.jsx(M,{type:"date",value:l.record_date,onChange:t=>g({...l,record_date:t.target.value}),className:"h-10 rounded-xl"})]}),e.jsxs("div",{children:[e.jsx(I,{className:"text-xs mb-1.5 block",children:"Notes"}),e.jsx(M,{value:l.notes,onChange:t=>g({...l,notes:t.target.value}),placeholder:"Optionnel",className:"h-10 rounded-xl"})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 pb-2",children:[e.jsx(v,{type:"button",variant:"outline",onClick:A,className:"rounded-xl",children:"Annuler"}),e.jsx(v,{type:"submit",disabled:V.isPending,className:"rounded-xl",children:V.isPending?"Ajout...":"Ajouter"})]})]})})]})}),e.jsxs(Te,{value:"swim",className:"mt-0",children:[o!=="history"?e.jsx(e.Fragment,{children:e.jsx("div",{className:"mt-3",children:e.jsx(ae,{className:"w-full min-w-0 rounded-2xl",children:e.jsx(oe,{className:"p-0",children:it?e.jsxs("div",{className:"p-4 grid gap-3",children:[e.jsx(C,{}),e.jsx(C,{}),e.jsx(C,{})]}):at?e.jsx("div",{className:"mx-4 my-4 rounded-lg border border-destructive/20 bg-destructive/10 p-4 text-sm text-destructive",children:"Impossible de charger les records natation."}):Se.length===0?e.jsxs("div",{className:"py-8 text-center",children:[e.jsx(ie,{className:"h-8 w-8 mx-auto text-muted-foreground/30"}),e.jsxs("p",{className:"mt-2 text-sm text-muted-foreground",children:["Aucun record en ",$,"m"]}),o==="training"&&e.jsx(v,{type:"button",size:"sm",variant:"outline",onClick:_e,className:"mt-3 rounded-xl text-xs h-8",children:"Ajouter un record"})]}):e.jsx(F.div,{className:"divide-y divide-border motion-reduce:animate-none",variants:h?void 0:le,initial:h?!1:"hidden",animate:h?!1:"visible",children:Se.map(t=>{const s=X===t.id,i=O(t.time_seconds),x=q(t.record_date),d=(t.notes??"").trim(),a=t?.ffn_points??t?.ffnPoints??t?.points??t?.pts??null,f=a==null?NaN:Number(a),j=Number.isFinite(f)?f:Qt(t?.notes),N=(t?.meet??t?.meet_name??t?.meetName??t?.competition??"").trim?.()??"";return e.jsxs(F.div,{className:"px-3 py-2.5 motion-reduce:animate-none",variants:de,children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("span",{className:"text-sm font-semibold truncate",children:t.event_name}),e.jsxs("div",{className:"flex items-center gap-2 shrink-0",children:[e.jsx("span",{className:"font-mono text-primary font-bold tabular-nums text-sm",children:i}),o==="training"&&e.jsx("button",{type:"button",onClick:()=>ct(t),className:"inline-flex items-center justify-center h-8 w-8 rounded-xl text-muted-foreground hover:text-foreground hover:bg-muted/60 transition","aria-label":`Modifier ${t.event_name}`,children:e.jsx(De,{className:"h-3.5 w-3.5"})})]})]}),e.jsxs("div",{className:"flex items-center gap-3 mt-0.5 text-xs text-muted-foreground",children:[o==="comp"&&j!=null&&e.jsxs("span",{className:"tabular-nums",children:[String(j)," pts"]}),e.jsx("span",{className:"tabular-nums",children:x}),o==="comp"&&N&&e.jsx("span",{className:"truncate",children:N}),o==="training"&&d&&e.jsx("span",{className:"truncate italic",children:d})]}),o==="training"&&s?e.jsx(F.div,{className:"mt-3",variants:Et,initial:"hidden",animate:"visible",children:e.jsxs("div",{className:"rounded-2xl bg-muted/30 border border-border p-4 space-y-4",children:[e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(I,{children:"Temps"}),e.jsx(M,{value:l.time_seconds,inputMode:"decimal",placeholder:"1:02.34",onChange:c=>g({...l,time_seconds:c.target.value}),className:"rounded-xl"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Format: mm:ss.cc ou secondes"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(I,{children:"Date"}),e.jsx(M,{type:"date",value:l.record_date,onChange:c=>g({...l,record_date:c.target.value}),className:"rounded-xl"})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(I,{children:"Notes"}),e.jsx(jt,{value:l.notes,onChange:c=>g({...l,notes:c.target.value}),rows:2,className:"rounded-xl"})]}),e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsxs(v,{type:"button",size:"sm",variant:"outline",onClick:A,className:"rounded-2xl gap-2",children:[e.jsx(me,{className:"h-4 w-4"}),"Annuler"]}),e.jsxs(v,{type:"button",size:"sm",onClick:we,disabled:V.isPending,className:"rounded-2xl gap-2",children:[e.jsx(ue,{className:"h-4 w-4"}),"Enregistrer"]})]})]})}):null]},t.id)})})})})})}):null,o==="history"?e.jsxs("div",{className:"mt-3 space-y-3",children:[e.jsx(qe,{variant:"destructive",icon:e.jsx(ce,{}),label:"Impossible de charger votre profil",visible:T.isError,animate:!1}),e.jsx(qe,{variant:"yellow",icon:e.jsx(ce,{}),label:"IUF FFN non renseigné",sublabel:e.jsxs(e.Fragment,{children:["Renseignez votre numéro dans ",e.jsx("a",{href:"/#/profile",className:"underline font-medium hover:text-foreground",children:"votre profil"})]}),visible:!T.isError&&!E&&!T.isLoading,animate:!1}),Ge?e.jsxs("div",{className:"grid gap-3",children:[e.jsx(C,{}),e.jsx(C,{}),e.jsx(C,{})]}):Je?e.jsxs("div",{className:"rounded-lg border border-destructive/20 bg-destructive/10 p-4 text-sm text-destructive",children:[e.jsx("p",{className:"font-semibold",children:"Impossible de charger les performances"}),e.jsx("p",{className:"mt-1 text-xs",children:ee.error instanceof Error?ee.error.message:"Vérifiez votre connexion internet et réessayez."})]}):L.length===0?e.jsx("div",{className:"px-4 py-6 text-sm text-muted-foreground",children:E?'Aucune performance trouvée. Cliquez sur "Importer" pour récupérer vos données FFN.':"Ajoutez votre IUF FFN dans votre profil pour commencer."}):e.jsx(F.div,{className:"space-y-2 motion-reduce:animate-none",variants:h?void 0:le,initial:h?!1:"hidden",animate:h?!1:"visible",children:L.map(t=>{const s=t.performances.find(x=>x.id===t.bestId)??t.performances[0],i=t.performances[0];return e.jsx(F.div,{variants:de,children:e.jsx(ae,{className:"rounded-2xl",children:e.jsx(oe,{className:"p-0",children:e.jsxs("button",{type:"button",onClick:()=>Y(t.eventCode),className:"w-full flex items-center justify-between gap-3 px-3 py-3 text-left cursor-pointer",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[e.jsx("span",{className:"text-sm font-semibold truncate",children:t.eventCode}),e.jsx("span",{className:"inline-flex items-center justify-center h-5 min-w-5 px-1.5 rounded-full bg-muted text-xs font-semibold tabular-nums text-muted-foreground",children:t.performances.length})]}),e.jsxs("div",{className:"mt-1 flex items-center gap-3 text-xs text-muted-foreground",children:[e.jsxs("span",{children:["Meilleur: ",q(s?.competition_date)]}),i?.competition_date&&i.id!==s?.id?e.jsxs("span",{children:["Dernier: ",q(i.competition_date)]}):null]})]}),e.jsxs("div",{className:"flex items-center gap-2 shrink-0",children:[e.jsx("span",{className:"font-mono text-primary font-bold tabular-nums text-sm",children:O(t.bestTime)}),e.jsx(Ft,{className:"h-4 w-4 text-muted-foreground"})]})]})})})},t.eventCode)})}),e.jsx(ke,{open:!!k,onOpenChange:t=>{t||Y(null)},children:e.jsxs(Ie,{side:"bottom",className:"max-h-[90vh] overflow-y-auto rounded-t-3xl",children:[e.jsxs(Fe,{className:"text-left",children:[e.jsx(Me,{children:k?.eventCode??"Historique"}),e.jsx(Re,{children:k?`${k.performances.length} performance${k.performances.length>1?"s":""} en bassin ${B}m`:"Historique détaillé"})]}),k?e.jsxs("div",{className:"mt-5 space-y-4",children:[ve.length>1?e.jsxs("div",{className:"rounded-2xl border border-border bg-muted/20 px-2 pt-3 pb-1",children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-2 px-2",children:"Courbe de progression"}),e.jsx(Mt,{width:"100%",height:180,children:e.jsxs(Rt,{data:ve,margin:{top:5,right:10,left:0,bottom:5},children:[e.jsx(Pt,{strokeDasharray:"3 3",className:"stroke-border"}),e.jsx(Tt,{dataKey:"date",tick:{fontSize:10},className:"text-muted-foreground"}),e.jsx(Lt,{domain:["auto","auto"],tick:{fontSize:10},className:"text-muted-foreground",reversed:!0,tickFormatter:t=>{const s=Math.floor(t/60),i=Math.floor(t%60),x=Math.round(t%1*100);return s>0?`${s}:${String(i).padStart(2,"0")}`:`${i}.${String(x).padStart(2,"0")}`}}),e.jsx(qt,{formatter:t=>{const s=Math.floor(t/60),i=Math.floor(t%60),x=Math.round(t%1*100);return[s>0?`${s}:${String(i).padStart(2,"0")}.${String(x).padStart(2,"0")}`:`${i}.${String(x).padStart(2,"0")}`,"Temps"]},labelStyle:{fontSize:11},contentStyle:{borderRadius:12,fontSize:12}}),e.jsx($t,{type:"monotone",dataKey:"time",stroke:"hsl(var(--primary))",strokeWidth:2,dot:{r:3},activeDot:{r:5}})]})})]}):null,e.jsx("div",{className:"overflow-hidden rounded-2xl border border-border",children:e.jsx("div",{className:"divide-y divide-border",children:k.performances.map(t=>{const s=t.id===k.bestId;return e.jsxs("div",{className:_("px-3 py-2.5",s&&"bg-primary/5"),children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex items-center gap-1.5 min-w-0",children:[s?e.jsx($e,{className:"h-3.5 w-3.5 text-primary shrink-0"}):null,e.jsx("span",{className:"text-xs text-muted-foreground tabular-nums",children:q(t.competition_date)})]}),e.jsx("span",{className:_("font-mono tabular-nums text-sm shrink-0",s?"text-primary font-bold":"font-medium"),children:t.time_display??O(t.time_seconds)})]}),e.jsxs("div",{className:"flex items-center gap-3 mt-0.5 text-xs text-muted-foreground",children:[t.ffn_points!=null?e.jsxs("span",{className:"tabular-nums",children:[String(t.ffn_points)," pts"]}):null,t.competition_name?e.jsx("span",{className:"truncate",children:t.competition_name}):null]})]},t.id)})})})]}):null]})})]}):null,e.jsx("div",{className:"h-6"})]}),e.jsxs(Te,{value:"1rm",className:"mt-0",children:[e.jsx("div",{className:"mt-3",children:e.jsx(ae,{className:"w-full min-w-0 rounded-2xl",children:e.jsxs(oe,{className:"p-0",children:[et||nt?e.jsxs("div",{className:"p-4 grid gap-3",children:[e.jsx(C,{}),e.jsx(C,{}),e.jsx(C,{})]}):tt||rt?e.jsx("div",{className:"p-4 text-sm text-muted-foreground",children:"Impossible de charger les records musculation."}):e.jsx(F.div,{className:"divide-y divide-border motion-reduce:animate-none",variants:h?void 0:le,initial:h?!1:"hidden",animate:h?!1:"visible",children:st?.filter(t=>t.exercise_type!=="warmup").map(t=>{const s=Ze?.find(c=>c.exercise_id===t.id),i=Number(s?.weight??0),x=i>0?`${i} kg`:"—",d=s?.recorded_at??s?.date??null,a=s?.notes??null,f=Qe===t.id,j=He===t.id,N=We===t.id;return e.jsxs(F.div,{className:"px-3 py-2.5 motion-reduce:animate-none",variants:de,children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("span",{className:"text-sm font-semibold truncate",children:t.nom_exercice}),e.jsxs("div",{className:"flex items-center gap-2 shrink-0",children:[e.jsx("span",{className:_("font-mono font-bold tabular-nums text-sm",i>0?"text-primary":"text-muted-foreground"),children:x}),!f&&e.jsx("button",{type:"button",onClick:()=>ut(t.id,s?.weight??null),className:"inline-flex items-center justify-center h-8 w-8 rounded-xl text-muted-foreground hover:text-foreground hover:bg-muted/60 transition","aria-label":`Modifier ${t.nom_exercice}`,children:e.jsx(De,{className:"h-3.5 w-3.5"})})]})]}),e.jsxs("div",{className:"flex items-center justify-between mt-0.5",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground min-w-0",children:[e.jsx("span",{className:"tabular-nums shrink-0",children:q(d)}),a&&!N?e.jsx("button",{type:"button",onClick:()=>{D(t.id),R(a??"")},className:"truncate italic hover:text-foreground transition text-left",title:"Modifier la note",children:a}):null]}),e.jsxs("div",{className:"flex items-center gap-1 shrink-0",children:[e.jsx("button",{type:"button",onClick:()=>{N?(D(null),R("")):(D(t.id),R(a??""))},className:_("inline-flex items-center justify-center h-7 w-7 rounded-lg transition",a?"text-primary hover:text-primary/80":"text-muted-foreground/40 hover:text-muted-foreground"),"aria-label":a?"Modifier la note":"Ajouter une note",children:e.jsx(Dt,{className:"h-3.5 w-3.5"})}),i>0&&!f?e.jsxs("button",{type:"button",onClick:()=>Ve(j?null:t.id),className:"inline-flex items-center gap-0.5 h-7 px-1.5 rounded-lg text-xs text-muted-foreground hover:text-foreground transition","aria-label":"Table des pourcentages",children:[e.jsx(zt,{className:_("h-3.5 w-3.5 transition-transform",j&&"rotate-180")}),e.jsx("span",{className:"text-[10px] font-bold",children:"%"})]}):null]})]}),f?e.jsx("div",{className:"mt-3",children:e.jsx(Bt,{value:Be,placeholder:"Ex: 100",inputMode:"decimal",hint:"Charge max (kg).",onCancel:Ce,onSave:c=>xt(t.id,c)})}):null,N?e.jsx("div",{className:"mt-3",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(M,{value:he,onChange:c=>R(c.target.value),placeholder:"Machine n°3, cran 5...",className:"h-9 rounded-lg text-sm flex-1",autoFocus:!0}),e.jsx(v,{type:"button",size:"sm",onClick:()=>{const c=he.trim()||null;ye.mutate({exercise_id:t.id,notes:c}),D(null),R("")},disabled:ye.isPending,className:"rounded-lg h-9 w-9 p-0 shrink-0","aria-label":"Enregistrer",children:e.jsx(ue,{className:"h-4 w-4"})}),e.jsx(v,{type:"button",size:"sm",variant:"outline",onClick:()=>{D(null),R("")},className:"rounded-lg h-9 w-9 p-0 shrink-0","aria-label":"Annuler",children:e.jsx(me,{className:"h-4 w-4"})})]})}):null,j&&i>0?e.jsx("div",{className:"mt-3 rounded-xl bg-muted/30 border border-border p-3",children:e.jsx("div",{className:"grid grid-cols-5 gap-2 text-center text-xs",children:[50,60,70,80,90].map(c=>e.jsxs("div",{className:"space-y-0.5",children:[e.jsxs("div",{className:"text-[10px] text-muted-foreground font-medium",children:[c,"%"]}),e.jsx("div",{className:"font-bold tabular-nums font-mono",children:Math.round(i*c/10)/10})]},c))})}):null]},t.id)})}),Ne.isPending?e.jsxs("div",{className:"px-4 pb-4 text-xs text-muted-foreground flex items-center gap-2",children:[e.jsx(Ee,{className:"h-3 w-3 animate-spin"})," Mise à jour..."]}):null]})})}),e.jsx("div",{className:"h-6"})]})]})})]})}):e.jsx("div",{className:"min-h-[100dvh]",children:e.jsxs("div",{className:"mx-auto max-w-lg px-4 pt-16 pb-10 text-center",children:[e.jsx(ie,{className:"h-10 w-10 mx-auto text-muted-foreground/30"}),e.jsx("p",{className:"mt-3 text-sm text-muted-foreground",children:"Cette page est réservée aux nageurs."})]})})}export{Rs as default};
