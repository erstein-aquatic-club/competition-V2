import{r as i,u as F,j as e,c as be,d as Q,f as pt}from"./vendor-query-DyA9aSKS.js";import{b as rt,B as L,P as oe,w as Le,d as ye,L as W,I as Z,s as Ue,X as gt,v as jt,u as it,f as ft,t as bt,$ as yt,a as vt}from"./index-D-sSumw0.js";import{a as h}from"./api-v-rWGS79.js";import{T as Nt,a as Ct,b as we,c as _e}from"./tabs-CRh_yGFv.js";import{B as J}from"./badge-q2iM4RMT.js";import{C as Oe,w as ct,a as lt,M as Ke,S as Je,G as ot,b as wt}from"./weekTypeColor-BxgPjd12.js";import{T as Be}from"./textarea-C-P82Pf1.js";import{S as ue,a as me,b as xe,c as he,d as X}from"./select-CeYPqIMw.js";import{T as _t,a as Me}from"./toggle-group-CL0CUQEI.js";import{S as Ee,a as qe,b as Fe,c as Ae,d as Ye}from"./sheet-DzexlSPX.js";import{A as te,a as se,b as ne,c as ae,d as re,e as ie,f as ce,g as le}from"./alert-dialog-5P-XktC0.js";import{a as St,O as $e,f as kt,F as Tt,e as Dt,p as Xe}from"./ObjectiveCard-BdVCVCTL.js";import{t as We}from"./date-DrpgLmFD.js";import{C as Et}from"./copy-Bg1Vh-4t.js";import{T as Ve}from"./trash-2-C5kiKNP9.js";import{C as qt}from"./index-DeSprgNO.js";import{P as Ft}from"./pencil-C9jk_jYj.js";import{C as At,a as Mt,b as Pt}from"./collapsible-BuD6HUI-.js";import{S as Lt,b as Ot,c as Kt}from"./smsUtils-CSIXdNA0.js";import{C as $t}from"./chevron-up-Dnb3Zm8K.js";import{C as Wt}from"./chevron-down-BwNiMzOJ.js";import{C as Re}from"./clock-3XSGuxsj.js";import{C as Rt}from"./chevron-right-nTHJksD-.js";import{T as zt}from"./trophy-1d7AwNsx.js";import{M as Qt}from"./map-pin-CJSKe2bs.js";import{A as Ut}from"./arrow-left-BDM8SJRv.js";import"./vendor-react-BzrpNAyj.js";import"./vendor-charts-BrQ8X25f.js";import"./vendor-supabase-DFPLkPj_.js";import"./vendor-motion-lao-Njgm.js";import"./swim-Bs_jBCv9.js";import"./index-yOFjNWFg.js";import"./index-BVSEINNm.js";import"./chart-column-CHR225yA.js";import"./index-DCX2sNhR.js";import"./index-DRMXbYLa.js";import"./vendor-date-B8Mnp-Vt.js";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bt=[["path",{d:"M16 14v2.2l1.6 1",key:"fo4ql5"}],["path",{d:"M16 2v4",key:"4m81vk"}],["path",{d:"M21 7.5V6a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h3.5",key:"1osxxc"}],["path",{d:"M3 10h5",key:"r794hk"}],["path",{d:"M8 2v4",key:"1cmpym"}],["circle",{cx:"16",cy:"16",r:"6",key:"qoo3c4"}]],Vt=rt("calendar-clock",Bt);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const It=[["path",{d:"M9 17H7A5 5 0 0 1 7 7h2",key:"8i5ue5"}],["path",{d:"M15 7h2a5 5 0 1 1 0 10h-2",key:"1b9ql8"}],["line",{x1:"8",x2:"16",y1:"12",y2:"12",key:"1jonct"}]],Gt=rt("link-2",It);async function Ht(t){const{data:s,error:n}=await Ue.rpc("get_auth_uid_for_user",{p_user_id:t});return n?(console.error("[objectives-tab] Failed to resolve auth UUID:",n.message),null):s}const Jt=({open:t,onOpenChange:s,objective:n,athleteName:a,athleteAuthId:o,competitions:m})=>{const{toast:c}=ye(),y=be(),C=!!n,[u,x]=i.useState("chrono"),[b,N]=i.useState(""),[_,j]=i.useState("25"),[T,A]=i.useState(""),[D,E]=i.useState(""),[w,R]=i.useState(""),[K,U]=i.useState(!1);i.useEffect(()=>{if(t)if(n){const l=!!n.event_code,$=!!n.text;x(l&&$?"both":$?"texte":"chrono"),N(n.event_code??""),j(String(n.pool_length??25)),A(n.target_time_seconds!=null?kt(n.target_time_seconds):""),E(n.text??""),R(n.competition_id??"")}else x("chrono"),N(""),j("25"),A(""),E(""),R("")},[t,n]);const d=Q({mutationFn:l=>h.createObjective(l),onSuccess:()=>{c({title:"Objectif crÃ©Ã©"}),y.invalidateQueries({queryKey:["objectives",o]}),s(!1)},onError:l=>{c({title:"Erreur",description:l.message,variant:"destructive"})}}),p=Q({mutationFn:l=>h.updateObjective(n.id,l),onSuccess:()=>{c({title:"Objectif mis Ã  jour"}),y.invalidateQueries({queryKey:["objectives",o]}),s(!1)},onError:l=>{c({title:"Erreur",description:l.message,variant:"destructive"})}}),f=Q({mutationFn:()=>h.deleteObjective(n.id),onSuccess:()=>{c({title:"Objectif supprimÃ©"}),y.invalidateQueries({queryKey:["objectives",o]}),s(!1)},onError:l=>{c({title:"Erreur",description:l.message,variant:"destructive"})}}),P=u==="chrono"||u==="both",g=u==="texte"||u==="both",k=()=>{if(P&&!b){c({title:"Ã‰preuve requise",description:"Veuillez sÃ©lectionner une Ã©preuve.",variant:"destructive"});return}if(P&&T&&Xe(T)===null){c({title:"Format invalide",description:"Le temps doit Ãªtre au format m:ss:cc (ex: 1:05:30)",variant:"destructive"});return}if(g&&!D.trim()){c({title:"Texte requis",description:"Veuillez saisir un objectif texte.",variant:"destructive"});return}const l={athlete_id:o,competition_id:w&&w!=="none"?w:null,event_code:P?b:null,pool_length:P?Number(_):null,target_time_seconds:P&&T?Xe(T):null,text:g?D.trim():null};C?p.mutate(l):d.mutate(l)},S=d.isPending||p.isPending||f.isPending,v=i.useMemo(()=>{const l=new Date;return l.setHours(0,0,0,0),m.filter($=>new Date($.date+"T00:00:00").getTime()>=l.getTime())},[m]);return e.jsxs(e.Fragment,{children:[e.jsx(Ee,{open:t,onOpenChange:s,children:e.jsxs(qe,{side:"right",className:"w-full sm:max-w-md overflow-y-auto",children:[e.jsx(Fe,{children:e.jsx(Ae,{children:C?"Modifier l'objectif":"Nouvel objectif"})}),e.jsxs("div",{className:"mt-6 space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(W,{children:"Nageur"}),e.jsx("p",{className:"text-sm font-medium",children:a})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(W,{children:"Type d'objectif"}),e.jsxs(_t,{type:"single",variant:"outline",value:u,onValueChange:l=>{l&&x(l)},className:"justify-start",children:[e.jsx(Me,{value:"chrono",className:"text-xs",children:"Chrono"}),e.jsx(Me,{value:"texte",className:"text-xs",children:"Texte"}),e.jsx(Me,{value:"both",className:"text-xs",children:"Les deux"})]})]}),P&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(W,{children:"Ã‰preuve *"}),e.jsxs(ue,{value:b,onValueChange:N,children:[e.jsx(me,{children:e.jsx(xe,{placeholder:"Choisir une Ã©preuve"})}),e.jsx(he,{children:Tt.map(l=>e.jsx(X,{value:l,children:Dt(l)},l))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(W,{children:"Bassin"}),e.jsxs(ue,{value:_,onValueChange:j,children:[e.jsx(me,{children:e.jsx(xe,{})}),e.jsxs(he,{children:[e.jsx(X,{value:"25",children:"25m"}),e.jsx(X,{value:"50",children:"50m"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(W,{children:"Temps cible (min:sec:centiÃ¨mes)"}),e.jsx(Z,{placeholder:"Ex : 1:05:30",value:T,onChange:l=>A(l.target.value)})]})]}),g&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(W,{children:"Objectif texte *"}),e.jsx(Be,{placeholder:"Ex : AmÃ©liorer la coulÃ©e de dos",value:D,onChange:l=>E(l.target.value),rows:3})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(W,{children:"Lier Ã  une compÃ©tition"}),e.jsxs(ue,{value:w,onValueChange:R,children:[e.jsx(me,{children:e.jsx(xe,{placeholder:"Aucune"})}),e.jsxs(he,{children:[e.jsx(X,{value:"none",children:"Aucune"}),v.map(l=>e.jsxs(X,{value:l.id,children:[l.name," (",l.date,")"]},l.id))]})]})]}),e.jsxs("div",{className:"space-y-2 pt-2",children:[e.jsx(L,{className:"w-full",onClick:k,disabled:S,children:S?"Enregistrement...":C?"Enregistrer":"CrÃ©er"}),C&&e.jsx(L,{variant:"outline",className:"w-full text-destructive hover:text-destructive",onClick:()=>U(!0),disabled:S,children:"Supprimer cet objectif"})]})]})]})}),e.jsx(te,{open:K,onOpenChange:U,children:e.jsxs(se,{children:[e.jsxs(ne,{children:[e.jsx(ae,{children:"Supprimer l'objectif"}),e.jsx(re,{children:"Cette action est irrÃ©versible. L'objectif sera supprimÃ© dÃ©finitivement."})]}),e.jsxs(ie,{children:[e.jsx(ce,{children:"Annuler"}),e.jsx(le,{onClick:()=>{f.mutate(),U(!1)},className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Supprimer"})]})]})})]})},Yt=({athleteId:t,athleteName:s})=>{const[n,a]=i.useState(!1),[o,m]=i.useState(null),{data:c,isLoading:y}=F({queryKey:["auth-uid",t],queryFn:()=>Ht(t),enabled:!!t}),{data:C=[]}=F({queryKey:["competitions"],queryFn:()=>h.getCompetitions()}),{data:u=[],isLoading:x}=F({queryKey:["objectives",c],queryFn:()=>h.getObjectives(c),enabled:!!c}),{data:b}=F({queryKey:["profile",t],queryFn:()=>h.getProfile({userId:t}),enabled:!!t}),N=b?.ffn_iuf??null,_=i.useMemo(()=>{const w=new Date;return w.setDate(w.getDate()-360),w.toISOString().slice(0,10)},[]),{data:j=[]}=F({queryKey:["swimmer-performances-recent",N],queryFn:()=>h.getSwimmerPerformances({iuf:N,fromDate:_}),enabled:!!N}),T=()=>{m(null),a(!0)},A=w=>{m(w),a(!0)},D=y,E=!!c&&!y;return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex justify-end",children:e.jsxs(L,{variant:"outline",size:"sm",onClick:T,disabled:!c,children:[e.jsx(oe,{className:"mr-1.5 h-3.5 w-3.5"}),"Ajouter un objectif"]})}),D&&e.jsx("div",{className:"space-y-2",children:[1,2,3].map(w=>e.jsx("div",{className:"rounded-xl border p-3 animate-pulse motion-reduce:animate-none",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-4 w-40 rounded bg-muted"}),e.jsx("div",{className:"ml-auto h-5 w-12 rounded bg-muted"})]})},w))}),E&&x&&e.jsx("div",{className:"space-y-2",children:[1,2].map(w=>e.jsx("div",{className:"rounded-xl border p-3 animate-pulse motion-reduce:animate-none",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-4 w-32 rounded bg-muted"}),e.jsx("div",{className:"ml-auto h-5 w-16 rounded bg-muted"})]})},w))}),E&&!x&&u.length===0&&e.jsxs("div",{className:"text-center py-12 space-y-3",children:[e.jsx(Le,{className:"h-10 w-10 text-muted-foreground mx-auto"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Aucun objectif dÃ©fini pour ",s,"."]}),e.jsxs(L,{variant:"outline",size:"sm",onClick:T,children:[e.jsx(oe,{className:"mr-1.5 h-3.5 w-3.5"}),"CrÃ©er le premier objectif"]})]}),E&&!x&&u.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(St,{children:u.map(w=>e.jsx($e,{objective:w,performances:j,onClick:()=>A(w)},w.id))}),e.jsx("p",{className:"text-[10px] text-muted-foreground/60 italic text-center pt-1",children:"Les temps Â« Actuel Â» correspondent Ã  la meilleure performance des 360 derniers jours sur l'Ã©preuve."})]}),c&&e.jsx(Jt,{open:n,onOpenChange:a,objective:o,athleteName:s,athleteAuthId:c,competitions:C})]})},ze="__today__";function Qe(t,s){const n=[],a=new Date(t+"T00:00:00"),o=new Date(s+"T00:00:00"),m=new Date(a),c=m.getDay(),y=c===0?1:c===1?0:8-c;for(m.setDate(m.getDate()+y);m<=o;)n.push(m.toISOString().split("T")[0]),m.setDate(m.getDate()+7);return n}function Ne(t){return new Date(t+"T00:00:00").toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric"})}function Se(t){return new Date(t+"T00:00:00").toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit"})}function Xt(t){const s=new Date(t+"T00:00:00");return s.setDate(s.getDate()+6),s.toISOString().split("T")[0]}function Zt(t){const s=new Date;s.setHours(0,0,0,0);const n=new Date(t+"T00:00:00"),a=new Date(t+"T00:00:00");return a.setDate(a.getDate()+6),s>=n&&s<=a}const es=({athleteId:t})=>{const{toast:s}=ye(),n=be(),[a,o]=i.useState(null),[m,c]=i.useState(null),[y,C]=i.useState(""),[u,x]=i.useState(""),[b,N]=i.useState(!1),[_,j]=i.useState(!1),[T,A]=i.useState(!1),[D,E]=i.useState(""),[w,R]=i.useState(""),[K,U]=i.useState(""),{data:d=[]}=F({queryKey:["athletes"],queryFn:()=>h.getAthletes()}),p=i.useMemo(()=>d.find(O=>O.id===t)?.group_id??null,[d,t]),{data:f=[],isLoading:P}=F({queryKey:["training-cycles","athlete",t],queryFn:()=>h.getTrainingCycles({athleteId:t})}),{data:g=[],isLoading:k}=F({queryKey:["training-cycles","group",p],queryFn:()=>h.getTrainingCycles({groupId:p}),enabled:p!=null}),S=f.length===0&&g.length>0,v=f.length>0?f:g;i.useEffect(()=>{v.length>0&&(!a||!v.find(r=>r.id===a))&&o(v[0].id)},[v,a]);const l=v.find(r=>r.id===a)??null,{data:$=[],isLoading:pe}=F({queryKey:["training-weeks",a],queryFn:()=>h.getTrainingWeeks(a),enabled:!!a}),{data:M=[]}=F({queryKey:["competitions"],queryFn:()=>h.getCompetitions()}),z=i.useMemo(()=>[...M].sort((r,O)=>r.date.localeCompare(O.date)),[M]),B=i.useMemo(()=>{const r=new Set;return $.forEach(O=>{O.week_type&&r.add(O.week_type)}),Array.from(r).sort()},[$]),V=l?.start_competition_date??l?.start_date??null,q=i.useMemo(()=>{if(!l)return[];const r=V,O=l.end_competition_date;return!r||!O?[]:Qe(r,O)},[l,V]),de=i.useMemo(()=>{const r=new Map;return $.forEach(O=>r.set(O.week_start,O)),r},[$]),ge=P||k,je=Q({mutationFn:async r=>{const O=await h.createTrainingCycle(r),I=r.start_date??M.find(H=>H.id===r.start_competition_id)?.date,G=M.find(H=>H.id===r.end_competition_id);if(I&&G){const H=Qe(I,G.date);H.length>0&&await h.bulkUpsertTrainingWeeks(H.map(ve=>({cycle_id:O.id,week_start:ve})))}return O},onSuccess:r=>{s({title:"Cycle cree"}),o(r.id),N(!1),E(""),R(""),U(""),n.invalidateQueries({queryKey:["training-cycles"]}),n.invalidateQueries({queryKey:["training-weeks",r.id]})},onError:r=>{s({title:"Erreur",description:r.message,variant:"destructive"})}}),fe=Q({mutationFn:r=>h.deleteTrainingCycle(r),onSuccess:()=>{s({title:"Cycle supprime"}),o(null),j(!1),n.invalidateQueries({queryKey:["training-cycles"]})},onError:r=>{s({title:"Erreur",description:r.message,variant:"destructive"})}}),Ie=Q({mutationFn:r=>h.upsertTrainingWeek(r),onSuccess:()=>{c(null),n.invalidateQueries({queryKey:["training-weeks",a]})},onError:r=>{s({title:"Erreur",description:r.message,variant:"destructive"})}}),Ge=Q({mutationFn:async()=>{for(const r of g){const O=await h.createTrainingCycle({athlete_id:t,group_id:null,start_competition_id:r.start_competition_id,end_competition_id:r.end_competition_id,name:r.name,notes:r.notes}),I=await h.getTrainingWeeks(r.id);I.length>0&&await h.bulkUpsertTrainingWeeks(I.map(G=>({cycle_id:O.id,week_start:G.week_start,week_type:G.week_type,notes:G.notes})))}},onSuccess:()=>{s({title:"Planification personnalisee"}),A(!1),o(null),n.invalidateQueries({queryKey:["training-cycles"]})},onError:r=>{s({title:"Erreur",description:r.message,variant:"destructive"})}}),He=()=>{if(!D.trim()){s({title:"Nom requis",variant:"destructive"});return}if(!w||!K){s({title:"Dates requises",description:"Choisis un debut et une fin.",variant:"destructive"});return}const r=w===ze,O=r?We(new Date):null,I=r?null:M.find(ve=>ve.id===w),G=M.find(ve=>ve.id===K),H=r?O:I?.date;if(H&&G&&G.date<=H){s({title:"Dates invalides",description:"La fin doit etre apres le debut.",variant:"destructive"});return}je.mutate({athlete_id:t,group_id:null,start_competition_id:r?null:w,end_competition_id:K,start_date:O,name:D.trim()})},ut=r=>{c(r.id),C(r.week_type??""),x(r.notes??"")},mt=r=>{c(`new:${r}`),C(""),x("")},xt=(r,O)=>{a&&Ie.mutate({cycle_id:a,week_start:r,week_type:y.trim()||null,notes:u.trim()||null})},ht=()=>{c(null)};return!ge&&v.length===0?e.jsxs("div",{className:"text-center py-12 space-y-3",children:[e.jsx(Oe,{className:"h-10 w-10 text-muted-foreground mx-auto"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Aucun cycle pour ce nageur."}),e.jsxs(L,{variant:"outline",size:"sm",onClick:()=>N(!0),children:[e.jsx(oe,{className:"mr-1.5 h-3.5 w-3.5"}),"Nouveau cycle"]}),e.jsx(Ze,{open:b,onOpenChange:N,competitions:z,name:D,setName:E,startId:w,setStartId:R,endId:K,setEndId:U,onSubmit:He,isPending:je.isPending})]}):ge?e.jsx("div",{className:"space-y-3",children:[1,2,3].map(r=>e.jsx("div",{className:"rounded-xl border p-3 animate-pulse motion-reduce:animate-none",children:e.jsx("div",{className:"h-4 w-48 rounded bg-muted"})},r))}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[v.length>1?e.jsxs(ue,{value:a??"",onValueChange:o,children:[e.jsx(me,{className:"w-auto min-w-[180px] h-8 text-sm",children:e.jsx(xe,{placeholder:"Choisir un cycle"})}),e.jsx(he,{children:v.map(r=>e.jsx(X,{value:r.id,children:r.name},r.id))})]}):l?e.jsx("span",{className:"text-sm font-semibold",children:l.name}):null,S&&e.jsx(J,{variant:"secondary",className:"text-[10px] px-1.5 py-0",children:"Planif. groupe"}),e.jsx("div",{className:"flex-1"}),S&&e.jsxs(L,{variant:"outline",size:"sm",className:"text-xs h-10",onClick:()=>A(!0),children:[e.jsx(Et,{className:"mr-1 h-3 w-3"}),"Personnaliser"]}),e.jsxs(L,{variant:"outline",size:"sm",className:"text-xs h-10",onClick:()=>N(!0),children:[e.jsx(oe,{className:"mr-1 h-3 w-3"}),"Nouveau"]}),l&&!S&&e.jsx(L,{variant:"ghost",size:"sm",className:"text-xs h-10 w-10 text-destructive hover:text-destructive",onClick:()=>j(!0),children:e.jsx(Ve,{className:"h-3 w-3"})})]}),l&&e.jsxs("div",{className:"space-y-0",children:[e.jsxs("div",{className:"flex items-center gap-2 py-2 px-1",children:[e.jsx("span",{className:"text-base","aria-hidden":"true",children:l.start_competition_id?"ðŸŠ":"ðŸ“…"}),e.jsx("span",{className:"text-sm font-medium",children:l.start_competition_id?l.start_competition_name??"Competition":"Debut du cycle"}),V&&e.jsxs("span",{className:"text-xs text-muted-foreground",children:["(",Ne(V),")"]})]}),e.jsx("div",{className:"relative ml-3 border-l-2 border-border pl-4 space-y-1",children:pe?e.jsx("div",{className:"py-4",children:e.jsx("div",{className:"h-4 w-32 rounded bg-muted animate-pulse motion-reduce:animate-none"})}):q.map((r,O)=>{const I=de.get(r),G=Zt(r),H=m===(I?.id??`new:${r}`);return e.jsx(ts,{monday:r,weekNumber:O+1,week:I,isCurrent:G,isEditing:H,isGroupPlan:S,editWeekType:y,setEditWeekType:C,editWeekNotes:u,setEditWeekNotes:x,existingWeekTypes:B,onStartEdit:()=>I?ut(I):mt(r),onSave:()=>xt(r),onCancel:ht,isSaving:Ie.isPending},r)})}),e.jsxs("div",{className:"flex items-center gap-2 py-2 px-1",children:[e.jsx("span",{className:"text-base","aria-hidden":"true",children:"ðŸŽ¯"}),e.jsx("span",{className:"text-sm font-medium",children:l.end_competition_name??"Competition"}),l.end_competition_date&&e.jsxs("span",{className:"text-xs text-muted-foreground",children:["(",Ne(l.end_competition_date),")"]})]})]}),e.jsx(Ze,{open:b,onOpenChange:N,competitions:z,name:D,setName:E,startId:w,setStartId:R,endId:K,setEndId:U,onSubmit:He,isPending:je.isPending}),e.jsx(te,{open:_,onOpenChange:j,children:e.jsxs(se,{children:[e.jsxs(ne,{children:[e.jsx(ae,{children:"Supprimer le cycle"}),e.jsx(re,{children:"Le cycle et ses semaines seront supprimes."})]}),e.jsxs(ie,{children:[e.jsx(ce,{children:"Annuler"}),e.jsx(le,{onClick:()=>a&&fe.mutate(a),className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Supprimer"})]})]})}),e.jsx(te,{open:T,onOpenChange:A,children:e.jsxs(se,{children:[e.jsxs(ne,{children:[e.jsx(ae,{children:"Personnaliser la planification"}),e.jsx(re,{children:"Copie le plan du groupe pour ce nageur. Tu pourras ensuite l'ajuster."})]}),e.jsxs(ie,{children:[e.jsx(ce,{children:"Annuler"}),e.jsx(le,{onClick:()=>Ge.mutate(),children:Ge.isPending?"Copie...":"Personnaliser"})]})]})})]})},ts=({monday:t,weekNumber:s,week:n,isCurrent:a,isEditing:o,isGroupPlan:m,editWeekType:c,setEditWeekType:y,editWeekNotes:C,setEditWeekNotes:u,existingWeekTypes:x,onStartEdit:b,onSave:N,onCancel:_,isSaving:j})=>{const T=Xt(t),A=`week-types-${t}`;return o?e.jsxs("div",{className:`rounded-lg border bg-card p-3 space-y-2 ${a?"ring-2 ring-primary":""}`,children:[e.jsxs("div",{className:"text-xs font-medium text-muted-foreground",children:["Sem. ",s," (",Se(t)," - ",Se(T),")"]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(W,{className:"text-xs",children:"Type de semaine"}),e.jsx(Z,{className:"h-7 text-sm",placeholder:"Ex : Foncier, Affutage",list:A,value:c,onChange:D=>y(D.target.value)}),e.jsx("datalist",{id:A,children:x.map(D=>e.jsx("option",{value:D},D))})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(W,{className:"text-xs",children:"Notes"}),e.jsx(Be,{className:"text-sm min-h-[48px]",placeholder:"Note optionnelle",rows:2,value:C,onChange:D=>u(D.target.value)})]}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsxs(L,{variant:"ghost",size:"sm",className:"h-10 text-xs",onClick:_,children:[e.jsx(gt,{className:"mr-1 h-3 w-3"}),"Annuler"]}),e.jsxs(L,{size:"sm",className:"h-10 text-xs",onClick:N,disabled:j,children:[e.jsx(qt,{className:"mr-1 h-3 w-3"}),j?"...":"Enregistrer"]})]})]}):e.jsxs("button",{type:"button",className:`w-full text-left rounded-lg border bg-card px-3 py-2 flex items-center gap-2 transition-colors ${m?"cursor-default":"hover:bg-muted/50"} ${a?"ring-2 ring-primary":""}`,onClick:m?void 0:b,disabled:m,children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs("span",{className:"text-xs font-medium text-muted-foreground whitespace-nowrap",children:["Sem. ",s]}),e.jsxs("span",{className:"text-[10px] text-muted-foreground/70 whitespace-nowrap",children:["(",Se(t)," - ",Se(T),")"]}),n?.week_type&&e.jsx(J,{className:"text-[10px] px-1.5 py-0 border-0",style:{backgroundColor:lt(n.week_type),color:ct(n.week_type)},children:n.week_type})]}),n?.notes&&e.jsx("p",{className:"text-xs text-muted-foreground mt-0.5 line-clamp-1",children:n.notes})]}),!m&&e.jsx(Ft,{className:"h-3 w-3 text-muted-foreground/40 shrink-0"})]})},Ze=({open:t,onOpenChange:s,competitions:n,name:a,setName:o,startId:m,setStartId:c,endId:y,setEndId:C,onSubmit:u,isPending:x})=>(i.useEffect(()=>{t&&(o(""),c(""),C(""))},[t]),e.jsx(Ee,{open:t,onOpenChange:s,children:e.jsxs(qe,{side:"right",className:"w-full sm:max-w-md overflow-y-auto",children:[e.jsx(Fe,{children:e.jsx(Ae,{children:"Nouveau cycle"})}),e.jsxs("div",{className:"mt-6 space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(W,{children:"Nom du cycle *"}),e.jsx(Z,{placeholder:"Ex : Preparation hiver",value:a,onChange:b=>o(b.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(W,{children:"Date de debut *"}),e.jsxs(ue,{value:m,onValueChange:c,children:[e.jsx(me,{children:e.jsx(xe,{placeholder:"Choisir..."})}),e.jsxs(he,{children:[e.jsxs(X,{value:ze,children:["Aujourd'hui (",Ne(We(new Date)),")"]}),n.map(b=>e.jsxs(X,{value:b.id,children:[b.name," (",Ne(b.date),")"]},b.id))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(W,{children:"Competition de fin *"}),e.jsxs(ue,{value:y,onValueChange:C,children:[e.jsx(me,{children:e.jsx(xe,{placeholder:"Choisir..."})}),e.jsx(he,{children:n.map(b=>e.jsxs(X,{value:b.id,children:[b.name," (",Ne(b.date),")"]},b.id))})]})]}),m&&y&&(()=>{const N=m===ze?We(new Date):n.find(j=>j.id===m)?.date,_=n.find(j=>j.id===y);if(N&&_&&_.date>N){const j=Qe(N,_.date).length;return e.jsxs("p",{className:"text-xs text-muted-foreground",children:[j," semaine",j>1?"s":""," seront generees."]})}return null})(),e.jsx(L,{className:"w-full",onClick:u,disabled:x,children:x?"Creation...":"Creer le cycle"})]})]})}));function Ce(t){return new Date(t+"T12:00:00").toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric"})}function ke(t){return new Date(t+"T00:00:00").toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit"})}function ss(t){const s=new Date(t+"T00:00:00");return s.setDate(s.getDate()+6),s.toISOString().split("T")[0]}function ns(t){const s=new Date;s.setHours(0,0,0,0);const n=new Date(t+"T00:00:00"),a=new Date(t+"T00:00:00");return a.setDate(a.getDate()+6),s>=n&&s<=a}function Pe(t,s){const n=[],a=new Date(t+"T00:00:00"),o=new Date(s+"T00:00:00"),m=new Date(a),c=m.getDay(),y=c===0?1:c===1?0:8-c;for(m.setDate(m.getDate()+y);m<=o;)n.push(m.toISOString().split("T")[0]),m.setDate(m.getDate()+7);return n}function et(t,s){const n=new Date(t+"T00:00:00"),a=new Date(s+"T00:00:00");return Math.round((a.getTime()-n.getTime())/(1e3*60*60*24))}const as={draft_athlete:{label:"En attente nageur",variant:"secondary",className:"bg-amber-100 text-amber-800 dark:bg-amber-900/40 dark:text-amber-300 border-amber-200 dark:border-amber-800"},draft_coach:{label:"PrÃ©paration coach",variant:"secondary",className:"bg-blue-100 text-blue-800 dark:bg-blue-900/40 dark:text-blue-300 border-blue-200 dark:border-blue-800"},sent:{label:"EnvoyÃ©",variant:"secondary",className:"bg-green-100 text-green-800 dark:bg-green-900/40 dark:text-green-300 border-green-200 dark:border-green-800"},signed:{label:"SignÃ©",variant:"secondary",className:"bg-slate-100 text-slate-600 dark:bg-slate-800/40 dark:text-slate-300 border-slate-200 dark:border-slate-700"}};function rs(t){const s=as[t];return e.jsx(J,{variant:s.variant,className:`text-[10px] px-1.5 py-0 ${s.className}`,children:s.label})}async function is(t){const{data:s,error:n}=await Ue.rpc("get_auth_uid_for_user",{p_user_id:t});return n?(console.error("[interviews-tab] Failed to resolve auth UUID:",n.message),null):s}const ee=({label:t,text:s})=>e.jsxs("div",{className:"border-l-4 border-blue-400 rounded-r-lg bg-blue-50/50 dark:bg-blue-950/20 p-3 space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(jt,{className:"h-3.5 w-3.5 text-blue-500"}),e.jsx("p",{className:"text-xs font-bold uppercase tracking-widest text-muted-foreground",children:t})]}),e.jsx("p",{className:"text-sm whitespace-pre-wrap",children:s?.trim()||e.jsx("span",{className:"italic text-muted-foreground",children:"Non renseignÃ©"})})]}),Te=({label:t,text:s})=>e.jsxs("div",{className:"border-l-4 border-amber-400 rounded-r-lg bg-amber-50/50 dark:bg-amber-950/20 p-3 space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(ot,{className:"h-3.5 w-3.5 text-amber-500"}),e.jsx("p",{className:"text-xs font-bold uppercase tracking-widest text-muted-foreground",children:t})]}),e.jsx("p",{className:"text-sm whitespace-pre-wrap",children:s?.trim()||e.jsx("span",{className:"italic text-muted-foreground",children:"Non renseignÃ©"})})]}),De=({label:t,value:s,onChange:n,onBlur:a,placeholder:o,rows:m=3})=>e.jsxs("div",{className:"border-l-4 border-amber-400 rounded-r-lg bg-amber-50/50 dark:bg-amber-950/20 p-3 space-y-1.5",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(ot,{className:"h-3.5 w-3.5 text-amber-500"}),e.jsx("p",{className:"text-xs font-bold uppercase tracking-widest text-muted-foreground",children:t})]}),e.jsx(Be,{className:"bg-white dark:bg-background",placeholder:o,value:s,onChange:c=>n(c.target.value),onBlur:a,rows:m})]}),Y=({label:t})=>e.jsxs("div",{className:"flex items-center gap-2 pt-3",children:[e.jsx("div",{className:"h-px flex-1 bg-border"}),e.jsx("span",{className:"text-xs font-bold uppercase tracking-widest text-muted-foreground",children:t}),e.jsx("div",{className:"h-px flex-1 bg-border"})]}),tt=({prevInterview:t,commitmentReview:s})=>{const[n,a]=i.useState(!1);return e.jsxs(At,{open:n,onOpenChange:a,children:[e.jsx(Mt,{asChild:!0,children:e.jsxs("button",{type:"button",className:"w-full flex items-center gap-2 rounded-xl border bg-muted/30 px-3 py-2.5 text-left transition-colors hover:bg-muted/50",children:[e.jsx(Rt,{className:`h-3.5 w-3.5 text-muted-foreground shrink-0 transition-transform ${n?"rotate-90":""}`}),e.jsx("span",{className:"text-xs font-bold uppercase tracking-widest text-muted-foreground",children:"Rappel engagements prÃ©cÃ©dents"}),e.jsx(J,{variant:"secondary",className:"text-[10px] px-1.5 py-0 ml-auto",children:Ce(t.date)})]})}),e.jsx(Pt,{children:e.jsxs("div",{className:"rounded-b-xl border border-t-0 bg-muted/30 px-3 pb-3 space-y-2",children:[t.athlete_commitments&&e.jsxs("div",{className:"border-l-4 border-blue-400 rounded-r-lg bg-blue-50/50 dark:bg-blue-950/20 p-2",children:[e.jsx("p",{className:"text-[10px] font-semibold text-muted-foreground",children:"Engagements nageur"}),e.jsx("p",{className:"text-xs whitespace-pre-wrap",children:t.athlete_commitments})]}),t.coach_actions&&e.jsxs("div",{className:"border-l-4 border-amber-400 rounded-r-lg bg-amber-50/50 dark:bg-amber-950/20 p-2",children:[e.jsx("p",{className:"text-[10px] font-semibold text-muted-foreground",children:"Actions coach"}),e.jsx("p",{className:"text-xs whitespace-pre-wrap",children:t.coach_actions})]}),s&&e.jsxs("div",{className:"border-l-4 border-blue-400 rounded-r-lg bg-blue-50/80 dark:bg-blue-950/30 p-2",children:[e.jsx("p",{className:"text-[10px] font-semibold text-muted-foreground",children:"Bilan du nageur"}),e.jsx("p",{className:"text-xs whitespace-pre-wrap",children:s})]})]})})]})},st=({athleteId:t,interviewDate:s})=>{const{toast:n}=ye(),a=be(),{data:o=[]}=F({queryKey:["competitions"],queryFn:()=>h.getCompetitions()}),{data:m=[]}=F({queryKey:["my-competition-ids",t],queryFn:()=>h.getMyCompetitionIds(t)}),c=i.useMemo(()=>{const d=new Set(m);return o.filter(p=>d.has(p.id)).sort((p,f)=>p.date.localeCompare(f.date))},[o,m]),y=i.useMemo(()=>c.filter(d=>d.date>=s),[c,s]),{data:C=[]}=F({queryKey:["training-cycles","athlete",t],queryFn:()=>h.getTrainingCycles({athleteId:t})}),u=i.useMemo(()=>{const d=new Map;return C.slice().sort((p,f)=>(p.end_competition_date??"").localeCompare(f.end_competition_date??"")).forEach(p=>{p.end_competition_id&&!d.has(p.end_competition_id)&&d.set(p.end_competition_id,p)}),d},[C]),x=i.useMemo(()=>{const d=new Set;return y.map(p=>u.get(p.id)??null).filter(p=>!p||d.has(p.id)?!1:(d.add(p.id),!0))},[y,u]),b=pt({queries:x.map(d=>({queryKey:["training-weeks",d.id],queryFn:()=>h.getTrainingWeeks(d.id),enabled:!!d.id}))}),[N,_]=i.useState(null),[j,T]=i.useState(""),A=i.useMemo(()=>{const d=new Map;return x.forEach((p,f)=>{d.set(p.id,b[f]?.data??[])}),d},[x,b]),D=i.useMemo(()=>{const d=new Set;return A.forEach(p=>{p.forEach(f=>{f.week_type&&d.add(f.week_type)})}),Array.from(d).sort()},[A]),E=y[0]??null,w=i.useMemo(()=>new Date().toISOString().split("T")[0],[]),R=E?et(w,E.date):null,K=Q({mutationFn:async d=>{const p=c.find(v=>v.id===d);if(!p)throw new Error("Pas de compÃ©tition");const f=c.findIndex(v=>v.id===d),P=f>0?c[f-1]:null,g=P?.date??s,k=await h.createTrainingCycle({athlete_id:t,group_id:null,start_competition_id:P?.id??null,start_date:P?null:s,end_competition_id:p.id,name:`PrÃ©paration ${p.name}`}),S=Pe(g,p.date);return S.length>0&&await h.bulkUpsertTrainingWeeks(S.map(v=>({cycle_id:k.id,week_start:v}))),k},onSuccess:()=>{n({title:"Planification crÃ©Ã©e"}),a.invalidateQueries({queryKey:["training-cycles"]}),a.invalidateQueries({queryKey:["training-weeks"]})},onError:d=>{n({title:"Erreur",description:d.message,variant:"destructive"})}}),U=Q({mutationFn:d=>h.upsertTrainingWeek(d),onSuccess:()=>{_(null),a.invalidateQueries({queryKey:["training-weeks"]})},onError:d=>{n({title:"Erreur",description:d.message,variant:"destructive"})}});return E?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"rounded-xl border bg-muted/20 p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm flex-wrap",children:[e.jsx(zt,{className:"h-4 w-4 text-amber-500 shrink-0"}),e.jsxs("span",{className:"font-medium",children:[y.length," Ã©chÃ©ance",y.length>1?"s":""," Ã  planifier"]}),R!=null&&e.jsxs(J,{variant:"secondary",className:"text-[10px]",children:["prochaine J-",R]})]}),e.jsx("p",{className:"mt-1 text-xs text-muted-foreground",children:"Une carte par compÃ©tition cible pour construire et piloter plusieurs macrocycles Ã  l'avance."})]}),e.jsx("div",{className:"space-y-3",children:y.map((d,p)=>{const f=u.get(d.id)??null,P=f?A.get(f.id)??[]:[],g=new Map(P.map(M=>[M.week_start,M])),k=f?.start_date??f?.start_competition_date??s,S=k>s?k:s,v=f?Pe(S,d.date):[],l=f?Pe(k,d.date):[],$=Math.max(l.length-v.length,0),pe=et(w,d.date);return e.jsxs("div",{className:"rounded-xl border bg-card shadow-sm overflow-hidden",children:[e.jsxs("div",{className:"border-b border-border bg-muted/20 px-3 py-2.5",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"text-sm font-semibold",children:d.name}),p===0&&e.jsx(J,{className:"text-[10px] bg-primary/10 text-primary border-primary/20",children:"PrioritÃ©"}),e.jsx(J,{variant:"secondary",className:"text-[10px]",children:Ce(d.date)}),e.jsxs(J,{variant:"outline",className:"text-[10px]",children:["J-",pe]})]}),f?e.jsxs("div",{className:"mt-1 flex items-center gap-2 flex-wrap text-xs text-muted-foreground",children:[e.jsx("span",{className:"font-medium text-foreground",children:f.name}),f.start_competition_name&&e.jsxs("span",{children:["depuis ",f.start_competition_name]}),e.jsxs("span",{children:[l.length," sem."]}),$>0&&e.jsxs("span",{children:[$," dÃ©jÃ  passÃ©es"]})]}):e.jsx("p",{className:"mt-1 text-xs text-muted-foreground",children:"Aucun macrocycle crÃ©Ã© pour cette Ã©chÃ©ance."})]}),f?v.length===0?e.jsx("div",{className:"px-3 py-3 text-xs text-muted-foreground italic",children:"Aucune semaine future Ã  afficher sur ce macrocycle."}):e.jsx("div",{className:"px-3 py-3",children:e.jsx("div",{className:"relative ml-2 border-l-2 border-border pl-3 space-y-1.5",children:v.map((M,z)=>{const B=g.get(M),V=ns(M),q=ss(M),de=`${f.id}:${M}`,ge=N===de,je=`inline-week-${f.id}-${M}`;return ge?e.jsxs("div",{className:`rounded-lg border bg-card p-2 space-y-1.5 ${V?"ring-2 ring-primary":""}`,children:[e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Sem. ",$+z+1," (",ke(M)," - ",ke(q),")"]}),e.jsx(Z,{className:"h-7 text-sm",placeholder:"Foncier, Techni., AffÃ»tage...",list:je,value:j,onChange:fe=>T(fe.target.value)}),e.jsx("datalist",{id:je,children:D.map(fe=>e.jsx("option",{value:fe},fe))}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx(L,{variant:"ghost",size:"sm",className:"h-6 text-xs px-2",onClick:()=>_(null),children:"Annuler"}),e.jsx(L,{size:"sm",className:"h-6 text-xs px-2",onClick:()=>{U.mutate({cycle_id:f.id,week_start:M,week_type:j.trim()||null,notes:B?.notes??null})},disabled:U.isPending,children:"OK"})]})]},M):e.jsxs("button",{type:"button",className:`w-full text-left rounded-lg border bg-card px-2.5 py-2 text-xs transition-colors hover:bg-muted/50 ${V?"ring-2 ring-primary bg-primary/5":""}`,onClick:()=>{_(de),T(B?.week_type??"")},children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:`h-2 w-2 rounded-full shrink-0 ${V?"bg-primary":B?.week_type?"bg-muted-foreground/40":"bg-muted-foreground/20"}`}),e.jsxs("span",{className:"text-muted-foreground whitespace-nowrap",children:["Sem. ",$+z+1]}),e.jsxs("span",{className:"text-muted-foreground/70 whitespace-nowrap",children:[ke(M)," - ",ke(q)]}),B?.week_type&&e.jsx(J,{className:"text-[10px] px-1.5 py-0 border-0 ml-auto",style:{backgroundColor:lt(B.week_type),color:ct(B.week_type)},children:B.week_type})]}),B?.notes&&e.jsx("p",{className:"mt-1 pl-4 text-[11px] text-muted-foreground line-clamp-2",children:B.notes})]},M)})})}):e.jsxs("div",{className:"px-3 py-3 space-y-2",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"CrÃ©ez un macrocycle dÃ©diÃ© pour donner de la visibilitÃ© long terme sur cette cible."}),e.jsx(L,{variant:"outline",size:"sm",className:"w-full text-xs",onClick:()=>K.mutate(d.id),disabled:K.isPending,children:K.isPending?"CrÃ©ation...":"CrÃ©er ce macrocycle"})]})]},d.id)})})]}):e.jsx("div",{className:"text-center py-4",children:e.jsx("p",{className:"text-xs text-muted-foreground italic",children:"Aucune compÃ©tition assignÃ©e Ã  venir â€” planification non disponible."})})},cs=({interview:t,athleteId:s,athleteName:n,athletePhone:a,objectives:o,performances:m})=>{const{toast:c}=ye(),y=be(),[C,u]=i.useState(!1),[x,b]=i.useState(t.coach_comment_successes??""),[N,_]=i.useState(t.coach_comment_difficulties??""),[j,T]=i.useState(t.coach_comment_goals??""),A=t.coach_review??"",D=t.coach_objectives??"",[E,w]=i.useState(t.coach_actions??""),[R,K]=i.useState(!1),[U,d]=i.useState(!1),[p,f]=i.useState(!1),P=i.useRef(!1),{data:g}=F({queryKey:["previous-interview",s,t.date,t.id],queryFn:()=>h.getPreviousInterview(s,t.date,t.id),enabled:!!t.date}),k=i.useCallback(()=>({coach_comment_successes:x.trim()||null,coach_comment_difficulties:N.trim()||null,coach_comment_goals:j.trim()||null,coach_review:A.trim()||null,coach_objectives:D.trim()||null,coach_actions:E.trim()||null}),[E,N,j,x,D,A]),S=i.useCallback(()=>{const q=k();return(t.coach_comment_successes??null)!==q.coach_comment_successes||(t.coach_comment_difficulties??null)!==q.coach_comment_difficulties||(t.coach_comment_goals??null)!==q.coach_comment_goals||(t.coach_review??null)!==q.coach_review||(t.coach_objectives??null)!==q.coach_objectives||(t.coach_actions??null)!==q.coach_actions},[k,t]),v=Q({mutationFn:q=>h.updateInterviewCoachSections(t.id,q),onSuccess:()=>{y.invalidateQueries({queryKey:["interviews",s]})},onError:q=>{c({title:"Erreur",description:q.message,variant:"destructive"})}}),l=Q({mutationFn:async()=>(await h.updateInterviewCoachSections(t.id,k()),h.sendInterviewToAthlete(t.id)),onSuccess:()=>{c({title:"Entretien envoyÃ© au nageur"}),y.invalidateQueries({queryKey:["interviews",s]}),f(!0)},onError:q=>{c({title:"Erreur",description:q.message,variant:"destructive"})}}),$=()=>{if(!a)return;const de=`Bonjour ${n.split(" ")[0]}, ton entretien est disponible. Consulte-le ici : https://erstein-aquatic-club.github.io/competition/#/profile`,ge=Ot([a],de);Kt()?window.location.href=ge:navigator.clipboard.writeText(`${a}
${de}`).then(()=>{c({title:"CopiÃ©",description:"NumÃ©ro et message copiÃ©s dans le presse-papiers."})}).catch(()=>{c({title:"Erreur",description:"Impossible de copier.",variant:"destructive"})}),f(!1)},pe=Q({mutationFn:()=>h.deleteInterview(t.id),onSuccess:()=>{c({title:"Entretien supprimÃ©"}),y.invalidateQueries({queryKey:["interviews",s]})},onError:q=>{c({title:"Erreur",description:q.message,variant:"destructive"})}}),M=v.isPending||l.isPending||pe.isPending,z=t.status,B=z==="draft_athlete"?"border-amber-300 dark:border-amber-700 border-l-4":z==="draft_coach"?"border-blue-300 dark:border-blue-700 border-l-4":z==="sent"?"border-emerald-300 dark:border-emerald-700 border-l-4":"",V=i.useCallback(()=>{z!=="draft_coach"||P.current||M||!S()||(P.current=!0,v.mutate(k()),window.setTimeout(()=>{P.current=!1},500))},[k,S,M,v,z]);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:`rounded-xl border bg-card shadow-sm ${B}`,children:[e.jsxs("button",{type:"button",className:"w-full flex items-center justify-between p-4 text-left",onClick:()=>u(q=>!q),children:[e.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[e.jsx("span",{className:"text-sm font-semibold",children:Ce(t.date)}),rs(z),z==="signed"&&t.signed_at&&e.jsxs("span",{className:"text-xs text-muted-foreground",children:["le ",Ce(t.signed_at.slice(0,10))]})]}),C?e.jsx($t,{className:"h-4 w-4 text-muted-foreground shrink-0"}):e.jsx(Wt,{className:"h-4 w-4 text-muted-foreground shrink-0"})]}),C&&e.jsxs("div",{className:"px-4 pb-4 space-y-5",children:[z==="draft_athlete"&&e.jsxs("div",{className:"rounded-xl border border-dashed border-amber-300 bg-amber-50/50 dark:bg-amber-950/20 p-6 text-center space-y-2",children:[e.jsx(Re,{className:"h-8 w-8 mx-auto text-amber-500"}),e.jsx("p",{className:"text-sm font-medium",children:"En attente de la prÃ©paration du nageur"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Le contenu n'est pas encore visible. Le nageur doit d'abord remplir ses sections."})]}),z==="draft_coach"&&e.jsxs(e.Fragment,{children:[g&&e.jsx(tt,{prevInterview:g,commitmentReview:t.athlete_commitment_review}),e.jsx(Y,{label:"RÃ©ussites"}),e.jsx(ee,{label:"Nageur",text:t.athlete_successes}),e.jsx(De,{label:"Coach",value:x,onChange:b,onBlur:V,placeholder:"Votre commentaire sur les rÃ©ussites..."}),e.jsx(Y,{label:"DifficultÃ©s"}),e.jsx(ee,{label:"Nageur",text:t.athlete_difficulties}),e.jsx(De,{label:"Coach",value:N,onChange:_,onBlur:V,placeholder:"Votre commentaire sur les difficultÃ©s..."}),e.jsx(Y,{label:"Objectifs"}),o.length>0&&e.jsx("div",{className:"space-y-1.5",children:o.map(q=>e.jsx($e,{objective:q,performances:m,compact:!0},q.id))}),e.jsx(ee,{label:"Nageur",text:t.athlete_goals}),e.jsx(De,{label:"Coach",value:j,onChange:T,onBlur:V,placeholder:"Objectifs complÃ©mentaires, commentaires..."}),e.jsx(Y,{label:"Planification"}),e.jsx(st,{athleteId:s,interviewDate:t.date}),e.jsx(Y,{label:"Engagements & Actions"}),e.jsxs("div",{className:"rounded-xl bg-card border shadow-sm p-4 space-y-3",children:[e.jsx(ee,{label:"Engagements du nageur",text:t.athlete_commitments}),e.jsx(De,{label:"Actions du coach",value:E,onChange:w,onBlur:V,placeholder:"Actions concrÃ¨tes, points de suivi..."})]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:v.isPending?"Sauvegarde...":"Sauvegarde automatique a la sortie d'un champ."})]}),(z==="sent"||z==="signed")&&e.jsxs(e.Fragment,{children:[g&&e.jsx(tt,{prevInterview:g,commitmentReview:t.athlete_commitment_review}),e.jsx(Y,{label:"RÃ©ussites"}),e.jsx(ee,{label:"Nageur",text:t.athlete_successes}),e.jsx(Te,{label:"Coach",text:t.coach_comment_successes||t.coach_review}),e.jsx(Y,{label:"DifficultÃ©s"}),e.jsx(ee,{label:"Nageur",text:t.athlete_difficulties}),e.jsx(Te,{label:"Coach",text:t.coach_comment_difficulties}),e.jsx(Y,{label:"Objectifs"}),o.length>0&&e.jsx("div",{className:"space-y-1.5",children:o.map(q=>e.jsx($e,{objective:q,performances:m,compact:!0},q.id))}),e.jsx(ee,{label:"Nageur",text:t.athlete_goals}),e.jsx(Te,{label:"Coach",text:t.coach_comment_goals||t.coach_objectives}),e.jsx(Y,{label:"Planification"}),e.jsx(st,{athleteId:s,interviewDate:t.date}),e.jsx(Y,{label:"Engagements & Actions"}),e.jsxs("div",{className:"rounded-xl bg-card border shadow-sm p-4 space-y-3",children:[e.jsx(ee,{label:"Engagements du nageur",text:t.athlete_commitments}),e.jsx(Te,{label:"Actions du coach",text:t.coach_actions})]})]}),e.jsxs("div",{className:"space-y-2 pt-2 border-t",children:[z==="draft_coach"&&e.jsxs(L,{className:"w-full",onClick:()=>d(!0),disabled:M,children:[e.jsx(Je,{className:"mr-1.5 h-3.5 w-3.5"}),"Envoyer au nageur"]}),e.jsxs(L,{variant:"outline",className:"w-full text-destructive hover:text-destructive",onClick:()=>K(!0),disabled:M,children:[e.jsx(Ve,{className:"mr-1.5 h-3.5 w-3.5"}),"Supprimer"]})]})]})]}),e.jsx(te,{open:R,onOpenChange:K,children:e.jsxs(se,{children:[e.jsxs(ne,{children:[e.jsx(ae,{children:"Supprimer l'entretien"}),e.jsxs(re,{children:["Cette action est irrÃ©versible. L'entretien du ",t.date?Ce(t.date):""," sera supprimÃ© dÃ©finitivement."]})]}),e.jsxs(ie,{children:[e.jsx(ce,{children:"Annuler"}),e.jsx(le,{onClick:()=>{pe.mutate(),K(!1)},className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Supprimer"})]})]})}),e.jsx(te,{open:U,onOpenChange:d,children:e.jsxs(se,{children:[e.jsxs(ne,{children:[e.jsx(ae,{children:"Envoyer au nageur"}),e.jsx(re,{children:"L'entretien sera envoyÃ© au nageur pour consultation. Les sections coach seront enregistrÃ©es automatiquement."})]}),e.jsxs(ie,{children:[e.jsx(ce,{children:"Annuler"}),e.jsxs(le,{onClick:()=>{l.mutate(),d(!1)},children:[e.jsx(Je,{className:"mr-1.5 h-3.5 w-3.5"}),"Envoyer"]})]})]})}),e.jsx(te,{open:p,onOpenChange:f,children:e.jsxs(se,{children:[e.jsxs(ne,{children:[e.jsx(ae,{children:"Entretien envoyÃ©"}),e.jsx(re,{children:a?e.jsxs(e.Fragment,{children:["L'entretien a bien Ã©tÃ© envoyÃ© Ã  ",e.jsx("strong",{children:n}),". Voulez-vous le notifier par SMS ?"]}):e.jsxs(e.Fragment,{children:["L'entretien a bien Ã©tÃ© envoyÃ© Ã  ",e.jsx("strong",{children:n}),". Aucun numÃ©ro de tÃ©lÃ©phone enregistrÃ© pour ce nageur."]})})]}),e.jsxs(ie,{children:[e.jsx(ce,{children:"Plus tard"}),e.jsxs(le,{onClick:$,disabled:!a,children:[e.jsx(Lt,{className:"mr-1.5 h-3.5 w-3.5"}),"Envoyer le SMS"]})]})]})})]})},ls=({athleteId:t,athleteName:s})=>{const{toast:n}=ye(),a=be(),{data:o}=F({queryKey:["auth-uid",t],queryFn:()=>is(t),enabled:!!t}),{data:m=[]}=F({queryKey:["objectives",o],queryFn:()=>h.getObjectives(o),enabled:!!o}),{data:c}=F({queryKey:["athlete-profile",t],queryFn:()=>h.getProfile({userId:t}),enabled:!!t}),y=c?.ffn_iuf??null,C=c?.phone??null,u=i.useMemo(()=>{const j=new Date;return j.setDate(j.getDate()-360),j.toISOString().slice(0,10)},[]),{data:x=[]}=F({queryKey:["swimmer-performances-recent",y],queryFn:()=>h.getSwimmerPerformances({iuf:y,fromDate:u}),enabled:!!y}),{data:b=[],isLoading:N}=F({queryKey:["interviews",t],queryFn:()=>h.getInterviews(t),enabled:!!t}),_=Q({mutationFn:()=>h.createInterview({athlete_id:t}),onSuccess:()=>{n({title:"Entretien crÃ©Ã©"}),a.invalidateQueries({queryKey:["interviews",t]})},onError:j=>{n({title:"Erreur",description:j.message,variant:"destructive"})}});return N?e.jsx("div",{className:"space-y-2",children:[1,2,3].map(j=>e.jsx("div",{className:"rounded-xl border p-3 animate-pulse motion-reduce:animate-none",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-4 w-24 rounded bg-muted"}),e.jsx("div",{className:"ml-auto h-5 w-20 rounded bg-muted"})]})},j))}):b.length===0?e.jsxs("div",{className:"text-center py-12 space-y-3",children:[e.jsx(Ke,{className:"h-10 w-10 text-muted-foreground mx-auto"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Aucun entretien pour ",s,"."]}),e.jsxs(L,{variant:"outline",size:"sm",onClick:()=>_.mutate(),disabled:_.isPending,children:[e.jsx(oe,{className:"mr-1.5 h-3.5 w-3.5"}),_.isPending?"CrÃ©ation...":"Nouvel entretien"]})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"text-sm font-semibold",children:"Entretiens"}),e.jsx(J,{variant:"secondary",className:"text-[10px] px-1.5 py-0",children:b.length})]}),e.jsxs(L,{variant:"outline",size:"sm",onClick:()=>_.mutate(),disabled:_.isPending,children:[e.jsx(oe,{className:"mr-1.5 h-3.5 w-3.5"}),_.isPending?"CrÃ©ation...":"Nouvel entretien"]})]}),e.jsx("div",{className:"space-y-2",children:b.map(j=>e.jsx(cs,{interview:j,athleteId:t,athleteName:s,athletePhone:C,objectives:m,performances:x},j.id))})]})},dt=["Lundi","Mardi","Mercredi","Jeudi","Vendredi","Samedi","Dimanche"];function nt(t){const[s,n]=t.split(":").map(Number);return s*60+n}function os(t,s){const n=nt(s)-nt(t),a=Math.floor(n/60),o=n%60;return a===0?`${o}min`:o===0?`${a}h`:`${a}h${String(o).padStart(2,"0")}`}function ds(t){const s=t.toLowerCase();return s.includes("piscine")||s.includes("bassin")||!s.includes("salle")&&!s.includes("muscu")&&!s.includes("ppg")&&!s.includes("gym")}function us({athleteId:t,athleteName:s,groupId:n}){const{userId:a}=it(),{toast:o}=ye(),m=be(),{data:c,isLoading:y}=F({queryKey:["swimmer-slots",t],queryFn:()=>h.getSwimmerSlots(t)}),{data:C}=F({queryKey:["swimmer-slots-exists",t],queryFn:()=>h.hasCustomSlots(t)}),{data:u=[]}=F({queryKey:["training-slots","group",n],queryFn:()=>h.getTrainingSlotsForGroup(n)}),x=C===!0,b=x?c??[]:[],N=()=>{m.invalidateQueries({queryKey:["swimmer-slots",t]}),m.invalidateQueries({queryKey:["swimmer-slots-exists",t]})},_=Q({mutationFn:()=>h.initSwimmerSlots(t,n,a),onSuccess:()=>{N(),o({title:"Planning personnalisÃ© crÃ©Ã©"})},onError:g=>o({title:"Erreur",description:g.message,variant:"destructive"})}),j=Q({mutationFn:()=>h.resetSwimmerSlots(t,n,a),onSuccess:()=>{N(),o({title:"Planning rÃ©initialisÃ©"})},onError:g=>o({title:"Erreur",description:g.message,variant:"destructive"})}),T=Q({mutationFn:g=>h.deleteSwimmerSlot(g),onSuccess:()=>{N(),o({title:"CrÃ©neau supprimÃ©"})}}),A=Q({mutationFn:g=>h.createSwimmerSlot(g,a),onSuccess:()=>{N(),o({title:"CrÃ©neau ajoutÃ©"})},onError:g=>o({title:"Erreur",description:g.message,variant:"destructive"})}),D=Q({mutationFn:({slotId:g,input:k})=>h.updateSwimmerSlot(g,k),onSuccess:()=>{N(),o({title:"CrÃ©neau modifiÃ©"})},onError:g=>o({title:"Erreur",description:g.message,variant:"destructive"})}),[E,w]=i.useState(null),[R,K]=i.useState(!1),[U,d]=i.useState(!1),[p,f]=i.useState(null),P=i.useMemo(()=>{const g=x?b:u,k=new Map;for(const S of g){const v=k.get(S.day_of_week)??[];v.push(S),k.set(S.day_of_week,v)}return k},[x,b,u]);return y?e.jsx("div",{className:"space-y-3",children:Array.from({length:5}).map((g,k)=>e.jsx(ft,{className:"h-14 rounded-lg"},k))}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between gap-2",children:x?e.jsxs(e.Fragment,{children:[e.jsxs(L,{size:"sm",variant:"outline",onClick:()=>K(!0),children:[e.jsx(oe,{className:"h-3.5 w-3.5 mr-1"}),"Ajouter"]}),e.jsxs(L,{size:"sm",variant:"ghost",onClick:()=>d(!0),children:[e.jsx(bt,{className:"h-3.5 w-3.5 mr-1"}),"RÃ©initialiser"]})]}):e.jsxs(L,{size:"sm",onClick:()=>_.mutate(),disabled:_.isPending,children:[e.jsx(oe,{className:"h-3.5 w-3.5 mr-1"}),"Personnaliser le planning"]})}),!x&&u.length>0&&e.jsx("div",{className:"rounded-lg border border-blue-200 bg-blue-50 dark:border-blue-800 dark:bg-blue-950/30 px-3 py-2 text-sm text-blue-700 dark:text-blue-300",children:"HÃ©rite du planning du groupe. Cliquez sur Â« Personnaliser Â» pour ajuster."}),[1,2,3,4,5,6,7].map(g=>{const k=P.get(g);return!k||k.length===0?null:e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-xs font-semibold text-muted-foreground uppercase tracking-wider",children:dt[g-1]}),k.map(S=>{const v=ds(S.location);return e.jsx("button",{type:"button",className:"w-full text-left rounded-xl border border-border bg-card transition-all active:scale-[0.98] hover:border-border/80",onClick:()=>x?w(S):void 0,children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:`w-1 rounded-l-xl flex-shrink-0 ${v?"bg-blue-500":"bg-amber-400"}`}),e.jsxs("div",{className:"flex-1 px-3 py-2.5 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-sm font-bold tabular-nums text-foreground",children:[S.start_time.slice(0,5)," â€“ ",S.end_time.slice(0,5)]}),e.jsx("span",{className:`text-xs tabular-nums px-1.5 py-0.5 rounded-md font-medium ${v?"bg-blue-500/10 text-blue-600 dark:text-blue-400":"bg-amber-400/10 text-amber-600 dark:text-amber-400"}`,children:os(S.start_time,S.end_time)})]}),x&&S.source_assignment_id&&e.jsx(Gt,{className:"h-3.5 w-3.5 text-blue-500 flex-shrink-0"})]}),e.jsxs("div",{className:"flex items-center gap-1.5 mt-1",children:[e.jsx(Qt,{className:"h-3 w-3 text-muted-foreground flex-shrink-0"}),e.jsx("span",{className:"text-xs text-muted-foreground truncate",children:S.location})]})]})]})},S.id)})]},g)}),P.size===0&&e.jsx("p",{className:"text-center text-sm text-muted-foreground py-8",children:"Aucun crÃ©neau configurÃ©."}),e.jsx(te,{open:U,onOpenChange:d,children:e.jsxs(se,{children:[e.jsxs(ne,{children:[e.jsx(ae,{children:"RÃ©initialiser le planning ?"}),e.jsx(re,{children:"Tous les crÃ©neaux personnalisÃ©s seront supprimÃ©s et remplacÃ©s par ceux du groupe."})]}),e.jsxs(ie,{children:[e.jsx(ce,{children:"Annuler"}),e.jsx(le,{onClick:()=>{j.mutate(),d(!1)},children:"RÃ©initialiser"})]})]})}),e.jsx(te,{open:!!p,onOpenChange:()=>f(null),children:e.jsxs(se,{children:[e.jsxs(ne,{children:[e.jsx(ae,{children:"Supprimer ce crÃ©neau ?"}),e.jsx(re,{children:"Le crÃ©neau sera retirÃ© du planning personnel."})]}),e.jsxs(ie,{children:[e.jsx(ce,{children:"Annuler"}),e.jsx(le,{onClick:()=>{p&&T.mutate(p),f(null)},className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Supprimer"})]})]})}),e.jsx(Ee,{open:!!E,onOpenChange:g=>!g&&w(null),children:e.jsxs(qe,{side:"bottom",className:"max-h-[80vh]",children:[e.jsxs(Fe,{children:[e.jsx(Ae,{children:"Modifier le crÃ©neau"}),e.jsx(Ye,{children:"Ajustez les horaires ou le lieu"})]}),E&&e.jsx(ms,{slot:E,onSave:g=>{D.mutate({slotId:E.id,input:g}),w(null)},onDelete:()=>{f(E.id),w(null)},isPending:D.isPending})]})}),e.jsx(Ee,{open:R,onOpenChange:K,children:e.jsxs(qe,{side:"bottom",className:"max-h-[80vh]",children:[e.jsxs(Fe,{children:[e.jsx(Ae,{children:"Ajouter un crÃ©neau"}),e.jsx(Ye,{children:"Nouveau crÃ©neau personnalisÃ©"})]}),e.jsx(xs,{onSave:g=>{A.mutate({...g,user_id:t}),K(!1)},isPending:A.isPending})]})})]})}function ms({slot:t,onSave:s,onDelete:n,isPending:a}){const[o,m]=i.useState(t.start_time.slice(0,5)),[c,y]=i.useState(t.end_time.slice(0,5)),[C,u]=i.useState(t.location);return e.jsxs("div",{className:"space-y-4 pt-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(W,{children:"DÃ©but"}),e.jsx(Z,{type:"time",value:o,onChange:x=>m(x.target.value)})]}),e.jsxs("div",{children:[e.jsx(W,{children:"Fin"}),e.jsx(Z,{type:"time",value:c,onChange:x=>y(x.target.value)})]})]}),e.jsxs("div",{children:[e.jsx(W,{children:"Lieu"}),e.jsx(Z,{value:C,onChange:x=>u(x.target.value)})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(L,{className:"flex-1",onClick:()=>s({start_time:o,end_time:c,location:C}),disabled:a,children:"Enregistrer"}),e.jsx(L,{variant:"destructive",size:"icon",onClick:n,children:e.jsx(Ve,{className:"h-4 w-4"})})]})]})}function xs({onSave:t,isPending:s}){const[n,a]=i.useState("1"),[o,m]=i.useState("08:00"),[c,y]=i.useState("10:00"),[C,u]=i.useState("");return e.jsxs("div",{className:"space-y-4 pt-4",children:[e.jsxs("div",{children:[e.jsx(W,{children:"Jour"}),e.jsxs(ue,{value:n,onValueChange:a,children:[e.jsx(me,{children:e.jsx(xe,{})}),e.jsx(he,{children:dt.map((x,b)=>e.jsx(X,{value:String(b+1),children:x},b+1))})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(W,{children:"DÃ©but"}),e.jsx(Z,{type:"time",value:o,onChange:x=>m(x.target.value)})]}),e.jsxs("div",{children:[e.jsx(W,{children:"Fin"}),e.jsx(Z,{type:"time",value:c,onChange:x=>y(x.target.value)})]})]}),e.jsxs("div",{children:[e.jsx(W,{children:"Lieu"}),e.jsx(Z,{value:C,onChange:x=>u(x.target.value),placeholder:"Piscine, Salle..."})]}),e.jsx(L,{className:"w-full",onClick:()=>t({day_of_week:Number(n),start_time:o,end_time:c,location:C}),disabled:s||!C,children:"Ajouter"})]})}function at(t){const s=Math.floor((Date.now()-new Date(t).getTime())/864e5);return s===0?"aujourd'hui":s===1?"hier":s<0?`dans ${-s}j`:`il y a ${s}j`}async function hs(t){const{data:s,error:n}=await Ue.rpc("get_auth_uid_for_user",{p_user_id:t});return n?null:s}function Xs({athleteId:t,athleteName:s,onBack:n}={}){const[,a]=yt("/coach/swimmer/:id"),[,o]=vt(),{selectedAthleteId:m,selectedAthleteName:c}=it(),[y,C]=i.useState("resume"),u=t??(a?.id?Number(a.id):m),x=s??c,{data:b}=F({queryKey:["profile",u],queryFn:()=>h.getProfile({userId:u}),enabled:u!=null}),N=300*1e3,{data:_}=F({queryKey:["sessions",u],queryFn:()=>h.getSessions(x??"",u),enabled:!!u,staleTime:N}),{data:j}=F({queryKey:["interviews",u],queryFn:()=>h.getInterviews(u),enabled:!!u,staleTime:N}),{data:T}=F({queryKey:["training-cycles",u],queryFn:()=>h.getTrainingCycles({athleteId:u}),enabled:!!u,staleTime:N}),{data:A}=F({queryKey:["auth-uid",u],queryFn:()=>hs(u),enabled:!!u,staleTime:N}),{data:D}=F({queryKey:["objectives",A],queryFn:()=>h.getObjectives(A),enabled:!!A,staleTime:N}),E=_?.[0]?.date??null,w=i.useMemo(()=>{if(!_||_.length===0)return null;const S=_.slice(0,7).map(v=>v.engagement).filter(v=>v!=null&&Number.isFinite(v));return S.length===0?null:S.reduce((v,l)=>v+l,0)/S.length},[_]),R=j?.length??0,K=j?.[0]?.date??null,U=i.useMemo(()=>{if(!T||T.length===0)return null;const k=new Date().toISOString().slice(0,10);return T.find(v=>{const l=v.start_date??v.start_competition_date??"",$=v.end_competition_date??"";return l<=k&&$>=k})?.name??T[0]?.name??null},[T]),d=D?.length??0,p=b?.display_name??x??"Nageur",f=b?.avatar_url??null,P=b?.group_label??null,g=n??(()=>o("/coach?section=swimmers"));return u?e.jsxs("div",{className:"mx-auto max-w-3xl px-4 py-4 space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{type:"button",onClick:g,className:"h-9 w-9 rounded-xl border border-border bg-card flex items-center justify-center hover:bg-muted transition","aria-label":"Retour",children:e.jsx(Ut,{className:"h-4 w-4"})}),f?e.jsx("img",{src:f,alt:"",className:"h-10 w-10 rounded-full object-cover border border-border"}):e.jsx("div",{className:"h-10 w-10 rounded-full bg-primary/10 flex items-center justify-center text-sm font-bold text-primary",children:p.charAt(0).toUpperCase()}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h1",{className:"text-lg font-bold truncate",children:p}),P&&e.jsx(J,{variant:"secondary",className:"text-[10px] px-1.5 py-0",children:P})]})]}),e.jsxs(Nt,{value:y,onValueChange:k=>C(k),children:[e.jsxs(Ct,{className:"grid h-auto w-full grid-cols-2 gap-2 bg-transparent p-0",children:[e.jsx(we,{value:"resume",className:"rounded-xl border bg-card px-3 py-2 text-xs data-[state=active]:border-primary data-[state=active]:bg-primary/5",children:"RÃ©sumÃ©"}),e.jsx(we,{value:"suivi",className:"rounded-xl border bg-card px-3 py-2 text-xs data-[state=active]:border-primary data-[state=active]:bg-primary/5",children:"Suivi"}),e.jsx(we,{value:"echanges",className:"rounded-xl border bg-card px-3 py-2 text-xs data-[state=active]:border-primary data-[state=active]:bg-primary/5",children:"Ã‰changes"}),e.jsx(we,{value:"planif",className:"rounded-xl border bg-card px-3 py-2 text-xs data-[state=active]:border-primary data-[state=active]:bg-primary/5",children:"Planif"})]}),e.jsx(_e,{value:"resume",className:"mt-4 space-y-3",children:e.jsxs("div",{className:"rounded-2xl border bg-card p-4",children:[e.jsx("p",{className:"text-sm font-semibold",children:"Vue rapide"}),e.jsxs("p",{className:"mt-1 text-sm text-muted-foreground",children:["AccÃ¨s direct au suivi, aux entretiens et Ã  la planification de ",p,"."]}),e.jsxs("div",{className:"mt-3 grid grid-cols-2 gap-2",children:[e.jsxs("button",{type:"button",onClick:()=>C("suivi"),className:"rounded-xl border px-3 py-3 text-left active:bg-muted",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Re,{className:"h-4 w-4 text-blue-500"}),e.jsx("span",{className:"text-sm font-medium",children:"Suivi"})]}),e.jsx("p",{className:"mt-1.5 text-xs text-muted-foreground truncate",children:_===void 0?"...":E?`Dernier : ${at(E)}`:"Aucun ressenti"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:_===void 0?"":w!=null?`Engagement moy. : ${w.toFixed(1)}/5`:"â€”"})]}),e.jsxs("button",{type:"button",onClick:()=>C("echanges"),className:"rounded-xl border px-3 py-3 text-left active:bg-muted",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ke,{className:"h-4 w-4 text-violet-500"}),e.jsx("span",{className:"text-sm font-medium",children:"Ã‰changes"})]}),e.jsx("p",{className:"mt-1.5 text-xs text-muted-foreground truncate",children:j===void 0?"...":R>0?`${R} entretien${R>1?"s":""}`:"Aucun entretien"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:j===void 0?"":K?`Dernier : ${at(K)}`:"â€”"})]}),e.jsxs("button",{type:"button",onClick:()=>C("planif"),className:"rounded-xl border px-3 py-3 text-left active:bg-muted",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Oe,{className:"h-4 w-4 text-emerald-500"}),e.jsx("span",{className:"text-sm font-medium",children:"Planif"})]}),e.jsx("p",{className:"mt-1.5 text-xs text-muted-foreground truncate",children:T===void 0?"...":U||"Aucun cycle"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:T===void 0?"":T.length>0?`${T.length} cycle${T.length>1?"s":""}`:"â€”"})]}),e.jsxs("button",{type:"button",onClick:()=>C("suivi"),className:"rounded-xl border px-3 py-3 text-left active:bg-muted",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Le,{className:"h-4 w-4 text-amber-500"}),e.jsx("span",{className:"text-sm font-medium",children:"Objectifs"})]}),e.jsx("p",{className:"mt-1.5 text-xs text-muted-foreground truncate",children:D===void 0?"...":d>0?`${d} objectif${d>1?"s":""}`:"Aucun objectif"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:D===void 0?"":"â€”"})]})]})]})}),e.jsxs(_e,{value:"suivi",className:"mt-4 space-y-4",children:[e.jsxs("section",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Re,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("h2",{className:"text-sm font-semibold",children:"Ressentis"})]}),e.jsx(wt,{athleteId:u,athleteName:p,showProgressAction:!1})]}),e.jsxs("section",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Le,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("h2",{className:"text-sm font-semibold",children:"Objectifs"})]}),e.jsx(Yt,{athleteId:u,athleteName:p})]})]}),e.jsxs(_e,{value:"echanges",className:"mt-4 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ke,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("h2",{className:"text-sm font-semibold",children:"Entretiens"})]}),e.jsx(ls,{athleteId:u,athleteName:p})]}),e.jsxs(_e,{value:"planif",className:"mt-4 space-y-4",children:[e.jsxs("section",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Oe,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("h2",{className:"text-sm font-semibold",children:"Cycle"})]}),e.jsx(es,{athleteId:u})]}),e.jsxs("section",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Vt,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("h2",{className:"text-sm font-semibold",children:"CrÃ©neaux"})]}),e.jsx(us,{athleteId:u,athleteName:p,groupId:b?.group_id??0})]})]})]})]}):e.jsxs("div",{className:"p-4 text-center text-muted-foreground",children:[e.jsx("p",{children:"Aucun nageur sÃ©lectionnÃ©."}),e.jsx("button",{type:"button",onClick:g,className:"mt-2 text-primary underline",children:"Retour au dashboard"})]})}export{Xs as default};
