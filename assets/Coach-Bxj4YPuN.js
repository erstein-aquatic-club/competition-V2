const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/StrengthCatalog-DNVkk7rX.js","assets/vendor-query-BiSH4r2z.js","assets/vendor-react-BzrpNAyj.js","assets/api-BnNf3xAR.js","assets/index-C8G_MmTY.js","assets/vendor-supabase-6k692oZB.js","assets/index-A8WY3xm8.css","assets/index-ioOYC_fc.js","assets/index-ChLI4Hmx.js","assets/index-BsIFJxHB.js","assets/select-DouxsDmb.js","assets/index-CsSpl54e.js","assets/chevron-down-CSij-H-w.js","assets/check-dxS3qMGb.js","assets/CalendarGrid-CA7DjXNJ.js","assets/chevron-left-Ca3NsW5m.js","assets/chevron-right-B3SLdP_X.js","assets/textarea-Qs8ysCwE.js","assets/dialog-CI-07S4V.js","assets/index-B9mLcJCF.js","assets/checkbox-C_Hcncvi.js","assets/alert-dialog-Du8XoE7N.js","assets/tabs-Dh50JFtl.js","assets/SessionListView-MKBCOcn-.js","assets/play-Bvyo5-nL.js","assets/circle-alert-D6sdVyjj.js","assets/pencil-JFE-fqgt.js","assets/drawer-BVSFl31i.js","assets/search-C6RUg1iM.js","assets/plus-Yxe2Mip6.js","assets/loader-circle-BtoGIGgO.js","assets/pen-Bok-7X7p.js","assets/SwimCatalog-V5CIU7wf.js","assets/SwimSessionTimeline-Ba-bj8K_.js","assets/eye-BriRmLuv.js","assets/clock-D1Km2F0v.js","assets/format-B9mPVj_w.js","assets/timer-MLNUGC-E.js"])))=>i.map(i=>d[i]);
import{c as Y,B as _,d as W,C as me,h as pe,j as xe,l as he,g as ge,L as je,I as Me,W as Ee,D as Be,R as Ze,U as ne,m as es,n as ss,u as Le,b as ts,P as Oe,o as as,k as ns,_ as Ve}from"./index-C8G_MmTY.js";import{j as e,r as i,u as I,c as ce,d as K}from"./vendor-query-BiSH4r2z.js";import{a as D}from"./api-BnNf3xAR.js";import{B as se}from"./badge-DlfejgnZ.js";import{T as Qe,a as te}from"./toggle-group-CkyKne4i.js";import{S as re,a as ie,b as le,c as oe,d as Q}from"./select-DouxsDmb.js";import{a as rs,b as is,T as He,P as ls}from"./CalendarGrid-CA7DjXNJ.js";import{S as De,a as Ae,b as ze,c as Fe,d as qe}from"./sheet-Cf8MmWju.js";import{C as os}from"./checkbox-C_Hcncvi.js";import{S as cs}from"./separator-DDlEeA2K.js";import{A as fe,a as ye,b as ve,c as be,d as Ne,e as we,f as Se,g as Ce}from"./alert-dialog-Du8XoE7N.js";import{C as ds,a as us,b as ms}from"./collapsible-B5r-_0ms.js";import{P as _e}from"./plus-Yxe2Mip6.js";import{U as ps,a as xs}from"./user-plus-N2KJGGfb.js";import{C as hs}from"./chevron-down-CSij-H-w.js";import"./vendor-react-BzrpNAyj.js";import"./vendor-supabase-6k692oZB.js";import"./index-ioOYC_fc.js";import"./index-ChLI4Hmx.js";import"./index-BsIFJxHB.js";import"./index-CsSpl54e.js";import"./check-dxS3qMGb.js";import"./chevron-left-Ca3NsW5m.js";import"./chevron-right-B3SLdP_X.js";import"./index-B9mLcJCF.js";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gs=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],ae=Y("arrow-left",gs);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const js=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 18h.01",key:"lrp35t"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M16 18h.01",key:"kzsmim"}]],ke=Y("calendar-days",js);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fs=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]],ys=Y("external-link",fs);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vs=[["path",{d:"M2 9.5a5.5 5.5 0 0 1 9.591-3.676.56.56 0 0 0 .818 0A5.49 5.49 0 0 1 22 9.5c0 2.29-1.5 4-3 5.5l-5.492 5.313a2 2 0 0 1-3 .019L5 15c-1.5-1.5-3-3.2-3-5.5",key:"mvr1a0"}],["path",{d:"M3.22 13H9.5l.5-1 2 4.5 2-7 1.5 3.5h5.27",key:"auskq0"}]],bs=Y("heart-pulse",vs);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ns=[["path",{d:"m22 7-8.991 5.727a2 2 0 0 1-2.009 0L2 7",key:"132q7q"}],["rect",{x:"2",y:"4",width:"20",height:"16",rx:"2",key:"izxlao"}]],Te=Y("mail",Ns);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ws=[["path",{d:"M18 21a8 8 0 0 0-16 0",key:"3ypg7q"}],["circle",{cx:"10",cy:"8",r:"5",key:"o932ke"}],["path",{d:"M22 20c0-3.37-2-6.5-4-8a5 5 0 0 0-.45-8.3",key:"10s06x"}]],Ue=Y("users-round",ws),U=({title:s,description:r,onBack:j,actions:a})=>e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs(_,{variant:"ghost",size:"sm",className:"-ml-2",onClick:j,children:[e.jsx(ae,{className:"mr-2 h-4 w-4"}),"Retour"]}),e.jsx("h2",{className:"text-2xl font-display font-semibold uppercase italic text-primary",children:s}),r?e.jsx("p",{className:"text-sm text-muted-foreground",children:r}):null]}),a?e.jsx("div",{className:"flex items-center gap-2",children:a}):null]}),Ss=({onBack:s,athletes:r,groups:j,athletesLoading:a})=>{const{toast:o}=W(),[v,b]=i.useState(""),[n,d]=i.useState(""),u=i.useMemo(()=>r.filter(t=>t.id&&t.email).map(t=>({value:`user:${t.id}`,label:t.group_label?`${t.display_name} · ${t.group_label}`:t.display_name,email:t.email})),[r]),p=i.useMemo(()=>j.map(t=>({value:`group:${t.id}`,label:t.name,id:t.id})),[j]),c=()=>{if(!n)return[];if(n.startsWith("user:")){const t=u.find(x=>x.value===n);return t?[t.email]:[]}if(n.startsWith("group:")){const t=Number(n.split(":")[1]);return r.filter(x=>x.group_id===t&&x.email).map(x=>x.email)}return[]},h=()=>{const t=c();if(!t.length){o({title:"Aucune adresse email",description:"Aucun nageur avec une adresse email dans cette sélection."});return}const x=new URLSearchParams;x.set("bcc",t.join(",")),v.trim()&&x.set("subject",v.trim()),window.location.href=`mailto:?${x.toString()}`},f=c();return e.jsxs("div",{className:"space-y-6 pb-24",children:[e.jsx(U,{title:"Contacter par email",description:"Ouvre votre application mail avec les destinataires en CCI.",onBack:s}),e.jsxs(me,{className:"border-l-4 border-l-primary",children:[e.jsxs(pe,{children:[e.jsx(xe,{children:"Destinataire"}),e.jsx(he,{children:"Sélectionnez un nageur ou un groupe."})]}),e.jsxs(ge,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(je,{children:"Destinataire"}),e.jsxs(re,{value:n,onValueChange:d,children:[e.jsx(ie,{children:e.jsx(le,{placeholder:a?"Chargement...":"Choisir un nageur ou un groupe"})}),e.jsxs(oe,{children:[p.length?e.jsxs(e.Fragment,{children:[e.jsx(Q,{value:"section-group",disabled:!0,children:"Groupes"}),p.map(t=>e.jsx(Q,{value:t.value,children:t.label},t.value))]}):null,u.length?e.jsxs(e.Fragment,{children:[e.jsx(Q,{value:"section-athlete",disabled:!0,children:"Nageurs"}),u.map(t=>e.jsx(Q,{value:t.value,children:t.label},t.value))]}):null]})]})]}),n&&f.length>0?e.jsxs("p",{className:"text-xs text-muted-foreground",children:[f.length," adresse",f.length>1?"s":""," email",f.length>1?" (envoi en CCI)":""]}):null,n&&f.length===0?e.jsx("p",{className:"text-xs text-destructive",children:"Aucune adresse email disponible pour cette sélection."}):null]})]}),e.jsxs(me,{children:[e.jsxs(pe,{children:[e.jsx(xe,{children:"Objet"}),e.jsx(he,{children:"Optionnel — pré-rempli dans votre application mail."})]}),e.jsx(ge,{children:e.jsx(Me,{value:v,onChange:t=>b(t.target.value),placeholder:"Objet du mail…"})})]}),e.jsx("div",{className:"sticky bottom-0 z-10 -mx-4 border-t bg-background/95 p-4 backdrop-blur sm:static sm:mx-0 sm:border-0 sm:p-0",children:e.jsxs(_,{className:"w-full sm:w-auto",onClick:h,disabled:!n||f.length===0,children:[e.jsx(Te,{className:"mr-2 h-4 w-4"}),"Ouvrir dans l'app mail",e.jsx(ys,{className:"ml-2 h-3 w-3"})]})})]})};function Pe(s){return String(s).padStart(2,"0")}function H(s){return`${s.getFullYear()}-${Pe(s.getMonth()+1)}-${Pe(s.getDate())}`}function de(s){return new Date(s.getFullYear(),s.getMonth(),1)}function Ge(s,r){const j=new Date(s);return j.setDate(j.getDate()+r),j}function Cs(s){return(s.getDay()+6)%7}function ue(s){if(!s)return"AM";const r=s.toLowerCase();return r==="evening"||r.includes("soir")||r==="pm"?"PM":"AM"}const _s=[{key:"swim-morning",label:"Nage — Matin",type:"swim",scheduledSlot:"morning"},{key:"swim-evening",label:"Nage — Soir",type:"swim",scheduledSlot:"evening"},{key:"strength",label:"Musculation",type:"strength",scheduledSlot:null}];function ks({groupId:s,userId:r,enabled:j}){const a=i.useMemo(()=>new Date,[]),[o,v]=i.useState(()=>de(new Date)),[b,n]=i.useState(()=>H(new Date)),[d,u]=i.useState(null),[p,c]=i.useState(!1),h=i.useMemo(()=>de(o),[o]),f=i.useMemo(()=>{const w=Cs(h),k=Ge(h,-w),C=[];for(let S=0;S<42;S++)C.push(Ge(k,S));return C},[h]),t=i.useMemo(()=>{const w=H(f[0]),k=H(f[f.length-1]);return{from:w,to:k}},[f]),x=!!(s||r),{data:A=[],isLoading:g}=I({queryKey:["coach-calendar-assignments",s,r,t.from,t.to],queryFn:()=>D.getCoachAssignments({groupId:s??null,userId:r??null,from:t.from,to:t.to}),enabled:x}),N=i.useMemo(()=>{const w=new Map;for(const k of A){const C=k.scheduledDate?.slice(0,10);C&&(w.has(C)||w.set(C,[]),w.get(C).push(k))}return w},[A]),E=i.useMemo(()=>{const w={};for(const k of f){const C=H(k),S=N.get(C)??[],F=S.some(z=>ue(z.scheduledSlot)==="AM"),q=S.some(z=>ue(z.scheduledSlot)==="PM"),m=(F?1:0)+(q?1:0),T=[{slotKey:"AM",expected:F,completed:F,absent:!1},{slotKey:"PM",expected:q,completed:q,absent:!1}];w[C]={completed:m,total:m,slots:T}}return w},[f,N]),O=i.useMemo(()=>{const[w,k,C]=b.split("-").map(Number);return new Date(w,k-1,C)},[b]),P=i.useMemo(()=>N.get(b)??[],[N,b]),G=i.useMemo(()=>{const w=P;return _s.map(k=>{const C=w.filter(q=>k.type!==q.type?!1:k.type==="swim"?ue(q.scheduledSlot)===(k.scheduledSlot==="morning"?"AM":"PM"):!0),S=C.find(q=>q.targetType==="user"),F=C.find(q=>q.targetType==="group");return{...k,assignment:S??F??null}})},[P]),V=i.useMemo(()=>{const w={};for(const k of f){const C=H(k),S=N.get(C)??[];w[C]=S.some(F=>F.type==="strength")}return w},[f,N]),y=E[b]??{completed:0,total:0,slots:[{slotKey:"AM",expected:!1,completed:!1,absent:!1},{slotKey:"PM",expected:!1,completed:!1,absent:!1}]},l=i.useCallback(()=>{v(w=>new Date(w.getFullYear(),w.getMonth()-1,1))},[]),L=i.useCallback(()=>{v(w=>new Date(w.getFullYear(),w.getMonth()+1,1))},[]),J=i.useCallback(()=>{v(de(new Date)),n(H(new Date))},[]),X=i.useCallback(w=>{n(w),c(!0)},[]);return{today:a,monthCursor:o,selectedISO:b,selectedDayIndex:d,drawerOpen:p,gridDates:f,completionByISO:E,selectedDate:O,selectedDayStatus:y,assignmentsForSelectedDay:P,slotsForSelectedDay:G,hasStrengthByISO:V,isLoading:g,hasFilter:x,setSelectedISO:n,setSelectedDayIndex:u,setDrawerOpen:c,prevMonth:l,nextMonth:L,jumpToday:J,openDay:X}}function Ms(s){const[r,j,a]=s.split("-").map(Number);return new Date(r,j-1,a).toLocaleDateString("fr-FR",{weekday:"long",day:"numeric",month:"long"})}function Ds({onBack:s,athletes:r,groups:j,swimSessions:a,strengthSessions:o}){const[v,b]=i.useState("group"),[n,d]=i.useState(""),[u,p]=i.useState(""),c=v==="group"&&n?Number(n):null,h=v==="user"&&u?Number(u):null,{today:f,monthCursor:t,selectedISO:x,selectedDayIndex:A,drawerOpen:g,gridDates:N,completionByISO:E,selectedDayStatus:O,slotsForSelectedDay:P,hasStrengthByISO:G,hasFilter:V,setSelectedISO:y,setSelectedDayIndex:l,setDrawerOpen:L,prevMonth:J,nextMonth:X,jumpToday:w,openDay:k}=ks({groupId:c,userId:h,enabled:!0}),C=ce(),S=K({mutationFn:m=>D.assignments_create(m),onSuccess:()=>{C.invalidateQueries({queryKey:["coach-calendar-assignments"]})}}),F=K({mutationFn:m=>D.assignments_delete(m),onSuccess:()=>{C.invalidateQueries({queryKey:["coach-calendar-assignments"]})}}),q=(m,T)=>{let z=T;if(m.key==="ArrowLeft"&&(z=Math.max(0,T-1)),m.key==="ArrowRight"&&(z=Math.min(N.length-1,T+1)),m.key==="ArrowUp"&&(z=Math.max(0,T-7)),m.key==="ArrowDown"&&(z=Math.min(N.length-1,T+7)),z!==T){m.preventDefault(),l(z);const R=ee=>String(ee).padStart(2,"0"),$=N[z],Z=`${$.getFullYear()}-${R($.getMonth()+1)}-${R($.getDate())}`;y(Z)}if(m.key==="Enter"||m.key===" "){m.preventDefault();const R=ee=>String(ee).padStart(2,"0"),$=N[T],Z=`${$.getFullYear()}-${R($.getMonth()+1)}-${R($.getDate())}`;k(Z)}};return e.jsxs("div",{className:"space-y-4",children:[e.jsx(U,{title:"Calendrier",description:"Vue mensuelle des assignations",onBack:s}),e.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center",children:[e.jsxs(Qe,{type:"single",value:v,onValueChange:m=>{(m==="group"||m==="user")&&b(m)},className:"shrink-0",children:[e.jsx(te,{value:"group",className:"text-xs px-3",children:"Groupe"}),e.jsx(te,{value:"user",className:"text-xs px-3",children:"Nageur"})]}),v==="group"?e.jsxs(re,{value:n,onValueChange:d,children:[e.jsx(ie,{className:"w-full sm:w-56",children:e.jsx(le,{placeholder:"Choisir un groupe"})}),e.jsx(oe,{children:j.map(m=>e.jsx(Q,{value:String(m.id),children:m.name},String(m.id)))})]}):e.jsxs(re,{value:u,onValueChange:p,children:[e.jsx(ie,{className:"w-full sm:w-56",children:e.jsx(le,{placeholder:"Choisir un nageur"})}),e.jsx(oe,{children:r.filter(m=>m.id!=null).map(m=>e.jsxs(Q,{value:String(m.id),children:[m.display_name,m.group_label?` · ${m.group_label}`:""]},String(m.id)))})]})]}),V?e.jsxs("div",{className:"rounded-2xl border bg-card shadow-sm",children:[e.jsx(rs,{monthCursor:t,selectedDayStatus:O,onPrevMonth:J,onNextMonth:X,onJumpToday:w}),e.jsx(is,{monthCursor:t,gridDates:N,completionByISO:E,strengthByISO:G,selectedISO:x,selectedDayIndex:A,today:f,onDayClick:k,onKeyDown:q})]}):e.jsx("div",{className:"py-12 text-center text-sm text-muted-foreground",children:"Sélectionnez un groupe ou un nageur pour afficher le calendrier."}),e.jsx(De,{open:g,onOpenChange:L,children:e.jsxs(Ae,{side:"bottom",className:"max-h-[70vh] overflow-y-auto rounded-t-2xl",children:[e.jsxs(ze,{className:"pb-3",children:[e.jsx(Fe,{className:"capitalize text-left",children:Ms(x)}),e.jsx(qe,{className:"sr-only",children:"Gérer les assignations pour cette journée"})]}),e.jsx("div",{className:"space-y-3",children:P.map(m=>{const T=m.assignment?.targetType==="group",z=v==="user";return e.jsx(As,{slot:m,swimSessions:a,strengthSessions:o,isGroupAssignment:T&&z,onAssign:R=>{S.mutate({assignment_type:m.type,session_id:R,scheduled_date:x,scheduled_slot:m.scheduledSlot??void 0,target_group_id:c,target_user_id:h})},onDelete:R=>{F.mutate(R)},onReplace:(R,$)=>{T&&z?S.mutate({assignment_type:m.type,session_id:$,scheduled_date:x,scheduled_slot:m.scheduledSlot??void 0,target_user_id:h}):F.mutate(R,{onSuccess:()=>{S.mutate({assignment_type:m.type,session_id:$,scheduled_date:x,scheduled_slot:m.scheduledSlot??void 0,target_group_id:c,target_user_id:h})}})},isPending:S.isPending||F.isPending},m.key)})})]})})]})}function As({slot:s,swimSessions:r,strengthSessions:j,isGroupAssignment:a,onAssign:o,onDelete:v,onReplace:b,isPending:n}){const[d,u]=i.useState(!1),p=s.type==="swim",c=p?(r??[]).map(t=>({id:t.id,label:t.name})):(j??[]).map(t=>({id:t.id,label:t.title})),h=s.assignment!==null,f=t=>{const x=Number(t);x&&(h&&d?(b(s.assignment.id,x),u(!1)):o(x))};return e.jsxs("div",{className:"rounded-xl border p-3 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[p?e.jsx(Ee,{className:"h-4 w-4 text-blue-500 shrink-0"}):e.jsx(Be,{className:"h-4 w-4 text-orange-500 shrink-0"}),e.jsx("span",{className:"text-xs font-semibold text-muted-foreground uppercase tracking-wide",children:s.label})]}),h&&!d?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("p",{className:"text-sm font-semibold truncate flex-1",children:[s.assignment.title,a&&e.jsx("span",{className:"ml-1.5 text-[10px] font-medium text-muted-foreground bg-muted px-1.5 py-0.5 rounded-full align-middle",children:"Groupe"})]}),e.jsx(_,{type:"button",size:"icon",variant:"ghost",className:"h-7 w-7 shrink-0",disabled:n,onClick:()=>u(!0),title:a?"Personnaliser":"Changer",children:e.jsx(Ze,{className:"h-3.5 w-3.5"})}),!a&&e.jsx(_,{type:"button",size:"icon",variant:"ghost",className:"h-7 w-7 shrink-0 text-destructive hover:text-destructive",disabled:n,onClick:()=>v(s.assignment.id),title:"Supprimer",children:e.jsx(He,{className:"h-3.5 w-3.5"})})]}):e.jsxs(re,{value:"",onValueChange:f,disabled:n||c.length===0,children:[e.jsx(ie,{className:"h-9 text-xs",children:e.jsx(le,{placeholder:d?a?"Personnaliser pour ce nageur":"Choisir le remplacement":"Choisir une séance"})}),e.jsx(oe,{children:c.map(t=>e.jsx(Q,{value:String(t.id),children:t.label},t.id))})]}),d?e.jsx("button",{type:"button",className:"text-xs text-muted-foreground hover:text-foreground",onClick:()=>u(!1),children:"Annuler"}):null]})}const Ye=({athletes:s,selected:r,onToggle:j,filterToUserIds:a})=>{const[o,v]=i.useState(""),b=i.useMemo(()=>{let d=s.filter(u=>u.id!=null);if(a&&(d=d.filter(u=>a.has(u.id))),o.trim()){const u=o.toLowerCase();d=d.filter(p=>p.display_name.toLowerCase().includes(u))}return d},[s,a,o]),n=i.useMemo(()=>{const d=new Map;for(const u of b){const p=u.group_label||"Sans groupe";d.has(p)||d.set(p,[]),d.get(p).push(u)}return[...d.entries()].sort(([u],[p])=>u.localeCompare(p,"fr"))},[b]);return e.jsxs("div",{className:"space-y-3",children:[e.jsx(Me,{placeholder:"Rechercher un nageur...",value:o,onChange:d=>v(d.target.value)}),e.jsxs("div",{className:"max-h-[50vh] overflow-y-auto space-y-3",children:[n.map(([d,u])=>e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-semibold uppercase tracking-wider text-muted-foreground mb-1.5",children:d}),e.jsx("div",{className:"space-y-1",children:u.map(p=>e.jsxs("label",{className:"flex items-center gap-2.5 rounded-lg border px-3 py-2 cursor-pointer hover:bg-muted/50 transition-colors",children:[e.jsx(os,{checked:r.has(p.id),onCheckedChange:()=>j(p.id)}),e.jsx("span",{className:"text-sm",children:p.display_name})]},p.id))})]},d)),n.length===0&&e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"Aucun nageur trouvé."})]}),r.size>0&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:[r.size," nageur",r.size>1?"s":""," ","sélectionné",r.size>1?"s":""]})]})},We=({open:s,onOpenChange:r,athletes:j,parentGroupId:a,parentMembers:o,onCreated:v})=>{const{toast:b}=W(),[n,d]=i.useState(""),[u,p]=i.useState(new Set),c=t=>{p(x=>{const A=new Set(x);return A.has(t)?A.delete(t):A.add(t),A})},h=K({mutationFn:()=>D.createTemporaryGroup({name:n.trim(),member_user_ids:[...u],parent_group_id:a??void 0}),onSuccess:()=>{b({title:"Groupe créé",description:`Le groupe "${n.trim()}" a été créé avec ${u.size} nageur${u.size>1?"s":""}.`}),d(""),p(new Set),r(!1),v()},onError:t=>{b({title:"Erreur",description:t.message,variant:"destructive"})}}),f=()=>{if(!n.trim()){b({title:"Nom requis",description:"Veuillez saisir un nom pour le groupe.",variant:"destructive"});return}h.mutate()};return e.jsx(De,{open:s,onOpenChange:r,children:e.jsxs(Ae,{side:"right",className:"w-full sm:max-w-md overflow-y-auto",children:[e.jsxs(ze,{children:[e.jsx(Fe,{children:a?"Créer un sous-groupe":"Créer un groupe"}),e.jsx(qe,{children:a?"Sélectionnez des nageurs du groupe parent pour ce sous-groupe.":"Créez un groupe temporaire (stage, compétition) avec des nageurs de différents groupes."})]}),e.jsxs("div",{className:"mt-6 space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(je,{htmlFor:"group-name",children:"Nom du groupe"}),e.jsx(Me,{id:"group-name",placeholder:"Ex : Stage Pâques 2026",value:n,onChange:t=>d(t.target.value)})]}),e.jsx(cs,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(je,{children:"Nageurs"}),e.jsx(Ye,{athletes:j,selected:u,onToggle:c,filterToUserIds:o??null})]}),e.jsx(_,{className:"w-full",onClick:f,disabled:h.isPending||!n.trim(),children:h.isPending?"Création...":"Créer le groupe"})]})]})})},zs=({open:s,onOpenChange:r,groupId:j,athletes:a,existingMemberIds:o,onAdded:v})=>{const{toast:b}=W(),[n,d]=i.useState(new Set),u=i.useMemo(()=>a.filter(h=>h.id!=null&&!o.has(h.id)),[a,o]),p=h=>{d(f=>{const t=new Set(f);return t.has(h)?t.delete(h):t.add(h),t})},c=K({mutationFn:()=>D.addTemporaryGroupMembers(j,[...n]),onSuccess:()=>{b({title:"Nageurs ajoutés",description:`${n.size} nageur${n.size>1?"s":""} ajouté${n.size>1?"s":""}.`}),d(new Set),r(!1),v()},onError:h=>{b({title:"Erreur",description:h.message,variant:"destructive"})}});return e.jsx(De,{open:s,onOpenChange:r,children:e.jsxs(Ae,{side:"right",className:"w-full sm:max-w-md overflow-y-auto",children:[e.jsxs(ze,{children:[e.jsx(Fe,{children:"Ajouter des nageurs"}),e.jsx(qe,{children:"Sélectionnez les nageurs à ajouter au groupe."})]}),e.jsxs("div",{className:"mt-6 space-y-4",children:[e.jsx(Ye,{athletes:u,selected:n,onToggle:p}),e.jsx(_,{className:"w-full",onClick:()=>c.mutate(),disabled:c.isPending||n.size===0,children:c.isPending?"Ajout...":`Ajouter ${n.size} nageur${n.size>1?"s":""}`})]})]})})},Fs=({groupId:s,athletes:r,onBack:j})=>{const{toast:a}=W(),o=ce(),[v,b]=i.useState(!1),[n,d]=i.useState(!1),[u,p]=i.useState(null),{data:c,isLoading:h}=I({queryKey:["temp-group-detail",s],queryFn:()=>D.getTemporaryGroupDetail(s)}),f=K({mutationFn:g=>D.removeTemporaryGroupMember(s,g),onSuccess:()=>{a({title:"Nageur retiré"}),o.invalidateQueries({queryKey:["temp-group-detail",s]}),o.invalidateQueries({queryKey:["temp-groups"]})},onError:g=>{a({title:"Erreur",description:g.message,variant:"destructive"})}}),t=()=>{o.invalidateQueries({queryKey:["temp-group-detail",s]}),o.invalidateQueries({queryKey:["temp-groups"]})},x=i.useMemo(()=>new Set((c?.members??[]).map(g=>g.user_id)),[c]),A=i.useMemo(()=>new Set((c?.members??[]).map(g=>g.user_id)),[c]);return h?e.jsxs("div",{className:"space-y-4",children:[e.jsxs(_,{variant:"ghost",size:"sm",className:"-ml-2",onClick:j,children:[e.jsx(ae,{className:"mr-2 h-4 w-4"}),"Retour aux groupes"]}),e.jsx("div",{className:"space-y-2",children:[1,2,3].map(g=>e.jsx("div",{className:"rounded-xl border p-3 animate-pulse motion-reduce:animate-none",children:e.jsx("div",{className:"h-4 w-32 rounded bg-muted"})},g))})]}):c?e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs(_,{variant:"ghost",size:"sm",className:"-ml-2",onClick:j,children:[e.jsx(ae,{className:"mr-2 h-4 w-4"}),"Retour aux groupes"]}),e.jsx("h2",{className:"text-2xl font-display font-semibold uppercase italic text-primary",children:c.name}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(se,{variant:c.is_active?"default":"secondary",children:c.is_active?"Actif":"Terminé"}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:[c.members.length," membre",c.members.length!==1?"s":""]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-xs font-semibold uppercase tracking-[0.15em] text-muted-foreground",children:"Membres"}),c.is_active&&e.jsxs(_,{size:"sm",variant:"outline",onClick:()=>b(!0),children:[e.jsx(ps,{className:"mr-1.5 h-3.5 w-3.5"}),"Ajouter"]})]}),c.members.length===0?e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"Aucun membre dans ce groupe."}):e.jsx("div",{className:"space-y-1.5",children:c.members.map(g=>e.jsxs("div",{className:"flex items-center gap-3 rounded-xl border bg-card p-3",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-sm font-semibold truncate",children:g.display_name}),g.permanent_group_label&&e.jsx(se,{variant:"secondary",className:"text-[10px] px-1.5 py-0 mt-0.5",children:g.permanent_group_label})]}),c.is_active&&e.jsx(_,{size:"icon",variant:"ghost",className:"h-8 w-8 text-muted-foreground hover:text-destructive",onClick:()=>p({userId:g.user_id,name:g.display_name}),title:"Retirer du groupe",children:e.jsx(xs,{className:"h-4 w-4"})})]},g.user_id))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-xs font-semibold uppercase tracking-[0.15em] text-muted-foreground",children:"Sous-groupes"}),c.is_active&&e.jsxs(_,{size:"sm",variant:"outline",onClick:()=>d(!0),children:[e.jsx(_e,{className:"mr-1.5 h-3.5 w-3.5"}),"Sous-groupe"]})]}),c.subgroups.length===0?e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"Aucun sous-groupe."}):e.jsx("div",{className:"space-y-2",children:c.subgroups.map(g=>e.jsxs(ds,{children:[e.jsxs(us,{className:"flex w-full items-center justify-between rounded-xl border bg-card p-3 text-left hover:bg-muted/50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ue,{className:"h-4 w-4 text-primary"}),e.jsx("span",{className:"text-sm font-semibold",children:g.name}),e.jsx(se,{variant:"secondary",className:"text-[10px] px-1.5 py-0",children:g.members.length})]}),e.jsx(hs,{className:"h-4 w-4 text-muted-foreground transition-transform [[data-state=open]_&]:rotate-180"})]}),e.jsx(ms,{children:e.jsxs("div",{className:"ml-4 mt-1 space-y-1",children:[g.members.map(N=>e.jsx("div",{className:"flex items-center gap-2 rounded-lg border px-3 py-2",children:e.jsx("span",{className:"text-sm",children:N.display_name})},N.user_id)),g.members.length===0&&e.jsx("p",{className:"text-xs text-muted-foreground py-2",children:"Aucun membre."})]})})]},g.id))})]}),e.jsx(zs,{open:v,onOpenChange:b,groupId:s,athletes:r,existingMemberIds:x,onAdded:t}),e.jsx(We,{open:n,onOpenChange:d,athletes:r,parentGroupId:s,parentMembers:A,onCreated:t}),e.jsx(fe,{open:!!u,onOpenChange:g=>{g||p(null)},children:e.jsxs(ye,{children:[e.jsxs(ve,{children:[e.jsx(be,{children:"Retirer du groupe"}),e.jsxs(Ne,{children:["Voulez-vous retirer ",u?.name," de ce groupe ?",c.subgroups.length>0?" Le nageur sera aussi retiré des sous-groupes.":""]})]}),e.jsxs(we,{children:[e.jsx(Se,{children:"Annuler"}),e.jsx(Ce,{onClick:()=>{u&&(f.mutate(u.userId),p(null))},className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Retirer"})]})]})})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs(_,{variant:"ghost",size:"sm",className:"-ml-2",onClick:j,children:[e.jsx(ae,{className:"mr-2 h-4 w-4"}),"Retour aux groupes"]}),e.jsx("p",{className:"text-sm text-muted-foreground text-center py-8",children:"Groupe introuvable."})]})},Ie=({group:s,onManage:r,onDeactivate:j,onReactivate:a,onDelete:o})=>{const v=new Date(s.created_at).toLocaleDateString("fr-FR",{day:"numeric",month:"short",year:"numeric"});return e.jsxs("div",{className:"rounded-xl border bg-card p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-sm font-bold truncate",children:s.name}),e.jsxs("div",{className:"flex items-center gap-2 mt-1 flex-wrap",children:[e.jsxs("span",{className:"text-xs text-muted-foreground",children:[s.member_count," membre",s.member_count!==1?"s":""]}),s.subgroup_count>0&&e.jsxs("span",{className:"text-xs text-muted-foreground",children:[s.subgroup_count," sous-groupe",s.subgroup_count!==1?"s":""]}),e.jsx("span",{className:"text-xs text-muted-foreground",children:v})]})]}),e.jsx(se,{variant:s.is_active?"default":"secondary",children:s.is_active?"Actif":"Terminé"})]}),e.jsx("div",{className:"flex items-center gap-2 flex-wrap",children:s.is_active?e.jsxs(e.Fragment,{children:[e.jsxs(_,{size:"sm",variant:"outline",onClick:()=>r(s.id),children:[e.jsx(es,{className:"mr-1.5 h-3.5 w-3.5"}),"Gérer"]}),e.jsxs(_,{size:"sm",variant:"outline",onClick:()=>j(s.id),children:[e.jsx(ls,{className:"mr-1.5 h-3.5 w-3.5"}),"Terminer"]})]}):e.jsxs(e.Fragment,{children:[e.jsxs(_,{size:"sm",variant:"outline",onClick:()=>a(s.id),children:[e.jsx(ss,{className:"mr-1.5 h-3.5 w-3.5"}),"Réactiver"]}),e.jsxs(_,{size:"sm",variant:"outline",className:"text-destructive hover:text-destructive",onClick:()=>o(s.id),children:[e.jsx(He,{className:"mr-1.5 h-3.5 w-3.5"}),"Supprimer"]})]})})]})},qs=({onBack:s,athletes:r,athletesLoading:j})=>{const{toast:a}=W(),o=ce(),[v,b]=i.useState("list"),[n,d]=i.useState(null),[u,p]=i.useState(!1),[c,h]=i.useState(null),[f,t]=i.useState(null),{data:x=[],isLoading:A}=I({queryKey:["temp-groups"],queryFn:()=>D.getTemporaryGroups()}),g=i.useMemo(()=>x.filter(y=>y.is_active),[x]),N=i.useMemo(()=>x.filter(y=>!y.is_active),[x]),E=K({mutationFn:y=>D.deactivateTemporaryGroup(y),onSuccess:()=>{a({title:"Groupe terminé"}),o.invalidateQueries({queryKey:["temp-groups"]})},onError:y=>{a({title:"Erreur",description:y.message,variant:"destructive"})}}),O=K({mutationFn:y=>D.reactivateTemporaryGroup(y),onSuccess:()=>{a({title:"Groupe réactivé"}),o.invalidateQueries({queryKey:["temp-groups"]})},onError:y=>{a({title:"Erreur",description:y.message,variant:"destructive"})}}),P=K({mutationFn:y=>D.deleteTemporaryGroup(y),onSuccess:()=>{a({title:"Groupe supprimé"}),o.invalidateQueries({queryKey:["temp-groups"]})},onError:y=>{a({title:"Erreur",description:y.message,variant:"destructive"})}}),G=y=>{d(y),b("detail")},V=()=>{d(null),b("list"),o.invalidateQueries({queryKey:["temp-groups"]})};return v==="detail"&&n!=null?e.jsx(Fs,{groupId:n,athletes:r,onBack:V}):e.jsxs("div",{className:"space-y-6 pb-24",children:[e.jsx(U,{title:"Groupes temporaires",description:"Créez et gérez des groupes pour les stages, compétitions ou événements.",onBack:s,actions:e.jsxs(_,{size:"sm",onClick:()=>p(!0),children:[e.jsx(_e,{className:"mr-1.5 h-3.5 w-3.5"}),"Créer un groupe"]})}),A||j?e.jsx("div",{className:"space-y-2",children:[1,2,3].map(y=>e.jsx("div",{className:"rounded-xl border p-4 animate-pulse motion-reduce:animate-none",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-4 w-40 rounded bg-muted"}),e.jsx("div",{className:"ml-auto h-6 w-16 rounded bg-muted"})]})},y))}):x.length===0?e.jsxs("div",{className:"text-center py-12 space-y-3",children:[e.jsx(ne,{className:"h-10 w-10 text-muted-foreground mx-auto"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Aucun groupe temporaire pour le moment."}),e.jsxs(_,{variant:"outline",size:"sm",onClick:()=>p(!0),children:[e.jsx(_e,{className:"mr-1.5 h-3.5 w-3.5"}),"Créer le premier groupe"]})]}):e.jsxs(e.Fragment,{children:[g.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h3",{className:"text-xs font-semibold uppercase tracking-[0.15em] text-muted-foreground",children:["Actifs (",g.length,")"]}),g.map(y=>e.jsx(Ie,{group:y,onManage:G,onDeactivate:l=>h(l),onReactivate:l=>O.mutate(l),onDelete:l=>t(l)},y.id))]}),N.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h3",{className:"text-xs font-semibold uppercase tracking-[0.15em] text-muted-foreground",children:["Terminés (",N.length,")"]}),N.map(y=>e.jsx(Ie,{group:y,onManage:G,onDeactivate:l=>h(l),onReactivate:l=>O.mutate(l),onDelete:l=>t(l)},y.id))]})]}),e.jsx(We,{open:u,onOpenChange:p,athletes:r,onCreated:()=>{o.invalidateQueries({queryKey:["temp-groups"]})}}),e.jsx(fe,{open:c!=null,onOpenChange:y=>{y||h(null)},children:e.jsxs(ye,{children:[e.jsxs(ve,{children:[e.jsx(be,{children:"Terminer le groupe"}),e.jsx(Ne,{children:"Voulez-vous marquer ce groupe comme terminé ? Les sous-groupes seront aussi désactivés. Vous pourrez le réactiver plus tard si nécessaire."})]}),e.jsxs(we,{children:[e.jsx(Se,{children:"Annuler"}),e.jsx(Ce,{onClick:()=>{c!=null&&(E.mutate(c),h(null))},children:"Terminer"})]})]})}),e.jsx(fe,{open:f!=null,onOpenChange:y=>{y||t(null)},children:e.jsxs(ye,{children:[e.jsxs(ve,{children:[e.jsx(be,{children:"Supprimer le groupe"}),e.jsx(Ne,{children:"Cette action est irréversible. Le groupe et tous ses sous-groupes seront supprimés définitivement."})]}),e.jsxs(we,{children:[e.jsx(Se,{children:"Annuler"}),e.jsx(Ce,{onClick:()=>{f!=null&&(P.mutate(f),t(null))},className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Supprimer"})]})]})})]})},Ts=i.lazy(()=>Ve(()=>import("./StrengthCatalog-DNVkk7rX.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31]))),$s=i.lazy(()=>Ve(()=>import("./SwimCatalog-V5CIU7wf.js"),__vite__mapDeps([32,1,2,3,4,5,6,18,19,9,11,21,16,33,34,12,35,23,15,24,17,25,26,14,10,8,13,29,36,28,37]))),Rs=({onNavigate:s,onOpenRecordsAdmin:r,onOpenRecordsClub:j,athletes:a,athletesLoading:o,upcomingBirthdays:v,birthdaysLoading:b,kpiLoading:n,kpiPeriod:d,onKpiPeriodChange:u,fatigueAlerts:p,mostLoadedAthlete:c,swimSessionCount:h,strengthSessionCount:f})=>{const t=new Date().getHours(),x=t<12?"Bonjour":t<18?"Bon après-midi":"Bonsoir",A=new Date().toLocaleDateString("fr-FR",{weekday:"long",day:"numeric",month:"long"}),g=p.length>0;return e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-display font-bold uppercase italic",children:[x,", ",e.jsx("span",{className:"text-primary",children:"Coach"})]}),e.jsx("p",{className:"text-sm text-muted-foreground capitalize",children:A})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h2",{className:"text-xs font-semibold uppercase tracking-[0.15em] text-muted-foreground",children:["Signaux · ",d,"j"]}),e.jsxs(Qe,{type:"single",size:"sm",variant:"outline",value:String(d),onValueChange:N=>{N&&u(Number(N))},children:[e.jsx(te,{value:"7",className:"h-7 px-2 text-xs","aria-label":"7 jours",children:"7j"}),e.jsx(te,{value:"30",className:"h-7 px-2 text-xs","aria-label":"30 jours",children:"30j"}),e.jsx(te,{value:"365",className:"h-7 px-2 text-xs","aria-label":"1 an",children:"1an"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:`rounded-xl border p-3 ${g?"border-destructive/30 bg-destructive/5":"bg-muted/30"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-[11px] text-muted-foreground",children:"Fatigue 5/5"}),e.jsx(bs,{className:`h-3.5 w-3.5 ${g?"text-destructive":"text-muted-foreground"}`})]}),e.jsx("p",{className:"text-xl font-bold tabular-nums",children:n?"–":p.length}),e.jsx("p",{className:"text-[11px] text-muted-foreground truncate",children:n?"Chargement…":g?p.slice(0,2).map(N=>N.athleteName.split(" ")[0]).join(", "):"Aucune alerte"})]}),e.jsxs("div",{className:"rounded-xl border bg-muted/30 p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-[11px] text-muted-foreground",children:"Plus chargé"}),e.jsx(ne,{className:"h-3.5 w-3.5 text-muted-foreground"})]}),e.jsx("p",{className:"text-xl font-bold truncate",children:n?"–":c?.athleteName?.split(" ")[0]??"–"}),e.jsx("p",{className:"text-[11px] text-muted-foreground",children:n?"Calcul…":c?`Charge ${Math.round(c.loadScore)}`:"Pas de données"})]})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs("button",{type:"button",onClick:()=>s("calendar"),className:"flex items-center gap-1.5 rounded-full bg-primary text-primary-foreground px-3.5 py-2 text-sm font-semibold active:opacity-80 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",children:[e.jsx(ke,{className:"h-3.5 w-3.5"}),"Assigner"]}),e.jsxs("button",{type:"button",onClick:()=>s("messaging"),className:"flex items-center gap-1.5 rounded-full border px-3.5 py-2 text-sm font-semibold active:bg-muted focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",children:[e.jsx(Te,{className:"h-3.5 w-3.5"}),"Email"]}),e.jsxs("button",{type:"button",onClick:()=>s("groups"),className:"flex items-center gap-1.5 rounded-full border px-3.5 py-2 text-sm font-semibold active:bg-muted focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",children:[e.jsx(Ue,{className:"h-3.5 w-3.5"}),"Groupes"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("button",{type:"button",onClick:()=>s("swim"),className:"rounded-xl border bg-card p-4 text-left shadow-sm active:bg-muted/50 transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",children:[e.jsx(Ee,{className:"h-5 w-5 text-primary mb-2"}),e.jsx("p",{className:"text-sm font-bold",children:"Natation"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:h!=null?`${h} séance${h!==1?"s":""}`:"Bibliothèque"})]}),e.jsxs("button",{type:"button",onClick:()=>s("strength"),className:"rounded-xl border bg-card p-4 text-left shadow-sm active:bg-muted/50 transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",children:[e.jsx(Be,{className:"h-5 w-5 text-primary mb-2"}),e.jsx("p",{className:"text-sm font-bold",children:"Musculation"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:f!=null?`${f} séance${f!==1?"s":""}`:"Bibliothèque"})]}),e.jsxs("button",{type:"button",onClick:()=>s("swimmers"),className:"rounded-xl border bg-card p-4 text-left shadow-sm active:bg-muted/50 transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",children:[e.jsx(ne,{className:"h-5 w-5 text-primary mb-2"}),e.jsx("p",{className:"text-sm font-bold",children:"Nageurs"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:o?"Chargement…":`${a.length} nageur${a.length!==1?"s":""}`})]}),e.jsxs("button",{type:"button",onClick:r,className:"rounded-xl border bg-card p-4 text-left shadow-sm active:bg-muted/50 transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",children:[e.jsx(ns,{className:"h-5 w-5 text-primary mb-2"}),e.jsx("p",{className:"text-sm font-bold",children:"Records club"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Import & administration"})]})]}),e.jsx("button",{type:"button",onClick:j,className:"w-full text-center text-sm text-primary font-semibold py-1 active:opacity-70 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring rounded",children:"Voir les records du club"}),!b&&v&&v.length>0?e.jsxs("div",{className:"space-y-2",children:[e.jsx("h2",{className:"text-xs font-semibold uppercase tracking-[0.15em] text-muted-foreground",children:"Anniversaires"}),e.jsx("div",{className:"space-y-1.5",children:v.slice(0,3).map(N=>e.jsxs("div",{className:"flex items-center justify-between gap-2 rounded-lg border px-3 py-2",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("span",{className:"text-sm font-medium truncate block",children:N.display_name}),e.jsx("span",{className:"text-[11px] text-muted-foreground",children:Ls(N.next_birthday)})]}),e.jsxs("span",{className:"text-xs font-bold text-primary shrink-0",children:["J-",N.days_until]})]},N.id))})]}):null]})},Ls=s=>{if(!s)return"-";const r=new Date(s);return Number.isNaN(r.getTime())?s:r.toLocaleDateString("fr-FR")},Ke=s=>s.toISOString().split("T")[0],Os=s=>new Date(s.completed_at||s.started_at||s.date||s.created_at||0).getTime(),Ps=s=>{if(!s.length)return null;const r=s.reduce((a,o)=>a+o,0)/s.length,j=Math.min(5,Math.max(1,Math.round(r/10*5)));return{average:r,rating:j}};function ut(){const s=Le(l=>l.role),r=Le(l=>l.setSelectedAthlete),[,j]=ts(),[a,o]=i.useState("home"),[v,b]=i.useState(7),n=s==="coach"||s==="admin",d=a==="home"||a==="calendar",u=a==="home"||a==="messaging"||a==="swimmers"||a==="calendar"||a==="groups",p=a==="messaging"||a==="calendar"||a==="groups",c=a==="home"||a==="swimmers",{data:h}=I({queryKey:["swim_catalog"],queryFn:()=>D.getSwimCatalog(),enabled:n&&d}),{data:f}=I({queryKey:["strength_catalog"],queryFn:()=>D.getStrengthSessions(),enabled:n&&d}),{data:t=[],isLoading:x}=I({queryKey:["athletes"],queryFn:()=>D.getAthletes(),enabled:n&&u}),A=i.useMemo(()=>t.slice(0,5),[t]),{data:g=[]}=I({queryKey:["groups"],queryFn:()=>D.getGroups(),enabled:n&&p}),N=I({queryKey:["upcoming-birthdays"],queryFn:()=>D.getUpcomingBirthdays({days:30}),enabled:n&&c}),E=N.data,O=I({queryKey:["coach-kpis",v,A.map(l=>l.id??l.display_name)],enabled:n&&a==="home"&&A.length>0,queryFn:async()=>{const l=v,L=new Date;L.setDate(L.getDate()-l);const J=Ke(L),X=Ke(new Date),w=await Promise.all(A.map(async S=>{const[F,q]=await Promise.all([D.getSessions(S.display_name,S.id),D.getStrengthHistory(S.display_name,{athleteId:S.id,limit:50,from:J,to:X})]),m=F.filter(M=>new Date(M.date).getTime()>=L.getTime()),T=m.map(M=>M.fatigue??M.feeling).filter(M=>Number.isFinite(M)),z=m.reduce((M,B)=>M+(Number(B.duration)||0)*(Number(B.effort)||0),0),$=(q?.runs??[]).filter(M=>Os(M)>=L.getTime()),Z=$.map(M=>M.fatigue??M.feeling??M.rpe).filter(M=>Number.isFinite(Number(M))).map(M=>Number(M)),ee=$.reduce((M,B)=>{const $e=Number(B.feeling??B.rpe??0),Re=Number(B.duration??0);if(Re>0&&$e>0)return M+Re*$e;const Xe=Array.isArray(B.logs)?B.logs.length:0;return M+Xe*5},0),Je=Ps([...T,...Z]);return{athleteName:S.display_name,loadScore:z+ee,fatigueRating:Je}})),k=w.filter(S=>S.fatigueRating?.rating===5).map(S=>({athleteName:S.athleteName,rating:S.fatigueRating?.rating??0})),C=w.filter(S=>S.loadScore>0).sort((S,F)=>F.loadScore-S.loadScore)[0];return{fatigueAlerts:k,mostLoadedAthlete:C??null}}}),P=l=>{r({id:l.id??null,name:l.display_name}),j("/progress")},{toast:G}=W(),V=ce(),y=K({mutationFn:async l=>{const L=await D.importSingleSwimmer(l.iuf,l.name);return await D.recalculateClubRecords(),L},onSuccess:l=>{G({title:"Import terminé",description:`${l.total_found} trouvées, ${l.new_imported} nouvelles.`}),V.invalidateQueries({queryKey:["club-records"]})},onError:l=>{G({title:"Erreur import",description:l.message,variant:"destructive"})}});return n?e.jsxs("div",{className:"space-y-6",children:[a==="home"?e.jsx(Rs,{onNavigate:o,onOpenRecordsAdmin:()=>j("/records-admin"),onOpenRecordsClub:()=>j("/records-club"),athletes:t,athletesLoading:x,upcomingBirthdays:E,birthdaysLoading:N.isLoading,kpiLoading:O.isLoading,kpiPeriod:v,onKpiPeriodChange:b,fatigueAlerts:O.data?.fatigueAlerts??[],mostLoadedAthlete:O.data?.mostLoadedAthlete??null,swimSessionCount:h?.length,strengthSessionCount:f?.length}):null,a==="swim"?e.jsxs("div",{className:"space-y-6",children:[e.jsx(U,{title:"Bibliothèque natation",description:"Accédez aux séances et aux templates natation.",onBack:()=>o("home"),actions:e.jsxs(_,{variant:"outline",size:"sm",onClick:()=>o("calendar"),children:[e.jsx(ke,{className:"mr-1.5 h-3.5 w-3.5"}),"Assigner"]})}),e.jsx(i.Suspense,{fallback:e.jsx(Oe,{}),children:e.jsx($s,{})})]}):null,a==="strength"?e.jsxs("div",{className:"space-y-6",children:[e.jsx(U,{title:"Bibliothèque musculation",description:"Consultez et créez des séances musculation.",onBack:()=>o("home"),actions:e.jsxs(_,{variant:"outline",size:"sm",onClick:()=>o("calendar"),children:[e.jsx(ke,{className:"mr-1.5 h-3.5 w-3.5"}),"Assigner"]})}),e.jsx(i.Suspense,{fallback:e.jsx(Oe,{}),children:e.jsx(Ts,{})})]}):null,a==="swimmers"?e.jsxs("div",{className:"space-y-4",children:[e.jsx(U,{title:"Nageurs",description:x?"Chargement…":`${t.length} nageur${t.length!==1?"s":""} inscrit${t.length!==1?"s":""}`,onBack:()=>o("home"),actions:e.jsxs(_,{variant:"outline",size:"sm",onClick:()=>o("messaging"),children:[e.jsx(Te,{className:"mr-1.5 h-3.5 w-3.5"}),"Email"]})}),x?e.jsx("div",{className:"space-y-2",children:[1,2,3,4,5].map(l=>e.jsx("div",{className:"rounded-xl border p-3 animate-pulse motion-reduce:animate-none",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-4 w-32 rounded bg-muted"}),e.jsx("div",{className:"ml-auto h-8 w-16 rounded bg-muted"})]})},l))}):t.length?e.jsx("div",{className:"space-y-2",children:t.map(l=>e.jsxs("div",{className:"flex items-center gap-3 rounded-xl border bg-card p-3",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-sm font-semibold truncate",children:l.display_name}),e.jsxs("div",{className:"flex items-center gap-2 mt-0.5",children:[l.group_label?e.jsx(se,{variant:"secondary",className:"text-[10px] px-1.5 py-0",children:l.group_label}):null,l.ffn_iuf?e.jsx("span",{className:"text-[10px] font-mono text-muted-foreground",children:l.ffn_iuf}):null]})]}),e.jsxs("div",{className:"flex items-center gap-1 shrink-0",children:[l.ffn_iuf?e.jsx(_,{size:"icon",variant:"ghost",className:"h-8 w-8",disabled:y.isPending,onClick:()=>y.mutate({iuf:l.ffn_iuf,name:l.display_name}),title:"Importer performances FFN",children:e.jsx(as,{className:"h-4 w-4"})}):null,e.jsx(_,{size:"sm",variant:"outline",onClick:()=>P(l),children:"Fiche"})]})]},l.id??l.display_name))}):e.jsx("p",{className:"text-sm text-muted-foreground text-center py-8",children:"Aucun nageur disponible."})]}):null,a==="messaging"?e.jsx(Ss,{onBack:()=>o("home"),athletes:t,groups:g,athletesLoading:x}):null,a==="calendar"?e.jsx(Ds,{onBack:()=>o("home"),athletes:t,groups:g,swimSessions:h,strengthSessions:f}):null,a==="groups"?e.jsx(qs,{onBack:()=>o("home"),athletes:t,groups:g,athletesLoading:x}):null]}):e.jsx("div",{className:"flex items-center justify-center min-h-[60vh] animate-in fade-in motion-reduce:animate-none",children:e.jsxs(me,{className:"w-full max-w-sm shadow-xl border-t-4 border-t-primary",children:[e.jsxs(pe,{children:[e.jsxs(xe,{className:"flex items-center gap-2 uppercase italic",children:[e.jsx(ne,{className:"h-5 w-5 text-primary"}),"Accès Coach"]}),e.jsx(he,{children:"Cette section est réservée aux coachs et administrateurs."})]}),e.jsx(ge,{children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"Connectez-vous avec un compte autorisé pour accéder aux outils de gestion."})})]})})}export{ut as default};
