import{r as a,j as e,c as kt,u as ve,d as ye,R as _e}from"./vendor-query-DyA9aSKS.js";import{c as Ee,b as St,W as Mt,X as Dt,F as At,P as Be,u as rt,d as zt,s as Ue,B as Ct,T as it}from"./index-BEFtN8Ff.js";import{c as Ht}from"./date-DrpgLmFD.js";import{a as H}from"./api-CSvc7NK_.js";import{D as Jt,a as Ut,b as Vt,c as Yt}from"./dialog-Blv_Pizw.js";import{M as Wt,C as Xt,a as Gt}from"./CalendarGrid-Cg0jebwR.js";import{B as Zt}from"./BottomActionBar-Cq_nCKTs.js";import{A as es,a as ts,b as ss,c as ns,d as rs,e as is,f as os,g as as}from"./alert-dialog-CWhdMWQf.js";import{a as ls,s as cs,l as ot}from"./animations-CrcLFysI.js";import{d as Ve}from"./design-tokens-CKgCpdH6.js";import{C as _t}from"./chevron-right-B9_58TE1.js";import{A as Ce,m as le}from"./vendor-motion-CMsaQ8FX.js";import{P as ds}from"./power-CkxC3oo4.js";import{C as at}from"./chevron-down-BFSZSmkk.js";import{C as st}from"./index-BcUNFVtN.js";import{C as Ye}from"./circle-DNbmWxnA.js";import{T as $e}from"./trash-2-BD52lqhR.js";import{A as lt,S as us,H as ct,f as We,p as ms}from"./SwimTimeInput-BlWPPZ1M.js";import{T as dt}from"./timer-DemyM3t7.js";import{P as xs}from"./pencil-qApqpwaq.js";import{I as ps}from"./InlineBanner-D5VxR4_d.js";import{C as fs}from"./circle-alert-6c47PJ6y.js";import"./vendor-react-BzrpNAyj.js";import"./vendor-charts-BrQ8X25f.js";import"./vendor-supabase-DFPLkPj_.js";import"./vendor-date-B8Mnp-Vt.js";import"./swim-BtCWSpXS.js";import"./index-go-LxjxV.js";import"./chevron-left-vupj7URZ.js";import"./loader-circle-CsOm8Dj4.js";import"./circle-check-CtEig4dg.js";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bs=[["path",{d:"M5 12h14",key:"1ays0h"}]],Ft=Ee("minus",bs);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gs=[["path",{d:"M14 17H5",key:"gfn3mx"}],["path",{d:"M19 7h-9",key:"6i9tg"}],["circle",{cx:"17",cy:"17",r:"3",key:"18b49y"}],["circle",{cx:"7",cy:"7",r:"3",key:"dfmy0x"}]],hs=Ee("settings-2",gs);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ys=[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]],Ns=Ee("sun",ys);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const js=[["path",{d:"m16 11 2 2 4-4",key:"9rsbq5"}],["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],ut=Ee("user-check",js);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vs=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]],Le=Ee("user-x",vs),Xe={NL:"",DOS:"",BR:"",PAP:"",QN:""};function mt(t){return String(t).padStart(2,"0")}function xt(t){return`${t.getFullYear()}-${mt(t.getMonth()+1)}-${mt(t.getDate())}`}function pt(t){return new Date(t.getFullYear(),t.getMonth(),1)}function ft(t,n){const i=new Date(t);return i.setDate(i.getDate()+n),i}function Ge(t){return(t.getDay()+6)%7}function Fe(t){const n=Number(t);return Number.isFinite(n)?Math.round(n/1e3*100)/100:0}function ws(t){const n=Number(t);return Number.isFinite(n)?Math.round(n*1e3):0}function ks(t){return t?String(t).replaceAll(`\r
`,`
`).split(`
`).map(i=>i.trim()).filter(Boolean).flatMap(i=>{const r=i.replace(/^[•\\-–—]\\s*/,"").trim();return r?[r]:[]}):[]}function Ss(t){if(!t)return null;const i=String(t).match(/(\\d+(?:[\\.,]\\d+)?)\\s*(km|m)\\b/i);if(!i)return null;const r=Number(String(i[1]).replace(",","."));return Number.isFinite(r)?i[2].toLowerCase()==="m"?Fe(r):r:null}function Ms(t,n){const i=t?.slot??t?.session_slot??t?.assigned_slot??t?.time_slot??t?.timeOfDay??t?.slot_key??t?.slotKey,r=String(i||"").toLowerCase();if(r.includes("mat")||r.includes("morning")||r==="am")return"AM";if(r.includes("soir")||r.includes("evening")||r==="pm")return"PM";const f=`${t?.title??""} ${t?.description??""}`.toLowerCase();return f.includes("matin")||f.includes(" am ")||f.includes("(am)")?"AM":f.includes("soir")||f.includes(" pm ")||f.includes("(pm)")?"PM":n===0?"AM":"PM"}function Ds(t){const n=t?.assigned_date??t?.date??t?.day??t?.scheduled_for??t?.scheduledAt??null;if(!n)return null;const i=String(n),r=i.length>=10?i.slice(0,10):i;return/\d{4}-\d{2}-\d{2}/.test(r)?r:null}function As(t){if(Array.isArray(t?.items)){let f=0;for(const N of t.items){const x=Number(N?.distance);if(!Number.isFinite(x)||x<=0)continue;const p=N?.raw_payload,k=Number(p?.exercise_repetitions),y=Number(p?.block_repetitions),w=Number.isFinite(k)&&k>0?k:1,D=Number.isFinite(y)&&y>0?y:1;f+=x*w*D}if(f>0)return Fe(f)}const n=t?.distance_meters??t?.distanceMeters??t?.meters??t?.planned_meters??t?.plannedMeters??t?.distance??null;if(n!=null&&Number.isFinite(Number(n))){const f=Number(n);return f>0&&f<=50?f:Fe(f)}const i=t?.km??t?.distance_km??t?.distanceKm??t?.planned_km??t?.plannedKm??null;if(i!=null&&Number.isFinite(Number(i)))return Number(i);const r=Ss(`${t?.title??""} ${t?.description??""}`);return r??null}function Cs(t){if(!Array.isArray(t)||t.length===0)return null;const n={crawl:"NL",dos:"DOS",brasse:"BR",pap:"PAP","4n":"QN"},i={NL:0,DOS:0,BR:0,PAP:0,QN:0};for(const f of t){const N=Number(f?.distance);if(!Number.isFinite(N)||N<=0)continue;const x=f?.raw_payload,p=Number(x?.exercise_repetitions),k=Number(x?.block_repetitions),y=Number.isFinite(p)&&p>0?p:1,w=Number.isFinite(k)&&k>0?k:1,D=N*y*w,R=x?.exercise_stroke??x?.stroke??"crawl",I=n[String(R).toLowerCase()];I?i[I]+=D:i.NL+=D}return Object.values(i).some(f=>f>0)?i:null}function bt(t){const n=Number(t);if(!Number.isFinite(n))return"—";const i=Math.round(n*100)/100,r=String(i);return r.endsWith(".0")?r.slice(0,-2):r}function _s(){const t={};for(let n=0;n<7;n++)t[n]={AM:!0,PM:!0};return t}function Ze(t){if(!t)return null;try{return JSON.parse(t)}catch{return null}}function Fs({sessions:t,assignments:n,userId:i,user:r}){const f=`swim-dashboard-v2:${i??r??"anon"}`,N=`${f}:presenceDefaults`,x=`${f}:attendanceOverrides`,p=`${f}:stableFields`,[k,y]=a.useState(()=>_s()),[w,D]=a.useState({}),[R,I]=a.useState(90);a.useEffect(()=>{if(typeof window>"u")return;const l=Ze(window.localStorage.getItem(N));l&&y(l);const c=Ze(window.localStorage.getItem(x));c&&D(c);const u=Ze(window.localStorage.getItem(p));u?.duration&&Number.isFinite(u.duration)&&u.duration>=30&&u.duration<=240&&I(u.duration)},[N,x,p]),a.useEffect(()=>{typeof window>"u"||window.localStorage.setItem(N,JSON.stringify(k))},[k,N]),a.useEffect(()=>{typeof window>"u"||window.localStorage.setItem(x,JSON.stringify(w))},[w,x]),a.useEffect(()=>{typeof window>"u"||window.localStorage.setItem(p,JSON.stringify({duration:R}))},[R,p]);const me=a.useMemo(()=>new Date,[]),[Z,ce]=a.useState(()=>pt(new Date)),[V,xe]=a.useState(()=>xt(new Date)),[ee,d]=a.useState(!1),[b,A]=a.useState(!1),[M,q]=a.useState(!1),[Q,de]=a.useState(null),[ie,oe]=a.useState(!1),[Ne,pe]=a.useState(null),[fe,be]=a.useState(!1),[ge,_]=a.useTransition(),L=a.useMemo(()=>(Array.isArray(n)?n:[]).filter(c=>c?.session_type==="swim"),[n]),T=a.useMemo(()=>{const l=new Map;for(const c of L){const u=Ds(c);u&&(l.has(u)||l.set(u,[]),l.get(u).push(c))}for(const[c,u]of l.entries())u.sort((v,g)=>Number(v?.id??0)-Number(g?.id??0)),l.set(c,u);return l},[L]),P=a.useMemo(()=>{const l=Array.isArray(t)?t:[],c={};for(const u of l){const v=String(u?.date??"").slice(0,10),g=u?.slot==="Soir"?"PM":"AM";c[`${v}__${g}`]=u}return c},[t]),S=a.useRef(new Map);a.useEffect(()=>{S.current.clear()},[T]);const O=a.useCallback(l=>{const c=S.current;if(c.has(l))return c.get(l);const u=[{id:`${l}__AM`,iso:l,slotKey:"AM",title:"Séance vide",km:null,details:[],isEmpty:!0},{id:`${l}__PM`,iso:l,slotKey:"PM",title:"Séance vide",km:null,details:[],isEmpty:!0}],v=(T.get(l)??[]).slice().sort((h,U)=>(Number(U.id)||0)-(Number(h.id)||0)),g=new Set;return v.forEach((h,U)=>{const W=h,B=Ms(W,U);if(g.has(B))return;const he=B==="AM"?0:1,ke=As(W),je=Array.isArray(W?.details)?W.details.map(String):ks(h?.description);u[he]={id:`${l}__${B}`,iso:l,slotKey:B,title:String(h?.title??"Séance coach"),km:ke,details:je,assignmentId:typeof h?.id=="number"?h.id:Number(h?.id)||void 0,isEmpty:!1},g.add(B)}),c.set(l,u),u},[T]),z=a.useCallback((l,c)=>{const u=Ge(c),v=!!k?.[u]?.[l.slotKey],g=w[l.id];return g==="present"?{status:"present",expected:!0,expectedByDefault:v}:g==="absent"?{status:"absent",expected:!0,expectedByDefault:v}:v?{status:"present",expected:!0,expectedByDefault:v}:{status:"not_expected",expected:!1,expectedByDefault:v}},[w,k]),te=a.useMemo(()=>pt(Z),[Z]),Y=a.useMemo(()=>{const l=Ge(te),c=ft(te,-l),u=[];for(let v=0;v<42;v++)u.push(ft(c,v));return u},[te]),C=a.useMemo(()=>{const l={};for(const c of Y){const u=xt(c),v=O(u);let g=0,h=0;const U=[];for(const W of v){const B=z(W,c);if(!B.expected){U.push({slotKey:W.slotKey,expected:!1,completed:!1,absent:!1});continue}g+=1;const he=!!P[W.id],ke=B.status==="absent";he&&(h+=1),U.push({slotKey:W.slotKey,expected:!0,completed:he,absent:ke})}l[u]={completed:h,total:g,slots:U}}return l},[Y,O,z,P]),F=a.useMemo(()=>{const[l,c,u]=V.split("-").map(Number);return new Date(l,c-1,u)},[V]),$=a.useMemo(()=>O(V),[O,V]),J=C[V]||{completed:0,total:2,slots:[{slotKey:"AM",expected:!0,completed:!1,absent:!1},{slotKey:"PM",expected:!0,completed:!1,absent:!1}]},se=a.useMemo(()=>{const l=Array.isArray(t)?t:[];let c=0;for(const u of l){const v=String(u?.date??"").slice(0,10),g=u?.slot==="Soir"?"PM":"AM",h=`${v}__${g}`;if(w[h]==="absent")continue;const U=Ge(new Date(v));(k?.[U]?.[g]||w[h]==="present")&&Number.isFinite(Number(u?.distance))&&(c+=Number(u.distance))}return bt(Fe(c))},[t,w,k]),ue=a.useMemo(()=>{const l=$;let c=0;for(const u of l){const v=z(u,F);if(!v.expected||v.status==="absent")continue;const g=P[u.id];g&&Number.isFinite(Number(g?.distance))&&(c+=Number(g.distance))}return bt(Fe(c))},[$,z,F,P]),we=a.useMemo(()=>Q&&P[Q]||null,[Q,P]),ne=a.useMemo(()=>{const l=we||{},c=l?.stroke_distances,u=c?{NL:c.NL?String(c.NL):"",DOS:c.DOS?String(c.DOS):"",BR:c.BR?String(c.BR):"",PAP:c.PAP?String(c.PAP):"",QN:c.QN?String(c.QN):""}:Xe;return{difficulty:l?.effort??null,fatigue_end:l?.fatigue??l?.feeling??null,performance:l?.performance??l?.feeling??null,engagement:l?.engagement??l?.feeling??null,comment:String(l?.comments??""),distanceMeters:Number.isFinite(Number(l?.distance))?Number(l.distance):null,showStrokeDetail:!!(c&&Object.values(c).some(v=>v&&v>0)),strokes:u,exerciseLogs:[]}},[we]),[Re,G]=a.useState(()=>({difficulty:null,fatigue_end:null,performance:null,engagement:null,comment:"",distanceMeters:null,showStrokeDetail:!1,strokes:Xe,exerciseLogs:[]}));return a.useEffect(()=>{const l=$.find(c=>c.id===Q);if(l){const c=l.km!=null?ws(l.km):5e3;let u=Xe;if(l.assignmentId){const g=(n??[]).find(h=>h.id===l.assignmentId);if(g?.items){const h=Cs(g.items);h&&(u={NL:String(h.NL||""),DOS:String(h.DOS||""),BR:String(h.BR||""),PAP:String(h.PAP||""),QN:String(h.QN||"")})}}const v=Object.values(ne.strokes).some(g=>g&&Number(g)>0);G(g=>({...g,...ne,distanceMeters:ne.distanceMeters==null?c:ne.distanceMeters,strokes:v?ne.strokes:u,showStrokeDetail:v||Object.values(u).some(h=>h&&Number(h)>0)}));return}G(c=>({...c,...ne}))},[ne,Q,$,n]),a.useEffect(()=>{const l=()=>{d(!1),A(!1),q(!1),de(null),oe(!1),pe(null)};return window.addEventListener("nav:reset",l),()=>window.removeEventListener("nav:reset",l)},[]),a.useEffect(()=>{ee&&fe&&J.total>0&&J.completed>=J.total&&(d(!1),de(null),oe(!1),be(!1))},[ee,fe,J.completed,J.total]),{today:me,monthCursor:Z,selectedISO:V,drawerOpen:ee,settingsOpen:b,infoOpen:M,activeSessionId:Q,detailsOpen:ie,selectedDayIndex:Ne,isPending:ge,presenceDefaults:k,attendanceOverrideBySessionId:w,stableDurationMin:R,draftState:Re,gridDates:Y,completionByISO:C,selectedDate:F,sessionsForSelectedDay:$,selectedDayStatus:J,globalKm:se,dayKm:ue,logsBySessionId:P,setMonthCursor:ce,setSelectedISO:xe,setDrawerOpen:d,setSettingsOpen:A,setInfoOpen:q,setActiveSessionId:de,setDetailsOpen:oe,setSelectedDayIndex:pe,setPresenceDefaults:y,setAttendanceOverrideBySessionId:D,setStableDurationMin:I,setDraftState:G,setAutoCloseArmed:be,startTransition:_,getSessionStatus:z,getSessionsForISO:O}}function et(...t){return t.filter(Boolean).join(" ")}const gt={NL:"NL",DOS:"Dos",BR:"Brasse",PAP:"Pap",QN:"4N"};function Es({strokes:t,showStrokeDetail:n,disabled:i=!1,onToggle:r,onChange:f}){return e.jsxs("div",{className:"mt-3",children:[e.jsxs("button",{type:"button",disabled:i,onClick:r,className:et("flex w-full items-center justify-between rounded-2xl border px-3 py-2 text-sm font-semibold transition",i?"text-muted-foreground border-border cursor-not-allowed":"text-foreground border-border hover:bg-muted"),children:[e.jsx("span",{children:"Détail par nage"}),e.jsx(_t,{className:et("h-4 w-4 transition-transform",n&&"rotate-90")})]}),n&&e.jsx("div",{className:"mt-2 grid grid-cols-5 gap-2",children:Object.keys(gt).map(N=>e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"block text-center text-xs font-medium text-muted-foreground",children:gt[N]}),e.jsx("input",{type:"number",inputMode:"numeric",min:0,step:100,disabled:i,value:t[N],onChange:x=>f({...t,[N]:x.target.value}),placeholder:"0",className:et("w-full rounded-xl border px-1 py-2 text-center text-sm outline-none",i?"bg-muted text-muted-foreground":"bg-card text-foreground border-border focus:ring-2 focus:ring-foreground/10")}),e.jsx("div",{className:"text-center text-[10px] text-muted-foreground",children:"m"})]},N))})]})}function K(...t){return t.filter(Boolean).join(" ")}function Os(t){return t.toLocaleDateString("fr-FR",{weekday:"long",day:"numeric",month:"long",year:"numeric"})}function qe(t){const n=Number(t);if(!Number.isFinite(n))return"—";const i=Math.round(n*100)/100,r=String(i);return r.endsWith(".0")?r.slice(0,-2):r}function ht(t){const n=Number(t);return Number.isFinite(n)?Math.round(n/1e3*100)/100:0}function Is(t){const n=Number(t);return Number.isFinite(n)?Math.round(n*1e3):0}const tt=[{key:"difficulty",label:"Difficulté",mode:"hard"},{key:"fatigue_end",label:"Fatigue fin",mode:"hard"},{key:"performance",label:"Perf perçue",mode:"good"},{key:"engagement",label:"Engagement",mode:"good"}],Ls=[{key:"AM",label:"Matin",Icon:Ns},{key:"PM",label:"Soir",Icon:Wt}];function Pe({children:t}){return e.jsx("span",{className:"inline-flex items-center rounded-full bg-muted px-2 py-0.5 text-xs font-semibold text-muted-foreground",children:t})}function Ke({onClick:t,label:n,children:i,tone:r="neutral",disabled:f}){const N={neutral:"bg-background border-border text-foreground hover:bg-muted",dark:"bg-foreground border-foreground text-background hover:opacity-90",sky:"bg-primary/10 border-primary/30 text-primary hover:bg-primary/20"};return e.jsxs("button",{type:"button",onClick:t,disabled:f,className:K("inline-flex items-center justify-center rounded-2xl border p-2 transition",N[r],f&&"opacity-50 cursor-not-allowed hover:bg-background"),"aria-label":n,title:n,children:[i,e.jsx("span",{className:"sr-only",children:n})]})}function Ps(t,n){const i=Number(n);return!Number.isFinite(i)||i<1||i>5?"neutral":t==="hard"?{1:"bg-intensity-1 border-intensity-1 text-white",2:"bg-intensity-2 border-intensity-2 text-white",3:"bg-intensity-3 border-intensity-3 text-white",4:"bg-intensity-4 border-intensity-4 text-white",5:"bg-intensity-5 border-intensity-5 text-white"}[i]:{1:"bg-intensity-5 border-intensity-5 text-white",2:"bg-intensity-4 border-intensity-4 text-white",3:"bg-intensity-3 border-intensity-3 text-white",4:"bg-intensity-2 border-intensity-2 text-white",5:"bg-intensity-1 border-intensity-1 text-white"}[i]}function Ks({plannedMeters:t,valueMeters:n,onChange:i,disabled:r}){const p=Number.isFinite(Number(n))?Number(n):t,k=p-t,[y,w]=a.useState(!1),[D,R]=a.useState("");return e.jsxs("div",{className:K("mt-4 rounded-3xl border px-4 py-3",r?"bg-muted border-border":"bg-card border-border"),children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:K("text-xs font-semibold",r?"text-muted-foreground":"text-foreground"),children:"Ajuster kilométrage"}),k!==0&&e.jsx("div",{className:K("text-xs font-semibold px-2 py-0.5 rounded-full",k>0?"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400":"bg-orange-100 text-orange-800 dark:bg-orange-900/30 dark:text-orange-400"),children:k>0?`+${k}m`:`${k}m`})]}),e.jsx("div",{className:"text-center mb-3",children:e.jsxs("div",{className:K("text-xs","text-muted-foreground"),children:["Planifié : ",t,"m (",qe(ht(t))," km)"]})}),e.jsxs("div",{className:"flex items-center justify-center gap-3",children:[e.jsx("button",{type:"button",disabled:r||p-100<0,onClick:()=>i(p-100),className:K("h-11 w-11 rounded-2xl border flex items-center justify-center transition-colors",r?"bg-muted border-border text-muted-foreground cursor-not-allowed":"bg-card border-border text-foreground hover:bg-muted active:scale-95"),"aria-label":"-100m",children:e.jsx(Ft,{className:"h-5 w-5"})}),e.jsx("div",{className:"min-w-[140px] text-center",children:y?e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"number",step:100,min:0,max:3e4,autoFocus:!0,value:D,onChange:I=>R(I.target.value),onBlur:()=>{const I=Number(D);Number.isFinite(I)&&I>=0&&I<=3e4&&i(Math.round(I/100)*100),w(!1)},onKeyDown:I=>{I.key==="Enter"?I.target.blur():I.key==="Escape"&&w(!1)},className:"w-20 text-center text-lg font-bold bg-transparent border-b border-primary outline-none"}),e.jsx("div",{className:"text-xs text-muted-foreground mt-0.5",children:"mètres"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("button",{type:"button",disabled:r,onClick:()=>{R(String(p)),w(!0)},className:K("text-2xl font-bold border-b border-dashed border-muted-foreground/40",r?"text-muted-foreground cursor-not-allowed":"text-foreground hover:border-primary cursor-text"),children:[p,"m"]}),e.jsxs("div",{className:K("text-sm font-medium mt-0.5",r?"text-muted-foreground":"text-primary"),children:[qe(ht(p))," km"]})]})}),e.jsx("button",{type:"button",disabled:r||p+100>3e4,onClick:()=>i(p+100),className:K("h-11 w-11 rounded-2xl border flex items-center justify-center transition-colors",r?"bg-muted border-border text-muted-foreground cursor-not-allowed":"bg-card border-border text-foreground hover:bg-muted active:scale-95"),"aria-label":"+100m",children:e.jsx(Be,{className:"h-5 w-5"})})]})]})}function Ts({onMark:t}){const[n,i]=a.useState(!1),[r,f]=a.useState("");return n?e.jsxs("div",{className:"flex gap-2 mb-3",children:[e.jsx("input",{type:"text",placeholder:"Motif (optionnel)",value:r,onChange:N=>f(N.target.value),className:"flex-1 rounded-md border border-input bg-transparent px-3 py-1.5 text-sm",autoFocus:!0}),e.jsx("button",{type:"button",onClick:()=>{t(r||void 0),i(!1),f("")},className:"rounded-md bg-primary px-3 py-1.5 text-sm font-medium text-primary-foreground",children:"OK"})]}):e.jsx("button",{type:"button",className:"w-full rounded-xl border border-dashed border-muted-foreground/30 p-2.5 mb-3 text-sm text-muted-foreground hover:bg-muted/50 transition-colors",onClick:()=>i(!0),children:"Marquer indisponible"})}function $s({open:t,selectedDate:n,sessionsForSelectedDay:i,selectedDayStatus:r,dayKm:f,activeSessionId:N,detailsOpen:x,draftState:p,saveState:k,isPending:y,logsBySessionId:w,onClose:D,onDayOffAll:R,onOpenSession:I,onCloseSession:me,onToggleDetails:Z,onMarkAbsent:ce,onMarkPresent:V,onClearOverride:xe,onSaveFeedback:ee,onDraftStateChange:d,getSessionStatus:b,isAbsent:A,absenceReason:M,onDeleteFeedback:q,onMarkDayAbsent:Q,onRemoveDayAbsence:de}){const[,ie]=St(),[oe,Ne]=a.useState(!1),[pe,fe]=a.useState(!1),[be,ge]=a.useState(null),_=a.useMemo(()=>N&&i.find(L=>L.id===N)||null,[N,i]);return a.useEffect(()=>{fe(!1)},[N]),e.jsxs(Ce,{children:[t&&e.jsxs(e.Fragment,{children:[e.jsx(le.div,{className:"fixed inset-0 z-overlay bg-black/30",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:D}),e.jsx(le.div,{className:K("fixed z-modal bg-background shadow-2xl","left-0 right-0 bottom-0 top-auto max-h-[calc(100dvh-env(safe-area-inset-top))] h-[88dvh] rounded-t-3xl","sm:right-0 sm:top-0 sm:left-auto sm:bottom-auto sm:h-full sm:w-full sm:max-w-xl sm:rounded-none"),variants:ls,initial:"hidden",animate:"visible",exit:"exit",role:"dialog","aria-modal":"true",children:e.jsxs("div",{className:"flex h-full flex-col",children:[e.jsx("div",{className:"px-5 pt-3 sm:hidden",children:e.jsx("div",{className:"mx-auto h-1.5 w-12 rounded-full bg-muted"})}),e.jsxs("div",{className:"sticky top-0 z-10 flex items-center justify-between border-b border-primary/15 bg-background px-4 sm:px-5 py-2.5",children:[e.jsxs("div",{className:"flex items-center gap-2.5 min-w-0",children:[e.jsx("div",{className:"flex items-center justify-center h-7 w-7 rounded-lg bg-primary text-primary-foreground shrink-0",children:e.jsx(Mt,{className:"h-3.5 w-3.5"})}),e.jsx("div",{className:"min-w-0",children:e.jsx("div",{className:"truncate text-sm font-display font-bold uppercase italic tracking-tight text-primary",children:Os(n)})})]}),e.jsx(Ke,{onClick:D,label:"Fermer",children:e.jsx(Dt,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"flex-1 overflow-auto p-4 sm:p-5",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center gap-2.5",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"text-lg font-bold text-foreground",children:[f," km"]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:K("h-1.5 w-1.5 rounded-full",r.total>0&&r.completed>=1?"bg-status-success":"bg-muted-foreground/30")}),e.jsx("span",{className:K("h-1.5 w-1.5 rounded-full",r.total>0&&r.completed>=2?"bg-status-success":"bg-muted-foreground/30")})]})]})}),e.jsx(Ke,{onClick:R,label:"OFF (absent journée)",tone:"dark",disabled:y,children:e.jsx(ds,{className:"h-5 w-5"})})]}),_?null:e.jsx("div",{className:"mt-3 rounded-2xl border border-border bg-muted/20 px-3 py-2 text-xs text-muted-foreground",children:"Choisis un créneau pour saisir ton ressenti. Une fois ouvert, la saisie prend toute la place."}),!_&&Q&&de&&(A?e.jsxs("div",{className:"rounded-xl border border-muted bg-muted/30 p-3 mt-3 mb-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"Marqué indisponible"}),e.jsx("button",{type:"button",onClick:de,className:"text-xs text-primary hover:underline",children:"Annuler"})]}),M&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:M})]}):e.jsx("div",{className:"mt-3",children:e.jsx(Ts,{onMark:Q})})),!_&&(()=>{const L=[],T=[];for(const S of i)b(S,n).status==="not_expected"?T.push(S):L.push(S);const P=S=>{const O=b(S,n),z=!!w[S.id],te=O.status==="absent",Y=O.status==="not_expected",C=te||Y,F=O.expected&&!z&&!te,$=z?"bg-status-success-bg border-status-success/30":C?"bg-sky-50 border-sky-200":F?"bg-status-warning-bg border-status-warning/30":"bg-card border-border",J=Ls.find(se=>se.key===S.slotKey)?.Icon||Ye;return e.jsx("button",{type:"button",onClick:()=>I(S.id),className:K("w-full rounded-3xl border px-3 py-3 text-left transition",$,"hover:shadow-sm"),children:e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[e.jsx("div",{className:K("h-10 w-10 rounded-2xl border flex items-center justify-center",z?"border-status-success/30 bg-status-success-bg":C?"border-sky-200 bg-sky-100":F?"border-status-warning/30 bg-status-warning-bg":"border-border bg-muted"),children:e.jsx(J,{className:"h-5 w-5 text-foreground"})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"truncate text-sm font-semibold text-foreground",children:S.title}),e.jsxs("div",{className:"mt-1 flex items-center gap-2",children:[S.isEmpty?e.jsx(Pe,{children:"Vide"}):e.jsxs(Pe,{children:[qe(S.km)," km"]}),z&&e.jsxs("span",{className:"inline-flex items-center text-emerald-800",children:[e.jsx(st,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Présent"})]}),C&&!z&&e.jsxs("span",{className:"inline-flex items-center text-sky-800",children:[e.jsx(Le,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Absent"})]}),F&&e.jsxs("span",{className:"inline-flex items-center text-orange-900",children:[e.jsx(Ye,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"En attente"})]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[Y&&e.jsx(Ke,{onClick:se=>{se.stopPropagation(),V(S.id)},label:"Je suis venu",disabled:y,children:e.jsx(ut,{className:"h-5 w-5"})}),O.expected&&!z&&!te&&e.jsx(Ke,{onClick:se=>{se.stopPropagation(),ce(S.id)},label:"Absent",tone:"sky",disabled:y,children:e.jsx(Le,{className:"h-5 w-5"})})]})]})},S.id)};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mt-4 grid gap-2",children:L.map(P)}),T.length>0&&e.jsxs("div",{className:"mt-3",children:[e.jsxs("button",{type:"button",onClick:()=>Ne(S=>!S),className:"flex w-full items-center gap-2 rounded-2xl px-3 py-2 text-xs font-semibold text-muted-foreground hover:bg-muted transition",children:[e.jsx(at,{className:K("h-4 w-4 transition-transform",oe&&"rotate-180")}),"Autres séances (",T.length,")"]}),e.jsx(Ce,{children:oe&&e.jsx(le.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.2},className:"overflow-hidden",children:e.jsx("div",{className:"mt-1 grid gap-2",children:T.map(P)})})})]})]})})(),e.jsx(Ce,{children:_&&e.jsx(le.div,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},exit:{opacity:0,y:8},transition:{duration:Ve.normal},className:"mt-4 rounded-3xl border border-border bg-card overflow-hidden",children:(()=>{const L=b(_,n),T=L.status==="absent",P=L.status==="not_expected",S=!!w[_.id],O=L.expected&&!T,z=T?"Annuler":P?"Je suis venu":"Absent",te=T?()=>xe(_.id):P?()=>V(_.id):()=>ce(_.id),Y=Is(_.km??0);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-border",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"text-[10px] font-semibold uppercase tracking-[0.14em] text-muted-foreground",children:"Créneau sélectionné"}),e.jsx("div",{className:"truncate text-sm font-semibold text-foreground",children:_.title}),e.jsxs("div",{className:"mt-1 flex items-center gap-2",children:[_.isEmpty?e.jsx(Pe,{children:"Vide"}):e.jsxs(Pe,{children:[qe(_.km)," km"]}),S?e.jsxs("span",{className:"inline-flex items-center text-emerald-800",children:[e.jsx(st,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Présent"})]}):T||P?e.jsxs("span",{className:"inline-flex items-center text-sky-800",children:[e.jsx(Le,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Absent"})]}):e.jsxs("span",{className:"inline-flex items-center text-orange-900",children:[e.jsx(Ye,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"En attente"})]})]})]}),e.jsx("button",{type:"button",onClick:me,className:"rounded-2xl border border-border bg-card px-3 py-2 text-xs font-semibold text-foreground hover:bg-muted",children:"Retour aux créneaux"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 p-3",children:[e.jsxs("button",{type:"button",onClick:te,className:K("rounded-2xl px-3 py-3 text-sm font-semibold border transition inline-flex items-center justify-center gap-2",P?"bg-foreground text-background border-foreground hover:opacity-90":"bg-card text-foreground border-border hover:bg-muted"),children:[P?e.jsx(ut,{className:"h-4 w-4"}):e.jsx(Le,{className:"h-4 w-4"}),z]}),e.jsxs("button",{type:"button",onClick:Z,className:"rounded-2xl px-3 py-3 text-sm font-semibold border border-border bg-card hover:bg-muted inline-flex items-center justify-center gap-2",children:[e.jsx(At,{className:"h-4 w-4"}),"Fiche"]})]}),e.jsx(Ce,{children:x&&e.jsx(le.div,{initial:{opacity:0,y:6},animate:{opacity:1,y:0},exit:{opacity:0,y:6},transition:{duration:Ve.normal},className:"mx-3 mb-3 rounded-2xl border border-border bg-muted p-3",children:e.jsx("button",{type:"button",onClick:()=>ie(_.assignmentId?`/swim-session?assignmentId=${_.assignmentId}`:"/swim-session"),className:"w-full rounded-2xl border border-border bg-card px-3 py-2 text-sm font-semibold text-foreground hover:bg-muted",children:_.assignmentId?"Ouvrir la fiche complète":"Saisir mes détails techniques"})})}),e.jsxs("div",{className:"px-4 pb-4",children:[!O&&e.jsx("div",{className:"mb-3 rounded-2xl bg-sky-50 text-sky-900 px-3 py-2 text-xs",children:T?"Absent: aucun ressenti.":'Non prévu: appuyez "Je suis venu".'}),e.jsxs(le.div,{className:"space-y-4",variants:cs,initial:"hidden",animate:"visible",children:[tt.map(C=>{const F=p[C.key];return e.jsxs(le.div,{className:"space-y-2",variants:ot,children:[e.jsx("div",{className:K("text-sm font-semibold",O?"text-foreground":"text-muted-foreground"),children:C.label}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"text-[10px] text-muted-foreground w-14 text-right shrink-0 leading-tight",children:C.mode==="hard"?"Facile":"Mauvaise"}),e.jsx("div",{className:"flex gap-1.5 flex-1 justify-center",children:[1,2,3,4,5].map($=>{const J=F===$;return e.jsx("button",{type:"button",disabled:!O,onClick:()=>d({...p,[C.key]:$}),className:K("h-11 w-11 rounded-2xl border text-sm font-semibold transition",O?J?Ps(C.mode,$):"bg-card text-foreground border-border hover:bg-muted":"bg-muted text-muted-foreground border-border cursor-not-allowed"),children:$},$)})}),e.jsx("span",{className:"text-[10px] text-muted-foreground w-14 shrink-0 leading-tight",children:C.mode==="hard"?"Très dur":"Excellente"})]})]},C.key)}),e.jsxs(le.div,{className:"space-y-2",variants:ot,children:[e.jsx("div",{className:K("text-sm font-semibold",O?"text-foreground":"text-muted-foreground"),children:"Commentaire"}),e.jsx("textarea",{value:p.comment,onChange:C=>d({...p,comment:C.target.value}),disabled:!O,rows:3,placeholder:"Sensations, points techniques…",className:K("w-full resize-none rounded-3xl border px-4 py-3 text-sm outline-none",O?"bg-card text-foreground border-border focus:ring-2 focus:ring-foreground/10":"bg-muted text-muted-foreground border-border")})]})]}),e.jsxs("div",{className:"mt-4 rounded-3xl border border-border bg-muted/20 overflow-hidden",children:[e.jsxs("button",{type:"button",onClick:()=>fe(C=>!C),className:"flex w-full items-center justify-between gap-3 px-4 py-3 text-left",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold text-foreground",children:"Ajustements avancés"}),e.jsx("div",{className:"mt-0.5 text-xs text-muted-foreground",children:"Kilométrage, détail par nage et suppression du ressenti"})]}),e.jsx(at,{className:K("h-4 w-4 shrink-0 text-muted-foreground transition-transform",pe&&"rotate-180")})]}),e.jsx(Ce,{initial:!1,children:pe?e.jsx(le.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:Ve.normal},className:"overflow-hidden border-t border-border",children:e.jsxs("div",{className:"px-3 pb-3",children:[e.jsx(Ks,{plannedMeters:Y,valueMeters:p.distanceMeters,onChange:C=>d({...p,distanceMeters:C}),disabled:!O}),e.jsx(Es,{strokes:p.strokes,showStrokeDetail:p.showStrokeDetail,disabled:!O,onToggle:()=>d({...p,showStrokeDetail:!p.showStrokeDetail}),onChange:C=>d({...p,strokes:C})}),S&&q?e.jsxs("button",{type:"button",onClick:()=>ge(_.id),disabled:y,className:"mt-4 w-full rounded-2xl border border-destructive/30 bg-destructive/5 px-3 py-2.5 text-sm font-medium text-destructive hover:bg-destructive/10 transition disabled:opacity-50 disabled:cursor-not-allowed inline-flex items-center justify-center gap-2",children:[e.jsx($e,{className:"h-4 w-4"}),"Supprimer le ressenti"]}):null]})}):null})]})]})]})})()},_.id)})]}),_&&(()=>{const L=b(_,n),T=L.expected&&L.status!=="absent";return e.jsxs(Zt,{saveState:k,position:"static",children:[e.jsx("button",{type:"button",onClick:ee,disabled:y||!T||!tt.every(P=>Number.isInteger(p[P.key])),className:K("rounded-2xl px-4 py-3 text-sm font-semibold transition flex-1",y||!T?"bg-muted text-muted-foreground cursor-not-allowed":tt.every(P=>Number.isInteger(p[P.key]))?"bg-status-success text-white hover:opacity-90":"bg-status-success-bg text-status-success cursor-not-allowed"),children:"Valider"}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["→"," km"]})]})})()]})})]}),q&&e.jsx(es,{open:!!be,onOpenChange:L=>{L||ge(null)},children:e.jsxs(ts,{children:[e.jsxs(ss,{children:[e.jsx(ns,{children:"Supprimer ce ressenti ?"}),e.jsx(rs,{children:"Cette action est irréversible."})]}),e.jsxs(is,{children:[e.jsx(os,{children:"Annuler"}),e.jsx(as,{onClick:()=>{q(be),ge(null)},children:"Supprimer"})]})]})})]})}function Bs(...t){return t.filter(Boolean).join(" ")}function qs(t){try{return new Date(t).toLocaleDateString("fr-FR",{weekday:"short",day:"numeric",month:"short"})}catch{return t}}function Rs({userId:t,expanded:n,onToggle:i}){const r=kt(),{data:f,isLoading:N}=ve({queryKey:["swim-exercise-logs-history",t],queryFn:()=>H.getSwimExerciseLogsHistory(t,100),enabled:!!t&&n}),x=ye({mutationFn:({logId:y,patch:w})=>H.updateSwimExerciseLog(y,w),onSuccess:()=>{r.invalidateQueries({queryKey:["swim-exercise-logs-history",t]})}}),p=ye({mutationFn:y=>H.deleteSwimExerciseLog(y),onSuccess:()=>{r.invalidateQueries({queryKey:["swim-exercise-logs-history",t]})}}),k=_e.useMemo(()=>{if(!f?.length)return[];const y=new Map;for(const w of f){const D=(w.created_at??"").slice(0,10);y.has(D)||y.set(D,[]),y.get(D).push(w)}return Array.from(y.entries()).map(([w,D])=>({date:w,entries:D}))},[f]);return e.jsxs("div",{className:"mt-6",children:[e.jsxs("button",{type:"button",onClick:i,className:"flex w-full items-center justify-between rounded-2xl border border-dashed border-border/80 bg-background px-3 py-2.5 text-left transition hover:bg-muted/40",children:[e.jsxs("span",{className:"flex min-w-0 items-center gap-2",children:[e.jsx("span",{className:"flex h-8 w-8 shrink-0 items-center justify-center rounded-xl bg-muted text-muted-foreground",children:e.jsx(At,{className:"h-4 w-4"})}),e.jsxs("span",{className:"min-w-0",children:[e.jsx("span",{className:"block truncate text-sm font-semibold text-foreground",children:"Notes techniques"}),e.jsx("span",{className:"block truncate text-[11px] text-muted-foreground",children:"Repères détaillés, consultation optionnelle"})]})]}),e.jsx(_t,{className:Bs("h-4 w-4 transition-transform",n&&"rotate-90")})]}),n&&e.jsxs("div",{className:"mt-2 space-y-3 rounded-2xl border border-border/60 bg-card/60 p-2",children:[N&&e.jsx("div",{className:"text-sm text-muted-foreground text-center py-4",children:"Chargement..."}),!N&&k.length===0&&e.jsx("div",{className:"text-sm text-muted-foreground text-center py-4",children:"Aucune note technique enregistree."}),k.map(({date:y,entries:w})=>e.jsxs("div",{className:"rounded-2xl border border-border overflow-hidden",children:[e.jsx("div",{className:"bg-muted/50 px-3 py-2 text-xs font-semibold text-muted-foreground",children:qs(y)}),e.jsx("div",{className:"divide-y divide-border",children:w.map(D=>e.jsx(Qs,{log:D,onSave:R=>x.mutate({logId:D.id,patch:R}),onDelete:()=>p.mutate(D.id),saving:x.isPending},D.id))})]},y))]})]})}function Qs({log:t,onSave:n,onDelete:i,saving:r}){const[f,N]=a.useState(!1),[x,p]=a.useState({notes:t.notes??"",tempo:t.tempo,split_times:t.split_times,stroke_count:t.stroke_count}),[k,y]=a.useState([]),w=()=>{p({notes:t.notes??"",tempo:t.tempo,split_times:[...t.split_times],stroke_count:[...t.stroke_count]}),y(t.split_times.map(d=>We(d.time_seconds))),N(!0)},D=()=>N(!1),R=()=>{n({notes:x.notes.trim()||null,tempo:x.tempo,split_times:x.split_times,stroke_count:x.stroke_count}),N(!1)},I=()=>{p(d=>({...d,split_times:[...d.split_times,{rep:d.split_times.length+1,time_seconds:0}]})),y(d=>[...d,""])},me=(d,b)=>{y(A=>A.map((M,q)=>q===d?b:M))},Z=d=>{const b=ms(k[d]),A=We(b);y(M=>M.map((q,Q)=>Q===d?A:q)),p(M=>({...M,split_times:M.split_times.map((q,Q)=>Q===d?{...q,time_seconds:b}:q)}))},ce=d=>{p(b=>({...b,split_times:b.split_times.filter((A,M)=>M!==d).map((A,M)=>({...A,rep:M+1}))})),y(b=>b.filter((A,M)=>M!==d))},V=()=>{p(d=>({...d,stroke_count:[...d.stroke_count,{rep:d.stroke_count.length+1,count:0}]}))},xe=(d,b)=>{p(A=>({...A,stroke_count:A.stroke_count.map((M,q)=>q===d?{...M,count:b}:M)}))},ee=d=>{p(b=>({...b,stroke_count:b.stroke_count.filter((A,M)=>M!==d).map((A,M)=>({...A,rep:M+1}))}))};return f?e.jsxs("div",{className:"px-3 py-2.5 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-semibold text-foreground",children:t.exercise_label}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{type:"button",onClick:R,disabled:r,className:"p-1.5 rounded-lg text-primary hover:bg-primary/10 transition","aria-label":"Enregistrer",children:e.jsx(st,{className:"h-4 w-4"})}),e.jsx("button",{type:"button",onClick:D,className:"p-1.5 rounded-lg text-muted-foreground hover:bg-muted transition","aria-label":"Annuler",children:e.jsx(Dt,{className:"h-4 w-4"})}),e.jsx("button",{type:"button",onClick:i,className:"p-1.5 rounded-lg text-muted-foreground hover:text-destructive hover:bg-destructive/10 transition","aria-label":"Supprimer",children:e.jsx($e,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-xs font-medium text-muted-foreground min-w-[80px]",children:[e.jsx(lt,{className:"h-3.5 w-3.5"}),"Tempo"]}),e.jsx("input",{type:"number",inputMode:"decimal",step:"0.1",min:0,value:x.tempo??"",onChange:d=>p(b=>({...b,tempo:d.target.value?Number(d.target.value):null})),placeholder:"coups/min",className:"w-24 rounded-xl border border-border bg-background px-2 py-1.5 text-sm text-center outline-none focus:ring-2 focus:ring-foreground/10"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-xs font-medium text-muted-foreground",children:[e.jsx(dt,{className:"h-3.5 w-3.5"}),"Temps"]}),e.jsxs("button",{type:"button",onClick:I,className:"inline-flex items-center gap-1 text-xs text-primary hover:text-primary/80 transition",children:[e.jsx(Be,{className:"h-3 w-3"}),"Rep"]})]}),x.split_times.length>0&&e.jsx("div",{className:"mt-1.5 flex flex-wrap gap-1.5",children:x.split_times.map((d,b)=>e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"text-[10px] text-muted-foreground w-4 text-right",children:d.rep}),e.jsx(us,{value:k[b]??"",onChange:A=>me(b,A),onBlur:()=>Z(b),size:"compact"}),e.jsx("button",{type:"button",onClick:()=>ce(b),className:"p-0.5 text-muted-foreground hover:text-destructive transition",children:e.jsx($e,{className:"h-3 w-3"})})]},b))})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-xs font-medium text-muted-foreground",children:[e.jsx(ct,{className:"h-3.5 w-3.5"}),"Coups de bras"]}),e.jsxs("button",{type:"button",onClick:V,className:"inline-flex items-center gap-1 text-xs text-primary hover:text-primary/80 transition",children:[e.jsx(Be,{className:"h-3 w-3"}),"Rep"]})]}),x.stroke_count.length>0&&e.jsx("div",{className:"mt-1.5 flex flex-wrap gap-1.5",children:x.stroke_count.map((d,b)=>e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"text-[10px] text-muted-foreground w-4 text-right",children:d.rep}),e.jsx("input",{type:"number",inputMode:"numeric",min:0,value:d.count||"",onChange:A=>xe(b,Number(A.target.value)||0),placeholder:"nb",className:"w-14 rounded-lg border border-border bg-background px-1.5 py-1 text-xs text-center outline-none focus:ring-2 focus:ring-foreground/10"}),e.jsx("button",{type:"button",onClick:()=>ee(b),className:"p-0.5 text-muted-foreground hover:text-destructive transition",children:e.jsx($e,{className:"h-3 w-3"})})]},b))})]}),e.jsx("textarea",{value:x.notes,onChange:d=>p(b=>({...b,notes:d.target.value})),placeholder:"Notes libres...",rows:2,className:"w-full resize-none rounded-xl border border-border bg-background px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-foreground/10"})]}):e.jsxs("div",{className:"px-3 py-2.5 space-y-1.5 group",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-sm font-semibold text-foreground",children:t.exercise_label}),e.jsx("button",{type:"button",onClick:w,className:"p-1.5 rounded-lg text-muted-foreground hover:bg-muted transition","aria-label":"Modifier",children:e.jsx(xs,{className:"h-3.5 w-3.5"})})]}),e.jsxs("div",{className:"flex flex-wrap gap-x-4 gap-y-1 text-xs text-muted-foreground",children:[t.tempo!=null&&e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx(lt,{className:"h-3 w-3"}),t.tempo," c/min"]}),t.split_times.length>0&&e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx(dt,{className:"h-3 w-3"}),t.split_times.map(d=>We(d.time_seconds)||"—").join(" / ")]}),t.stroke_count.length>0&&e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx(ct,{className:"h-3 w-3"}),t.stroke_count.map(d=>d.count).join(" / ")," cps"]})]}),t.notes&&e.jsx("div",{className:"text-xs text-foreground/70 italic",children:t.notes})]})}const zs=["Lun","Mar","Mer","Jeu","Ven","Sam","Dim"],yt=[{key:"AM",label:"Matin"},{key:"PM",label:"Soir"}],Hs=[{key:"difficulty",label:"Difficulté",mode:"hard"},{key:"fatigue_end",label:"Fatigue fin",mode:"hard"},{key:"performance",label:"Perf perçue",mode:"good"},{key:"engagement",label:"Engagement",mode:"good"}];function Nt(...t){return t.filter(Boolean).join(" ")}function jt(t){return String(t).padStart(2,"0")}function Te(t){return`${t.getFullYear()}-${jt(t.getMonth()+1)}-${jt(t.getDate())}`}function Js(t){return new Date(t.getFullYear(),t.getMonth(),1)}function Us(t){const n=String(t).split("__");return{iso:n[0],slotKey:n[1]||""}}function vt(t,n){return Number.isFinite(t)?Math.round(t/n)*n:0}function wt({globalKm:t,onSettings:n}){return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-2.5",children:[e.jsx("div",{className:"flex items-center justify-center h-7 w-7 rounded-lg bg-primary text-primary-foreground",children:e.jsx(Mt,{className:"h-3.5 w-3.5"})}),e.jsx("h1",{className:"text-lg font-display font-bold uppercase italic tracking-tight text-primary",children:"Accueil"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"hidden sm:inline text-xs font-mono font-semibold text-muted-foreground tabular-nums",children:[t," km"]}),e.jsxs(Ct,{type:"button",variant:"outline",size:"sm",onClick:n,className:"h-8 rounded-xl border-primary/20 bg-primary/5 px-2.5 text-xs font-semibold text-primary hover:bg-primary/10","aria-label":"Présence hebdo",children:[e.jsx(hs,{className:"mr-1 h-3.5 w-3.5"}),"Hebdo"]})]})]})}function Mn(){const t=rt(s=>s.user),n=rt(s=>s.userId),{toast:i}=zt(),r=kt(),[,f]=St(),[N,x]=_e.useState("idle"),[p,k]=_e.useState(!1),[y,w]=_e.useState(null);_e.useEffect(()=>{Ue.auth.getSession().then(({data:s})=>{w(s.session?.user?.id??null)})},[t]);const{data:D,isLoading:R,error:I,refetch:me}=ve({queryKey:["sessions",n??t],queryFn:()=>H.getSessions(t,n),enabled:!!t}),{data:Z,isLoading:ce,error:V,refetch:xe}=ve({queryKey:["assignments",t],queryFn:()=>H.getAssignments(t,n),enabled:!!t}),{data:ee=[]}=ve({queryKey:["competitions"],queryFn:()=>H.getCompetitions()}),{data:d}=ve({queryKey:["my-competition-ids"],queryFn:()=>H.getMyCompetitionIds()}),b=a.useMemo(()=>!d||d.length===0?ee:ee.filter(s=>d.includes(s.id)),[ee,d]),{data:A=[]}=ve({queryKey:["my-planned-absences"],queryFn:()=>H.getMyPlannedAbsences()}),M=a.useMemo(()=>new Set(A.map(s=>s.date)),[A]),q=R||ce,Q=I||V,de=()=>{me(),xe()},ie=ye({mutationFn:s=>H.deleteSession(s),onMutate:()=>{x("saving")},onSuccess:()=>{r.invalidateQueries({queryKey:["sessions"]}),r.invalidateQueries({queryKey:["hall-of-fame"]}),i({title:"Séance supprimée",description:"La saisie a été supprimée."}),x("saved"),setTimeout(()=>x("idle"),2e3)},onError:()=>{i({title:"Erreur",description:"Impossible de supprimer la séance.",variant:"destructive"}),x("error"),setTimeout(()=>x("idle"),3e3)}}),oe=ye({mutationFn:async s=>{const{_exerciseLogs:o,...m}=s,j=await H.syncSession({...m,athlete_name:t,athlete_id:n??void 0});if(o&&o.length>0&&j.sessionId)try{const{data:E}=await Ue.auth.getSession(),X=E.session?.user?.id;X&&await H.saveSwimExerciseLogs(j.sessionId,X,o)}catch(E){console.warn("[EAC] Failed to save exercise logs:",E)}return j},onMutate:()=>{x("saving")},onSuccess:()=>{r.invalidateQueries({queryKey:["sessions"]}),r.invalidateQueries({queryKey:["assignments"]}),r.invalidateQueries({queryKey:["hall-of-fame"]}),i({title:"Séance enregistrée",description:"Vos données ont été synchronisées."}),x("saved"),setTimeout(()=>x("idle"),2e3)},onError:()=>{i({title:"Erreur",description:"Impossible d'enregistrer la séance.",variant:"destructive"}),x("error"),setTimeout(()=>x("idle"),3e3)}}),Ne=ye({mutationFn:async s=>{const{_exerciseLogs:o,...m}=s,j=await H.updateSession(m);if(o&&m.id)try{const{data:E}=await Ue.auth.getSession(),X=E.session?.user?.id;X&&await H.saveSwimExerciseLogs(m.id,X,o)}catch(E){throw console.error("[EAC] Failed to save exercise logs:",E),E}return j},onMutate:()=>{x("saving")},onSuccess:()=>{r.invalidateQueries({queryKey:["sessions"]}),r.invalidateQueries({queryKey:["hall-of-fame"]}),i({title:"Séance mise à jour",description:"Votre saisie a été mise à jour."}),x("saved"),setTimeout(()=>x("idle"),2e3)},onError:()=>{i({title:"Erreur",description:"Impossible de mettre à jour la séance.",variant:"destructive"}),x("error"),setTimeout(()=>x("idle"),3e3)}}),pe=ye({mutationFn:({date:s,reason:o})=>H.setPlannedAbsence(s,o),onMutate:async({date:s,reason:o})=>{await r.cancelQueries({queryKey:["my-planned-absences"]});const m=r.getQueryData(["my-planned-absences"]);return r.setQueryData(["my-planned-absences"],j=>[...j??[],{date:s,reason:o??null}]),{previous:m}},onSuccess:()=>{r.invalidateQueries({queryKey:["my-planned-absences"]}),i({title:"Jour marqué indisponible"})},onError:(s,o,m)=>{m?.previous&&r.setQueryData(["my-planned-absences"],m.previous),i({title:"Erreur",description:"Impossible de marquer ce jour indisponible.",variant:"destructive"})}}),fe=ye({mutationFn:s=>H.removePlannedAbsence(s),onMutate:async s=>{await r.cancelQueries({queryKey:["my-planned-absences"]});const o=r.getQueryData(["my-planned-absences"]);return r.setQueryData(["my-planned-absences"],m=>(m??[]).filter(j=>j.date!==s)),{previous:o}},onSuccess:()=>{r.invalidateQueries({queryKey:["my-planned-absences"]}),i({title:"Disponibilité restaurée"})},onError:(s,o,m)=>{m?.previous&&r.setQueryData(["my-planned-absences"],m.previous),i({title:"Erreur",description:"Impossible de restaurer la disponibilité.",variant:"destructive"})}}),be=Fs({sessions:D,assignments:Z,userId:n,user:t}),{today:ge,monthCursor:_,selectedISO:L,drawerOpen:T,settingsOpen:P,activeSessionId:S,detailsOpen:O,selectedDayIndex:z,isPending:te,presenceDefaults:Y,stableDurationMin:C,draftState:F,gridDates:$,completionByISO:J,selectedDate:se,sessionsForSelectedDay:ue,selectedDayStatus:we,globalKm:ne,dayKm:Re,logsBySessionId:G,setMonthCursor:l,setSelectedISO:c,setDrawerOpen:u,setSettingsOpen:v,setActiveSessionId:g,setDetailsOpen:h,setSelectedDayIndex:U,setPresenceDefaults:W,setAttendanceOverrideBySessionId:B,setStableDurationMin:he,setDraftState:ke,setAutoCloseArmed:je,startTransition:re,getSessionStatus:Qe}=be,Et=a.useMemo(()=>{const s=new Set;for(const o of b){if(!o.date)continue;const m=o.date.slice(0,10),j=o.end_date?o.end_date.slice(0,10):m;let E=m;for(;E<=j;){s.add(E);const X=new Date(E+"T00:00:00");X.setDate(X.getDate()+1);const Me=X.getFullYear(),Ie=String(X.getMonth()+1).padStart(2,"0"),De=String(X.getDate()).padStart(2,"0");E=`${Me}-${Ie}-${De}`}}return s},[b]),ae=a.useMemo(()=>{const s=Te(new Date);return b.filter(m=>m.date&&m.date.slice(0,10)>=s).sort((m,j)=>m.date.localeCompare(j.date))[0]??null},[b]),ze=a.useMemo(()=>{if(!ae)return null;const s=new Date;s.setHours(0,0,0,0);const o=new Date(ae.date.slice(0,10)+"T00:00:00");return Math.round((o.getTime()-s.getTime())/(1e3*60*60*24))},[ae]),Oe=a.useMemo(()=>ae?Ht({compDate:ae.date.slice(0,10),assignments:Z,absenceDates:M,presenceDefaults:Y}):null,[ae,Z,M,Y]),Se=a.useCallback(s=>{c(s),u(!0),g(null),h(!1);const o=J[s]||{completed:0,total:2};je(o.total>0&&o.completed<o.total)},[J,c,u,g,h,je]),He=a.useCallback(()=>{u(!1),g(null),h(!1),je(!1),U(null)},[u,g,h,je,U]),Ot=a.useCallback(()=>{l(s=>new Date(s.getFullYear(),s.getMonth()-1,1))},[l]),It=a.useCallback(()=>{l(s=>new Date(s.getFullYear(),s.getMonth()+1,1))},[l]),Lt=a.useCallback(()=>{const s=new Date;l(Js(s)),Se(Te(s))},[Se,l]),Je=a.useCallback(s=>{g(s),h(!1)},[g,h]),Pt=a.useCallback(s=>{re(()=>{B(m=>({...m,[s]:"absent"}))});const o=G[s];o?.id&&ie.mutate(Number(o.id))},[ie,G,re,B]),Kt=a.useCallback(s=>{re(()=>{B(o=>({...o,[s]:"present"}))})},[re,B]),Tt=a.useCallback(s=>{re(()=>{B(o=>{const m={...o};return delete m[s],m})})},[re,B]),$t=a.useCallback(()=>{const s=ue.map(o=>Qe(o,se).expected?o.id:null).filter(Boolean);s.length!==0&&(re(()=>{B(o=>{const m={...o};for(const j of s)m[j]="absent";return m}),g(null),h(!1)}),s.forEach(o=>{const m=G[o];m?.id&&ie.mutate(Number(m.id))}))},[ue,Qe,se,re,G,ie,B,g,h]),Bt=a.useCallback(()=>{if(!S||!t||!Hs.every(Ae=>Number.isInteger(F[Ae.key])))return;const{iso:o,slotKey:m}=Us(S),j=m==="PM"?"Soir":"Matin",E=vt(Number(F.distanceMeters??0),100),X=vt(Number(C),15),Me={};for(const[Ae,Qt]of Object.entries(F.strokes)){const nt=Number(Qt);nt>0&&(Me[Ae]=nt)}const Ie={date:o,slot:j,distance:E,duration:X,effort:Number(F.difficulty),feeling:Number(F.fatigue_end),performance:Number(F.performance),engagement:Number(F.engagement),comments:String(F.comment||"").slice(0,400),athlete_name:t,athlete_id:n??void 0,stroke_distances:Object.keys(Me).length>0?Me:null},De=G[S];re(()=>{B(Ae=>({...Ae,[S]:"present"}))}),De?.id?Ne.mutate({...Ie,id:De.id,created_at:De.created_at??new Date().toISOString(),_exerciseLogs:F.exerciseLogs.length>0?F.exerciseLogs:[]}):oe.mutate({...Ie,_exerciseLogs:F.exerciseLogs.length>0?F.exerciseLogs:void 0}),g(null),h(!1)},[S,t,n,F,C,G,re,Ne,oe,B,g,h]),qt=a.useCallback((s,o)=>{W(m=>({...m,[s]:{...m[s],[o]:!m[s][o]}}))},[W]);a.useEffect(()=>{if(!T)return;const s=o=>{const m=o.target?.tagName;if(!(m==="INPUT"||m==="TEXTAREA"||o.target?.isContentEditable)){if(o.key==="Escape"){o.preventDefault(),He();return}(o.key==="Enter"||o.key===" ")&&(o.preventDefault(),ue.length>0&&!S&&Je(ue[0].id))}};return window.addEventListener("keydown",s),()=>window.removeEventListener("keydown",s)},[T,He,ue,S,Je]);const Rt=a.useCallback((s,o)=>{if(!["ArrowUp","ArrowDown","ArrowLeft","ArrowRight","Enter"," "].includes(s.key))return;if(s.preventDefault(),s.key==="Enter"||s.key===" "){const E=Te($[o]);Se(E);return}let j=o;s.key==="ArrowLeft"&&(j=Math.max(0,o-1)),s.key==="ArrowRight"&&(j=Math.min($.length-1,o+1)),s.key==="ArrowUp"&&(j=Math.max(0,o-7)),s.key==="ArrowDown"&&(j=Math.min($.length-1,o+7)),U(j),c(Te($[j])),setTimeout(()=>{const E=document.querySelectorAll('[data-calendar-cell="true"]');E[j]&&E[j].focus()},0)},[$,Se,U,c]);return q?e.jsxs("div",{className:"min-h-screen bg-muted",children:[e.jsx("div",{className:"sm:hidden fixed top-0 left-0 right-0 z-overlay border-b border-primary/15 bg-background/90 backdrop-blur-md",children:e.jsxs("div",{className:"mx-auto max-w-6xl px-3 py-2.5 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2.5",children:[e.jsx("div",{className:"h-7 w-7 rounded-lg bg-primary/20 animate-pulse"}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("div",{className:"h-4 w-12 rounded bg-muted animate-pulse"}),e.jsx("div",{className:"h-3 w-16 rounded bg-muted animate-pulse"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-9 w-9 rounded-xl bg-primary/5 animate-pulse"}),e.jsx("div",{className:"h-9 w-9 rounded-xl bg-primary/5 animate-pulse"})]})]})}),e.jsx("div",{className:"mx-auto max-w-6xl px-3 sm:px-4 pt-20 pb-5 sm:py-8",children:e.jsxs("div",{className:"mt-4 rounded-3xl border border-border bg-card overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-3 sm:px-5 py-3 border-b border-border",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"h-9 w-9 rounded-2xl bg-muted animate-pulse"}),e.jsx("div",{className:"h-9 w-9 rounded-2xl bg-muted animate-pulse"})]}),e.jsx("div",{className:"h-6 w-32 rounded bg-muted animate-pulse"}),e.jsx("div",{className:"h-9 w-9 rounded-2xl bg-muted animate-pulse"})]}),e.jsx("div",{className:"p-3 sm:p-5",children:e.jsxs("div",{className:"grid grid-cols-7 gap-1.5 sm:gap-2",children:[Array.from({length:7}).map((s,o)=>e.jsx("div",{className:"px-0.5 pb-1 flex justify-center",children:e.jsx("div",{className:"h-3 w-4 rounded bg-muted animate-pulse"})},`wh-${o}`)),Array.from({length:35}).map((s,o)=>e.jsx("div",{className:"aspect-square rounded-2xl bg-muted/50 animate-pulse"},`cs-${o}`))]})})]})})]}):Q?e.jsxs("div",{className:"flex flex-col items-center justify-center p-8 text-center",children:[e.jsx(fs,{className:"h-12 w-12 text-destructive mb-4"}),e.jsx("h3",{className:"font-semibold",children:"Impossible de charger les données"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:Q.message}),e.jsx(Ct,{onClick:()=>de(),className:"mt-4",children:"Réessayer"})]}):e.jsxs("div",{className:"min-h-screen bg-muted",children:[e.jsx("div",{className:"sm:hidden fixed top-0 left-0 right-0 z-overlay border-b border-primary/15 bg-background/90 backdrop-blur-md",children:e.jsx("div",{className:"px-4 py-2.5 flex items-center justify-between",children:e.jsx(wt,{globalKm:ne,onSettings:()=>v(!0)})})}),e.jsxs("div",{className:"mx-auto max-w-6xl px-3 sm:px-4 pt-20 pb-5 sm:py-8",children:[e.jsx("div",{className:"hidden sm:flex items-center justify-between",children:e.jsx(wt,{globalKm:ne,onSettings:()=>v(!0)})}),e.jsx(ps,{variant:"amber",icon:e.jsx(it,{}),label:ae?.name,badge:ze===0?"Aujourd'hui":`J-${ze}`,sublabel:ae?.location,subbadge:Oe!=null&&Oe>0?`${Oe} séance${Oe>1?"s":""}`:void 0,visible:!!ae&&ze!=null,className:"mt-4"}),e.jsx("div",{className:"mt-3 flex items-center gap-2",children:e.jsxs("button",{onClick:()=>f("/records"),className:"flex items-center gap-1.5 rounded-full border px-3 py-2 text-xs font-medium text-muted-foreground active:bg-muted",children:[e.jsx(it,{className:"h-3.5 w-3.5"}),"Mes records"]})}),e.jsxs("div",{className:"mt-4 rounded-3xl border border-border bg-card overflow-hidden",children:[e.jsx(Xt,{monthCursor:_,selectedDayStatus:we,onPrevMonth:Ot,onNextMonth:It,onJumpToday:Lt}),e.jsx(Gt,{monthCursor:_,gridDates:$,completionByISO:J,competitionDates:Et,absenceDates:M,selectedISO:L,selectedDayIndex:z,today:ge,onDayClick:Se,onKeyDown:Rt})]}),y&&e.jsx(Rs,{userId:y,expanded:p,onToggle:()=>k(s=>!s)}),e.jsx(Jt,{open:P,onOpenChange:v,children:e.jsxs(Ut,{className:"max-w-sm rounded-2xl",children:[e.jsx(Vt,{children:e.jsx(Yt,{children:"Présence hebdo"})}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"Définis les créneaux attendus chaque semaine. Tu peux ensuite ajuster un jour précis dans le calendrier."}),e.jsx("div",{className:"space-y-2",children:zs.map((s,o)=>{const m=yt.filter(j=>!!Y?.[o]?.[j.key]).length;return e.jsxs("div",{className:"rounded-2xl border border-border bg-card px-3 py-3",children:[e.jsx("div",{className:"mb-2 flex items-center justify-between gap-3",children:e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold text-foreground",children:s}),e.jsx("div",{className:"text-[11px] text-muted-foreground",children:m===0?"Aucun créneau prévu":`${m} créneau${m>1?"x":""} attendu${m>1?"s":""}`})]})}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:yt.map(j=>{const E=!!Y?.[o]?.[j.key];return e.jsxs("button",{type:"button",onClick:()=>qt(o,j.key),className:Nt("rounded-2xl border px-3 py-3 text-left transition",E?"border-foreground bg-foreground text-background":"border-border bg-card text-foreground hover:bg-muted"),"aria-label":`${s} ${j.label}`,children:[e.jsx("div",{className:"text-sm font-semibold",children:j.label}),e.jsx("div",{className:Nt("mt-1 text-[11px]",E?"text-background/80":"text-muted-foreground"),children:E?"Prévu":"Non prévu"})]},j.key)})})]},s)})}),e.jsxs("div",{className:"rounded-2xl border border-border bg-muted px-3 py-2",children:[e.jsx("div",{className:"text-xs font-semibold text-foreground",children:"Durée (valeur par défaut)"}),e.jsxs("div",{className:"mt-2 flex items-center gap-2",children:[e.jsx("button",{type:"button",className:"h-9 w-9 rounded-2xl border border-border bg-card hover:bg-muted flex items-center justify-center",onClick:()=>he(s=>Math.max(30,s-15)),"aria-label":"Diminuer la durée",children:e.jsx(Ft,{className:"h-4 w-4"})}),e.jsxs("div",{className:"text-sm font-semibold text-foreground",children:[C," min"]}),e.jsx("button",{type:"button",className:"h-9 w-9 rounded-2xl border border-border bg-card hover:bg-muted flex items-center justify-center",onClick:()=>he(s=>Math.min(240,s+15)),"aria-label":"Augmenter la durée",children:e.jsx(Be,{className:"h-4 w-4"})})]})]})]})]})}),e.jsx($s,{open:T,selectedDate:se,sessionsForSelectedDay:ue,selectedDayStatus:we,dayKm:Re,activeSessionId:S,detailsOpen:O,draftState:F,saveState:N,isPending:te,logsBySessionId:G,onClose:He,onDayOffAll:$t,onOpenSession:Je,onCloseSession:()=>{g(null),h(!1)},onToggleDetails:()=>h(s=>!s),onMarkAbsent:Pt,onMarkPresent:Kt,onClearOverride:Tt,onSaveFeedback:Bt,onDeleteFeedback:s=>{const o=G[s];o?.id&&(ie.mutate(Number(o.id)),g(null),h(!1))},onDraftStateChange:ke,getSessionStatus:Qe,isAbsent:M.has(L),absenceReason:A.find(s=>s.date===L)?.reason??null,onMarkDayAbsent:s=>pe.mutate({date:L,reason:s}),onRemoveDayAbsence:()=>fe.mutate(L)})]})]})}export{Mn as default};
